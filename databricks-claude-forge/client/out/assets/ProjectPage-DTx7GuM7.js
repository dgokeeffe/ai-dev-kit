const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D7cFLKlg.js","assets/index-SGpjYQK6.js","assets/index-BLftK-gy.js","assets/index-Cv5zMcFs.css","assets/templates-DzS2i046.js","assets/terminal-BFjgSpbv.js","assets/index-Cte_GxnQ.js","assets/index-CKkdEfUE.js","assets/index-DuyWbSKH.js","assets/index-Du4zVQDd.js","assets/index-D8zySEht.js","assets/index-OLvXkA4N.js","assets/index-Lak4fBov.js"])))=>i.map(i=>d[i]);
import{c as Ee,j as D,r as H,g as wf,f as Bc,d as Ag,e as Dg,h as Oc,R as Rr,s as Mg,_ as bi,t as Ct,i as ds,k as Lg,l as Tg,m as Rg,u as Bg,a as Og,n as Pg,o as Ig,p as Ng,q as Fn,v as Fg,w as Hg,x as jg,y as zg}from"./index-BLftK-gy.js";import{c as ue,G as Sf,a as Wg,L as Di,X as Cn,F as kf,b as En,g as An,d as $g,T as Ug,B as Vg,M as Pc,e as qg}from"./templates-DzS2i046.js";import{T as Kg,S as vl,C as Gg,a as Ys}from"./terminal-BFjgSpbv.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xg=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Jg=Ee("arrow-down",Xg);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yg=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Qg=Ee("arrow-up",Yg);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zg=[["path",{d:"m2 16 4.039-9.69a.5.5 0 0 1 .923 0L11 16",key:"d5nyq2"}],["path",{d:"M22 9v7",key:"pvm9v3"}],["path",{d:"M3.304 13h6.392",key:"1q3zxz"}],["circle",{cx:"18.5",cy:"12.5",r:"3.5",key:"z97x68"}]],e0=Ee("case-sensitive",Zg);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t0=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ic=Ee("check",t0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i0=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Br=Ee("chevron-down",i0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r0=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],n0=Ee("chevron-up",r0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s0=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Nc=Ee("circle-alert",s0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o0=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],l0=Ee("circle-x",o0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a0=[["path",{d:"M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3",key:"11bfej"}]],c0=Ee("command",a0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h0=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Cf=Ee("external-link",h0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u0=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],f0=Ee("eye",u0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d0=[["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}]],pr=Ee("file-code",d0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p0=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],Ef=Ee("file-json",p0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m0=[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M4 7V4a2 2 0 0 1 2-2 2 2 0 0 0-2 2",key:"1vk7w2"}],["path",{d:"M4.063 20.999a2 2 0 0 0 2 1L18 22a2 2 0 0 0 2-2V7l-5-5H6",key:"1jink5"}],["path",{d:"m5 11-3 3",key:"1dgrs4"}],["path",{d:"m5 17-3-3h10",key:"1mvvaf"}]],g0=Ee("file-output",m0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v0=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Qi=Ee("file-text",v0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _0=[["path",{d:"M15 2a2 2 0 0 1 1.414.586l4 4A2 2 0 0 1 21 8v7a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z",key:"1vo8kb"}],["path",{d:"M15 2v4a2 2 0 0 0 2 2h4",key:"sud9ri"}],["path",{d:"M5 7a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h8a2 2 0 0 0 1.732-1",key:"l4dndm"}]],y0=Ee("files",_0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b0=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],Af=Ee("folder-open",b0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x0=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],w0=Ee("funnel",x0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S0=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],_l=Ee("globe",S0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k0=[["circle",{cx:"12",cy:"9",r:"1",key:"124mty"}],["circle",{cx:"19",cy:"9",r:"1",key:"1ruzo2"}],["circle",{cx:"5",cy:"9",r:"1",key:"1a8b28"}],["circle",{cx:"12",cy:"15",r:"1",key:"1e56xg"}],["circle",{cx:"19",cy:"15",r:"1",key:"1a92ep"}],["circle",{cx:"5",cy:"15",r:"1",key:"5r1jwy"}]],Df=Ee("grip-horizontal",k0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C0=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],yl=Ee("grip-vertical",C0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E0=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],A0=Ee("history",E0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D0=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],M0=Ee("maximize-2",D0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L0=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],T0=Ee("minimize-2",L0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R0=[["path",{d:"M5 12h14",key:"1ays0h"}]],B0=Ee("minus",R0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O0=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Mf=Ee("play",O0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P0=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],bl=Ee("plus",P0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I0=[["path",{d:"M17 3v10",key:"15fgeh"}],["path",{d:"m12.67 5.5 8.66 5",key:"1gpheq"}],["path",{d:"m12.67 10.5 8.66-5",key:"1dkfa6"}],["path",{d:"M9 17a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-2z",key:"swwfx4"}]],N0=Ee("regex",I0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F0=[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]],H0=Ee("rocket",F0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j0=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Ca=Ee("search",j0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z0=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],W0=Ee("settings",z0);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $0=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],U0=Ee("square",$0),V0=[{id:"explorer",icon:y0,label:"Explorer"},{id:"search",icon:Ca,label:"Search"},{id:"git",icon:Sf,label:"Source Control"},{id:"chat",icon:Wg,label:"Chat"}];function q0({activeActivity:i,onActivityChange:e,className:t=""}){const r=n=>{e(i===n?null:n)};return D.jsxs("div",{className:ue("flex flex-col w-12 bg-[var(--color-bg-secondary)] border-r border-[var(--color-border)]",t),children:[D.jsx("div",{className:"flex flex-col",children:V0.map(n=>{const s=n.icon,l=i===n.id;return D.jsxs("button",{onClick:()=>r(n.id),className:ue("relative flex items-center justify-center h-12 w-12 transition-colors",l?"text-[var(--color-text-primary)]":"text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)]"),title:n.label,children:[l&&D.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-0.5 h-6 bg-[var(--color-accent-primary)]"}),D.jsx(s,{className:"h-5 w-5"})]},n.id)})}),D.jsx("div",{className:"flex-1"}),D.jsx("div",{className:"flex flex-col",children:D.jsx("button",{className:"flex items-center justify-center h-12 w-12 text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors",title:"Settings",children:D.jsx(W0,{className:"h-5 w-5"})})})]})}const K0=[{id:"terminal",label:"Terminal",icon:Kg},{id:"output",label:"Output",icon:g0},{id:"deploy",label:"Deploy",icon:H0},{id:"preview",label:"Preview",icon:_l}];function G0({isOpen:i,onToggle:e,activeTab:t,onTabChange:r,height:n,onHeightChange:s,children:l,className:o=""}){const a=H.useRef(null),c=H.useRef(null);return H.useEffect(()=>{const u=a.current;if(!u)return;let h=!1,f=0,d=0;const _=m=>{h=!0,f=m.clientY,d=n,document.body.style.cursor="row-resize",document.body.style.userSelect="none"},y=m=>{if(!h)return;const g=f-m.clientY,v=Math.min(Math.max(d+g,150),700);s(v)},p=()=>{h=!1,document.body.style.cursor="",document.body.style.userSelect=""};return u.addEventListener("mousedown",_),document.addEventListener("mousemove",y),document.addEventListener("mouseup",p),()=>{u.removeEventListener("mousedown",_),document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",p)}},[n,s]),D.jsxs("div",{ref:c,className:ue("flex flex-col border-t border-[var(--color-border)] bg-[var(--color-background)]",o),style:{height:i?n:"auto"},children:[i&&D.jsx("div",{ref:a,className:"h-1 bg-[var(--color-border)] hover:bg-[var(--color-accent-primary)]/50 cursor-row-resize flex items-center justify-center",children:D.jsx(Df,{className:"h-3 w-3 text-[var(--color-text-muted)]"})}),D.jsxs("div",{className:"flex items-center h-9 bg-[var(--color-bg-secondary)]/50 border-b border-[var(--color-border)]",children:[D.jsx("div",{className:"flex items-center",children:K0.map(u=>{const h=u.icon,f=t===u.id;return D.jsxs("button",{onClick:()=>{r(u.id),i||e()},className:ue("flex items-center gap-1.5 px-3 py-1.5 text-xs border-r border-[var(--color-border)] transition-colors",f?"text-[var(--color-text-primary)] bg-[var(--color-background)]":"text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-background)]/50"),children:[D.jsx(h,{className:"h-3.5 w-3.5"}),u.label]},u.id)})}),D.jsx("div",{className:"flex-1"}),D.jsx("button",{onClick:e,className:"flex items-center justify-center h-full px-2 text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors",title:i?"Collapse panel":"Expand panel",children:i?D.jsx(Br,{className:"h-4 w-4"}):D.jsx(n0,{className:"h-4 w-4"})})]}),i&&D.jsx("div",{className:"flex-1 overflow-hidden",children:l})]})}function X0({activeActivity:i,onActivityChange:e,leftSidebar:t,leftSidebarWidth:r=200,onLeftSidebarWidthChange:n,children:s,rightSidebar:l,rightSidebarWidth:o=320,onRightSidebarWidthChange:a,isRightSidebarOpen:c=!0,bottomPanel:u,bottomPanelHeight:h=200,onBottomPanelHeightChange:f,isBottomPanelOpen:d=!1,onBottomPanelToggle:_,isClaudeMaximized:y=!1,maximizedContent:p,bottomPanelTab:m="terminal",onBottomPanelTabChange:g,className:v=""}){const b=H.useRef(null),S=H.useRef(null);H.useEffect(()=>{const k=b.current;if(!k||!n)return;let w=!1,E=0,A=0;const T=N=>{w=!0,E=N.clientX,A=r,document.body.style.cursor="col-resize",document.body.style.userSelect="none"},B=N=>{if(!w)return;const j=N.clientX-E,z=Math.min(Math.max(A+j,150),400);n(z)},O=()=>{w=!1,document.body.style.cursor="",document.body.style.userSelect=""};return k.addEventListener("mousedown",T),document.addEventListener("mousemove",B),document.addEventListener("mouseup",O),()=>{k.removeEventListener("mousedown",T),document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",O)}},[r,n]),H.useEffect(()=>{const k=S.current;if(!k||!a)return;let w=!1,E=0,A=0;const T=N=>{w=!0,E=N.clientX,A=o,document.body.style.cursor="col-resize",document.body.style.userSelect="none"},B=N=>{if(!w)return;const j=E-N.clientX,z=Math.min(Math.max(A+j,250),500);a(z)},O=()=>{w=!1,document.body.style.cursor="",document.body.style.userSelect=""};return k.addEventListener("mousedown",T),document.addEventListener("mousemove",B),document.addEventListener("mouseup",O),()=>{k.removeEventListener("mousedown",T),document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",O)}},[o,a]);const x=i==="explorer"||i==="search"||i==="git";return D.jsxs("div",{className:ue("flex h-full",v),children:[D.jsx(q0,{activeActivity:i,onActivityChange:e}),x&&t&&D.jsxs(D.Fragment,{children:[D.jsx("div",{className:"flex-shrink-0 overflow-hidden border-r border-[var(--color-border)]",style:{width:r},children:t}),D.jsx("div",{ref:b,className:"w-1 bg-[var(--color-border)] hover:bg-[var(--color-accent-primary)]/50 cursor-col-resize flex items-center justify-center flex-shrink-0",children:D.jsx(yl,{className:"h-4 w-4 text-[var(--color-text-muted)]"})})]}),D.jsxs("div",{className:"flex-1 flex flex-col min-w-0 overflow-hidden",children:[D.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:y&&p?p:s}),!y&&u&&_&&g&&f&&D.jsx(G0,{isOpen:d,onToggle:_,activeTab:m,onTabChange:g,height:h,onHeightChange:f,children:u})]}),!y&&l&&D.jsxs("div",{className:ue("flex",!c&&"hidden"),children:[D.jsx("div",{ref:S,className:"w-1 bg-[var(--color-border)] hover:bg-[var(--color-accent-primary)]/50 cursor-col-resize flex items-center justify-center flex-shrink-0",children:D.jsx(yl,{className:"h-4 w-4 text-[var(--color-text-muted)]"})}),D.jsx("div",{className:"flex-shrink-0 overflow-hidden border-l border-[var(--color-border)]",style:{width:o},children:l})]})]})}function J0(i,e){const t={};return(i[i.length-1]===""?[...i,""]:i).join((t.padRight?" ":"")+","+(t.padLeft===!1?"":" ")).trim()}const Y0=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Q0=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Z0={};function Fc(i,e){return(Z0.jsx?Q0:Y0).test(i)}const ev=/[ \t\n\f\r]/g;function tv(i){return typeof i=="object"?i.type==="text"?Hc(i.value):!1:Hc(i)}function Hc(i){return i.replace(ev,"")===""}class Dn{constructor(e,t,r){this.normal=t,this.property=e,r&&(this.space=r)}}Dn.prototype.normal={};Dn.prototype.property={};Dn.prototype.space=void 0;function Lf(i,e){const t={},r={};for(const n of i)Object.assign(t,n.property),Object.assign(r,n.normal);return new Dn(t,r,e)}function xl(i){return i.toLowerCase()}class wt{constructor(e,t){this.attribute=t,this.property=e}}wt.prototype.attribute="";wt.prototype.booleanish=!1;wt.prototype.boolean=!1;wt.prototype.commaOrSpaceSeparated=!1;wt.prototype.commaSeparated=!1;wt.prototype.defined=!1;wt.prototype.mustUseProperty=!1;wt.prototype.number=!1;wt.prototype.overloadedBoolean=!1;wt.prototype.property="";wt.prototype.spaceSeparated=!1;wt.prototype.space=void 0;let iv=0;const me=rr(),je=rr(),wl=rr(),J=rr(),Pe=rr(),mr=rr(),kt=rr();function rr(){return 2**++iv}const Sl=Object.freeze(Object.defineProperty({__proto__:null,boolean:me,booleanish:je,commaOrSpaceSeparated:kt,commaSeparated:mr,number:J,overloadedBoolean:wl,spaceSeparated:Pe},Symbol.toStringTag,{value:"Module"})),wo=Object.keys(Sl);class Ea extends wt{constructor(e,t,r,n){let s=-1;if(super(e,t),jc(this,"space",n),typeof r=="number")for(;++s<wo.length;){const l=wo[s];jc(this,wo[s],(r&Sl[l])===Sl[l])}}}Ea.prototype.defined=!0;function jc(i,e,t){t&&(i[e]=t)}function Or(i){const e={},t={};for(const[r,n]of Object.entries(i.properties)){const s=new Ea(r,i.transform(i.attributes||{},r),n,i.space);i.mustUseProperty&&i.mustUseProperty.includes(r)&&(s.mustUseProperty=!0),e[r]=s,t[xl(r)]=r,t[xl(s.attribute)]=r}return new Dn(e,t,i.space)}const Tf=Or({properties:{ariaActiveDescendant:null,ariaAtomic:je,ariaAutoComplete:null,ariaBusy:je,ariaChecked:je,ariaColCount:J,ariaColIndex:J,ariaColSpan:J,ariaControls:Pe,ariaCurrent:null,ariaDescribedBy:Pe,ariaDetails:null,ariaDisabled:je,ariaDropEffect:Pe,ariaErrorMessage:null,ariaExpanded:je,ariaFlowTo:Pe,ariaGrabbed:je,ariaHasPopup:null,ariaHidden:je,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Pe,ariaLevel:J,ariaLive:null,ariaModal:je,ariaMultiLine:je,ariaMultiSelectable:je,ariaOrientation:null,ariaOwns:Pe,ariaPlaceholder:null,ariaPosInSet:J,ariaPressed:je,ariaReadOnly:je,ariaRelevant:null,ariaRequired:je,ariaRoleDescription:Pe,ariaRowCount:J,ariaRowIndex:J,ariaRowSpan:J,ariaSelected:je,ariaSetSize:J,ariaSort:null,ariaValueMax:J,ariaValueMin:J,ariaValueNow:J,ariaValueText:null,role:null},transform(i,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function Rf(i,e){return e in i?i[e]:e}function Bf(i,e){return Rf(i,e.toLowerCase())}const rv=Or({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:mr,acceptCharset:Pe,accessKey:Pe,action:null,allow:null,allowFullScreen:me,allowPaymentRequest:me,allowUserMedia:me,alt:null,as:null,async:me,autoCapitalize:null,autoComplete:Pe,autoFocus:me,autoPlay:me,blocking:Pe,capture:null,charSet:null,checked:me,cite:null,className:Pe,cols:J,colSpan:null,content:null,contentEditable:je,controls:me,controlsList:Pe,coords:J|mr,crossOrigin:null,data:null,dateTime:null,decoding:null,default:me,defer:me,dir:null,dirName:null,disabled:me,download:wl,draggable:je,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:me,formTarget:null,headers:Pe,height:J,hidden:wl,high:J,href:null,hrefLang:null,htmlFor:Pe,httpEquiv:Pe,id:null,imageSizes:null,imageSrcSet:null,inert:me,inputMode:null,integrity:null,is:null,isMap:me,itemId:null,itemProp:Pe,itemRef:Pe,itemScope:me,itemType:Pe,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:me,low:J,manifest:null,max:null,maxLength:J,media:null,method:null,min:null,minLength:J,multiple:me,muted:me,name:null,nonce:null,noModule:me,noValidate:me,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:me,optimum:J,pattern:null,ping:Pe,placeholder:null,playsInline:me,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:me,referrerPolicy:null,rel:Pe,required:me,reversed:me,rows:J,rowSpan:J,sandbox:Pe,scope:null,scoped:me,seamless:me,selected:me,shadowRootClonable:me,shadowRootDelegatesFocus:me,shadowRootMode:null,shape:null,size:J,sizes:null,slot:null,span:J,spellCheck:je,src:null,srcDoc:null,srcLang:null,srcSet:null,start:J,step:null,style:null,tabIndex:J,target:null,title:null,translate:null,type:null,typeMustMatch:me,useMap:null,value:je,width:J,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Pe,axis:null,background:null,bgColor:null,border:J,borderColor:null,bottomMargin:J,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:me,declare:me,event:null,face:null,frame:null,frameBorder:null,hSpace:J,leftMargin:J,link:null,longDesc:null,lowSrc:null,marginHeight:J,marginWidth:J,noResize:me,noHref:me,noShade:me,noWrap:me,object:null,profile:null,prompt:null,rev:null,rightMargin:J,rules:null,scheme:null,scrolling:je,standby:null,summary:null,text:null,topMargin:J,valueType:null,version:null,vAlign:null,vLink:null,vSpace:J,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:me,disableRemotePlayback:me,prefix:null,property:null,results:J,security:null,unselectable:null},space:"html",transform:Bf}),nv=Or({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:kt,accentHeight:J,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:J,amplitude:J,arabicForm:null,ascent:J,attributeName:null,attributeType:null,azimuth:J,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:J,by:null,calcMode:null,capHeight:J,className:Pe,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:J,diffuseConstant:J,direction:null,display:null,dur:null,divisor:J,dominantBaseline:null,download:me,dx:null,dy:null,edgeMode:null,editable:null,elevation:J,enableBackground:null,end:null,event:null,exponent:J,externalResourcesRequired:null,fill:null,fillOpacity:J,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:mr,g2:mr,glyphName:mr,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:J,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:J,horizOriginX:J,horizOriginY:J,id:null,ideographic:J,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:J,k:J,k1:J,k2:J,k3:J,k4:J,kernelMatrix:kt,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:J,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:J,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:J,overlineThickness:J,paintOrder:null,panose1:null,path:null,pathLength:J,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Pe,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:J,pointsAtY:J,pointsAtZ:J,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:kt,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:kt,rev:kt,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:kt,requiredFeatures:kt,requiredFonts:kt,requiredFormats:kt,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:J,specularExponent:J,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:J,strikethroughThickness:J,string:null,stroke:null,strokeDashArray:kt,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:J,strokeOpacity:J,strokeWidth:null,style:null,surfaceScale:J,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:kt,tabIndex:J,tableValues:null,target:null,targetX:J,targetY:J,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:kt,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:J,underlineThickness:J,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:J,values:null,vAlphabetic:J,vMathematical:J,vectorEffect:null,vHanging:J,vIdeographic:J,version:null,vertAdvY:J,vertOriginX:J,vertOriginY:J,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:J,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:Rf}),Of=Or({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(i,e){return"xlink:"+e.slice(5).toLowerCase()}}),Pf=Or({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:Bf}),If=Or({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(i,e){return"xml:"+e.slice(3).toLowerCase()}}),sv={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},ov=/[A-Z]/g,zc=/-[a-z]/g,lv=/^data[-\w.:]+$/i;function av(i,e){const t=xl(e);let r=e,n=wt;if(t in i.normal)return i.property[i.normal[t]];if(t.length>4&&t.slice(0,4)==="data"&&lv.test(e)){if(e.charAt(4)==="-"){const s=e.slice(5).replace(zc,hv);r="data"+s.charAt(0).toUpperCase()+s.slice(1)}else{const s=e.slice(4);if(!zc.test(s)){let l=s.replace(ov,cv);l.charAt(0)!=="-"&&(l="-"+l),e="data"+l}}n=Ea}return new n(r,e)}function cv(i){return"-"+i.toLowerCase()}function hv(i){return i.charAt(1).toUpperCase()}const uv=Lf([Tf,rv,Of,Pf,If],"html"),Aa=Lf([Tf,nv,Of,Pf,If],"svg");function fv(i){return i.join(" ").trim()}var sr={},So,Wc;function dv(){if(Wc)return So;Wc=1;var i=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,e=/\n/g,t=/^\s*/,r=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,n=/^:\s*/,s=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,l=/^[;\s]*/,o=/^\s+|\s+$/g,a=`
`,c="/",u="*",h="",f="comment",d="declaration";function _(p,m){if(typeof p!="string")throw new TypeError("First argument must be a string");if(!p)return[];m=m||{};var g=1,v=1;function b(N){var j=N.match(e);j&&(g+=j.length);var z=N.lastIndexOf(a);v=~z?N.length-z:v+N.length}function S(){var N={line:g,column:v};return function(j){return j.position=new x(N),E(),j}}function x(N){this.start=N,this.end={line:g,column:v},this.source=m.source}x.prototype.content=p;function k(N){var j=new Error(m.source+":"+g+":"+v+": "+N);if(j.reason=N,j.filename=m.source,j.line=g,j.column=v,j.source=p,!m.silent)throw j}function w(N){var j=N.exec(p);if(j){var z=j[0];return b(z),p=p.slice(z.length),j}}function E(){w(t)}function A(N){var j;for(N=N||[];j=T();)j!==!1&&N.push(j);return N}function T(){var N=S();if(!(c!=p.charAt(0)||u!=p.charAt(1))){for(var j=2;h!=p.charAt(j)&&(u!=p.charAt(j)||c!=p.charAt(j+1));)++j;if(j+=2,h===p.charAt(j-1))return k("End of comment missing");var z=p.slice(2,j-2);return v+=2,b(z),p=p.slice(j),v+=2,N({type:f,comment:z})}}function B(){var N=S(),j=w(r);if(j){if(T(),!w(n))return k("property missing ':'");var z=w(s),$=N({type:d,property:y(j[0].replace(i,h)),value:z?y(z[0].replace(i,h)):h});return w(l),$}}function O(){var N=[];A(N);for(var j;j=B();)j!==!1&&(N.push(j),A(N));return N}return E(),O()}function y(p){return p?p.replace(o,h):h}return So=_,So}var $c;function pv(){if($c)return sr;$c=1;var i=sr&&sr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(sr,"__esModule",{value:!0}),sr.default=t;const e=i(dv());function t(r,n){let s=null;if(!r||typeof r!="string")return s;const l=(0,e.default)(r),o=typeof n=="function";return l.forEach(a=>{if(a.type!=="declaration")return;const{property:c,value:u}=a;o?n(c,u,a):u&&(s=s||{},s[c]=u)}),s}return sr}var jr={},Uc;function mv(){if(Uc)return jr;Uc=1,Object.defineProperty(jr,"__esModule",{value:!0}),jr.camelCase=void 0;var i=/^--[a-zA-Z0-9_-]+$/,e=/-([a-z])/g,t=/^[^-]+$/,r=/^-(webkit|moz|ms|o|khtml)-/,n=/^-(ms)-/,s=function(c){return!c||t.test(c)||i.test(c)},l=function(c,u){return u.toUpperCase()},o=function(c,u){return"".concat(u,"-")},a=function(c,u){return u===void 0&&(u={}),s(c)?c:(c=c.toLowerCase(),u.reactCompat?c=c.replace(n,o):c=c.replace(r,o),c.replace(e,l))};return jr.camelCase=a,jr}var zr,Vc;function gv(){if(Vc)return zr;Vc=1;var i=zr&&zr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}},e=i(pv()),t=mv();function r(n,s){var l={};return!n||typeof n!="string"||(0,e.default)(n,function(o,a){o&&a&&(l[(0,t.camelCase)(o,s)]=a)}),l}return r.default=r,zr=r,zr}var vv=gv();const _v=wf(vv),Nf=Ff("end"),Da=Ff("start");function Ff(i){return e;function e(t){const r=t&&t.position&&t.position[i]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function yv(i){const e=Da(i),t=Nf(i);if(e&&t)return{start:e,end:t}}function Qr(i){return!i||typeof i!="object"?"":"position"in i||"type"in i?qc(i.position):"start"in i||"end"in i?qc(i):"line"in i||"column"in i?kl(i):""}function kl(i){return Kc(i&&i.line)+":"+Kc(i&&i.column)}function qc(i){return kl(i&&i.start)+"-"+kl(i&&i.end)}function Kc(i){return i&&typeof i=="number"?i:1}class ot extends Error{constructor(e,t,r){super(),typeof t=="string"&&(r=t,t=void 0);let n="",s={},l=!1;if(t&&("line"in t&&"column"in t?s={place:t}:"start"in t&&"end"in t?s={place:t}:"type"in t?s={ancestors:[t],place:t.position}:s={...t}),typeof e=="string"?n=e:!s.cause&&e&&(l=!0,n=e.message,s.cause=e),!s.ruleId&&!s.source&&typeof r=="string"){const a=r.indexOf(":");a===-1?s.ruleId=r:(s.source=r.slice(0,a),s.ruleId=r.slice(a+1))}if(!s.place&&s.ancestors&&s.ancestors){const a=s.ancestors[s.ancestors.length-1];a&&(s.place=a.position)}const o=s.place&&"start"in s.place?s.place.start:s.place;this.ancestors=s.ancestors||void 0,this.cause=s.cause||void 0,this.column=o?o.column:void 0,this.fatal=void 0,this.file="",this.message=n,this.line=o?o.line:void 0,this.name=Qr(s.place)||"1:1",this.place=s.place||void 0,this.reason=this.message,this.ruleId=s.ruleId||void 0,this.source=s.source||void 0,this.stack=l&&s.cause&&typeof s.cause.stack=="string"?s.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}ot.prototype.file="";ot.prototype.name="";ot.prototype.reason="";ot.prototype.message="";ot.prototype.stack="";ot.prototype.column=void 0;ot.prototype.line=void 0;ot.prototype.ancestors=void 0;ot.prototype.cause=void 0;ot.prototype.fatal=void 0;ot.prototype.place=void 0;ot.prototype.ruleId=void 0;ot.prototype.source=void 0;const Ma={}.hasOwnProperty,bv=new Map,xv=/[A-Z]/g,wv=new Set(["table","tbody","thead","tfoot","tr"]),Sv=new Set(["td","th"]),Hf="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function kv(i,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const t=e.filePath||void 0;let r;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=Rv(t,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=Tv(t,e.jsx,e.jsxs)}const n={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:r,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:t,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?Aa:uv,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},s=jf(n,i,void 0);return s&&typeof s!="string"?s:n.create(i,n.Fragment,{children:s||void 0},void 0)}function jf(i,e,t){if(e.type==="element")return Cv(i,e,t);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return Ev(i,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return Dv(i,e,t);if(e.type==="mdxjsEsm")return Av(i,e);if(e.type==="root")return Mv(i,e,t);if(e.type==="text")return Lv(i,e)}function Cv(i,e,t){const r=i.schema;let n=r;e.tagName.toLowerCase()==="svg"&&r.space==="html"&&(n=Aa,i.schema=n),i.ancestors.push(e);const s=Wf(i,e.tagName,!1),l=Bv(i,e);let o=Ta(i,e);return wv.has(e.tagName)&&(o=o.filter(function(a){return typeof a=="string"?!tv(a):!0})),zf(i,l,s,e),La(l,o),i.ancestors.pop(),i.schema=r,i.create(e,s,l,t)}function Ev(i,e){if(e.data&&e.data.estree&&i.evaluater){const r=e.data.estree.body[0];return r.type,i.evaluater.evaluateExpression(r.expression)}an(i,e.position)}function Av(i,e){if(e.data&&e.data.estree&&i.evaluater)return i.evaluater.evaluateProgram(e.data.estree);an(i,e.position)}function Dv(i,e,t){const r=i.schema;let n=r;e.name==="svg"&&r.space==="html"&&(n=Aa,i.schema=n),i.ancestors.push(e);const s=e.name===null?i.Fragment:Wf(i,e.name,!0),l=Ov(i,e),o=Ta(i,e);return zf(i,l,s,e),La(l,o),i.ancestors.pop(),i.schema=r,i.create(e,s,l,t)}function Mv(i,e,t){const r={};return La(r,Ta(i,e)),i.create(e,i.Fragment,r,t)}function Lv(i,e){return e.value}function zf(i,e,t,r){typeof t!="string"&&t!==i.Fragment&&i.passNode&&(e.node=r)}function La(i,e){if(e.length>0){const t=e.length>1?e:e[0];t&&(i.children=t)}}function Tv(i,e,t){return r;function r(n,s,l,o){const c=Array.isArray(l.children)?t:e;return o?c(s,l,o):c(s,l)}}function Rv(i,e){return t;function t(r,n,s,l){const o=Array.isArray(s.children),a=Da(r);return e(n,s,l,o,{columnNumber:a?a.column-1:void 0,fileName:i,lineNumber:a?a.line:void 0},void 0)}}function Bv(i,e){const t={};let r,n;for(n in e.properties)if(n!=="children"&&Ma.call(e.properties,n)){const s=Pv(i,n,e.properties[n]);if(s){const[l,o]=s;i.tableCellAlignToStyle&&l==="align"&&typeof o=="string"&&Sv.has(e.tagName)?r=o:t[l]=o}}if(r){const s=t.style||(t.style={});s[i.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return t}function Ov(i,e){const t={};for(const r of e.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&i.evaluater){const s=r.data.estree.body[0];s.type;const l=s.expression;l.type;const o=l.properties[0];o.type,Object.assign(t,i.evaluater.evaluateExpression(o.argument))}else an(i,e.position);else{const n=r.name;let s;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&i.evaluater){const o=r.value.data.estree.body[0];o.type,s=i.evaluater.evaluateExpression(o.expression)}else an(i,e.position);else s=r.value===null?!0:r.value;t[n]=s}return t}function Ta(i,e){const t=[];let r=-1;const n=i.passKeys?new Map:bv;for(;++r<e.children.length;){const s=e.children[r];let l;if(i.passKeys){const a=s.type==="element"?s.tagName:s.type==="mdxJsxFlowElement"||s.type==="mdxJsxTextElement"?s.name:void 0;if(a){const c=n.get(a)||0;l=a+"-"+c,n.set(a,c+1)}}const o=jf(i,s,l);o!==void 0&&t.push(o)}return t}function Pv(i,e,t){const r=av(i.schema,e);if(!(t==null||typeof t=="number"&&Number.isNaN(t))){if(Array.isArray(t)&&(t=r.commaSeparated?J0(t):fv(t)),r.property==="style"){let n=typeof t=="object"?t:Iv(i,String(t));return i.stylePropertyNameCase==="css"&&(n=Nv(n)),["style",n]}return[i.elementAttributeNameCase==="react"&&r.space?sv[r.property]||r.property:r.attribute,t]}}function Iv(i,e){try{return _v(e,{reactCompat:!0})}catch(t){if(i.ignoreInvalidStyle)return{};const r=t,n=new ot("Cannot parse `style` attribute",{ancestors:i.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw n.file=i.filePath||void 0,n.url=Hf+"#cannot-parse-style-attribute",n}}function Wf(i,e,t){let r;if(!t)r={type:"Literal",value:e};else if(e.includes(".")){const n=e.split(".");let s=-1,l;for(;++s<n.length;){const o=Fc(n[s])?{type:"Identifier",name:n[s]}:{type:"Literal",value:n[s]};l=l?{type:"MemberExpression",object:l,property:o,computed:!!(s&&o.type==="Literal"),optional:!1}:o}r=l}else r=Fc(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(r.type==="Literal"){const n=r.value;return Ma.call(i.components,n)?i.components[n]:n}if(i.evaluater)return i.evaluater.evaluateExpression(r);an(i)}function an(i,e){const t=new ot("Cannot handle MDX estrees without `createEvaluater`",{ancestors:i.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw t.file=i.filePath||void 0,t.url=Hf+"#cannot-handle-mdx-estrees-without-createevaluater",t}function Nv(i){const e={};let t;for(t in i)Ma.call(i,t)&&(e[Fv(t)]=i[t]);return e}function Fv(i){let e=i.replace(xv,Hv);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function Hv(i){return"-"+i.toLowerCase()}const ko={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},jv={};function Ra(i,e){const t=jv,r=typeof t.includeImageAlt=="boolean"?t.includeImageAlt:!0,n=typeof t.includeHtml=="boolean"?t.includeHtml:!0;return $f(i,r,n)}function $f(i,e,t){if(zv(i)){if("value"in i)return i.type==="html"&&!t?"":i.value;if(e&&"alt"in i&&i.alt)return i.alt;if("children"in i)return Gc(i.children,e,t)}return Array.isArray(i)?Gc(i,e,t):""}function Gc(i,e,t){const r=[];let n=-1;for(;++n<i.length;)r[n]=$f(i[n],e,t);return r.join("")}function zv(i){return!!(i&&typeof i=="object")}const Xc=document.createElement("i");function Ba(i){const e="&"+i+";";Xc.innerHTML=e;const t=Xc.textContent;return t.charCodeAt(t.length-1)===59&&i!=="semi"||t===e?!1:t}function Mt(i,e,t,r){const n=i.length;let s=0,l;if(e<0?e=-e>n?0:n+e:e=e>n?n:e,t=t>0?t:0,r.length<1e4)l=Array.from(r),l.unshift(e,t),i.splice(...l);else for(t&&i.splice(e,t);s<r.length;)l=r.slice(s,s+1e4),l.unshift(e,0),i.splice(...l),s+=1e4,e+=1e4}function Tt(i,e){return i.length>0?(Mt(i,i.length,0,e),i):e}const Jc={}.hasOwnProperty;function Uf(i){const e={};let t=-1;for(;++t<i.length;)Wv(e,i[t]);return e}function Wv(i,e){let t;for(t in e){const n=(Jc.call(i,t)?i[t]:void 0)||(i[t]={}),s=e[t];let l;if(s)for(l in s){Jc.call(n,l)||(n[l]=[]);const o=s[l];$v(n[l],Array.isArray(o)?o:o?[o]:[])}}}function $v(i,e){let t=-1;const r=[];for(;++t<e.length;)(e[t].add==="after"?i:r).push(e[t]);Mt(i,0,0,r)}function Vf(i,e){const t=Number.parseInt(i,e);return t<9||t===11||t>13&&t<32||t>126&&t<160||t>55295&&t<57344||t>64975&&t<65008||(t&65535)===65535||(t&65535)===65534||t>1114111?"":String.fromCodePoint(t)}function $t(i){return i.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const ft=Ii(/[A-Za-z]/),rt=Ii(/[\dA-Za-z]/),Uv=Ii(/[#-'*+\--9=?A-Z^-~]/);function ws(i){return i!==null&&(i<32||i===127)}const Cl=Ii(/\d/),Vv=Ii(/[\dA-Fa-f]/),qv=Ii(/[!-/:-@[-`{-~]/);function ae(i){return i!==null&&i<-2}function Re(i){return i!==null&&(i<0||i===32)}function be(i){return i===-2||i===-1||i===32}const Qs=Ii(new RegExp("\\p{P}|\\p{S}","u")),Zi=Ii(/\s/);function Ii(i){return e;function e(t){return t!==null&&t>-1&&i.test(String.fromCharCode(t))}}function Pr(i){const e=[];let t=-1,r=0,n=0;for(;++t<i.length;){const s=i.charCodeAt(t);let l="";if(s===37&&rt(i.charCodeAt(t+1))&&rt(i.charCodeAt(t+2)))n=2;else if(s<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(s))||(l=String.fromCharCode(s));else if(s>55295&&s<57344){const o=i.charCodeAt(t+1);s<56320&&o>56319&&o<57344?(l=String.fromCharCode(s,o),n=1):l=""}else l=String.fromCharCode(s);l&&(e.push(i.slice(r,t),encodeURIComponent(l)),r=t+n+1,l=""),n&&(t+=n,n=0)}return e.join("")+i.slice(r)}function Se(i,e,t,r){const n=r?r-1:Number.POSITIVE_INFINITY;let s=0;return l;function l(a){return be(a)?(i.enter(t),o(a)):e(a)}function o(a){return be(a)&&s++<n?(i.consume(a),o):(i.exit(t),e(a))}}const Kv={tokenize:Gv};function Gv(i){const e=i.attempt(this.parser.constructs.contentInitial,r,n);let t;return e;function r(o){if(o===null){i.consume(o);return}return i.enter("lineEnding"),i.consume(o),i.exit("lineEnding"),Se(i,e,"linePrefix")}function n(o){return i.enter("paragraph"),s(o)}function s(o){const a=i.enter("chunkText",{contentType:"text",previous:t});return t&&(t.next=a),t=a,l(o)}function l(o){if(o===null){i.exit("chunkText"),i.exit("paragraph"),i.consume(o);return}return ae(o)?(i.consume(o),i.exit("chunkText"),s):(i.consume(o),l)}}const Xv={tokenize:Jv},Yc={tokenize:Yv};function Jv(i){const e=this,t=[];let r=0,n,s,l;return o;function o(v){if(r<t.length){const b=t[r];return e.containerState=b[1],i.attempt(b[0].continuation,a,c)(v)}return c(v)}function a(v){if(r++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,n&&g();const b=e.events.length;let S=b,x;for(;S--;)if(e.events[S][0]==="exit"&&e.events[S][1].type==="chunkFlow"){x=e.events[S][1].end;break}m(r);let k=b;for(;k<e.events.length;)e.events[k][1].end={...x},k++;return Mt(e.events,S+1,0,e.events.slice(b)),e.events.length=k,c(v)}return o(v)}function c(v){if(r===t.length){if(!n)return f(v);if(n.currentConstruct&&n.currentConstruct.concrete)return _(v);e.interrupt=!!(n.currentConstruct&&!n._gfmTableDynamicInterruptHack)}return e.containerState={},i.check(Yc,u,h)(v)}function u(v){return n&&g(),m(r),f(v)}function h(v){return e.parser.lazy[e.now().line]=r!==t.length,l=e.now().offset,_(v)}function f(v){return e.containerState={},i.attempt(Yc,d,_)(v)}function d(v){return r++,t.push([e.currentConstruct,e.containerState]),f(v)}function _(v){if(v===null){n&&g(),m(0),i.consume(v);return}return n=n||e.parser.flow(e.now()),i.enter("chunkFlow",{_tokenizer:n,contentType:"flow",previous:s}),y(v)}function y(v){if(v===null){p(i.exit("chunkFlow"),!0),m(0),i.consume(v);return}return ae(v)?(i.consume(v),p(i.exit("chunkFlow")),r=0,e.interrupt=void 0,o):(i.consume(v),y)}function p(v,b){const S=e.sliceStream(v);if(b&&S.push(null),v.previous=s,s&&(s.next=v),s=v,n.defineSkip(v.start),n.write(S),e.parser.lazy[v.start.line]){let x=n.events.length;for(;x--;)if(n.events[x][1].start.offset<l&&(!n.events[x][1].end||n.events[x][1].end.offset>l))return;const k=e.events.length;let w=k,E,A;for(;w--;)if(e.events[w][0]==="exit"&&e.events[w][1].type==="chunkFlow"){if(E){A=e.events[w][1].end;break}E=!0}for(m(r),x=k;x<e.events.length;)e.events[x][1].end={...A},x++;Mt(e.events,w+1,0,e.events.slice(k)),e.events.length=x}}function m(v){let b=t.length;for(;b-- >v;){const S=t[b];e.containerState=S[1],S[0].exit.call(e,i)}t.length=v}function g(){n.write([null]),s=void 0,n=void 0,e.containerState._closeFlow=void 0}}function Yv(i,e,t){return Se(i,i.attempt(this.parser.constructs.document,e,t),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function Sr(i){if(i===null||Re(i)||Zi(i))return 1;if(Qs(i))return 2}function Zs(i,e,t){const r=[];let n=-1;for(;++n<i.length;){const s=i[n].resolveAll;s&&!r.includes(s)&&(e=s(e,t),r.push(s))}return e}const El={name:"attention",resolveAll:Qv,tokenize:Zv};function Qv(i,e){let t=-1,r,n,s,l,o,a,c,u;for(;++t<i.length;)if(i[t][0]==="enter"&&i[t][1].type==="attentionSequence"&&i[t][1]._close){for(r=t;r--;)if(i[r][0]==="exit"&&i[r][1].type==="attentionSequence"&&i[r][1]._open&&e.sliceSerialize(i[r][1]).charCodeAt(0)===e.sliceSerialize(i[t][1]).charCodeAt(0)){if((i[r][1]._close||i[t][1]._open)&&(i[t][1].end.offset-i[t][1].start.offset)%3&&!((i[r][1].end.offset-i[r][1].start.offset+i[t][1].end.offset-i[t][1].start.offset)%3))continue;a=i[r][1].end.offset-i[r][1].start.offset>1&&i[t][1].end.offset-i[t][1].start.offset>1?2:1;const h={...i[r][1].end},f={...i[t][1].start};Qc(h,-a),Qc(f,a),l={type:a>1?"strongSequence":"emphasisSequence",start:h,end:{...i[r][1].end}},o={type:a>1?"strongSequence":"emphasisSequence",start:{...i[t][1].start},end:f},s={type:a>1?"strongText":"emphasisText",start:{...i[r][1].end},end:{...i[t][1].start}},n={type:a>1?"strong":"emphasis",start:{...l.start},end:{...o.end}},i[r][1].end={...l.start},i[t][1].start={...o.end},c=[],i[r][1].end.offset-i[r][1].start.offset&&(c=Tt(c,[["enter",i[r][1],e],["exit",i[r][1],e]])),c=Tt(c,[["enter",n,e],["enter",l,e],["exit",l,e],["enter",s,e]]),c=Tt(c,Zs(e.parser.constructs.insideSpan.null,i.slice(r+1,t),e)),c=Tt(c,[["exit",s,e],["enter",o,e],["exit",o,e],["exit",n,e]]),i[t][1].end.offset-i[t][1].start.offset?(u=2,c=Tt(c,[["enter",i[t][1],e],["exit",i[t][1],e]])):u=0,Mt(i,r-1,t-r+3,c),t=r+c.length-u-2;break}}for(t=-1;++t<i.length;)i[t][1].type==="attentionSequence"&&(i[t][1].type="data");return i}function Zv(i,e){const t=this.parser.constructs.attentionMarkers.null,r=this.previous,n=Sr(r);let s;return l;function l(a){return s=a,i.enter("attentionSequence"),o(a)}function o(a){if(a===s)return i.consume(a),o;const c=i.exit("attentionSequence"),u=Sr(a),h=!u||u===2&&n||t.includes(a),f=!n||n===2&&u||t.includes(r);return c._open=!!(s===42?h:h&&(n||!f)),c._close=!!(s===42?f:f&&(u||!h)),e(a)}}function Qc(i,e){i.column+=e,i.offset+=e,i._bufferIndex+=e}const e_={name:"autolink",tokenize:t_};function t_(i,e,t){let r=0;return n;function n(d){return i.enter("autolink"),i.enter("autolinkMarker"),i.consume(d),i.exit("autolinkMarker"),i.enter("autolinkProtocol"),s}function s(d){return ft(d)?(i.consume(d),l):d===64?t(d):c(d)}function l(d){return d===43||d===45||d===46||rt(d)?(r=1,o(d)):c(d)}function o(d){return d===58?(i.consume(d),r=0,a):(d===43||d===45||d===46||rt(d))&&r++<32?(i.consume(d),o):(r=0,c(d))}function a(d){return d===62?(i.exit("autolinkProtocol"),i.enter("autolinkMarker"),i.consume(d),i.exit("autolinkMarker"),i.exit("autolink"),e):d===null||d===32||d===60||ws(d)?t(d):(i.consume(d),a)}function c(d){return d===64?(i.consume(d),u):Uv(d)?(i.consume(d),c):t(d)}function u(d){return rt(d)?h(d):t(d)}function h(d){return d===46?(i.consume(d),r=0,u):d===62?(i.exit("autolinkProtocol").type="autolinkEmail",i.enter("autolinkMarker"),i.consume(d),i.exit("autolinkMarker"),i.exit("autolink"),e):f(d)}function f(d){if((d===45||rt(d))&&r++<63){const _=d===45?f:h;return i.consume(d),_}return t(d)}}const Mn={partial:!0,tokenize:i_};function i_(i,e,t){return r;function r(s){return be(s)?Se(i,n,"linePrefix")(s):n(s)}function n(s){return s===null||ae(s)?e(s):t(s)}}const qf={continuation:{tokenize:n_},exit:s_,name:"blockQuote",tokenize:r_};function r_(i,e,t){const r=this;return n;function n(l){if(l===62){const o=r.containerState;return o.open||(i.enter("blockQuote",{_container:!0}),o.open=!0),i.enter("blockQuotePrefix"),i.enter("blockQuoteMarker"),i.consume(l),i.exit("blockQuoteMarker"),s}return t(l)}function s(l){return be(l)?(i.enter("blockQuotePrefixWhitespace"),i.consume(l),i.exit("blockQuotePrefixWhitespace"),i.exit("blockQuotePrefix"),e):(i.exit("blockQuotePrefix"),e(l))}}function n_(i,e,t){const r=this;return n;function n(l){return be(l)?Se(i,s,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(l):s(l)}function s(l){return i.attempt(qf,e,t)(l)}}function s_(i){i.exit("blockQuote")}const Kf={name:"characterEscape",tokenize:o_};function o_(i,e,t){return r;function r(s){return i.enter("characterEscape"),i.enter("escapeMarker"),i.consume(s),i.exit("escapeMarker"),n}function n(s){return qv(s)?(i.enter("characterEscapeValue"),i.consume(s),i.exit("characterEscapeValue"),i.exit("characterEscape"),e):t(s)}}const Gf={name:"characterReference",tokenize:l_};function l_(i,e,t){const r=this;let n=0,s,l;return o;function o(h){return i.enter("characterReference"),i.enter("characterReferenceMarker"),i.consume(h),i.exit("characterReferenceMarker"),a}function a(h){return h===35?(i.enter("characterReferenceMarkerNumeric"),i.consume(h),i.exit("characterReferenceMarkerNumeric"),c):(i.enter("characterReferenceValue"),s=31,l=rt,u(h))}function c(h){return h===88||h===120?(i.enter("characterReferenceMarkerHexadecimal"),i.consume(h),i.exit("characterReferenceMarkerHexadecimal"),i.enter("characterReferenceValue"),s=6,l=Vv,u):(i.enter("characterReferenceValue"),s=7,l=Cl,u(h))}function u(h){if(h===59&&n){const f=i.exit("characterReferenceValue");return l===rt&&!Ba(r.sliceSerialize(f))?t(h):(i.enter("characterReferenceMarker"),i.consume(h),i.exit("characterReferenceMarker"),i.exit("characterReference"),e)}return l(h)&&n++<s?(i.consume(h),u):t(h)}}const Zc={partial:!0,tokenize:c_},eh={concrete:!0,name:"codeFenced",tokenize:a_};function a_(i,e,t){const r=this,n={partial:!0,tokenize:S};let s=0,l=0,o;return a;function a(x){return c(x)}function c(x){const k=r.events[r.events.length-1];return s=k&&k[1].type==="linePrefix"?k[2].sliceSerialize(k[1],!0).length:0,o=x,i.enter("codeFenced"),i.enter("codeFencedFence"),i.enter("codeFencedFenceSequence"),u(x)}function u(x){return x===o?(l++,i.consume(x),u):l<3?t(x):(i.exit("codeFencedFenceSequence"),be(x)?Se(i,h,"whitespace")(x):h(x))}function h(x){return x===null||ae(x)?(i.exit("codeFencedFence"),r.interrupt?e(x):i.check(Zc,y,b)(x)):(i.enter("codeFencedFenceInfo"),i.enter("chunkString",{contentType:"string"}),f(x))}function f(x){return x===null||ae(x)?(i.exit("chunkString"),i.exit("codeFencedFenceInfo"),h(x)):be(x)?(i.exit("chunkString"),i.exit("codeFencedFenceInfo"),Se(i,d,"whitespace")(x)):x===96&&x===o?t(x):(i.consume(x),f)}function d(x){return x===null||ae(x)?h(x):(i.enter("codeFencedFenceMeta"),i.enter("chunkString",{contentType:"string"}),_(x))}function _(x){return x===null||ae(x)?(i.exit("chunkString"),i.exit("codeFencedFenceMeta"),h(x)):x===96&&x===o?t(x):(i.consume(x),_)}function y(x){return i.attempt(n,b,p)(x)}function p(x){return i.enter("lineEnding"),i.consume(x),i.exit("lineEnding"),m}function m(x){return s>0&&be(x)?Se(i,g,"linePrefix",s+1)(x):g(x)}function g(x){return x===null||ae(x)?i.check(Zc,y,b)(x):(i.enter("codeFlowValue"),v(x))}function v(x){return x===null||ae(x)?(i.exit("codeFlowValue"),g(x)):(i.consume(x),v)}function b(x){return i.exit("codeFenced"),e(x)}function S(x,k,w){let E=0;return A;function A(j){return x.enter("lineEnding"),x.consume(j),x.exit("lineEnding"),T}function T(j){return x.enter("codeFencedFence"),be(j)?Se(x,B,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(j):B(j)}function B(j){return j===o?(x.enter("codeFencedFenceSequence"),O(j)):w(j)}function O(j){return j===o?(E++,x.consume(j),O):E>=l?(x.exit("codeFencedFenceSequence"),be(j)?Se(x,N,"whitespace")(j):N(j)):w(j)}function N(j){return j===null||ae(j)?(x.exit("codeFencedFence"),k(j)):w(j)}}}function c_(i,e,t){const r=this;return n;function n(l){return l===null?t(l):(i.enter("lineEnding"),i.consume(l),i.exit("lineEnding"),s)}function s(l){return r.parser.lazy[r.now().line]?t(l):e(l)}}const Co={name:"codeIndented",tokenize:u_},h_={partial:!0,tokenize:f_};function u_(i,e,t){const r=this;return n;function n(c){return i.enter("codeIndented"),Se(i,s,"linePrefix",5)(c)}function s(c){const u=r.events[r.events.length-1];return u&&u[1].type==="linePrefix"&&u[2].sliceSerialize(u[1],!0).length>=4?l(c):t(c)}function l(c){return c===null?a(c):ae(c)?i.attempt(h_,l,a)(c):(i.enter("codeFlowValue"),o(c))}function o(c){return c===null||ae(c)?(i.exit("codeFlowValue"),l(c)):(i.consume(c),o)}function a(c){return i.exit("codeIndented"),e(c)}}function f_(i,e,t){const r=this;return n;function n(l){return r.parser.lazy[r.now().line]?t(l):ae(l)?(i.enter("lineEnding"),i.consume(l),i.exit("lineEnding"),n):Se(i,s,"linePrefix",5)(l)}function s(l){const o=r.events[r.events.length-1];return o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(l):ae(l)?n(l):t(l)}}const d_={name:"codeText",previous:m_,resolve:p_,tokenize:g_};function p_(i){let e=i.length-4,t=3,r,n;if((i[t][1].type==="lineEnding"||i[t][1].type==="space")&&(i[e][1].type==="lineEnding"||i[e][1].type==="space")){for(r=t;++r<e;)if(i[r][1].type==="codeTextData"){i[t][1].type="codeTextPadding",i[e][1].type="codeTextPadding",t+=2,e-=2;break}}for(r=t-1,e++;++r<=e;)n===void 0?r!==e&&i[r][1].type!=="lineEnding"&&(n=r):(r===e||i[r][1].type==="lineEnding")&&(i[n][1].type="codeTextData",r!==n+2&&(i[n][1].end=i[r-1][1].end,i.splice(n+2,r-n-2),e-=r-n-2,r=n+2),n=void 0);return i}function m_(i){return i!==96||this.events[this.events.length-1][1].type==="characterEscape"}function g_(i,e,t){let r=0,n,s;return l;function l(h){return i.enter("codeText"),i.enter("codeTextSequence"),o(h)}function o(h){return h===96?(i.consume(h),r++,o):(i.exit("codeTextSequence"),a(h))}function a(h){return h===null?t(h):h===32?(i.enter("space"),i.consume(h),i.exit("space"),a):h===96?(s=i.enter("codeTextSequence"),n=0,u(h)):ae(h)?(i.enter("lineEnding"),i.consume(h),i.exit("lineEnding"),a):(i.enter("codeTextData"),c(h))}function c(h){return h===null||h===32||h===96||ae(h)?(i.exit("codeTextData"),a(h)):(i.consume(h),c)}function u(h){return h===96?(i.consume(h),n++,u):n===r?(i.exit("codeTextSequence"),i.exit("codeText"),e(h)):(s.type="codeTextData",c(h))}}class v_{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,t){const r=t??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(e,r):e>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(e,t,r){const n=t||0;this.setCursor(Math.trunc(e));const s=this.right.splice(this.right.length-n,Number.POSITIVE_INFINITY);return r&&Wr(this.left,r),s.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),Wr(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),Wr(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const t=this.left.splice(e,Number.POSITIVE_INFINITY);Wr(this.right,t.reverse())}else{const t=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);Wr(this.left,t.reverse())}}}function Wr(i,e){let t=0;if(e.length<1e4)i.push(...e);else for(;t<e.length;)i.push(...e.slice(t,t+1e4)),t+=1e4}function Xf(i){const e={};let t=-1,r,n,s,l,o,a,c;const u=new v_(i);for(;++t<u.length;){for(;t in e;)t=e[t];if(r=u.get(t),t&&r[1].type==="chunkFlow"&&u.get(t-1)[1].type==="listItemPrefix"&&(a=r[1]._tokenizer.events,s=0,s<a.length&&a[s][1].type==="lineEndingBlank"&&(s+=2),s<a.length&&a[s][1].type==="content"))for(;++s<a.length&&a[s][1].type!=="content";)a[s][1].type==="chunkText"&&(a[s][1]._isInFirstContentOfListItem=!0,s++);if(r[0]==="enter")r[1].contentType&&(Object.assign(e,__(u,t)),t=e[t],c=!0);else if(r[1]._container){for(s=t,n=void 0;s--;)if(l=u.get(s),l[1].type==="lineEnding"||l[1].type==="lineEndingBlank")l[0]==="enter"&&(n&&(u.get(n)[1].type="lineEndingBlank"),l[1].type="lineEnding",n=s);else if(!(l[1].type==="linePrefix"||l[1].type==="listItemIndent"))break;n&&(r[1].end={...u.get(n)[1].start},o=u.slice(n,t),o.unshift(r),u.splice(n,t-n+1,o))}}return Mt(i,0,Number.POSITIVE_INFINITY,u.slice(0)),!c}function __(i,e){const t=i.get(e)[1],r=i.get(e)[2];let n=e-1;const s=[];let l=t._tokenizer;l||(l=r.parser[t.contentType](t.start),t._contentTypeTextTrailing&&(l._contentTypeTextTrailing=!0));const o=l.events,a=[],c={};let u,h,f=-1,d=t,_=0,y=0;const p=[y];for(;d;){for(;i.get(++n)[1]!==d;);s.push(n),d._tokenizer||(u=r.sliceStream(d),d.next||u.push(null),h&&l.defineSkip(d.start),d._isInFirstContentOfListItem&&(l._gfmTasklistFirstContentOfListItem=!0),l.write(u),d._isInFirstContentOfListItem&&(l._gfmTasklistFirstContentOfListItem=void 0)),h=d,d=d.next}for(d=t;++f<o.length;)o[f][0]==="exit"&&o[f-1][0]==="enter"&&o[f][1].type===o[f-1][1].type&&o[f][1].start.line!==o[f][1].end.line&&(y=f+1,p.push(y),d._tokenizer=void 0,d.previous=void 0,d=d.next);for(l.events=[],d?(d._tokenizer=void 0,d.previous=void 0):p.pop(),f=p.length;f--;){const m=o.slice(p[f],p[f+1]),g=s.pop();a.push([g,g+m.length-1]),i.splice(g,2,m)}for(a.reverse(),f=-1;++f<a.length;)c[_+a[f][0]]=_+a[f][1],_+=a[f][1]-a[f][0]-1;return c}const y_={resolve:x_,tokenize:w_},b_={partial:!0,tokenize:S_};function x_(i){return Xf(i),i}function w_(i,e){let t;return r;function r(o){return i.enter("content"),t=i.enter("chunkContent",{contentType:"content"}),n(o)}function n(o){return o===null?s(o):ae(o)?i.check(b_,l,s)(o):(i.consume(o),n)}function s(o){return i.exit("chunkContent"),i.exit("content"),e(o)}function l(o){return i.consume(o),i.exit("chunkContent"),t.next=i.enter("chunkContent",{contentType:"content",previous:t}),t=t.next,n}}function S_(i,e,t){const r=this;return n;function n(l){return i.exit("chunkContent"),i.enter("lineEnding"),i.consume(l),i.exit("lineEnding"),Se(i,s,"linePrefix")}function s(l){if(l===null||ae(l))return t(l);const o=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(l):i.interrupt(r.parser.constructs.flow,t,e)(l)}}function Jf(i,e,t,r,n,s,l,o,a){const c=a||Number.POSITIVE_INFINITY;let u=0;return h;function h(m){return m===60?(i.enter(r),i.enter(n),i.enter(s),i.consume(m),i.exit(s),f):m===null||m===32||m===41||ws(m)?t(m):(i.enter(r),i.enter(l),i.enter(o),i.enter("chunkString",{contentType:"string"}),y(m))}function f(m){return m===62?(i.enter(s),i.consume(m),i.exit(s),i.exit(n),i.exit(r),e):(i.enter(o),i.enter("chunkString",{contentType:"string"}),d(m))}function d(m){return m===62?(i.exit("chunkString"),i.exit(o),f(m)):m===null||m===60||ae(m)?t(m):(i.consume(m),m===92?_:d)}function _(m){return m===60||m===62||m===92?(i.consume(m),d):d(m)}function y(m){return!u&&(m===null||m===41||Re(m))?(i.exit("chunkString"),i.exit(o),i.exit(l),i.exit(r),e(m)):u<c&&m===40?(i.consume(m),u++,y):m===41?(i.consume(m),u--,y):m===null||m===32||m===40||ws(m)?t(m):(i.consume(m),m===92?p:y)}function p(m){return m===40||m===41||m===92?(i.consume(m),y):y(m)}}function Yf(i,e,t,r,n,s){const l=this;let o=0,a;return c;function c(d){return i.enter(r),i.enter(n),i.consume(d),i.exit(n),i.enter(s),u}function u(d){return o>999||d===null||d===91||d===93&&!a||d===94&&!o&&"_hiddenFootnoteSupport"in l.parser.constructs?t(d):d===93?(i.exit(s),i.enter(n),i.consume(d),i.exit(n),i.exit(r),e):ae(d)?(i.enter("lineEnding"),i.consume(d),i.exit("lineEnding"),u):(i.enter("chunkString",{contentType:"string"}),h(d))}function h(d){return d===null||d===91||d===93||ae(d)||o++>999?(i.exit("chunkString"),u(d)):(i.consume(d),a||(a=!be(d)),d===92?f:h)}function f(d){return d===91||d===92||d===93?(i.consume(d),o++,h):h(d)}}function Qf(i,e,t,r,n,s){let l;return o;function o(f){return f===34||f===39||f===40?(i.enter(r),i.enter(n),i.consume(f),i.exit(n),l=f===40?41:f,a):t(f)}function a(f){return f===l?(i.enter(n),i.consume(f),i.exit(n),i.exit(r),e):(i.enter(s),c(f))}function c(f){return f===l?(i.exit(s),a(l)):f===null?t(f):ae(f)?(i.enter("lineEnding"),i.consume(f),i.exit("lineEnding"),Se(i,c,"linePrefix")):(i.enter("chunkString",{contentType:"string"}),u(f))}function u(f){return f===l||f===null||ae(f)?(i.exit("chunkString"),c(f)):(i.consume(f),f===92?h:u)}function h(f){return f===l||f===92?(i.consume(f),u):u(f)}}function Zr(i,e){let t;return r;function r(n){return ae(n)?(i.enter("lineEnding"),i.consume(n),i.exit("lineEnding"),t=!0,r):be(n)?Se(i,r,t?"linePrefix":"lineSuffix")(n):e(n)}}const k_={name:"definition",tokenize:E_},C_={partial:!0,tokenize:A_};function E_(i,e,t){const r=this;let n;return s;function s(d){return i.enter("definition"),l(d)}function l(d){return Yf.call(r,i,o,t,"definitionLabel","definitionLabelMarker","definitionLabelString")(d)}function o(d){return n=$t(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),d===58?(i.enter("definitionMarker"),i.consume(d),i.exit("definitionMarker"),a):t(d)}function a(d){return Re(d)?Zr(i,c)(d):c(d)}function c(d){return Jf(i,u,t,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(d)}function u(d){return i.attempt(C_,h,h)(d)}function h(d){return be(d)?Se(i,f,"whitespace")(d):f(d)}function f(d){return d===null||ae(d)?(i.exit("definition"),r.parser.defined.push(n),e(d)):t(d)}}function A_(i,e,t){return r;function r(o){return Re(o)?Zr(i,n)(o):t(o)}function n(o){return Qf(i,s,t,"definitionTitle","definitionTitleMarker","definitionTitleString")(o)}function s(o){return be(o)?Se(i,l,"whitespace")(o):l(o)}function l(o){return o===null||ae(o)?e(o):t(o)}}const D_={name:"hardBreakEscape",tokenize:M_};function M_(i,e,t){return r;function r(s){return i.enter("hardBreakEscape"),i.consume(s),n}function n(s){return ae(s)?(i.exit("hardBreakEscape"),e(s)):t(s)}}const L_={name:"headingAtx",resolve:T_,tokenize:R_};function T_(i,e){let t=i.length-2,r=3,n,s;return i[r][1].type==="whitespace"&&(r+=2),t-2>r&&i[t][1].type==="whitespace"&&(t-=2),i[t][1].type==="atxHeadingSequence"&&(r===t-1||t-4>r&&i[t-2][1].type==="whitespace")&&(t-=r+1===t?2:4),t>r&&(n={type:"atxHeadingText",start:i[r][1].start,end:i[t][1].end},s={type:"chunkText",start:i[r][1].start,end:i[t][1].end,contentType:"text"},Mt(i,r,t-r+1,[["enter",n,e],["enter",s,e],["exit",s,e],["exit",n,e]])),i}function R_(i,e,t){let r=0;return n;function n(u){return i.enter("atxHeading"),s(u)}function s(u){return i.enter("atxHeadingSequence"),l(u)}function l(u){return u===35&&r++<6?(i.consume(u),l):u===null||Re(u)?(i.exit("atxHeadingSequence"),o(u)):t(u)}function o(u){return u===35?(i.enter("atxHeadingSequence"),a(u)):u===null||ae(u)?(i.exit("atxHeading"),e(u)):be(u)?Se(i,o,"whitespace")(u):(i.enter("atxHeadingText"),c(u))}function a(u){return u===35?(i.consume(u),a):(i.exit("atxHeadingSequence"),o(u))}function c(u){return u===null||u===35||Re(u)?(i.exit("atxHeadingText"),o(u)):(i.consume(u),c)}}const B_=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],th=["pre","script","style","textarea"],O_={concrete:!0,name:"htmlFlow",resolveTo:N_,tokenize:F_},P_={partial:!0,tokenize:j_},I_={partial:!0,tokenize:H_};function N_(i){let e=i.length;for(;e--&&!(i[e][0]==="enter"&&i[e][1].type==="htmlFlow"););return e>1&&i[e-2][1].type==="linePrefix"&&(i[e][1].start=i[e-2][1].start,i[e+1][1].start=i[e-2][1].start,i.splice(e-2,2)),i}function F_(i,e,t){const r=this;let n,s,l,o,a;return c;function c(R){return u(R)}function u(R){return i.enter("htmlFlow"),i.enter("htmlFlowData"),i.consume(R),h}function h(R){return R===33?(i.consume(R),f):R===47?(i.consume(R),s=!0,y):R===63?(i.consume(R),n=3,r.interrupt?e:C):ft(R)?(i.consume(R),l=String.fromCharCode(R),p):t(R)}function f(R){return R===45?(i.consume(R),n=2,d):R===91?(i.consume(R),n=5,o=0,_):ft(R)?(i.consume(R),n=4,r.interrupt?e:C):t(R)}function d(R){return R===45?(i.consume(R),r.interrupt?e:C):t(R)}function _(R){const X="CDATA[";return R===X.charCodeAt(o++)?(i.consume(R),o===X.length?r.interrupt?e:B:_):t(R)}function y(R){return ft(R)?(i.consume(R),l=String.fromCharCode(R),p):t(R)}function p(R){if(R===null||R===47||R===62||Re(R)){const X=R===47,ie=l.toLowerCase();return!X&&!s&&th.includes(ie)?(n=1,r.interrupt?e(R):B(R)):B_.includes(l.toLowerCase())?(n=6,X?(i.consume(R),m):r.interrupt?e(R):B(R)):(n=7,r.interrupt&&!r.parser.lazy[r.now().line]?t(R):s?g(R):v(R))}return R===45||rt(R)?(i.consume(R),l+=String.fromCharCode(R),p):t(R)}function m(R){return R===62?(i.consume(R),r.interrupt?e:B):t(R)}function g(R){return be(R)?(i.consume(R),g):A(R)}function v(R){return R===47?(i.consume(R),A):R===58||R===95||ft(R)?(i.consume(R),b):be(R)?(i.consume(R),v):A(R)}function b(R){return R===45||R===46||R===58||R===95||rt(R)?(i.consume(R),b):S(R)}function S(R){return R===61?(i.consume(R),x):be(R)?(i.consume(R),S):v(R)}function x(R){return R===null||R===60||R===61||R===62||R===96?t(R):R===34||R===39?(i.consume(R),a=R,k):be(R)?(i.consume(R),x):w(R)}function k(R){return R===a?(i.consume(R),a=null,E):R===null||ae(R)?t(R):(i.consume(R),k)}function w(R){return R===null||R===34||R===39||R===47||R===60||R===61||R===62||R===96||Re(R)?S(R):(i.consume(R),w)}function E(R){return R===47||R===62||be(R)?v(R):t(R)}function A(R){return R===62?(i.consume(R),T):t(R)}function T(R){return R===null||ae(R)?B(R):be(R)?(i.consume(R),T):t(R)}function B(R){return R===45&&n===2?(i.consume(R),z):R===60&&n===1?(i.consume(R),$):R===62&&n===4?(i.consume(R),I):R===63&&n===3?(i.consume(R),C):R===93&&n===5?(i.consume(R),M):ae(R)&&(n===6||n===7)?(i.exit("htmlFlowData"),i.check(P_,F,O)(R)):R===null||ae(R)?(i.exit("htmlFlowData"),O(R)):(i.consume(R),B)}function O(R){return i.check(I_,N,F)(R)}function N(R){return i.enter("lineEnding"),i.consume(R),i.exit("lineEnding"),j}function j(R){return R===null||ae(R)?O(R):(i.enter("htmlFlowData"),B(R))}function z(R){return R===45?(i.consume(R),C):B(R)}function $(R){return R===47?(i.consume(R),l="",q):B(R)}function q(R){if(R===62){const X=l.toLowerCase();return th.includes(X)?(i.consume(R),I):B(R)}return ft(R)&&l.length<8?(i.consume(R),l+=String.fromCharCode(R),q):B(R)}function M(R){return R===93?(i.consume(R),C):B(R)}function C(R){return R===62?(i.consume(R),I):R===45&&n===2?(i.consume(R),C):B(R)}function I(R){return R===null||ae(R)?(i.exit("htmlFlowData"),F(R)):(i.consume(R),I)}function F(R){return i.exit("htmlFlow"),e(R)}}function H_(i,e,t){const r=this;return n;function n(l){return ae(l)?(i.enter("lineEnding"),i.consume(l),i.exit("lineEnding"),s):t(l)}function s(l){return r.parser.lazy[r.now().line]?t(l):e(l)}}function j_(i,e,t){return r;function r(n){return i.enter("lineEnding"),i.consume(n),i.exit("lineEnding"),i.attempt(Mn,e,t)}}const z_={name:"htmlText",tokenize:W_};function W_(i,e,t){const r=this;let n,s,l;return o;function o(C){return i.enter("htmlText"),i.enter("htmlTextData"),i.consume(C),a}function a(C){return C===33?(i.consume(C),c):C===47?(i.consume(C),S):C===63?(i.consume(C),v):ft(C)?(i.consume(C),w):t(C)}function c(C){return C===45?(i.consume(C),u):C===91?(i.consume(C),s=0,_):ft(C)?(i.consume(C),g):t(C)}function u(C){return C===45?(i.consume(C),d):t(C)}function h(C){return C===null?t(C):C===45?(i.consume(C),f):ae(C)?(l=h,$(C)):(i.consume(C),h)}function f(C){return C===45?(i.consume(C),d):h(C)}function d(C){return C===62?z(C):C===45?f(C):h(C)}function _(C){const I="CDATA[";return C===I.charCodeAt(s++)?(i.consume(C),s===I.length?y:_):t(C)}function y(C){return C===null?t(C):C===93?(i.consume(C),p):ae(C)?(l=y,$(C)):(i.consume(C),y)}function p(C){return C===93?(i.consume(C),m):y(C)}function m(C){return C===62?z(C):C===93?(i.consume(C),m):y(C)}function g(C){return C===null||C===62?z(C):ae(C)?(l=g,$(C)):(i.consume(C),g)}function v(C){return C===null?t(C):C===63?(i.consume(C),b):ae(C)?(l=v,$(C)):(i.consume(C),v)}function b(C){return C===62?z(C):v(C)}function S(C){return ft(C)?(i.consume(C),x):t(C)}function x(C){return C===45||rt(C)?(i.consume(C),x):k(C)}function k(C){return ae(C)?(l=k,$(C)):be(C)?(i.consume(C),k):z(C)}function w(C){return C===45||rt(C)?(i.consume(C),w):C===47||C===62||Re(C)?E(C):t(C)}function E(C){return C===47?(i.consume(C),z):C===58||C===95||ft(C)?(i.consume(C),A):ae(C)?(l=E,$(C)):be(C)?(i.consume(C),E):z(C)}function A(C){return C===45||C===46||C===58||C===95||rt(C)?(i.consume(C),A):T(C)}function T(C){return C===61?(i.consume(C),B):ae(C)?(l=T,$(C)):be(C)?(i.consume(C),T):E(C)}function B(C){return C===null||C===60||C===61||C===62||C===96?t(C):C===34||C===39?(i.consume(C),n=C,O):ae(C)?(l=B,$(C)):be(C)?(i.consume(C),B):(i.consume(C),N)}function O(C){return C===n?(i.consume(C),n=void 0,j):C===null?t(C):ae(C)?(l=O,$(C)):(i.consume(C),O)}function N(C){return C===null||C===34||C===39||C===60||C===61||C===96?t(C):C===47||C===62||Re(C)?E(C):(i.consume(C),N)}function j(C){return C===47||C===62||Re(C)?E(C):t(C)}function z(C){return C===62?(i.consume(C),i.exit("htmlTextData"),i.exit("htmlText"),e):t(C)}function $(C){return i.exit("htmlTextData"),i.enter("lineEnding"),i.consume(C),i.exit("lineEnding"),q}function q(C){return be(C)?Se(i,M,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(C):M(C)}function M(C){return i.enter("htmlTextData"),l(C)}}const Oa={name:"labelEnd",resolveAll:q_,resolveTo:K_,tokenize:G_},$_={tokenize:X_},U_={tokenize:J_},V_={tokenize:Y_};function q_(i){let e=-1;const t=[];for(;++e<i.length;){const r=i[e][1];if(t.push(i[e]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const n=r.type==="labelImage"?4:2;r.type="data",e+=n}}return i.length!==t.length&&Mt(i,0,i.length,t),i}function K_(i,e){let t=i.length,r=0,n,s,l,o;for(;t--;)if(n=i[t][1],s){if(n.type==="link"||n.type==="labelLink"&&n._inactive)break;i[t][0]==="enter"&&n.type==="labelLink"&&(n._inactive=!0)}else if(l){if(i[t][0]==="enter"&&(n.type==="labelImage"||n.type==="labelLink")&&!n._balanced&&(s=t,n.type!=="labelLink")){r=2;break}}else n.type==="labelEnd"&&(l=t);const a={type:i[s][1].type==="labelLink"?"link":"image",start:{...i[s][1].start},end:{...i[i.length-1][1].end}},c={type:"label",start:{...i[s][1].start},end:{...i[l][1].end}},u={type:"labelText",start:{...i[s+r+2][1].end},end:{...i[l-2][1].start}};return o=[["enter",a,e],["enter",c,e]],o=Tt(o,i.slice(s+1,s+r+3)),o=Tt(o,[["enter",u,e]]),o=Tt(o,Zs(e.parser.constructs.insideSpan.null,i.slice(s+r+4,l-3),e)),o=Tt(o,[["exit",u,e],i[l-2],i[l-1],["exit",c,e]]),o=Tt(o,i.slice(l+1)),o=Tt(o,[["exit",a,e]]),Mt(i,s,i.length,o),i}function G_(i,e,t){const r=this;let n=r.events.length,s,l;for(;n--;)if((r.events[n][1].type==="labelImage"||r.events[n][1].type==="labelLink")&&!r.events[n][1]._balanced){s=r.events[n][1];break}return o;function o(f){return s?s._inactive?h(f):(l=r.parser.defined.includes($t(r.sliceSerialize({start:s.end,end:r.now()}))),i.enter("labelEnd"),i.enter("labelMarker"),i.consume(f),i.exit("labelMarker"),i.exit("labelEnd"),a):t(f)}function a(f){return f===40?i.attempt($_,u,l?u:h)(f):f===91?i.attempt(U_,u,l?c:h)(f):l?u(f):h(f)}function c(f){return i.attempt(V_,u,h)(f)}function u(f){return e(f)}function h(f){return s._balanced=!0,t(f)}}function X_(i,e,t){return r;function r(h){return i.enter("resource"),i.enter("resourceMarker"),i.consume(h),i.exit("resourceMarker"),n}function n(h){return Re(h)?Zr(i,s)(h):s(h)}function s(h){return h===41?u(h):Jf(i,l,o,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(h)}function l(h){return Re(h)?Zr(i,a)(h):u(h)}function o(h){return t(h)}function a(h){return h===34||h===39||h===40?Qf(i,c,t,"resourceTitle","resourceTitleMarker","resourceTitleString")(h):u(h)}function c(h){return Re(h)?Zr(i,u)(h):u(h)}function u(h){return h===41?(i.enter("resourceMarker"),i.consume(h),i.exit("resourceMarker"),i.exit("resource"),e):t(h)}}function J_(i,e,t){const r=this;return n;function n(o){return Yf.call(r,i,s,l,"reference","referenceMarker","referenceString")(o)}function s(o){return r.parser.defined.includes($t(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(o):t(o)}function l(o){return t(o)}}function Y_(i,e,t){return r;function r(s){return i.enter("reference"),i.enter("referenceMarker"),i.consume(s),i.exit("referenceMarker"),n}function n(s){return s===93?(i.enter("referenceMarker"),i.consume(s),i.exit("referenceMarker"),i.exit("reference"),e):t(s)}}const Q_={name:"labelStartImage",resolveAll:Oa.resolveAll,tokenize:Z_};function Z_(i,e,t){const r=this;return n;function n(o){return i.enter("labelImage"),i.enter("labelImageMarker"),i.consume(o),i.exit("labelImageMarker"),s}function s(o){return o===91?(i.enter("labelMarker"),i.consume(o),i.exit("labelMarker"),i.exit("labelImage"),l):t(o)}function l(o){return o===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(o):e(o)}}const ey={name:"labelStartLink",resolveAll:Oa.resolveAll,tokenize:ty};function ty(i,e,t){const r=this;return n;function n(l){return i.enter("labelLink"),i.enter("labelMarker"),i.consume(l),i.exit("labelMarker"),i.exit("labelLink"),s}function s(l){return l===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(l):e(l)}}const Eo={name:"lineEnding",tokenize:iy};function iy(i,e){return t;function t(r){return i.enter("lineEnding"),i.consume(r),i.exit("lineEnding"),Se(i,e,"linePrefix")}}const ps={name:"thematicBreak",tokenize:ry};function ry(i,e,t){let r=0,n;return s;function s(c){return i.enter("thematicBreak"),l(c)}function l(c){return n=c,o(c)}function o(c){return c===n?(i.enter("thematicBreakSequence"),a(c)):r>=3&&(c===null||ae(c))?(i.exit("thematicBreak"),e(c)):t(c)}function a(c){return c===n?(i.consume(c),r++,a):(i.exit("thematicBreakSequence"),be(c)?Se(i,o,"whitespace")(c):o(c))}}const mt={continuation:{tokenize:ly},exit:cy,name:"list",tokenize:oy},ny={partial:!0,tokenize:hy},sy={partial:!0,tokenize:ay};function oy(i,e,t){const r=this,n=r.events[r.events.length-1];let s=n&&n[1].type==="linePrefix"?n[2].sliceSerialize(n[1],!0).length:0,l=0;return o;function o(d){const _=r.containerState.type||(d===42||d===43||d===45?"listUnordered":"listOrdered");if(_==="listUnordered"?!r.containerState.marker||d===r.containerState.marker:Cl(d)){if(r.containerState.type||(r.containerState.type=_,i.enter(_,{_container:!0})),_==="listUnordered")return i.enter("listItemPrefix"),d===42||d===45?i.check(ps,t,c)(d):c(d);if(!r.interrupt||d===49)return i.enter("listItemPrefix"),i.enter("listItemValue"),a(d)}return t(d)}function a(d){return Cl(d)&&++l<10?(i.consume(d),a):(!r.interrupt||l<2)&&(r.containerState.marker?d===r.containerState.marker:d===41||d===46)?(i.exit("listItemValue"),c(d)):t(d)}function c(d){return i.enter("listItemMarker"),i.consume(d),i.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||d,i.check(Mn,r.interrupt?t:u,i.attempt(ny,f,h))}function u(d){return r.containerState.initialBlankLine=!0,s++,f(d)}function h(d){return be(d)?(i.enter("listItemPrefixWhitespace"),i.consume(d),i.exit("listItemPrefixWhitespace"),f):t(d)}function f(d){return r.containerState.size=s+r.sliceSerialize(i.exit("listItemPrefix"),!0).length,e(d)}}function ly(i,e,t){const r=this;return r.containerState._closeFlow=void 0,i.check(Mn,n,s);function n(o){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,Se(i,e,"listItemIndent",r.containerState.size+1)(o)}function s(o){return r.containerState.furtherBlankLines||!be(o)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,l(o)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,i.attempt(sy,e,l)(o))}function l(o){return r.containerState._closeFlow=!0,r.interrupt=void 0,Se(i,i.attempt(mt,e,t),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o)}}function ay(i,e,t){const r=this;return Se(i,n,"listItemIndent",r.containerState.size+1);function n(s){const l=r.events[r.events.length-1];return l&&l[1].type==="listItemIndent"&&l[2].sliceSerialize(l[1],!0).length===r.containerState.size?e(s):t(s)}}function cy(i){i.exit(this.containerState.type)}function hy(i,e,t){const r=this;return Se(i,n,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function n(s){const l=r.events[r.events.length-1];return!be(s)&&l&&l[1].type==="listItemPrefixWhitespace"?e(s):t(s)}}const ih={name:"setextUnderline",resolveTo:uy,tokenize:fy};function uy(i,e){let t=i.length,r,n,s;for(;t--;)if(i[t][0]==="enter"){if(i[t][1].type==="content"){r=t;break}i[t][1].type==="paragraph"&&(n=t)}else i[t][1].type==="content"&&i.splice(t,1),!s&&i[t][1].type==="definition"&&(s=t);const l={type:"setextHeading",start:{...i[r][1].start},end:{...i[i.length-1][1].end}};return i[n][1].type="setextHeadingText",s?(i.splice(n,0,["enter",l,e]),i.splice(s+1,0,["exit",i[r][1],e]),i[r][1].end={...i[s][1].end}):i[r][1]=l,i.push(["exit",l,e]),i}function fy(i,e,t){const r=this;let n;return s;function s(c){let u=r.events.length,h;for(;u--;)if(r.events[u][1].type!=="lineEnding"&&r.events[u][1].type!=="linePrefix"&&r.events[u][1].type!=="content"){h=r.events[u][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||h)?(i.enter("setextHeadingLine"),n=c,l(c)):t(c)}function l(c){return i.enter("setextHeadingLineSequence"),o(c)}function o(c){return c===n?(i.consume(c),o):(i.exit("setextHeadingLineSequence"),be(c)?Se(i,a,"lineSuffix")(c):a(c))}function a(c){return c===null||ae(c)?(i.exit("setextHeadingLine"),e(c)):t(c)}}const dy={tokenize:py};function py(i){const e=this,t=i.attempt(Mn,r,i.attempt(this.parser.constructs.flowInitial,n,Se(i,i.attempt(this.parser.constructs.flow,n,i.attempt(y_,n)),"linePrefix")));return t;function r(s){if(s===null){i.consume(s);return}return i.enter("lineEndingBlank"),i.consume(s),i.exit("lineEndingBlank"),e.currentConstruct=void 0,t}function n(s){if(s===null){i.consume(s);return}return i.enter("lineEnding"),i.consume(s),i.exit("lineEnding"),e.currentConstruct=void 0,t}}const my={resolveAll:ed()},gy=Zf("string"),vy=Zf("text");function Zf(i){return{resolveAll:ed(i==="text"?_y:void 0),tokenize:e};function e(t){const r=this,n=this.parser.constructs[i],s=t.attempt(n,l,o);return l;function l(u){return c(u)?s(u):o(u)}function o(u){if(u===null){t.consume(u);return}return t.enter("data"),t.consume(u),a}function a(u){return c(u)?(t.exit("data"),s(u)):(t.consume(u),a)}function c(u){if(u===null)return!0;const h=n[u];let f=-1;if(h)for(;++f<h.length;){const d=h[f];if(!d.previous||d.previous.call(r,r.previous))return!0}return!1}}}function ed(i){return e;function e(t,r){let n=-1,s;for(;++n<=t.length;)s===void 0?t[n]&&t[n][1].type==="data"&&(s=n,n++):(!t[n]||t[n][1].type!=="data")&&(n!==s+2&&(t[s][1].end=t[n-1][1].end,t.splice(s+2,n-s-2),n=s+2),s=void 0);return i?i(t,r):t}}function _y(i,e){let t=0;for(;++t<=i.length;)if((t===i.length||i[t][1].type==="lineEnding")&&i[t-1][1].type==="data"){const r=i[t-1][1],n=e.sliceStream(r);let s=n.length,l=-1,o=0,a;for(;s--;){const c=n[s];if(typeof c=="string"){for(l=c.length;c.charCodeAt(l-1)===32;)o++,l--;if(l)break;l=-1}else if(c===-2)a=!0,o++;else if(c!==-1){s++;break}}if(e._contentTypeTextTrailing&&t===i.length&&(o=0),o){const c={type:t===i.length||a||o<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:s?l:r.start._bufferIndex+l,_index:r.start._index+s,line:r.end.line,column:r.end.column-o,offset:r.end.offset-o},end:{...r.end}};r.end={...c.start},r.start.offset===r.end.offset?Object.assign(r,c):(i.splice(t,0,["enter",c,e],["exit",c,e]),t+=2)}t++}return i}const yy={42:mt,43:mt,45:mt,48:mt,49:mt,50:mt,51:mt,52:mt,53:mt,54:mt,55:mt,56:mt,57:mt,62:qf},by={91:k_},xy={[-2]:Co,[-1]:Co,32:Co},wy={35:L_,42:ps,45:[ih,ps],60:O_,61:ih,95:ps,96:eh,126:eh},Sy={38:Gf,92:Kf},ky={[-5]:Eo,[-4]:Eo,[-3]:Eo,33:Q_,38:Gf,42:El,60:[e_,z_],91:ey,92:[D_,Kf],93:Oa,95:El,96:d_},Cy={null:[El,my]},Ey={null:[42,95]},Ay={null:[]},Dy=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:Ey,contentInitial:by,disable:Ay,document:yy,flow:wy,flowInitial:xy,insideSpan:Cy,string:Sy,text:ky},Symbol.toStringTag,{value:"Module"}));function My(i,e,t){let r={_bufferIndex:-1,_index:0,line:t&&t.line||1,column:t&&t.column||1,offset:t&&t.offset||0};const n={},s=[];let l=[],o=[];const a={attempt:k(S),check:k(x),consume:g,enter:v,exit:b,interrupt:k(x,{interrupt:!0})},c={code:null,containerState:{},defineSkip:y,events:[],now:_,parser:i,previous:null,sliceSerialize:f,sliceStream:d,write:h};let u=e.tokenize.call(c,a);return e.resolveAll&&s.push(e),c;function h(T){return l=Tt(l,T),p(),l[l.length-1]!==null?[]:(w(e,0),c.events=Zs(s,c.events,c),c.events)}function f(T,B){return Ty(d(T),B)}function d(T){return Ly(l,T)}function _(){const{_bufferIndex:T,_index:B,line:O,column:N,offset:j}=r;return{_bufferIndex:T,_index:B,line:O,column:N,offset:j}}function y(T){n[T.line]=T.column,A()}function p(){let T;for(;r._index<l.length;){const B=l[r._index];if(typeof B=="string")for(T=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===T&&r._bufferIndex<B.length;)m(B.charCodeAt(r._bufferIndex));else m(B)}}function m(T){u=u(T)}function g(T){ae(T)?(r.line++,r.column=1,r.offset+=T===-3?2:1,A()):T!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===l[r._index].length&&(r._bufferIndex=-1,r._index++)),c.previous=T}function v(T,B){const O=B||{};return O.type=T,O.start=_(),c.events.push(["enter",O,c]),o.push(O),O}function b(T){const B=o.pop();return B.end=_(),c.events.push(["exit",B,c]),B}function S(T,B){w(T,B.from)}function x(T,B){B.restore()}function k(T,B){return O;function O(N,j,z){let $,q,M,C;return Array.isArray(N)?F(N):"tokenize"in N?F([N]):I(N);function I(re){return P;function P(L){const K=L!==null&&re[L],W=L!==null&&re.null,Q=[...Array.isArray(K)?K:K?[K]:[],...Array.isArray(W)?W:W?[W]:[]];return F(Q)(L)}}function F(re){return $=re,q=0,re.length===0?z:R(re[q])}function R(re){return P;function P(L){return C=E(),M=re,re.partial||(c.currentConstruct=re),re.name&&c.parser.constructs.disable.null.includes(re.name)?ie():re.tokenize.call(B?Object.assign(Object.create(c),B):c,a,X,ie)(L)}}function X(re){return T(M,C),j}function ie(re){return C.restore(),++q<$.length?R($[q]):z}}}function w(T,B){T.resolveAll&&!s.includes(T)&&s.push(T),T.resolve&&Mt(c.events,B,c.events.length-B,T.resolve(c.events.slice(B),c)),T.resolveTo&&(c.events=T.resolveTo(c.events,c))}function E(){const T=_(),B=c.previous,O=c.currentConstruct,N=c.events.length,j=Array.from(o);return{from:N,restore:z};function z(){r=T,c.previous=B,c.currentConstruct=O,c.events.length=N,o=j,A()}}function A(){r.line in n&&r.column<2&&(r.column=n[r.line],r.offset+=n[r.line]-1)}}function Ly(i,e){const t=e.start._index,r=e.start._bufferIndex,n=e.end._index,s=e.end._bufferIndex;let l;if(t===n)l=[i[t].slice(r,s)];else{if(l=i.slice(t,n),r>-1){const o=l[0];typeof o=="string"?l[0]=o.slice(r):l.shift()}s>0&&l.push(i[n].slice(0,s))}return l}function Ty(i,e){let t=-1;const r=[];let n;for(;++t<i.length;){const s=i[t];let l;if(typeof s=="string")l=s;else switch(s){case-5:{l="\r";break}case-4:{l=`
`;break}case-3:{l=`\r
`;break}case-2:{l=e?" ":"	";break}case-1:{if(!e&&n)continue;l=" ";break}default:l=String.fromCharCode(s)}n=s===-2,r.push(l)}return r.join("")}function Ry(i){const r={constructs:Uf([Dy,...(i||{}).extensions||[]]),content:n(Kv),defined:[],document:n(Xv),flow:n(dy),lazy:{},string:n(gy),text:n(vy)};return r;function n(s){return l;function l(o){return My(r,s,o)}}}function By(i){for(;!Xf(i););return i}const rh=/[\0\t\n\r]/g;function Oy(){let i=1,e="",t=!0,r;return n;function n(s,l,o){const a=[];let c,u,h,f,d;for(s=e+(typeof s=="string"?s.toString():new TextDecoder(l||void 0).decode(s)),h=0,e="",t&&(s.charCodeAt(0)===65279&&h++,t=void 0);h<s.length;){if(rh.lastIndex=h,c=rh.exec(s),f=c&&c.index!==void 0?c.index:s.length,d=s.charCodeAt(f),!c){e=s.slice(h);break}if(d===10&&h===f&&r)a.push(-3),r=void 0;else switch(r&&(a.push(-5),r=void 0),h<f&&(a.push(s.slice(h,f)),i+=f-h),d){case 0:{a.push(65533),i++;break}case 9:{for(u=Math.ceil(i/4)*4,a.push(-2);i++<u;)a.push(-1);break}case 10:{a.push(-4),i=1;break}default:r=!0,i=1}h=f+1}return o&&(r&&a.push(-5),e&&a.push(e),a.push(null)),a}}const Py=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function Iy(i){return i.replace(Py,Ny)}function Ny(i,e,t){if(e)return e;if(t.charCodeAt(0)===35){const n=t.charCodeAt(1),s=n===120||n===88;return Vf(t.slice(s?2:1),s?16:10)}return Ba(t)||i}const td={}.hasOwnProperty;function Fy(i,e,t){return typeof e!="string"&&(t=e,e=void 0),Hy(t)(By(Ry(t).document().write(Oy()(i,e,!0))))}function Hy(i){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:s(vi),autolinkProtocol:E,autolinkEmail:E,atxHeading:s(De),blockQuote:s(W),characterEscape:E,characterReference:E,codeFenced:s(Q),codeFencedFenceInfo:l,codeFencedFenceMeta:l,codeIndented:s(Q,l),codeText:s(Y,l),codeTextData:E,data:E,codeFlowValue:E,definition:s(ge),definitionDestinationString:l,definitionLabelString:l,definitionTitleString:l,emphasis:s(Be),hardBreakEscape:s(Ue),hardBreakTrailing:s(Ue),htmlFlow:s(ce,l),htmlFlowData:E,htmlText:s(ce,l),htmlTextData:E,image:s(Ht),label:l,link:s(vi),listItem:s(Lt),listItemValue:f,listOrdered:s(_i,h),listUnordered:s(_i),paragraph:s(yi),reference:R,referenceString:l,resourceDestinationString:l,resourceTitleString:l,setextHeading:s(De),strong:s(Xe),thematicBreak:s(pt)},exit:{atxHeading:a(),atxHeadingSequence:S,autolink:a(),autolinkEmail:K,autolinkProtocol:L,blockQuote:a(),characterEscapeValue:A,characterReferenceMarkerHexadecimal:ie,characterReferenceMarkerNumeric:ie,characterReferenceValue:re,characterReference:P,codeFenced:a(p),codeFencedFence:y,codeFencedFenceInfo:d,codeFencedFenceMeta:_,codeFlowValue:A,codeIndented:a(m),codeText:a(j),codeTextData:A,data:A,definition:a(),definitionDestinationString:b,definitionLabelString:g,definitionTitleString:v,emphasis:a(),hardBreakEscape:a(B),hardBreakTrailing:a(B),htmlFlow:a(O),htmlFlowData:A,htmlText:a(N),htmlTextData:A,image:a($),label:M,labelText:q,lineEnding:T,link:a(z),listItem:a(),listOrdered:a(),listUnordered:a(),paragraph:a(),referenceString:X,resourceDestinationString:C,resourceTitleString:I,resource:F,setextHeading:a(w),setextHeadingLineSequence:k,setextHeadingText:x,strong:a(),thematicBreak:a()}};id(e,(i||{}).mdastExtensions||[]);const t={};return r;function r(U){let Z={type:"root",children:[]};const le={stack:[Z],tokenStack:[],config:e,enter:o,exit:c,buffer:l,resume:u,data:t},de=[];let _e=-1;for(;++_e<U.length;)if(U[_e][1].type==="listOrdered"||U[_e][1].type==="listUnordered")if(U[_e][0]==="enter")de.push(_e);else{const Ve=de.pop();_e=n(U,Ve,_e)}for(_e=-1;++_e<U.length;){const Ve=e[U[_e][0]];td.call(Ve,U[_e][1].type)&&Ve[U[_e][1].type].call(Object.assign({sliceSerialize:U[_e][2].sliceSerialize},le),U[_e][1])}if(le.tokenStack.length>0){const Ve=le.tokenStack[le.tokenStack.length-1];(Ve[1]||nh).call(le,void 0,Ve[0])}for(Z.position={start:xi(U.length>0?U[0][1].start:{line:1,column:1,offset:0}),end:xi(U.length>0?U[U.length-2][1].end:{line:1,column:1,offset:0})},_e=-1;++_e<e.transforms.length;)Z=e.transforms[_e](Z)||Z;return Z}function n(U,Z,le){let de=Z-1,_e=-1,Ve=!1,ke,at,ji,zi;for(;++de<=le;){const tt=U[de];switch(tt[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{tt[0]==="enter"?_e++:_e--,zi=void 0;break}case"lineEndingBlank":{tt[0]==="enter"&&(ke&&!zi&&!_e&&!ji&&(ji=de),zi=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:zi=void 0}if(!_e&&tt[0]==="enter"&&tt[1].type==="listItemPrefix"||_e===-1&&tt[0]==="exit"&&(tt[1].type==="listUnordered"||tt[1].type==="listOrdered")){if(ke){let ee=de;for(at=void 0;ee--;){const fe=U[ee];if(fe[1].type==="lineEnding"||fe[1].type==="lineEndingBlank"){if(fe[0]==="exit")continue;at&&(U[at][1].type="lineEndingBlank",Ve=!0),fe[1].type="lineEnding",at=ee}else if(!(fe[1].type==="linePrefix"||fe[1].type==="blockQuotePrefix"||fe[1].type==="blockQuotePrefixWhitespace"||fe[1].type==="blockQuoteMarker"||fe[1].type==="listItemIndent"))break}ji&&(!at||ji<at)&&(ke._spread=!0),ke.end=Object.assign({},at?U[at][1].start:tt[1].end),U.splice(at||de,0,["exit",ke,tt[2]]),de++,le++}if(tt[1].type==="listItemPrefix"){const ee={type:"listItem",_spread:!1,start:Object.assign({},tt[1].start),end:void 0};ke=ee,U.splice(de,0,["enter",ee,tt[2]]),de++,le++,ji=void 0,zi=!0}}}return U[Z][1]._spread=Ve,le}function s(U,Z){return le;function le(de){o.call(this,U(de),de),Z&&Z.call(this,de)}}function l(){this.stack.push({type:"fragment",children:[]})}function o(U,Z,le){this.stack[this.stack.length-1].children.push(U),this.stack.push(U),this.tokenStack.push([Z,le||void 0]),U.position={start:xi(Z.start),end:void 0}}function a(U){return Z;function Z(le){U&&U.call(this,le),c.call(this,le)}}function c(U,Z){const le=this.stack.pop(),de=this.tokenStack.pop();if(de)de[0].type!==U.type&&(Z?Z.call(this,U,de[0]):(de[1]||nh).call(this,U,de[0]));else throw new Error("Cannot close `"+U.type+"` ("+Qr({start:U.start,end:U.end})+"): its not open");le.position.end=xi(U.end)}function u(){return Ra(this.stack.pop())}function h(){this.data.expectingFirstListItemValue=!0}function f(U){if(this.data.expectingFirstListItemValue){const Z=this.stack[this.stack.length-2];Z.start=Number.parseInt(this.sliceSerialize(U),10),this.data.expectingFirstListItemValue=void 0}}function d(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.lang=U}function _(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.meta=U}function y(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function p(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.value=U.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function m(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.value=U.replace(/(\r?\n|\r)$/g,"")}function g(U){const Z=this.resume(),le=this.stack[this.stack.length-1];le.label=Z,le.identifier=$t(this.sliceSerialize(U)).toLowerCase()}function v(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.title=U}function b(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.url=U}function S(U){const Z=this.stack[this.stack.length-1];if(!Z.depth){const le=this.sliceSerialize(U).length;Z.depth=le}}function x(){this.data.setextHeadingSlurpLineEnding=!0}function k(U){const Z=this.stack[this.stack.length-1];Z.depth=this.sliceSerialize(U).codePointAt(0)===61?1:2}function w(){this.data.setextHeadingSlurpLineEnding=void 0}function E(U){const le=this.stack[this.stack.length-1].children;let de=le[le.length-1];(!de||de.type!=="text")&&(de=ai(),de.position={start:xi(U.start),end:void 0},le.push(de)),this.stack.push(de)}function A(U){const Z=this.stack.pop();Z.value+=this.sliceSerialize(U),Z.position.end=xi(U.end)}function T(U){const Z=this.stack[this.stack.length-1];if(this.data.atHardBreak){const le=Z.children[Z.children.length-1];le.position.end=xi(U.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(Z.type)&&(E.call(this,U),A.call(this,U))}function B(){this.data.atHardBreak=!0}function O(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.value=U}function N(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.value=U}function j(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.value=U}function z(){const U=this.stack[this.stack.length-1];if(this.data.inReference){const Z=this.data.referenceType||"shortcut";U.type+="Reference",U.referenceType=Z,delete U.url,delete U.title}else delete U.identifier,delete U.label;this.data.referenceType=void 0}function $(){const U=this.stack[this.stack.length-1];if(this.data.inReference){const Z=this.data.referenceType||"shortcut";U.type+="Reference",U.referenceType=Z,delete U.url,delete U.title}else delete U.identifier,delete U.label;this.data.referenceType=void 0}function q(U){const Z=this.sliceSerialize(U),le=this.stack[this.stack.length-2];le.label=Iy(Z),le.identifier=$t(Z).toLowerCase()}function M(){const U=this.stack[this.stack.length-1],Z=this.resume(),le=this.stack[this.stack.length-1];if(this.data.inReference=!0,le.type==="link"){const de=U.children;le.children=de}else le.alt=Z}function C(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.url=U}function I(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.title=U}function F(){this.data.inReference=void 0}function R(){this.data.referenceType="collapsed"}function X(U){const Z=this.resume(),le=this.stack[this.stack.length-1];le.label=Z,le.identifier=$t(this.sliceSerialize(U)).toLowerCase(),this.data.referenceType="full"}function ie(U){this.data.characterReferenceType=U.type}function re(U){const Z=this.sliceSerialize(U),le=this.data.characterReferenceType;let de;le?(de=Vf(Z,le==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):de=Ba(Z);const _e=this.stack[this.stack.length-1];_e.value+=de}function P(U){const Z=this.stack.pop();Z.position.end=xi(U.end)}function L(U){A.call(this,U);const Z=this.stack[this.stack.length-1];Z.url=this.sliceSerialize(U)}function K(U){A.call(this,U);const Z=this.stack[this.stack.length-1];Z.url="mailto:"+this.sliceSerialize(U)}function W(){return{type:"blockquote",children:[]}}function Q(){return{type:"code",lang:null,meta:null,value:""}}function Y(){return{type:"inlineCode",value:""}}function ge(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Be(){return{type:"emphasis",children:[]}}function De(){return{type:"heading",depth:0,children:[]}}function Ue(){return{type:"break"}}function ce(){return{type:"html",value:""}}function Ht(){return{type:"image",title:null,url:"",alt:null}}function vi(){return{type:"link",title:null,url:"",children:[]}}function _i(U){return{type:"list",ordered:U.type==="listOrdered",start:null,spread:U._spread,children:[]}}function Lt(U){return{type:"listItem",spread:U._spread,checked:null,children:[]}}function yi(){return{type:"paragraph",children:[]}}function Xe(){return{type:"strong",children:[]}}function ai(){return{type:"text",value:""}}function pt(){return{type:"thematicBreak"}}}function xi(i){return{line:i.line,column:i.column,offset:i.offset}}function id(i,e){let t=-1;for(;++t<e.length;){const r=e[t];Array.isArray(r)?id(i,r):jy(i,r)}}function jy(i,e){let t;for(t in e)if(td.call(e,t))switch(t){case"canContainEols":{const r=e[t];r&&i[t].push(...r);break}case"transforms":{const r=e[t];r&&i[t].push(...r);break}case"enter":case"exit":{const r=e[t];r&&Object.assign(i[t],r);break}}}function nh(i,e){throw i?new Error("Cannot close `"+i.type+"` ("+Qr({start:i.start,end:i.end})+"): a different token (`"+e.type+"`, "+Qr({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+Qr({start:e.start,end:e.end})+") is still open")}function zy(i){const e=this;e.parser=t;function t(r){return Fy(r,{...e.data("settings"),...i,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function Wy(i,e){const t={type:"element",tagName:"blockquote",properties:{},children:i.wrap(i.all(e),!0)};return i.patch(e,t),i.applyData(e,t)}function $y(i,e){const t={type:"element",tagName:"br",properties:{},children:[]};return i.patch(e,t),[i.applyData(e,t),{type:"text",value:`
`}]}function Uy(i,e){const t=e.value?e.value+`
`:"",r={},n=e.lang?e.lang.split(/\s+/):[];n.length>0&&(r.className=["language-"+n[0]]);let s={type:"element",tagName:"code",properties:r,children:[{type:"text",value:t}]};return e.meta&&(s.data={meta:e.meta}),i.patch(e,s),s=i.applyData(e,s),s={type:"element",tagName:"pre",properties:{},children:[s]},i.patch(e,s),s}function Vy(i,e){const t={type:"element",tagName:"del",properties:{},children:i.all(e)};return i.patch(e,t),i.applyData(e,t)}function qy(i,e){const t={type:"element",tagName:"em",properties:{},children:i.all(e)};return i.patch(e,t),i.applyData(e,t)}function Ky(i,e){const t=typeof i.options.clobberPrefix=="string"?i.options.clobberPrefix:"user-content-",r=String(e.identifier).toUpperCase(),n=Pr(r.toLowerCase()),s=i.footnoteOrder.indexOf(r);let l,o=i.footnoteCounts.get(r);o===void 0?(o=0,i.footnoteOrder.push(r),l=i.footnoteOrder.length):l=s+1,o+=1,i.footnoteCounts.set(r,o);const a={type:"element",tagName:"a",properties:{href:"#"+t+"fn-"+n,id:t+"fnref-"+n+(o>1?"-"+o:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(l)}]};i.patch(e,a);const c={type:"element",tagName:"sup",properties:{},children:[a]};return i.patch(e,c),i.applyData(e,c)}function Gy(i,e){const t={type:"element",tagName:"h"+e.depth,properties:{},children:i.all(e)};return i.patch(e,t),i.applyData(e,t)}function Xy(i,e){if(i.options.allowDangerousHtml){const t={type:"raw",value:e.value};return i.patch(e,t),i.applyData(e,t)}}function rd(i,e){const t=e.referenceType;let r="]";if(t==="collapsed"?r+="[]":t==="full"&&(r+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+r}];const n=i.all(e),s=n[0];s&&s.type==="text"?s.value="["+s.value:n.unshift({type:"text",value:"["});const l=n[n.length-1];return l&&l.type==="text"?l.value+=r:n.push({type:"text",value:r}),n}function Jy(i,e){const t=String(e.identifier).toUpperCase(),r=i.definitionById.get(t);if(!r)return rd(i,e);const n={src:Pr(r.url||""),alt:e.alt};r.title!==null&&r.title!==void 0&&(n.title=r.title);const s={type:"element",tagName:"img",properties:n,children:[]};return i.patch(e,s),i.applyData(e,s)}function Yy(i,e){const t={src:Pr(e.url)};e.alt!==null&&e.alt!==void 0&&(t.alt=e.alt),e.title!==null&&e.title!==void 0&&(t.title=e.title);const r={type:"element",tagName:"img",properties:t,children:[]};return i.patch(e,r),i.applyData(e,r)}function Qy(i,e){const t={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};i.patch(e,t);const r={type:"element",tagName:"code",properties:{},children:[t]};return i.patch(e,r),i.applyData(e,r)}function Zy(i,e){const t=String(e.identifier).toUpperCase(),r=i.definitionById.get(t);if(!r)return rd(i,e);const n={href:Pr(r.url||"")};r.title!==null&&r.title!==void 0&&(n.title=r.title);const s={type:"element",tagName:"a",properties:n,children:i.all(e)};return i.patch(e,s),i.applyData(e,s)}function eb(i,e){const t={href:Pr(e.url)};e.title!==null&&e.title!==void 0&&(t.title=e.title);const r={type:"element",tagName:"a",properties:t,children:i.all(e)};return i.patch(e,r),i.applyData(e,r)}function tb(i,e,t){const r=i.all(e),n=t?ib(t):nd(e),s={},l=[];if(typeof e.checked=="boolean"){const u=r[0];let h;u&&u.type==="element"&&u.tagName==="p"?h=u:(h={type:"element",tagName:"p",properties:{},children:[]},r.unshift(h)),h.children.length>0&&h.children.unshift({type:"text",value:" "}),h.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),s.className=["task-list-item"]}let o=-1;for(;++o<r.length;){const u=r[o];(n||o!==0||u.type!=="element"||u.tagName!=="p")&&l.push({type:"text",value:`
`}),u.type==="element"&&u.tagName==="p"&&!n?l.push(...u.children):l.push(u)}const a=r[r.length-1];a&&(n||a.type!=="element"||a.tagName!=="p")&&l.push({type:"text",value:`
`});const c={type:"element",tagName:"li",properties:s,children:l};return i.patch(e,c),i.applyData(e,c)}function ib(i){let e=!1;if(i.type==="list"){e=i.spread||!1;const t=i.children;let r=-1;for(;!e&&++r<t.length;)e=nd(t[r])}return e}function nd(i){const e=i.spread;return e??i.children.length>1}function rb(i,e){const t={},r=i.all(e);let n=-1;for(typeof e.start=="number"&&e.start!==1&&(t.start=e.start);++n<r.length;){const l=r[n];if(l.type==="element"&&l.tagName==="li"&&l.properties&&Array.isArray(l.properties.className)&&l.properties.className.includes("task-list-item")){t.className=["contains-task-list"];break}}const s={type:"element",tagName:e.ordered?"ol":"ul",properties:t,children:i.wrap(r,!0)};return i.patch(e,s),i.applyData(e,s)}function nb(i,e){const t={type:"element",tagName:"p",properties:{},children:i.all(e)};return i.patch(e,t),i.applyData(e,t)}function sb(i,e){const t={type:"root",children:i.wrap(i.all(e))};return i.patch(e,t),i.applyData(e,t)}function ob(i,e){const t={type:"element",tagName:"strong",properties:{},children:i.all(e)};return i.patch(e,t),i.applyData(e,t)}function lb(i,e){const t=i.all(e),r=t.shift(),n=[];if(r){const l={type:"element",tagName:"thead",properties:{},children:i.wrap([r],!0)};i.patch(e.children[0],l),n.push(l)}if(t.length>0){const l={type:"element",tagName:"tbody",properties:{},children:i.wrap(t,!0)},o=Da(e.children[1]),a=Nf(e.children[e.children.length-1]);o&&a&&(l.position={start:o,end:a}),n.push(l)}const s={type:"element",tagName:"table",properties:{},children:i.wrap(n,!0)};return i.patch(e,s),i.applyData(e,s)}function ab(i,e,t){const r=t?t.children:void 0,s=(r?r.indexOf(e):1)===0?"th":"td",l=t&&t.type==="table"?t.align:void 0,o=l?l.length:e.children.length;let a=-1;const c=[];for(;++a<o;){const h=e.children[a],f={},d=l?l[a]:void 0;d&&(f.align=d);let _={type:"element",tagName:s,properties:f,children:[]};h&&(_.children=i.all(h),i.patch(h,_),_=i.applyData(h,_)),c.push(_)}const u={type:"element",tagName:"tr",properties:{},children:i.wrap(c,!0)};return i.patch(e,u),i.applyData(e,u)}function cb(i,e){const t={type:"element",tagName:"td",properties:{},children:i.all(e)};return i.patch(e,t),i.applyData(e,t)}const sh=9,oh=32;function hb(i){const e=String(i),t=/\r?\n|\r/g;let r=t.exec(e),n=0;const s=[];for(;r;)s.push(lh(e.slice(n,r.index),n>0,!0),r[0]),n=r.index+r[0].length,r=t.exec(e);return s.push(lh(e.slice(n),n>0,!1)),s.join("")}function lh(i,e,t){let r=0,n=i.length;if(e){let s=i.codePointAt(r);for(;s===sh||s===oh;)r++,s=i.codePointAt(r)}if(t){let s=i.codePointAt(n-1);for(;s===sh||s===oh;)n--,s=i.codePointAt(n-1)}return n>r?i.slice(r,n):""}function ub(i,e){const t={type:"text",value:hb(String(e.value))};return i.patch(e,t),i.applyData(e,t)}function fb(i,e){const t={type:"element",tagName:"hr",properties:{},children:[]};return i.patch(e,t),i.applyData(e,t)}const db={blockquote:Wy,break:$y,code:Uy,delete:Vy,emphasis:qy,footnoteReference:Ky,heading:Gy,html:Xy,imageReference:Jy,image:Yy,inlineCode:Qy,linkReference:Zy,link:eb,listItem:tb,list:rb,paragraph:nb,root:sb,strong:ob,table:lb,tableCell:cb,tableRow:ab,text:ub,thematicBreak:fb,toml:Hn,yaml:Hn,definition:Hn,footnoteDefinition:Hn};function Hn(){}const sd=-1,eo=0,en=1,Ss=2,Pa=3,Ia=4,Na=5,Fa=6,od=7,ld=8,ah=typeof self=="object"?self:globalThis,pb=(i,e)=>{const t=(n,s)=>(i.set(s,n),n),r=n=>{if(i.has(n))return i.get(n);const[s,l]=e[n];switch(s){case eo:case sd:return t(l,n);case en:{const o=t([],n);for(const a of l)o.push(r(a));return o}case Ss:{const o=t({},n);for(const[a,c]of l)o[r(a)]=r(c);return o}case Pa:return t(new Date(l),n);case Ia:{const{source:o,flags:a}=l;return t(new RegExp(o,a),n)}case Na:{const o=t(new Map,n);for(const[a,c]of l)o.set(r(a),r(c));return o}case Fa:{const o=t(new Set,n);for(const a of l)o.add(r(a));return o}case od:{const{name:o,message:a}=l;return t(new ah[o](a),n)}case ld:return t(BigInt(l),n);case"BigInt":return t(Object(BigInt(l)),n);case"ArrayBuffer":return t(new Uint8Array(l).buffer,l);case"DataView":{const{buffer:o}=new Uint8Array(l);return t(new DataView(o),l)}}return t(new ah[s](l),n)};return r},ch=i=>pb(new Map,i)(0),or="",{toString:mb}={},{keys:gb}=Object,$r=i=>{const e=typeof i;if(e!=="object"||!i)return[eo,e];const t=mb.call(i).slice(8,-1);switch(t){case"Array":return[en,or];case"Object":return[Ss,or];case"Date":return[Pa,or];case"RegExp":return[Ia,or];case"Map":return[Na,or];case"Set":return[Fa,or];case"DataView":return[en,t]}return t.includes("Array")?[en,t]:t.includes("Error")?[od,t]:[Ss,t]},jn=([i,e])=>i===eo&&(e==="function"||e==="symbol"),vb=(i,e,t,r)=>{const n=(l,o)=>{const a=r.push(l)-1;return t.set(o,a),a},s=l=>{if(t.has(l))return t.get(l);let[o,a]=$r(l);switch(o){case eo:{let u=l;switch(a){case"bigint":o=ld,u=l.toString();break;case"function":case"symbol":if(i)throw new TypeError("unable to serialize "+a);u=null;break;case"undefined":return n([sd],l)}return n([o,u],l)}case en:{if(a){let f=l;return a==="DataView"?f=new Uint8Array(l.buffer):a==="ArrayBuffer"&&(f=new Uint8Array(l)),n([a,[...f]],l)}const u=[],h=n([o,u],l);for(const f of l)u.push(s(f));return h}case Ss:{if(a)switch(a){case"BigInt":return n([a,l.toString()],l);case"Boolean":case"Number":case"String":return n([a,l.valueOf()],l)}if(e&&"toJSON"in l)return s(l.toJSON());const u=[],h=n([o,u],l);for(const f of gb(l))(i||!jn($r(l[f])))&&u.push([s(f),s(l[f])]);return h}case Pa:return n([o,l.toISOString()],l);case Ia:{const{source:u,flags:h}=l;return n([o,{source:u,flags:h}],l)}case Na:{const u=[],h=n([o,u],l);for(const[f,d]of l)(i||!(jn($r(f))||jn($r(d))))&&u.push([s(f),s(d)]);return h}case Fa:{const u=[],h=n([o,u],l);for(const f of l)(i||!jn($r(f)))&&u.push(s(f));return h}}const{message:c}=l;return n([o,{name:a,message:c}],l)};return s},hh=(i,{json:e,lossy:t}={})=>{const r=[];return vb(!(e||t),!!e,new Map,r)(i),r},ks=typeof structuredClone=="function"?(i,e)=>e&&("json"in e||"lossy"in e)?ch(hh(i,e)):structuredClone(i):(i,e)=>ch(hh(i,e));function _b(i,e){const t=[{type:"text",value:""}];return e>1&&t.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),t}function yb(i,e){return"Back to reference "+(i+1)+(e>1?"-"+e:"")}function bb(i){const e=typeof i.options.clobberPrefix=="string"?i.options.clobberPrefix:"user-content-",t=i.options.footnoteBackContent||_b,r=i.options.footnoteBackLabel||yb,n=i.options.footnoteLabel||"Footnotes",s=i.options.footnoteLabelTagName||"h2",l=i.options.footnoteLabelProperties||{className:["sr-only"]},o=[];let a=-1;for(;++a<i.footnoteOrder.length;){const c=i.footnoteById.get(i.footnoteOrder[a]);if(!c)continue;const u=i.all(c),h=String(c.identifier).toUpperCase(),f=Pr(h.toLowerCase());let d=0;const _=[],y=i.footnoteCounts.get(h);for(;y!==void 0&&++d<=y;){_.length>0&&_.push({type:"text",value:" "});let g=typeof t=="string"?t:t(a,d);typeof g=="string"&&(g={type:"text",value:g}),_.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+f+(d>1?"-"+d:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(a,d),className:["data-footnote-backref"]},children:Array.isArray(g)?g:[g]})}const p=u[u.length-1];if(p&&p.type==="element"&&p.tagName==="p"){const g=p.children[p.children.length-1];g&&g.type==="text"?g.value+=" ":p.children.push({type:"text",value:" "}),p.children.push(..._)}else u.push(..._);const m={type:"element",tagName:"li",properties:{id:e+"fn-"+f},children:i.wrap(u,!0)};i.patch(c,m),o.push(m)}if(o.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:s,properties:{...ks(l),id:"footnote-label"},children:[{type:"text",value:n}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:i.wrap(o,!0)},{type:"text",value:`
`}]}}const to=(function(i){if(i==null)return kb;if(typeof i=="function")return io(i);if(typeof i=="object")return Array.isArray(i)?xb(i):wb(i);if(typeof i=="string")return Sb(i);throw new Error("Expected function, string, or object as test")});function xb(i){const e=[];let t=-1;for(;++t<i.length;)e[t]=to(i[t]);return io(r);function r(...n){let s=-1;for(;++s<e.length;)if(e[s].apply(this,n))return!0;return!1}}function wb(i){const e=i;return io(t);function t(r){const n=r;let s;for(s in i)if(n[s]!==e[s])return!1;return!0}}function Sb(i){return io(e);function e(t){return t&&t.type===i}}function io(i){return e;function e(t,r,n){return!!(Cb(t)&&i.call(this,t,typeof r=="number"?r:void 0,n||void 0))}}function kb(){return!0}function Cb(i){return i!==null&&typeof i=="object"&&"type"in i}const ad=[],Eb=!0,Al=!1,Ab="skip";function cd(i,e,t,r){let n;typeof e=="function"&&typeof t!="function"?(r=t,t=e):n=e;const s=to(n),l=r?-1:1;o(i,void 0,[])();function o(a,c,u){const h=a&&typeof a=="object"?a:{};if(typeof h.type=="string"){const d=typeof h.tagName=="string"?h.tagName:typeof h.name=="string"?h.name:void 0;Object.defineProperty(f,"name",{value:"node ("+(a.type+(d?"<"+d+">":""))+")"})}return f;function f(){let d=ad,_,y,p;if((!e||s(a,c,u[u.length-1]||void 0))&&(d=Db(t(a,u)),d[0]===Al))return d;if("children"in a&&a.children){const m=a;if(m.children&&d[0]!==Ab)for(y=(r?m.children.length:-1)+l,p=u.concat(m);y>-1&&y<m.children.length;){const g=m.children[y];if(_=o(g,y,p)(),_[0]===Al)return _;y=typeof _[1]=="number"?_[1]:y+l}}return d}}}function Db(i){return Array.isArray(i)?i:typeof i=="number"?[Eb,i]:i==null?ad:[i]}function Ha(i,e,t,r){let n,s,l;typeof e=="function"&&typeof t!="function"?(s=void 0,l=e,n=t):(s=e,l=t,n=r),cd(i,s,o,n);function o(a,c){const u=c[c.length-1],h=u?u.children.indexOf(a):void 0;return l(a,h,u)}}const Dl={}.hasOwnProperty,Mb={};function Lb(i,e){const t=e||Mb,r=new Map,n=new Map,s=new Map,l={...db,...t.handlers},o={all:c,applyData:Rb,definitionById:r,footnoteById:n,footnoteCounts:s,footnoteOrder:[],handlers:l,one:a,options:t,patch:Tb,wrap:Ob};return Ha(i,function(u){if(u.type==="definition"||u.type==="footnoteDefinition"){const h=u.type==="definition"?r:n,f=String(u.identifier).toUpperCase();h.has(f)||h.set(f,u)}}),o;function a(u,h){const f=u.type,d=o.handlers[f];if(Dl.call(o.handlers,f)&&d)return d(o,u,h);if(o.options.passThrough&&o.options.passThrough.includes(f)){if("children"in u){const{children:y,...p}=u,m=ks(p);return m.children=o.all(u),m}return ks(u)}return(o.options.unknownHandler||Bb)(o,u,h)}function c(u){const h=[];if("children"in u){const f=u.children;let d=-1;for(;++d<f.length;){const _=o.one(f[d],u);if(_){if(d&&f[d-1].type==="break"&&(!Array.isArray(_)&&_.type==="text"&&(_.value=uh(_.value)),!Array.isArray(_)&&_.type==="element")){const y=_.children[0];y&&y.type==="text"&&(y.value=uh(y.value))}Array.isArray(_)?h.push(..._):h.push(_)}}}return h}}function Tb(i,e){i.position&&(e.position=yv(i))}function Rb(i,e){let t=e;if(i&&i.data){const r=i.data.hName,n=i.data.hChildren,s=i.data.hProperties;if(typeof r=="string")if(t.type==="element")t.tagName=r;else{const l="children"in t?t.children:[t];t={type:"element",tagName:r,properties:{},children:l}}t.type==="element"&&s&&Object.assign(t.properties,ks(s)),"children"in t&&t.children&&n!==null&&n!==void 0&&(t.children=n)}return t}function Bb(i,e){const t=e.data||{},r="value"in e&&!(Dl.call(t,"hProperties")||Dl.call(t,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:i.all(e)};return i.patch(e,r),i.applyData(e,r)}function Ob(i,e){const t=[];let r=-1;for(e&&t.push({type:"text",value:`
`});++r<i.length;)r&&t.push({type:"text",value:`
`}),t.push(i[r]);return e&&i.length>0&&t.push({type:"text",value:`
`}),t}function uh(i){let e=0,t=i.charCodeAt(e);for(;t===9||t===32;)e++,t=i.charCodeAt(e);return i.slice(e)}function fh(i,e){const t=Lb(i,e),r=t.one(i,void 0),n=bb(t),s=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return n&&s.children.push({type:"text",value:`
`},n),s}function Pb(i,e){return i&&"run"in i?async function(t,r){const n=fh(t,{file:r,...e});await i.run(n,r)}:function(t,r){return fh(t,{file:r,...i||e})}}function dh(i){if(i)throw i}var Ao,ph;function Ib(){if(ph)return Ao;ph=1;var i=Object.prototype.hasOwnProperty,e=Object.prototype.toString,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=function(c){return typeof Array.isArray=="function"?Array.isArray(c):e.call(c)==="[object Array]"},s=function(c){if(!c||e.call(c)!=="[object Object]")return!1;var u=i.call(c,"constructor"),h=c.constructor&&c.constructor.prototype&&i.call(c.constructor.prototype,"isPrototypeOf");if(c.constructor&&!u&&!h)return!1;var f;for(f in c);return typeof f>"u"||i.call(c,f)},l=function(c,u){t&&u.name==="__proto__"?t(c,u.name,{enumerable:!0,configurable:!0,value:u.newValue,writable:!0}):c[u.name]=u.newValue},o=function(c,u){if(u==="__proto__")if(i.call(c,u)){if(r)return r(c,u).value}else return;return c[u]};return Ao=function a(){var c,u,h,f,d,_,y=arguments[0],p=1,m=arguments.length,g=!1;for(typeof y=="boolean"&&(g=y,y=arguments[1]||{},p=2),(y==null||typeof y!="object"&&typeof y!="function")&&(y={});p<m;++p)if(c=arguments[p],c!=null)for(u in c)h=o(y,u),f=o(c,u),y!==f&&(g&&f&&(s(f)||(d=n(f)))?(d?(d=!1,_=h&&n(h)?h:[]):_=h&&s(h)?h:{},l(y,{name:u,newValue:a(g,_,f)})):typeof f<"u"&&l(y,{name:u,newValue:f}));return y},Ao}var Nb=Ib();const Do=wf(Nb);function Ml(i){if(typeof i!="object"||i===null)return!1;const e=Object.getPrototypeOf(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)}function Fb(){const i=[],e={run:t,use:r};return e;function t(...n){let s=-1;const l=n.pop();if(typeof l!="function")throw new TypeError("Expected function as last argument, not "+l);o(null,...n);function o(a,...c){const u=i[++s];let h=-1;if(a){l(a);return}for(;++h<n.length;)(c[h]===null||c[h]===void 0)&&(c[h]=n[h]);n=c,u?Hb(u,o)(...c):l(null,...c)}}function r(n){if(typeof n!="function")throw new TypeError("Expected `middelware` to be a function, not "+n);return i.push(n),e}}function Hb(i,e){let t;return r;function r(...l){const o=i.length>l.length;let a;o&&l.push(n);try{a=i.apply(this,l)}catch(c){const u=c;if(o&&t)throw u;return n(u)}o||(a&&a.then&&typeof a.then=="function"?a.then(s,n):a instanceof Error?n(a):s(a))}function n(l,...o){t||(t=!0,e(l,...o))}function s(l){n(null,l)}}const Zt={basename:jb,dirname:zb,extname:Wb,join:$b,sep:"/"};function jb(i,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');Ln(i);let t=0,r=-1,n=i.length,s;if(e===void 0||e.length===0||e.length>i.length){for(;n--;)if(i.codePointAt(n)===47){if(s){t=n+1;break}}else r<0&&(s=!0,r=n+1);return r<0?"":i.slice(t,r)}if(e===i)return"";let l=-1,o=e.length-1;for(;n--;)if(i.codePointAt(n)===47){if(s){t=n+1;break}}else l<0&&(s=!0,l=n+1),o>-1&&(i.codePointAt(n)===e.codePointAt(o--)?o<0&&(r=n):(o=-1,r=l));return t===r?r=l:r<0&&(r=i.length),i.slice(t,r)}function zb(i){if(Ln(i),i.length===0)return".";let e=-1,t=i.length,r;for(;--t;)if(i.codePointAt(t)===47){if(r){e=t;break}}else r||(r=!0);return e<0?i.codePointAt(0)===47?"/":".":e===1&&i.codePointAt(0)===47?"//":i.slice(0,e)}function Wb(i){Ln(i);let e=i.length,t=-1,r=0,n=-1,s=0,l;for(;e--;){const o=i.codePointAt(e);if(o===47){if(l){r=e+1;break}continue}t<0&&(l=!0,t=e+1),o===46?n<0?n=e:s!==1&&(s=1):n>-1&&(s=-1)}return n<0||t<0||s===0||s===1&&n===t-1&&n===r+1?"":i.slice(n,t)}function $b(...i){let e=-1,t;for(;++e<i.length;)Ln(i[e]),i[e]&&(t=t===void 0?i[e]:t+"/"+i[e]);return t===void 0?".":Ub(t)}function Ub(i){Ln(i);const e=i.codePointAt(0)===47;let t=Vb(i,!e);return t.length===0&&!e&&(t="."),t.length>0&&i.codePointAt(i.length-1)===47&&(t+="/"),e?"/"+t:t}function Vb(i,e){let t="",r=0,n=-1,s=0,l=-1,o,a;for(;++l<=i.length;){if(l<i.length)o=i.codePointAt(l);else{if(o===47)break;o=47}if(o===47){if(!(n===l-1||s===1))if(n!==l-1&&s===2){if(t.length<2||r!==2||t.codePointAt(t.length-1)!==46||t.codePointAt(t.length-2)!==46){if(t.length>2){if(a=t.lastIndexOf("/"),a!==t.length-1){a<0?(t="",r=0):(t=t.slice(0,a),r=t.length-1-t.lastIndexOf("/")),n=l,s=0;continue}}else if(t.length>0){t="",r=0,n=l,s=0;continue}}e&&(t=t.length>0?t+"/..":"..",r=2)}else t.length>0?t+="/"+i.slice(n+1,l):t=i.slice(n+1,l),r=l-n-1;n=l,s=0}else o===46&&s>-1?s++:s=-1}return t}function Ln(i){if(typeof i!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(i))}const qb={cwd:Kb};function Kb(){return"/"}function Ll(i){return!!(i!==null&&typeof i=="object"&&"href"in i&&i.href&&"protocol"in i&&i.protocol&&i.auth===void 0)}function Gb(i){if(typeof i=="string")i=new URL(i);else if(!Ll(i)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+i+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(i.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return Xb(i)}function Xb(i){if(i.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=i.pathname;let t=-1;for(;++t<e.length;)if(e.codePointAt(t)===37&&e.codePointAt(t+1)===50){const r=e.codePointAt(t+2);if(r===70||r===102){const n=new TypeError("File URL path must not include encoded / characters");throw n.code="ERR_INVALID_FILE_URL_PATH",n}}return decodeURIComponent(e)}const Mo=["history","path","basename","stem","extname","dirname"];class hd{constructor(e){let t;e?Ll(e)?t={path:e}:typeof e=="string"||Jb(e)?t={value:e}:t=e:t={},this.cwd="cwd"in t?"":qb.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<Mo.length;){const s=Mo[r];s in t&&t[s]!==void 0&&t[s]!==null&&(this[s]=s==="history"?[...t[s]]:t[s])}let n;for(n in t)Mo.includes(n)||(this[n]=t[n])}get basename(){return typeof this.path=="string"?Zt.basename(this.path):void 0}set basename(e){To(e,"basename"),Lo(e,"basename"),this.path=Zt.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?Zt.dirname(this.path):void 0}set dirname(e){mh(this.basename,"dirname"),this.path=Zt.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?Zt.extname(this.path):void 0}set extname(e){if(Lo(e,"extname"),mh(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Zt.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){Ll(e)&&(e=Gb(e)),To(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?Zt.basename(this.path,this.extname):void 0}set stem(e){To(e,"stem"),Lo(e,"stem"),this.path=Zt.join(this.dirname||"",e+(this.extname||""))}fail(e,t,r){const n=this.message(e,t,r);throw n.fatal=!0,n}info(e,t,r){const n=this.message(e,t,r);return n.fatal=void 0,n}message(e,t,r){const n=new ot(e,t,r);return this.path&&(n.name=this.path+":"+n.name,n.file=this.path),n.fatal=!1,this.messages.push(n),n}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function Lo(i,e){if(i&&i.includes(Zt.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+Zt.sep+"`")}function To(i,e){if(!i)throw new Error("`"+e+"` cannot be empty")}function mh(i,e){if(!i)throw new Error("Setting `"+e+"` requires `path` to be set too")}function Jb(i){return!!(i&&typeof i=="object"&&"byteLength"in i&&"byteOffset"in i)}const Yb=(function(i){const r=this.constructor.prototype,n=r[i],s=function(){return n.apply(s,arguments)};return Object.setPrototypeOf(s,r),s}),Qb={}.hasOwnProperty;class ja extends Yb{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=Fb()}copy(){const e=new ja;let t=-1;for(;++t<this.attachers.length;){const r=this.attachers[t];e.use(...r)}return e.data(Do(!0,{},this.namespace)),e}data(e,t){return typeof e=="string"?arguments.length===2?(Oo("data",this.frozen),this.namespace[e]=t,this):Qb.call(this.namespace,e)&&this.namespace[e]||void 0:e?(Oo("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[t,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const n=t.call(e,...r);typeof n=="function"&&this.transformers.use(n)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const t=zn(e),r=this.parser||this.Parser;return Ro("parse",r),r(String(t),t)}process(e,t){const r=this;return this.freeze(),Ro("process",this.parser||this.Parser),Bo("process",this.compiler||this.Compiler),t?n(void 0,t):new Promise(n);function n(s,l){const o=zn(e),a=r.parse(o);r.run(a,o,function(u,h,f){if(u||!h||!f)return c(u);const d=h,_=r.stringify(d,f);t1(_)?f.value=_:f.result=_,c(u,f)});function c(u,h){u||!h?l(u):s?s(h):t(void 0,h)}}}processSync(e){let t=!1,r;return this.freeze(),Ro("processSync",this.parser||this.Parser),Bo("processSync",this.compiler||this.Compiler),this.process(e,n),vh("processSync","process",t),r;function n(s,l){t=!0,dh(s),r=l}}run(e,t,r){gh(e),this.freeze();const n=this.transformers;return!r&&typeof t=="function"&&(r=t,t=void 0),r?s(void 0,r):new Promise(s);function s(l,o){const a=zn(t);n.run(e,a,c);function c(u,h,f){const d=h||e;u?o(u):l?l(d):r(void 0,d,f)}}}runSync(e,t){let r=!1,n;return this.run(e,t,s),vh("runSync","run",r),n;function s(l,o){dh(l),n=o,r=!0}}stringify(e,t){this.freeze();const r=zn(t),n=this.compiler||this.Compiler;return Bo("stringify",n),gh(e),n(e,r)}use(e,...t){const r=this.attachers,n=this.namespace;if(Oo("use",this.frozen),e!=null)if(typeof e=="function")a(e,t);else if(typeof e=="object")Array.isArray(e)?o(e):l(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function s(c){if(typeof c=="function")a(c,[]);else if(typeof c=="object")if(Array.isArray(c)){const[u,...h]=c;a(u,h)}else l(c);else throw new TypeError("Expected usable value, not `"+c+"`")}function l(c){if(!("plugins"in c)&&!("settings"in c))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");o(c.plugins),c.settings&&(n.settings=Do(!0,n.settings,c.settings))}function o(c){let u=-1;if(c!=null)if(Array.isArray(c))for(;++u<c.length;){const h=c[u];s(h)}else throw new TypeError("Expected a list of plugins, not `"+c+"`")}function a(c,u){let h=-1,f=-1;for(;++h<r.length;)if(r[h][0]===c){f=h;break}if(f===-1)r.push([c,...u]);else if(u.length>0){let[d,..._]=u;const y=r[f][1];Ml(y)&&Ml(d)&&(d=Do(!0,y,d)),r[f]=[c,d,..._]}}}}const Zb=new ja().freeze();function Ro(i,e){if(typeof e!="function")throw new TypeError("Cannot `"+i+"` without `parser`")}function Bo(i,e){if(typeof e!="function")throw new TypeError("Cannot `"+i+"` without `compiler`")}function Oo(i,e){if(e)throw new Error("Cannot call `"+i+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function gh(i){if(!Ml(i)||typeof i.type!="string")throw new TypeError("Expected node, got `"+i+"`")}function vh(i,e,t){if(!t)throw new Error("`"+i+"` finished async. Use `"+e+"` instead")}function zn(i){return e1(i)?i:new hd(i)}function e1(i){return!!(i&&typeof i=="object"&&"message"in i&&"messages"in i)}function t1(i){return typeof i=="string"||i1(i)}function i1(i){return!!(i&&typeof i=="object"&&"byteLength"in i&&"byteOffset"in i)}const r1="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",_h=[],yh={allowDangerousHtml:!0},n1=/^(https?|ircs?|mailto|xmpp)$/i,s1=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function o1(i){const e=l1(i),t=a1(i);return c1(e.runSync(e.parse(t),t),i)}function l1(i){const e=i.rehypePlugins||_h,t=i.remarkPlugins||_h,r=i.remarkRehypeOptions?{...i.remarkRehypeOptions,...yh}:yh;return Zb().use(zy).use(t).use(Pb,r).use(e)}function a1(i){const e=i.children||"",t=new hd;return typeof e=="string"&&(t.value=e),t}function c1(i,e){const t=e.allowedElements,r=e.allowElement,n=e.components,s=e.disallowedElements,l=e.skipHtml,o=e.unwrapDisallowed,a=e.urlTransform||h1;for(const u of s1)Object.hasOwn(e,u.from)&&(""+u.from+(u.to?"use `"+u.to+"` instead":"remove it")+r1+u.id,void 0);return e.className&&(i={type:"element",tagName:"div",properties:{className:e.className},children:i.type==="root"?i.children:[i]}),Ha(i,c),kv(i,{Fragment:D.Fragment,components:n,ignoreInvalidStyle:!0,jsx:D.jsx,jsxs:D.jsxs,passKeys:!0,passNode:!0});function c(u,h,f){if(u.type==="raw"&&f&&typeof h=="number")return l?f.children.splice(h,1):f.children[h]={type:"text",value:u.value},h;if(u.type==="element"){let d;for(d in ko)if(Object.hasOwn(ko,d)&&Object.hasOwn(u.properties,d)){const _=u.properties[d],y=ko[d];(y===null||y.includes(u.tagName))&&(u.properties[d]=a(String(_||""),d,u))}}if(u.type==="element"){let d=t?!t.includes(u.tagName):s?s.includes(u.tagName):!1;if(!d&&r&&typeof h=="number"&&(d=!r(u,h,f)),d&&f&&typeof h=="number")return o&&u.children?f.children.splice(h,1,...u.children):f.children.splice(h,1),h}}}function h1(i){const e=i.indexOf(":"),t=i.indexOf("?"),r=i.indexOf("#"),n=i.indexOf("/");return e===-1||n!==-1&&e>n||t!==-1&&e>t||r!==-1&&e>r||n1.test(i.slice(0,e))?i:""}function bh(i,e){const t=String(i);if(typeof e!="string")throw new TypeError("Expected character");let r=0,n=t.indexOf(e);for(;n!==-1;)r++,n=t.indexOf(e,n+e.length);return r}function u1(i){if(typeof i!="string")throw new TypeError("Expected a string");return i.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function f1(i,e,t){const n=to((t||{}).ignore||[]),s=d1(e);let l=-1;for(;++l<s.length;)cd(i,"text",o);function o(c,u){let h=-1,f;for(;++h<u.length;){const d=u[h],_=f?f.children:void 0;if(n(d,_?_.indexOf(d):void 0,f))return;f=d}if(f)return a(c,u)}function a(c,u){const h=u[u.length-1],f=s[l][0],d=s[l][1];let _=0;const p=h.children.indexOf(c);let m=!1,g=[];f.lastIndex=0;let v=f.exec(c.value);for(;v;){const b=v.index,S={index:v.index,input:v.input,stack:[...u,c]};let x=d(...v,S);if(typeof x=="string"&&(x=x.length>0?{type:"text",value:x}:void 0),x===!1?f.lastIndex=b+1:(_!==b&&g.push({type:"text",value:c.value.slice(_,b)}),Array.isArray(x)?g.push(...x):x&&g.push(x),_=b+v[0].length,m=!0),!f.global)break;v=f.exec(c.value)}return m?(_<c.value.length&&g.push({type:"text",value:c.value.slice(_)}),h.children.splice(p,1,...g)):g=[c],p+g.length}}function d1(i){const e=[];if(!Array.isArray(i))throw new TypeError("Expected find and replace tuple or list of tuples");const t=!i[0]||Array.isArray(i[0])?i:[i];let r=-1;for(;++r<t.length;){const n=t[r];e.push([p1(n[0]),m1(n[1])])}return e}function p1(i){return typeof i=="string"?new RegExp(u1(i),"g"):i}function m1(i){return typeof i=="function"?i:function(){return i}}const Po="phrasing",Io=["autolink","link","image","label"];function g1(){return{transforms:[S1],enter:{literalAutolink:_1,literalAutolinkEmail:No,literalAutolinkHttp:No,literalAutolinkWww:No},exit:{literalAutolink:w1,literalAutolinkEmail:x1,literalAutolinkHttp:y1,literalAutolinkWww:b1}}}function v1(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:Po,notInConstruct:Io},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:Po,notInConstruct:Io},{character:":",before:"[ps]",after:"\\/",inConstruct:Po,notInConstruct:Io}]}}function _1(i){this.enter({type:"link",title:null,url:"",children:[]},i)}function No(i){this.config.enter.autolinkProtocol.call(this,i)}function y1(i){this.config.exit.autolinkProtocol.call(this,i)}function b1(i){this.config.exit.data.call(this,i);const e=this.stack[this.stack.length-1];e.type,e.url="http://"+this.sliceSerialize(i)}function x1(i){this.config.exit.autolinkEmail.call(this,i)}function w1(i){this.exit(i)}function S1(i){f1(i,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,k1],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),C1]],{ignore:["link","linkReference"]})}function k1(i,e,t,r,n){let s="";if(!ud(n)||(/^w/i.test(e)&&(t=e+t,e="",s="http://"),!E1(t)))return!1;const l=A1(t+r);if(!l[0])return!1;const o={type:"link",title:null,url:s+e+l[0],children:[{type:"text",value:e+l[0]}]};return l[1]?[o,{type:"text",value:l[1]}]:o}function C1(i,e,t,r){return!ud(r,!0)||/[-\d_]$/.test(t)?!1:{type:"link",title:null,url:"mailto:"+e+"@"+t,children:[{type:"text",value:e+"@"+t}]}}function E1(i){const e=i.split(".");return!(e.length<2||e[e.length-1]&&(/_/.test(e[e.length-1])||!/[a-zA-Z\d]/.test(e[e.length-1]))||e[e.length-2]&&(/_/.test(e[e.length-2])||!/[a-zA-Z\d]/.test(e[e.length-2])))}function A1(i){const e=/[!"&'),.:;<>?\]}]+$/.exec(i);if(!e)return[i,void 0];i=i.slice(0,e.index);let t=e[0],r=t.indexOf(")");const n=bh(i,"(");let s=bh(i,")");for(;r!==-1&&n>s;)i+=t.slice(0,r+1),t=t.slice(r+1),r=t.indexOf(")"),s++;return[i,t]}function ud(i,e){const t=i.input.charCodeAt(i.index-1);return(i.index===0||Zi(t)||Qs(t))&&(!e||t!==47)}fd.peek=I1;function D1(){this.buffer()}function M1(i){this.enter({type:"footnoteReference",identifier:"",label:""},i)}function L1(){this.buffer()}function T1(i){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},i)}function R1(i){const e=this.resume(),t=this.stack[this.stack.length-1];t.type,t.identifier=$t(this.sliceSerialize(i)).toLowerCase(),t.label=e}function B1(i){this.exit(i)}function O1(i){const e=this.resume(),t=this.stack[this.stack.length-1];t.type,t.identifier=$t(this.sliceSerialize(i)).toLowerCase(),t.label=e}function P1(i){this.exit(i)}function I1(){return"["}function fd(i,e,t,r){const n=t.createTracker(r);let s=n.move("[^");const l=t.enter("footnoteReference"),o=t.enter("reference");return s+=n.move(t.safe(t.associationId(i),{after:"]",before:s})),o(),l(),s+=n.move("]"),s}function N1(){return{enter:{gfmFootnoteCallString:D1,gfmFootnoteCall:M1,gfmFootnoteDefinitionLabelString:L1,gfmFootnoteDefinition:T1},exit:{gfmFootnoteCallString:R1,gfmFootnoteCall:B1,gfmFootnoteDefinitionLabelString:O1,gfmFootnoteDefinition:P1}}}function F1(i){let e=!1;return i&&i.firstLineBlank&&(e=!0),{handlers:{footnoteDefinition:t,footnoteReference:fd},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function t(r,n,s,l){const o=s.createTracker(l);let a=o.move("[^");const c=s.enter("footnoteDefinition"),u=s.enter("label");return a+=o.move(s.safe(s.associationId(r),{before:a,after:"]"})),u(),a+=o.move("]:"),r.children&&r.children.length>0&&(o.shift(4),a+=o.move((e?`
`:" ")+s.indentLines(s.containerFlow(r,o.current()),e?dd:H1))),c(),a}}function H1(i,e,t){return e===0?i:dd(i,e,t)}function dd(i,e,t){return(t?"":"    ")+i}const j1=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];pd.peek=V1;function z1(){return{canContainEols:["delete"],enter:{strikethrough:$1},exit:{strikethrough:U1}}}function W1(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:j1}],handlers:{delete:pd}}}function $1(i){this.enter({type:"delete",children:[]},i)}function U1(i){this.exit(i)}function pd(i,e,t,r){const n=t.createTracker(r),s=t.enter("strikethrough");let l=n.move("~~");return l+=t.containerPhrasing(i,{...n.current(),before:l,after:"~"}),l+=n.move("~~"),s(),l}function V1(){return"~"}function q1(i){return i.length}function K1(i,e){const t=e||{},r=(t.align||[]).concat(),n=t.stringLength||q1,s=[],l=[],o=[],a=[];let c=0,u=-1;for(;++u<i.length;){const y=[],p=[];let m=-1;for(i[u].length>c&&(c=i[u].length);++m<i[u].length;){const g=G1(i[u][m]);if(t.alignDelimiters!==!1){const v=n(g);p[m]=v,(a[m]===void 0||v>a[m])&&(a[m]=v)}y.push(g)}l[u]=y,o[u]=p}let h=-1;if(typeof r=="object"&&"length"in r)for(;++h<c;)s[h]=xh(r[h]);else{const y=xh(r);for(;++h<c;)s[h]=y}h=-1;const f=[],d=[];for(;++h<c;){const y=s[h];let p="",m="";y===99?(p=":",m=":"):y===108?p=":":y===114&&(m=":");let g=t.alignDelimiters===!1?1:Math.max(1,a[h]-p.length-m.length);const v=p+"-".repeat(g)+m;t.alignDelimiters!==!1&&(g=p.length+g+m.length,g>a[h]&&(a[h]=g),d[h]=g),f[h]=v}l.splice(1,0,f),o.splice(1,0,d),u=-1;const _=[];for(;++u<l.length;){const y=l[u],p=o[u];h=-1;const m=[];for(;++h<c;){const g=y[h]||"";let v="",b="";if(t.alignDelimiters!==!1){const S=a[h]-(p[h]||0),x=s[h];x===114?v=" ".repeat(S):x===99?S%2?(v=" ".repeat(S/2+.5),b=" ".repeat(S/2-.5)):(v=" ".repeat(S/2),b=v):b=" ".repeat(S)}t.delimiterStart!==!1&&!h&&m.push("|"),t.padding!==!1&&!(t.alignDelimiters===!1&&g==="")&&(t.delimiterStart!==!1||h)&&m.push(" "),t.alignDelimiters!==!1&&m.push(v),m.push(g),t.alignDelimiters!==!1&&m.push(b),t.padding!==!1&&m.push(" "),(t.delimiterEnd!==!1||h!==c-1)&&m.push("|")}_.push(t.delimiterEnd===!1?m.join("").replace(/ +$/,""):m.join(""))}return _.join(`
`)}function G1(i){return i==null?"":String(i)}function xh(i){const e=typeof i=="string"?i.codePointAt(0):0;return e===67||e===99?99:e===76||e===108?108:e===82||e===114?114:0}function X1(i,e,t,r){const n=t.enter("blockquote"),s=t.createTracker(r);s.move("> "),s.shift(2);const l=t.indentLines(t.containerFlow(i,s.current()),J1);return n(),l}function J1(i,e,t){return">"+(t?"":" ")+i}function Y1(i,e){return wh(i,e.inConstruct,!0)&&!wh(i,e.notInConstruct,!1)}function wh(i,e,t){if(typeof e=="string"&&(e=[e]),!e||e.length===0)return t;let r=-1;for(;++r<e.length;)if(i.includes(e[r]))return!0;return!1}function Sh(i,e,t,r){let n=-1;for(;++n<t.unsafe.length;)if(t.unsafe[n].character===`
`&&Y1(t.stack,t.unsafe[n]))return/[ \t]/.test(r.before)?"":" ";return`\\
`}function Q1(i,e){const t=String(i);let r=t.indexOf(e),n=r,s=0,l=0;if(typeof e!="string")throw new TypeError("Expected substring");for(;r!==-1;)r===n?++s>l&&(l=s):s=1,n=r+e.length,r=t.indexOf(e,n);return l}function Z1(i,e){return!!(e.options.fences===!1&&i.value&&!i.lang&&/[^ \r\n]/.test(i.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(i.value))}function ex(i){const e=i.options.fence||"`";if(e!=="`"&&e!=="~")throw new Error("Cannot serialize code with `"+e+"` for `options.fence`, expected `` ` `` or `~`");return e}function tx(i,e,t,r){const n=ex(t),s=i.value||"",l=n==="`"?"GraveAccent":"Tilde";if(Z1(i,t)){const h=t.enter("codeIndented"),f=t.indentLines(s,ix);return h(),f}const o=t.createTracker(r),a=n.repeat(Math.max(Q1(s,n)+1,3)),c=t.enter("codeFenced");let u=o.move(a);if(i.lang){const h=t.enter(`codeFencedLang${l}`);u+=o.move(t.safe(i.lang,{before:u,after:" ",encode:["`"],...o.current()})),h()}if(i.lang&&i.meta){const h=t.enter(`codeFencedMeta${l}`);u+=o.move(" "),u+=o.move(t.safe(i.meta,{before:u,after:`
`,encode:["`"],...o.current()})),h()}return u+=o.move(`
`),s&&(u+=o.move(s+`
`)),u+=o.move(a),c(),u}function ix(i,e,t){return(t?"":"    ")+i}function za(i){const e=i.options.quote||'"';if(e!=='"'&&e!=="'")throw new Error("Cannot serialize title with `"+e+"` for `options.quote`, expected `\"`, or `'`");return e}function rx(i,e,t,r){const n=za(t),s=n==='"'?"Quote":"Apostrophe",l=t.enter("definition");let o=t.enter("label");const a=t.createTracker(r);let c=a.move("[");return c+=a.move(t.safe(t.associationId(i),{before:c,after:"]",...a.current()})),c+=a.move("]: "),o(),!i.url||/[\0- \u007F]/.test(i.url)?(o=t.enter("destinationLiteral"),c+=a.move("<"),c+=a.move(t.safe(i.url,{before:c,after:">",...a.current()})),c+=a.move(">")):(o=t.enter("destinationRaw"),c+=a.move(t.safe(i.url,{before:c,after:i.title?" ":`
`,...a.current()}))),o(),i.title&&(o=t.enter(`title${s}`),c+=a.move(" "+n),c+=a.move(t.safe(i.title,{before:c,after:n,...a.current()})),c+=a.move(n),o()),l(),c}function nx(i){const e=i.options.emphasis||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize emphasis with `"+e+"` for `options.emphasis`, expected `*`, or `_`");return e}function cn(i){return"&#x"+i.toString(16).toUpperCase()+";"}function Cs(i,e,t){const r=Sr(i),n=Sr(e);return r===void 0?n===void 0?t==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:n===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:r===1?n===void 0?{inside:!1,outside:!1}:n===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:n===void 0?{inside:!1,outside:!1}:n===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}md.peek=sx;function md(i,e,t,r){const n=nx(t),s=t.enter("emphasis"),l=t.createTracker(r),o=l.move(n);let a=l.move(t.containerPhrasing(i,{after:n,before:o,...l.current()}));const c=a.charCodeAt(0),u=Cs(r.before.charCodeAt(r.before.length-1),c,n);u.inside&&(a=cn(c)+a.slice(1));const h=a.charCodeAt(a.length-1),f=Cs(r.after.charCodeAt(0),h,n);f.inside&&(a=a.slice(0,-1)+cn(h));const d=l.move(n);return s(),t.attentionEncodeSurroundingInfo={after:f.outside,before:u.outside},o+a+d}function sx(i,e,t){return t.options.emphasis||"*"}function ox(i,e){let t=!1;return Ha(i,function(r){if("value"in r&&/\r?\n|\r/.test(r.value)||r.type==="break")return t=!0,Al}),!!((!i.depth||i.depth<3)&&Ra(i)&&(e.options.setext||t))}function lx(i,e,t,r){const n=Math.max(Math.min(6,i.depth||1),1),s=t.createTracker(r);if(ox(i,t)){const u=t.enter("headingSetext"),h=t.enter("phrasing"),f=t.containerPhrasing(i,{...s.current(),before:`
`,after:`
`});return h(),u(),f+`
`+(n===1?"=":"-").repeat(f.length-(Math.max(f.lastIndexOf("\r"),f.lastIndexOf(`
`))+1))}const l="#".repeat(n),o=t.enter("headingAtx"),a=t.enter("phrasing");s.move(l+" ");let c=t.containerPhrasing(i,{before:"# ",after:`
`,...s.current()});return/^[\t ]/.test(c)&&(c=cn(c.charCodeAt(0))+c.slice(1)),c=c?l+" "+c:l,t.options.closeAtx&&(c+=" "+l),a(),o(),c}gd.peek=ax;function gd(i){return i.value||""}function ax(){return"<"}vd.peek=cx;function vd(i,e,t,r){const n=za(t),s=n==='"'?"Quote":"Apostrophe",l=t.enter("image");let o=t.enter("label");const a=t.createTracker(r);let c=a.move("![");return c+=a.move(t.safe(i.alt,{before:c,after:"]",...a.current()})),c+=a.move("]("),o(),!i.url&&i.title||/[\0- \u007F]/.test(i.url)?(o=t.enter("destinationLiteral"),c+=a.move("<"),c+=a.move(t.safe(i.url,{before:c,after:">",...a.current()})),c+=a.move(">")):(o=t.enter("destinationRaw"),c+=a.move(t.safe(i.url,{before:c,after:i.title?" ":")",...a.current()}))),o(),i.title&&(o=t.enter(`title${s}`),c+=a.move(" "+n),c+=a.move(t.safe(i.title,{before:c,after:n,...a.current()})),c+=a.move(n),o()),c+=a.move(")"),l(),c}function cx(){return"!"}_d.peek=hx;function _d(i,e,t,r){const n=i.referenceType,s=t.enter("imageReference");let l=t.enter("label");const o=t.createTracker(r);let a=o.move("![");const c=t.safe(i.alt,{before:a,after:"]",...o.current()});a+=o.move(c+"]["),l();const u=t.stack;t.stack=[],l=t.enter("reference");const h=t.safe(t.associationId(i),{before:a,after:"]",...o.current()});return l(),t.stack=u,s(),n==="full"||!c||c!==h?a+=o.move(h+"]"):n==="shortcut"?a=a.slice(0,-1):a+=o.move("]"),a}function hx(){return"!"}yd.peek=ux;function yd(i,e,t){let r=i.value||"",n="`",s=-1;for(;new RegExp("(^|[^`])"+n+"([^`]|$)").test(r);)n+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++s<t.unsafe.length;){const l=t.unsafe[s],o=t.compilePattern(l);let a;if(l.atBreak)for(;a=o.exec(r);){let c=a.index;r.charCodeAt(c)===10&&r.charCodeAt(c-1)===13&&c--,r=r.slice(0,c)+" "+r.slice(a.index+1)}}return n+r+n}function ux(){return"`"}function bd(i,e){const t=Ra(i);return!!(!e.options.resourceLink&&i.url&&!i.title&&i.children&&i.children.length===1&&i.children[0].type==="text"&&(t===i.url||"mailto:"+t===i.url)&&/^[a-z][a-z+.-]+:/i.test(i.url)&&!/[\0- <>\u007F]/.test(i.url))}xd.peek=fx;function xd(i,e,t,r){const n=za(t),s=n==='"'?"Quote":"Apostrophe",l=t.createTracker(r);let o,a;if(bd(i,t)){const u=t.stack;t.stack=[],o=t.enter("autolink");let h=l.move("<");return h+=l.move(t.containerPhrasing(i,{before:h,after:">",...l.current()})),h+=l.move(">"),o(),t.stack=u,h}o=t.enter("link"),a=t.enter("label");let c=l.move("[");return c+=l.move(t.containerPhrasing(i,{before:c,after:"](",...l.current()})),c+=l.move("]("),a(),!i.url&&i.title||/[\0- \u007F]/.test(i.url)?(a=t.enter("destinationLiteral"),c+=l.move("<"),c+=l.move(t.safe(i.url,{before:c,after:">",...l.current()})),c+=l.move(">")):(a=t.enter("destinationRaw"),c+=l.move(t.safe(i.url,{before:c,after:i.title?" ":")",...l.current()}))),a(),i.title&&(a=t.enter(`title${s}`),c+=l.move(" "+n),c+=l.move(t.safe(i.title,{before:c,after:n,...l.current()})),c+=l.move(n),a()),c+=l.move(")"),o(),c}function fx(i,e,t){return bd(i,t)?"<":"["}wd.peek=dx;function wd(i,e,t,r){const n=i.referenceType,s=t.enter("linkReference");let l=t.enter("label");const o=t.createTracker(r);let a=o.move("[");const c=t.containerPhrasing(i,{before:a,after:"]",...o.current()});a+=o.move(c+"]["),l();const u=t.stack;t.stack=[],l=t.enter("reference");const h=t.safe(t.associationId(i),{before:a,after:"]",...o.current()});return l(),t.stack=u,s(),n==="full"||!c||c!==h?a+=o.move(h+"]"):n==="shortcut"?a=a.slice(0,-1):a+=o.move("]"),a}function dx(){return"["}function Wa(i){const e=i.options.bullet||"*";if(e!=="*"&&e!=="+"&&e!=="-")throw new Error("Cannot serialize items with `"+e+"` for `options.bullet`, expected `*`, `+`, or `-`");return e}function px(i){const e=Wa(i),t=i.options.bulletOther;if(!t)return e==="*"?"-":"*";if(t!=="*"&&t!=="+"&&t!=="-")throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(t===e)throw new Error("Expected `bullet` (`"+e+"`) and `bulletOther` (`"+t+"`) to be different");return t}function mx(i){const e=i.options.bulletOrdered||".";if(e!=="."&&e!==")")throw new Error("Cannot serialize items with `"+e+"` for `options.bulletOrdered`, expected `.` or `)`");return e}function Sd(i){const e=i.options.rule||"*";if(e!=="*"&&e!=="-"&&e!=="_")throw new Error("Cannot serialize rules with `"+e+"` for `options.rule`, expected `*`, `-`, or `_`");return e}function gx(i,e,t,r){const n=t.enter("list"),s=t.bulletCurrent;let l=i.ordered?mx(t):Wa(t);const o=i.ordered?l==="."?")":".":px(t);let a=e&&t.bulletLastUsed?l===t.bulletLastUsed:!1;if(!i.ordered){const u=i.children?i.children[0]:void 0;if((l==="*"||l==="-")&&u&&(!u.children||!u.children[0])&&t.stack[t.stack.length-1]==="list"&&t.stack[t.stack.length-2]==="listItem"&&t.stack[t.stack.length-3]==="list"&&t.stack[t.stack.length-4]==="listItem"&&t.indexStack[t.indexStack.length-1]===0&&t.indexStack[t.indexStack.length-2]===0&&t.indexStack[t.indexStack.length-3]===0&&(a=!0),Sd(t)===l&&u){let h=-1;for(;++h<i.children.length;){const f=i.children[h];if(f&&f.type==="listItem"&&f.children&&f.children[0]&&f.children[0].type==="thematicBreak"){a=!0;break}}}}a&&(l=o),t.bulletCurrent=l;const c=t.containerFlow(i,r);return t.bulletLastUsed=l,t.bulletCurrent=s,n(),c}function vx(i){const e=i.options.listItemIndent||"one";if(e!=="tab"&&e!=="one"&&e!=="mixed")throw new Error("Cannot serialize items with `"+e+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return e}function _x(i,e,t,r){const n=vx(t);let s=t.bulletCurrent||Wa(t);e&&e.type==="list"&&e.ordered&&(s=(typeof e.start=="number"&&e.start>-1?e.start:1)+(t.options.incrementListMarker===!1?0:e.children.indexOf(i))+s);let l=s.length+1;(n==="tab"||n==="mixed"&&(e&&e.type==="list"&&e.spread||i.spread))&&(l=Math.ceil(l/4)*4);const o=t.createTracker(r);o.move(s+" ".repeat(l-s.length)),o.shift(l);const a=t.enter("listItem"),c=t.indentLines(t.containerFlow(i,o.current()),u);return a(),c;function u(h,f,d){return f?(d?"":" ".repeat(l))+h:(d?s:s+" ".repeat(l-s.length))+h}}function yx(i,e,t,r){const n=t.enter("paragraph"),s=t.enter("phrasing"),l=t.containerPhrasing(i,r);return s(),n(),l}const bx=to(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function xx(i,e,t,r){return(i.children.some(function(l){return bx(l)})?t.containerPhrasing:t.containerFlow).call(t,i,r)}function wx(i){const e=i.options.strong||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize strong with `"+e+"` for `options.strong`, expected `*`, or `_`");return e}kd.peek=Sx;function kd(i,e,t,r){const n=wx(t),s=t.enter("strong"),l=t.createTracker(r),o=l.move(n+n);let a=l.move(t.containerPhrasing(i,{after:n,before:o,...l.current()}));const c=a.charCodeAt(0),u=Cs(r.before.charCodeAt(r.before.length-1),c,n);u.inside&&(a=cn(c)+a.slice(1));const h=a.charCodeAt(a.length-1),f=Cs(r.after.charCodeAt(0),h,n);f.inside&&(a=a.slice(0,-1)+cn(h));const d=l.move(n+n);return s(),t.attentionEncodeSurroundingInfo={after:f.outside,before:u.outside},o+a+d}function Sx(i,e,t){return t.options.strong||"*"}function kx(i,e,t,r){return t.safe(i.value,r)}function Cx(i){const e=i.options.ruleRepetition||3;if(e<3)throw new Error("Cannot serialize rules with repetition `"+e+"` for `options.ruleRepetition`, expected `3` or more");return e}function Ex(i,e,t){const r=(Sd(t)+(t.options.ruleSpaces?" ":"")).repeat(Cx(t));return t.options.ruleSpaces?r.slice(0,-1):r}const Cd={blockquote:X1,break:Sh,code:tx,definition:rx,emphasis:md,hardBreak:Sh,heading:lx,html:gd,image:vd,imageReference:_d,inlineCode:yd,link:xd,linkReference:wd,list:gx,listItem:_x,paragraph:yx,root:xx,strong:kd,text:kx,thematicBreak:Ex};function Ax(){return{enter:{table:Dx,tableData:kh,tableHeader:kh,tableRow:Lx},exit:{codeText:Tx,table:Mx,tableData:Fo,tableHeader:Fo,tableRow:Fo}}}function Dx(i){const e=i._align;this.enter({type:"table",align:e.map(function(t){return t==="none"?null:t}),children:[]},i),this.data.inTable=!0}function Mx(i){this.exit(i),this.data.inTable=void 0}function Lx(i){this.enter({type:"tableRow",children:[]},i)}function Fo(i){this.exit(i)}function kh(i){this.enter({type:"tableCell",children:[]},i)}function Tx(i){let e=this.resume();this.data.inTable&&(e=e.replace(/\\([\\|])/g,Rx));const t=this.stack[this.stack.length-1];t.type,t.value=e,this.exit(i)}function Rx(i,e){return e==="|"?e:i}function Bx(i){const e=i||{},t=e.tableCellPadding,r=e.tablePipeAlign,n=e.stringLength,s=t?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:f,table:l,tableCell:a,tableRow:o}};function l(d,_,y,p){return c(u(d,y,p),d.align)}function o(d,_,y,p){const m=h(d,y,p),g=c([m]);return g.slice(0,g.indexOf(`
`))}function a(d,_,y,p){const m=y.enter("tableCell"),g=y.enter("phrasing"),v=y.containerPhrasing(d,{...p,before:s,after:s});return g(),m(),v}function c(d,_){return K1(d,{align:_,alignDelimiters:r,padding:t,stringLength:n})}function u(d,_,y){const p=d.children;let m=-1;const g=[],v=_.enter("table");for(;++m<p.length;)g[m]=h(p[m],_,y);return v(),g}function h(d,_,y){const p=d.children;let m=-1;const g=[],v=_.enter("tableRow");for(;++m<p.length;)g[m]=a(p[m],d,_,y);return v(),g}function f(d,_,y){let p=Cd.inlineCode(d,_,y);return y.stack.includes("tableCell")&&(p=p.replace(/\|/g,"\\$&")),p}}function Ox(){return{exit:{taskListCheckValueChecked:Ch,taskListCheckValueUnchecked:Ch,paragraph:Ix}}}function Px(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:Nx}}}function Ch(i){const e=this.stack[this.stack.length-2];e.type,e.checked=i.type==="taskListCheckValueChecked"}function Ix(i){const e=this.stack[this.stack.length-2];if(e&&e.type==="listItem"&&typeof e.checked=="boolean"){const t=this.stack[this.stack.length-1];t.type;const r=t.children[0];if(r&&r.type==="text"){const n=e.children;let s=-1,l;for(;++s<n.length;){const o=n[s];if(o.type==="paragraph"){l=o;break}}l===t&&(r.value=r.value.slice(1),r.value.length===0?t.children.shift():t.position&&r.position&&typeof r.position.start.offset=="number"&&(r.position.start.column++,r.position.start.offset++,t.position.start=Object.assign({},r.position.start)))}}this.exit(i)}function Nx(i,e,t,r){const n=i.children[0],s=typeof i.checked=="boolean"&&n&&n.type==="paragraph",l="["+(i.checked?"x":" ")+"] ",o=t.createTracker(r);s&&o.move(l);let a=Cd.listItem(i,e,t,{...r,...o.current()});return s&&(a=a.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,c)),a;function c(u){return u+l}}function Fx(){return[g1(),N1(),z1(),Ax(),Ox()]}function Hx(i){return{extensions:[v1(),F1(i),W1(),Bx(i),Px()]}}const jx={tokenize:qx,partial:!0},Ed={tokenize:Kx,partial:!0},Ad={tokenize:Gx,partial:!0},Dd={tokenize:Xx,partial:!0},zx={tokenize:Jx,partial:!0},Md={name:"wwwAutolink",tokenize:Ux,previous:Td},Ld={name:"protocolAutolink",tokenize:Vx,previous:Rd},mi={name:"emailAutolink",tokenize:$x,previous:Bd},li={};function Wx(){return{text:li}}let Wi=48;for(;Wi<123;)li[Wi]=mi,Wi++,Wi===58?Wi=65:Wi===91&&(Wi=97);li[43]=mi;li[45]=mi;li[46]=mi;li[95]=mi;li[72]=[mi,Ld];li[104]=[mi,Ld];li[87]=[mi,Md];li[119]=[mi,Md];function $x(i,e,t){const r=this;let n,s;return l;function l(h){return!Tl(h)||!Bd.call(r,r.previous)||$a(r.events)?t(h):(i.enter("literalAutolink"),i.enter("literalAutolinkEmail"),o(h))}function o(h){return Tl(h)?(i.consume(h),o):h===64?(i.consume(h),a):t(h)}function a(h){return h===46?i.check(zx,u,c)(h):h===45||h===95||rt(h)?(s=!0,i.consume(h),a):u(h)}function c(h){return i.consume(h),n=!0,a}function u(h){return s&&n&&ft(r.previous)?(i.exit("literalAutolinkEmail"),i.exit("literalAutolink"),e(h)):t(h)}}function Ux(i,e,t){const r=this;return n;function n(l){return l!==87&&l!==119||!Td.call(r,r.previous)||$a(r.events)?t(l):(i.enter("literalAutolink"),i.enter("literalAutolinkWww"),i.check(jx,i.attempt(Ed,i.attempt(Ad,s),t),t)(l))}function s(l){return i.exit("literalAutolinkWww"),i.exit("literalAutolink"),e(l)}}function Vx(i,e,t){const r=this;let n="",s=!1;return l;function l(h){return(h===72||h===104)&&Rd.call(r,r.previous)&&!$a(r.events)?(i.enter("literalAutolink"),i.enter("literalAutolinkHttp"),n+=String.fromCodePoint(h),i.consume(h),o):t(h)}function o(h){if(ft(h)&&n.length<5)return n+=String.fromCodePoint(h),i.consume(h),o;if(h===58){const f=n.toLowerCase();if(f==="http"||f==="https")return i.consume(h),a}return t(h)}function a(h){return h===47?(i.consume(h),s?c:(s=!0,a)):t(h)}function c(h){return h===null||ws(h)||Re(h)||Zi(h)||Qs(h)?t(h):i.attempt(Ed,i.attempt(Ad,u),t)(h)}function u(h){return i.exit("literalAutolinkHttp"),i.exit("literalAutolink"),e(h)}}function qx(i,e,t){let r=0;return n;function n(l){return(l===87||l===119)&&r<3?(r++,i.consume(l),n):l===46&&r===3?(i.consume(l),s):t(l)}function s(l){return l===null?t(l):e(l)}}function Kx(i,e,t){let r,n,s;return l;function l(c){return c===46||c===95?i.check(Dd,a,o)(c):c===null||Re(c)||Zi(c)||c!==45&&Qs(c)?a(c):(s=!0,i.consume(c),l)}function o(c){return c===95?r=!0:(n=r,r=void 0),i.consume(c),l}function a(c){return n||r||!s?t(c):e(c)}}function Gx(i,e){let t=0,r=0;return n;function n(l){return l===40?(t++,i.consume(l),n):l===41&&r<t?s(l):l===33||l===34||l===38||l===39||l===41||l===42||l===44||l===46||l===58||l===59||l===60||l===63||l===93||l===95||l===126?i.check(Dd,e,s)(l):l===null||Re(l)||Zi(l)?e(l):(i.consume(l),n)}function s(l){return l===41&&r++,i.consume(l),n}}function Xx(i,e,t){return r;function r(o){return o===33||o===34||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===63||o===95||o===126?(i.consume(o),r):o===38?(i.consume(o),s):o===93?(i.consume(o),n):o===60||o===null||Re(o)||Zi(o)?e(o):t(o)}function n(o){return o===null||o===40||o===91||Re(o)||Zi(o)?e(o):r(o)}function s(o){return ft(o)?l(o):t(o)}function l(o){return o===59?(i.consume(o),r):ft(o)?(i.consume(o),l):t(o)}}function Jx(i,e,t){return r;function r(s){return i.consume(s),n}function n(s){return rt(s)?t(s):e(s)}}function Td(i){return i===null||i===40||i===42||i===95||i===91||i===93||i===126||Re(i)}function Rd(i){return!ft(i)}function Bd(i){return!(i===47||Tl(i))}function Tl(i){return i===43||i===45||i===46||i===95||rt(i)}function $a(i){let e=i.length,t=!1;for(;e--;){const r=i[e][1];if((r.type==="labelLink"||r.type==="labelImage")&&!r._balanced){t=!0;break}if(r._gfmAutolinkLiteralWalkedInto){t=!1;break}}return i.length>0&&!t&&(i[i.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),t}const Yx={tokenize:sw,partial:!0};function Qx(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:iw,continuation:{tokenize:rw},exit:nw}},text:{91:{name:"gfmFootnoteCall",tokenize:tw},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:Zx,resolveTo:ew}}}}function Zx(i,e,t){const r=this;let n=r.events.length;const s=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let l;for(;n--;){const a=r.events[n][1];if(a.type==="labelImage"){l=a;break}if(a.type==="gfmFootnoteCall"||a.type==="labelLink"||a.type==="label"||a.type==="image"||a.type==="link")break}return o;function o(a){if(!l||!l._balanced)return t(a);const c=$t(r.sliceSerialize({start:l.end,end:r.now()}));return c.codePointAt(0)!==94||!s.includes(c.slice(1))?t(a):(i.enter("gfmFootnoteCallLabelMarker"),i.consume(a),i.exit("gfmFootnoteCallLabelMarker"),e(a))}}function ew(i,e){let t=i.length;for(;t--;)if(i[t][1].type==="labelImage"&&i[t][0]==="enter"){i[t][1];break}i[t+1][1].type="data",i[t+3][1].type="gfmFootnoteCallLabelMarker";const r={type:"gfmFootnoteCall",start:Object.assign({},i[t+3][1].start),end:Object.assign({},i[i.length-1][1].end)},n={type:"gfmFootnoteCallMarker",start:Object.assign({},i[t+3][1].end),end:Object.assign({},i[t+3][1].end)};n.end.column++,n.end.offset++,n.end._bufferIndex++;const s={type:"gfmFootnoteCallString",start:Object.assign({},n.end),end:Object.assign({},i[i.length-1][1].start)},l={type:"chunkString",contentType:"string",start:Object.assign({},s.start),end:Object.assign({},s.end)},o=[i[t+1],i[t+2],["enter",r,e],i[t+3],i[t+4],["enter",n,e],["exit",n,e],["enter",s,e],["enter",l,e],["exit",l,e],["exit",s,e],i[i.length-2],i[i.length-1],["exit",r,e]];return i.splice(t,i.length-t+1,...o),i}function tw(i,e,t){const r=this,n=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let s=0,l;return o;function o(h){return i.enter("gfmFootnoteCall"),i.enter("gfmFootnoteCallLabelMarker"),i.consume(h),i.exit("gfmFootnoteCallLabelMarker"),a}function a(h){return h!==94?t(h):(i.enter("gfmFootnoteCallMarker"),i.consume(h),i.exit("gfmFootnoteCallMarker"),i.enter("gfmFootnoteCallString"),i.enter("chunkString").contentType="string",c)}function c(h){if(s>999||h===93&&!l||h===null||h===91||Re(h))return t(h);if(h===93){i.exit("chunkString");const f=i.exit("gfmFootnoteCallString");return n.includes($t(r.sliceSerialize(f)))?(i.enter("gfmFootnoteCallLabelMarker"),i.consume(h),i.exit("gfmFootnoteCallLabelMarker"),i.exit("gfmFootnoteCall"),e):t(h)}return Re(h)||(l=!0),s++,i.consume(h),h===92?u:c}function u(h){return h===91||h===92||h===93?(i.consume(h),s++,c):c(h)}}function iw(i,e,t){const r=this,n=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let s,l=0,o;return a;function a(_){return i.enter("gfmFootnoteDefinition")._container=!0,i.enter("gfmFootnoteDefinitionLabel"),i.enter("gfmFootnoteDefinitionLabelMarker"),i.consume(_),i.exit("gfmFootnoteDefinitionLabelMarker"),c}function c(_){return _===94?(i.enter("gfmFootnoteDefinitionMarker"),i.consume(_),i.exit("gfmFootnoteDefinitionMarker"),i.enter("gfmFootnoteDefinitionLabelString"),i.enter("chunkString").contentType="string",u):t(_)}function u(_){if(l>999||_===93&&!o||_===null||_===91||Re(_))return t(_);if(_===93){i.exit("chunkString");const y=i.exit("gfmFootnoteDefinitionLabelString");return s=$t(r.sliceSerialize(y)),i.enter("gfmFootnoteDefinitionLabelMarker"),i.consume(_),i.exit("gfmFootnoteDefinitionLabelMarker"),i.exit("gfmFootnoteDefinitionLabel"),f}return Re(_)||(o=!0),l++,i.consume(_),_===92?h:u}function h(_){return _===91||_===92||_===93?(i.consume(_),l++,u):u(_)}function f(_){return _===58?(i.enter("definitionMarker"),i.consume(_),i.exit("definitionMarker"),n.includes(s)||n.push(s),Se(i,d,"gfmFootnoteDefinitionWhitespace")):t(_)}function d(_){return e(_)}}function rw(i,e,t){return i.check(Mn,e,i.attempt(Yx,e,t))}function nw(i){i.exit("gfmFootnoteDefinition")}function sw(i,e,t){const r=this;return Se(i,n,"gfmFootnoteDefinitionIndent",5);function n(s){const l=r.events[r.events.length-1];return l&&l[1].type==="gfmFootnoteDefinitionIndent"&&l[2].sliceSerialize(l[1],!0).length===4?e(s):t(s)}}function ow(i){let t=(i||{}).singleTilde;const r={name:"strikethrough",tokenize:s,resolveAll:n};return t==null&&(t=!0),{text:{126:r},insideSpan:{null:[r]},attentionMarkers:{null:[126]}};function n(l,o){let a=-1;for(;++a<l.length;)if(l[a][0]==="enter"&&l[a][1].type==="strikethroughSequenceTemporary"&&l[a][1]._close){let c=a;for(;c--;)if(l[c][0]==="exit"&&l[c][1].type==="strikethroughSequenceTemporary"&&l[c][1]._open&&l[a][1].end.offset-l[a][1].start.offset===l[c][1].end.offset-l[c][1].start.offset){l[a][1].type="strikethroughSequence",l[c][1].type="strikethroughSequence";const u={type:"strikethrough",start:Object.assign({},l[c][1].start),end:Object.assign({},l[a][1].end)},h={type:"strikethroughText",start:Object.assign({},l[c][1].end),end:Object.assign({},l[a][1].start)},f=[["enter",u,o],["enter",l[c][1],o],["exit",l[c][1],o],["enter",h,o]],d=o.parser.constructs.insideSpan.null;d&&Mt(f,f.length,0,Zs(d,l.slice(c+1,a),o)),Mt(f,f.length,0,[["exit",h,o],["enter",l[a][1],o],["exit",l[a][1],o],["exit",u,o]]),Mt(l,c-1,a-c+3,f),a=c+f.length-2;break}}for(a=-1;++a<l.length;)l[a][1].type==="strikethroughSequenceTemporary"&&(l[a][1].type="data");return l}function s(l,o,a){const c=this.previous,u=this.events;let h=0;return f;function f(_){return c===126&&u[u.length-1][1].type!=="characterEscape"?a(_):(l.enter("strikethroughSequenceTemporary"),d(_))}function d(_){const y=Sr(c);if(_===126)return h>1?a(_):(l.consume(_),h++,d);if(h<2&&!t)return a(_);const p=l.exit("strikethroughSequenceTemporary"),m=Sr(_);return p._open=!m||m===2&&!!y,p._close=!y||y===2&&!!m,o(_)}}}class lw{constructor(){this.map=[]}add(e,t,r){aw(this,e,t,r)}consume(e){if(this.map.sort(function(s,l){return s[0]-l[0]}),this.map.length===0)return;let t=this.map.length;const r=[];for(;t>0;)t-=1,r.push(e.slice(this.map[t][0]+this.map[t][1]),this.map[t][2]),e.length=this.map[t][0];r.push(e.slice()),e.length=0;let n=r.pop();for(;n;){for(const s of n)e.push(s);n=r.pop()}this.map.length=0}}function aw(i,e,t,r){let n=0;if(!(t===0&&r.length===0)){for(;n<i.map.length;){if(i.map[n][0]===e){i.map[n][1]+=t,i.map[n][2].push(...r);return}n+=1}i.map.push([e,t,r])}}function cw(i,e){let t=!1;const r=[];for(;e<i.length;){const n=i[e];if(t){if(n[0]==="enter")n[1].type==="tableContent"&&r.push(i[e+1][1].type==="tableDelimiterMarker"?"left":"none");else if(n[1].type==="tableContent"){if(i[e-1][1].type==="tableDelimiterMarker"){const s=r.length-1;r[s]=r[s]==="left"?"center":"right"}}else if(n[1].type==="tableDelimiterRow")break}else n[0]==="enter"&&n[1].type==="tableDelimiterRow"&&(t=!0);e+=1}return r}function hw(){return{flow:{null:{name:"table",tokenize:uw,resolveAll:fw}}}}function uw(i,e,t){const r=this;let n=0,s=0,l;return o;function o(A){let T=r.events.length-1;for(;T>-1;){const N=r.events[T][1].type;if(N==="lineEnding"||N==="linePrefix")T--;else break}const B=T>-1?r.events[T][1].type:null,O=B==="tableHead"||B==="tableRow"?x:a;return O===x&&r.parser.lazy[r.now().line]?t(A):O(A)}function a(A){return i.enter("tableHead"),i.enter("tableRow"),c(A)}function c(A){return A===124||(l=!0,s+=1),u(A)}function u(A){return A===null?t(A):ae(A)?s>1?(s=0,r.interrupt=!0,i.exit("tableRow"),i.enter("lineEnding"),i.consume(A),i.exit("lineEnding"),d):t(A):be(A)?Se(i,u,"whitespace")(A):(s+=1,l&&(l=!1,n+=1),A===124?(i.enter("tableCellDivider"),i.consume(A),i.exit("tableCellDivider"),l=!0,u):(i.enter("data"),h(A)))}function h(A){return A===null||A===124||Re(A)?(i.exit("data"),u(A)):(i.consume(A),A===92?f:h)}function f(A){return A===92||A===124?(i.consume(A),h):h(A)}function d(A){return r.interrupt=!1,r.parser.lazy[r.now().line]?t(A):(i.enter("tableDelimiterRow"),l=!1,be(A)?Se(i,_,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(A):_(A))}function _(A){return A===45||A===58?p(A):A===124?(l=!0,i.enter("tableCellDivider"),i.consume(A),i.exit("tableCellDivider"),y):S(A)}function y(A){return be(A)?Se(i,p,"whitespace")(A):p(A)}function p(A){return A===58?(s+=1,l=!0,i.enter("tableDelimiterMarker"),i.consume(A),i.exit("tableDelimiterMarker"),m):A===45?(s+=1,m(A)):A===null||ae(A)?b(A):S(A)}function m(A){return A===45?(i.enter("tableDelimiterFiller"),g(A)):S(A)}function g(A){return A===45?(i.consume(A),g):A===58?(l=!0,i.exit("tableDelimiterFiller"),i.enter("tableDelimiterMarker"),i.consume(A),i.exit("tableDelimiterMarker"),v):(i.exit("tableDelimiterFiller"),v(A))}function v(A){return be(A)?Se(i,b,"whitespace")(A):b(A)}function b(A){return A===124?_(A):A===null||ae(A)?!l||n!==s?S(A):(i.exit("tableDelimiterRow"),i.exit("tableHead"),e(A)):S(A)}function S(A){return t(A)}function x(A){return i.enter("tableRow"),k(A)}function k(A){return A===124?(i.enter("tableCellDivider"),i.consume(A),i.exit("tableCellDivider"),k):A===null||ae(A)?(i.exit("tableRow"),e(A)):be(A)?Se(i,k,"whitespace")(A):(i.enter("data"),w(A))}function w(A){return A===null||A===124||Re(A)?(i.exit("data"),k(A)):(i.consume(A),A===92?E:w)}function E(A){return A===92||A===124?(i.consume(A),w):w(A)}}function fw(i,e){let t=-1,r=!0,n=0,s=[0,0,0,0],l=[0,0,0,0],o=!1,a=0,c,u,h;const f=new lw;for(;++t<i.length;){const d=i[t],_=d[1];d[0]==="enter"?_.type==="tableHead"?(o=!1,a!==0&&(Eh(f,e,a,c,u),u=void 0,a=0),c={type:"table",start:Object.assign({},_.start),end:Object.assign({},_.end)},f.add(t,0,[["enter",c,e]])):_.type==="tableRow"||_.type==="tableDelimiterRow"?(r=!0,h=void 0,s=[0,0,0,0],l=[0,t+1,0,0],o&&(o=!1,u={type:"tableBody",start:Object.assign({},_.start),end:Object.assign({},_.end)},f.add(t,0,[["enter",u,e]])),n=_.type==="tableDelimiterRow"?2:u?3:1):n&&(_.type==="data"||_.type==="tableDelimiterMarker"||_.type==="tableDelimiterFiller")?(r=!1,l[2]===0&&(s[1]!==0&&(l[0]=l[1],h=Wn(f,e,s,n,void 0,h),s=[0,0,0,0]),l[2]=t)):_.type==="tableCellDivider"&&(r?r=!1:(s[1]!==0&&(l[0]=l[1],h=Wn(f,e,s,n,void 0,h)),s=l,l=[s[1],t,0,0])):_.type==="tableHead"?(o=!0,a=t):_.type==="tableRow"||_.type==="tableDelimiterRow"?(a=t,s[1]!==0?(l[0]=l[1],h=Wn(f,e,s,n,t,h)):l[1]!==0&&(h=Wn(f,e,l,n,t,h)),n=0):n&&(_.type==="data"||_.type==="tableDelimiterMarker"||_.type==="tableDelimiterFiller")&&(l[3]=t)}for(a!==0&&Eh(f,e,a,c,u),f.consume(e.events),t=-1;++t<e.events.length;){const d=e.events[t];d[0]==="enter"&&d[1].type==="table"&&(d[1]._align=cw(e.events,t))}return i}function Wn(i,e,t,r,n,s){const l=r===1?"tableHeader":r===2?"tableDelimiter":"tableData",o="tableContent";t[0]!==0&&(s.end=Object.assign({},lr(e.events,t[0])),i.add(t[0],0,[["exit",s,e]]));const a=lr(e.events,t[1]);if(s={type:l,start:Object.assign({},a),end:Object.assign({},a)},i.add(t[1],0,[["enter",s,e]]),t[2]!==0){const c=lr(e.events,t[2]),u=lr(e.events,t[3]),h={type:o,start:Object.assign({},c),end:Object.assign({},u)};if(i.add(t[2],0,[["enter",h,e]]),r!==2){const f=e.events[t[2]],d=e.events[t[3]];if(f[1].end=Object.assign({},d[1].end),f[1].type="chunkText",f[1].contentType="text",t[3]>t[2]+1){const _=t[2]+1,y=t[3]-t[2]-1;i.add(_,y,[])}}i.add(t[3]+1,0,[["exit",h,e]])}return n!==void 0&&(s.end=Object.assign({},lr(e.events,n)),i.add(n,0,[["exit",s,e]]),s=void 0),s}function Eh(i,e,t,r,n){const s=[],l=lr(e.events,t);n&&(n.end=Object.assign({},l),s.push(["exit",n,e])),r.end=Object.assign({},l),s.push(["exit",r,e]),i.add(t+1,0,s)}function lr(i,e){const t=i[e],r=t[0]==="enter"?"start":"end";return t[1][r]}const dw={name:"tasklistCheck",tokenize:mw};function pw(){return{text:{91:dw}}}function mw(i,e,t){const r=this;return n;function n(a){return r.previous!==null||!r._gfmTasklistFirstContentOfListItem?t(a):(i.enter("taskListCheck"),i.enter("taskListCheckMarker"),i.consume(a),i.exit("taskListCheckMarker"),s)}function s(a){return Re(a)?(i.enter("taskListCheckValueUnchecked"),i.consume(a),i.exit("taskListCheckValueUnchecked"),l):a===88||a===120?(i.enter("taskListCheckValueChecked"),i.consume(a),i.exit("taskListCheckValueChecked"),l):t(a)}function l(a){return a===93?(i.enter("taskListCheckMarker"),i.consume(a),i.exit("taskListCheckMarker"),i.exit("taskListCheck"),o):t(a)}function o(a){return ae(a)?e(a):be(a)?i.check({tokenize:gw},e,t)(a):t(a)}}function gw(i,e,t){return Se(i,r,"whitespace");function r(n){return n===null?t(n):e(n)}}function vw(i){return Uf([Wx(),Qx(),ow(i),hw(),pw()])}const _w={};function yw(i){const e=this,t=i||_w,r=e.data(),n=r.micromarkExtensions||(r.micromarkExtensions=[]),s=r.fromMarkdownExtensions||(r.fromMarkdownExtensions=[]),l=r.toMarkdownExtensions||(r.toMarkdownExtensions=[]);n.push(vw(t)),s.push(Fx()),l.push(Hx(t))}function Od({node:i,level:e,selectedPath:t,expandedPaths:r,onSelect:n,onToggle:s}){const l=r.has(i.path),o=t===i.path,a=i.type==="directory",c=i.name.endsWith(".md"),u=()=>{a?s(i.path):n(i.path)};return D.jsxs("div",{children:[D.jsxs("button",{onClick:u,className:ue("flex w-full items-center gap-1.5 rounded-md px-2 py-1 text-left text-xs transition-colors",o?"bg-[var(--color-accent-primary)]/10 text-[var(--color-accent-primary)]":"text-[var(--color-text-secondary)] hover:bg-[var(--color-bg-secondary)] hover:text-[var(--color-text-primary)]"),style:{paddingLeft:`${e*12+8}px`},children:[a?D.jsxs(D.Fragment,{children:[l?D.jsx(Br,{className:"h-3 w-3 flex-shrink-0 text-[var(--color-text-muted)]"}):D.jsx(Ys,{className:"h-3 w-3 flex-shrink-0 text-[var(--color-text-muted)]"}),l?D.jsx(Af,{className:"h-3.5 w-3.5 flex-shrink-0 text-[var(--color-warning)]"}):D.jsx(kf,{className:"h-3.5 w-3.5 flex-shrink-0 text-[var(--color-warning)]"})]}):D.jsxs(D.Fragment,{children:[D.jsx("span",{className:"w-3"}),c?D.jsx(Qi,{className:"h-3.5 w-3.5 flex-shrink-0 text-[var(--color-accent-secondary)]"}):D.jsx(En,{className:"h-3.5 w-3.5 flex-shrink-0 text-[var(--color-text-muted)]"})]}),D.jsx("span",{className:"truncate",children:i.name})]}),a&&l&&i.children&&D.jsx("div",{children:i.children.map(h=>D.jsx(Od,{node:h,level:e+1,selectedPath:t,expandedPaths:r,onSelect:n,onToggle:s},h.path))})]})}function bw({projectId:i,systemPromptParams:e,onClose:t}){const[r,n]=H.useState([]),[s,l]=H.useState(!0),[o,a]=H.useState(null),[c,u]=H.useState("system_prompt"),[h,f]=H.useState(new Set),[d,_]=H.useState(""),[y,p]=H.useState(!1),[m,g]=H.useState(!1),[v,b]=H.useState(!1);H.useEffect(()=>{(async()=>{try{l(!0);const T=await Oc(i);n(T);const B=new Set;T.forEach(O=>{O.type==="directory"&&B.add(O.path)}),f(B)}catch(T){console.error("Failed to load skills tree:",T)}finally{l(!1)}})()},[i]),H.useEffect(()=>{(async()=>{try{p(!0);const T=await Bc(e);_(T),u("system_prompt")}catch(T){console.error("Failed to load system prompt:",T),_("Error loading system prompt")}finally{p(!1)}})()},[e]);const S=H.useCallback(async()=>{a(null),u("system_prompt"),p(!0);try{const A=await Bc(e);_(A)}catch(A){console.error("Failed to load system prompt:",A),_("Error loading system prompt")}finally{p(!1)}},[e]),x=H.useCallback(async A=>{a(A),u("skill"),p(!0);try{const T=await Ag(i,A);_(T.content)}catch(T){console.error("Failed to load skill file:",T),_("Error loading file")}finally{p(!1)}},[i]),k=H.useCallback(A=>{f(T=>{const B=new Set(T);return B.has(A)?B.delete(A):B.add(A),B})},[]),w=H.useCallback(async()=>{b(!0);try{await Dg(i);const A=await Oc(i);n(A);const T=new Set;A.forEach(B=>{B.type==="directory"&&T.add(B.path)}),f(T),a(null),u("system_prompt")}catch(A){console.error("Failed to reload skills:",A)}finally{b(!1)}},[i]),E=c==="system_prompt"||(o==null?void 0:o.endsWith(".md"));return D.jsxs("div",{className:"fixed inset-0 z-50 flex",children:[D.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:t}),D.jsxs("div",{className:"relative z-10 flex w-full h-full m-4 rounded-xl border border-[var(--color-border)] bg-[var(--color-background)] shadow-2xl overflow-hidden",children:[D.jsxs("div",{className:"w-64 flex-shrink-0 border-r border-[var(--color-border)] bg-[var(--color-bg-secondary)]/30 flex flex-col",children:[D.jsx("div",{className:"flex items-center justify-between px-4 py-3 border-b border-[var(--color-border)]",children:D.jsx("h2",{className:"text-sm font-semibold text-[var(--color-text-heading)]",children:"Documentation"})}),D.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[D.jsxs("button",{onClick:S,className:ue("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left text-xs transition-colors mb-2",c==="system_prompt"?"bg-[var(--color-accent-primary)]/10 text-[var(--color-accent-primary)]":"text-[var(--color-text-secondary)] hover:bg-[var(--color-bg-secondary)] hover:text-[var(--color-text-primary)]"),children:[D.jsx(vl,{className:"h-3.5 w-3.5 flex-shrink-0"}),D.jsx("span",{className:"font-medium",children:"System Prompt"})]}),D.jsx("div",{className:"my-2 border-t border-[var(--color-border)]"}),D.jsxs("button",{onClick:w,disabled:v,className:"flex w-full items-center justify-center gap-2 rounded-lg px-3 py-2 text-xs font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed mb-3 shadow-sm",children:[D.jsx(Rr,{className:ue("h-3.5 w-3.5 flex-shrink-0",v&&"animate-spin")}),D.jsx("span",{children:v?"Reloading...":"Reload project skills"})]}),D.jsx("div",{className:"px-2 py-1 text-[10px] font-semibold uppercase tracking-wider text-[var(--color-text-muted)]",children:"Skills"}),s?D.jsx("div",{className:"flex items-center justify-center py-8",children:D.jsx(Di,{className:"h-4 w-4 animate-spin text-[var(--color-text-muted)]"})}):r.length===0?D.jsx("div",{className:"px-2 py-4 text-xs text-[var(--color-text-muted)]",children:"No skills available"}):D.jsx("div",{className:"space-y-0.5",children:r.map(A=>D.jsx(Od,{node:A,level:0,selectedPath:o,expandedPaths:h,onSelect:x,onToggle:k},A.path))})]})]}),D.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[D.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-[var(--color-border)]",children:[D.jsx("div",{className:"flex items-center gap-2 min-w-0",children:c==="system_prompt"?D.jsxs(D.Fragment,{children:[D.jsx(vl,{className:"h-4 w-4 flex-shrink-0 text-[var(--color-accent-primary)]"}),D.jsxs("div",{className:"min-w-0",children:[D.jsx("h3",{className:"text-sm font-semibold text-[var(--color-text-heading)] truncate",children:"System Prompt"}),D.jsx("p",{className:"text-xs text-[var(--color-text-muted)]",children:"Instructions injected to Claude Code"})]})]}):D.jsxs(D.Fragment,{children:[D.jsx(Qi,{className:"h-4 w-4 flex-shrink-0 text-[var(--color-accent-secondary)]"}),D.jsxs("div",{className:"min-w-0",children:[D.jsx("h3",{className:"text-sm font-semibold text-[var(--color-text-heading)] truncate",children:(o==null?void 0:o.split("/").pop())||"Select a file"}),D.jsx("p",{className:"text-xs text-[var(--color-text-muted)] truncate",children:o||"Choose a skill file from the sidebar"})]})]})}),D.jsxs("div",{className:"flex items-center gap-2",children:[E&&D.jsx("button",{onClick:()=>g(!m),className:ue("flex items-center gap-1 px-2 py-1 rounded-md text-xs transition-colors",m?"bg-[var(--color-accent-primary)]/10 text-[var(--color-accent-primary)]":"text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-bg-secondary)]"),children:m?D.jsxs(D.Fragment,{children:[D.jsx(f0,{className:"h-3 w-3"}),"Rendered"]}):D.jsxs(D.Fragment,{children:[D.jsx(Gg,{className:"h-3 w-3"}),"Raw"]})}),D.jsx("button",{onClick:t,className:"p-1 rounded-md text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-bg-secondary)] transition-colors",children:D.jsx(Cn,{className:"h-4 w-4"})})]})]}),D.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:y?D.jsx("div",{className:"flex items-center justify-center py-20",children:D.jsxs("div",{className:"flex flex-col items-center gap-3",children:[D.jsx(Di,{className:"h-6 w-6 animate-spin text-[var(--color-accent-primary)]"}),D.jsx("p",{className:"text-xs text-[var(--color-text-muted)]",children:"Loading..."})]})}):m||!E?D.jsx("pre",{className:"text-xs font-mono text-[var(--color-text-primary)] whitespace-pre-wrap break-words bg-[var(--color-bg-secondary)]/50 p-4 rounded-lg border border-[var(--color-border)]",children:d}):D.jsx("div",{className:"prose prose-xs max-w-none text-[var(--color-text-primary)] text-xs leading-relaxed",children:D.jsx(o1,{remarkPlugins:[yw],children:d})})})]})]})]})}const ci={FILE:"File",VIEW:"View",TERMINAL:"Terminal",SEARCH:"Search"};function xw(i){const e=navigator.platform.toUpperCase().indexOf("MAC")>=0;return i.replace("Cmd",e?"":"Ctrl").replace("Alt",e?"":"Alt").replace("Shift",e?"":"Shift").replace("+"," ")}function ww({isOpen:i,onClose:e,commands:t}){const[r,n]=H.useState(""),[s,l]=H.useState(0),o=H.useRef(null),a=H.useRef(null),c=r?t.filter(f=>f.label.toLowerCase().includes(r.toLowerCase())||f.id.toLowerCase().includes(r.toLowerCase())||f.category&&f.category.toLowerCase().includes(r.toLowerCase())):t;H.useEffect(()=>{i&&(n(""),l(0),setTimeout(()=>{var f;return(f=o.current)==null?void 0:f.focus()},10))},[i]),H.useEffect(()=>{l(0)},[r]),H.useEffect(()=>{if(a.current){const f=a.current.children[s];f&&f.scrollIntoView({block:"nearest"})}},[s]);const u=H.useCallback(f=>{switch(f.key){case"ArrowDown":f.preventDefault(),l(d=>d<c.length-1?d+1:d);break;case"ArrowUp":f.preventDefault(),l(d=>d>0?d-1:d);break;case"Enter":f.preventDefault(),c[s]&&(c[s].action(),e());break;case"Escape":f.preventDefault(),e();break}},[c,s,e]),h=H.useCallback(f=>{f.action(),e()},[e]);return i?D.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-[20vh]",children:[D.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:e}),D.jsxs("div",{className:"relative w-full max-w-lg bg-[var(--color-background)] border border-[var(--color-border)] rounded-lg shadow-xl overflow-hidden",children:[D.jsxs("div",{className:"flex items-center gap-2 px-3 border-b border-[var(--color-border)]",children:[D.jsx(c0,{className:"h-4 w-4 text-[var(--color-text-muted)]"}),D.jsx("input",{ref:o,type:"text",value:r,onChange:f=>n(f.target.value),onKeyDown:u,placeholder:"Type a command or search...",className:"flex-1 h-12 bg-transparent text-sm text-[var(--color-text-primary)] placeholder:text-[var(--color-text-muted)] focus:outline-none"}),D.jsx("button",{onClick:e,className:"p-1 rounded hover:bg-[var(--color-bg-secondary)] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)]",children:D.jsx(Cn,{className:"h-4 w-4"})})]}),D.jsx("div",{ref:a,className:"max-h-80 overflow-y-auto py-2",children:c.length===0?D.jsx("div",{className:"px-3 py-8 text-center text-sm text-[var(--color-text-muted)]",children:"No commands found"}):c.map((f,d)=>D.jsxs("button",{onClick:()=>h(f),className:ue("w-full flex items-center justify-between px-3 py-2 text-sm transition-colors",d===s?"bg-[var(--color-accent-primary)]/10 text-[var(--color-text-primary)]":"text-[var(--color-text-secondary)] hover:bg-[var(--color-bg-secondary)]"),children:[D.jsxs("div",{className:"flex items-center gap-2",children:[f.category&&D.jsx("span",{className:"text-xs text-[var(--color-text-muted)]",children:f.category}),D.jsx("span",{children:f.label})]}),f.shortcut&&D.jsx("span",{className:"text-xs text-[var(--color-text-muted)] font-mono",children:xw(f.shortcut)})]},f.id))})]})]}):null}function Pd(i,e=""){const t=[];for(const r of i){const n=e?`${e}/${r.name}`:r.name;r.type==="file"&&t.push({path:n,name:r.name}),r.children&&t.push(...Pd(r.children,n))}return t}function Ah(i,e){const t=i.toLowerCase(),r=e.toLowerCase();if(r===t)return{match:!0,score:100};if(r.includes(t))return{match:!0,score:80-r.indexOf(t)};let n=0,s=0;for(let l=0;l<r.length&&n<t.length;l++)r[l]===t[n]&&(n++,s+=1);return n===t.length?{match:!0,score:s}:{match:!1,score:0}}function Sw(i){const e=An(i),t={py:"text-blue-400",js:"text-yellow-400",jsx:"text-yellow-400",ts:"text-blue-400",tsx:"text-blue-400",json:"text-orange-400",yaml:"text-purple-400",yml:"text-purple-400",md:"text-gray-400",sql:"text-green-400"};return D.jsx(En,{className:ue("h-4 w-4",t[e]||"text-gray-400")})}function kw({isOpen:i,onClose:e,files:t,onFileSelect:r}){const[n,s]=H.useState(""),[l,o]=H.useState(0),a=H.useRef(null),c=H.useRef(null),u=H.useMemo(()=>Pd(t),[t]),h=H.useMemo(()=>n?u.map(_=>{const y=Ah(n,_.path),p=Ah(n,_.name),m=Math.max(y.score,p.score*1.5);return{..._,score:m,match:y.match||p.match}}).filter(_=>_.match).sort((_,y)=>y.score-_.score).slice(0,50):u.slice(0,50),[u,n]);H.useEffect(()=>{i&&(s(""),o(0),setTimeout(()=>{var _;return(_=a.current)==null?void 0:_.focus()},10))},[i]),H.useEffect(()=>{o(0)},[n]),H.useEffect(()=>{if(c.current){const _=c.current.children[l];_&&_.scrollIntoView({block:"nearest"})}},[l]);const f=H.useCallback(_=>{switch(_.key){case"ArrowDown":_.preventDefault(),o(y=>y<h.length-1?y+1:y);break;case"ArrowUp":_.preventDefault(),o(y=>y>0?y-1:y);break;case"Enter":_.preventDefault(),h[l]&&(r(h[l].path),e());break;case"Escape":_.preventDefault(),e();break}},[h,l,r,e]),d=H.useCallback(_=>{r(_),e()},[r,e]);return i?D.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-[20vh]",children:[D.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:e}),D.jsxs("div",{className:"relative w-full max-w-lg bg-[var(--color-background)] border border-[var(--color-border)] rounded-lg shadow-xl overflow-hidden",children:[D.jsxs("div",{className:"flex items-center gap-2 px-3 border-b border-[var(--color-border)]",children:[D.jsx(Ca,{className:"h-4 w-4 text-[var(--color-text-muted)]"}),D.jsx("input",{ref:a,type:"text",value:n,onChange:_=>s(_.target.value),onKeyDown:f,placeholder:"Search files by name...",className:"flex-1 h-12 bg-transparent text-sm text-[var(--color-text-primary)] placeholder:text-[var(--color-text-muted)] focus:outline-none"}),D.jsx("button",{onClick:e,className:"p-1 rounded hover:bg-[var(--color-bg-secondary)] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)]",children:D.jsx(Cn,{className:"h-4 w-4"})})]}),D.jsx("div",{ref:c,className:"max-h-80 overflow-y-auto py-2",children:h.length===0?D.jsx("div",{className:"px-3 py-8 text-center text-sm text-[var(--color-text-muted)]",children:n?"No files found":"No files in project"}):h.map((_,y)=>D.jsxs("button",{onClick:()=>d(_.path),className:ue("w-full flex items-center gap-2 px-3 py-2 text-sm transition-colors",y===l?"bg-[var(--color-accent-primary)]/10 text-[var(--color-text-primary)]":"text-[var(--color-text-secondary)] hover:bg-[var(--color-bg-secondary)]"),children:[Sw(_.name),D.jsx("span",{className:"truncate",children:_.name}),D.jsx("span",{className:"ml-auto text-xs text-[var(--color-text-muted)] truncate max-w-[200px]",children:_.path})]},_.path))})]})]}):null}function Cw(i){const e=An(i),t={py:"text-blue-400",js:"text-yellow-400",jsx:"text-yellow-400",ts:"text-blue-400",tsx:"text-blue-400",json:"text-orange-400",yaml:"text-purple-400",yml:"text-purple-400",md:"text-gray-400",sql:"text-green-400"};return D.jsx(En,{className:ue("h-3.5 w-3.5 flex-shrink-0",t[e]||"text-gray-400")})}function Ew({results:i,onResultSelect:e,className:t=""}){const[r,n]=H.useState(new Set),s=H.useMemo(()=>{const a={};for(const u of i)a[u.path]||(a[u.path]={path:u.path,matches:[]}),a[u.path].matches.push(u);const c=Object.keys(a);return r.size===0&&c.length>0&&n(new Set(c)),Object.values(a)},[i]),l=a=>{n(c=>{const u=new Set(c);return u.has(a)?u.delete(a):u.add(a),u})},o=(a,c,u)=>{const h=a.slice(0,c),f=a.slice(c,u),d=a.slice(u);return D.jsxs(D.Fragment,{children:[D.jsx("span",{className:"text-[var(--color-text-muted)]",children:h}),D.jsx("span",{className:"bg-[var(--color-accent-primary)]/30 text-[var(--color-accent-primary)]",children:f}),D.jsx("span",{className:"text-[var(--color-text-muted)]",children:d})]})};return D.jsx("div",{className:ue("text-xs",t),children:s.map(a=>{const c=r.has(a.path),u=a.path.split("/").pop()||a.path;return D.jsxs("div",{children:[D.jsxs("button",{onClick:()=>l(a.path),className:"w-full flex items-center gap-1 px-2 py-1 hover:bg-[var(--color-bg-secondary)] text-left",children:[c?D.jsx(Br,{className:"h-3 w-3 text-[var(--color-text-muted)]"}):D.jsx(Ys,{className:"h-3 w-3 text-[var(--color-text-muted)]"}),Cw(u),D.jsx("span",{className:"text-[var(--color-text-primary)] truncate",children:u}),D.jsx("span",{className:"ml-auto text-[var(--color-text-muted)]",children:a.matches.length})]}),c&&D.jsx("div",{className:"ml-4",children:a.matches.map((h,f)=>D.jsxs("button",{onClick:()=>e(h.path,h.line_number),className:"w-full flex items-start gap-2 px-2 py-1 hover:bg-[var(--color-bg-secondary)] text-left group",children:[D.jsx("span",{className:"text-[var(--color-text-muted)] w-8 text-right flex-shrink-0",children:h.line_number}),D.jsx("span",{className:"truncate font-mono",children:o(h.line_content.trim(),h.match_start,h.match_end)})]},`${h.path}-${h.line_number}-${f}`))})]},a.path)})})}function Aw({projectId:i,onResultSelect:e,className:t=""}){const[r,n]=H.useState(""),[s,l]=H.useState(!1),[o,a]=H.useState(!1),[c,u]=H.useState(""),[h,f]=H.useState(!1),[d,_]=H.useState([]),[y,p]=H.useState(!1),[m,g]=H.useState(null),v=H.useRef(null),b=H.useRef(null),S=H.useCallback(async k=>{if(!k.trim()){_([]);return}p(!0),g(null);try{const w=await Mg(i,{query:k,caseSensitive:s,regex:o,glob:c||void 0});_(w)}catch(w){g(w instanceof Error?w.message:"Search failed"),_([])}finally{p(!1)}},[i,s,o,c]);H.useEffect(()=>(b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{S(r)},300),()=>{b.current&&clearTimeout(b.current)}),[r,S]),H.useEffect(()=>{r.trim()&&S(r)},[s,o,c]);const x=k=>{k.key==="Escape"&&(n(""),_([]))};return D.jsxs("div",{className:ue("flex flex-col h-full",t),children:[D.jsxs("div",{className:"flex-shrink-0 p-2 border-b border-[var(--color-border)]",children:[D.jsx("div",{className:"flex items-center gap-1",children:D.jsxs("div",{className:"relative flex-1",children:[D.jsx(Ca,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-[var(--color-text-muted)]"}),D.jsx("input",{ref:v,type:"text",value:r,onChange:k=>n(k.target.value),onKeyDown:x,placeholder:"Search in files...",className:"w-full h-7 pl-7 pr-2 rounded-md border border-[var(--color-border)] bg-[var(--color-background)] text-xs text-[var(--color-text-primary)] placeholder:text-[var(--color-text-muted)] focus:outline-none focus:ring-1 focus:ring-[var(--color-accent-primary)]/50"}),r&&D.jsx("button",{onClick:()=>{n(""),_([])},className:"absolute right-2 top-1/2 -translate-y-1/2 text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)]",children:D.jsx(Cn,{className:"h-3 w-3"})})]})}),D.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[D.jsx("button",{onClick:()=>l(!s),className:ue("flex items-center justify-center h-6 w-6 rounded transition-colors",s?"bg-[var(--color-accent-primary)]/20 text-[var(--color-accent-primary)]":"text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-bg-secondary)]"),title:"Match case",children:D.jsx(e0,{className:"h-3.5 w-3.5"})}),D.jsx("button",{onClick:()=>a(!o),className:ue("flex items-center justify-center h-6 w-6 rounded transition-colors",o?"bg-[var(--color-accent-primary)]/20 text-[var(--color-accent-primary)]":"text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-bg-secondary)]"),title:"Use regular expression",children:D.jsx(N0,{className:"h-3.5 w-3.5"})}),D.jsx("button",{onClick:()=>f(!h),className:ue("flex items-center justify-center h-6 w-6 rounded transition-colors",h||c?"bg-[var(--color-accent-primary)]/20 text-[var(--color-accent-primary)]":"text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-bg-secondary)]"),title:"Filter files",children:D.jsx(w0,{className:"h-3.5 w-3.5"})}),D.jsx("span",{className:"ml-auto text-[10px] text-[var(--color-text-muted)]",children:y?"Searching...":d.length>0?`${d.length} results`:""})]}),h&&D.jsx("div",{className:"mt-2",children:D.jsx("input",{type:"text",value:c,onChange:k=>u(k.target.value),placeholder:"File filter (e.g., *.py, src/**/*.ts)",className:"w-full h-7 px-2 rounded-md border border-[var(--color-border)] bg-[var(--color-background)] text-xs text-[var(--color-text-primary)] placeholder:text-[var(--color-text-muted)] focus:outline-none focus:ring-1 focus:ring-[var(--color-accent-primary)]/50"})})]}),D.jsx("div",{className:"flex-1 overflow-y-auto",children:m?D.jsx("div",{className:"p-3 text-xs text-red-400",children:m}):d.length===0&&r?D.jsx("div",{className:"p-3 text-xs text-[var(--color-text-muted)] text-center",children:y?"Searching...":"No results found"}):d.length===0?D.jsx("div",{className:"p-3 text-xs text-[var(--color-text-muted)] text-center",children:"Enter a search term to find in files"}):D.jsx(Ew,{results:d,onResultSelect:e})})]})}const Gt="/api";function Dw({projectId:i,onOpenDiff:e,className:t=""}){var X,ie,re;const[r,n]=H.useState(null),[s,l]=H.useState([]),[o,a]=H.useState([]),[c,u]=H.useState(""),[h,f]=H.useState(!1),[d,_]=H.useState(null),[y,p]=H.useState(null),[m,g]=H.useState("changes"),[v,b]=H.useState(!1),[S,x]=H.useState({staged:!0,changes:!0,untracked:!0}),k=H.useRef(null),w=H.useCallback(async()=>{try{const P=await fetch(`${Gt}/projects/${i}/git/status`);if(!P.ok){const K=await P.json().catch(()=>({detail:"Failed to get git status"}));throw new Error(K.detail)}const L=await P.json();n(L),p(null)}catch(P){p(P instanceof Error?P.message:"Failed to get git status")}},[i]),E=H.useCallback(async()=>{try{const P=await fetch(`${Gt}/projects/${i}/git/log?limit=30`);if(!P.ok)return;const L=await P.json();l(L.commits||[])}catch{}},[i]),A=H.useCallback(async()=>{try{const P=await fetch(`${Gt}/projects/${i}/git/branches`);if(!P.ok)return;const L=await P.json();a(L.branches||[])}catch{}},[i]);H.useEffect(()=>{f(!0),Promise.all([w(),E(),A()]).finally(()=>f(!1))},[w,E,A]),H.useEffect(()=>{k.current=setInterval(()=>{document.hidden||w()},3e4);const P=()=>{!document.hidden&&k.current&&w()};return document.addEventListener("visibilitychange",P),()=>{k.current&&clearInterval(k.current),document.removeEventListener("visibilitychange",P)}},[w]);const T=H.useCallback(async()=>{f(!0),await Promise.all([w(),E(),A()]),f(!1)},[w,E,A]),B=H.useCallback(async P=>{_("stage");try{const L=await fetch(`${Gt}/projects/${i}/git/stage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:P})});if(!L.ok){const K=await L.json().catch(()=>({detail:"Stage failed"}));throw new Error(K.detail)}await w()}catch(L){p(L instanceof Error?L.message:"Stage failed")}finally{_(null)}},[i,w]),O=H.useCallback(async P=>{_("unstage");try{const L=await fetch(`${Gt}/projects/${i}/git/unstage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:P})});if(!L.ok){const K=await L.json().catch(()=>({detail:"Unstage failed"}));throw new Error(K.detail)}await w()}catch(L){p(L instanceof Error?L.message:"Unstage failed")}finally{_(null)}},[i,w]),N=H.useCallback(async()=>{if(c.trim()){_("commit");try{const P=await fetch(`${Gt}/projects/${i}/git/commit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:c})});if(!P.ok){const L=await P.json().catch(()=>({detail:"Commit failed"}));throw new Error(L.detail)}u(""),await Promise.all([w(),E()])}catch(P){p(P instanceof Error?P.message:"Commit failed")}finally{_(null)}}},[i,c,w,E]),j=H.useCallback(async()=>{_("push");try{const P=await fetch(`${Gt}/projects/${i}/git/push`,{method:"POST"});if(!P.ok){const L=await P.json().catch(()=>({detail:"Push failed"}));throw new Error(L.detail)}await w()}catch(P){p(P instanceof Error?P.message:"Push failed")}finally{_(null)}},[i,w]),z=H.useCallback(async()=>{_("pull");try{const P=await fetch(`${Gt}/projects/${i}/git/pull`,{method:"POST"});if(!P.ok){const L=await P.json().catch(()=>({detail:"Pull failed"}));throw new Error(L.detail)}await Promise.all([w(),E()])}catch(P){p(P instanceof Error?P.message:"Pull failed")}finally{_(null)}},[i,w,E]),$=H.useCallback(async P=>{_("checkout"),b(!1);try{const L=await fetch(`${Gt}/projects/${i}/git/checkout`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch:P})});if(!L.ok){const K=await L.json().catch(()=>({detail:"Checkout failed"}));throw new Error(K.detail)}await T()}catch(L){p(L instanceof Error?L.message:"Checkout failed")}finally{_(null)}},[i,T]),q=H.useCallback(async P=>{if(e)try{const L=P.status==="staged",K=await fetch(`${Gt}/projects/${i}/git/diff?file=${encodeURIComponent(P.path)}&staged=${L}`);if(!K.ok)return;const W=await K.json();e(P.path,W.diff||"")}catch{}},[i,e]),M=P=>{x(L=>({...L,[P]:!L[P]}))},C=((X=r==null?void 0:r.files)==null?void 0:X.filter(P=>P.status==="staged"||P.status==="staged+modified"))||[],I=((ie=r==null?void 0:r.files)==null?void 0:ie.filter(P=>P.status==="modified"||P.status==="staged+modified"))||[],F=((re=r==null?void 0:r.files)==null?void 0:re.filter(P=>P.status==="untracked"))||[],R=P=>{switch(P){case"A":return"text-green-400";case"D":return"text-red-400";case"M":return"text-yellow-400";case"R":return"text-blue-400";case"U":return"text-gray-400";default:return"text-gray-400"}};return h&&!r?D.jsx("div",{className:ue("flex items-center justify-center h-full",t),children:D.jsx(Di,{className:"h-5 w-5 animate-spin text-[var(--color-text-muted)]"})}):D.jsxs("div",{className:ue("flex flex-col h-full text-sm",t),children:[D.jsxs("div",{className:"flex items-center justify-between px-3 h-9 border-b border-[var(--color-border)] flex-shrink-0",children:[D.jsx("span",{className:"text-xs font-semibold text-[var(--color-text-primary)] uppercase tracking-wider",children:"Source Control"}),D.jsx("div",{className:"flex items-center gap-1",children:D.jsx("button",{onClick:T,className:"p-1 text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors",title:"Refresh",children:D.jsx(Rr,{className:ue("h-3.5 w-3.5",h&&"animate-spin")})})})]}),D.jsxs("div",{className:"flex items-center gap-1 px-3 py-1.5 border-b border-[var(--color-border)] flex-shrink-0",children:[D.jsxs("div",{className:"relative flex-1",children:[D.jsxs("button",{onClick:()=>{b(!v),v||A()},className:"flex items-center gap-1.5 text-xs text-[var(--color-text-primary)] hover:text-[var(--color-accent-primary)] transition-colors",children:[D.jsx(Sf,{className:"h-3.5 w-3.5"}),D.jsx("span",{className:"truncate",children:(r==null?void 0:r.branch)||"main"}),D.jsx(Br,{className:"h-3 w-3"})]}),v&&D.jsx("div",{className:"absolute top-full left-0 mt-1 w-56 bg-[var(--color-bg-secondary)] border border-[var(--color-border)] rounded shadow-lg z-50 max-h-48 overflow-y-auto",children:o.map(P=>D.jsxs("button",{onClick:()=>$(P.name),className:ue("w-full text-left px-3 py-1.5 text-xs hover:bg-[var(--color-background)] transition-colors truncate",P.current?"text-[var(--color-accent-primary)] font-medium":"text-[var(--color-text-primary)]"),children:[P.current&&D.jsx(Ic,{className:"h-3 w-3 inline mr-1"}),P.name]},P.name))})]}),D.jsxs("button",{onClick:z,disabled:d==="pull",className:"flex items-center gap-0.5 px-1.5 py-0.5 text-[10px] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-background)] rounded transition-colors disabled:opacity-50",title:"Pull",children:[D.jsx(Jg,{className:"h-3 w-3"}),((r==null?void 0:r.behind)??0)>0&&D.jsx("span",{children:r==null?void 0:r.behind})]}),D.jsxs("button",{onClick:j,disabled:d==="push",className:"flex items-center gap-0.5 px-1.5 py-0.5 text-[10px] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-background)] rounded transition-colors disabled:opacity-50",title:"Push",children:[D.jsx(Qg,{className:"h-3 w-3"}),((r==null?void 0:r.ahead)??0)>0&&D.jsx("span",{children:r==null?void 0:r.ahead})]})]}),D.jsxs("div",{className:"flex items-center border-b border-[var(--color-border)] flex-shrink-0",children:[D.jsxs("button",{onClick:()=>g("changes"),className:ue("flex items-center gap-1 px-3 py-1.5 text-xs transition-colors",m==="changes"?"text-[var(--color-text-primary)] border-b-2 border-[var(--color-accent-primary)]":"text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)]"),children:[D.jsx(Qi,{className:"h-3 w-3"}),"Changes"]}),D.jsxs("button",{onClick:()=>{g("log"),E()},className:ue("flex items-center gap-1 px-3 py-1.5 text-xs transition-colors",m==="log"?"text-[var(--color-text-primary)] border-b-2 border-[var(--color-accent-primary)]":"text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)]"),children:[D.jsx(A0,{className:"h-3 w-3"}),"Log"]})]}),y&&D.jsxs("div",{className:"px-3 py-2 text-xs text-red-400 bg-red-400/10 border-b border-[var(--color-border)]",children:[y,D.jsx("button",{onClick:()=>p(null),className:"ml-2 underline",children:"dismiss"})]}),m==="changes"?D.jsxs("div",{className:"flex-1 overflow-y-auto",children:[D.jsxs("div",{className:"px-3 py-2 border-b border-[var(--color-border)]",children:[D.jsx("textarea",{value:c,onChange:P=>u(P.target.value),placeholder:"Commit message",className:"w-full px-2 py-1.5 text-xs bg-[var(--color-background)] border border-[var(--color-border)] rounded text-[var(--color-text-primary)] placeholder:text-[var(--color-text-muted)] resize-none focus:outline-none focus:border-[var(--color-accent-primary)]",rows:3,onKeyDown:P=>{P.key==="Enter"&&(P.metaKey||P.ctrlKey)&&N()}}),D.jsxs("button",{onClick:N,disabled:!c.trim()||C.length===0||d==="commit",className:"mt-1.5 w-full flex items-center justify-center gap-1.5 px-3 py-1.5 text-xs font-medium bg-[var(--color-accent-primary)] text-white rounded hover:bg-[var(--color-accent-primary)]/80 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[d==="commit"?D.jsx(Di,{className:"h-3 w-3 animate-spin"}):D.jsx(Ic,{className:"h-3 w-3"}),"Commit (",C.length," staged)"]})]}),C.length>0&&D.jsx(Ho,{title:"Staged Changes",count:C.length,expanded:S.staged,onToggle:()=>M("staged"),files:C,onAction:P=>O([P.path]),actionIcon:D.jsx(B0,{className:"h-3 w-3"}),actionTitle:"Unstage",statusBadgeColor:R,onFileClick:q}),I.length>0&&D.jsx(Ho,{title:"Changes",count:I.length,expanded:S.changes,onToggle:()=>M("changes"),files:I,onAction:P=>B([P.path]),actionIcon:D.jsx(bl,{className:"h-3 w-3"}),actionTitle:"Stage",statusBadgeColor:R,onFileClick:q}),F.length>0&&D.jsx(Ho,{title:"Untracked",count:F.length,expanded:S.untracked,onToggle:()=>M("untracked"),files:F,onAction:P=>B([P.path]),actionIcon:D.jsx(bl,{className:"h-3 w-3"}),actionTitle:"Stage",statusBadgeColor:R,onFileClick:q}),C.length===0&&I.length===0&&F.length===0&&D.jsx("div",{className:"px-3 py-8 text-center text-xs text-[var(--color-text-muted)]",children:"No changes detected"})]}):D.jsx("div",{className:"flex-1 overflow-y-auto",children:s.length===0?D.jsx("div",{className:"px-3 py-8 text-center text-xs text-[var(--color-text-muted)]",children:"No commits yet"}):s.map(P=>D.jsx("div",{className:"px-3 py-2 border-b border-[var(--color-border)] hover:bg-[var(--color-background)]/50 transition-colors",children:D.jsxs("div",{className:"flex items-start gap-2",children:[D.jsx("span",{className:"text-[10px] font-mono text-[var(--color-accent-primary)] flex-shrink-0 mt-0.5",children:P.short_hash}),D.jsxs("div",{className:"min-w-0 flex-1",children:[D.jsx("div",{className:"text-xs text-[var(--color-text-primary)] truncate",children:P.message}),D.jsxs("div",{className:"text-[10px] text-[var(--color-text-muted)] mt-0.5",children:[P.author," - ",new Date(P.timestamp*1e3).toLocaleDateString()]})]})]})},P.hash))})]})}function Ho({title:i,count:e,expanded:t,onToggle:r,files:n,onAction:s,actionIcon:l,actionTitle:o,statusBadgeColor:a,onFileClick:c}){return D.jsxs("div",{children:[D.jsxs("button",{onClick:r,className:"flex items-center gap-1 w-full px-3 py-1.5 text-[11px] font-semibold text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] uppercase tracking-wider transition-colors",children:[t?D.jsx(Br,{className:"h-3 w-3"}):D.jsx(Ys,{className:"h-3 w-3"}),i,D.jsx("span",{className:"ml-auto text-[10px] font-normal bg-[var(--color-bg-secondary)] px-1.5 rounded",children:e})]}),t&&D.jsx("div",{children:n.map(u=>{const h=u.path.split("/").pop()||u.path,f=u.path.includes("/")?u.path.substring(0,u.path.lastIndexOf("/")):"";return D.jsxs("div",{className:"group flex items-center gap-1 px-3 py-1 hover:bg-[var(--color-background)]/50 transition-colors cursor-pointer",onClick:()=>c(u),children:[D.jsx("span",{className:ue("text-[10px] font-mono w-4 text-center flex-shrink-0",a(u.change_type)),children:u.change_type}),D.jsx("span",{className:"text-xs text-[var(--color-text-primary)] truncate",children:h}),f&&D.jsx("span",{className:"text-[10px] text-[var(--color-text-muted)] truncate ml-1",children:f}),D.jsx("button",{onClick:d=>{d.stopPropagation(),s(u)},className:"ml-auto p-0.5 text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] opacity-0 group-hover:opacity-100 transition-all",title:o,children:l})]},`${u.path}-${u.status}`)})})]})}function Mw({projectId:i,className:e=""}){const[t,r]=H.useState([{id:"welcome",type:"output",content:`Terminal ready. Working directory: /projects/${i}`,timestamp:new Date}]),[n,s]=H.useState(""),[l,o]=H.useState(!1),[a,c]=H.useState([]),[u,h]=H.useState(-1),f=H.useRef(null),d=H.useRef(null);H.useEffect(()=>{d.current&&(d.current.scrollTop=d.current.scrollHeight)},[t]);const _=H.useCallback(()=>{var m;(m=f.current)==null||m.focus()},[]),y=H.useCallback(async m=>{if(!m.trim())return;const g={id:`input-${Date.now()}`,type:"input",content:`$ ${m}`,timestamp:new Date};r(v=>[...v,g]),c(v=>[...v,m]),h(-1),o(!0);try{const v=await fetch(`/api/projects/${i}/terminal/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:m})}),b=await v.json();if(b.stdout){const S={id:`output-${Date.now()}`,type:"output",content:b.stdout,timestamp:new Date};r(x=>[...x,S])}if(b.stderr){const S={id:`error-${Date.now()}`,type:"error",content:b.stderr,timestamp:new Date};r(x=>[...x,S])}if(!v.ok&&b.detail){const S={id:`error-${Date.now()}`,type:"error",content:b.detail,timestamp:new Date};r(x=>[...x,S])}}catch(v){const b={id:`error-${Date.now()}`,type:"error",content:v instanceof Error?v.message:"Command execution failed",timestamp:new Date};r(S=>[...S,b])}finally{o(!1)}},[i]),p=H.useCallback(m=>{if(m.key==="Enter"&&!l)y(n),s("");else if(m.key==="ArrowUp"){if(m.preventDefault(),a.length>0){const g=u<a.length-1?u+1:u;h(g),s(a[a.length-1-g]||"")}}else if(m.key==="ArrowDown")if(m.preventDefault(),u>0){const g=u-1;h(g),s(a[a.length-1-g]||"")}else u===0&&(h(-1),s(""));else m.key==="c"&&m.ctrlKey?(s(""),r(g=>[...g,{id:`interrupt-${Date.now()}`,type:"output",content:"^C",timestamp:new Date}])):m.key==="l"&&m.ctrlKey&&(m.preventDefault(),r([]))},[n,l,a,u,y]);return D.jsxs("div",{ref:d,className:ue("h-full bg-[#1e1e1e] text-[#d4d4d4] font-mono text-xs overflow-y-auto p-2 cursor-text",e),onClick:_,children:[t.map(m=>D.jsx("div",{className:ue("whitespace-pre-wrap break-all",m.type==="input"&&"text-[#569cd6]",m.type==="error"&&"text-[#f14c4c]",m.type==="output"&&"text-[#d4d4d4]"),children:m.content},m.id)),D.jsxs("div",{className:"flex items-center",children:[D.jsx("span",{className:"text-[#569cd6] mr-1",children:"$"}),D.jsx("input",{ref:f,type:"text",value:n,onChange:m=>s(m.target.value),onKeyDown:p,disabled:l,className:"flex-1 bg-transparent outline-none text-[#d4d4d4] caret-[#d4d4d4]",autoFocus:!0}),l&&D.jsx("span",{className:"animate-pulse ml-2 text-[#808080]",children:"Running..."})]})]})}var jo={exports:{}},Dh;function Lw(){return Dh||(Dh=1,(function(i,e){(function(t,r){i.exports=r()})(globalThis,(()=>(()=>{var t={4567:function(l,o,a){var c=this&&this.__decorate||function(g,v,b,S){var x,k=arguments.length,w=k<3?v:S===null?S=Object.getOwnPropertyDescriptor(v,b):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(g,v,b,S);else for(var E=g.length-1;E>=0;E--)(x=g[E])&&(w=(k<3?x(w):k>3?x(v,b,w):x(v,b))||w);return k>3&&w&&Object.defineProperty(v,b,w),w},u=this&&this.__param||function(g,v){return function(b,S){v(b,S,g)}};Object.defineProperty(o,"__esModule",{value:!0}),o.AccessibilityManager=void 0;const h=a(9042),f=a(9924),d=a(844),_=a(4725),y=a(2585),p=a(3656);let m=o.AccessibilityManager=class extends d.Disposable{constructor(g,v,b,S){super(),this._terminal=g,this._coreBrowserService=b,this._renderService=S,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let x=0;x<this._terminal.rows;x++)this._rowElements[x]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[x]);if(this._topBoundaryFocusListener=x=>this._handleBoundaryFocus(x,0),this._bottomBoundaryFocusListener=x=>this._handleBoundaryFocus(x,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new f.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize((x=>this._handleResize(x.rows)))),this.register(this._terminal.onRender((x=>this._refreshRows(x.start,x.end)))),this.register(this._terminal.onScroll((()=>this._refreshRows()))),this.register(this._terminal.onA11yChar((x=>this._handleChar(x)))),this.register(this._terminal.onLineFeed((()=>this._handleChar(`
`)))),this.register(this._terminal.onA11yTab((x=>this._handleTab(x)))),this.register(this._terminal.onKey((x=>this._handleKey(x.key)))),this.register(this._terminal.onBlur((()=>this._clearLiveRegion()))),this.register(this._renderService.onDimensionsChange((()=>this._refreshRowsDimensions()))),this.register((0,p.addDisposableDomListener)(document,"selectionchange",(()=>this._handleSelectionChange()))),this.register(this._coreBrowserService.onDprChange((()=>this._refreshRowsDimensions()))),this._refreshRows(),this.register((0,d.toDisposable)((()=>{this._accessibilityContainer.remove(),this._rowElements.length=0})))}_handleTab(g){for(let v=0;v<g;v++)this._handleChar(" ")}_handleChar(g){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==g&&(this._charsToAnnounce+=g):this._charsToAnnounce+=g,g===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=h.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(g){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(g)||this._charsToConsume.push(g)}_refreshRows(g,v){this._liveRegionDebouncer.refresh(g,v,this._terminal.rows)}_renderRows(g,v){const b=this._terminal.buffer,S=b.lines.length.toString();for(let x=g;x<=v;x++){const k=b.lines.get(b.ydisp+x),w=[],E=(k==null?void 0:k.translateToString(!0,void 0,void 0,w))||"",A=(b.ydisp+x+1).toString(),T=this._rowElements[x];T&&(E.length===0?(T.innerText="",this._rowColumns.set(T,[0,1])):(T.textContent=E,this._rowColumns.set(T,w)),T.setAttribute("aria-posinset",A),T.setAttribute("aria-setsize",S))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(g,v){const b=g.target,S=this._rowElements[v===0?1:this._rowElements.length-2];if(b.getAttribute("aria-posinset")===(v===0?"1":`${this._terminal.buffer.lines.length}`)||g.relatedTarget!==S)return;let x,k;if(v===0?(x=b,k=this._rowElements.pop(),this._rowContainer.removeChild(k)):(x=this._rowElements.shift(),k=b,this._rowContainer.removeChild(x)),x.removeEventListener("focus",this._topBoundaryFocusListener),k.removeEventListener("focus",this._bottomBoundaryFocusListener),v===0){const w=this._createAccessibilityTreeNode();this._rowElements.unshift(w),this._rowContainer.insertAdjacentElement("afterbegin",w)}else{const w=this._createAccessibilityTreeNode();this._rowElements.push(w),this._rowContainer.appendChild(w)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(v===0?-1:1),this._rowElements[v===0?1:this._rowElements.length-2].focus(),g.preventDefault(),g.stopImmediatePropagation()}_handleSelectionChange(){var E;if(this._rowElements.length===0)return;const g=document.getSelection();if(!g)return;if(g.isCollapsed)return void(this._rowContainer.contains(g.anchorNode)&&this._terminal.clearSelection());if(!g.anchorNode||!g.focusNode)return void console.error("anchorNode and/or focusNode are null");let v={node:g.anchorNode,offset:g.anchorOffset},b={node:g.focusNode,offset:g.focusOffset};if((v.node.compareDocumentPosition(b.node)&Node.DOCUMENT_POSITION_PRECEDING||v.node===b.node&&v.offset>b.offset)&&([v,b]=[b,v]),v.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(v={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(v.node))return;const S=this._rowElements.slice(-1)[0];if(b.node.compareDocumentPosition(S)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(b={node:S,offset:((E=S.textContent)==null?void 0:E.length)??0}),!this._rowContainer.contains(b.node))return;const x=({node:A,offset:T})=>{const B=A instanceof Text?A.parentNode:A;let O=parseInt(B==null?void 0:B.getAttribute("aria-posinset"),10)-1;if(isNaN(O))return console.warn("row is invalid. Race condition?"),null;const N=this._rowColumns.get(B);if(!N)return console.warn("columns is null. Race condition?"),null;let j=T<N.length?N[T]:N.slice(-1)[0]+1;return j>=this._terminal.cols&&(++O,j=0),{row:O,column:j}},k=x(v),w=x(b);if(k&&w){if(k.row>w.row||k.row===w.row&&k.column>=w.column)throw new Error("invalid range");this._terminal.select(k.column,k.row,(w.row-k.row)*this._terminal.cols-k.column+w.column)}}_handleResize(g){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let v=this._rowContainer.children.length;v<this._terminal.rows;v++)this._rowElements[v]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[v]);for(;this._rowElements.length>g;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const g=this._coreBrowserService.mainDocument.createElement("div");return g.setAttribute("role","listitem"),g.tabIndex=-1,this._refreshRowDimensions(g),g}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let g=0;g<this._terminal.rows;g++)this._refreshRowDimensions(this._rowElements[g])}}_refreshRowDimensions(g){g.style.height=`${this._renderService.dimensions.css.cell.height}px`}};o.AccessibilityManager=m=c([u(1,y.IInstantiationService),u(2,_.ICoreBrowserService),u(3,_.IRenderService)],m)},3614:(l,o)=>{function a(f){return f.replace(/\r?\n/g,"\r")}function c(f,d){return d?"\x1B[200~"+f+"\x1B[201~":f}function u(f,d,_,y){f=c(f=a(f),_.decPrivateModes.bracketedPasteMode&&y.rawOptions.ignoreBracketedPasteMode!==!0),_.triggerDataEvent(f,!0),d.value=""}function h(f,d,_){const y=_.getBoundingClientRect(),p=f.clientX-y.left-10,m=f.clientY-y.top-10;d.style.width="20px",d.style.height="20px",d.style.left=`${p}px`,d.style.top=`${m}px`,d.style.zIndex="1000",d.focus()}Object.defineProperty(o,"__esModule",{value:!0}),o.rightClickHandler=o.moveTextAreaUnderMouseCursor=o.paste=o.handlePasteEvent=o.copyHandler=o.bracketTextForPaste=o.prepareTextForTerminal=void 0,o.prepareTextForTerminal=a,o.bracketTextForPaste=c,o.copyHandler=function(f,d){f.clipboardData&&f.clipboardData.setData("text/plain",d.selectionText),f.preventDefault()},o.handlePasteEvent=function(f,d,_,y){f.stopPropagation(),f.clipboardData&&u(f.clipboardData.getData("text/plain"),d,_,y)},o.paste=u,o.moveTextAreaUnderMouseCursor=h,o.rightClickHandler=function(f,d,_,y,p){h(f,d,_),p&&y.rightClickSelect(f),d.value=y.selectionText,d.select()}},7239:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ColorContrastCache=void 0;const c=a(1505);o.ColorContrastCache=class{constructor(){this._color=new c.TwoKeyMap,this._css=new c.TwoKeyMap}setCss(u,h,f){this._css.set(u,h,f)}getCss(u,h){return this._css.get(u,h)}setColor(u,h,f){this._color.set(u,h,f)}getColor(u,h){return this._color.get(u,h)}clear(){this._color.clear(),this._css.clear()}}},3656:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.addDisposableDomListener=void 0,o.addDisposableDomListener=function(a,c,u,h){a.addEventListener(c,u,h);let f=!1;return{dispose:()=>{f||(f=!0,a.removeEventListener(c,u,h))}}}},3551:function(l,o,a){var c=this&&this.__decorate||function(m,g,v,b){var S,x=arguments.length,k=x<3?g:b===null?b=Object.getOwnPropertyDescriptor(g,v):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(m,g,v,b);else for(var w=m.length-1;w>=0;w--)(S=m[w])&&(k=(x<3?S(k):x>3?S(g,v,k):S(g,v))||k);return x>3&&k&&Object.defineProperty(g,v,k),k},u=this&&this.__param||function(m,g){return function(v,b){g(v,b,m)}};Object.defineProperty(o,"__esModule",{value:!0}),o.Linkifier=void 0;const h=a(3656),f=a(8460),d=a(844),_=a(2585),y=a(4725);let p=o.Linkifier=class extends d.Disposable{get currentLink(){return this._currentLink}constructor(m,g,v,b,S){super(),this._element=m,this._mouseService=g,this._renderService=v,this._bufferService=b,this._linkProviderService=S,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new f.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new f.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,d.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,d.toDisposable)((()=>{var x;this._lastMouseEvent=void 0,(x=this._activeProviderReplies)==null||x.clear()}))),this.register(this._bufferService.onResize((()=>{this._clearCurrentLink(),this._wasResized=!0}))),this.register((0,h.addDisposableDomListener)(this._element,"mouseleave",(()=>{this._isMouseOut=!0,this._clearCurrentLink()}))),this.register((0,h.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,h.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,h.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(m){this._lastMouseEvent=m;const g=this._positionFromMouseEvent(m,this._element,this._mouseService);if(!g)return;this._isMouseOut=!1;const v=m.composedPath();for(let b=0;b<v.length;b++){const S=v[b];if(S.classList.contains("xterm"))break;if(S.classList.contains("xterm-hover"))return}this._lastBufferCell&&g.x===this._lastBufferCell.x&&g.y===this._lastBufferCell.y||(this._handleHover(g),this._lastBufferCell=g)}_handleHover(m){if(this._activeLine!==m.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(m,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,m)||(this._clearCurrentLink(),this._askForLink(m,!0))}_askForLink(m,g){var b,S;this._activeProviderReplies&&g||((b=this._activeProviderReplies)==null||b.forEach((x=>{x==null||x.forEach((k=>{k.link.dispose&&k.link.dispose()}))})),this._activeProviderReplies=new Map,this._activeLine=m.y);let v=!1;for(const[x,k]of this._linkProviderService.linkProviders.entries())g?(S=this._activeProviderReplies)!=null&&S.get(x)&&(v=this._checkLinkProviderResult(x,m,v)):k.provideLinks(m.y,(w=>{var A,T;if(this._isMouseOut)return;const E=w==null?void 0:w.map((B=>({link:B})));(A=this._activeProviderReplies)==null||A.set(x,E),v=this._checkLinkProviderResult(x,m,v),((T=this._activeProviderReplies)==null?void 0:T.size)===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(m.y,this._activeProviderReplies)}))}_removeIntersectingLinks(m,g){const v=new Set;for(let b=0;b<g.size;b++){const S=g.get(b);if(S)for(let x=0;x<S.length;x++){const k=S[x],w=k.link.range.start.y<m?0:k.link.range.start.x,E=k.link.range.end.y>m?this._bufferService.cols:k.link.range.end.x;for(let A=w;A<=E;A++){if(v.has(A)){S.splice(x--,1);break}v.add(A)}}}}_checkLinkProviderResult(m,g,v){var x;if(!this._activeProviderReplies)return v;const b=this._activeProviderReplies.get(m);let S=!1;for(let k=0;k<m;k++)this._activeProviderReplies.has(k)&&!this._activeProviderReplies.get(k)||(S=!0);if(!S&&b){const k=b.find((w=>this._linkAtPosition(w.link,g)));k&&(v=!0,this._handleNewLink(k))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!v)for(let k=0;k<this._activeProviderReplies.size;k++){const w=(x=this._activeProviderReplies.get(k))==null?void 0:x.find((E=>this._linkAtPosition(E.link,g)));if(w){v=!0,this._handleNewLink(w);break}}return v}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(m){if(!this._currentLink)return;const g=this._positionFromMouseEvent(m,this._element,this._mouseService);g&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,g)&&this._currentLink.link.activate(m,this._currentLink.link.text)}_clearCurrentLink(m,g){this._currentLink&&this._lastMouseEvent&&(!m||!g||this._currentLink.link.range.start.y>=m&&this._currentLink.link.range.end.y<=g)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,d.disposeArray)(this._linkCacheDisposables))}_handleNewLink(m){if(!this._lastMouseEvent)return;const g=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);g&&this._linkAtPosition(m.link,g)&&(this._currentLink=m,this._currentLink.state={decorations:{underline:m.link.decorations===void 0||m.link.decorations.underline,pointerCursor:m.link.decorations===void 0||m.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,m.link,this._lastMouseEvent),m.link.decorations={},Object.defineProperties(m.link.decorations,{pointerCursor:{get:()=>{var v,b;return(b=(v=this._currentLink)==null?void 0:v.state)==null?void 0:b.decorations.pointerCursor},set:v=>{var b;(b=this._currentLink)!=null&&b.state&&this._currentLink.state.decorations.pointerCursor!==v&&(this._currentLink.state.decorations.pointerCursor=v,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",v))}},underline:{get:()=>{var v,b;return(b=(v=this._currentLink)==null?void 0:v.state)==null?void 0:b.decorations.underline},set:v=>{var b,S,x;(b=this._currentLink)!=null&&b.state&&((x=(S=this._currentLink)==null?void 0:S.state)==null?void 0:x.decorations.underline)!==v&&(this._currentLink.state.decorations.underline=v,this._currentLink.state.isHovered&&this._fireUnderlineEvent(m.link,v))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((v=>{if(!this._currentLink)return;const b=v.start===0?0:v.start+1+this._bufferService.buffer.ydisp,S=this._bufferService.buffer.ydisp+1+v.end;if(this._currentLink.link.range.start.y>=b&&this._currentLink.link.range.end.y<=S&&(this._clearCurrentLink(b,S),this._lastMouseEvent)){const x=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);x&&this._askForLink(x,!1)}}))))}_linkHover(m,g,v){var b;(b=this._currentLink)!=null&&b.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(g,!0),this._currentLink.state.decorations.pointerCursor&&m.classList.add("xterm-cursor-pointer")),g.hover&&g.hover(v,g.text)}_fireUnderlineEvent(m,g){const v=m.range,b=this._bufferService.buffer.ydisp,S=this._createLinkUnderlineEvent(v.start.x-1,v.start.y-b-1,v.end.x,v.end.y-b-1,void 0);(g?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(S)}_linkLeave(m,g,v){var b;(b=this._currentLink)!=null&&b.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(g,!1),this._currentLink.state.decorations.pointerCursor&&m.classList.remove("xterm-cursor-pointer")),g.leave&&g.leave(v,g.text)}_linkAtPosition(m,g){const v=m.range.start.y*this._bufferService.cols+m.range.start.x,b=m.range.end.y*this._bufferService.cols+m.range.end.x,S=g.y*this._bufferService.cols+g.x;return v<=S&&S<=b}_positionFromMouseEvent(m,g,v){const b=v.getCoords(m,g,this._bufferService.cols,this._bufferService.rows);if(b)return{x:b[0],y:b[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(m,g,v,b,S){return{x1:m,y1:g,x2:v,y2:b,cols:this._bufferService.cols,fg:S}}};o.Linkifier=p=c([u(1,y.IMouseService),u(2,y.IRenderService),u(3,_.IBufferService),u(4,y.ILinkProviderService)],p)},9042:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.tooMuchOutput=o.promptLabel=void 0,o.promptLabel="Terminal input",o.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(l,o,a){var c=this&&this.__decorate||function(y,p,m,g){var v,b=arguments.length,S=b<3?p:g===null?g=Object.getOwnPropertyDescriptor(p,m):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(y,p,m,g);else for(var x=y.length-1;x>=0;x--)(v=y[x])&&(S=(b<3?v(S):b>3?v(p,m,S):v(p,m))||S);return b>3&&S&&Object.defineProperty(p,m,S),S},u=this&&this.__param||function(y,p){return function(m,g){p(m,g,y)}};Object.defineProperty(o,"__esModule",{value:!0}),o.OscLinkProvider=void 0;const h=a(511),f=a(2585);let d=o.OscLinkProvider=class{constructor(y,p,m){this._bufferService=y,this._optionsService=p,this._oscLinkService=m}provideLinks(y,p){var E;const m=this._bufferService.buffer.lines.get(y-1);if(!m)return void p(void 0);const g=[],v=this._optionsService.rawOptions.linkHandler,b=new h.CellData,S=m.getTrimmedLength();let x=-1,k=-1,w=!1;for(let A=0;A<S;A++)if(k!==-1||m.hasContent(A)){if(m.loadCell(A,b),b.hasExtendedAttrs()&&b.extended.urlId){if(k===-1){k=A,x=b.extended.urlId;continue}w=b.extended.urlId!==x}else k!==-1&&(w=!0);if(w||k!==-1&&A===S-1){const T=(E=this._oscLinkService.getLinkData(x))==null?void 0:E.uri;if(T){const B={start:{x:k+1,y},end:{x:A+(w||A!==S-1?0:1),y}};let O=!1;if(!(v!=null&&v.allowNonHttpProtocols))try{const N=new URL(T);["http:","https:"].includes(N.protocol)||(O=!0)}catch{O=!0}O||g.push({text:T,range:B,activate:(N,j)=>v?v.activate(N,j,B):_(0,j),hover:(N,j)=>{var z;return(z=v==null?void 0:v.hover)==null?void 0:z.call(v,N,j,B)},leave:(N,j)=>{var z;return(z=v==null?void 0:v.leave)==null?void 0:z.call(v,N,j,B)}})}w=!1,b.hasExtendedAttrs()&&b.extended.urlId?(k=A,x=b.extended.urlId):(k=-1,x=-1)}}p(g)}};function _(y,p){if(confirm(`Do you want to navigate to ${p}?

WARNING: This link could potentially be dangerous`)){const m=window.open();if(m){try{m.opener=null}catch{}m.location.href=p}else console.warn("Opening link blocked as opener could not be cleared")}}o.OscLinkProvider=d=c([u(0,f.IBufferService),u(1,f.IOptionsService),u(2,f.IOscLinkService)],d)},6193:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.RenderDebouncer=void 0,o.RenderDebouncer=class{constructor(a,c){this._renderCallback=a,this._coreBrowserService=c,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(a){return this._refreshCallbacks.push(a),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh()))),this._animationFrame}refresh(a,c,u){this._rowCount=u,a=a!==void 0?a:0,c=c!==void 0?c:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,c):c,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const a=Math.max(this._rowStart,0),c=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,c),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const a of this._refreshCallbacks)a(0);this._refreshCallbacks=[]}}},3236:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Terminal=void 0;const c=a(3614),u=a(3656),h=a(3551),f=a(9042),d=a(3730),_=a(1680),y=a(3107),p=a(5744),m=a(2950),g=a(1296),v=a(428),b=a(4269),S=a(5114),x=a(8934),k=a(3230),w=a(9312),E=a(4725),A=a(6731),T=a(8055),B=a(8969),O=a(8460),N=a(844),j=a(6114),z=a(8437),$=a(2584),q=a(7399),M=a(5941),C=a(9074),I=a(2585),F=a(5435),R=a(4567),X=a(779);class ie extends B.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(P={}){super(P),this.browser=j,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new N.MutableDisposable),this._onCursorMove=this.register(new O.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new O.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new O.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new O.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new O.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new O.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new O.EventEmitter),this._onBlur=this.register(new O.EventEmitter),this._onA11yCharEmitter=this.register(new O.EventEmitter),this._onA11yTabEmitter=this.register(new O.EventEmitter),this._onWillOpen=this.register(new O.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(C.DecorationService),this._instantiationService.setService(I.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(X.LinkProviderService),this._instantiationService.setService(E.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(d.OscLinkProvider)),this.register(this._inputHandler.onRequestBell((()=>this._onBell.fire()))),this.register(this._inputHandler.onRequestRefreshRows(((L,K)=>this.refresh(L,K)))),this.register(this._inputHandler.onRequestSendFocus((()=>this._reportFocus()))),this.register(this._inputHandler.onRequestReset((()=>this.reset()))),this.register(this._inputHandler.onRequestWindowsOptionsReport((L=>this._reportWindowsOptions(L)))),this.register(this._inputHandler.onColor((L=>this._handleColorEvent(L)))),this.register((0,O.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,O.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,O.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,O.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize((L=>this._afterResize(L.cols,L.rows)))),this.register((0,N.toDisposable)((()=>{var L,K;this._customKeyEventHandler=void 0,(K=(L=this.element)==null?void 0:L.parentNode)==null||K.removeChild(this.element)})))}_handleColorEvent(P){if(this._themeService)for(const L of P){let K,W="";switch(L.index){case 256:K="foreground",W="10";break;case 257:K="background",W="11";break;case 258:K="cursor",W="12";break;default:K="ansi",W="4;"+L.index}switch(L.type){case 0:const Q=T.color.toColorRGB(K==="ansi"?this._themeService.colors.ansi[L.index]:this._themeService.colors[K]);this.coreService.triggerDataEvent(`${$.C0.ESC}]${W};${(0,M.toRgbString)(Q)}${$.C1_ESCAPED.ST}`);break;case 1:if(K==="ansi")this._themeService.modifyColors((Y=>Y.ansi[L.index]=T.channels.toColor(...L.color)));else{const Y=K;this._themeService.modifyColors((ge=>ge[Y]=T.channels.toColor(...L.color)))}break;case 2:this._themeService.restoreColor(L.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(P){P?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(R.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(P){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent($.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var P;return(P=this.textarea)==null?void 0:P.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent($.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const P=this.buffer.ybase+this.buffer.y,L=this.buffer.lines.get(P);if(!L)return;const K=Math.min(this.buffer.x,this.cols-1),W=this._renderService.dimensions.css.cell.height,Q=L.getWidth(K),Y=this._renderService.dimensions.css.cell.width*Q,ge=this.buffer.y*this._renderService.dimensions.css.cell.height,Be=K*this._renderService.dimensions.css.cell.width;this.textarea.style.left=Be+"px",this.textarea.style.top=ge+"px",this.textarea.style.width=Y+"px",this.textarea.style.height=W+"px",this.textarea.style.lineHeight=W+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,u.addDisposableDomListener)(this.element,"copy",(L=>{this.hasSelection()&&(0,c.copyHandler)(L,this._selectionService)})));const P=L=>(0,c.handlePasteEvent)(L,this.textarea,this.coreService,this.optionsService);this.register((0,u.addDisposableDomListener)(this.textarea,"paste",P)),this.register((0,u.addDisposableDomListener)(this.element,"paste",P)),j.isFirefox?this.register((0,u.addDisposableDomListener)(this.element,"mousedown",(L=>{L.button===2&&(0,c.rightClickHandler)(L,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))):this.register((0,u.addDisposableDomListener)(this.element,"contextmenu",(L=>{(0,c.rightClickHandler)(L,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))),j.isLinux&&this.register((0,u.addDisposableDomListener)(this.element,"auxclick",(L=>{L.button===1&&(0,c.moveTextAreaUnderMouseCursor)(L,this.textarea,this.screenElement)})))}_bindKeys(){this.register((0,u.addDisposableDomListener)(this.textarea,"keyup",(P=>this._keyUp(P)),!0)),this.register((0,u.addDisposableDomListener)(this.textarea,"keydown",(P=>this._keyDown(P)),!0)),this.register((0,u.addDisposableDomListener)(this.textarea,"keypress",(P=>this._keyPress(P)),!0)),this.register((0,u.addDisposableDomListener)(this.textarea,"compositionstart",(()=>this._compositionHelper.compositionstart()))),this.register((0,u.addDisposableDomListener)(this.textarea,"compositionupdate",(P=>this._compositionHelper.compositionupdate(P)))),this.register((0,u.addDisposableDomListener)(this.textarea,"compositionend",(()=>this._compositionHelper.compositionend()))),this.register((0,u.addDisposableDomListener)(this.textarea,"input",(P=>this._inputEvent(P)),!0)),this.register(this.onRender((()=>this._compositionHelper.updateCompositionElements())))}open(P){var K;if(!P)throw new Error("Terminal requires a parent element.");if(P.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),((K=this.element)==null?void 0:K.ownerDocument.defaultView)&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=P.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),P.appendChild(this.element);const L=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),L.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,u.addDisposableDomListener)(this.screenElement,"mousemove",(W=>this.updateCursorStyle(W)))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),L.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",f.promptLabel),j.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(S.CoreBrowserService,this.textarea,P.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(E.ICoreBrowserService,this._coreBrowserService),this.register((0,u.addDisposableDomListener)(this.textarea,"focus",(W=>this._handleTextAreaFocus(W)))),this.register((0,u.addDisposableDomListener)(this.textarea,"blur",(()=>this._handleTextAreaBlur()))),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(v.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(E.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(A.ThemeService),this._instantiationService.setService(E.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(b.CharacterJoinerService),this._instantiationService.setService(E.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(k.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(E.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange((W=>this._onRender.fire(W)))),this.onResize((W=>this._renderService.resize(W.cols,W.rows))),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(m.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(x.MouseService),this._instantiationService.setService(E.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(h.Linkifier,this.screenElement)),this.element.appendChild(L);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(_.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines((W=>this.scrollLines(W.amount,W.suppressScrollEvent,1))),this.register(this._inputHandler.onRequestSyncScrollBar((()=>this.viewport.syncScrollArea()))),this.register(this.viewport),this.register(this.onCursorMove((()=>{this._renderService.handleCursorMove(),this._syncTextArea()}))),this.register(this.onResize((()=>this._renderService.handleResize(this.cols,this.rows)))),this.register(this.onBlur((()=>this._renderService.handleBlur()))),this.register(this.onFocus((()=>this._renderService.handleFocus()))),this.register(this._renderService.onDimensionsChange((()=>this.viewport.syncScrollArea()))),this._selectionService=this.register(this._instantiationService.createInstance(w.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(E.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines((W=>this.scrollLines(W.amount,W.suppressScrollEvent)))),this.register(this._selectionService.onSelectionChange((()=>this._onSelectionChange.fire()))),this.register(this._selectionService.onRequestRedraw((W=>this._renderService.handleSelectionChanged(W.start,W.end,W.columnSelectMode)))),this.register(this._selectionService.onLinuxMouseSelection((W=>{this.textarea.value=W,this.textarea.focus(),this.textarea.select()}))),this.register(this._onScroll.event((W=>{this.viewport.syncScrollArea(),this._selectionService.refresh()}))),this.register((0,u.addDisposableDomListener)(this._viewportElement,"scroll",(()=>this._selectionService.refresh()))),this.register(this._instantiationService.createInstance(y.BufferDecorationRenderer,this.screenElement)),this.register((0,u.addDisposableDomListener)(this.element,"mousedown",(W=>this._selectionService.handleMouseDown(W)))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(R.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",(W=>this._handleScreenReaderModeOptionChange(W)))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(p.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",(W=>{!this._overviewRulerRenderer&&W&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(p.OverviewRulerRenderer,this._viewportElement,this.screenElement)))})),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(g.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){const P=this,L=this.element;function K(Y){const ge=P._mouseService.getMouseReportCoords(Y,P.screenElement);if(!ge)return!1;let Be,De;switch(Y.overrideType||Y.type){case"mousemove":De=32,Y.buttons===void 0?(Be=3,Y.button!==void 0&&(Be=Y.button<3?Y.button:3)):Be=1&Y.buttons?0:4&Y.buttons?1:2&Y.buttons?2:3;break;case"mouseup":De=0,Be=Y.button<3?Y.button:3;break;case"mousedown":De=1,Be=Y.button<3?Y.button:3;break;case"wheel":if(P._customWheelEventHandler&&P._customWheelEventHandler(Y)===!1||P.viewport.getLinesScrolled(Y)===0)return!1;De=Y.deltaY<0?0:1,Be=4;break;default:return!1}return!(De===void 0||Be===void 0||Be>4)&&P.coreMouseService.triggerMouseEvent({col:ge.col,row:ge.row,x:ge.x,y:ge.y,button:Be,action:De,ctrl:Y.ctrlKey,alt:Y.altKey,shift:Y.shiftKey})}const W={mouseup:null,wheel:null,mousedrag:null,mousemove:null},Q={mouseup:Y=>(K(Y),Y.buttons||(this._document.removeEventListener("mouseup",W.mouseup),W.mousedrag&&this._document.removeEventListener("mousemove",W.mousedrag)),this.cancel(Y)),wheel:Y=>(K(Y),this.cancel(Y,!0)),mousedrag:Y=>{Y.buttons&&K(Y)},mousemove:Y=>{Y.buttons||K(Y)}};this.register(this.coreMouseService.onProtocolChange((Y=>{Y?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(Y)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&Y?W.mousemove||(L.addEventListener("mousemove",Q.mousemove),W.mousemove=Q.mousemove):(L.removeEventListener("mousemove",W.mousemove),W.mousemove=null),16&Y?W.wheel||(L.addEventListener("wheel",Q.wheel,{passive:!1}),W.wheel=Q.wheel):(L.removeEventListener("wheel",W.wheel),W.wheel=null),2&Y?W.mouseup||(W.mouseup=Q.mouseup):(this._document.removeEventListener("mouseup",W.mouseup),W.mouseup=null),4&Y?W.mousedrag||(W.mousedrag=Q.mousedrag):(this._document.removeEventListener("mousemove",W.mousedrag),W.mousedrag=null)}))),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,u.addDisposableDomListener)(L,"mousedown",(Y=>{if(Y.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(Y))return K(Y),W.mouseup&&this._document.addEventListener("mouseup",W.mouseup),W.mousedrag&&this._document.addEventListener("mousemove",W.mousedrag),this.cancel(Y)}))),this.register((0,u.addDisposableDomListener)(L,"wheel",(Y=>{if(!W.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(Y)===!1)return!1;if(!this.buffer.hasScrollback){const ge=this.viewport.getLinesScrolled(Y);if(ge===0)return;const Be=$.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(Y.deltaY<0?"A":"B");let De="";for(let Ue=0;Ue<Math.abs(ge);Ue++)De+=Be;return this.coreService.triggerDataEvent(De,!0),this.cancel(Y,!0)}return this.viewport.handleWheel(Y)?this.cancel(Y):void 0}}),{passive:!1})),this.register((0,u.addDisposableDomListener)(L,"touchstart",(Y=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(Y),this.cancel(Y)}),{passive:!0})),this.register((0,u.addDisposableDomListener)(L,"touchmove",(Y=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(Y)?void 0:this.cancel(Y)}),{passive:!1}))}refresh(P,L){var K;(K=this._renderService)==null||K.refreshRows(P,L)}updateCursorStyle(P){var L;(L=this._selectionService)!=null&&L.shouldColumnSelect(P)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(P,L,K=0){var W;K===1?(super.scrollLines(P,L,K),this.refresh(0,this.rows-1)):(W=this.viewport)==null||W.scrollLines(P)}paste(P){(0,c.paste)(P,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(P){this._customKeyEventHandler=P}attachCustomWheelEventHandler(P){this._customWheelEventHandler=P}registerLinkProvider(P){return this._linkProviderService.registerLinkProvider(P)}registerCharacterJoiner(P){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const L=this._characterJoinerService.register(P);return this.refresh(0,this.rows-1),L}deregisterCharacterJoiner(P){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(P)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(P){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+P)}registerDecoration(P){return this._decorationService.registerDecoration(P)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(P,L,K){this._selectionService.setSelection(P,L,K)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var P;(P=this._selectionService)==null||P.clearSelection()}selectAll(){var P;(P=this._selectionService)==null||P.selectAll()}selectLines(P,L){var K;(K=this._selectionService)==null||K.selectLines(P,L)}_keyDown(P){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(P)===!1)return!1;const L=this.browser.isMac&&this.options.macOptionIsMeta&&P.altKey;if(!L&&!this._compositionHelper.keydown(P))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;L||P.key!=="Dead"&&P.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const K=(0,q.evaluateKeyboardEvent)(P,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(P),K.type===3||K.type===2){const W=this.rows-1;return this.scrollLines(K.type===2?-W:W),this.cancel(P,!0)}return K.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,P)||(K.cancel&&this.cancel(P,!0),!K.key||!!(P.key&&!P.ctrlKey&&!P.altKey&&!P.metaKey&&P.key.length===1&&P.key.charCodeAt(0)>=65&&P.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(K.key!==$.C0.ETX&&K.key!==$.C0.CR||(this.textarea.value=""),this._onKey.fire({key:K.key,domEvent:P}),this._showCursor(),this.coreService.triggerDataEvent(K.key,!0),!this.optionsService.rawOptions.screenReaderMode||P.altKey||P.ctrlKey?this.cancel(P,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(P,L){const K=P.isMac&&!this.options.macOptionIsMeta&&L.altKey&&!L.ctrlKey&&!L.metaKey||P.isWindows&&L.altKey&&L.ctrlKey&&!L.metaKey||P.isWindows&&L.getModifierState("AltGraph");return L.type==="keypress"?K:K&&(!L.keyCode||L.keyCode>47)}_keyUp(P){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(P)===!1||((function(L){return L.keyCode===16||L.keyCode===17||L.keyCode===18})(P)||this.focus(),this.updateCursorStyle(P),this._keyPressHandled=!1)}_keyPress(P){let L;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(P)===!1)return!1;if(this.cancel(P),P.charCode)L=P.charCode;else if(P.which===null||P.which===void 0)L=P.keyCode;else{if(P.which===0||P.charCode===0)return!1;L=P.which}return!(!L||(P.altKey||P.ctrlKey||P.metaKey)&&!this._isThirdLevelShift(this.browser,P)||(L=String.fromCharCode(L),this._onKey.fire({key:L,domEvent:P}),this._showCursor(),this.coreService.triggerDataEvent(L,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(P){if(P.data&&P.inputType==="insertText"&&(!P.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const L=P.data;return this.coreService.triggerDataEvent(L,!0),this.cancel(P),!0}return!1}resize(P,L){P!==this.cols||L!==this.rows?super.resize(P,L):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(P,L){var K,W;(K=this._charSizeService)==null||K.measure(),(W=this.viewport)==null||W.syncScrollArea(!0)}clear(){var P;if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let L=1;L<this.rows;L++)this.buffer.lines.push(this.buffer.getBlankLine(z.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),(P=this.viewport)==null||P.reset(),this.refresh(0,this.rows-1)}}reset(){var L,K;this.options.rows=this.rows,this.options.cols=this.cols;const P=this._customKeyEventHandler;this._setup(),super.reset(),(L=this._selectionService)==null||L.reset(),this._decorationService.reset(),(K=this.viewport)==null||K.reset(),this._customKeyEventHandler=P,this.refresh(0,this.rows-1)}clearTextureAtlas(){var P;(P=this._renderService)==null||P.clearTextureAtlas()}_reportFocus(){var P;(P=this.element)!=null&&P.classList.contains("focus")?this.coreService.triggerDataEvent($.C0.ESC+"[I"):this.coreService.triggerDataEvent($.C0.ESC+"[O")}_reportWindowsOptions(P){if(this._renderService)switch(P){case F.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const L=this._renderService.dimensions.css.canvas.width.toFixed(0),K=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${$.C0.ESC}[4;${K};${L}t`);break;case F.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const W=this._renderService.dimensions.css.cell.width.toFixed(0),Q=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${$.C0.ESC}[6;${Q};${W}t`)}}cancel(P,L){if(this.options.cancelEvents||L)return P.preventDefault(),P.stopPropagation(),!1}}o.Terminal=ie},9924:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TimeBasedDebouncer=void 0,o.TimeBasedDebouncer=class{constructor(a,c=1e3){this._renderCallback=a,this._debounceThresholdMS=c,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(a,c,u){this._rowCount=u,a=a!==void 0?a:0,c=c!==void 0?c:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,c):c;const h=Date.now();if(h-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=h,this._innerRefresh();else if(!this._additionalRefreshRequested){const f=h-this._lastRefreshMs,d=this._debounceThresholdMS-f;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout((()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0}),d)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const a=Math.max(this._rowStart,0),c=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,c)}}},1680:function(l,o,a){var c=this&&this.__decorate||function(m,g,v,b){var S,x=arguments.length,k=x<3?g:b===null?b=Object.getOwnPropertyDescriptor(g,v):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(m,g,v,b);else for(var w=m.length-1;w>=0;w--)(S=m[w])&&(k=(x<3?S(k):x>3?S(g,v,k):S(g,v))||k);return x>3&&k&&Object.defineProperty(g,v,k),k},u=this&&this.__param||function(m,g){return function(v,b){g(v,b,m)}};Object.defineProperty(o,"__esModule",{value:!0}),o.Viewport=void 0;const h=a(3656),f=a(4725),d=a(8460),_=a(844),y=a(2585);let p=o.Viewport=class extends _.Disposable{constructor(m,g,v,b,S,x,k,w){super(),this._viewportElement=m,this._scrollArea=g,this._bufferService=v,this._optionsService=b,this._charSizeService=S,this._renderService=x,this._coreBrowserService=k,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new d.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,h.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((E=>this._activeBuffer=E.activeBuffer))),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange((E=>this._renderDimensions=E))),this._handleThemeChange(w.colors),this.register(w.onChangeColors((E=>this._handleThemeChange(E)))),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.syncScrollArea()))),setTimeout((()=>this.syncScrollArea()))}_handleThemeChange(m){this._viewportElement.style.backgroundColor=m.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame((()=>this.syncScrollArea()))}_refresh(m){if(m)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const g=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==g&&(this._lastRecordedBufferHeight=g,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const m=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==m&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=m),this._refreshAnimationFrame=null}syncScrollArea(m=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(m);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(m)}_handleScroll(m){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const g=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:g,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const m=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(m*(this._smoothScrollState.target-this._smoothScrollState.origin)),m<1?this._coreBrowserService.window.requestAnimationFrame((()=>this._smoothScroll())):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(m,g){const v=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(g<0&&this._viewportElement.scrollTop!==0||g>0&&v<this._lastRecordedBufferHeight)||(m.cancelable&&m.preventDefault(),!1)}handleWheel(m){const g=this._getPixelsScrolled(m);return g!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+g:this._smoothScrollState.target+=g,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=g,this._bubbleScroll(m,g))}scrollLines(m){if(m!==0)if(this._optionsService.rawOptions.smoothScrollDuration){const g=m*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+g,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:m,suppressScrollEvent:!1})}_getPixelsScrolled(m){if(m.deltaY===0||m.shiftKey)return 0;let g=this._applyScrollModifier(m.deltaY,m);return m.deltaMode===WheelEvent.DOM_DELTA_LINE?g*=this._currentRowHeight:m.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(g*=this._currentRowHeight*this._bufferService.rows),g}getBufferElements(m,g){var w;let v,b="";const S=[],x=g??this._bufferService.buffer.lines.length,k=this._bufferService.buffer.lines;for(let E=m;E<x;E++){const A=k.get(E);if(!A)continue;const T=(w=k.get(E+1))==null?void 0:w.isWrapped;if(b+=A.translateToString(!T),!T||E===k.length-1){const B=document.createElement("div");B.textContent=b,S.push(B),b.length>0&&(v=B),b=""}}return{bufferElements:S,cursorElement:v}}getLinesScrolled(m){if(m.deltaY===0||m.shiftKey)return 0;let g=this._applyScrollModifier(m.deltaY,m);return m.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(g/=this._currentRowHeight+0,this._wheelPartialScroll+=g,g=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):m.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(g*=this._bufferService.rows),g}_applyScrollModifier(m,g){const v=this._optionsService.rawOptions.fastScrollModifier;return v==="alt"&&g.altKey||v==="ctrl"&&g.ctrlKey||v==="shift"&&g.shiftKey?m*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:m*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(m){this._lastTouchY=m.touches[0].pageY}handleTouchMove(m){const g=this._lastTouchY-m.touches[0].pageY;return this._lastTouchY=m.touches[0].pageY,g!==0&&(this._viewportElement.scrollTop+=g,this._bubbleScroll(m,g))}};o.Viewport=p=c([u(2,y.IBufferService),u(3,y.IOptionsService),u(4,f.ICharSizeService),u(5,f.IRenderService),u(6,f.ICoreBrowserService),u(7,f.IThemeService)],p)},3107:function(l,o,a){var c=this&&this.__decorate||function(y,p,m,g){var v,b=arguments.length,S=b<3?p:g===null?g=Object.getOwnPropertyDescriptor(p,m):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(y,p,m,g);else for(var x=y.length-1;x>=0;x--)(v=y[x])&&(S=(b<3?v(S):b>3?v(p,m,S):v(p,m))||S);return b>3&&S&&Object.defineProperty(p,m,S),S},u=this&&this.__param||function(y,p){return function(m,g){p(m,g,y)}};Object.defineProperty(o,"__esModule",{value:!0}),o.BufferDecorationRenderer=void 0;const h=a(4725),f=a(844),d=a(2585);let _=o.BufferDecorationRenderer=class extends f.Disposable{constructor(y,p,m,g,v){super(),this._screenElement=y,this._bufferService=p,this._coreBrowserService=m,this._decorationService=g,this._renderService=v,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange((()=>this._doRefreshDecorations()))),this.register(this._renderService.onDimensionsChange((()=>{this._dimensionsChanged=!0,this._queueRefresh()}))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt}))),this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh()))),this.register(this._decorationService.onDecorationRemoved((b=>this._removeDecoration(b)))),this.register((0,f.toDisposable)((()=>{this._container.remove(),this._decorationElements.clear()})))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback((()=>{this._doRefreshDecorations(),this._animationFrame=void 0})))}_doRefreshDecorations(){for(const y of this._decorationService.decorations)this._renderDecoration(y);this._dimensionsChanged=!1}_renderDecoration(y){this._refreshStyle(y),this._dimensionsChanged&&this._refreshXPosition(y)}_createElement(y){var g;const p=this._coreBrowserService.mainDocument.createElement("div");p.classList.add("xterm-decoration"),p.classList.toggle("xterm-decoration-top-layer",((g=y==null?void 0:y.options)==null?void 0:g.layer)==="top"),p.style.width=`${Math.round((y.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,p.style.height=(y.options.height||1)*this._renderService.dimensions.css.cell.height+"px",p.style.top=(y.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",p.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const m=y.options.x??0;return m&&m>this._bufferService.cols&&(p.style.display="none"),this._refreshXPosition(y,p),p}_refreshStyle(y){const p=y.marker.line-this._bufferService.buffers.active.ydisp;if(p<0||p>=this._bufferService.rows)y.element&&(y.element.style.display="none",y.onRenderEmitter.fire(y.element));else{let m=this._decorationElements.get(y);m||(m=this._createElement(y),y.element=m,this._decorationElements.set(y,m),this._container.appendChild(m),y.onDispose((()=>{this._decorationElements.delete(y),m.remove()}))),m.style.top=p*this._renderService.dimensions.css.cell.height+"px",m.style.display=this._altBufferIsActive?"none":"block",y.onRenderEmitter.fire(m)}}_refreshXPosition(y,p=y.element){if(!p)return;const m=y.options.x??0;(y.options.anchor||"left")==="right"?p.style.right=m?m*this._renderService.dimensions.css.cell.width+"px":"":p.style.left=m?m*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(y){var p;(p=this._decorationElements.get(y))==null||p.remove(),this._decorationElements.delete(y),y.dispose()}};o.BufferDecorationRenderer=_=c([u(1,d.IBufferService),u(2,h.ICoreBrowserService),u(3,d.IDecorationService),u(4,h.IRenderService)],_)},5871:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ColorZoneStore=void 0,o.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(a){if(a.options.overviewRulerOptions){for(const c of this._zones)if(c.color===a.options.overviewRulerOptions.color&&c.position===a.options.overviewRulerOptions.position){if(this._lineIntersectsZone(c,a.marker.line))return;if(this._lineAdjacentToZone(c,a.marker.line,a.options.overviewRulerOptions.position))return void this._addLineToZone(c,a.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=a.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=a.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=a.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=a.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:a.options.overviewRulerOptions.color,position:a.options.overviewRulerOptions.position,startBufferLine:a.marker.line,endBufferLine:a.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(a){this._linePadding=a}_lineIntersectsZone(a,c){return c>=a.startBufferLine&&c<=a.endBufferLine}_lineAdjacentToZone(a,c,u){return c>=a.startBufferLine-this._linePadding[u||"full"]&&c<=a.endBufferLine+this._linePadding[u||"full"]}_addLineToZone(a,c){a.startBufferLine=Math.min(a.startBufferLine,c),a.endBufferLine=Math.max(a.endBufferLine,c)}}},5744:function(l,o,a){var c=this&&this.__decorate||function(v,b,S,x){var k,w=arguments.length,E=w<3?b:x===null?x=Object.getOwnPropertyDescriptor(b,S):x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(v,b,S,x);else for(var A=v.length-1;A>=0;A--)(k=v[A])&&(E=(w<3?k(E):w>3?k(b,S,E):k(b,S))||E);return w>3&&E&&Object.defineProperty(b,S,E),E},u=this&&this.__param||function(v,b){return function(S,x){b(S,x,v)}};Object.defineProperty(o,"__esModule",{value:!0}),o.OverviewRulerRenderer=void 0;const h=a(5871),f=a(4725),d=a(844),_=a(2585),y={full:0,left:0,center:0,right:0},p={full:0,left:0,center:0,right:0},m={full:0,left:0,center:0,right:0};let g=o.OverviewRulerRenderer=class extends d.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(v,b,S,x,k,w,E){var T;super(),this._viewportElement=v,this._screenElement=b,this._bufferService=S,this._decorationService=x,this._renderService=k,this._optionsService=w,this._coreBrowserService=E,this._colorZoneStore=new h.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(T=this._viewportElement.parentElement)==null||T.insertBefore(this._canvas,this._viewportElement);const A=this._canvas.getContext("2d");if(!A)throw new Error("Ctx cannot be null");this._ctx=A,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,d.toDisposable)((()=>{var B;(B=this._canvas)==null||B.remove()})))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh(void 0,!0)))),this.register(this._decorationService.onDecorationRemoved((()=>this._queueRefresh(void 0,!0))))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"}))),this.register(this._bufferService.onScroll((()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender((()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)}))),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",(()=>this._queueRefresh(!0)))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh(!0)))),this._queueRefresh(!0)}_refreshDrawConstants(){const v=Math.floor(this._canvas.width/3),b=Math.ceil(this._canvas.width/3);p.full=this._canvas.width,p.left=v,p.center=b,p.right=v,this._refreshDrawHeightConstants(),m.full=0,m.left=0,m.center=p.left,m.right=p.left+p.center}_refreshDrawHeightConstants(){y.full=Math.round(2*this._coreBrowserService.dpr);const v=this._canvas.height/this._bufferService.buffer.lines.length,b=Math.round(Math.max(Math.min(v,12),6)*this._coreBrowserService.dpr);y.left=b,y.center=b,y.right=b}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*y.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*y.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*y.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*y.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const b of this._decorationService.decorations)this._colorZoneStore.addDecoration(b);this._ctx.lineWidth=1;const v=this._colorZoneStore.zones;for(const b of v)b.position!=="full"&&this._renderColorZone(b);for(const b of v)b.position==="full"&&this._renderColorZone(b);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(v){this._ctx.fillStyle=v.color,this._ctx.fillRect(m[v.position||"full"],Math.round((this._canvas.height-1)*(v.startBufferLine/this._bufferService.buffers.active.lines.length)-y[v.position||"full"]/2),p[v.position||"full"],Math.round((this._canvas.height-1)*((v.endBufferLine-v.startBufferLine)/this._bufferService.buffers.active.lines.length)+y[v.position||"full"]))}_queueRefresh(v,b){this._shouldUpdateDimensions=v||this._shouldUpdateDimensions,this._shouldUpdateAnchor=b||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._refreshDecorations(),this._animationFrame=void 0})))}};o.OverviewRulerRenderer=g=c([u(2,_.IBufferService),u(3,_.IDecorationService),u(4,f.IRenderService),u(5,_.IOptionsService),u(6,f.ICoreBrowserService)],g)},2950:function(l,o,a){var c=this&&this.__decorate||function(y,p,m,g){var v,b=arguments.length,S=b<3?p:g===null?g=Object.getOwnPropertyDescriptor(p,m):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(y,p,m,g);else for(var x=y.length-1;x>=0;x--)(v=y[x])&&(S=(b<3?v(S):b>3?v(p,m,S):v(p,m))||S);return b>3&&S&&Object.defineProperty(p,m,S),S},u=this&&this.__param||function(y,p){return function(m,g){p(m,g,y)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CompositionHelper=void 0;const h=a(4725),f=a(2585),d=a(2584);let _=o.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(y,p,m,g,v,b){this._textarea=y,this._compositionView=p,this._bufferService=m,this._optionsService=g,this._coreService=v,this._renderService=b,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(y){this._compositionView.textContent=y.data,this.updateCompositionElements(),setTimeout((()=>{this._compositionPosition.end=this._textarea.value.length}),0)}compositionend(){this._finalizeComposition(!0)}keydown(y){if(this._isComposing||this._isSendingComposition){if(y.keyCode===229||y.keyCode===16||y.keyCode===17||y.keyCode===18)return!1;this._finalizeComposition(!1)}return y.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(y){if(this._compositionView.classList.remove("active"),this._isComposing=!1,y){const p={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout((()=>{if(this._isSendingComposition){let m;this._isSendingComposition=!1,p.start+=this._dataAlreadySent.length,m=this._isComposing?this._textarea.value.substring(p.start,p.end):this._textarea.value.substring(p.start),m.length>0&&this._coreService.triggerDataEvent(m,!0)}}),0)}else{this._isSendingComposition=!1;const p=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(p,!0)}}_handleAnyTextareaChanges(){const y=this._textarea.value;setTimeout((()=>{if(!this._isComposing){const p=this._textarea.value,m=p.replace(y,"");this._dataAlreadySent=m,p.length>y.length?this._coreService.triggerDataEvent(m,!0):p.length<y.length?this._coreService.triggerDataEvent(`${d.C0.DEL}`,!0):p.length===y.length&&p!==y&&this._coreService.triggerDataEvent(p,!0)}}),0)}updateCompositionElements(y){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const p=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),m=this._renderService.dimensions.css.cell.height,g=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,v=p*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=v+"px",this._compositionView.style.top=g+"px",this._compositionView.style.height=m+"px",this._compositionView.style.lineHeight=m+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const b=this._compositionView.getBoundingClientRect();this._textarea.style.left=v+"px",this._textarea.style.top=g+"px",this._textarea.style.width=Math.max(b.width,1)+"px",this._textarea.style.height=Math.max(b.height,1)+"px",this._textarea.style.lineHeight=b.height+"px"}y||setTimeout((()=>this.updateCompositionElements(!0)),0)}}};o.CompositionHelper=_=c([u(2,f.IBufferService),u(3,f.IOptionsService),u(4,f.ICoreService),u(5,h.IRenderService)],_)},9806:(l,o)=>{function a(c,u,h){const f=h.getBoundingClientRect(),d=c.getComputedStyle(h),_=parseInt(d.getPropertyValue("padding-left")),y=parseInt(d.getPropertyValue("padding-top"));return[u.clientX-f.left-_,u.clientY-f.top-y]}Object.defineProperty(o,"__esModule",{value:!0}),o.getCoords=o.getCoordsRelativeToElement=void 0,o.getCoordsRelativeToElement=a,o.getCoords=function(c,u,h,f,d,_,y,p,m){if(!_)return;const g=a(c,u,h);return g?(g[0]=Math.ceil((g[0]+(m?y/2:0))/y),g[1]=Math.ceil(g[1]/p),g[0]=Math.min(Math.max(g[0],1),f+(m?1:0)),g[1]=Math.min(Math.max(g[1],1),d),g):void 0}},9504:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.moveToCellSequence=void 0;const c=a(2584);function u(p,m,g,v){const b=p-h(p,g),S=m-h(m,g),x=Math.abs(b-S)-(function(k,w,E){let A=0;const T=k-h(k,E),B=w-h(w,E);for(let O=0;O<Math.abs(T-B);O++){const N=f(k,w)==="A"?-1:1,j=E.buffer.lines.get(T+N*O);j!=null&&j.isWrapped&&A++}return A})(p,m,g);return y(x,_(f(p,m),v))}function h(p,m){let g=0,v=m.buffer.lines.get(p),b=v==null?void 0:v.isWrapped;for(;b&&p>=0&&p<m.rows;)g++,v=m.buffer.lines.get(--p),b=v==null?void 0:v.isWrapped;return g}function f(p,m){return p>m?"A":"B"}function d(p,m,g,v,b,S){let x=p,k=m,w="";for(;x!==g||k!==v;)x+=b?1:-1,b&&x>S.cols-1?(w+=S.buffer.translateBufferLineToString(k,!1,p,x),x=0,p=0,k++):!b&&x<0&&(w+=S.buffer.translateBufferLineToString(k,!1,0,p+1),x=S.cols-1,p=x,k--);return w+S.buffer.translateBufferLineToString(k,!1,p,x)}function _(p,m){const g=m?"O":"[";return c.C0.ESC+g+p}function y(p,m){p=Math.floor(p);let g="";for(let v=0;v<p;v++)g+=m;return g}o.moveToCellSequence=function(p,m,g,v){const b=g.buffer.x,S=g.buffer.y;if(!g.buffer.hasScrollback)return(function(w,E,A,T,B,O){return u(E,T,B,O).length===0?"":y(d(w,E,w,E-h(E,B),!1,B).length,_("D",O))})(b,S,0,m,g,v)+u(S,m,g,v)+(function(w,E,A,T,B,O){let N;N=u(E,T,B,O).length>0?T-h(T,B):E;const j=T,z=(function($,q,M,C,I,F){let R;return R=u(M,C,I,F).length>0?C-h(C,I):q,$<M&&R<=C||$>=M&&R<C?"C":"D"})(w,E,A,T,B,O);return y(d(w,N,A,j,z==="C",B).length,_(z,O))})(b,S,p,m,g,v);let x;if(S===m)return x=b>p?"D":"C",y(Math.abs(b-p),_(x,v));x=S>m?"D":"C";const k=Math.abs(S-m);return y((function(w,E){return E.cols-w})(S>m?p:b,g)+(k-1)*g.cols+1+((S>m?b:p)-1),_(x,v))}},1296:function(l,o,a){var c=this&&this.__decorate||function(O,N,j,z){var $,q=arguments.length,M=q<3?N:z===null?z=Object.getOwnPropertyDescriptor(N,j):z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(O,N,j,z);else for(var C=O.length-1;C>=0;C--)($=O[C])&&(M=(q<3?$(M):q>3?$(N,j,M):$(N,j))||M);return q>3&&M&&Object.defineProperty(N,j,M),M},u=this&&this.__param||function(O,N){return function(j,z){N(j,z,O)}};Object.defineProperty(o,"__esModule",{value:!0}),o.DomRenderer=void 0;const h=a(3787),f=a(2550),d=a(2223),_=a(6171),y=a(6052),p=a(4725),m=a(8055),g=a(8460),v=a(844),b=a(2585),S="xterm-dom-renderer-owner-",x="xterm-rows",k="xterm-fg-",w="xterm-bg-",E="xterm-focus",A="xterm-selection";let T=1,B=o.DomRenderer=class extends v.Disposable{constructor(O,N,j,z,$,q,M,C,I,F,R,X,ie){super(),this._terminal=O,this._document=N,this._element=j,this._screenElement=z,this._viewportElement=$,this._helperContainer=q,this._linkifier2=M,this._charSizeService=I,this._optionsService=F,this._bufferService=R,this._coreBrowserService=X,this._themeService=ie,this._terminalClass=T++,this._rowElements=[],this._selectionRenderModel=(0,y.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new g.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(x),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(A),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,_.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._themeService.onChangeColors((re=>this._injectCss(re)))),this._injectCss(this._themeService.colors),this._rowFactory=C.createInstance(h.DomRendererRowFactory,document),this._element.classList.add(S+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline((re=>this._handleLinkHover(re)))),this.register(this._linkifier2.onHideLinkUnderline((re=>this._handleLinkLeave(re)))),this.register((0,v.toDisposable)((()=>{this._element.classList.remove(S+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()}))),this._widthCache=new f.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const O=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*O,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*O),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/O),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/O),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const j of this._rowElements)j.style.width=`${this.dimensions.css.canvas.width}px`,j.style.height=`${this.dimensions.css.cell.height}px`,j.style.lineHeight=`${this.dimensions.css.cell.height}px`,j.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const N=`${this._terminalSelector} .${x} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=N,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(O){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let N=`${this._terminalSelector} .${x} { color: ${O.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;N+=`${this._terminalSelector} .${x} .xterm-dim { color: ${m.color.multiplyOpacity(O.foreground,.5).css};}`,N+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;const j=`blink_underline_${this._terminalClass}`,z=`blink_bar_${this._terminalClass}`,$=`blink_block_${this._terminalClass}`;N+=`@keyframes ${j} { 50% {  border-bottom-style: hidden; }}`,N+=`@keyframes ${z} { 50% {  box-shadow: none; }}`,N+=`@keyframes ${$} { 0% {  background-color: ${O.cursor.css};  color: ${O.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${O.cursor.css}; }}`,N+=`${this._terminalSelector} .${x}.${E} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${j} 1s step-end infinite;}${this._terminalSelector} .${x}.${E} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${z} 1s step-end infinite;}${this._terminalSelector} .${x}.${E} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${$} 1s step-end infinite;}${this._terminalSelector} .${x} .xterm-cursor.xterm-cursor-block { background-color: ${O.cursor.css}; color: ${O.cursorAccent.css};}${this._terminalSelector} .${x} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${O.cursor.css} !important; color: ${O.cursorAccent.css} !important;}${this._terminalSelector} .${x} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${O.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${x} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${O.cursor.css} inset;}${this._terminalSelector} .${x} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${O.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,N+=`${this._terminalSelector} .${A} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${A} div { position: absolute; background-color: ${O.selectionBackgroundOpaque.css};}${this._terminalSelector} .${A} div { position: absolute; background-color: ${O.selectionInactiveBackgroundOpaque.css};}`;for(const[q,M]of O.ansi.entries())N+=`${this._terminalSelector} .${k}${q} { color: ${M.css}; }${this._terminalSelector} .${k}${q}.xterm-dim { color: ${m.color.multiplyOpacity(M,.5).css}; }${this._terminalSelector} .${w}${q} { background-color: ${M.css}; }`;N+=`${this._terminalSelector} .${k}${d.INVERTED_DEFAULT_COLOR} { color: ${m.color.opaque(O.background).css}; }${this._terminalSelector} .${k}${d.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${m.color.multiplyOpacity(m.color.opaque(O.background),.5).css}; }${this._terminalSelector} .${w}${d.INVERTED_DEFAULT_COLOR} { background-color: ${O.foreground.css}; }`,this._themeStyleElement.textContent=N}_setDefaultSpacing(){const O=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${O}px`,this._rowFactory.defaultSpacing=O}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(O,N){for(let j=this._rowElements.length;j<=N;j++){const z=this._document.createElement("div");this._rowContainer.appendChild(z),this._rowElements.push(z)}for(;this._rowElements.length>N;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(O,N){this._refreshRowElements(O,N),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(E),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(E),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(O,N,j){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(O,N,j),this.renderRows(0,this._bufferService.rows-1),!O||!N)return;this._selectionRenderModel.update(this._terminal,O,N,j);const z=this._selectionRenderModel.viewportStartRow,$=this._selectionRenderModel.viewportEndRow,q=this._selectionRenderModel.viewportCappedStartRow,M=this._selectionRenderModel.viewportCappedEndRow;if(q>=this._bufferService.rows||M<0)return;const C=this._document.createDocumentFragment();if(j){const I=O[0]>N[0];C.appendChild(this._createSelectionElement(q,I?N[0]:O[0],I?O[0]:N[0],M-q+1))}else{const I=z===q?O[0]:0,F=q===$?N[0]:this._bufferService.cols;C.appendChild(this._createSelectionElement(q,I,F));const R=M-q-1;if(C.appendChild(this._createSelectionElement(q+1,0,this._bufferService.cols,R)),q!==M){const X=$===M?N[0]:this._bufferService.cols;C.appendChild(this._createSelectionElement(M,0,X))}}this._selectionContainer.appendChild(C)}_createSelectionElement(O,N,j,z=1){const $=this._document.createElement("div"),q=N*this.dimensions.css.cell.width;let M=this.dimensions.css.cell.width*(j-N);return q+M>this.dimensions.css.canvas.width&&(M=this.dimensions.css.canvas.width-q),$.style.height=z*this.dimensions.css.cell.height+"px",$.style.top=O*this.dimensions.css.cell.height+"px",$.style.left=`${q}px`,$.style.width=`${M}px`,$}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const O of this._rowElements)O.replaceChildren()}renderRows(O,N){const j=this._bufferService.buffer,z=j.ybase+j.y,$=Math.min(j.x,this._bufferService.cols-1),q=this._optionsService.rawOptions.cursorBlink,M=this._optionsService.rawOptions.cursorStyle,C=this._optionsService.rawOptions.cursorInactiveStyle;for(let I=O;I<=N;I++){const F=I+j.ydisp,R=this._rowElements[I],X=j.lines.get(F);if(!R||!X)break;R.replaceChildren(...this._rowFactory.createRow(X,F,F===z,M,C,$,q,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${S}${this._terminalClass}`}_handleLinkHover(O){this._setCellUnderline(O.x1,O.x2,O.y1,O.y2,O.cols,!0)}_handleLinkLeave(O){this._setCellUnderline(O.x1,O.x2,O.y1,O.y2,O.cols,!1)}_setCellUnderline(O,N,j,z,$,q){j<0&&(O=0),z<0&&(N=0);const M=this._bufferService.rows-1;j=Math.max(Math.min(j,M),0),z=Math.max(Math.min(z,M),0),$=Math.min($,this._bufferService.cols);const C=this._bufferService.buffer,I=C.ybase+C.y,F=Math.min(C.x,$-1),R=this._optionsService.rawOptions.cursorBlink,X=this._optionsService.rawOptions.cursorStyle,ie=this._optionsService.rawOptions.cursorInactiveStyle;for(let re=j;re<=z;++re){const P=re+C.ydisp,L=this._rowElements[re],K=C.lines.get(P);if(!L||!K)break;L.replaceChildren(...this._rowFactory.createRow(K,P,P===I,X,ie,F,R,this.dimensions.css.cell.width,this._widthCache,q?re===j?O:0:-1,q?(re===z?N:$)-1:-1))}}};o.DomRenderer=B=c([u(7,b.IInstantiationService),u(8,p.ICharSizeService),u(9,b.IOptionsService),u(10,b.IBufferService),u(11,p.ICoreBrowserService),u(12,p.IThemeService)],B)},3787:function(l,o,a){var c=this&&this.__decorate||function(x,k,w,E){var A,T=arguments.length,B=T<3?k:E===null?E=Object.getOwnPropertyDescriptor(k,w):E;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(x,k,w,E);else for(var O=x.length-1;O>=0;O--)(A=x[O])&&(B=(T<3?A(B):T>3?A(k,w,B):A(k,w))||B);return T>3&&B&&Object.defineProperty(k,w,B),B},u=this&&this.__param||function(x,k){return function(w,E){k(w,E,x)}};Object.defineProperty(o,"__esModule",{value:!0}),o.DomRendererRowFactory=void 0;const h=a(2223),f=a(643),d=a(511),_=a(2585),y=a(8055),p=a(4725),m=a(4269),g=a(6171),v=a(3734);let b=o.DomRendererRowFactory=class{constructor(x,k,w,E,A,T,B){this._document=x,this._characterJoinerService=k,this._optionsService=w,this._coreBrowserService=E,this._coreService=A,this._decorationService=T,this._themeService=B,this._workCell=new d.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(x,k,w){this._selectionStart=x,this._selectionEnd=k,this._columnSelectMode=w}createRow(x,k,w,E,A,T,B,O,N,j,z){const $=[],q=this._characterJoinerService.getJoinedCharacters(k),M=this._themeService.colors;let C,I=x.getNoBgTrimmedLength();w&&I<T+1&&(I=T+1);let F=0,R="",X=0,ie=0,re=0,P=!1,L=0,K=!1,W=0;const Q=[],Y=j!==-1&&z!==-1;for(let ge=0;ge<I;ge++){x.loadCell(ge,this._workCell);let Be=this._workCell.getWidth();if(Be===0)continue;let De=!1,Ue=ge,ce=this._workCell;if(q.length>0&&ge===q[0][0]){De=!0;const ke=q.shift();ce=new m.JoinedCellData(this._workCell,x.translateToString(!0,ke[0],ke[1]),ke[1]-ke[0]),Ue=ke[1]-1,Be=ce.getWidth()}const Ht=this._isCellInSelection(ge,k),vi=w&&ge===T,_i=Y&&ge>=j&&ge<=z;let Lt=!1;this._decorationService.forEachDecorationAtCell(ge,k,void 0,(ke=>{Lt=!0}));let yi=ce.getChars()||f.WHITESPACE_CELL_CHAR;if(yi===" "&&(ce.isUnderline()||ce.isOverline())&&(yi=""),W=Be*O-N.get(yi,ce.isBold(),ce.isItalic()),C){if(F&&(Ht&&K||!Ht&&!K&&ce.bg===X)&&(Ht&&K&&M.selectionForeground||ce.fg===ie)&&ce.extended.ext===re&&_i===P&&W===L&&!vi&&!De&&!Lt){ce.isInvisible()?R+=f.WHITESPACE_CELL_CHAR:R+=yi,F++;continue}F&&(C.textContent=R),C=this._document.createElement("span"),F=0,R=""}else C=this._document.createElement("span");if(X=ce.bg,ie=ce.fg,re=ce.extended.ext,P=_i,L=W,K=Ht,De&&T>=ge&&T<=Ue&&(T=ge),!this._coreService.isCursorHidden&&vi&&this._coreService.isCursorInitialized){if(Q.push("xterm-cursor"),this._coreBrowserService.isFocused)B&&Q.push("xterm-cursor-blink"),Q.push(E==="bar"?"xterm-cursor-bar":E==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(A)switch(A){case"outline":Q.push("xterm-cursor-outline");break;case"block":Q.push("xterm-cursor-block");break;case"bar":Q.push("xterm-cursor-bar");break;case"underline":Q.push("xterm-cursor-underline")}}if(ce.isBold()&&Q.push("xterm-bold"),ce.isItalic()&&Q.push("xterm-italic"),ce.isDim()&&Q.push("xterm-dim"),R=ce.isInvisible()?f.WHITESPACE_CELL_CHAR:ce.getChars()||f.WHITESPACE_CELL_CHAR,ce.isUnderline()&&(Q.push(`xterm-underline-${ce.extended.underlineStyle}`),R===" "&&(R=""),!ce.isUnderlineColorDefault()))if(ce.isUnderlineColorRGB())C.style.textDecorationColor=`rgb(${v.AttributeData.toColorRGB(ce.getUnderlineColor()).join(",")})`;else{let ke=ce.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&ce.isBold()&&ke<8&&(ke+=8),C.style.textDecorationColor=M.ansi[ke].css}ce.isOverline()&&(Q.push("xterm-overline"),R===" "&&(R="")),ce.isStrikethrough()&&Q.push("xterm-strikethrough"),_i&&(C.style.textDecoration="underline");let Xe=ce.getFgColor(),ai=ce.getFgColorMode(),pt=ce.getBgColor(),U=ce.getBgColorMode();const Z=!!ce.isInverse();if(Z){const ke=Xe;Xe=pt,pt=ke;const at=ai;ai=U,U=at}let le,de,_e,Ve=!1;switch(this._decorationService.forEachDecorationAtCell(ge,k,void 0,(ke=>{ke.options.layer!=="top"&&Ve||(ke.backgroundColorRGB&&(U=50331648,pt=ke.backgroundColorRGB.rgba>>8&16777215,le=ke.backgroundColorRGB),ke.foregroundColorRGB&&(ai=50331648,Xe=ke.foregroundColorRGB.rgba>>8&16777215,de=ke.foregroundColorRGB),Ve=ke.options.layer==="top")})),!Ve&&Ht&&(le=this._coreBrowserService.isFocused?M.selectionBackgroundOpaque:M.selectionInactiveBackgroundOpaque,pt=le.rgba>>8&16777215,U=50331648,Ve=!0,M.selectionForeground&&(ai=50331648,Xe=M.selectionForeground.rgba>>8&16777215,de=M.selectionForeground)),Ve&&Q.push("xterm-decoration-top"),U){case 16777216:case 33554432:_e=M.ansi[pt],Q.push(`xterm-bg-${pt}`);break;case 50331648:_e=y.channels.toColor(pt>>16,pt>>8&255,255&pt),this._addStyle(C,`background-color:#${S((pt>>>0).toString(16),"0",6)}`);break;default:Z?(_e=M.foreground,Q.push(`xterm-bg-${h.INVERTED_DEFAULT_COLOR}`)):_e=M.background}switch(le||ce.isDim()&&(le=y.color.multiplyOpacity(_e,.5)),ai){case 16777216:case 33554432:ce.isBold()&&Xe<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(Xe+=8),this._applyMinimumContrast(C,_e,M.ansi[Xe],ce,le,void 0)||Q.push(`xterm-fg-${Xe}`);break;case 50331648:const ke=y.channels.toColor(Xe>>16&255,Xe>>8&255,255&Xe);this._applyMinimumContrast(C,_e,ke,ce,le,de)||this._addStyle(C,`color:#${S(Xe.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(C,_e,M.foreground,ce,le,de)||Z&&Q.push(`xterm-fg-${h.INVERTED_DEFAULT_COLOR}`)}Q.length&&(C.className=Q.join(" "),Q.length=0),vi||De||Lt?C.textContent=R:F++,W!==this.defaultSpacing&&(C.style.letterSpacing=`${W}px`),$.push(C),ge=Ue}return C&&F&&(C.textContent=R),$}_applyMinimumContrast(x,k,w,E,A,T){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,g.treatGlyphAsBackgroundColor)(E.getCode()))return!1;const B=this._getContrastCache(E);let O;if(A||T||(O=B.getColor(k.rgba,w.rgba)),O===void 0){const N=this._optionsService.rawOptions.minimumContrastRatio/(E.isDim()?2:1);O=y.color.ensureContrastRatio(A||k,T||w,N),B.setColor((A||k).rgba,(T||w).rgba,O??null)}return!!O&&(this._addStyle(x,`color:${O.css}`),!0)}_getContrastCache(x){return x.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(x,k){x.setAttribute("style",`${x.getAttribute("style")||""}${k};`)}_isCellInSelection(x,k){const w=this._selectionStart,E=this._selectionEnd;return!(!w||!E)&&(this._columnSelectMode?w[0]<=E[0]?x>=w[0]&&k>=w[1]&&x<E[0]&&k<=E[1]:x<w[0]&&k>=w[1]&&x>=E[0]&&k<=E[1]:k>w[1]&&k<E[1]||w[1]===E[1]&&k===w[1]&&x>=w[0]&&x<E[0]||w[1]<E[1]&&k===E[1]&&x<E[0]||w[1]<E[1]&&k===w[1]&&x>=w[0])}};function S(x,k,w){for(;x.length<w;)x=k+x;return x}o.DomRendererRowFactory=b=c([u(1,p.ICharacterJoinerService),u(2,_.IOptionsService),u(3,p.ICoreBrowserService),u(4,_.ICoreService),u(5,_.IDecorationService),u(6,p.IThemeService)],b)},2550:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.WidthCache=void 0,o.WidthCache=class{constructor(a,c){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=a.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const u=a.createElement("span");u.classList.add("xterm-char-measure-element");const h=a.createElement("span");h.classList.add("xterm-char-measure-element"),h.style.fontWeight="bold";const f=a.createElement("span");f.classList.add("xterm-char-measure-element"),f.style.fontStyle="italic";const d=a.createElement("span");d.classList.add("xterm-char-measure-element"),d.style.fontWeight="bold",d.style.fontStyle="italic",this._measureElements=[u,h,f,d],this._container.appendChild(u),this._container.appendChild(h),this._container.appendChild(f),this._container.appendChild(d),c.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(a,c,u,h){a===this._font&&c===this._fontSize&&u===this._weight&&h===this._weightBold||(this._font=a,this._fontSize=c,this._weight=u,this._weightBold=h,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${u}`,this._measureElements[1].style.fontWeight=`${h}`,this._measureElements[2].style.fontWeight=`${u}`,this._measureElements[3].style.fontWeight=`${h}`,this.clear())}get(a,c,u){let h=0;if(!c&&!u&&a.length===1&&(h=a.charCodeAt(0))<256){if(this._flat[h]!==-9999)return this._flat[h];const _=this._measure(a,0);return _>0&&(this._flat[h]=_),_}let f=a;c&&(f+="B"),u&&(f+="I");let d=this._holey.get(f);if(d===void 0){let _=0;c&&(_|=1),u&&(_|=2),d=this._measure(a,_),d>0&&this._holey.set(f,d)}return d}_measure(a,c){const u=this._measureElements[c];return u.textContent=a.repeat(32),u.offsetWidth/32}}},2223:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TEXT_BASELINE=o.DIM_OPACITY=o.INVERTED_DEFAULT_COLOR=void 0;const c=a(6114);o.INVERTED_DEFAULT_COLOR=257,o.DIM_OPACITY=.5,o.TEXT_BASELINE=c.isFirefox||c.isLegacyEdge?"bottom":"ideographic"},6171:(l,o)=>{function a(u){return 57508<=u&&u<=57558}function c(u){return u>=128512&&u<=128591||u>=127744&&u<=128511||u>=128640&&u<=128767||u>=9728&&u<=9983||u>=9984&&u<=10175||u>=65024&&u<=65039||u>=129280&&u<=129535||u>=127462&&u<=127487}Object.defineProperty(o,"__esModule",{value:!0}),o.computeNextVariantOffset=o.createRenderDimensions=o.treatGlyphAsBackgroundColor=o.allowRescaling=o.isEmoji=o.isRestrictedPowerlineGlyph=o.isPowerlineGlyph=o.throwIfFalsy=void 0,o.throwIfFalsy=function(u){if(!u)throw new Error("value must not be falsy");return u},o.isPowerlineGlyph=a,o.isRestrictedPowerlineGlyph=function(u){return 57520<=u&&u<=57527},o.isEmoji=c,o.allowRescaling=function(u,h,f,d){return h===1&&f>Math.ceil(1.5*d)&&u!==void 0&&u>255&&!c(u)&&!a(u)&&!(function(_){return 57344<=_&&_<=63743})(u)},o.treatGlyphAsBackgroundColor=function(u){return a(u)||(function(h){return 9472<=h&&h<=9631})(u)},o.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},o.computeNextVariantOffset=function(u,h,f=0){return(u-(2*Math.round(h)-f))%(2*Math.round(h))}},6052:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.createSelectionRenderModel=void 0;class a{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(u,h,f,d=!1){if(this.selectionStart=h,this.selectionEnd=f,!h||!f||h[0]===f[0]&&h[1]===f[1])return void this.clear();const _=u.buffers.active.ydisp,y=h[1]-_,p=f[1]-_,m=Math.max(y,0),g=Math.min(p,u.rows-1);m>=u.rows||g<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=d,this.viewportStartRow=y,this.viewportEndRow=p,this.viewportCappedStartRow=m,this.viewportCappedEndRow=g,this.startCol=h[0],this.endCol=f[0])}isCellSelected(u,h,f){return!!this.hasSelection&&(f-=u.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?h>=this.startCol&&f>=this.viewportCappedStartRow&&h<this.endCol&&f<=this.viewportCappedEndRow:h<this.startCol&&f>=this.viewportCappedStartRow&&h>=this.endCol&&f<=this.viewportCappedEndRow:f>this.viewportStartRow&&f<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&f===this.viewportStartRow&&h>=this.startCol&&h<this.endCol||this.viewportStartRow<this.viewportEndRow&&f===this.viewportEndRow&&h<this.endCol||this.viewportStartRow<this.viewportEndRow&&f===this.viewportStartRow&&h>=this.startCol)}}o.createSelectionRenderModel=function(){return new a}},456:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.SelectionModel=void 0,o.SelectionModel=class{constructor(a){this._bufferService=a,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?a%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)-1]:[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[a,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[Math.max(a,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const a=this.selectionStart,c=this.selectionEnd;return!(!a||!c)&&(a[1]>c[1]||a[1]===c[1]&&a[0]>c[0])}handleTrim(a){return this.selectionStart&&(this.selectionStart[1]-=a),this.selectionEnd&&(this.selectionEnd[1]-=a),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(l,o,a){var c=this&&this.__decorate||function(g,v,b,S){var x,k=arguments.length,w=k<3?v:S===null?S=Object.getOwnPropertyDescriptor(v,b):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(g,v,b,S);else for(var E=g.length-1;E>=0;E--)(x=g[E])&&(w=(k<3?x(w):k>3?x(v,b,w):x(v,b))||w);return k>3&&w&&Object.defineProperty(v,b,w),w},u=this&&this.__param||function(g,v){return function(b,S){v(b,S,g)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CharSizeService=void 0;const h=a(2585),f=a(8460),d=a(844);let _=o.CharSizeService=class extends d.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(g,v,b){super(),this._optionsService=b,this.width=0,this.height=0,this._onCharSizeChange=this.register(new f.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new m(this._optionsService))}catch{this._measureStrategy=this.register(new p(g,v,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],(()=>this.measure())))}measure(){const g=this._measureStrategy.measure();g.width===this.width&&g.height===this.height||(this.width=g.width,this.height=g.height,this._onCharSizeChange.fire())}};o.CharSizeService=_=c([u(2,h.IOptionsService)],_);class y extends d.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(v,b){v!==void 0&&v>0&&b!==void 0&&b>0&&(this._result.width=v,this._result.height=b)}}class p extends y{constructor(v,b,S){super(),this._document=v,this._parentElement=b,this._optionsService=S,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class m extends y{constructor(v){super(),this._optionsService=v,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");const b=this._ctx.measureText("W");if(!("width"in b&&"fontBoundingBoxAscent"in b&&"fontBoundingBoxDescent"in b))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;const v=this._ctx.measureText("W");return this._validateAndSet(v.width,v.fontBoundingBoxAscent+v.fontBoundingBoxDescent),this._result}}},4269:function(l,o,a){var c=this&&this.__decorate||function(m,g,v,b){var S,x=arguments.length,k=x<3?g:b===null?b=Object.getOwnPropertyDescriptor(g,v):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(m,g,v,b);else for(var w=m.length-1;w>=0;w--)(S=m[w])&&(k=(x<3?S(k):x>3?S(g,v,k):S(g,v))||k);return x>3&&k&&Object.defineProperty(g,v,k),k},u=this&&this.__param||function(m,g){return function(v,b){g(v,b,m)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CharacterJoinerService=o.JoinedCellData=void 0;const h=a(3734),f=a(643),d=a(511),_=a(2585);class y extends h.AttributeData{constructor(g,v,b){super(),this.content=0,this.combinedData="",this.fg=g.fg,this.bg=g.bg,this.combinedData=v,this._width=b}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(g){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}o.JoinedCellData=y;let p=o.CharacterJoinerService=class Id{constructor(g){this._bufferService=g,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new d.CellData}register(g){const v={id:this._nextCharacterJoinerId++,handler:g};return this._characterJoiners.push(v),v.id}deregister(g){for(let v=0;v<this._characterJoiners.length;v++)if(this._characterJoiners[v].id===g)return this._characterJoiners.splice(v,1),!0;return!1}getJoinedCharacters(g){if(this._characterJoiners.length===0)return[];const v=this._bufferService.buffer.lines.get(g);if(!v||v.length===0)return[];const b=[],S=v.translateToString(!0);let x=0,k=0,w=0,E=v.getFg(0),A=v.getBg(0);for(let T=0;T<v.getTrimmedLength();T++)if(v.loadCell(T,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==E||this._workCell.bg!==A){if(T-x>1){const B=this._getJoinedRanges(S,w,k,v,x);for(let O=0;O<B.length;O++)b.push(B[O])}x=T,w=k,E=this._workCell.fg,A=this._workCell.bg}k+=this._workCell.getChars().length||f.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-x>1){const T=this._getJoinedRanges(S,w,k,v,x);for(let B=0;B<T.length;B++)b.push(T[B])}return b}_getJoinedRanges(g,v,b,S,x){const k=g.substring(v,b);let w=[];try{w=this._characterJoiners[0].handler(k)}catch(E){console.error(E)}for(let E=1;E<this._characterJoiners.length;E++)try{const A=this._characterJoiners[E].handler(k);for(let T=0;T<A.length;T++)Id._mergeRanges(w,A[T])}catch(A){console.error(A)}return this._stringRangesToCellRanges(w,S,x),w}_stringRangesToCellRanges(g,v,b){let S=0,x=!1,k=0,w=g[S];if(w){for(let E=b;E<this._bufferService.cols;E++){const A=v.getWidth(E),T=v.getString(E).length||f.WHITESPACE_CELL_CHAR.length;if(A!==0){if(!x&&w[0]<=k&&(w[0]=E,x=!0),w[1]<=k){if(w[1]=E,w=g[++S],!w)break;w[0]<=k?(w[0]=E,x=!0):x=!1}k+=T}}w&&(w[1]=this._bufferService.cols)}}static _mergeRanges(g,v){let b=!1;for(let S=0;S<g.length;S++){const x=g[S];if(b){if(v[1]<=x[0])return g[S-1][1]=v[1],g;if(v[1]<=x[1])return g[S-1][1]=Math.max(v[1],x[1]),g.splice(S,1),g;g.splice(S,1),S--}else{if(v[1]<=x[0])return g.splice(S,0,v),g;if(v[1]<=x[1])return x[0]=Math.min(v[0],x[0]),g;v[0]<x[1]&&(x[0]=Math.min(v[0],x[0]),b=!0)}}return b?g[g.length-1][1]=v[1]:g.push(v),g}};o.CharacterJoinerService=p=c([u(0,_.IBufferService)],p)},5114:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CoreBrowserService=void 0;const c=a(844),u=a(8460),h=a(3656);class f extends c.Disposable{constructor(y,p,m){super(),this._textarea=y,this._window=p,this.mainDocument=m,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new d(this._window),this._onDprChange=this.register(new u.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new u.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange((g=>this._screenDprMonitor.setWindow(g)))),this.register((0,u.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",(()=>this._isFocused=!0)),this._textarea.addEventListener("blur",(()=>this._isFocused=!1))}get window(){return this._window}set window(y){this._window!==y&&(this._window=y,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask((()=>this._cachedIsFocused=void 0))),this._cachedIsFocused}}o.CoreBrowserService=f;class d extends c.Disposable{constructor(y){super(),this._parentWindow=y,this._windowResizeListener=this.register(new c.MutableDisposable),this._onDprChange=this.register(new u.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,c.toDisposable)((()=>this.clearListener())))}setWindow(y){this._parentWindow=y,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,h.addDisposableDomListener)(this._parentWindow,"resize",(()=>this._setDprAndFireIfDiffers()))}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){var y;this._outerListener&&((y=this._resolutionMediaMatchList)==null||y.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.LinkProviderService=void 0;const c=a(844);class u extends c.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,c.toDisposable)((()=>this.linkProviders.length=0)))}registerLinkProvider(f){return this.linkProviders.push(f),{dispose:()=>{const d=this.linkProviders.indexOf(f);d!==-1&&this.linkProviders.splice(d,1)}}}}o.LinkProviderService=u},8934:function(l,o,a){var c=this&&this.__decorate||function(_,y,p,m){var g,v=arguments.length,b=v<3?y:m===null?m=Object.getOwnPropertyDescriptor(y,p):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(_,y,p,m);else for(var S=_.length-1;S>=0;S--)(g=_[S])&&(b=(v<3?g(b):v>3?g(y,p,b):g(y,p))||b);return v>3&&b&&Object.defineProperty(y,p,b),b},u=this&&this.__param||function(_,y){return function(p,m){y(p,m,_)}};Object.defineProperty(o,"__esModule",{value:!0}),o.MouseService=void 0;const h=a(4725),f=a(9806);let d=o.MouseService=class{constructor(_,y){this._renderService=_,this._charSizeService=y}getCoords(_,y,p,m,g){return(0,f.getCoords)(window,_,y,p,m,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,g)}getMouseReportCoords(_,y){const p=(0,f.getCoordsRelativeToElement)(window,_,y);if(this._charSizeService.hasValidSize)return p[0]=Math.min(Math.max(p[0],0),this._renderService.dimensions.css.canvas.width-1),p[1]=Math.min(Math.max(p[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(p[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(p[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(p[0]),y:Math.floor(p[1])}}};o.MouseService=d=c([u(0,h.IRenderService),u(1,h.ICharSizeService)],d)},3230:function(l,o,a){var c=this&&this.__decorate||function(g,v,b,S){var x,k=arguments.length,w=k<3?v:S===null?S=Object.getOwnPropertyDescriptor(v,b):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(g,v,b,S);else for(var E=g.length-1;E>=0;E--)(x=g[E])&&(w=(k<3?x(w):k>3?x(v,b,w):x(v,b))||w);return k>3&&w&&Object.defineProperty(v,b,w),w},u=this&&this.__param||function(g,v){return function(b,S){v(b,S,g)}};Object.defineProperty(o,"__esModule",{value:!0}),o.RenderService=void 0;const h=a(6193),f=a(4725),d=a(8460),_=a(844),y=a(7226),p=a(2585);let m=o.RenderService=class extends _.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(g,v,b,S,x,k,w,E){super(),this._rowCount=g,this._charSizeService=S,this._renderer=this.register(new _.MutableDisposable),this._pausedResizeTask=new y.DebouncedIdleTask,this._observerDisposable=this.register(new _.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new d.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new d.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new d.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new d.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new h.RenderDebouncer(((A,T)=>this._renderRows(A,T)),w),this.register(this._renderDebouncer),this.register(w.onDprChange((()=>this.handleDevicePixelRatioChange()))),this.register(k.onResize((()=>this._fullRefresh()))),this.register(k.buffers.onBufferActivate((()=>{var A;return(A=this._renderer.value)==null?void 0:A.clear()}))),this.register(b.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._charSizeService.onCharSizeChange((()=>this.handleCharSizeChanged()))),this.register(x.onDecorationRegistered((()=>this._fullRefresh()))),this.register(x.onDecorationRemoved((()=>this._fullRefresh()))),this.register(b.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],(()=>{this.clear(),this.handleResize(k.cols,k.rows),this._fullRefresh()}))),this.register(b.onMultipleOptionChange(["cursorBlink","cursorStyle"],(()=>this.refreshRows(k.buffer.y,k.buffer.y,!0)))),this.register(E.onChangeColors((()=>this._fullRefresh()))),this._registerIntersectionObserver(w.window,v),this.register(w.onWindowChange((A=>this._registerIntersectionObserver(A,v))))}_registerIntersectionObserver(g,v){if("IntersectionObserver"in g){const b=new g.IntersectionObserver((S=>this._handleIntersectionChange(S[S.length-1])),{threshold:0});b.observe(v),this._observerDisposable.value=(0,_.toDisposable)((()=>b.disconnect()))}}_handleIntersectionChange(g){this._isPaused=g.isIntersecting===void 0?g.intersectionRatio===0:!g.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(g,v,b=!1){this._isPaused?this._needsFullRefresh=!0:(b||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(g,v,this._rowCount))}_renderRows(g,v){this._renderer.value&&(g=Math.min(g,this._rowCount-1),v=Math.min(v,this._rowCount-1),this._renderer.value.renderRows(g,v),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:g,end:v}),this._onRender.fire({start:g,end:v}),this._isNextRenderRedrawOnly=!0)}resize(g,v){this._rowCount=v,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(g){this._renderer.value=g,this._renderer.value&&(this._renderer.value.onRequestRedraw((v=>this.refreshRows(v.start,v.end,!0))),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(g){return this._renderDebouncer.addRefreshCallback(g)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var g,v;this._renderer.value&&((v=(g=this._renderer.value).clearTextureAtlas)==null||v.call(g),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(g,v){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set((()=>{var b;return(b=this._renderer.value)==null?void 0:b.handleResize(g,v)})):this._renderer.value.handleResize(g,v),this._fullRefresh())}handleCharSizeChanged(){var g;(g=this._renderer.value)==null||g.handleCharSizeChanged()}handleBlur(){var g;(g=this._renderer.value)==null||g.handleBlur()}handleFocus(){var g;(g=this._renderer.value)==null||g.handleFocus()}handleSelectionChanged(g,v,b){var S;this._selectionState.start=g,this._selectionState.end=v,this._selectionState.columnSelectMode=b,(S=this._renderer.value)==null||S.handleSelectionChanged(g,v,b)}handleCursorMove(){var g;(g=this._renderer.value)==null||g.handleCursorMove()}clear(){var g;(g=this._renderer.value)==null||g.clear()}};o.RenderService=m=c([u(2,p.IOptionsService),u(3,f.ICharSizeService),u(4,p.IDecorationService),u(5,p.IBufferService),u(6,f.ICoreBrowserService),u(7,f.IThemeService)],m)},9312:function(l,o,a){var c=this&&this.__decorate||function(w,E,A,T){var B,O=arguments.length,N=O<3?E:T===null?T=Object.getOwnPropertyDescriptor(E,A):T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")N=Reflect.decorate(w,E,A,T);else for(var j=w.length-1;j>=0;j--)(B=w[j])&&(N=(O<3?B(N):O>3?B(E,A,N):B(E,A))||N);return O>3&&N&&Object.defineProperty(E,A,N),N},u=this&&this.__param||function(w,E){return function(A,T){E(A,T,w)}};Object.defineProperty(o,"__esModule",{value:!0}),o.SelectionService=void 0;const h=a(9806),f=a(9504),d=a(456),_=a(4725),y=a(8460),p=a(844),m=a(6114),g=a(4841),v=a(511),b=a(2585),S="",x=new RegExp(S,"g");let k=o.SelectionService=class extends p.Disposable{constructor(w,E,A,T,B,O,N,j,z){super(),this._element=w,this._screenElement=E,this._linkifier=A,this._bufferService=T,this._coreService=B,this._mouseService=O,this._optionsService=N,this._renderService=j,this._coreBrowserService=z,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new v.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new y.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new y.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new y.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new y.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=$=>this._handleMouseMove($),this._mouseUpListener=$=>this._handleMouseUp($),this._coreService.onUserInput((()=>{this.hasSelection&&this.clearSelection()})),this._trimListener=this._bufferService.buffer.lines.onTrim(($=>this._handleTrim($))),this.register(this._bufferService.buffers.onBufferActivate(($=>this._handleBufferActivate($)))),this.enable(),this._model=new d.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,p.toDisposable)((()=>{this._removeMouseDownListeners()})))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const w=this._model.finalSelectionStart,E=this._model.finalSelectionEnd;return!(!w||!E||w[0]===E[0]&&w[1]===E[1])}get selectionText(){const w=this._model.finalSelectionStart,E=this._model.finalSelectionEnd;if(!w||!E)return"";const A=this._bufferService.buffer,T=[];if(this._activeSelectionMode===3){if(w[0]===E[0])return"";const B=w[0]<E[0]?w[0]:E[0],O=w[0]<E[0]?E[0]:w[0];for(let N=w[1];N<=E[1];N++){const j=A.translateBufferLineToString(N,!0,B,O);T.push(j)}}else{const B=w[1]===E[1]?E[0]:void 0;T.push(A.translateBufferLineToString(w[1],!0,w[0],B));for(let O=w[1]+1;O<=E[1]-1;O++){const N=A.lines.get(O),j=A.translateBufferLineToString(O,!0);N!=null&&N.isWrapped?T[T.length-1]+=j:T.push(j)}if(w[1]!==E[1]){const O=A.lines.get(E[1]),N=A.translateBufferLineToString(E[1],!0,0,E[0]);O&&O.isWrapped?T[T.length-1]+=N:T.push(N)}}return T.map((B=>B.replace(x," "))).join(m.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(w){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._refresh()))),m.isLinux&&w&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(w){const E=this._getMouseBufferCoords(w),A=this._model.finalSelectionStart,T=this._model.finalSelectionEnd;return!!(A&&T&&E)&&this._areCoordsInSelection(E,A,T)}isCellInSelection(w,E){const A=this._model.finalSelectionStart,T=this._model.finalSelectionEnd;return!(!A||!T)&&this._areCoordsInSelection([w,E],A,T)}_areCoordsInSelection(w,E,A){return w[1]>E[1]&&w[1]<A[1]||E[1]===A[1]&&w[1]===E[1]&&w[0]>=E[0]&&w[0]<A[0]||E[1]<A[1]&&w[1]===A[1]&&w[0]<A[0]||E[1]<A[1]&&w[1]===E[1]&&w[0]>=E[0]}_selectWordAtCursor(w,E){var B,O;const A=(O=(B=this._linkifier.currentLink)==null?void 0:B.link)==null?void 0:O.range;if(A)return this._model.selectionStart=[A.start.x-1,A.start.y-1],this._model.selectionStartLength=(0,g.getRangeLength)(A,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const T=this._getMouseBufferCoords(w);return!!T&&(this._selectWordAt(T,E),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(w,E){this._model.clearSelection(),w=Math.max(w,0),E=Math.min(E,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,w],this._model.selectionEnd=[this._bufferService.cols,E],this.refresh(),this._onSelectionChange.fire()}_handleTrim(w){this._model.handleTrim(w)&&this.refresh()}_getMouseBufferCoords(w){const E=this._mouseService.getCoords(w,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(E)return E[0]--,E[1]--,E[1]+=this._bufferService.buffer.ydisp,E}_getMouseEventScrollAmount(w){let E=(0,h.getCoordsRelativeToElement)(this._coreBrowserService.window,w,this._screenElement)[1];const A=this._renderService.dimensions.css.canvas.height;return E>=0&&E<=A?0:(E>A&&(E-=A),E=Math.min(Math.max(E,-50),50),E/=50,E/Math.abs(E)+Math.round(14*E))}shouldForceSelection(w){return m.isMac?w.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:w.shiftKey}handleMouseDown(w){if(this._mouseDownTimeStamp=w.timeStamp,(w.button!==2||!this.hasSelection)&&w.button===0){if(!this._enabled){if(!this.shouldForceSelection(w))return;w.stopPropagation()}w.preventDefault(),this._dragScrollAmount=0,this._enabled&&w.shiftKey?this._handleIncrementalClick(w):w.detail===1?this._handleSingleClick(w):w.detail===2?this._handleDoubleClick(w):w.detail===3&&this._handleTripleClick(w),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval((()=>this._dragScroll()),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(w){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(w))}_handleSingleClick(w){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(w)?3:0,this._model.selectionStart=this._getMouseBufferCoords(w),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const E=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);E&&E.length!==this._model.selectionStart[0]&&E.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(w){this._selectWordAtCursor(w,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(w){const E=this._getMouseBufferCoords(w);E&&(this._activeSelectionMode=2,this._selectLineAt(E[1]))}shouldColumnSelect(w){return w.altKey&&!(m.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(w){if(w.stopImmediatePropagation(),!this._model.selectionStart)return;const E=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(w),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(w),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const A=this._bufferService.buffer;if(this._model.selectionEnd[1]<A.lines.length){const T=A.lines.get(this._model.selectionEnd[1]);T&&T.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}E&&E[0]===this._model.selectionEnd[0]&&E[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const w=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(w.ydisp+this._bufferService.rows,w.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=w.ydisp),this.refresh()}}_handleMouseUp(w){const E=w.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&E<500&&w.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const A=this._mouseService.getCoords(w,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(A&&A[0]!==void 0&&A[1]!==void 0){const T=(0,f.moveToCellSequence)(A[0]-1,A[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(T,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const w=this._model.finalSelectionStart,E=this._model.finalSelectionEnd,A=!(!w||!E||w[0]===E[0]&&w[1]===E[1]);A?w&&E&&(this._oldSelectionStart&&this._oldSelectionEnd&&w[0]===this._oldSelectionStart[0]&&w[1]===this._oldSelectionStart[1]&&E[0]===this._oldSelectionEnd[0]&&E[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(w,E,A)):this._oldHasSelection&&this._fireOnSelectionChange(w,E,A)}_fireOnSelectionChange(w,E,A){this._oldSelectionStart=w,this._oldSelectionEnd=E,this._oldHasSelection=A,this._onSelectionChange.fire()}_handleBufferActivate(w){this.clearSelection(),this._trimListener.dispose(),this._trimListener=w.activeBuffer.lines.onTrim((E=>this._handleTrim(E)))}_convertViewportColToCharacterIndex(w,E){let A=E;for(let T=0;E>=T;T++){const B=w.loadCell(T,this._workCell).getChars().length;this._workCell.getWidth()===0?A--:B>1&&E!==T&&(A+=B-1)}return A}setSelection(w,E,A){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[w,E],this._model.selectionStartLength=A,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(w){this._isClickInSelection(w)||(this._selectWordAtCursor(w,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(w,E,A=!0,T=!0){if(w[0]>=this._bufferService.cols)return;const B=this._bufferService.buffer,O=B.lines.get(w[1]);if(!O)return;const N=B.translateBufferLineToString(w[1],!1);let j=this._convertViewportColToCharacterIndex(O,w[0]),z=j;const $=w[0]-j;let q=0,M=0,C=0,I=0;if(N.charAt(j)===" "){for(;j>0&&N.charAt(j-1)===" ";)j--;for(;z<N.length&&N.charAt(z+1)===" ";)z++}else{let X=w[0],ie=w[0];O.getWidth(X)===0&&(q++,X--),O.getWidth(ie)===2&&(M++,ie++);const re=O.getString(ie).length;for(re>1&&(I+=re-1,z+=re-1);X>0&&j>0&&!this._isCharWordSeparator(O.loadCell(X-1,this._workCell));){O.loadCell(X-1,this._workCell);const P=this._workCell.getChars().length;this._workCell.getWidth()===0?(q++,X--):P>1&&(C+=P-1,j-=P-1),j--,X--}for(;ie<O.length&&z+1<N.length&&!this._isCharWordSeparator(O.loadCell(ie+1,this._workCell));){O.loadCell(ie+1,this._workCell);const P=this._workCell.getChars().length;this._workCell.getWidth()===2?(M++,ie++):P>1&&(I+=P-1,z+=P-1),z++,ie++}}z++;let F=j+$-q+C,R=Math.min(this._bufferService.cols,z-j+q+M-C-I);if(E||N.slice(j,z).trim()!==""){if(A&&F===0&&O.getCodePoint(0)!==32){const X=B.lines.get(w[1]-1);if(X&&O.isWrapped&&X.getCodePoint(this._bufferService.cols-1)!==32){const ie=this._getWordAt([this._bufferService.cols-1,w[1]-1],!1,!0,!1);if(ie){const re=this._bufferService.cols-ie.start;F-=re,R+=re}}}if(T&&F+R===this._bufferService.cols&&O.getCodePoint(this._bufferService.cols-1)!==32){const X=B.lines.get(w[1]+1);if(X!=null&&X.isWrapped&&X.getCodePoint(0)!==32){const ie=this._getWordAt([0,w[1]+1],!1,!1,!0);ie&&(R+=ie.length)}}return{start:F,length:R}}}_selectWordAt(w,E){const A=this._getWordAt(w,E);if(A){for(;A.start<0;)A.start+=this._bufferService.cols,w[1]--;this._model.selectionStart=[A.start,w[1]],this._model.selectionStartLength=A.length}}_selectToWordAt(w){const E=this._getWordAt(w,!0);if(E){let A=w[1];for(;E.start<0;)E.start+=this._bufferService.cols,A--;if(!this._model.areSelectionValuesReversed())for(;E.start+E.length>this._bufferService.cols;)E.length-=this._bufferService.cols,A++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?E.start:E.start+E.length,A]}}_isCharWordSeparator(w){return w.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(w.getChars())>=0}_selectLineAt(w){const E=this._bufferService.buffer.getWrappedRangeForLine(w),A={start:{x:0,y:E.first},end:{x:this._bufferService.cols-1,y:E.last}};this._model.selectionStart=[0,E.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,g.getRangeLength)(A,this._bufferService.cols)}};o.SelectionService=k=c([u(3,b.IBufferService),u(4,b.ICoreService),u(5,_.IMouseService),u(6,b.IOptionsService),u(7,_.IRenderService),u(8,_.ICoreBrowserService)],k)},4725:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ILinkProviderService=o.IThemeService=o.ICharacterJoinerService=o.ISelectionService=o.IRenderService=o.IMouseService=o.ICoreBrowserService=o.ICharSizeService=void 0;const c=a(8343);o.ICharSizeService=(0,c.createDecorator)("CharSizeService"),o.ICoreBrowserService=(0,c.createDecorator)("CoreBrowserService"),o.IMouseService=(0,c.createDecorator)("MouseService"),o.IRenderService=(0,c.createDecorator)("RenderService"),o.ISelectionService=(0,c.createDecorator)("SelectionService"),o.ICharacterJoinerService=(0,c.createDecorator)("CharacterJoinerService"),o.IThemeService=(0,c.createDecorator)("ThemeService"),o.ILinkProviderService=(0,c.createDecorator)("LinkProviderService")},6731:function(l,o,a){var c=this&&this.__decorate||function(k,w,E,A){var T,B=arguments.length,O=B<3?w:A===null?A=Object.getOwnPropertyDescriptor(w,E):A;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")O=Reflect.decorate(k,w,E,A);else for(var N=k.length-1;N>=0;N--)(T=k[N])&&(O=(B<3?T(O):B>3?T(w,E,O):T(w,E))||O);return B>3&&O&&Object.defineProperty(w,E,O),O},u=this&&this.__param||function(k,w){return function(E,A){w(E,A,k)}};Object.defineProperty(o,"__esModule",{value:!0}),o.ThemeService=o.DEFAULT_ANSI_COLORS=void 0;const h=a(7239),f=a(8055),d=a(8460),_=a(844),y=a(2585),p=f.css.toColor("#ffffff"),m=f.css.toColor("#000000"),g=f.css.toColor("#ffffff"),v=f.css.toColor("#000000"),b={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};o.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const k=[f.css.toColor("#2e3436"),f.css.toColor("#cc0000"),f.css.toColor("#4e9a06"),f.css.toColor("#c4a000"),f.css.toColor("#3465a4"),f.css.toColor("#75507b"),f.css.toColor("#06989a"),f.css.toColor("#d3d7cf"),f.css.toColor("#555753"),f.css.toColor("#ef2929"),f.css.toColor("#8ae234"),f.css.toColor("#fce94f"),f.css.toColor("#729fcf"),f.css.toColor("#ad7fa8"),f.css.toColor("#34e2e2"),f.css.toColor("#eeeeec")],w=[0,95,135,175,215,255];for(let E=0;E<216;E++){const A=w[E/36%6|0],T=w[E/6%6|0],B=w[E%6];k.push({css:f.channels.toCss(A,T,B),rgba:f.channels.toRgba(A,T,B)})}for(let E=0;E<24;E++){const A=8+10*E;k.push({css:f.channels.toCss(A,A,A),rgba:f.channels.toRgba(A,A,A)})}return k})());let S=o.ThemeService=class extends _.Disposable{get colors(){return this._colors}constructor(k){super(),this._optionsService=k,this._contrastCache=new h.ColorContrastCache,this._halfContrastCache=new h.ColorContrastCache,this._onChangeColors=this.register(new d.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:p,background:m,cursor:g,cursorAccent:v,selectionForeground:void 0,selectionBackgroundTransparent:b,selectionBackgroundOpaque:f.color.blend(m,b),selectionInactiveBackgroundTransparent:b,selectionInactiveBackgroundOpaque:f.color.blend(m,b),ansi:o.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",(()=>this._contrastCache.clear()))),this.register(this._optionsService.onSpecificOptionChange("theme",(()=>this._setTheme(this._optionsService.rawOptions.theme))))}_setTheme(k={}){const w=this._colors;if(w.foreground=x(k.foreground,p),w.background=x(k.background,m),w.cursor=x(k.cursor,g),w.cursorAccent=x(k.cursorAccent,v),w.selectionBackgroundTransparent=x(k.selectionBackground,b),w.selectionBackgroundOpaque=f.color.blend(w.background,w.selectionBackgroundTransparent),w.selectionInactiveBackgroundTransparent=x(k.selectionInactiveBackground,w.selectionBackgroundTransparent),w.selectionInactiveBackgroundOpaque=f.color.blend(w.background,w.selectionInactiveBackgroundTransparent),w.selectionForeground=k.selectionForeground?x(k.selectionForeground,f.NULL_COLOR):void 0,w.selectionForeground===f.NULL_COLOR&&(w.selectionForeground=void 0),f.color.isOpaque(w.selectionBackgroundTransparent)&&(w.selectionBackgroundTransparent=f.color.opacity(w.selectionBackgroundTransparent,.3)),f.color.isOpaque(w.selectionInactiveBackgroundTransparent)&&(w.selectionInactiveBackgroundTransparent=f.color.opacity(w.selectionInactiveBackgroundTransparent,.3)),w.ansi=o.DEFAULT_ANSI_COLORS.slice(),w.ansi[0]=x(k.black,o.DEFAULT_ANSI_COLORS[0]),w.ansi[1]=x(k.red,o.DEFAULT_ANSI_COLORS[1]),w.ansi[2]=x(k.green,o.DEFAULT_ANSI_COLORS[2]),w.ansi[3]=x(k.yellow,o.DEFAULT_ANSI_COLORS[3]),w.ansi[4]=x(k.blue,o.DEFAULT_ANSI_COLORS[4]),w.ansi[5]=x(k.magenta,o.DEFAULT_ANSI_COLORS[5]),w.ansi[6]=x(k.cyan,o.DEFAULT_ANSI_COLORS[6]),w.ansi[7]=x(k.white,o.DEFAULT_ANSI_COLORS[7]),w.ansi[8]=x(k.brightBlack,o.DEFAULT_ANSI_COLORS[8]),w.ansi[9]=x(k.brightRed,o.DEFAULT_ANSI_COLORS[9]),w.ansi[10]=x(k.brightGreen,o.DEFAULT_ANSI_COLORS[10]),w.ansi[11]=x(k.brightYellow,o.DEFAULT_ANSI_COLORS[11]),w.ansi[12]=x(k.brightBlue,o.DEFAULT_ANSI_COLORS[12]),w.ansi[13]=x(k.brightMagenta,o.DEFAULT_ANSI_COLORS[13]),w.ansi[14]=x(k.brightCyan,o.DEFAULT_ANSI_COLORS[14]),w.ansi[15]=x(k.brightWhite,o.DEFAULT_ANSI_COLORS[15]),k.extendedAnsi){const E=Math.min(w.ansi.length-16,k.extendedAnsi.length);for(let A=0;A<E;A++)w.ansi[A+16]=x(k.extendedAnsi[A],o.DEFAULT_ANSI_COLORS[A+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(k){this._restoreColor(k),this._onChangeColors.fire(this.colors)}_restoreColor(k){if(k!==void 0)switch(k){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[k]=this._restoreColors.ansi[k]}else for(let w=0;w<this._restoreColors.ansi.length;++w)this._colors.ansi[w]=this._restoreColors.ansi[w]}modifyColors(k){k(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function x(k,w){if(k!==void 0)try{return f.css.toColor(k)}catch{}return w}o.ThemeService=S=c([u(0,y.IOptionsService)],S)},6349:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CircularList=void 0;const c=a(8460),u=a(844);class h extends u.Disposable{constructor(d){super(),this._maxLength=d,this.onDeleteEmitter=this.register(new c.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new c.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new c.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(d){if(this._maxLength===d)return;const _=new Array(d);for(let y=0;y<Math.min(d,this.length);y++)_[y]=this._array[this._getCyclicIndex(y)];this._array=_,this._maxLength=d,this._startIndex=0}get length(){return this._length}set length(d){if(d>this._length)for(let _=this._length;_<d;_++)this._array[_]=void 0;this._length=d}get(d){return this._array[this._getCyclicIndex(d)]}set(d,_){this._array[this._getCyclicIndex(d)]=_}push(d){this._array[this._getCyclicIndex(this._length)]=d,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(d,_,...y){if(_){for(let p=d;p<this._length-_;p++)this._array[this._getCyclicIndex(p)]=this._array[this._getCyclicIndex(p+_)];this._length-=_,this.onDeleteEmitter.fire({index:d,amount:_})}for(let p=this._length-1;p>=d;p--)this._array[this._getCyclicIndex(p+y.length)]=this._array[this._getCyclicIndex(p)];for(let p=0;p<y.length;p++)this._array[this._getCyclicIndex(d+p)]=y[p];if(y.length&&this.onInsertEmitter.fire({index:d,amount:y.length}),this._length+y.length>this._maxLength){const p=this._length+y.length-this._maxLength;this._startIndex+=p,this._length=this._maxLength,this.onTrimEmitter.fire(p)}else this._length+=y.length}trimStart(d){d>this._length&&(d=this._length),this._startIndex+=d,this._length-=d,this.onTrimEmitter.fire(d)}shiftElements(d,_,y){if(!(_<=0)){if(d<0||d>=this._length)throw new Error("start argument out of range");if(d+y<0)throw new Error("Cannot shift elements in list beyond index 0");if(y>0){for(let m=_-1;m>=0;m--)this.set(d+m+y,this.get(d+m));const p=d+_+y-this._length;if(p>0)for(this._length+=p;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let p=0;p<_;p++)this.set(d+p+y,this.get(d+p))}}_getCyclicIndex(d){return(this._startIndex+d)%this._maxLength}}o.CircularList=h},1439:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.clone=void 0,o.clone=function a(c,u=5){if(typeof c!="object")return c;const h=Array.isArray(c)?[]:{};for(const f in c)h[f]=u<=1?c[f]:c[f]&&a(c[f],u-1);return h}},8055:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.contrastRatio=o.toPaddedHex=o.rgba=o.rgb=o.css=o.color=o.channels=o.NULL_COLOR=void 0;let a=0,c=0,u=0,h=0;var f,d,_,y,p;function m(v){const b=v.toString(16);return b.length<2?"0"+b:b}function g(v,b){return v<b?(b+.05)/(v+.05):(v+.05)/(b+.05)}o.NULL_COLOR={css:"#00000000",rgba:0},(function(v){v.toCss=function(b,S,x,k){return k!==void 0?`#${m(b)}${m(S)}${m(x)}${m(k)}`:`#${m(b)}${m(S)}${m(x)}`},v.toRgba=function(b,S,x,k=255){return(b<<24|S<<16|x<<8|k)>>>0},v.toColor=function(b,S,x,k){return{css:v.toCss(b,S,x,k),rgba:v.toRgba(b,S,x,k)}}})(f||(o.channels=f={})),(function(v){function b(S,x){return h=Math.round(255*x),[a,c,u]=p.toChannels(S.rgba),{css:f.toCss(a,c,u,h),rgba:f.toRgba(a,c,u,h)}}v.blend=function(S,x){if(h=(255&x.rgba)/255,h===1)return{css:x.css,rgba:x.rgba};const k=x.rgba>>24&255,w=x.rgba>>16&255,E=x.rgba>>8&255,A=S.rgba>>24&255,T=S.rgba>>16&255,B=S.rgba>>8&255;return a=A+Math.round((k-A)*h),c=T+Math.round((w-T)*h),u=B+Math.round((E-B)*h),{css:f.toCss(a,c,u),rgba:f.toRgba(a,c,u)}},v.isOpaque=function(S){return(255&S.rgba)==255},v.ensureContrastRatio=function(S,x,k){const w=p.ensureContrastRatio(S.rgba,x.rgba,k);if(w)return f.toColor(w>>24&255,w>>16&255,w>>8&255)},v.opaque=function(S){const x=(255|S.rgba)>>>0;return[a,c,u]=p.toChannels(x),{css:f.toCss(a,c,u),rgba:x}},v.opacity=b,v.multiplyOpacity=function(S,x){return h=255&S.rgba,b(S,h*x/255)},v.toColorRGB=function(S){return[S.rgba>>24&255,S.rgba>>16&255,S.rgba>>8&255]}})(d||(o.color=d={})),(function(v){let b,S;try{const x=document.createElement("canvas");x.width=1,x.height=1;const k=x.getContext("2d",{willReadFrequently:!0});k&&(b=k,b.globalCompositeOperation="copy",S=b.createLinearGradient(0,0,1,1))}catch{}v.toColor=function(x){if(x.match(/#[\da-f]{3,8}/i))switch(x.length){case 4:return a=parseInt(x.slice(1,2).repeat(2),16),c=parseInt(x.slice(2,3).repeat(2),16),u=parseInt(x.slice(3,4).repeat(2),16),f.toColor(a,c,u);case 5:return a=parseInt(x.slice(1,2).repeat(2),16),c=parseInt(x.slice(2,3).repeat(2),16),u=parseInt(x.slice(3,4).repeat(2),16),h=parseInt(x.slice(4,5).repeat(2),16),f.toColor(a,c,u,h);case 7:return{css:x,rgba:(parseInt(x.slice(1),16)<<8|255)>>>0};case 9:return{css:x,rgba:parseInt(x.slice(1),16)>>>0}}const k=x.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(k)return a=parseInt(k[1]),c=parseInt(k[2]),u=parseInt(k[3]),h=Math.round(255*(k[5]===void 0?1:parseFloat(k[5]))),f.toColor(a,c,u,h);if(!b||!S)throw new Error("css.toColor: Unsupported css format");if(b.fillStyle=S,b.fillStyle=x,typeof b.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(b.fillRect(0,0,1,1),[a,c,u,h]=b.getImageData(0,0,1,1).data,h!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:f.toRgba(a,c,u,h),css:x}}})(_||(o.css=_={})),(function(v){function b(S,x,k){const w=S/255,E=x/255,A=k/255;return .2126*(w<=.03928?w/12.92:Math.pow((w+.055)/1.055,2.4))+.7152*(E<=.03928?E/12.92:Math.pow((E+.055)/1.055,2.4))+.0722*(A<=.03928?A/12.92:Math.pow((A+.055)/1.055,2.4))}v.relativeLuminance=function(S){return b(S>>16&255,S>>8&255,255&S)},v.relativeLuminance2=b})(y||(o.rgb=y={})),(function(v){function b(x,k,w){const E=x>>24&255,A=x>>16&255,T=x>>8&255;let B=k>>24&255,O=k>>16&255,N=k>>8&255,j=g(y.relativeLuminance2(B,O,N),y.relativeLuminance2(E,A,T));for(;j<w&&(B>0||O>0||N>0);)B-=Math.max(0,Math.ceil(.1*B)),O-=Math.max(0,Math.ceil(.1*O)),N-=Math.max(0,Math.ceil(.1*N)),j=g(y.relativeLuminance2(B,O,N),y.relativeLuminance2(E,A,T));return(B<<24|O<<16|N<<8|255)>>>0}function S(x,k,w){const E=x>>24&255,A=x>>16&255,T=x>>8&255;let B=k>>24&255,O=k>>16&255,N=k>>8&255,j=g(y.relativeLuminance2(B,O,N),y.relativeLuminance2(E,A,T));for(;j<w&&(B<255||O<255||N<255);)B=Math.min(255,B+Math.ceil(.1*(255-B))),O=Math.min(255,O+Math.ceil(.1*(255-O))),N=Math.min(255,N+Math.ceil(.1*(255-N))),j=g(y.relativeLuminance2(B,O,N),y.relativeLuminance2(E,A,T));return(B<<24|O<<16|N<<8|255)>>>0}v.blend=function(x,k){if(h=(255&k)/255,h===1)return k;const w=k>>24&255,E=k>>16&255,A=k>>8&255,T=x>>24&255,B=x>>16&255,O=x>>8&255;return a=T+Math.round((w-T)*h),c=B+Math.round((E-B)*h),u=O+Math.round((A-O)*h),f.toRgba(a,c,u)},v.ensureContrastRatio=function(x,k,w){const E=y.relativeLuminance(x>>8),A=y.relativeLuminance(k>>8);if(g(E,A)<w){if(A<E){const O=b(x,k,w),N=g(E,y.relativeLuminance(O>>8));if(N<w){const j=S(x,k,w);return N>g(E,y.relativeLuminance(j>>8))?O:j}return O}const T=S(x,k,w),B=g(E,y.relativeLuminance(T>>8));if(B<w){const O=b(x,k,w);return B>g(E,y.relativeLuminance(O>>8))?T:O}return T}},v.reduceLuminance=b,v.increaseLuminance=S,v.toChannels=function(x){return[x>>24&255,x>>16&255,x>>8&255,255&x]}})(p||(o.rgba=p={})),o.toPaddedHex=m,o.contrastRatio=g},8969:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CoreTerminal=void 0;const c=a(844),u=a(2585),h=a(4348),f=a(7866),d=a(744),_=a(7302),y=a(6975),p=a(8460),m=a(1753),g=a(1480),v=a(7994),b=a(9282),S=a(5435),x=a(5981),k=a(2660);let w=!1;class E extends c.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new p.EventEmitter),this._onScroll.event((T=>{var B;(B=this._onScrollApi)==null||B.fire(T.position)}))),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(T){for(const B in T)this.optionsService.options[B]=T[B]}constructor(T){super(),this._windowsWrappingHeuristics=this.register(new c.MutableDisposable),this._onBinary=this.register(new p.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new p.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new p.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new p.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new p.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new p.EventEmitter),this._instantiationService=new h.InstantiationService,this.optionsService=this.register(new _.OptionsService(T)),this._instantiationService.setService(u.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(d.BufferService)),this._instantiationService.setService(u.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(f.LogService)),this._instantiationService.setService(u.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(y.CoreService)),this._instantiationService.setService(u.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(m.CoreMouseService)),this._instantiationService.setService(u.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(g.UnicodeService)),this._instantiationService.setService(u.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(v.CharsetService),this._instantiationService.setService(u.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(k.OscLinkService),this._instantiationService.setService(u.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new S.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,p.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,p.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,p.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,p.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom((()=>this.scrollToBottom()))),this.register(this.coreService.onUserInput((()=>this._writeBuffer.handleUserInput()))),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],(()=>this._handleWindowsPtyOptionChange()))),this.register(this._bufferService.onScroll((B=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this.register(this._inputHandler.onScroll((B=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this._writeBuffer=this.register(new x.WriteBuffer(((B,O)=>this._inputHandler.parse(B,O)))),this.register((0,p.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(T,B){this._writeBuffer.write(T,B)}writeSync(T,B){this._logService.logLevel<=u.LogLevelEnum.WARN&&!w&&(this._logService.warn("writeSync is unreliable and will be removed soon."),w=!0),this._writeBuffer.writeSync(T,B)}input(T,B=!0){this.coreService.triggerDataEvent(T,B)}resize(T,B){isNaN(T)||isNaN(B)||(T=Math.max(T,d.MINIMUM_COLS),B=Math.max(B,d.MINIMUM_ROWS),this._bufferService.resize(T,B))}scroll(T,B=!1){this._bufferService.scroll(T,B)}scrollLines(T,B,O){this._bufferService.scrollLines(T,B,O)}scrollPages(T){this.scrollLines(T*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(T){const B=T-this._bufferService.buffer.ydisp;B!==0&&this.scrollLines(B)}registerEscHandler(T,B){return this._inputHandler.registerEscHandler(T,B)}registerDcsHandler(T,B){return this._inputHandler.registerDcsHandler(T,B)}registerCsiHandler(T,B){return this._inputHandler.registerCsiHandler(T,B)}registerOscHandler(T,B){return this._inputHandler.registerOscHandler(T,B)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let T=!1;const B=this.optionsService.rawOptions.windowsPty;B&&B.buildNumber!==void 0&&B.buildNumber!==void 0?T=B.backend==="conpty"&&B.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(T=!0),T?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const T=[];T.push(this.onLineFeed(b.updateWindowsModeWrappedState.bind(null,this._bufferService))),T.push(this.registerCsiHandler({final:"H"},(()=>((0,b.updateWindowsModeWrappedState)(this._bufferService),!1)))),this._windowsWrappingHeuristics.value=(0,c.toDisposable)((()=>{for(const B of T)B.dispose()}))}}}o.CoreTerminal=E},8460:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.runAndSubscribe=o.forwardEvent=o.EventEmitter=void 0,o.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=a=>(this._listeners.push(a),{dispose:()=>{if(!this._disposed){for(let c=0;c<this._listeners.length;c++)if(this._listeners[c]===a)return void this._listeners.splice(c,1)}}})),this._event}fire(a,c){const u=[];for(let h=0;h<this._listeners.length;h++)u.push(this._listeners[h]);for(let h=0;h<u.length;h++)u[h].call(void 0,a,c)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},o.forwardEvent=function(a,c){return a((u=>c.fire(u)))},o.runAndSubscribe=function(a,c){return c(void 0),a((u=>c(u)))}},5435:function(l,o,a){var c=this&&this.__decorate||function(q,M,C,I){var F,R=arguments.length,X=R<3?M:I===null?I=Object.getOwnPropertyDescriptor(M,C):I;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")X=Reflect.decorate(q,M,C,I);else for(var ie=q.length-1;ie>=0;ie--)(F=q[ie])&&(X=(R<3?F(X):R>3?F(M,C,X):F(M,C))||X);return R>3&&X&&Object.defineProperty(M,C,X),X},u=this&&this.__param||function(q,M){return function(C,I){M(C,I,q)}};Object.defineProperty(o,"__esModule",{value:!0}),o.InputHandler=o.WindowsOptionsReportType=void 0;const h=a(2584),f=a(7116),d=a(2015),_=a(844),y=a(482),p=a(8437),m=a(8460),g=a(643),v=a(511),b=a(3734),S=a(2585),x=a(1480),k=a(6242),w=a(6351),E=a(5941),A={"(":0,")":1,"*":2,"+":3,"-":1,".":2},T=131072;function B(q,M){if(q>24)return M.setWinLines||!1;switch(q){case 1:return!!M.restoreWin;case 2:return!!M.minimizeWin;case 3:return!!M.setWinPosition;case 4:return!!M.setWinSizePixels;case 5:return!!M.raiseWin;case 6:return!!M.lowerWin;case 7:return!!M.refreshWin;case 8:return!!M.setWinSizeChars;case 9:return!!M.maximizeWin;case 10:return!!M.fullscreenWin;case 11:return!!M.getWinState;case 13:return!!M.getWinPosition;case 14:return!!M.getWinSizePixels;case 15:return!!M.getScreenSizePixels;case 16:return!!M.getCellSizePixels;case 18:return!!M.getWinSizeChars;case 19:return!!M.getScreenSizeChars;case 20:return!!M.getIconTitle;case 21:return!!M.getWinTitle;case 22:return!!M.pushTitle;case 23:return!!M.popTitle;case 24:return!!M.setWinLines}return!1}var O;(function(q){q[q.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",q[q.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(O||(o.WindowsOptionsReportType=O={}));let N=0;class j extends _.Disposable{getAttrData(){return this._curAttrData}constructor(M,C,I,F,R,X,ie,re,P=new d.EscapeSequenceParser){super(),this._bufferService=M,this._charsetService=C,this._coreService=I,this._logService=F,this._optionsService=R,this._oscLinkService=X,this._coreMouseService=ie,this._unicodeService=re,this._parser=P,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new y.StringToUtf32,this._utf8Decoder=new y.Utf8ToUtf32,this._workCell=new v.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=p.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=p.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new m.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new m.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new m.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new m.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new m.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new m.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new m.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new m.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new m.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new m.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new m.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new m.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new m.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new z(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((L=>this._activeBuffer=L.activeBuffer))),this._parser.setCsiHandlerFallback(((L,K)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(L),params:K.toArray()})})),this._parser.setEscHandlerFallback((L=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(L)})})),this._parser.setExecuteHandlerFallback((L=>{this._logService.debug("Unknown EXECUTE code: ",{code:L})})),this._parser.setOscHandlerFallback(((L,K,W)=>{this._logService.debug("Unknown OSC code: ",{identifier:L,action:K,data:W})})),this._parser.setDcsHandlerFallback(((L,K,W)=>{K==="HOOK"&&(W=W.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(L),action:K,payload:W})})),this._parser.setPrintHandler(((L,K,W)=>this.print(L,K,W))),this._parser.registerCsiHandler({final:"@"},(L=>this.insertChars(L))),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(L=>this.scrollLeft(L))),this._parser.registerCsiHandler({final:"A"},(L=>this.cursorUp(L))),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(L=>this.scrollRight(L))),this._parser.registerCsiHandler({final:"B"},(L=>this.cursorDown(L))),this._parser.registerCsiHandler({final:"C"},(L=>this.cursorForward(L))),this._parser.registerCsiHandler({final:"D"},(L=>this.cursorBackward(L))),this._parser.registerCsiHandler({final:"E"},(L=>this.cursorNextLine(L))),this._parser.registerCsiHandler({final:"F"},(L=>this.cursorPrecedingLine(L))),this._parser.registerCsiHandler({final:"G"},(L=>this.cursorCharAbsolute(L))),this._parser.registerCsiHandler({final:"H"},(L=>this.cursorPosition(L))),this._parser.registerCsiHandler({final:"I"},(L=>this.cursorForwardTab(L))),this._parser.registerCsiHandler({final:"J"},(L=>this.eraseInDisplay(L,!1))),this._parser.registerCsiHandler({prefix:"?",final:"J"},(L=>this.eraseInDisplay(L,!0))),this._parser.registerCsiHandler({final:"K"},(L=>this.eraseInLine(L,!1))),this._parser.registerCsiHandler({prefix:"?",final:"K"},(L=>this.eraseInLine(L,!0))),this._parser.registerCsiHandler({final:"L"},(L=>this.insertLines(L))),this._parser.registerCsiHandler({final:"M"},(L=>this.deleteLines(L))),this._parser.registerCsiHandler({final:"P"},(L=>this.deleteChars(L))),this._parser.registerCsiHandler({final:"S"},(L=>this.scrollUp(L))),this._parser.registerCsiHandler({final:"T"},(L=>this.scrollDown(L))),this._parser.registerCsiHandler({final:"X"},(L=>this.eraseChars(L))),this._parser.registerCsiHandler({final:"Z"},(L=>this.cursorBackwardTab(L))),this._parser.registerCsiHandler({final:"`"},(L=>this.charPosAbsolute(L))),this._parser.registerCsiHandler({final:"a"},(L=>this.hPositionRelative(L))),this._parser.registerCsiHandler({final:"b"},(L=>this.repeatPrecedingCharacter(L))),this._parser.registerCsiHandler({final:"c"},(L=>this.sendDeviceAttributesPrimary(L))),this._parser.registerCsiHandler({prefix:">",final:"c"},(L=>this.sendDeviceAttributesSecondary(L))),this._parser.registerCsiHandler({final:"d"},(L=>this.linePosAbsolute(L))),this._parser.registerCsiHandler({final:"e"},(L=>this.vPositionRelative(L))),this._parser.registerCsiHandler({final:"f"},(L=>this.hVPosition(L))),this._parser.registerCsiHandler({final:"g"},(L=>this.tabClear(L))),this._parser.registerCsiHandler({final:"h"},(L=>this.setMode(L))),this._parser.registerCsiHandler({prefix:"?",final:"h"},(L=>this.setModePrivate(L))),this._parser.registerCsiHandler({final:"l"},(L=>this.resetMode(L))),this._parser.registerCsiHandler({prefix:"?",final:"l"},(L=>this.resetModePrivate(L))),this._parser.registerCsiHandler({final:"m"},(L=>this.charAttributes(L))),this._parser.registerCsiHandler({final:"n"},(L=>this.deviceStatus(L))),this._parser.registerCsiHandler({prefix:"?",final:"n"},(L=>this.deviceStatusPrivate(L))),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(L=>this.softReset(L))),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(L=>this.setCursorStyle(L))),this._parser.registerCsiHandler({final:"r"},(L=>this.setScrollRegion(L))),this._parser.registerCsiHandler({final:"s"},(L=>this.saveCursor(L))),this._parser.registerCsiHandler({final:"t"},(L=>this.windowOptions(L))),this._parser.registerCsiHandler({final:"u"},(L=>this.restoreCursor(L))),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(L=>this.insertColumns(L))),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(L=>this.deleteColumns(L))),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(L=>this.selectProtected(L))),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(L=>this.requestMode(L,!0))),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(L=>this.requestMode(L,!1))),this._parser.setExecuteHandler(h.C0.BEL,(()=>this.bell())),this._parser.setExecuteHandler(h.C0.LF,(()=>this.lineFeed())),this._parser.setExecuteHandler(h.C0.VT,(()=>this.lineFeed())),this._parser.setExecuteHandler(h.C0.FF,(()=>this.lineFeed())),this._parser.setExecuteHandler(h.C0.CR,(()=>this.carriageReturn())),this._parser.setExecuteHandler(h.C0.BS,(()=>this.backspace())),this._parser.setExecuteHandler(h.C0.HT,(()=>this.tab())),this._parser.setExecuteHandler(h.C0.SO,(()=>this.shiftOut())),this._parser.setExecuteHandler(h.C0.SI,(()=>this.shiftIn())),this._parser.setExecuteHandler(h.C1.IND,(()=>this.index())),this._parser.setExecuteHandler(h.C1.NEL,(()=>this.nextLine())),this._parser.setExecuteHandler(h.C1.HTS,(()=>this.tabSet())),this._parser.registerOscHandler(0,new k.OscHandler((L=>(this.setTitle(L),this.setIconName(L),!0)))),this._parser.registerOscHandler(1,new k.OscHandler((L=>this.setIconName(L)))),this._parser.registerOscHandler(2,new k.OscHandler((L=>this.setTitle(L)))),this._parser.registerOscHandler(4,new k.OscHandler((L=>this.setOrReportIndexedColor(L)))),this._parser.registerOscHandler(8,new k.OscHandler((L=>this.setHyperlink(L)))),this._parser.registerOscHandler(10,new k.OscHandler((L=>this.setOrReportFgColor(L)))),this._parser.registerOscHandler(11,new k.OscHandler((L=>this.setOrReportBgColor(L)))),this._parser.registerOscHandler(12,new k.OscHandler((L=>this.setOrReportCursorColor(L)))),this._parser.registerOscHandler(104,new k.OscHandler((L=>this.restoreIndexedColor(L)))),this._parser.registerOscHandler(110,new k.OscHandler((L=>this.restoreFgColor(L)))),this._parser.registerOscHandler(111,new k.OscHandler((L=>this.restoreBgColor(L)))),this._parser.registerOscHandler(112,new k.OscHandler((L=>this.restoreCursorColor(L)))),this._parser.registerEscHandler({final:"7"},(()=>this.saveCursor())),this._parser.registerEscHandler({final:"8"},(()=>this.restoreCursor())),this._parser.registerEscHandler({final:"D"},(()=>this.index())),this._parser.registerEscHandler({final:"E"},(()=>this.nextLine())),this._parser.registerEscHandler({final:"H"},(()=>this.tabSet())),this._parser.registerEscHandler({final:"M"},(()=>this.reverseIndex())),this._parser.registerEscHandler({final:"="},(()=>this.keypadApplicationMode())),this._parser.registerEscHandler({final:">"},(()=>this.keypadNumericMode())),this._parser.registerEscHandler({final:"c"},(()=>this.fullReset())),this._parser.registerEscHandler({final:"n"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"o"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"|"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"}"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"~"},(()=>this.setgLevel(1))),this._parser.registerEscHandler({intermediates:"%",final:"@"},(()=>this.selectDefaultCharset())),this._parser.registerEscHandler({intermediates:"%",final:"G"},(()=>this.selectDefaultCharset()));for(const L in f.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:L},(()=>this.selectCharset("("+L))),this._parser.registerEscHandler({intermediates:")",final:L},(()=>this.selectCharset(")"+L))),this._parser.registerEscHandler({intermediates:"*",final:L},(()=>this.selectCharset("*"+L))),this._parser.registerEscHandler({intermediates:"+",final:L},(()=>this.selectCharset("+"+L))),this._parser.registerEscHandler({intermediates:"-",final:L},(()=>this.selectCharset("-"+L))),this._parser.registerEscHandler({intermediates:".",final:L},(()=>this.selectCharset("."+L))),this._parser.registerEscHandler({intermediates:"/",final:L},(()=>this.selectCharset("/"+L)));this._parser.registerEscHandler({intermediates:"#",final:"8"},(()=>this.screenAlignmentPattern())),this._parser.setErrorHandler((L=>(this._logService.error("Parsing error: ",L),L))),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new w.DcsHandler(((L,K)=>this.requestStatusString(L,K))))}_preserveStack(M,C,I,F){this._parseStack.paused=!0,this._parseStack.cursorStartX=M,this._parseStack.cursorStartY=C,this._parseStack.decodedLength=I,this._parseStack.position=F}_logSlowResolvingAsync(M){this._logService.logLevel<=S.LogLevelEnum.WARN&&Promise.race([M,new Promise(((C,I)=>setTimeout((()=>I("#SLOW_TIMEOUT")),5e3)))]).catch((C=>{if(C!=="#SLOW_TIMEOUT")throw C;console.warn("async parser handler taking longer than 5000 ms")}))}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(M,C){let I,F=this._activeBuffer.x,R=this._activeBuffer.y,X=0;const ie=this._parseStack.paused;if(ie){if(I=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,C))return this._logSlowResolvingAsync(I),I;F=this._parseStack.cursorStartX,R=this._parseStack.cursorStartY,this._parseStack.paused=!1,M.length>T&&(X=this._parseStack.position+T)}if(this._logService.logLevel<=S.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof M=="string"?` "${M}"`:` "${Array.prototype.map.call(M,(L=>String.fromCharCode(L))).join("")}"`),typeof M=="string"?M.split("").map((L=>L.charCodeAt(0))):M),this._parseBuffer.length<M.length&&this._parseBuffer.length<T&&(this._parseBuffer=new Uint32Array(Math.min(M.length,T))),ie||this._dirtyRowTracker.clearRange(),M.length>T)for(let L=X;L<M.length;L+=T){const K=L+T<M.length?L+T:M.length,W=typeof M=="string"?this._stringDecoder.decode(M.substring(L,K),this._parseBuffer):this._utf8Decoder.decode(M.subarray(L,K),this._parseBuffer);if(I=this._parser.parse(this._parseBuffer,W))return this._preserveStack(F,R,W,L),this._logSlowResolvingAsync(I),I}else if(!ie){const L=typeof M=="string"?this._stringDecoder.decode(M,this._parseBuffer):this._utf8Decoder.decode(M,this._parseBuffer);if(I=this._parser.parse(this._parseBuffer,L))return this._preserveStack(F,R,L,0),this._logSlowResolvingAsync(I),I}this._activeBuffer.x===F&&this._activeBuffer.y===R||this._onCursorMove.fire();const re=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),P=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);P<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(P,this._bufferService.rows-1),Math.min(re,this._bufferService.rows-1))}print(M,C,I){let F,R;const X=this._charsetService.charset,ie=this._optionsService.rawOptions.screenReaderMode,re=this._bufferService.cols,P=this._coreService.decPrivateModes.wraparound,L=this._coreService.modes.insertMode,K=this._curAttrData;let W=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&I-C>0&&W.getWidth(this._activeBuffer.x-1)===2&&W.setCellFromCodepoint(this._activeBuffer.x-1,0,1,K);let Q=this._parser.precedingJoinState;for(let Y=C;Y<I;++Y){if(F=M[Y],F<127&&X){const Ue=X[String.fromCharCode(F)];Ue&&(F=Ue.charCodeAt(0))}const ge=this._unicodeService.charProperties(F,Q);R=x.UnicodeService.extractWidth(ge);const Be=x.UnicodeService.extractShouldJoin(ge),De=Be?x.UnicodeService.extractWidth(Q):0;if(Q=ge,ie&&this._onA11yChar.fire((0,y.stringFromCodePoint)(F)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+R-De>re){if(P){const Ue=W;let ce=this._activeBuffer.x-De;for(this._activeBuffer.x=De,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),W=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),De>0&&W instanceof p.BufferLine&&W.copyCellsFrom(Ue,ce,0,De,!1);ce<re;)Ue.setCellFromCodepoint(ce++,0,1,K)}else if(this._activeBuffer.x=re-1,R===2)continue}if(Be&&this._activeBuffer.x){const Ue=W.getWidth(this._activeBuffer.x-1)?1:2;W.addCodepointToCell(this._activeBuffer.x-Ue,F,R);for(let ce=R-De;--ce>=0;)W.setCellFromCodepoint(this._activeBuffer.x++,0,0,K)}else if(L&&(W.insertCells(this._activeBuffer.x,R-De,this._activeBuffer.getNullCell(K)),W.getWidth(re-1)===2&&W.setCellFromCodepoint(re-1,g.NULL_CELL_CODE,g.NULL_CELL_WIDTH,K)),W.setCellFromCodepoint(this._activeBuffer.x++,F,R,K),R>0)for(;--R;)W.setCellFromCodepoint(this._activeBuffer.x++,0,0,K)}this._parser.precedingJoinState=Q,this._activeBuffer.x<re&&I-C>0&&W.getWidth(this._activeBuffer.x)===0&&!W.hasContent(this._activeBuffer.x)&&W.setCellFromCodepoint(this._activeBuffer.x,0,1,K),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(M,C){return M.final!=="t"||M.prefix||M.intermediates?this._parser.registerCsiHandler(M,C):this._parser.registerCsiHandler(M,(I=>!B(I.params[0],this._optionsService.rawOptions.windowOptions)||C(I)))}registerDcsHandler(M,C){return this._parser.registerDcsHandler(M,new w.DcsHandler(C))}registerEscHandler(M,C){return this._parser.registerEscHandler(M,C)}registerOscHandler(M,C){return this._parser.registerOscHandler(M,new k.OscHandler(C))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var M;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&((M=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))!=null&&M.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const C=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);C.hasWidth(this._activeBuffer.x)&&!C.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const M=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-M),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(M=this._bufferService.cols-1){this._activeBuffer.x=Math.min(M,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(M,C){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=M,this._activeBuffer.y=this._activeBuffer.scrollTop+C):(this._activeBuffer.x=M,this._activeBuffer.y=C),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(M,C){this._restrictCursor(),this._setCursor(this._activeBuffer.x+M,this._activeBuffer.y+C)}cursorUp(M){const C=this._activeBuffer.y-this._activeBuffer.scrollTop;return C>=0?this._moveCursor(0,-Math.min(C,M.params[0]||1)):this._moveCursor(0,-(M.params[0]||1)),!0}cursorDown(M){const C=this._activeBuffer.scrollBottom-this._activeBuffer.y;return C>=0?this._moveCursor(0,Math.min(C,M.params[0]||1)):this._moveCursor(0,M.params[0]||1),!0}cursorForward(M){return this._moveCursor(M.params[0]||1,0),!0}cursorBackward(M){return this._moveCursor(-(M.params[0]||1),0),!0}cursorNextLine(M){return this.cursorDown(M),this._activeBuffer.x=0,!0}cursorPrecedingLine(M){return this.cursorUp(M),this._activeBuffer.x=0,!0}cursorCharAbsolute(M){return this._setCursor((M.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(M){return this._setCursor(M.length>=2?(M.params[1]||1)-1:0,(M.params[0]||1)-1),!0}charPosAbsolute(M){return this._setCursor((M.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(M){return this._moveCursor(M.params[0]||1,0),!0}linePosAbsolute(M){return this._setCursor(this._activeBuffer.x,(M.params[0]||1)-1),!0}vPositionRelative(M){return this._moveCursor(0,M.params[0]||1),!0}hVPosition(M){return this.cursorPosition(M),!0}tabClear(M){const C=M.params[0];return C===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:C===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(M){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let C=M.params[0]||1;for(;C--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(M){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let C=M.params[0]||1;for(;C--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(M){const C=M.params[0];return C===1&&(this._curAttrData.bg|=536870912),C!==2&&C!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(M,C,I,F=!1,R=!1){const X=this._activeBuffer.lines.get(this._activeBuffer.ybase+M);X.replaceCells(C,I,this._activeBuffer.getNullCell(this._eraseAttrData()),R),F&&(X.isWrapped=!1)}_resetBufferLine(M,C=!1){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+M);I&&(I.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),C),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+M),I.isWrapped=!1)}eraseInDisplay(M,C=!1){let I;switch(this._restrictCursor(this._bufferService.cols),M.params[0]){case 0:for(I=this._activeBuffer.y,this._dirtyRowTracker.markDirty(I),this._eraseInBufferLine(I++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,C);I<this._bufferService.rows;I++)this._resetBufferLine(I,C);this._dirtyRowTracker.markDirty(I);break;case 1:for(I=this._activeBuffer.y,this._dirtyRowTracker.markDirty(I),this._eraseInBufferLine(I,0,this._activeBuffer.x+1,!0,C),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(I+1).isWrapped=!1);I--;)this._resetBufferLine(I,C);this._dirtyRowTracker.markDirty(0);break;case 2:for(I=this._bufferService.rows,this._dirtyRowTracker.markDirty(I-1);I--;)this._resetBufferLine(I,C);this._dirtyRowTracker.markDirty(0);break;case 3:const F=this._activeBuffer.lines.length-this._bufferService.rows;F>0&&(this._activeBuffer.lines.trimStart(F),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-F,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-F,0),this._onScroll.fire(0))}return!0}eraseInLine(M,C=!1){switch(this._restrictCursor(this._bufferService.cols),M.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,C);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,C);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,C)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(M){this._restrictCursor();let C=M.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const I=this._activeBuffer.ybase+this._activeBuffer.y,F=this._bufferService.rows-1-this._activeBuffer.scrollBottom,R=this._bufferService.rows-1+this._activeBuffer.ybase-F+1;for(;C--;)this._activeBuffer.lines.splice(R-1,1),this._activeBuffer.lines.splice(I,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(M){this._restrictCursor();let C=M.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const I=this._activeBuffer.ybase+this._activeBuffer.y;let F;for(F=this._bufferService.rows-1-this._activeBuffer.scrollBottom,F=this._bufferService.rows-1+this._activeBuffer.ybase-F;C--;)this._activeBuffer.lines.splice(I,1),this._activeBuffer.lines.splice(F,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(M){this._restrictCursor();const C=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return C&&(C.insertCells(this._activeBuffer.x,M.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(M){this._restrictCursor();const C=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return C&&(C.deleteCells(this._activeBuffer.x,M.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(M){let C=M.params[0]||1;for(;C--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(M){let C=M.params[0]||1;for(;C--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(p.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(M){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const C=M.params[0]||1;for(let I=this._activeBuffer.scrollTop;I<=this._activeBuffer.scrollBottom;++I){const F=this._activeBuffer.lines.get(this._activeBuffer.ybase+I);F.deleteCells(0,C,this._activeBuffer.getNullCell(this._eraseAttrData())),F.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(M){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const C=M.params[0]||1;for(let I=this._activeBuffer.scrollTop;I<=this._activeBuffer.scrollBottom;++I){const F=this._activeBuffer.lines.get(this._activeBuffer.ybase+I);F.insertCells(0,C,this._activeBuffer.getNullCell(this._eraseAttrData())),F.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(M){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const C=M.params[0]||1;for(let I=this._activeBuffer.scrollTop;I<=this._activeBuffer.scrollBottom;++I){const F=this._activeBuffer.lines.get(this._activeBuffer.ybase+I);F.insertCells(this._activeBuffer.x,C,this._activeBuffer.getNullCell(this._eraseAttrData())),F.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(M){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const C=M.params[0]||1;for(let I=this._activeBuffer.scrollTop;I<=this._activeBuffer.scrollBottom;++I){const F=this._activeBuffer.lines.get(this._activeBuffer.ybase+I);F.deleteCells(this._activeBuffer.x,C,this._activeBuffer.getNullCell(this._eraseAttrData())),F.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(M){this._restrictCursor();const C=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return C&&(C.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(M.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(M){const C=this._parser.precedingJoinState;if(!C)return!0;const I=M.params[0]||1,F=x.UnicodeService.extractWidth(C),R=this._activeBuffer.x-F,X=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(R),ie=new Uint32Array(X.length*I);let re=0;for(let L=0;L<X.length;){const K=X.codePointAt(L)||0;ie[re++]=K,L+=K>65535?2:1}let P=re;for(let L=1;L<I;++L)ie.copyWithin(P,0,re),P+=re;return this.print(ie,0,P),!0}sendDeviceAttributesPrimary(M){return M.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(h.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(h.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(M){return M.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(h.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(h.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(M.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(h.C0.ESC+"[>83;40003;0c")),!0}_is(M){return(this._optionsService.rawOptions.termName+"").indexOf(M)===0}setMode(M){for(let C=0;C<M.length;C++)switch(M.params[C]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(M){for(let C=0;C<M.length;C++)switch(M.params[C]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,f.DEFAULT_CHARSET),this._charsetService.setgCharset(1,f.DEFAULT_CHARSET),this._charsetService.setgCharset(2,f.DEFAULT_CHARSET),this._charsetService.setgCharset(3,f.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(M){for(let C=0;C<M.length;C++)switch(M.params[C]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(M){for(let C=0;C<M.length;C++)switch(M.params[C]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),M.params[C]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(M,C){const I=this._coreService.decPrivateModes,{activeProtocol:F,activeEncoding:R}=this._coreMouseService,X=this._coreService,{buffers:ie,cols:re}=this._bufferService,{active:P,alt:L}=ie,K=this._optionsService.rawOptions,W=Be=>Be?1:2,Q=M.params[0];return Y=Q,ge=C?Q===2?4:Q===4?W(X.modes.insertMode):Q===12?3:Q===20?W(K.convertEol):0:Q===1?W(I.applicationCursorKeys):Q===3?K.windowOptions.setWinLines?re===80?2:re===132?1:0:0:Q===6?W(I.origin):Q===7?W(I.wraparound):Q===8?3:Q===9?W(F==="X10"):Q===12?W(K.cursorBlink):Q===25?W(!X.isCursorHidden):Q===45?W(I.reverseWraparound):Q===66?W(I.applicationKeypad):Q===67?4:Q===1e3?W(F==="VT200"):Q===1002?W(F==="DRAG"):Q===1003?W(F==="ANY"):Q===1004?W(I.sendFocus):Q===1005?4:Q===1006?W(R==="SGR"):Q===1015?4:Q===1016?W(R==="SGR_PIXELS"):Q===1048?1:Q===47||Q===1047||Q===1049?W(P===L):Q===2004?W(I.bracketedPasteMode):0,X.triggerDataEvent(`${h.C0.ESC}[${C?"":"?"}${Y};${ge}$y`),!0;var Y,ge}_updateAttrColor(M,C,I,F,R){return C===2?(M|=50331648,M&=-16777216,M|=b.AttributeData.fromColorRGB([I,F,R])):C===5&&(M&=-50331904,M|=33554432|255&I),M}_extractColor(M,C,I){const F=[0,0,-1,0,0,0];let R=0,X=0;do{if(F[X+R]=M.params[C+X],M.hasSubParams(C+X)){const ie=M.getSubParams(C+X);let re=0;do F[1]===5&&(R=1),F[X+re+1+R]=ie[re];while(++re<ie.length&&re+X+1+R<F.length);break}if(F[1]===5&&X+R>=2||F[1]===2&&X+R>=5)break;F[1]&&(R=1)}while(++X+C<M.length&&X+R<F.length);for(let ie=2;ie<F.length;++ie)F[ie]===-1&&(F[ie]=0);switch(F[0]){case 38:I.fg=this._updateAttrColor(I.fg,F[1],F[3],F[4],F[5]);break;case 48:I.bg=this._updateAttrColor(I.bg,F[1],F[3],F[4],F[5]);break;case 58:I.extended=I.extended.clone(),I.extended.underlineColor=this._updateAttrColor(I.extended.underlineColor,F[1],F[3],F[4],F[5])}return X}_processUnderline(M,C){C.extended=C.extended.clone(),(!~M||M>5)&&(M=1),C.extended.underlineStyle=M,C.fg|=268435456,M===0&&(C.fg&=-268435457),C.updateExtended()}_processSGR0(M){M.fg=p.DEFAULT_ATTR_DATA.fg,M.bg=p.DEFAULT_ATTR_DATA.bg,M.extended=M.extended.clone(),M.extended.underlineStyle=0,M.extended.underlineColor&=-67108864,M.updateExtended()}charAttributes(M){if(M.length===1&&M.params[0]===0)return this._processSGR0(this._curAttrData),!0;const C=M.length;let I;const F=this._curAttrData;for(let R=0;R<C;R++)I=M.params[R],I>=30&&I<=37?(F.fg&=-50331904,F.fg|=16777216|I-30):I>=40&&I<=47?(F.bg&=-50331904,F.bg|=16777216|I-40):I>=90&&I<=97?(F.fg&=-50331904,F.fg|=16777224|I-90):I>=100&&I<=107?(F.bg&=-50331904,F.bg|=16777224|I-100):I===0?this._processSGR0(F):I===1?F.fg|=134217728:I===3?F.bg|=67108864:I===4?(F.fg|=268435456,this._processUnderline(M.hasSubParams(R)?M.getSubParams(R)[0]:1,F)):I===5?F.fg|=536870912:I===7?F.fg|=67108864:I===8?F.fg|=1073741824:I===9?F.fg|=2147483648:I===2?F.bg|=134217728:I===21?this._processUnderline(2,F):I===22?(F.fg&=-134217729,F.bg&=-134217729):I===23?F.bg&=-67108865:I===24?(F.fg&=-268435457,this._processUnderline(0,F)):I===25?F.fg&=-536870913:I===27?F.fg&=-67108865:I===28?F.fg&=-1073741825:I===29?F.fg&=2147483647:I===39?(F.fg&=-67108864,F.fg|=16777215&p.DEFAULT_ATTR_DATA.fg):I===49?(F.bg&=-67108864,F.bg|=16777215&p.DEFAULT_ATTR_DATA.bg):I===38||I===48||I===58?R+=this._extractColor(M,R,F):I===53?F.bg|=1073741824:I===55?F.bg&=-1073741825:I===59?(F.extended=F.extended.clone(),F.extended.underlineColor=-1,F.updateExtended()):I===100?(F.fg&=-67108864,F.fg|=16777215&p.DEFAULT_ATTR_DATA.fg,F.bg&=-67108864,F.bg|=16777215&p.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",I);return!0}deviceStatus(M){switch(M.params[0]){case 5:this._coreService.triggerDataEvent(`${h.C0.ESC}[0n`);break;case 6:const C=this._activeBuffer.y+1,I=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${h.C0.ESC}[${C};${I}R`)}return!0}deviceStatusPrivate(M){if(M.params[0]===6){const C=this._activeBuffer.y+1,I=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${h.C0.ESC}[?${C};${I}R`)}return!0}softReset(M){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=p.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(M){const C=M.params[0]||1;switch(C){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const I=C%2==1;return this._optionsService.options.cursorBlink=I,!0}setScrollRegion(M){const C=M.params[0]||1;let I;return(M.length<2||(I=M.params[1])>this._bufferService.rows||I===0)&&(I=this._bufferService.rows),I>C&&(this._activeBuffer.scrollTop=C-1,this._activeBuffer.scrollBottom=I-1,this._setCursor(0,0)),!0}windowOptions(M){if(!B(M.params[0],this._optionsService.rawOptions.windowOptions))return!0;const C=M.length>1?M.params[1]:0;switch(M.params[0]){case 14:C!==2&&this._onRequestWindowsOptionsReport.fire(O.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(O.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${h.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:C!==0&&C!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),C!==0&&C!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:C!==0&&C!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),C!==0&&C!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(M){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(M){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(M){return this._windowTitle=M,this._onTitleChange.fire(M),!0}setIconName(M){return this._iconName=M,!0}setOrReportIndexedColor(M){const C=[],I=M.split(";");for(;I.length>1;){const F=I.shift(),R=I.shift();if(/^\d+$/.exec(F)){const X=parseInt(F);if($(X))if(R==="?")C.push({type:0,index:X});else{const ie=(0,E.parseColor)(R);ie&&C.push({type:1,index:X,color:ie})}}}return C.length&&this._onColor.fire(C),!0}setHyperlink(M){const C=M.split(";");return!(C.length<2)&&(C[1]?this._createHyperlink(C[0],C[1]):!C[0]&&this._finishHyperlink())}_createHyperlink(M,C){this._getCurrentLinkId()&&this._finishHyperlink();const I=M.split(":");let F;const R=I.findIndex((X=>X.startsWith("id=")));return R!==-1&&(F=I[R].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:F,uri:C}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(M,C){const I=M.split(";");for(let F=0;F<I.length&&!(C>=this._specialColors.length);++F,++C)if(I[F]==="?")this._onColor.fire([{type:0,index:this._specialColors[C]}]);else{const R=(0,E.parseColor)(I[F]);R&&this._onColor.fire([{type:1,index:this._specialColors[C],color:R}])}return!0}setOrReportFgColor(M){return this._setOrReportSpecialColor(M,0)}setOrReportBgColor(M){return this._setOrReportSpecialColor(M,1)}setOrReportCursorColor(M){return this._setOrReportSpecialColor(M,2)}restoreIndexedColor(M){if(!M)return this._onColor.fire([{type:2}]),!0;const C=[],I=M.split(";");for(let F=0;F<I.length;++F)if(/^\d+$/.exec(I[F])){const R=parseInt(I[F]);$(R)&&C.push({type:2,index:R})}return C.length&&this._onColor.fire(C),!0}restoreFgColor(M){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(M){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(M){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,f.DEFAULT_CHARSET),!0}selectCharset(M){return M.length!==2?(this.selectDefaultCharset(),!0):(M[0]==="/"||this._charsetService.setgCharset(A[M[0]],f.CHARSETS[M[1]]||f.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const M=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,M,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=p.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=p.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(M){return this._charsetService.setgLevel(M),!0}screenAlignmentPattern(){const M=new v.CellData;M.content=4194373,M.fg=this._curAttrData.fg,M.bg=this._curAttrData.bg,this._setCursor(0,0);for(let C=0;C<this._bufferService.rows;++C){const I=this._activeBuffer.ybase+this._activeBuffer.y+C,F=this._activeBuffer.lines.get(I);F&&(F.fill(M),F.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(M,C){const I=this._bufferService.buffer,F=this._optionsService.rawOptions;return(R=>(this._coreService.triggerDataEvent(`${h.C0.ESC}${R}${h.C0.ESC}\\`),!0))(M==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:M==='"p'?'P1$r61;1"p':M==="r"?`P1$r${I.scrollTop+1};${I.scrollBottom+1}r`:M==="m"?"P1$r0m":M===" q"?`P1$r${{block:2,underline:4,bar:6}[F.cursorStyle]-(F.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(M,C){this._dirtyRowTracker.markRangeDirty(M,C)}}o.InputHandler=j;let z=class{constructor(q){this._bufferService=q,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(q){q<this.start?this.start=q:q>this.end&&(this.end=q)}markRangeDirty(q,M){q>M&&(N=q,q=M,M=N),q<this.start&&(this.start=q),M>this.end&&(this.end=M)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function $(q){return 0<=q&&q<256}z=c([u(0,S.IBufferService)],z)},844:(l,o)=>{function a(c){for(const u of c)u.dispose();c.length=0}Object.defineProperty(o,"__esModule",{value:!0}),o.getDisposeArrayDisposable=o.disposeArray=o.toDisposable=o.MutableDisposable=o.Disposable=void 0,o.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const c of this._disposables)c.dispose();this._disposables.length=0}register(c){return this._disposables.push(c),c}unregister(c){const u=this._disposables.indexOf(c);u!==-1&&this._disposables.splice(u,1)}},o.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(c){var u;this._isDisposed||c===this._value||((u=this._value)==null||u.dispose(),this._value=c)}clear(){this.value=void 0}dispose(){var c;this._isDisposed=!0,(c=this._value)==null||c.dispose(),this._value=void 0}},o.toDisposable=function(c){return{dispose:c}},o.disposeArray=a,o.getDisposeArrayDisposable=function(c){return{dispose:()=>a(c)}}},1505:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.FourKeyMap=o.TwoKeyMap=void 0;class a{constructor(){this._data={}}set(u,h,f){this._data[u]||(this._data[u]={}),this._data[u][h]=f}get(u,h){return this._data[u]?this._data[u][h]:void 0}clear(){this._data={}}}o.TwoKeyMap=a,o.FourKeyMap=class{constructor(){this._data=new a}set(c,u,h,f,d){this._data.get(c,u)||this._data.set(c,u,new a),this._data.get(c,u).set(h,f,d)}get(c,u,h,f){var d;return(d=this._data.get(c,u))==null?void 0:d.get(h,f)}clear(){this._data.clear()}}},6114:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.isChromeOS=o.isLinux=o.isWindows=o.isIphone=o.isIpad=o.isMac=o.getSafariVersion=o.isSafari=o.isLegacyEdge=o.isFirefox=o.isNode=void 0,o.isNode=typeof process<"u"&&"title"in process;const a=o.isNode?"node":navigator.userAgent,c=o.isNode?"node":navigator.platform;o.isFirefox=a.includes("Firefox"),o.isLegacyEdge=a.includes("Edge"),o.isSafari=/^((?!chrome|android).)*safari/i.test(a),o.getSafariVersion=function(){if(!o.isSafari)return 0;const u=a.match(/Version\/(\d+)/);return u===null||u.length<2?0:parseInt(u[1])},o.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(c),o.isIpad=c==="iPad",o.isIphone=c==="iPhone",o.isWindows=["Windows","Win16","Win32","WinCE"].includes(c),o.isLinux=c.indexOf("Linux")>=0,o.isChromeOS=/\bCrOS\b/.test(a)},6106:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.SortedList=void 0;let a=0;o.SortedList=class{constructor(c){this._getKey=c,this._array=[]}clear(){this._array.length=0}insert(c){this._array.length!==0?(a=this._search(this._getKey(c)),this._array.splice(a,0,c)):this._array.push(c)}delete(c){if(this._array.length===0)return!1;const u=this._getKey(c);if(u===void 0||(a=this._search(u),a===-1)||this._getKey(this._array[a])!==u)return!1;do if(this._array[a]===c)return this._array.splice(a,1),!0;while(++a<this._array.length&&this._getKey(this._array[a])===u);return!1}*getKeyIterator(c){if(this._array.length!==0&&(a=this._search(c),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===c))do yield this._array[a];while(++a<this._array.length&&this._getKey(this._array[a])===c)}forEachByKey(c,u){if(this._array.length!==0&&(a=this._search(c),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===c))do u(this._array[a]);while(++a<this._array.length&&this._getKey(this._array[a])===c)}values(){return[...this._array].values()}_search(c){let u=0,h=this._array.length-1;for(;h>=u;){let f=u+h>>1;const d=this._getKey(this._array[f]);if(d>c)h=f-1;else{if(!(d<c)){for(;f>0&&this._getKey(this._array[f-1])===c;)f--;return f}u=f+1}}return u}}},7226:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DebouncedIdleTask=o.IdleTaskQueue=o.PriorityTaskQueue=void 0;const c=a(6114);class u{constructor(){this._tasks=[],this._i=0}enqueue(d){this._tasks.push(d),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(d){this._idleCallback=void 0;let _=0,y=0,p=d.timeRemaining(),m=0;for(;this._i<this._tasks.length;){if(_=Date.now(),this._tasks[this._i]()||this._i++,_=Math.max(1,Date.now()-_),y=Math.max(_,y),m=d.timeRemaining(),1.5*y>m)return p-_<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(p-_))}ms`),void this._start();p=m}this.clear()}}class h extends u{_requestCallback(d){return setTimeout((()=>d(this._createDeadline(16))))}_cancelCallback(d){clearTimeout(d)}_createDeadline(d){const _=Date.now()+d;return{timeRemaining:()=>Math.max(0,_-Date.now())}}}o.PriorityTaskQueue=h,o.IdleTaskQueue=!c.isNode&&"requestIdleCallback"in window?class extends u{_requestCallback(f){return requestIdleCallback(f)}_cancelCallback(f){cancelIdleCallback(f)}}:h,o.DebouncedIdleTask=class{constructor(){this._queue=new o.IdleTaskQueue}set(f){this._queue.clear(),this._queue.enqueue(f)}flush(){this._queue.flush()}}},9282:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.updateWindowsModeWrappedState=void 0;const c=a(643);o.updateWindowsModeWrappedState=function(u){const h=u.buffer.lines.get(u.buffer.ybase+u.buffer.y-1),f=h==null?void 0:h.get(u.cols-1),d=u.buffer.lines.get(u.buffer.ybase+u.buffer.y);d&&f&&(d.isWrapped=f[c.CHAR_DATA_CODE_INDEX]!==c.NULL_CELL_CODE&&f[c.CHAR_DATA_CODE_INDEX]!==c.WHITESPACE_CELL_CODE)}},3734:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ExtendedAttrs=o.AttributeData=void 0;class a{constructor(){this.fg=0,this.bg=0,this.extended=new c}static toColorRGB(h){return[h>>>16&255,h>>>8&255,255&h]}static fromColorRGB(h){return(255&h[0])<<16|(255&h[1])<<8|255&h[2]}clone(){const h=new a;return h.fg=this.fg,h.bg=this.bg,h.extended=this.extended.clone(),h}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}o.AttributeData=a;class c{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(h){this._ext=h}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(h){this._ext&=-469762049,this._ext|=h<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(h){this._ext&=-67108864,this._ext|=67108863&h}get urlId(){return this._urlId}set urlId(h){this._urlId=h}get underlineVariantOffset(){const h=(3758096384&this._ext)>>29;return h<0?4294967288^h:h}set underlineVariantOffset(h){this._ext&=536870911,this._ext|=h<<29&3758096384}constructor(h=0,f=0){this._ext=0,this._urlId=0,this._ext=h,this._urlId=f}clone(){return new c(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}o.ExtendedAttrs=c},9092:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Buffer=o.MAX_BUFFER_SIZE=void 0;const c=a(6349),u=a(7226),h=a(3734),f=a(8437),d=a(4634),_=a(511),y=a(643),p=a(4863),m=a(7116);o.MAX_BUFFER_SIZE=4294967295,o.Buffer=class{constructor(g,v,b){this._hasScrollback=g,this._optionsService=v,this._bufferService=b,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=f.DEFAULT_ATTR_DATA.clone(),this.savedCharset=m.DEFAULT_CHARSET,this.markers=[],this._nullCell=_.CellData.fromCharData([0,y.NULL_CELL_CHAR,y.NULL_CELL_WIDTH,y.NULL_CELL_CODE]),this._whitespaceCell=_.CellData.fromCharData([0,y.WHITESPACE_CELL_CHAR,y.WHITESPACE_CELL_WIDTH,y.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new u.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new c.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(g){return g?(this._nullCell.fg=g.fg,this._nullCell.bg=g.bg,this._nullCell.extended=g.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new h.ExtendedAttrs),this._nullCell}getWhitespaceCell(g){return g?(this._whitespaceCell.fg=g.fg,this._whitespaceCell.bg=g.bg,this._whitespaceCell.extended=g.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new h.ExtendedAttrs),this._whitespaceCell}getBlankLine(g,v){return new f.BufferLine(this._bufferService.cols,this.getNullCell(g),v)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const g=this.ybase+this.y-this.ydisp;return g>=0&&g<this._rows}_getCorrectBufferLength(g){if(!this._hasScrollback)return g;const v=g+this._optionsService.rawOptions.scrollback;return v>o.MAX_BUFFER_SIZE?o.MAX_BUFFER_SIZE:v}fillViewportRows(g){if(this.lines.length===0){g===void 0&&(g=f.DEFAULT_ATTR_DATA);let v=this._rows;for(;v--;)this.lines.push(this.getBlankLine(g))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new c.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(g,v){const b=this.getNullCell(f.DEFAULT_ATTR_DATA);let S=0;const x=this._getCorrectBufferLength(v);if(x>this.lines.maxLength&&(this.lines.maxLength=x),this.lines.length>0){if(this._cols<g)for(let w=0;w<this.lines.length;w++)S+=+this.lines.get(w).resize(g,b);let k=0;if(this._rows<v)for(let w=this._rows;w<v;w++)this.lines.length<v+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new f.BufferLine(g,b)):this.ybase>0&&this.lines.length<=this.ybase+this.y+k+1?(this.ybase--,k++,this.ydisp>0&&this.ydisp--):this.lines.push(new f.BufferLine(g,b)));else for(let w=this._rows;w>v;w--)this.lines.length>v+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(x<this.lines.maxLength){const w=this.lines.length-x;w>0&&(this.lines.trimStart(w),this.ybase=Math.max(this.ybase-w,0),this.ydisp=Math.max(this.ydisp-w,0),this.savedY=Math.max(this.savedY-w,0)),this.lines.maxLength=x}this.x=Math.min(this.x,g-1),this.y=Math.min(this.y,v-1),k&&(this.y+=k),this.savedX=Math.min(this.savedX,g-1),this.scrollTop=0}if(this.scrollBottom=v-1,this._isReflowEnabled&&(this._reflow(g,v),this._cols>g))for(let k=0;k<this.lines.length;k++)S+=+this.lines.get(k).resize(g,b);this._cols=g,this._rows=v,this._memoryCleanupQueue.clear(),S>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue((()=>this._batchedMemoryCleanup())))}_batchedMemoryCleanup(){let g=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,g=!1);let v=0;for(;this._memoryCleanupPosition<this.lines.length;)if(v+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),v>100)return!0;return g}get _isReflowEnabled(){const g=this._optionsService.rawOptions.windowsPty;return g&&g.buildNumber?this._hasScrollback&&g.backend==="conpty"&&g.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(g,v){this._cols!==g&&(g>this._cols?this._reflowLarger(g,v):this._reflowSmaller(g,v))}_reflowLarger(g,v){const b=(0,d.reflowLargerGetLinesToRemove)(this.lines,this._cols,g,this.ybase+this.y,this.getNullCell(f.DEFAULT_ATTR_DATA));if(b.length>0){const S=(0,d.reflowLargerCreateNewLayout)(this.lines,b);(0,d.reflowLargerApplyNewLayout)(this.lines,S.layout),this._reflowLargerAdjustViewport(g,v,S.countRemoved)}}_reflowLargerAdjustViewport(g,v,b){const S=this.getNullCell(f.DEFAULT_ATTR_DATA);let x=b;for(;x-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<v&&this.lines.push(new f.BufferLine(g,S))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-b,0)}_reflowSmaller(g,v){const b=this.getNullCell(f.DEFAULT_ATTR_DATA),S=[];let x=0;for(let k=this.lines.length-1;k>=0;k--){let w=this.lines.get(k);if(!w||!w.isWrapped&&w.getTrimmedLength()<=g)continue;const E=[w];for(;w.isWrapped&&k>0;)w=this.lines.get(--k),E.unshift(w);const A=this.ybase+this.y;if(A>=k&&A<k+E.length)continue;const T=E[E.length-1].getTrimmedLength(),B=(0,d.reflowSmallerGetNewLineLengths)(E,this._cols,g),O=B.length-E.length;let N;N=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+O):Math.max(0,this.lines.length-this.lines.maxLength+O);const j=[];for(let I=0;I<O;I++){const F=this.getBlankLine(f.DEFAULT_ATTR_DATA,!0);j.push(F)}j.length>0&&(S.push({start:k+E.length+x,newLines:j}),x+=j.length),E.push(...j);let z=B.length-1,$=B[z];$===0&&(z--,$=B[z]);let q=E.length-O-1,M=T;for(;q>=0;){const I=Math.min(M,$);if(E[z]===void 0)break;if(E[z].copyCellsFrom(E[q],M-I,$-I,I,!0),$-=I,$===0&&(z--,$=B[z]),M-=I,M===0){q--;const F=Math.max(q,0);M=(0,d.getWrappedLineTrimmedLength)(E,F,this._cols)}}for(let I=0;I<E.length;I++)B[I]<g&&E[I].setCell(B[I],b);let C=O-N;for(;C-- >0;)this.ybase===0?this.y<v-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+x)-v&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+O,this.ybase+v-1)}if(S.length>0){const k=[],w=[];for(let z=0;z<this.lines.length;z++)w.push(this.lines.get(z));const E=this.lines.length;let A=E-1,T=0,B=S[T];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+x);let O=0;for(let z=Math.min(this.lines.maxLength-1,E+x-1);z>=0;z--)if(B&&B.start>A+O){for(let $=B.newLines.length-1;$>=0;$--)this.lines.set(z--,B.newLines[$]);z++,k.push({index:A+1,amount:B.newLines.length}),O+=B.newLines.length,B=S[++T]}else this.lines.set(z,w[A--]);let N=0;for(let z=k.length-1;z>=0;z--)k[z].index+=N,this.lines.onInsertEmitter.fire(k[z]),N+=k[z].amount;const j=Math.max(0,E+x-this.lines.maxLength);j>0&&this.lines.onTrimEmitter.fire(j)}}translateBufferLineToString(g,v,b=0,S){const x=this.lines.get(g);return x?x.translateToString(v,b,S):""}getWrappedRangeForLine(g){let v=g,b=g;for(;v>0&&this.lines.get(v).isWrapped;)v--;for(;b+1<this.lines.length&&this.lines.get(b+1).isWrapped;)b++;return{first:v,last:b}}setupTabStops(g){for(g!=null?this.tabs[g]||(g=this.prevStop(g)):(this.tabs={},g=0);g<this._cols;g+=this._optionsService.rawOptions.tabStopWidth)this.tabs[g]=!0}prevStop(g){for(g==null&&(g=this.x);!this.tabs[--g]&&g>0;);return g>=this._cols?this._cols-1:g<0?0:g}nextStop(g){for(g==null&&(g=this.x);!this.tabs[++g]&&g<this._cols;);return g>=this._cols?this._cols-1:g<0?0:g}clearMarkers(g){this._isClearing=!0;for(let v=0;v<this.markers.length;v++)this.markers[v].line===g&&(this.markers[v].dispose(),this.markers.splice(v--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let g=0;g<this.markers.length;g++)this.markers[g].dispose(),this.markers.splice(g--,1);this._isClearing=!1}addMarker(g){const v=new p.Marker(g);return this.markers.push(v),v.register(this.lines.onTrim((b=>{v.line-=b,v.line<0&&v.dispose()}))),v.register(this.lines.onInsert((b=>{v.line>=b.index&&(v.line+=b.amount)}))),v.register(this.lines.onDelete((b=>{v.line>=b.index&&v.line<b.index+b.amount&&v.dispose(),v.line>b.index&&(v.line-=b.amount)}))),v.register(v.onDispose((()=>this._removeMarker(v)))),v}_removeMarker(g){this._isClearing||this.markers.splice(this.markers.indexOf(g),1)}}},8437:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferLine=o.DEFAULT_ATTR_DATA=void 0;const c=a(3734),u=a(511),h=a(643),f=a(482);o.DEFAULT_ATTR_DATA=Object.freeze(new c.AttributeData);let d=0;class _{constructor(p,m,g=!1){this.isWrapped=g,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*p);const v=m||u.CellData.fromCharData([0,h.NULL_CELL_CHAR,h.NULL_CELL_WIDTH,h.NULL_CELL_CODE]);for(let b=0;b<p;++b)this.setCell(b,v);this.length=p}get(p){const m=this._data[3*p+0],g=2097151&m;return[this._data[3*p+1],2097152&m?this._combined[p]:g?(0,f.stringFromCodePoint)(g):"",m>>22,2097152&m?this._combined[p].charCodeAt(this._combined[p].length-1):g]}set(p,m){this._data[3*p+1]=m[h.CHAR_DATA_ATTR_INDEX],m[h.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[p]=m[1],this._data[3*p+0]=2097152|p|m[h.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*p+0]=m[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|m[h.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(p){return this._data[3*p+0]>>22}hasWidth(p){return 12582912&this._data[3*p+0]}getFg(p){return this._data[3*p+1]}getBg(p){return this._data[3*p+2]}hasContent(p){return 4194303&this._data[3*p+0]}getCodePoint(p){const m=this._data[3*p+0];return 2097152&m?this._combined[p].charCodeAt(this._combined[p].length-1):2097151&m}isCombined(p){return 2097152&this._data[3*p+0]}getString(p){const m=this._data[3*p+0];return 2097152&m?this._combined[p]:2097151&m?(0,f.stringFromCodePoint)(2097151&m):""}isProtected(p){return 536870912&this._data[3*p+2]}loadCell(p,m){return d=3*p,m.content=this._data[d+0],m.fg=this._data[d+1],m.bg=this._data[d+2],2097152&m.content&&(m.combinedData=this._combined[p]),268435456&m.bg&&(m.extended=this._extendedAttrs[p]),m}setCell(p,m){2097152&m.content&&(this._combined[p]=m.combinedData),268435456&m.bg&&(this._extendedAttrs[p]=m.extended),this._data[3*p+0]=m.content,this._data[3*p+1]=m.fg,this._data[3*p+2]=m.bg}setCellFromCodepoint(p,m,g,v){268435456&v.bg&&(this._extendedAttrs[p]=v.extended),this._data[3*p+0]=m|g<<22,this._data[3*p+1]=v.fg,this._data[3*p+2]=v.bg}addCodepointToCell(p,m,g){let v=this._data[3*p+0];2097152&v?this._combined[p]+=(0,f.stringFromCodePoint)(m):2097151&v?(this._combined[p]=(0,f.stringFromCodePoint)(2097151&v)+(0,f.stringFromCodePoint)(m),v&=-2097152,v|=2097152):v=m|4194304,g&&(v&=-12582913,v|=g<<22),this._data[3*p+0]=v}insertCells(p,m,g){if((p%=this.length)&&this.getWidth(p-1)===2&&this.setCellFromCodepoint(p-1,0,1,g),m<this.length-p){const v=new u.CellData;for(let b=this.length-p-m-1;b>=0;--b)this.setCell(p+m+b,this.loadCell(p+b,v));for(let b=0;b<m;++b)this.setCell(p+b,g)}else for(let v=p;v<this.length;++v)this.setCell(v,g);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,g)}deleteCells(p,m,g){if(p%=this.length,m<this.length-p){const v=new u.CellData;for(let b=0;b<this.length-p-m;++b)this.setCell(p+b,this.loadCell(p+m+b,v));for(let b=this.length-m;b<this.length;++b)this.setCell(b,g)}else for(let v=p;v<this.length;++v)this.setCell(v,g);p&&this.getWidth(p-1)===2&&this.setCellFromCodepoint(p-1,0,1,g),this.getWidth(p)!==0||this.hasContent(p)||this.setCellFromCodepoint(p,0,1,g)}replaceCells(p,m,g,v=!1){if(v)for(p&&this.getWidth(p-1)===2&&!this.isProtected(p-1)&&this.setCellFromCodepoint(p-1,0,1,g),m<this.length&&this.getWidth(m-1)===2&&!this.isProtected(m)&&this.setCellFromCodepoint(m,0,1,g);p<m&&p<this.length;)this.isProtected(p)||this.setCell(p,g),p++;else for(p&&this.getWidth(p-1)===2&&this.setCellFromCodepoint(p-1,0,1,g),m<this.length&&this.getWidth(m-1)===2&&this.setCellFromCodepoint(m,0,1,g);p<m&&p<this.length;)this.setCell(p++,g)}resize(p,m){if(p===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const g=3*p;if(p>this.length){if(this._data.buffer.byteLength>=4*g)this._data=new Uint32Array(this._data.buffer,0,g);else{const v=new Uint32Array(g);v.set(this._data),this._data=v}for(let v=this.length;v<p;++v)this.setCell(v,m)}else{this._data=this._data.subarray(0,g);const v=Object.keys(this._combined);for(let S=0;S<v.length;S++){const x=parseInt(v[S],10);x>=p&&delete this._combined[x]}const b=Object.keys(this._extendedAttrs);for(let S=0;S<b.length;S++){const x=parseInt(b[S],10);x>=p&&delete this._extendedAttrs[x]}}return this.length=p,4*g*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const p=new Uint32Array(this._data.length);return p.set(this._data),this._data=p,1}return 0}fill(p,m=!1){if(m)for(let g=0;g<this.length;++g)this.isProtected(g)||this.setCell(g,p);else{this._combined={},this._extendedAttrs={};for(let g=0;g<this.length;++g)this.setCell(g,p)}}copyFrom(p){this.length!==p.length?this._data=new Uint32Array(p._data):this._data.set(p._data),this.length=p.length,this._combined={};for(const m in p._combined)this._combined[m]=p._combined[m];this._extendedAttrs={};for(const m in p._extendedAttrs)this._extendedAttrs[m]=p._extendedAttrs[m];this.isWrapped=p.isWrapped}clone(){const p=new _(0);p._data=new Uint32Array(this._data),p.length=this.length;for(const m in this._combined)p._combined[m]=this._combined[m];for(const m in this._extendedAttrs)p._extendedAttrs[m]=this._extendedAttrs[m];return p.isWrapped=this.isWrapped,p}getTrimmedLength(){for(let p=this.length-1;p>=0;--p)if(4194303&this._data[3*p+0])return p+(this._data[3*p+0]>>22);return 0}getNoBgTrimmedLength(){for(let p=this.length-1;p>=0;--p)if(4194303&this._data[3*p+0]||50331648&this._data[3*p+2])return p+(this._data[3*p+0]>>22);return 0}copyCellsFrom(p,m,g,v,b){const S=p._data;if(b)for(let k=v-1;k>=0;k--){for(let w=0;w<3;w++)this._data[3*(g+k)+w]=S[3*(m+k)+w];268435456&S[3*(m+k)+2]&&(this._extendedAttrs[g+k]=p._extendedAttrs[m+k])}else for(let k=0;k<v;k++){for(let w=0;w<3;w++)this._data[3*(g+k)+w]=S[3*(m+k)+w];268435456&S[3*(m+k)+2]&&(this._extendedAttrs[g+k]=p._extendedAttrs[m+k])}const x=Object.keys(p._combined);for(let k=0;k<x.length;k++){const w=parseInt(x[k],10);w>=m&&(this._combined[w-m+g]=p._combined[w])}}translateToString(p,m,g,v){m=m??0,g=g??this.length,p&&(g=Math.min(g,this.getTrimmedLength())),v&&(v.length=0);let b="";for(;m<g;){const S=this._data[3*m+0],x=2097151&S,k=2097152&S?this._combined[m]:x?(0,f.stringFromCodePoint)(x):h.WHITESPACE_CELL_CHAR;if(b+=k,v)for(let w=0;w<k.length;++w)v.push(m);m+=S>>22||1}return v&&v.push(m),b}}o.BufferLine=_},4841:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.getRangeLength=void 0,o.getRangeLength=function(a,c){if(a.start.y>a.end.y)throw new Error(`Buffer range end (${a.end.x}, ${a.end.y}) cannot be before start (${a.start.x}, ${a.start.y})`);return c*(a.end.y-a.start.y)+(a.end.x-a.start.x+1)}},4634:(l,o)=>{function a(c,u,h){if(u===c.length-1)return c[u].getTrimmedLength();const f=!c[u].hasContent(h-1)&&c[u].getWidth(h-1)===1,d=c[u+1].getWidth(0)===2;return f&&d?h-1:h}Object.defineProperty(o,"__esModule",{value:!0}),o.getWrappedLineTrimmedLength=o.reflowSmallerGetNewLineLengths=o.reflowLargerApplyNewLayout=o.reflowLargerCreateNewLayout=o.reflowLargerGetLinesToRemove=void 0,o.reflowLargerGetLinesToRemove=function(c,u,h,f,d){const _=[];for(let y=0;y<c.length-1;y++){let p=y,m=c.get(++p);if(!m.isWrapped)continue;const g=[c.get(y)];for(;p<c.length&&m.isWrapped;)g.push(m),m=c.get(++p);if(f>=y&&f<p){y+=g.length-1;continue}let v=0,b=a(g,v,u),S=1,x=0;for(;S<g.length;){const w=a(g,S,u),E=w-x,A=h-b,T=Math.min(E,A);g[v].copyCellsFrom(g[S],x,b,T,!1),b+=T,b===h&&(v++,b=0),x+=T,x===w&&(S++,x=0),b===0&&v!==0&&g[v-1].getWidth(h-1)===2&&(g[v].copyCellsFrom(g[v-1],h-1,b++,1,!1),g[v-1].setCell(h-1,d))}g[v].replaceCells(b,h,d);let k=0;for(let w=g.length-1;w>0&&(w>v||g[w].getTrimmedLength()===0);w--)k++;k>0&&(_.push(y+g.length-k),_.push(k)),y+=g.length-1}return _},o.reflowLargerCreateNewLayout=function(c,u){const h=[];let f=0,d=u[f],_=0;for(let y=0;y<c.length;y++)if(d===y){const p=u[++f];c.onDeleteEmitter.fire({index:y-_,amount:p}),y+=p-1,_+=p,d=u[++f]}else h.push(y);return{layout:h,countRemoved:_}},o.reflowLargerApplyNewLayout=function(c,u){const h=[];for(let f=0;f<u.length;f++)h.push(c.get(u[f]));for(let f=0;f<h.length;f++)c.set(f,h[f]);c.length=u.length},o.reflowSmallerGetNewLineLengths=function(c,u,h){const f=[],d=c.map(((m,g)=>a(c,g,u))).reduce(((m,g)=>m+g));let _=0,y=0,p=0;for(;p<d;){if(d-p<h){f.push(d-p);break}_+=h;const m=a(c,y,u);_>m&&(_-=m,y++);const g=c[y].getWidth(_-1)===2;g&&_--;const v=g?h-1:h;f.push(v),p+=v}return f},o.getWrappedLineTrimmedLength=a},5295:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferSet=void 0;const c=a(8460),u=a(844),h=a(9092);class f extends u.Disposable{constructor(_,y){super(),this._optionsService=_,this._bufferService=y,this._onBufferActivate=this.register(new c.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.resize(this._bufferService.cols,this._bufferService.rows)))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",(()=>this.setupTabStops())))}reset(){this._normal=new h.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new h.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(_){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(_),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(_,y){this._normal.resize(_,y),this._alt.resize(_,y),this.setupTabStops(_)}setupTabStops(_){this._normal.setupTabStops(_),this._alt.setupTabStops(_)}}o.BufferSet=f},511:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CellData=void 0;const c=a(482),u=a(643),h=a(3734);class f extends h.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new h.ExtendedAttrs,this.combinedData=""}static fromCharData(_){const y=new f;return y.setFromCharData(_),y}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,c.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(_){this.fg=_[u.CHAR_DATA_ATTR_INDEX],this.bg=0;let y=!1;if(_[u.CHAR_DATA_CHAR_INDEX].length>2)y=!0;else if(_[u.CHAR_DATA_CHAR_INDEX].length===2){const p=_[u.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=p&&p<=56319){const m=_[u.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=m&&m<=57343?this.content=1024*(p-55296)+m-56320+65536|_[u.CHAR_DATA_WIDTH_INDEX]<<22:y=!0}else y=!0}else this.content=_[u.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|_[u.CHAR_DATA_WIDTH_INDEX]<<22;y&&(this.combinedData=_[u.CHAR_DATA_CHAR_INDEX],this.content=2097152|_[u.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}o.CellData=f},643:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.WHITESPACE_CELL_CODE=o.WHITESPACE_CELL_WIDTH=o.WHITESPACE_CELL_CHAR=o.NULL_CELL_CODE=o.NULL_CELL_WIDTH=o.NULL_CELL_CHAR=o.CHAR_DATA_CODE_INDEX=o.CHAR_DATA_WIDTH_INDEX=o.CHAR_DATA_CHAR_INDEX=o.CHAR_DATA_ATTR_INDEX=o.DEFAULT_EXT=o.DEFAULT_ATTR=o.DEFAULT_COLOR=void 0,o.DEFAULT_COLOR=0,o.DEFAULT_ATTR=256|o.DEFAULT_COLOR<<9,o.DEFAULT_EXT=0,o.CHAR_DATA_ATTR_INDEX=0,o.CHAR_DATA_CHAR_INDEX=1,o.CHAR_DATA_WIDTH_INDEX=2,o.CHAR_DATA_CODE_INDEX=3,o.NULL_CELL_CHAR="",o.NULL_CELL_WIDTH=1,o.NULL_CELL_CODE=0,o.WHITESPACE_CELL_CHAR=" ",o.WHITESPACE_CELL_WIDTH=1,o.WHITESPACE_CELL_CODE=32},4863:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Marker=void 0;const c=a(8460),u=a(844);class h{get id(){return this._id}constructor(d){this.line=d,this.isDisposed=!1,this._disposables=[],this._id=h._nextId++,this._onDispose=this.register(new c.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,u.disposeArray)(this._disposables),this._disposables.length=0)}register(d){return this._disposables.push(d),d}}o.Marker=h,h._nextId=1},7116:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DEFAULT_CHARSET=o.CHARSETS=void 0,o.CHARSETS={},o.DEFAULT_CHARSET=o.CHARSETS.B,o.CHARSETS[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""},o.CHARSETS.A={"#":""},o.CHARSETS.B=void 0,o.CHARSETS[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""},o.CHARSETS.C=o.CHARSETS[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},o.CHARSETS.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},o.CHARSETS.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},o.CHARSETS.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},o.CHARSETS.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""},o.CHARSETS.E=o.CHARSETS[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},o.CHARSETS.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""},o.CHARSETS.H=o.CHARSETS[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},o.CHARSETS["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""}},2584:(l,o)=>{var a,c,u;Object.defineProperty(o,"__esModule",{value:!0}),o.C1_ESCAPED=o.C1=o.C0=void 0,(function(h){h.NUL="\0",h.SOH="",h.STX="",h.ETX="",h.EOT="",h.ENQ="",h.ACK="",h.BEL="\x07",h.BS="\b",h.HT="	",h.LF=`
`,h.VT="\v",h.FF="\f",h.CR="\r",h.SO="",h.SI="",h.DLE="",h.DC1="",h.DC2="",h.DC3="",h.DC4="",h.NAK="",h.SYN="",h.ETB="",h.CAN="",h.EM="",h.SUB="",h.ESC="\x1B",h.FS="",h.GS="",h.RS="",h.US="",h.SP=" ",h.DEL=""})(a||(o.C0=a={})),(function(h){h.PAD="",h.HOP="",h.BPH="",h.NBH="",h.IND="",h.NEL="",h.SSA="",h.ESA="",h.HTS="",h.HTJ="",h.VTS="",h.PLD="",h.PLU="",h.RI="",h.SS2="",h.SS3="",h.DCS="",h.PU1="",h.PU2="",h.STS="",h.CCH="",h.MW="",h.SPA="",h.EPA="",h.SOS="",h.SGCI="",h.SCI="",h.CSI="",h.ST="",h.OSC="",h.PM="",h.APC=""})(c||(o.C1=c={})),(function(h){h.ST=`${a.ESC}\\`})(u||(o.C1_ESCAPED=u={}))},7399:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.evaluateKeyboardEvent=void 0;const c=a(2584),u={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};o.evaluateKeyboardEvent=function(h,f,d,_){const y={type:0,cancel:!1,key:void 0},p=(h.shiftKey?1:0)|(h.altKey?2:0)|(h.ctrlKey?4:0)|(h.metaKey?8:0);switch(h.keyCode){case 0:h.key==="UIKeyInputUpArrow"?y.key=f?c.C0.ESC+"OA":c.C0.ESC+"[A":h.key==="UIKeyInputLeftArrow"?y.key=f?c.C0.ESC+"OD":c.C0.ESC+"[D":h.key==="UIKeyInputRightArrow"?y.key=f?c.C0.ESC+"OC":c.C0.ESC+"[C":h.key==="UIKeyInputDownArrow"&&(y.key=f?c.C0.ESC+"OB":c.C0.ESC+"[B");break;case 8:y.key=h.ctrlKey?"\b":c.C0.DEL,h.altKey&&(y.key=c.C0.ESC+y.key);break;case 9:if(h.shiftKey){y.key=c.C0.ESC+"[Z";break}y.key=c.C0.HT,y.cancel=!0;break;case 13:y.key=h.altKey?c.C0.ESC+c.C0.CR:c.C0.CR,y.cancel=!0;break;case 27:y.key=c.C0.ESC,h.altKey&&(y.key=c.C0.ESC+c.C0.ESC),y.cancel=!0;break;case 37:if(h.metaKey)break;p?(y.key=c.C0.ESC+"[1;"+(p+1)+"D",y.key===c.C0.ESC+"[1;3D"&&(y.key=c.C0.ESC+(d?"b":"[1;5D"))):y.key=f?c.C0.ESC+"OD":c.C0.ESC+"[D";break;case 39:if(h.metaKey)break;p?(y.key=c.C0.ESC+"[1;"+(p+1)+"C",y.key===c.C0.ESC+"[1;3C"&&(y.key=c.C0.ESC+(d?"f":"[1;5C"))):y.key=f?c.C0.ESC+"OC":c.C0.ESC+"[C";break;case 38:if(h.metaKey)break;p?(y.key=c.C0.ESC+"[1;"+(p+1)+"A",d||y.key!==c.C0.ESC+"[1;3A"||(y.key=c.C0.ESC+"[1;5A")):y.key=f?c.C0.ESC+"OA":c.C0.ESC+"[A";break;case 40:if(h.metaKey)break;p?(y.key=c.C0.ESC+"[1;"+(p+1)+"B",d||y.key!==c.C0.ESC+"[1;3B"||(y.key=c.C0.ESC+"[1;5B")):y.key=f?c.C0.ESC+"OB":c.C0.ESC+"[B";break;case 45:h.shiftKey||h.ctrlKey||(y.key=c.C0.ESC+"[2~");break;case 46:y.key=p?c.C0.ESC+"[3;"+(p+1)+"~":c.C0.ESC+"[3~";break;case 36:y.key=p?c.C0.ESC+"[1;"+(p+1)+"H":f?c.C0.ESC+"OH":c.C0.ESC+"[H";break;case 35:y.key=p?c.C0.ESC+"[1;"+(p+1)+"F":f?c.C0.ESC+"OF":c.C0.ESC+"[F";break;case 33:h.shiftKey?y.type=2:h.ctrlKey?y.key=c.C0.ESC+"[5;"+(p+1)+"~":y.key=c.C0.ESC+"[5~";break;case 34:h.shiftKey?y.type=3:h.ctrlKey?y.key=c.C0.ESC+"[6;"+(p+1)+"~":y.key=c.C0.ESC+"[6~";break;case 112:y.key=p?c.C0.ESC+"[1;"+(p+1)+"P":c.C0.ESC+"OP";break;case 113:y.key=p?c.C0.ESC+"[1;"+(p+1)+"Q":c.C0.ESC+"OQ";break;case 114:y.key=p?c.C0.ESC+"[1;"+(p+1)+"R":c.C0.ESC+"OR";break;case 115:y.key=p?c.C0.ESC+"[1;"+(p+1)+"S":c.C0.ESC+"OS";break;case 116:y.key=p?c.C0.ESC+"[15;"+(p+1)+"~":c.C0.ESC+"[15~";break;case 117:y.key=p?c.C0.ESC+"[17;"+(p+1)+"~":c.C0.ESC+"[17~";break;case 118:y.key=p?c.C0.ESC+"[18;"+(p+1)+"~":c.C0.ESC+"[18~";break;case 119:y.key=p?c.C0.ESC+"[19;"+(p+1)+"~":c.C0.ESC+"[19~";break;case 120:y.key=p?c.C0.ESC+"[20;"+(p+1)+"~":c.C0.ESC+"[20~";break;case 121:y.key=p?c.C0.ESC+"[21;"+(p+1)+"~":c.C0.ESC+"[21~";break;case 122:y.key=p?c.C0.ESC+"[23;"+(p+1)+"~":c.C0.ESC+"[23~";break;case 123:y.key=p?c.C0.ESC+"[24;"+(p+1)+"~":c.C0.ESC+"[24~";break;default:if(!h.ctrlKey||h.shiftKey||h.altKey||h.metaKey)if(d&&!_||!h.altKey||h.metaKey)!d||h.altKey||h.ctrlKey||h.shiftKey||!h.metaKey?h.key&&!h.ctrlKey&&!h.altKey&&!h.metaKey&&h.keyCode>=48&&h.key.length===1?y.key=h.key:h.key&&h.ctrlKey&&(h.key==="_"&&(y.key=c.C0.US),h.key==="@"&&(y.key=c.C0.NUL)):h.keyCode===65&&(y.type=1);else{const m=u[h.keyCode],g=m==null?void 0:m[h.shiftKey?1:0];if(g)y.key=c.C0.ESC+g;else if(h.keyCode>=65&&h.keyCode<=90){const v=h.ctrlKey?h.keyCode-64:h.keyCode+32;let b=String.fromCharCode(v);h.shiftKey&&(b=b.toUpperCase()),y.key=c.C0.ESC+b}else if(h.keyCode===32)y.key=c.C0.ESC+(h.ctrlKey?c.C0.NUL:" ");else if(h.key==="Dead"&&h.code.startsWith("Key")){let v=h.code.slice(3,4);h.shiftKey||(v=v.toLowerCase()),y.key=c.C0.ESC+v,y.cancel=!0}}else h.keyCode>=65&&h.keyCode<=90?y.key=String.fromCharCode(h.keyCode-64):h.keyCode===32?y.key=c.C0.NUL:h.keyCode>=51&&h.keyCode<=55?y.key=String.fromCharCode(h.keyCode-51+27):h.keyCode===56?y.key=c.C0.DEL:h.keyCode===219?y.key=c.C0.ESC:h.keyCode===220?y.key=c.C0.FS:h.keyCode===221&&(y.key=c.C0.GS)}return y}},482:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Utf8ToUtf32=o.StringToUtf32=o.utf32ToString=o.stringFromCodePoint=void 0,o.stringFromCodePoint=function(a){return a>65535?(a-=65536,String.fromCharCode(55296+(a>>10))+String.fromCharCode(a%1024+56320)):String.fromCharCode(a)},o.utf32ToString=function(a,c=0,u=a.length){let h="";for(let f=c;f<u;++f){let d=a[f];d>65535?(d-=65536,h+=String.fromCharCode(55296+(d>>10))+String.fromCharCode(d%1024+56320)):h+=String.fromCharCode(d)}return h},o.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(a,c){const u=a.length;if(!u)return 0;let h=0,f=0;if(this._interim){const d=a.charCodeAt(f++);56320<=d&&d<=57343?c[h++]=1024*(this._interim-55296)+d-56320+65536:(c[h++]=this._interim,c[h++]=d),this._interim=0}for(let d=f;d<u;++d){const _=a.charCodeAt(d);if(55296<=_&&_<=56319){if(++d>=u)return this._interim=_,h;const y=a.charCodeAt(d);56320<=y&&y<=57343?c[h++]=1024*(_-55296)+y-56320+65536:(c[h++]=_,c[h++]=y)}else _!==65279&&(c[h++]=_)}return h}},o.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(a,c){const u=a.length;if(!u)return 0;let h,f,d,_,y=0,p=0,m=0;if(this.interim[0]){let b=!1,S=this.interim[0];S&=(224&S)==192?31:(240&S)==224?15:7;let x,k=0;for(;(x=63&this.interim[++k])&&k<4;)S<<=6,S|=x;const w=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,E=w-k;for(;m<E;){if(m>=u)return 0;if(x=a[m++],(192&x)!=128){m--,b=!0;break}this.interim[k++]=x,S<<=6,S|=63&x}b||(w===2?S<128?m--:c[y++]=S:w===3?S<2048||S>=55296&&S<=57343||S===65279||(c[y++]=S):S<65536||S>1114111||(c[y++]=S)),this.interim.fill(0)}const g=u-4;let v=m;for(;v<u;){for(;!(!(v<g)||128&(h=a[v])||128&(f=a[v+1])||128&(d=a[v+2])||128&(_=a[v+3]));)c[y++]=h,c[y++]=f,c[y++]=d,c[y++]=_,v+=4;if(h=a[v++],h<128)c[y++]=h;else if((224&h)==192){if(v>=u)return this.interim[0]=h,y;if(f=a[v++],(192&f)!=128){v--;continue}if(p=(31&h)<<6|63&f,p<128){v--;continue}c[y++]=p}else if((240&h)==224){if(v>=u)return this.interim[0]=h,y;if(f=a[v++],(192&f)!=128){v--;continue}if(v>=u)return this.interim[0]=h,this.interim[1]=f,y;if(d=a[v++],(192&d)!=128){v--;continue}if(p=(15&h)<<12|(63&f)<<6|63&d,p<2048||p>=55296&&p<=57343||p===65279)continue;c[y++]=p}else if((248&h)==240){if(v>=u)return this.interim[0]=h,y;if(f=a[v++],(192&f)!=128){v--;continue}if(v>=u)return this.interim[0]=h,this.interim[1]=f,y;if(d=a[v++],(192&d)!=128){v--;continue}if(v>=u)return this.interim[0]=h,this.interim[1]=f,this.interim[2]=d,y;if(_=a[v++],(192&_)!=128){v--;continue}if(p=(7&h)<<18|(63&f)<<12|(63&d)<<6|63&_,p<65536||p>1114111)continue;c[y++]=p}}return y}}},225:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.UnicodeV6=void 0;const c=a(1480),u=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],h=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let f;o.UnicodeV6=class{constructor(){if(this.version="6",!f){f=new Uint8Array(65536),f.fill(1),f[0]=0,f.fill(0,1,32),f.fill(0,127,160),f.fill(2,4352,4448),f[9001]=2,f[9002]=2,f.fill(2,11904,42192),f[12351]=1,f.fill(2,44032,55204),f.fill(2,63744,64256),f.fill(2,65040,65050),f.fill(2,65072,65136),f.fill(2,65280,65377),f.fill(2,65504,65511);for(let d=0;d<u.length;++d)f.fill(0,u[d][0],u[d][1]+1)}}wcwidth(d){return d<32?0:d<127?1:d<65536?f[d]:(function(_,y){let p,m=0,g=y.length-1;if(_<y[0][0]||_>y[g][1])return!1;for(;g>=m;)if(p=m+g>>1,_>y[p][1])m=p+1;else{if(!(_<y[p][0]))return!0;g=p-1}return!1})(d,h)?0:d>=131072&&d<=196605||d>=196608&&d<=262141?2:1}charProperties(d,_){let y=this.wcwidth(d),p=y===0&&_!==0;if(p){const m=c.UnicodeService.extractWidth(_);m===0?p=!1:m>y&&(y=m)}return c.UnicodeService.createPropertyValue(0,y,p)}}},5981:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.WriteBuffer=void 0;const c=a(8460),u=a(844);class h extends u.Disposable{constructor(d){super(),this._action=d,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new c.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(d,_){if(_!==void 0&&this._syncCalls>_)return void(this._syncCalls=0);if(this._pendingData+=d.length,this._writeBuffer.push(d),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let y;for(this._isSyncWriting=!0;y=this._writeBuffer.shift();){this._action(y);const p=this._callbacks.shift();p&&p()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(d,_){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=d.length,this._writeBuffer.push(d),this._callbacks.push(_),void this._innerWrite();setTimeout((()=>this._innerWrite()))}this._pendingData+=d.length,this._writeBuffer.push(d),this._callbacks.push(_)}_innerWrite(d=0,_=!0){const y=d||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const p=this._writeBuffer[this._bufferOffset],m=this._action(p,_);if(m){const v=b=>Date.now()-y>=12?setTimeout((()=>this._innerWrite(0,b))):this._innerWrite(y,b);return void m.catch((b=>(queueMicrotask((()=>{throw b})),Promise.resolve(!1)))).then(v)}const g=this._callbacks[this._bufferOffset];if(g&&g(),this._bufferOffset++,this._pendingData-=p.length,Date.now()-y>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout((()=>this._innerWrite()))):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}o.WriteBuffer=h},5941:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.toRgbString=o.parseColor=void 0;const a=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,c=/^[\da-f]+$/;function u(h,f){const d=h.toString(16),_=d.length<2?"0"+d:d;switch(f){case 4:return d[0];case 8:return _;case 12:return(_+_).slice(0,3);default:return _+_}}o.parseColor=function(h){if(!h)return;let f=h.toLowerCase();if(f.indexOf("rgb:")===0){f=f.slice(4);const d=a.exec(f);if(d){const _=d[1]?15:d[4]?255:d[7]?4095:65535;return[Math.round(parseInt(d[1]||d[4]||d[7]||d[10],16)/_*255),Math.round(parseInt(d[2]||d[5]||d[8]||d[11],16)/_*255),Math.round(parseInt(d[3]||d[6]||d[9]||d[12],16)/_*255)]}}else if(f.indexOf("#")===0&&(f=f.slice(1),c.exec(f)&&[3,6,9,12].includes(f.length))){const d=f.length/3,_=[0,0,0];for(let y=0;y<3;++y){const p=parseInt(f.slice(d*y,d*y+d),16);_[y]=d===1?p<<4:d===2?p:d===3?p>>4:p>>8}return _}},o.toRgbString=function(h,f=16){const[d,_,y]=h;return`rgb:${u(d,f)}/${u(_,f)}/${u(y,f)}`}},5770:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PAYLOAD_LIMIT=void 0,o.PAYLOAD_LIMIT=1e7},6351:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DcsHandler=o.DcsParser=void 0;const c=a(482),u=a(8742),h=a(5770),f=[];o.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=f,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=f}registerHandler(_,y){this._handlers[_]===void 0&&(this._handlers[_]=[]);const p=this._handlers[_];return p.push(y),{dispose:()=>{const m=p.indexOf(y);m!==-1&&p.splice(m,1)}}}clearHandler(_){this._handlers[_]&&delete this._handlers[_]}setHandlerFallback(_){this._handlerFb=_}reset(){if(this._active.length)for(let _=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;_>=0;--_)this._active[_].unhook(!1);this._stack.paused=!1,this._active=f,this._ident=0}hook(_,y){if(this.reset(),this._ident=_,this._active=this._handlers[_]||f,this._active.length)for(let p=this._active.length-1;p>=0;p--)this._active[p].hook(y);else this._handlerFb(this._ident,"HOOK",y)}put(_,y,p){if(this._active.length)for(let m=this._active.length-1;m>=0;m--)this._active[m].put(_,y,p);else this._handlerFb(this._ident,"PUT",(0,c.utf32ToString)(_,y,p))}unhook(_,y=!0){if(this._active.length){let p=!1,m=this._active.length-1,g=!1;if(this._stack.paused&&(m=this._stack.loopPosition-1,p=y,g=this._stack.fallThrough,this._stack.paused=!1),!g&&p===!1){for(;m>=0&&(p=this._active[m].unhook(_),p!==!0);m--)if(p instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=m,this._stack.fallThrough=!1,p;m--}for(;m>=0;m--)if(p=this._active[m].unhook(!1),p instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=m,this._stack.fallThrough=!0,p}else this._handlerFb(this._ident,"UNHOOK",_);this._active=f,this._ident=0}};const d=new u.Params;d.addParam(0),o.DcsHandler=class{constructor(_){this._handler=_,this._data="",this._params=d,this._hitLimit=!1}hook(_){this._params=_.length>1||_.params[0]?_.clone():d,this._data="",this._hitLimit=!1}put(_,y,p){this._hitLimit||(this._data+=(0,c.utf32ToString)(_,y,p),this._data.length>h.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(_){let y=!1;if(this._hitLimit)y=!1;else if(_&&(y=this._handler(this._data,this._params),y instanceof Promise))return y.then((p=>(this._params=d,this._data="",this._hitLimit=!1,p)));return this._params=d,this._data="",this._hitLimit=!1,y}}},2015:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.EscapeSequenceParser=o.VT500_TRANSITION_TABLE=o.TransitionTable=void 0;const c=a(844),u=a(8742),h=a(6242),f=a(6351);class d{constructor(m){this.table=new Uint8Array(m)}setDefault(m,g){this.table.fill(m<<4|g)}add(m,g,v,b){this.table[g<<8|m]=v<<4|b}addMany(m,g,v,b){for(let S=0;S<m.length;S++)this.table[g<<8|m[S]]=v<<4|b}}o.TransitionTable=d;const _=160;o.VT500_TRANSITION_TABLE=(function(){const p=new d(4095),m=Array.apply(null,Array(256)).map(((k,w)=>w)),g=(k,w)=>m.slice(k,w),v=g(32,127),b=g(0,24);b.push(25),b.push.apply(b,g(28,32));const S=g(0,14);let x;for(x in p.setDefault(1,0),p.addMany(v,0,2,0),S)p.addMany([24,26,153,154],x,3,0),p.addMany(g(128,144),x,3,0),p.addMany(g(144,152),x,3,0),p.add(156,x,0,0),p.add(27,x,11,1),p.add(157,x,4,8),p.addMany([152,158,159],x,0,7),p.add(155,x,11,3),p.add(144,x,11,9);return p.addMany(b,0,3,0),p.addMany(b,1,3,1),p.add(127,1,0,1),p.addMany(b,8,0,8),p.addMany(b,3,3,3),p.add(127,3,0,3),p.addMany(b,4,3,4),p.add(127,4,0,4),p.addMany(b,6,3,6),p.addMany(b,5,3,5),p.add(127,5,0,5),p.addMany(b,2,3,2),p.add(127,2,0,2),p.add(93,1,4,8),p.addMany(v,8,5,8),p.add(127,8,5,8),p.addMany([156,27,24,26,7],8,6,0),p.addMany(g(28,32),8,0,8),p.addMany([88,94,95],1,0,7),p.addMany(v,7,0,7),p.addMany(b,7,0,7),p.add(156,7,0,0),p.add(127,7,0,7),p.add(91,1,11,3),p.addMany(g(64,127),3,7,0),p.addMany(g(48,60),3,8,4),p.addMany([60,61,62,63],3,9,4),p.addMany(g(48,60),4,8,4),p.addMany(g(64,127),4,7,0),p.addMany([60,61,62,63],4,0,6),p.addMany(g(32,64),6,0,6),p.add(127,6,0,6),p.addMany(g(64,127),6,0,0),p.addMany(g(32,48),3,9,5),p.addMany(g(32,48),5,9,5),p.addMany(g(48,64),5,0,6),p.addMany(g(64,127),5,7,0),p.addMany(g(32,48),4,9,5),p.addMany(g(32,48),1,9,2),p.addMany(g(32,48),2,9,2),p.addMany(g(48,127),2,10,0),p.addMany(g(48,80),1,10,0),p.addMany(g(81,88),1,10,0),p.addMany([89,90,92],1,10,0),p.addMany(g(96,127),1,10,0),p.add(80,1,11,9),p.addMany(b,9,0,9),p.add(127,9,0,9),p.addMany(g(28,32),9,0,9),p.addMany(g(32,48),9,9,12),p.addMany(g(48,60),9,8,10),p.addMany([60,61,62,63],9,9,10),p.addMany(b,11,0,11),p.addMany(g(32,128),11,0,11),p.addMany(g(28,32),11,0,11),p.addMany(b,10,0,10),p.add(127,10,0,10),p.addMany(g(28,32),10,0,10),p.addMany(g(48,60),10,8,10),p.addMany([60,61,62,63],10,0,11),p.addMany(g(32,48),10,9,12),p.addMany(b,12,0,12),p.add(127,12,0,12),p.addMany(g(28,32),12,0,12),p.addMany(g(32,48),12,9,12),p.addMany(g(48,64),12,0,11),p.addMany(g(64,127),12,12,13),p.addMany(g(64,127),10,12,13),p.addMany(g(64,127),9,12,13),p.addMany(b,13,13,13),p.addMany(v,13,13,13),p.add(127,13,0,13),p.addMany([27,156,24,26],13,14,0),p.add(_,0,2,0),p.add(_,8,5,8),p.add(_,6,0,6),p.add(_,11,0,11),p.add(_,13,13,13),p})();class y extends c.Disposable{constructor(m=o.VT500_TRANSITION_TABLE){super(),this._transitions=m,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new u.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(g,v,b)=>{},this._executeHandlerFb=g=>{},this._csiHandlerFb=(g,v)=>{},this._escHandlerFb=g=>{},this._errorHandlerFb=g=>g,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,c.toDisposable)((()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)}))),this._oscParser=this.register(new h.OscParser),this._dcsParser=this.register(new f.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},(()=>!0))}_identifier(m,g=[64,126]){let v=0;if(m.prefix){if(m.prefix.length>1)throw new Error("only one byte as prefix supported");if(v=m.prefix.charCodeAt(0),v&&60>v||v>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(m.intermediates){if(m.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let S=0;S<m.intermediates.length;++S){const x=m.intermediates.charCodeAt(S);if(32>x||x>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");v<<=8,v|=x}}if(m.final.length!==1)throw new Error("final must be a single byte");const b=m.final.charCodeAt(0);if(g[0]>b||b>g[1])throw new Error(`final must be in range ${g[0]} .. ${g[1]}`);return v<<=8,v|=b,v}identToString(m){const g=[];for(;m;)g.push(String.fromCharCode(255&m)),m>>=8;return g.reverse().join("")}setPrintHandler(m){this._printHandler=m}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(m,g){const v=this._identifier(m,[48,126]);this._escHandlers[v]===void 0&&(this._escHandlers[v]=[]);const b=this._escHandlers[v];return b.push(g),{dispose:()=>{const S=b.indexOf(g);S!==-1&&b.splice(S,1)}}}clearEscHandler(m){this._escHandlers[this._identifier(m,[48,126])]&&delete this._escHandlers[this._identifier(m,[48,126])]}setEscHandlerFallback(m){this._escHandlerFb=m}setExecuteHandler(m,g){this._executeHandlers[m.charCodeAt(0)]=g}clearExecuteHandler(m){this._executeHandlers[m.charCodeAt(0)]&&delete this._executeHandlers[m.charCodeAt(0)]}setExecuteHandlerFallback(m){this._executeHandlerFb=m}registerCsiHandler(m,g){const v=this._identifier(m);this._csiHandlers[v]===void 0&&(this._csiHandlers[v]=[]);const b=this._csiHandlers[v];return b.push(g),{dispose:()=>{const S=b.indexOf(g);S!==-1&&b.splice(S,1)}}}clearCsiHandler(m){this._csiHandlers[this._identifier(m)]&&delete this._csiHandlers[this._identifier(m)]}setCsiHandlerFallback(m){this._csiHandlerFb=m}registerDcsHandler(m,g){return this._dcsParser.registerHandler(this._identifier(m),g)}clearDcsHandler(m){this._dcsParser.clearHandler(this._identifier(m))}setDcsHandlerFallback(m){this._dcsParser.setHandlerFallback(m)}registerOscHandler(m,g){return this._oscParser.registerHandler(m,g)}clearOscHandler(m){this._oscParser.clearHandler(m)}setOscHandlerFallback(m){this._oscParser.setHandlerFallback(m)}setErrorHandler(m){this._errorHandler=m}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(m,g,v,b,S){this._parseStack.state=m,this._parseStack.handlers=g,this._parseStack.handlerPos=v,this._parseStack.transition=b,this._parseStack.chunkPos=S}parse(m,g,v){let b,S=0,x=0,k=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,k=this._parseStack.chunkPos+1;else{if(v===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const w=this._parseStack.handlers;let E=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(v===!1&&E>-1){for(;E>=0&&(b=w[E](this._params),b!==!0);E--)if(b instanceof Promise)return this._parseStack.handlerPos=E,b}this._parseStack.handlers=[];break;case 4:if(v===!1&&E>-1){for(;E>=0&&(b=w[E](),b!==!0);E--)if(b instanceof Promise)return this._parseStack.handlerPos=E,b}this._parseStack.handlers=[];break;case 6:if(S=m[this._parseStack.chunkPos],b=this._dcsParser.unhook(S!==24&&S!==26,v),b)return b;S===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(S=m[this._parseStack.chunkPos],b=this._oscParser.end(S!==24&&S!==26,v),b)return b;S===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,k=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let w=k;w<g;++w){switch(S=m[w],x=this._transitions.table[this.currentState<<8|(S<160?S:_)],x>>4){case 2:for(let O=w+1;;++O){if(O>=g||(S=m[O])<32||S>126&&S<_){this._printHandler(m,w,O),w=O-1;break}if(++O>=g||(S=m[O])<32||S>126&&S<_){this._printHandler(m,w,O),w=O-1;break}if(++O>=g||(S=m[O])<32||S>126&&S<_){this._printHandler(m,w,O),w=O-1;break}if(++O>=g||(S=m[O])<32||S>126&&S<_){this._printHandler(m,w,O),w=O-1;break}}break;case 3:this._executeHandlers[S]?this._executeHandlers[S]():this._executeHandlerFb(S),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:w,code:S,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const E=this._csiHandlers[this._collect<<8|S];let A=E?E.length-1:-1;for(;A>=0&&(b=E[A](this._params),b!==!0);A--)if(b instanceof Promise)return this._preserveStack(3,E,A,x,w),b;A<0&&this._csiHandlerFb(this._collect<<8|S,this._params),this.precedingJoinState=0;break;case 8:do switch(S){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(S-48)}while(++w<g&&(S=m[w])>47&&S<60);w--;break;case 9:this._collect<<=8,this._collect|=S;break;case 10:const T=this._escHandlers[this._collect<<8|S];let B=T?T.length-1:-1;for(;B>=0&&(b=T[B](),b!==!0);B--)if(b instanceof Promise)return this._preserveStack(4,T,B,x,w),b;B<0&&this._escHandlerFb(this._collect<<8|S),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|S,this._params);break;case 13:for(let O=w+1;;++O)if(O>=g||(S=m[O])===24||S===26||S===27||S>127&&S<_){this._dcsParser.put(m,w,O),w=O-1;break}break;case 14:if(b=this._dcsParser.unhook(S!==24&&S!==26),b)return this._preserveStack(6,[],0,x,w),b;S===27&&(x|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let O=w+1;;O++)if(O>=g||(S=m[O])<32||S>127&&S<_){this._oscParser.put(m,w,O),w=O-1;break}break;case 6:if(b=this._oscParser.end(S!==24&&S!==26),b)return this._preserveStack(5,[],0,x,w),b;S===27&&(x|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&x}}}o.EscapeSequenceParser=y},6242:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.OscHandler=o.OscParser=void 0;const c=a(5770),u=a(482),h=[];o.OscParser=class{constructor(){this._state=0,this._active=h,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(f,d){this._handlers[f]===void 0&&(this._handlers[f]=[]);const _=this._handlers[f];return _.push(d),{dispose:()=>{const y=_.indexOf(d);y!==-1&&_.splice(y,1)}}}clearHandler(f){this._handlers[f]&&delete this._handlers[f]}setHandlerFallback(f){this._handlerFb=f}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=h}reset(){if(this._state===2)for(let f=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;f>=0;--f)this._active[f].end(!1);this._stack.paused=!1,this._active=h,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||h,this._active.length)for(let f=this._active.length-1;f>=0;f--)this._active[f].start();else this._handlerFb(this._id,"START")}_put(f,d,_){if(this._active.length)for(let y=this._active.length-1;y>=0;y--)this._active[y].put(f,d,_);else this._handlerFb(this._id,"PUT",(0,u.utf32ToString)(f,d,_))}start(){this.reset(),this._state=1}put(f,d,_){if(this._state!==3){if(this._state===1)for(;d<_;){const y=f[d++];if(y===59){this._state=2,this._start();break}if(y<48||57<y)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+y-48}this._state===2&&_-d>0&&this._put(f,d,_)}}end(f,d=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let _=!1,y=this._active.length-1,p=!1;if(this._stack.paused&&(y=this._stack.loopPosition-1,_=d,p=this._stack.fallThrough,this._stack.paused=!1),!p&&_===!1){for(;y>=0&&(_=this._active[y].end(f),_!==!0);y--)if(_ instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=y,this._stack.fallThrough=!1,_;y--}for(;y>=0;y--)if(_=this._active[y].end(!1),_ instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=y,this._stack.fallThrough=!0,_}else this._handlerFb(this._id,"END",f);this._active=h,this._id=-1,this._state=0}}},o.OscHandler=class{constructor(f){this._handler=f,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(f,d,_){this._hitLimit||(this._data+=(0,u.utf32ToString)(f,d,_),this._data.length>c.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(f){let d=!1;if(this._hitLimit)d=!1;else if(f&&(d=this._handler(this._data),d instanceof Promise))return d.then((_=>(this._data="",this._hitLimit=!1,_)));return this._data="",this._hitLimit=!1,d}}},8742:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Params=void 0;const a=2147483647;class c{static fromArray(h){const f=new c;if(!h.length)return f;for(let d=Array.isArray(h[0])?1:0;d<h.length;++d){const _=h[d];if(Array.isArray(_))for(let y=0;y<_.length;++y)f.addSubParam(_[y]);else f.addParam(_)}return f}constructor(h=32,f=32){if(this.maxLength=h,this.maxSubParamsLength=f,f>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(h),this.length=0,this._subParams=new Int32Array(f),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(h),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const h=new c(this.maxLength,this.maxSubParamsLength);return h.params.set(this.params),h.length=this.length,h._subParams.set(this._subParams),h._subParamsLength=this._subParamsLength,h._subParamsIdx.set(this._subParamsIdx),h._rejectDigits=this._rejectDigits,h._rejectSubDigits=this._rejectSubDigits,h._digitIsSub=this._digitIsSub,h}toArray(){const h=[];for(let f=0;f<this.length;++f){h.push(this.params[f]);const d=this._subParamsIdx[f]>>8,_=255&this._subParamsIdx[f];_-d>0&&h.push(Array.prototype.slice.call(this._subParams,d,_))}return h}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(h){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(h<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=h>a?a:h}}addSubParam(h){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(h<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=h>a?a:h,this._subParamsIdx[this.length-1]++}}hasSubParams(h){return(255&this._subParamsIdx[h])-(this._subParamsIdx[h]>>8)>0}getSubParams(h){const f=this._subParamsIdx[h]>>8,d=255&this._subParamsIdx[h];return d-f>0?this._subParams.subarray(f,d):null}getSubParamsAll(){const h={};for(let f=0;f<this.length;++f){const d=this._subParamsIdx[f]>>8,_=255&this._subParamsIdx[f];_-d>0&&(h[f]=this._subParams.slice(d,_))}return h}addDigit(h){let f;if(this._rejectDigits||!(f=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const d=this._digitIsSub?this._subParams:this.params,_=d[f-1];d[f-1]=~_?Math.min(10*_+h,a):h}}o.Params=c},5741:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.AddonManager=void 0,o.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let a=this._addons.length-1;a>=0;a--)this._addons[a].instance.dispose()}loadAddon(a,c){const u={instance:c,dispose:c.dispose,isDisposed:!1};this._addons.push(u),c.dispose=()=>this._wrappedAddonDispose(u),c.activate(a)}_wrappedAddonDispose(a){if(a.isDisposed)return;let c=-1;for(let u=0;u<this._addons.length;u++)if(this._addons[u]===a){c=u;break}if(c===-1)throw new Error("Could not dispose an addon that has not been loaded");a.isDisposed=!0,a.dispose.apply(a.instance),this._addons.splice(c,1)}}},8771:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferApiView=void 0;const c=a(3785),u=a(511);o.BufferApiView=class{constructor(h,f){this._buffer=h,this.type=f}init(h){return this._buffer=h,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(h){const f=this._buffer.lines.get(h);if(f)return new c.BufferLineApiView(f)}getNullCell(){return new u.CellData}}},3785:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferLineApiView=void 0;const c=a(511);o.BufferLineApiView=class{constructor(u){this._line=u}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(u,h){if(!(u<0||u>=this._line.length))return h?(this._line.loadCell(u,h),h):this._line.loadCell(u,new c.CellData)}translateToString(u,h,f){return this._line.translateToString(u,h,f)}}},8285:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferNamespaceApi=void 0;const c=a(8771),u=a(8460),h=a(844);class f extends h.Disposable{constructor(_){super(),this._core=_,this._onBufferChange=this.register(new u.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new c.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new c.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate((()=>this._onBufferChange.fire(this.active)))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}o.BufferNamespaceApi=f},7975:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ParserApi=void 0,o.ParserApi=class{constructor(a){this._core=a}registerCsiHandler(a,c){return this._core.registerCsiHandler(a,(u=>c(u.toArray())))}addCsiHandler(a,c){return this.registerCsiHandler(a,c)}registerDcsHandler(a,c){return this._core.registerDcsHandler(a,((u,h)=>c(u,h.toArray())))}addDcsHandler(a,c){return this.registerDcsHandler(a,c)}registerEscHandler(a,c){return this._core.registerEscHandler(a,c)}addEscHandler(a,c){return this.registerEscHandler(a,c)}registerOscHandler(a,c){return this._core.registerOscHandler(a,c)}addOscHandler(a,c){return this.registerOscHandler(a,c)}}},7090:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.UnicodeApi=void 0,o.UnicodeApi=class{constructor(a){this._core=a}register(a){this._core.unicodeService.register(a)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(a){this._core.unicodeService.activeVersion=a}}},744:function(l,o,a){var c=this&&this.__decorate||function(p,m,g,v){var b,S=arguments.length,x=S<3?m:v===null?v=Object.getOwnPropertyDescriptor(m,g):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(p,m,g,v);else for(var k=p.length-1;k>=0;k--)(b=p[k])&&(x=(S<3?b(x):S>3?b(m,g,x):b(m,g))||x);return S>3&&x&&Object.defineProperty(m,g,x),x},u=this&&this.__param||function(p,m){return function(g,v){m(g,v,p)}};Object.defineProperty(o,"__esModule",{value:!0}),o.BufferService=o.MINIMUM_ROWS=o.MINIMUM_COLS=void 0;const h=a(8460),f=a(844),d=a(5295),_=a(2585);o.MINIMUM_COLS=2,o.MINIMUM_ROWS=1;let y=o.BufferService=class extends f.Disposable{get buffer(){return this.buffers.active}constructor(p){super(),this.isUserScrolling=!1,this._onResize=this.register(new h.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new h.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(p.rawOptions.cols||0,o.MINIMUM_COLS),this.rows=Math.max(p.rawOptions.rows||0,o.MINIMUM_ROWS),this.buffers=this.register(new d.BufferSet(p,this))}resize(p,m){this.cols=p,this.rows=m,this.buffers.resize(p,m),this._onResize.fire({cols:p,rows:m})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(p,m=!1){const g=this.buffer;let v;v=this._cachedBlankLine,v&&v.length===this.cols&&v.getFg(0)===p.fg&&v.getBg(0)===p.bg||(v=g.getBlankLine(p,m),this._cachedBlankLine=v),v.isWrapped=m;const b=g.ybase+g.scrollTop,S=g.ybase+g.scrollBottom;if(g.scrollTop===0){const x=g.lines.isFull;S===g.lines.length-1?x?g.lines.recycle().copyFrom(v):g.lines.push(v.clone()):g.lines.splice(S+1,0,v.clone()),x?this.isUserScrolling&&(g.ydisp=Math.max(g.ydisp-1,0)):(g.ybase++,this.isUserScrolling||g.ydisp++)}else{const x=S-b+1;g.lines.shiftElements(b+1,x-1,-1),g.lines.set(S,v.clone())}this.isUserScrolling||(g.ydisp=g.ybase),this._onScroll.fire(g.ydisp)}scrollLines(p,m,g){const v=this.buffer;if(p<0){if(v.ydisp===0)return;this.isUserScrolling=!0}else p+v.ydisp>=v.ybase&&(this.isUserScrolling=!1);const b=v.ydisp;v.ydisp=Math.max(Math.min(v.ydisp+p,v.ybase),0),b!==v.ydisp&&(m||this._onScroll.fire(v.ydisp))}};o.BufferService=y=c([u(0,_.IOptionsService)],y)},7994:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CharsetService=void 0,o.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(a){this.glevel=a,this.charset=this._charsets[a]}setgCharset(a,c){this._charsets[a]=c,this.glevel===a&&(this.charset=c)}}},1753:function(l,o,a){var c=this&&this.__decorate||function(v,b,S,x){var k,w=arguments.length,E=w<3?b:x===null?x=Object.getOwnPropertyDescriptor(b,S):x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(v,b,S,x);else for(var A=v.length-1;A>=0;A--)(k=v[A])&&(E=(w<3?k(E):w>3?k(b,S,E):k(b,S))||E);return w>3&&E&&Object.defineProperty(b,S,E),E},u=this&&this.__param||function(v,b){return function(S,x){b(S,x,v)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CoreMouseService=void 0;const h=a(2585),f=a(8460),d=a(844),_={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:v=>v.button!==4&&v.action===1&&(v.ctrl=!1,v.alt=!1,v.shift=!1,!0)},VT200:{events:19,restrict:v=>v.action!==32},DRAG:{events:23,restrict:v=>v.action!==32||v.button!==3},ANY:{events:31,restrict:v=>!0}};function y(v,b){let S=(v.ctrl?16:0)|(v.shift?4:0)|(v.alt?8:0);return v.button===4?(S|=64,S|=v.action):(S|=3&v.button,4&v.button&&(S|=64),8&v.button&&(S|=128),v.action===32?S|=32:v.action!==0||b||(S|=3)),S}const p=String.fromCharCode,m={DEFAULT:v=>{const b=[y(v,!1)+32,v.col+32,v.row+32];return b[0]>255||b[1]>255||b[2]>255?"":`\x1B[M${p(b[0])}${p(b[1])}${p(b[2])}`},SGR:v=>{const b=v.action===0&&v.button!==4?"m":"M";return`\x1B[<${y(v,!0)};${v.col};${v.row}${b}`},SGR_PIXELS:v=>{const b=v.action===0&&v.button!==4?"m":"M";return`\x1B[<${y(v,!0)};${v.x};${v.y}${b}`}};let g=o.CoreMouseService=class extends d.Disposable{constructor(v,b){super(),this._bufferService=v,this._coreService=b,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new f.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const S of Object.keys(_))this.addProtocol(S,_[S]);for(const S of Object.keys(m))this.addEncoding(S,m[S]);this.reset()}addProtocol(v,b){this._protocols[v]=b}addEncoding(v,b){this._encodings[v]=b}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(v){if(!this._protocols[v])throw new Error(`unknown protocol "${v}"`);this._activeProtocol=v,this._onProtocolChange.fire(this._protocols[v].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(v){if(!this._encodings[v])throw new Error(`unknown encoding "${v}"`);this._activeEncoding=v}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(v){if(v.col<0||v.col>=this._bufferService.cols||v.row<0||v.row>=this._bufferService.rows||v.button===4&&v.action===32||v.button===3&&v.action!==32||v.button!==4&&(v.action===2||v.action===3)||(v.col++,v.row++,v.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,v,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(v))return!1;const b=this._encodings[this._activeEncoding](v);return b&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(b):this._coreService.triggerDataEvent(b,!0)),this._lastEvent=v,!0}explainEvents(v){return{down:!!(1&v),up:!!(2&v),drag:!!(4&v),move:!!(8&v),wheel:!!(16&v)}}_equalEvents(v,b,S){if(S){if(v.x!==b.x||v.y!==b.y)return!1}else if(v.col!==b.col||v.row!==b.row)return!1;return v.button===b.button&&v.action===b.action&&v.ctrl===b.ctrl&&v.alt===b.alt&&v.shift===b.shift}};o.CoreMouseService=g=c([u(0,h.IBufferService),u(1,h.ICoreService)],g)},6975:function(l,o,a){var c=this&&this.__decorate||function(g,v,b,S){var x,k=arguments.length,w=k<3?v:S===null?S=Object.getOwnPropertyDescriptor(v,b):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(g,v,b,S);else for(var E=g.length-1;E>=0;E--)(x=g[E])&&(w=(k<3?x(w):k>3?x(v,b,w):x(v,b))||w);return k>3&&w&&Object.defineProperty(v,b,w),w},u=this&&this.__param||function(g,v){return function(b,S){v(b,S,g)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CoreService=void 0;const h=a(1439),f=a(8460),d=a(844),_=a(2585),y=Object.freeze({insertMode:!1}),p=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let m=o.CoreService=class extends d.Disposable{constructor(g,v,b){super(),this._bufferService=g,this._logService=v,this._optionsService=b,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new f.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new f.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new f.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new f.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,h.clone)(y),this.decPrivateModes=(0,h.clone)(p)}reset(){this.modes=(0,h.clone)(y),this.decPrivateModes=(0,h.clone)(p)}triggerDataEvent(g,v=!1){if(this._optionsService.rawOptions.disableStdin)return;const b=this._bufferService.buffer;v&&this._optionsService.rawOptions.scrollOnUserInput&&b.ybase!==b.ydisp&&this._onRequestScrollToBottom.fire(),v&&this._onUserInput.fire(),this._logService.debug(`sending data "${g}"`,(()=>g.split("").map((S=>S.charCodeAt(0))))),this._onData.fire(g)}triggerBinaryEvent(g){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${g}"`,(()=>g.split("").map((v=>v.charCodeAt(0))))),this._onBinary.fire(g))}};o.CoreService=m=c([u(0,_.IBufferService),u(1,_.ILogService),u(2,_.IOptionsService)],m)},9074:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DecorationService=void 0;const c=a(8055),u=a(8460),h=a(844),f=a(6106);let d=0,_=0;class y extends h.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new f.SortedList((g=>g==null?void 0:g.marker.line)),this._onDecorationRegistered=this.register(new u.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new u.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,h.toDisposable)((()=>this.reset())))}registerDecoration(g){if(g.marker.isDisposed)return;const v=new p(g);if(v){const b=v.marker.onDispose((()=>v.dispose()));v.onDispose((()=>{v&&(this._decorations.delete(v)&&this._onDecorationRemoved.fire(v),b.dispose())})),this._decorations.insert(v),this._onDecorationRegistered.fire(v)}return v}reset(){for(const g of this._decorations.values())g.dispose();this._decorations.clear()}*getDecorationsAtCell(g,v,b){let S=0,x=0;for(const k of this._decorations.getKeyIterator(v))S=k.options.x??0,x=S+(k.options.width??1),g>=S&&g<x&&(!b||(k.options.layer??"bottom")===b)&&(yield k)}forEachDecorationAtCell(g,v,b,S){this._decorations.forEachByKey(v,(x=>{d=x.options.x??0,_=d+(x.options.width??1),g>=d&&g<_&&(!b||(x.options.layer??"bottom")===b)&&S(x)}))}}o.DecorationService=y;class p extends h.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=c.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=c.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(g){super(),this.options=g,this.onRenderEmitter=this.register(new u.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new u.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=g.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.InstantiationService=o.ServiceCollection=void 0;const c=a(2585),u=a(8343);class h{constructor(...d){this._entries=new Map;for(const[_,y]of d)this.set(_,y)}set(d,_){const y=this._entries.get(d);return this._entries.set(d,_),y}forEach(d){for(const[_,y]of this._entries.entries())d(_,y)}has(d){return this._entries.has(d)}get(d){return this._entries.get(d)}}o.ServiceCollection=h,o.InstantiationService=class{constructor(){this._services=new h,this._services.set(c.IInstantiationService,this)}setService(f,d){this._services.set(f,d)}getService(f){return this._services.get(f)}createInstance(f,...d){const _=(0,u.getServiceDependencies)(f).sort(((m,g)=>m.index-g.index)),y=[];for(const m of _){const g=this._services.get(m.id);if(!g)throw new Error(`[createInstance] ${f.name} depends on UNKNOWN service ${m.id}.`);y.push(g)}const p=_.length>0?_[0].index:d.length;if(d.length!==p)throw new Error(`[createInstance] First service dependency of ${f.name} at position ${p+1} conflicts with ${d.length} static arguments`);return new f(...d,...y)}}},7866:function(l,o,a){var c=this&&this.__decorate||function(p,m,g,v){var b,S=arguments.length,x=S<3?m:v===null?v=Object.getOwnPropertyDescriptor(m,g):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(p,m,g,v);else for(var k=p.length-1;k>=0;k--)(b=p[k])&&(x=(S<3?b(x):S>3?b(m,g,x):b(m,g))||x);return S>3&&x&&Object.defineProperty(m,g,x),x},u=this&&this.__param||function(p,m){return function(g,v){m(g,v,p)}};Object.defineProperty(o,"__esModule",{value:!0}),o.traceCall=o.setTraceLogger=o.LogService=void 0;const h=a(844),f=a(2585),d={trace:f.LogLevelEnum.TRACE,debug:f.LogLevelEnum.DEBUG,info:f.LogLevelEnum.INFO,warn:f.LogLevelEnum.WARN,error:f.LogLevelEnum.ERROR,off:f.LogLevelEnum.OFF};let _,y=o.LogService=class extends h.Disposable{get logLevel(){return this._logLevel}constructor(p){super(),this._optionsService=p,this._logLevel=f.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",(()=>this._updateLogLevel()))),_=this}_updateLogLevel(){this._logLevel=d[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(p){for(let m=0;m<p.length;m++)typeof p[m]=="function"&&(p[m]=p[m]())}_log(p,m,g){this._evalLazyOptionalParams(g),p.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+m,...g)}trace(p,...m){var g;this._logLevel<=f.LogLevelEnum.TRACE&&this._log(((g=this._optionsService.options.logger)==null?void 0:g.trace.bind(this._optionsService.options.logger))??console.log,p,m)}debug(p,...m){var g;this._logLevel<=f.LogLevelEnum.DEBUG&&this._log(((g=this._optionsService.options.logger)==null?void 0:g.debug.bind(this._optionsService.options.logger))??console.log,p,m)}info(p,...m){var g;this._logLevel<=f.LogLevelEnum.INFO&&this._log(((g=this._optionsService.options.logger)==null?void 0:g.info.bind(this._optionsService.options.logger))??console.info,p,m)}warn(p,...m){var g;this._logLevel<=f.LogLevelEnum.WARN&&this._log(((g=this._optionsService.options.logger)==null?void 0:g.warn.bind(this._optionsService.options.logger))??console.warn,p,m)}error(p,...m){var g;this._logLevel<=f.LogLevelEnum.ERROR&&this._log(((g=this._optionsService.options.logger)==null?void 0:g.error.bind(this._optionsService.options.logger))??console.error,p,m)}};o.LogService=y=c([u(0,f.IOptionsService)],y),o.setTraceLogger=function(p){_=p},o.traceCall=function(p,m,g){if(typeof g.value!="function")throw new Error("not supported");const v=g.value;g.value=function(...b){if(_.logLevel!==f.LogLevelEnum.TRACE)return v.apply(this,b);_.trace(`GlyphRenderer#${v.name}(${b.map((x=>JSON.stringify(x))).join(", ")})`);const S=v.apply(this,b);return _.trace(`GlyphRenderer#${v.name} return`,S),S}}},7302:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.OptionsService=o.DEFAULT_OPTIONS=void 0;const c=a(8460),u=a(844),h=a(6114);o.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:h.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const f=["normal","bold","100","200","300","400","500","600","700","800","900"];class d extends u.Disposable{constructor(y){super(),this._onOptionChange=this.register(new c.EventEmitter),this.onOptionChange=this._onOptionChange.event;const p={...o.DEFAULT_OPTIONS};for(const m in y)if(m in p)try{const g=y[m];p[m]=this._sanitizeAndValidateOption(m,g)}catch(g){console.error(g)}this.rawOptions=p,this.options={...p},this._setupOptions(),this.register((0,u.toDisposable)((()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null})))}onSpecificOptionChange(y,p){return this.onOptionChange((m=>{m===y&&p(this.rawOptions[y])}))}onMultipleOptionChange(y,p){return this.onOptionChange((m=>{y.indexOf(m)!==-1&&p()}))}_setupOptions(){const y=m=>{if(!(m in o.DEFAULT_OPTIONS))throw new Error(`No option with key "${m}"`);return this.rawOptions[m]},p=(m,g)=>{if(!(m in o.DEFAULT_OPTIONS))throw new Error(`No option with key "${m}"`);g=this._sanitizeAndValidateOption(m,g),this.rawOptions[m]!==g&&(this.rawOptions[m]=g,this._onOptionChange.fire(m))};for(const m in this.rawOptions){const g={get:y.bind(this,m),set:p.bind(this,m)};Object.defineProperty(this.options,m,g)}}_sanitizeAndValidateOption(y,p){switch(y){case"cursorStyle":if(p||(p=o.DEFAULT_OPTIONS[y]),!(function(m){return m==="block"||m==="underline"||m==="bar"})(p))throw new Error(`"${p}" is not a valid value for ${y}`);break;case"wordSeparator":p||(p=o.DEFAULT_OPTIONS[y]);break;case"fontWeight":case"fontWeightBold":if(typeof p=="number"&&1<=p&&p<=1e3)break;p=f.includes(p)?p:o.DEFAULT_OPTIONS[y];break;case"cursorWidth":p=Math.floor(p);case"lineHeight":case"tabStopWidth":if(p<1)throw new Error(`${y} cannot be less than 1, value: ${p}`);break;case"minimumContrastRatio":p=Math.max(1,Math.min(21,Math.round(10*p)/10));break;case"scrollback":if((p=Math.min(p,4294967295))<0)throw new Error(`${y} cannot be less than 0, value: ${p}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(p<=0)throw new Error(`${y} cannot be less than or equal to 0, value: ${p}`);break;case"rows":case"cols":if(!p&&p!==0)throw new Error(`${y} must be numeric, value: ${p}`);break;case"windowsPty":p=p??{}}return p}}o.OptionsService=d},2660:function(l,o,a){var c=this&&this.__decorate||function(d,_,y,p){var m,g=arguments.length,v=g<3?_:p===null?p=Object.getOwnPropertyDescriptor(_,y):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(d,_,y,p);else for(var b=d.length-1;b>=0;b--)(m=d[b])&&(v=(g<3?m(v):g>3?m(_,y,v):m(_,y))||v);return g>3&&v&&Object.defineProperty(_,y,v),v},u=this&&this.__param||function(d,_){return function(y,p){_(y,p,d)}};Object.defineProperty(o,"__esModule",{value:!0}),o.OscLinkService=void 0;const h=a(2585);let f=o.OscLinkService=class{constructor(d){this._bufferService=d,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(d){const _=this._bufferService.buffer;if(d.id===void 0){const b=_.addMarker(_.ybase+_.y),S={data:d,id:this._nextId++,lines:[b]};return b.onDispose((()=>this._removeMarkerFromLink(S,b))),this._dataByLinkId.set(S.id,S),S.id}const y=d,p=this._getEntryIdKey(y),m=this._entriesWithId.get(p);if(m)return this.addLineToLink(m.id,_.ybase+_.y),m.id;const g=_.addMarker(_.ybase+_.y),v={id:this._nextId++,key:this._getEntryIdKey(y),data:y,lines:[g]};return g.onDispose((()=>this._removeMarkerFromLink(v,g))),this._entriesWithId.set(v.key,v),this._dataByLinkId.set(v.id,v),v.id}addLineToLink(d,_){const y=this._dataByLinkId.get(d);if(y&&y.lines.every((p=>p.line!==_))){const p=this._bufferService.buffer.addMarker(_);y.lines.push(p),p.onDispose((()=>this._removeMarkerFromLink(y,p)))}}getLinkData(d){var _;return(_=this._dataByLinkId.get(d))==null?void 0:_.data}_getEntryIdKey(d){return`${d.id};;${d.uri}`}_removeMarkerFromLink(d,_){const y=d.lines.indexOf(_);y!==-1&&(d.lines.splice(y,1),d.lines.length===0&&(d.data.id!==void 0&&this._entriesWithId.delete(d.key),this._dataByLinkId.delete(d.id)))}};o.OscLinkService=f=c([u(0,h.IBufferService)],f)},8343:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.createDecorator=o.getServiceDependencies=o.serviceRegistry=void 0;const a="di$target",c="di$dependencies";o.serviceRegistry=new Map,o.getServiceDependencies=function(u){return u[c]||[]},o.createDecorator=function(u){if(o.serviceRegistry.has(u))return o.serviceRegistry.get(u);const h=function(f,d,_){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(y,p,m){p[a]===p?p[c].push({id:y,index:m}):(p[c]=[{id:y,index:m}],p[a]=p)})(h,f,_)};return h.toString=()=>u,o.serviceRegistry.set(u,h),h}},2585:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.IDecorationService=o.IUnicodeService=o.IOscLinkService=o.IOptionsService=o.ILogService=o.LogLevelEnum=o.IInstantiationService=o.ICharsetService=o.ICoreService=o.ICoreMouseService=o.IBufferService=void 0;const c=a(8343);var u;o.IBufferService=(0,c.createDecorator)("BufferService"),o.ICoreMouseService=(0,c.createDecorator)("CoreMouseService"),o.ICoreService=(0,c.createDecorator)("CoreService"),o.ICharsetService=(0,c.createDecorator)("CharsetService"),o.IInstantiationService=(0,c.createDecorator)("InstantiationService"),(function(h){h[h.TRACE=0]="TRACE",h[h.DEBUG=1]="DEBUG",h[h.INFO=2]="INFO",h[h.WARN=3]="WARN",h[h.ERROR=4]="ERROR",h[h.OFF=5]="OFF"})(u||(o.LogLevelEnum=u={})),o.ILogService=(0,c.createDecorator)("LogService"),o.IOptionsService=(0,c.createDecorator)("OptionsService"),o.IOscLinkService=(0,c.createDecorator)("OscLinkService"),o.IUnicodeService=(0,c.createDecorator)("UnicodeService"),o.IDecorationService=(0,c.createDecorator)("DecorationService")},1480:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.UnicodeService=void 0;const c=a(8460),u=a(225);class h{static extractShouldJoin(d){return(1&d)!=0}static extractWidth(d){return d>>1&3}static extractCharKind(d){return d>>3}static createPropertyValue(d,_,y=!1){return(16777215&d)<<3|(3&_)<<1|(y?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new c.EventEmitter,this.onChange=this._onChange.event;const d=new u.UnicodeV6;this.register(d),this._active=d.version,this._activeProvider=d}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(d){if(!this._providers[d])throw new Error(`unknown Unicode version "${d}"`);this._active=d,this._activeProvider=this._providers[d],this._onChange.fire(d)}register(d){this._providers[d.version]=d}wcwidth(d){return this._activeProvider.wcwidth(d)}getStringCellWidth(d){let _=0,y=0;const p=d.length;for(let m=0;m<p;++m){let g=d.charCodeAt(m);if(55296<=g&&g<=56319){if(++m>=p)return _+this.wcwidth(g);const S=d.charCodeAt(m);56320<=S&&S<=57343?g=1024*(g-55296)+S-56320+65536:_+=this.wcwidth(S)}const v=this.charProperties(g,y);let b=h.extractWidth(v);h.extractShouldJoin(v)&&(b-=h.extractWidth(y)),_+=b,y=v}return _}charProperties(d,_){return this._activeProvider.charProperties(d,_)}}o.UnicodeService=h}},r={};function n(l){var o=r[l];if(o!==void 0)return o.exports;var a=r[l]={exports:{}};return t[l].call(a.exports,a,a.exports,n),a.exports}var s={};return(()=>{var l=s;Object.defineProperty(l,"__esModule",{value:!0}),l.Terminal=void 0;const o=n(9042),a=n(3236),c=n(844),u=n(5741),h=n(8285),f=n(7975),d=n(7090),_=["cols","rows"];class y extends c.Disposable{constructor(m){super(),this._core=this.register(new a.Terminal(m)),this._addonManager=this.register(new u.AddonManager),this._publicOptions={...this._core.options};const g=b=>this._core.options[b],v=(b,S)=>{this._checkReadonlyOptions(b),this._core.options[b]=S};for(const b in this._core.options){const S={get:g.bind(this,b),set:v.bind(this,b)};Object.defineProperty(this._publicOptions,b,S)}}_checkReadonlyOptions(m){if(_.includes(m))throw new Error(`Option "${m}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new f.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new d.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new h.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const m=this._core.coreService.decPrivateModes;let g="none";switch(this._core.coreMouseService.activeProtocol){case"X10":g="x10";break;case"VT200":g="vt200";break;case"DRAG":g="drag";break;case"ANY":g="any"}return{applicationCursorKeysMode:m.applicationCursorKeys,applicationKeypadMode:m.applicationKeypad,bracketedPasteMode:m.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:g,originMode:m.origin,reverseWraparoundMode:m.reverseWraparound,sendFocusMode:m.sendFocus,wraparoundMode:m.wraparound}}get options(){return this._publicOptions}set options(m){for(const g in m)this._publicOptions[g]=m[g]}blur(){this._core.blur()}focus(){this._core.focus()}input(m,g=!0){this._core.input(m,g)}resize(m,g){this._verifyIntegers(m,g),this._core.resize(m,g)}open(m){this._core.open(m)}attachCustomKeyEventHandler(m){this._core.attachCustomKeyEventHandler(m)}attachCustomWheelEventHandler(m){this._core.attachCustomWheelEventHandler(m)}registerLinkProvider(m){return this._core.registerLinkProvider(m)}registerCharacterJoiner(m){return this._checkProposedApi(),this._core.registerCharacterJoiner(m)}deregisterCharacterJoiner(m){this._checkProposedApi(),this._core.deregisterCharacterJoiner(m)}registerMarker(m=0){return this._verifyIntegers(m),this._core.registerMarker(m)}registerDecoration(m){return this._checkProposedApi(),this._verifyPositiveIntegers(m.x??0,m.width??0,m.height??0),this._core.registerDecoration(m)}hasSelection(){return this._core.hasSelection()}select(m,g,v){this._verifyIntegers(m,g,v),this._core.select(m,g,v)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(m,g){this._verifyIntegers(m,g),this._core.selectLines(m,g)}dispose(){super.dispose()}scrollLines(m){this._verifyIntegers(m),this._core.scrollLines(m)}scrollPages(m){this._verifyIntegers(m),this._core.scrollPages(m)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(m){this._verifyIntegers(m),this._core.scrollToLine(m)}clear(){this._core.clear()}write(m,g){this._core.write(m,g)}writeln(m,g){this._core.write(m),this._core.write(`\r
`,g)}paste(m){this._core.paste(m)}refresh(m,g){this._verifyIntegers(m,g),this._core.refresh(m,g)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(m){this._addonManager.loadAddon(this,m)}static get strings(){return o}_verifyIntegers(...m){for(const g of m)if(g===1/0||isNaN(g)||g%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...m){for(const g of m)if(g&&(g===1/0||isNaN(g)||g%1!=0||g<0))throw new Error("This API only accepts positive integers")}}l.Terminal=y})(),s})()))})(jo)),jo.exports}var Tw=Lw(),zo={exports:{}},Mh;function Rw(){return Mh||(Mh=1,(function(i,e){(function(t,r){i.exports=r()})(self,(()=>(()=>{var t={};return(()=>{var r=t;Object.defineProperty(r,"__esModule",{value:!0}),r.FitAddon=void 0,r.FitAddon=class{activate(n){this._terminal=n}dispose(){}fit(){const n=this.proposeDimensions();if(!n||!this._terminal||isNaN(n.cols)||isNaN(n.rows))return;const s=this._terminal._core;this._terminal.rows===n.rows&&this._terminal.cols===n.cols||(s._renderService.clear(),this._terminal.resize(n.cols,n.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;const n=this._terminal._core,s=n._renderService.dimensions;if(s.css.cell.width===0||s.css.cell.height===0)return;const l=this._terminal.options.scrollback===0?0:n.viewport.scrollBarWidth,o=window.getComputedStyle(this._terminal.element.parentElement),a=parseInt(o.getPropertyValue("height")),c=Math.max(0,parseInt(o.getPropertyValue("width"))),u=window.getComputedStyle(this._terminal.element),h=a-(parseInt(u.getPropertyValue("padding-top"))+parseInt(u.getPropertyValue("padding-bottom"))),f=c-(parseInt(u.getPropertyValue("padding-right"))+parseInt(u.getPropertyValue("padding-left")))-l;return{cols:Math.max(2,Math.floor(f/s.css.cell.width)),rows:Math.max(1,Math.floor(h/s.css.cell.height))}}}})(),t})()))})(zo)),zo.exports}var Bw=Rw(),Wo={exports:{}},Lh;function Ow(){return Lh||(Lh=1,(function(i,e){(function(t,r){i.exports=r()})(self,(()=>(()=>{var t={6:(l,o)=>{function a(u){try{const h=new URL(u),f=h.password&&h.username?`${h.protocol}//${h.username}:${h.password}@${h.host}`:h.username?`${h.protocol}//${h.username}@${h.host}`:`${h.protocol}//${h.host}`;return u.toLocaleLowerCase().startsWith(f.toLocaleLowerCase())}catch{return!1}}Object.defineProperty(o,"__esModule",{value:!0}),o.LinkComputer=o.WebLinkProvider=void 0,o.WebLinkProvider=class{constructor(u,h,f,d={}){this._terminal=u,this._regex=h,this._handler=f,this._options=d}provideLinks(u,h){const f=c.computeLink(u,this._regex,this._terminal,this._handler);h(this._addCallbacks(f))}_addCallbacks(u){return u.map((h=>(h.leave=this._options.leave,h.hover=(f,d)=>{if(this._options.hover){const{range:_}=h;this._options.hover(f,d,_)}},h)))}};class c{static computeLink(h,f,d,_){const y=new RegExp(f.source,(f.flags||"")+"g"),[p,m]=c._getWindowedLineStrings(h-1,d),g=p.join("");let v;const b=[];for(;v=y.exec(g);){const S=v[0];if(!a(S))continue;const[x,k]=c._mapStrIdx(d,m,0,v.index),[w,E]=c._mapStrIdx(d,x,k,S.length);if(x===-1||k===-1||w===-1||E===-1)continue;const A={start:{x:k+1,y:x+1},end:{x:E,y:w+1}};b.push({range:A,text:S,activate:_})}return b}static _getWindowedLineStrings(h,f){let d,_=h,y=h,p=0,m="";const g=[];if(d=f.buffer.active.getLine(h)){const v=d.translateToString(!0);if(d.isWrapped&&v[0]!==" "){for(p=0;(d=f.buffer.active.getLine(--_))&&p<2048&&(m=d.translateToString(!0),p+=m.length,g.push(m),d.isWrapped&&m.indexOf(" ")===-1););g.reverse()}for(g.push(v),p=0;(d=f.buffer.active.getLine(++y))&&d.isWrapped&&p<2048&&(m=d.translateToString(!0),p+=m.length,g.push(m),m.indexOf(" ")===-1););}return[g,_]}static _mapStrIdx(h,f,d,_){const y=h.buffer.active,p=y.getNullCell();let m=d;for(;_;){const g=y.getLine(f);if(!g)return[-1,-1];for(let v=m;v<g.length;++v){g.getCell(v,p);const b=p.getChars();if(p.getWidth()&&(_-=b.length||1,v===g.length-1&&b==="")){const S=y.getLine(f+1);S&&S.isWrapped&&(S.getCell(0,p),p.getWidth()===2&&(_+=1))}if(_<0)return[f,v]}f++,m=0}return[f,m]}}o.LinkComputer=c}},r={};function n(l){var o=r[l];if(o!==void 0)return o.exports;var a=r[l]={exports:{}};return t[l](a,a.exports,n),a.exports}var s={};return(()=>{var l=s;Object.defineProperty(l,"__esModule",{value:!0}),l.WebLinksAddon=void 0;const o=n(6),a=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function c(u,h){const f=window.open();if(f){try{f.opener=null}catch{}f.location.href=h}else console.warn("Opening link blocked as opener could not be cleared")}l.WebLinksAddon=class{constructor(u=c,h={}){this._handler=u,this._options=h}activate(u){this._terminal=u;const h=this._options,f=h.urlRegex||a;this._linkProvider=this._terminal.registerLinkProvider(new o.WebLinkProvider(this._terminal,f,this._handler,h))}dispose(){var u;(u=this._linkProvider)==null||u.dispose()}}})(),s})()))})(Wo)),Wo.exports}var Pw=Ow();const $i="/api";function Iw({projectId:i,isMaximized:e=!1,onToggleMaximize:t,suggestedPrompts:r,className:n="",onFilesChanged:s}){const l=H.useRef(null),o=H.useRef(null),a=H.useRef(null),c=H.useRef(null),u=H.useRef(null),h=H.useRef(0),f=H.useRef(100),[d,_]=H.useState("connecting"),[y,p]=H.useState(null),[m,g]=H.useState(!1),v=H.useRef(!1),b=H.useRef(!1),S=H.useRef(null),x=H.useRef(0),k=H.useRef(""),w=H.useRef(null),E=H.useCallback(()=>{u.current&&(clearTimeout(u.current),u.current=null)},[]),A=H.useCallback(()=>{const z=k.current;k.current="",w.current=null;const $=c.current;!z||!$||fetch(`${$i}/projects/${i}/pty/${$}/input`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:btoa(z)})}).catch(()=>{})},[i]),T=H.useCallback(async z=>{const $=o.current;if(!$)return;const{cols:q,rows:M}=$;try{(await fetch(`${$i}/projects/${i}/pty/${z}/resize`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cols:q,rows:M})})).ok||(console.warn("Resize failed, reconnecting terminal..."),S.current&&S.current())}catch(C){console.error("Resize error:",C),S.current&&S.current()}},[i]),B=H.useCallback(z=>{E(),f.current=50;const $=async()=>{var q,M;try{const C=f.current<200?3:1,I=await fetch(`${$i}/projects/${i}/pty/${z}/output?timeout=${C}`,{method:"POST"});if(I.status===404){console.warn("Session lost (404), reconnecting..."),E(),S.current&&S.current();return}if(!I.ok)throw new Error(`HTTP ${I.status}`);const F=await I.json();if(h.current=0,F.output){f.current=50;const R=atob(F.output),X=new Uint8Array(R.length);for(let ie=0;ie<R.length;ie++)X[ie]=R.charCodeAt(ie);(q=o.current)==null||q.write(X)}else f.current=Math.min(f.current*2,2e3);F.files_modified_at&&F.files_modified_at>x.current&&(x.current=F.files_modified_at,s==null||s()),F.exited?((M=o.current)==null||M.writeln(`\r
\x1B[33m Process exited\x1B[0m`),_("disconnected"),E()):u.current=setTimeout($,f.current)}catch{h.current++,h.current>=5?(_("error"),p("Connection lost"),E()):u.current=setTimeout($,f.current)}};$()},[i,E,s]),O=H.useCallback(async()=>{var z,$,q;if(!(!o.current||v.current)){v.current=!0,_("connecting"),p(null);try{const M=await fetch(`${$i}/projects/${i}/pty/create`,{method:"POST"});if(!M.ok){const I=await M.json().catch(()=>({detail:`HTTP ${M.status}`}));throw new Error(I.detail||`HTTP ${M.status}`)}const C=await M.json();c.current=C.session_id,_("connected"),(z=o.current)==null||z.writeln(`\x1B[32m Connected (session ${C.session_id.slice(0,8)})\x1B[0m`),($=o.current)==null||$.writeln(""),B(C.session_id),setTimeout(()=>{if(a.current)try{a.current.fit()}catch{}T(C.session_id)},100)}catch(M){_("error"),p(M instanceof Error?M.message:String(M)),(q=o.current)==null||q.writeln(`\x1B[31m Error: ${M instanceof Error?M.message:M}\x1B[0m`)}finally{v.current=!1}}},[i,B,T]);H.useEffect(()=>{if(!l.current||o.current)return;const z=new Tw.Terminal({cursorBlink:!0,fontSize:13,fontFamily:"JetBrains Mono, Menlo, Monaco, Consolas, monospace",theme:{background:"#1e1e1e",foreground:"#d4d4d4",cursor:"#d4d4d4",cursorAccent:"#1e1e1e",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#ffffff"},allowProposedApi:!0}),$=new Bw.FitAddon,q=new Pw.WebLinksAddon;return z.loadAddon($),z.loadAddon(q),z.open(l.current),requestAnimationFrame(()=>{try{$.fit()}catch{}}),o.current=z,a.current=$,z.writeln("\x1B[1;34m\x1B[0m"),z.writeln("\x1B[1;34m\x1B[0m  \x1B[1;33mClaude Code Terminal\x1B[0m                               \x1B[1;34m\x1B[0m"),z.writeln("\x1B[1;34m\x1B[0m  Connecting to Databricks-authenticated session...  \x1B[1;34m\x1B[0m"),z.writeln("\x1B[1;34m\x1B[0m"),z.writeln(""),z.onData(M=>{c.current&&(k.current+=M,f.current=50,w.current||(w.current=setTimeout(()=>{A()},15)))}),()=>{z.dispose(),o.current=null,a.current=null}},[]),H.useEffect(()=>{const z=setTimeout(()=>{o.current&&O()},100);return()=>{clearTimeout(z),E(),w.current&&(clearTimeout(w.current),w.current=null)}},[O,E,i]),H.useEffect(()=>{const z=()=>{const $=c.current;$&&navigator.sendBeacon(`${$i}/projects/${i}/pty/${$}/terminate`,"")};return window.addEventListener("beforeunload",z),()=>window.removeEventListener("beforeunload",z)},[i]),H.useEffect(()=>{const z=()=>{if(a.current&&o.current)try{a.current.fit();const C=c.current;C&&T(C)}catch{}};let $;const q=()=>{clearTimeout($),$=setTimeout(z,250)};window.addEventListener("resize",q);const M=new ResizeObserver(q);return l.current&&M.observe(l.current),()=>{window.removeEventListener("resize",q),M.disconnect(),clearTimeout($)}},[T]);const N=H.useCallback(z=>{g(!0);const $=c.current;if(!$)return;const q=btoa(z+`
`);fetch(`${$i}/projects/${i}/pty/${$}/input`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:q})}).catch(()=>{})},[i]),j=H.useCallback(()=>{if(b.current)return;b.current=!0,o.current&&o.current.write(`\r
\x1B[33mReconnecting session...\x1B[0m\r
`),E();const z=c.current;z&&(fetch(`${$i}/projects/${i}/pty/${z}`,{method:"DELETE"}).catch(()=>{}),c.current=null),v.current=!1,O().then(()=>{b.current=!1}).catch($=>{console.error("Reconnection failed:",$),b.current=!1,_("error")})},[O,i,E]);return S.current=j,D.jsxs("div",{className:ue("relative h-full w-full flex flex-col",n),children:[D.jsxs("div",{className:"flex items-center justify-between h-8 px-3 bg-[#252526] border-b border-[#3c3c3c] flex-shrink-0",children:[D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx("span",{className:"text-xs text-[#d4d4d4] font-medium",children:"Claude Code"}),D.jsxs("span",{className:ue("inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px]",d==="connected"&&"bg-green-500/20 text-green-400",d==="connecting"&&"bg-blue-500/20 text-blue-400",d==="disconnected"&&"bg-yellow-500/20 text-yellow-400",d==="error"&&"bg-red-500/20 text-red-400"),children:[d==="connecting"&&D.jsx(Di,{className:"h-2.5 w-2.5 animate-spin"}),d==="connected"&&"",d==="disconnected"&&"",d==="error"&&D.jsx(Nc,{className:"h-2.5 w-2.5"}),d]})]}),D.jsxs("div",{className:"flex items-center gap-1",children:[(d==="disconnected"||d==="error")&&D.jsxs("button",{onClick:j,className:"flex items-center gap-1 px-2 py-0.5 text-[10px] text-[#d4d4d4] hover:text-white hover:bg-[#3c3c3c] rounded transition-colors",children:[D.jsx(Rr,{className:"h-2.5 w-2.5"}),"Reconnect"]}),t&&D.jsx("button",{onClick:t,className:"flex items-center justify-center p-1 text-[#d4d4d4] hover:text-white hover:bg-[#3c3c3c] rounded transition-colors",title:e?"Restore":"Maximize",children:e?D.jsx(T0,{className:"h-3.5 w-3.5"}):D.jsx(M0,{className:"h-3.5 w-3.5"})})]})]}),D.jsx("div",{ref:l,className:"flex-1 overflow-hidden",style:{padding:"8px"}}),r&&r.length>0&&!m&&d==="connected"&&D.jsx("div",{className:"absolute bottom-2 left-2 right-2 z-10",children:D.jsxs("div",{className:"bg-[#252526]/95 border border-[#3c3c3c] rounded-lg p-3 backdrop-blur-sm",children:[D.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[D.jsx(vl,{className:"h-3 w-3 text-[#d4d4d4]"}),D.jsx("span",{className:"text-[10px] text-[#808080] uppercase tracking-wide",children:"Suggested prompts"})]}),D.jsx("div",{className:"flex flex-col gap-1.5",children:r.map((z,$)=>D.jsx("button",{onClick:()=>N(z),className:"text-left text-xs text-[#d4d4d4] hover:text-white bg-[#1e1e1e] hover:bg-[#2d2d2d] rounded px-2.5 py-1.5 transition-colors border border-[#3c3c3c] hover:border-[#505050]",children:z},$))})]})}),d==="error"&&y&&D.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 z-10",children:D.jsxs("div",{className:"bg-[#252526] border border-[#3c3c3c] rounded-lg p-4 max-w-md text-center",children:[D.jsx(Nc,{className:"h-8 w-8 text-red-400 mx-auto mb-2"}),D.jsx("h3",{className:"text-sm font-medium text-[#d4d4d4] mb-1",children:"Connection Error"}),D.jsx("p",{className:"text-xs text-[#808080] mb-3",children:y}),D.jsx("button",{onClick:j,className:"px-3 py-1.5 bg-[#0e639c] hover:bg-[#1177bb] text-white text-xs rounded transition-colors",children:"Try Again"})]})})]})}function Nw({lines:i,className:e=""}){return i.length===0?D.jsx("div",{className:ue("h-full flex items-center justify-center text-[var(--color-text-muted)] text-sm",e),children:"No output yet"}):D.jsx("div",{className:ue("h-full overflow-y-auto bg-[var(--color-background)] p-2 font-mono text-xs",e),children:i.map(t=>D.jsxs("div",{className:ue("py-0.5",t.level==="error"&&"text-red-400",t.level==="warning"&&"text-yellow-400",t.level==="info"&&"text-[var(--color-text-primary)]"),children:[D.jsxs("span",{className:"text-[var(--color-text-muted)]",children:["[",t.timestamp.toLocaleTimeString(),"]"]}),t.source&&D.jsxs("span",{className:"text-[var(--color-accent-primary)] ml-1",children:["[",t.source,"]"]}),D.jsx("span",{className:"ml-1",children:t.message})]},t.id))})}let Rl=[],Nd=[];(()=>{let i="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(e=>e?parseInt(e,36):1);for(let e=0,t=0;e<i.length;e++)(e%2?Nd:Rl).push(t=t+i[e])})();function Fw(i){if(i<768)return!1;for(let e=0,t=Rl.length;;){let r=e+t>>1;if(i<Rl[r])t=r;else if(i>=Nd[r])e=r+1;else return!0;if(e==t)return!1}}function Th(i){return i>=127462&&i<=127487}const Rh=8205;function Hw(i,e,t=!0,r=!0){return(t?Fd:jw)(i,e,r)}function Fd(i,e,t){if(e==i.length)return e;e&&Hd(i.charCodeAt(e))&&jd(i.charCodeAt(e-1))&&e--;let r=$o(i,e);for(e+=Bh(r);e<i.length;){let n=$o(i,e);if(r==Rh||n==Rh||t&&Fw(n))e+=Bh(n),r=n;else if(Th(n)){let s=0,l=e-2;for(;l>=0&&Th($o(i,l));)s++,l-=2;if(s%2==0)break;e+=2}else break}return e}function jw(i,e,t){for(;e>0;){let r=Fd(i,e-2,t);if(r<e)return r;e--}return 0}function $o(i,e){let t=i.charCodeAt(e);if(!jd(t)||e+1==i.length)return t;let r=i.charCodeAt(e+1);return Hd(r)?(t-55296<<10)+(r-56320)+65536:t}function Hd(i){return i>=56320&&i<57344}function jd(i){return i>=55296&&i<56320}function Bh(i){return i<65536?1:2}let Ae=class zd{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,r){[e,t]=kr(this,e,t);let n=[];return this.decompose(0,e,n,2),r.length&&r.decompose(0,r.length,n,3),this.decompose(t,this.length,n,1),ei.from(n,this.length-(t-e)+r.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){[e,t]=kr(this,e,t);let r=[];return this.decompose(e,t,r,0),ei.from(r,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),r=this.length-this.scanIdentical(e,-1),n=new tn(this),s=new tn(e);for(let l=t,o=t;;){if(n.next(l),s.next(l),l=0,n.lineBreak!=s.lineBreak||n.done!=s.done||n.value!=s.value)return!1;if(o+=n.value.length,n.done||o>=r)return!0}}iter(e=1){return new tn(this,e)}iterRange(e,t=this.length){return new Wd(this,e,t)}iterLines(e,t){let r;if(e==null)r=this.iter();else{t==null&&(t=this.lines+1);let n=this.line(e).from;r=this.iterRange(n,Math.max(n,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new $d(r)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?zd.empty:e.length<=32?new He(e):ei.from(He.split(e,[]))}};class He extends Ae{constructor(e,t=zw(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,r,n){for(let s=0;;s++){let l=this.text[s],o=n+l.length;if((t?r:o)>=e)return new Ww(n,o,r,l);n=o+1,r++}}decompose(e,t,r,n){let s=e<=0&&t>=this.length?this:new He(Oh(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(n&1){let l=r.pop(),o=ms(s.text,l.text.slice(),0,s.length);if(o.length<=32)r.push(new He(o,l.length+s.length));else{let a=o.length>>1;r.push(new He(o.slice(0,a)),new He(o.slice(a)))}}else r.push(s)}replace(e,t,r){if(!(r instanceof He))return super.replace(e,t,r);[e,t]=kr(this,e,t);let n=ms(this.text,ms(r.text,Oh(this.text,0,e)),t),s=this.length+r.length-(t-e);return n.length<=32?new He(n,s):ei.from(He.split(n,[]),s)}sliceString(e,t=this.length,r=`
`){[e,t]=kr(this,e,t);let n="";for(let s=0,l=0;s<=t&&l<this.text.length;l++){let o=this.text[l],a=s+o.length;s>e&&l&&(n+=r),e<a&&t>s&&(n+=o.slice(Math.max(0,e-s),t-s)),s=a+1}return n}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let r=[],n=-1;for(let s of e)r.push(s),n+=s.length+1,r.length==32&&(t.push(new He(r,n)),r=[],n=-1);return n>-1&&t.push(new He(r,n)),t}}class ei extends Ae{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let r of e)this.lines+=r.lines}lineInner(e,t,r,n){for(let s=0;;s++){let l=this.children[s],o=n+l.length,a=r+l.lines-1;if((t?a:o)>=e)return l.lineInner(e,t,r,n);n=o+1,r=a+1}}decompose(e,t,r,n){for(let s=0,l=0;l<=t&&s<this.children.length;s++){let o=this.children[s],a=l+o.length;if(e<=a&&t>=l){let c=n&((l<=e?1:0)|(a>=t?2:0));l>=e&&a<=t&&!c?r.push(o):o.decompose(e-l,t-l,r,c)}l=a+1}}replace(e,t,r){if([e,t]=kr(this,e,t),r.lines<this.lines)for(let n=0,s=0;n<this.children.length;n++){let l=this.children[n],o=s+l.length;if(e>=s&&t<=o){let a=l.replace(e-s,t-s,r),c=this.lines-l.lines+a.lines;if(a.lines<c>>4&&a.lines>c>>6){let u=this.children.slice();return u[n]=a,new ei(u,this.length-(t-e)+r.length)}return super.replace(s,o,a)}s=o+1}return super.replace(e,t,r)}sliceString(e,t=this.length,r=`
`){[e,t]=kr(this,e,t);let n="";for(let s=0,l=0;s<this.children.length&&l<=t;s++){let o=this.children[s],a=l+o.length;l>e&&s&&(n+=r),e<a&&t>l&&(n+=o.sliceString(e-l,t-l,r)),l=a+1}return n}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof ei))return 0;let r=0,[n,s,l,o]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;n+=t,s+=t){if(n==l||s==o)return r;let a=this.children[n],c=e.children[s];if(a!=c)return r+a.scanIdentical(c,t);r+=a.length+1}}static from(e,t=e.reduce((r,n)=>r+n.length+1,-1)){let r=0;for(let d of e)r+=d.lines;if(r<32){let d=[];for(let _ of e)_.flatten(d);return new He(d,t)}let n=Math.max(32,r>>5),s=n<<1,l=n>>1,o=[],a=0,c=-1,u=[];function h(d){let _;if(d.lines>s&&d instanceof ei)for(let y of d.children)h(y);else d.lines>l&&(a>l||!a)?(f(),o.push(d)):d instanceof He&&a&&(_=u[u.length-1])instanceof He&&d.lines+_.lines<=32?(a+=d.lines,c+=d.length+1,u[u.length-1]=new He(_.text.concat(d.text),_.length+1+d.length)):(a+d.lines>n&&f(),a+=d.lines,c+=d.length+1,u.push(d))}function f(){a!=0&&(o.push(u.length==1?u[0]:ei.from(u,c)),c=-1,a=u.length=0)}for(let d of e)h(d);return f(),o.length==1?o[0]:new ei(o,t)}}Ae.empty=new He([""],0);function zw(i){let e=-1;for(let t of i)e+=t.length+1;return e}function ms(i,e,t=0,r=1e9){for(let n=0,s=0,l=!0;s<i.length&&n<=r;s++){let o=i[s],a=n+o.length;a>=t&&(a>r&&(o=o.slice(0,r-n)),n<t&&(o=o.slice(t-n)),l?(e[e.length-1]+=o,l=!1):e.push(o)),n=a+1}return e}function Oh(i,e,t){return ms(i,[""],e,t)}class tn{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof He?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let r=this.nodes.length-1,n=this.nodes[r],s=this.offsets[r],l=s>>1,o=n instanceof He?n.text.length:n.children.length;if(l==(t>0?o:0)){if(r==0)return this.done=!0,this.value="",this;t>0&&this.offsets[r-1]++,this.nodes.pop(),this.offsets.pop()}else if((s&1)==(t>0?0:1)){if(this.offsets[r]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(n instanceof He){let a=n.text[l+(t<0?-1:0)];if(this.offsets[r]+=t,a.length>Math.max(0,e))return this.value=e==0?a:t>0?a.slice(e):a.slice(0,a.length-e),this;e-=a.length}else{let a=n.children[l+(t<0?-1:0)];e>a.length?(e-=a.length,this.offsets[r]+=t):(t<0&&this.offsets[r]--,this.nodes.push(a),this.offsets.push(t>0?1:(a instanceof He?a.text.length:a.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class Wd{constructor(e,t,r){this.value="",this.done=!1,this.cursor=new tn(e,t>r?-1:1),this.pos=t>r?e.length:0,this.from=Math.min(t,r),this.to=Math.max(t,r)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let r=t<0?this.pos-this.from:this.to-this.pos;e>r&&(e=r),r-=e;let{value:n}=this.cursor.next(e);return this.pos+=(n.length+e)*t,this.value=n.length<=r?n:t<0?n.slice(n.length-r):n.slice(0,r),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class $d{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:r,value:n}=this.inner.next(e);return t&&this.afterBreak?(this.value="",this.afterBreak=!1):t?(this.done=!0,this.value=""):r?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(Ae.prototype[Symbol.iterator]=function(){return this.iter()},tn.prototype[Symbol.iterator]=Wd.prototype[Symbol.iterator]=$d.prototype[Symbol.iterator]=function(){return this});class Ww{constructor(e,t,r,n){this.from=e,this.to=t,this.number=r,this.text=n}get length(){return this.to-this.from}}function kr(i,e,t){return e=Math.max(0,Math.min(i.length,e)),[e,Math.max(e,Math.min(i.length,t))]}function Ke(i,e,t=!0,r=!0){return Hw(i,e,t,r)}function $w(i){return i>=56320&&i<57344}function Uw(i){return i>=55296&&i<56320}function At(i,e){let t=i.charCodeAt(e);if(!Uw(t)||e+1==i.length)return t;let r=i.charCodeAt(e+1);return $w(r)?(t-55296<<10)+(r-56320)+65536:t}function Ua(i){return i<=65535?String.fromCharCode(i):(i-=65536,String.fromCharCode((i>>10)+55296,(i&1023)+56320))}function ti(i){return i<65536?1:2}const Bl=/\r\n?|\n/;var Qe=(function(i){return i[i.Simple=0]="Simple",i[i.TrackDel=1]="TrackDel",i[i.TrackBefore=2]="TrackBefore",i[i.TrackAfter=3]="TrackAfter",i})(Qe||(Qe={}));class oi{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let r=this.sections[t+1];e+=r<0?this.sections[t]:r}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,r=0,n=0;t<this.sections.length;){let s=this.sections[t++],l=this.sections[t++];l<0?(e(r,n,s),n+=s):n+=l,r+=s}}iterChangedRanges(e,t=!1){Ol(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let r=this.sections[t++],n=this.sections[t++];n<0?e.push(r,n):e.push(n,r)}return new oi(e)}composeDesc(e){return this.empty?e:e.empty?this:Ud(this,e)}mapDesc(e,t=!1){return e.empty?this:Pl(this,e,t)}mapPos(e,t=-1,r=Qe.Simple){let n=0,s=0;for(let l=0;l<this.sections.length;){let o=this.sections[l++],a=this.sections[l++],c=n+o;if(a<0){if(c>e)return s+(e-n);s+=o}else{if(r!=Qe.Simple&&c>=e&&(r==Qe.TrackDel&&n<e&&c>e||r==Qe.TrackBefore&&n<e||r==Qe.TrackAfter&&c>e))return null;if(c>e||c==e&&t<0&&!o)return e==n||t<0?s:s+a;s+=a}n=c}if(e>n)throw new RangeError(`Position ${e} is out of range for changeset of length ${n}`);return s}touchesRange(e,t=e){for(let r=0,n=0;r<this.sections.length&&n<=t;){let s=this.sections[r++],l=this.sections[r++],o=n+s;if(l>=0&&n<=t&&o>=e)return n<e&&o>t?"cover":!0;n=o}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let r=this.sections[t++],n=this.sections[t++];e+=(e?" ":"")+r+(n>=0?":"+n:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new oi(e)}static create(e){return new oi(e)}}class qe extends oi{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return Ol(this,(t,r,n,s,l)=>e=e.replace(n,n+(r-t),l),!1),e}mapDesc(e,t=!1){return Pl(this,e,t,!0)}invert(e){let t=this.sections.slice(),r=[];for(let n=0,s=0;n<t.length;n+=2){let l=t[n],o=t[n+1];if(o>=0){t[n]=o,t[n+1]=l;let a=n>>1;for(;r.length<a;)r.push(Ae.empty);r.push(l?e.slice(s,s+l):Ae.empty)}s+=l}return new qe(t,r)}compose(e){return this.empty?e:e.empty?this:Ud(this,e,!0)}map(e,t=!1){return e.empty?this:Pl(this,e,t,!0)}iterChanges(e,t=!1){Ol(this,e,t)}get desc(){return oi.create(this.sections)}filter(e){let t=[],r=[],n=[],s=new hn(this);e:for(let l=0,o=0;;){let a=l==e.length?1e9:e[l++];for(;o<a||o==a&&s.len==0;){if(s.done)break e;let u=Math.min(s.len,a-o);it(n,u,-1);let h=s.ins==-1?-1:s.off==0?s.ins:0;it(t,u,h),h>0&&Ci(r,t,s.text),s.forward(u),o+=u}let c=e[l++];for(;o<c;){if(s.done)break e;let u=Math.min(s.len,c-o);it(t,u,-1),it(n,u,s.ins==-1?-1:s.off==0?s.ins:0),s.forward(u),o+=u}}return{changes:new qe(t,r),filtered:oi.create(n)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let r=this.sections[t],n=this.sections[t+1];n<0?e.push(r):n==0?e.push([r]):e.push([r].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,r){let n=[],s=[],l=0,o=null;function a(u=!1){if(!u&&!n.length)return;l<t&&it(n,t-l,-1);let h=new qe(n,s);o=o?o.compose(h.map(o)):h,n=[],s=[],l=0}function c(u){if(Array.isArray(u))for(let h of u)c(h);else if(u instanceof qe){if(u.length!=t)throw new RangeError(`Mismatched change set length (got ${u.length}, expected ${t})`);a(),o=o?o.compose(u.map(o)):u}else{let{from:h,to:f=h,insert:d}=u;if(h>f||h<0||f>t)throw new RangeError(`Invalid change range ${h} to ${f} (in doc of length ${t})`);let _=d?typeof d=="string"?Ae.of(d.split(r||Bl)):d:Ae.empty,y=_.length;if(h==f&&y==0)return;h<l&&a(),h>l&&it(n,h-l,-1),it(n,f-h,y),Ci(s,n,_),l=f}}return c(e),a(!o),o}static empty(e){return new qe(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],r=[];for(let n=0;n<e.length;n++){let s=e[n];if(typeof s=="number")t.push(s,-1);else{if(!Array.isArray(s)||typeof s[0]!="number"||s.some((l,o)=>o&&typeof l!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(s.length==1)t.push(s[0],0);else{for(;r.length<n;)r.push(Ae.empty);r[n]=Ae.of(s.slice(1)),t.push(s[0],r[n].length)}}}return new qe(t,r)}static createSet(e,t){return new qe(e,t)}}function it(i,e,t,r=!1){if(e==0&&t<=0)return;let n=i.length-2;n>=0&&t<=0&&t==i[n+1]?i[n]+=e:n>=0&&e==0&&i[n]==0?i[n+1]+=t:r?(i[n]+=e,i[n+1]+=t):i.push(e,t)}function Ci(i,e,t){if(t.length==0)return;let r=e.length-2>>1;if(r<i.length)i[i.length-1]=i[i.length-1].append(t);else{for(;i.length<r;)i.push(Ae.empty);i.push(t)}}function Ol(i,e,t){let r=i.inserted;for(let n=0,s=0,l=0;l<i.sections.length;){let o=i.sections[l++],a=i.sections[l++];if(a<0)n+=o,s+=o;else{let c=n,u=s,h=Ae.empty;for(;c+=o,u+=a,a&&r&&(h=h.append(r[l-2>>1])),!(t||l==i.sections.length||i.sections[l+1]<0);)o=i.sections[l++],a=i.sections[l++];e(n,c,s,u,h),n=c,s=u}}}function Pl(i,e,t,r=!1){let n=[],s=r?[]:null,l=new hn(i),o=new hn(e);for(let a=-1;;){if(l.done&&o.len||o.done&&l.len)throw new Error("Mismatched change set lengths");if(l.ins==-1&&o.ins==-1){let c=Math.min(l.len,o.len);it(n,c,-1),l.forward(c),o.forward(c)}else if(o.ins>=0&&(l.ins<0||a==l.i||l.off==0&&(o.len<l.len||o.len==l.len&&!t))){let c=o.len;for(it(n,o.ins,-1);c;){let u=Math.min(l.len,c);l.ins>=0&&a<l.i&&l.len<=u&&(it(n,0,l.ins),s&&Ci(s,n,l.text),a=l.i),l.forward(u),c-=u}o.next()}else if(l.ins>=0){let c=0,u=l.len;for(;u;)if(o.ins==-1){let h=Math.min(u,o.len);c+=h,u-=h,o.forward(h)}else if(o.ins==0&&o.len<u)u-=o.len,o.next();else break;it(n,c,a<l.i?l.ins:0),s&&a<l.i&&Ci(s,n,l.text),a=l.i,l.forward(l.len-u)}else{if(l.done&&o.done)return s?qe.createSet(n,s):oi.create(n);throw new Error("Mismatched change set lengths")}}}function Ud(i,e,t=!1){let r=[],n=t?[]:null,s=new hn(i),l=new hn(e);for(let o=!1;;){if(s.done&&l.done)return n?qe.createSet(r,n):oi.create(r);if(s.ins==0)it(r,s.len,0,o),s.next();else if(l.len==0&&!l.done)it(r,0,l.ins,o),n&&Ci(n,r,l.text),l.next();else{if(s.done||l.done)throw new Error("Mismatched change set lengths");{let a=Math.min(s.len2,l.len),c=r.length;if(s.ins==-1){let u=l.ins==-1?-1:l.off?0:l.ins;it(r,a,u,o),n&&u&&Ci(n,r,l.text)}else l.ins==-1?(it(r,s.off?0:s.len,a,o),n&&Ci(n,r,s.textBit(a))):(it(r,s.off?0:s.len,l.off?0:l.ins,o),n&&!l.off&&Ci(n,r,l.text));o=(s.ins>a||l.ins>=0&&l.len>a)&&(o||r.length>c),s.forward2(a),l.forward(a)}}}}class hn{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?Ae.empty:e[t]}textBit(e){let{inserted:t}=this.set,r=this.i-2>>1;return r>=t.length&&!e?Ae.empty:t[r].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class Gi{constructor(e,t,r){this.from=e,this.to=t,this.flags=r}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,t=-1){let r,n;return this.empty?r=n=e.mapPos(this.from,t):(r=e.mapPos(this.from,1),n=e.mapPos(this.to,-1)),r==this.from&&n==this.to?this:new Gi(r,n,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return G.range(e,t);let r=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return G.range(this.anchor,r)}eq(e,t=!1){return this.anchor==e.anchor&&this.head==e.head&&this.goalColumn==e.goalColumn&&(!t||!this.empty||this.assoc==e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return G.range(e.anchor,e.head)}static create(e,t,r){return new Gi(e,t,r)}}class G{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:G.create(this.ranges.map(r=>r.map(e,t)),this.mainIndex)}eq(e,t=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let r=0;r<this.ranges.length;r++)if(!this.ranges[r].eq(e.ranges[r],t))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new G([this.main],0)}addRange(e,t=!0){return G.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let r=this.ranges.slice();return r[t]=e,G.create(r,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new G(e.ranges.map(t=>Gi.fromJSON(t)),e.main)}static single(e,t=e){return new G([G.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let r=0,n=0;n<e.length;n++){let s=e[n];if(s.empty?s.from<=r:s.from<r)return G.normalized(e.slice(),t);r=s.to}return new G(e,t)}static cursor(e,t=0,r,n){return Gi.create(e,e,(t==0?0:t<0?8:16)|(r==null?7:Math.min(6,r))|(n??16777215)<<6)}static range(e,t,r,n){let s=(r??16777215)<<6|(n==null?7:Math.min(6,n));return t<e?Gi.create(t,e,48|s):Gi.create(e,t,(t>e?8:0)|s)}static normalized(e,t=0){let r=e[t];e.sort((n,s)=>n.from-s.from),t=e.indexOf(r);for(let n=1;n<e.length;n++){let s=e[n],l=e[n-1];if(s.empty?s.from<=l.to:s.from<l.to){let o=l.from,a=Math.max(s.to,l.to);n<=t&&t--,e.splice(--n,2,s.anchor>s.head?G.range(a,o):G.range(o,a))}}return new G(e,t)}}function Vd(i,e){for(let t of i.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let Va=0;class oe{constructor(e,t,r,n,s){this.combine=e,this.compareInput=t,this.compare=r,this.isStatic=n,this.id=Va++,this.default=e([]),this.extensions=typeof s=="function"?s(this):s}get reader(){return this}static define(e={}){return new oe(e.combine||(t=>t),e.compareInput||((t,r)=>t===r),e.compare||(e.combine?(t,r)=>t===r:qa),!!e.static,e.enables)}of(e){return new gs([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new gs(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new gs(e,this,2,t)}from(e,t){return t||(t=r=>r),this.compute([e],r=>t(r.field(e)))}}function qa(i,e){return i==e||i.length==e.length&&i.every((t,r)=>t===e[r])}class gs{constructor(e,t,r,n){this.dependencies=e,this.facet=t,this.type=r,this.value=n,this.id=Va++}dynamicSlot(e){var t;let r=this.value,n=this.facet.compareInput,s=this.id,l=e[s]>>1,o=this.type==2,a=!1,c=!1,u=[];for(let h of this.dependencies)h=="doc"?a=!0:h=="selection"?c=!0:(((t=e[h.id])!==null&&t!==void 0?t:1)&1)==0&&u.push(e[h.id]);return{create(h){return h.values[l]=r(h),1},update(h,f){if(a&&f.docChanged||c&&(f.docChanged||f.selection)||Il(h,u)){let d=r(h);if(o?!Ph(d,h.values[l],n):!n(d,h.values[l]))return h.values[l]=d,1}return 0},reconfigure:(h,f)=>{let d,_=f.config.address[s];if(_!=null){let y=As(f,_);if(this.dependencies.every(p=>p instanceof oe?f.facet(p)===h.facet(p):p instanceof et?f.field(p,!1)==h.field(p,!1):!0)||(o?Ph(d=r(h),y,n):n(d=r(h),y)))return h.values[l]=y,0}else d=r(h);return h.values[l]=d,1}}}}function Ph(i,e,t){if(i.length!=e.length)return!1;for(let r=0;r<i.length;r++)if(!t(i[r],e[r]))return!1;return!0}function Il(i,e){let t=!1;for(let r of e)rn(i,r)&1&&(t=!0);return t}function Vw(i,e,t){let r=t.map(a=>i[a.id]),n=t.map(a=>a.type),s=r.filter(a=>!(a&1)),l=i[e.id]>>1;function o(a){let c=[];for(let u=0;u<r.length;u++){let h=As(a,r[u]);if(n[u]==2)for(let f of h)c.push(f);else c.push(h)}return e.combine(c)}return{create(a){for(let c of r)rn(a,c);return a.values[l]=o(a),1},update(a,c){if(!Il(a,s))return 0;let u=o(a);return e.compare(u,a.values[l])?0:(a.values[l]=u,1)},reconfigure(a,c){let u=Il(a,r),h=c.config.facets[e.id],f=c.facet(e);if(h&&!u&&qa(t,h))return a.values[l]=f,0;let d=o(a);return e.compare(d,f)?(a.values[l]=f,0):(a.values[l]=d,1)}}}const $n=oe.define({static:!0});class et{constructor(e,t,r,n,s){this.id=e,this.createF=t,this.updateF=r,this.compareF=n,this.spec=s,this.provides=void 0}static define(e){let t=new et(Va++,e.create,e.update,e.compare||((r,n)=>r===n),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet($n).find(r=>r.field==this);return((t==null?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:r=>(r.values[t]=this.create(r),1),update:(r,n)=>{let s=r.values[t],l=this.updateF(s,n);return this.compareF(s,l)?0:(r.values[t]=l,1)},reconfigure:(r,n)=>{let s=r.facet($n),l=n.facet($n),o;return(o=s.find(a=>a.field==this))&&o!=l.find(a=>a.field==this)?(r.values[t]=o.create(r),1):n.config.address[this.id]!=null?(r.values[t]=n.field(this),0):(r.values[t]=this.create(r),1)}}}init(e){return[this,$n.of({field:this,create:e})]}get extension(){return this}}const qi={lowest:4,low:3,default:2,high:1,highest:0};function Ur(i){return e=>new qd(e,i)}const nr={highest:Ur(qi.highest),high:Ur(qi.high),default:Ur(qi.default),low:Ur(qi.low),lowest:Ur(qi.lowest)};class qd{constructor(e,t){this.inner=e,this.prec=t}}class ro{of(e){return new Nl(this,e)}reconfigure(e){return ro.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class Nl{constructor(e,t){this.compartment=e,this.inner=t}}class Es{constructor(e,t,r,n,s,l){for(this.base=e,this.compartments=t,this.dynamicSlots=r,this.address=n,this.staticValues=s,this.facets=l,this.statusTemplate=[];this.statusTemplate.length<r.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,r){let n=[],s=Object.create(null),l=new Map;for(let f of qw(e,t,l))f instanceof et?n.push(f):(s[f.facet.id]||(s[f.facet.id]=[])).push(f);let o=Object.create(null),a=[],c=[];for(let f of n)o[f.id]=c.length<<1,c.push(d=>f.slot(d));let u=r==null?void 0:r.config.facets;for(let f in s){let d=s[f],_=d[0].facet,y=u&&u[f]||[];if(d.every(p=>p.type==0))if(o[_.id]=a.length<<1|1,qa(y,d))a.push(r.facet(_));else{let p=_.combine(d.map(m=>m.value));a.push(r&&_.compare(p,r.facet(_))?r.facet(_):p)}else{for(let p of d)p.type==0?(o[p.id]=a.length<<1|1,a.push(p.value)):(o[p.id]=c.length<<1,c.push(m=>p.dynamicSlot(m)));o[_.id]=c.length<<1,c.push(p=>Vw(p,_,d))}}let h=c.map(f=>f(o));return new Es(e,l,h,o,a,s)}}function qw(i,e,t){let r=[[],[],[],[],[]],n=new Map;function s(l,o){let a=n.get(l);if(a!=null){if(a<=o)return;let c=r[a].indexOf(l);c>-1&&r[a].splice(c,1),l instanceof Nl&&t.delete(l.compartment)}if(n.set(l,o),Array.isArray(l))for(let c of l)s(c,o);else if(l instanceof Nl){if(t.has(l.compartment))throw new RangeError("Duplicate use of compartment in extensions");let c=e.get(l.compartment)||l.inner;t.set(l.compartment,c),s(c,o)}else if(l instanceof qd)s(l.inner,l.prec);else if(l instanceof et)r[o].push(l),l.provides&&s(l.provides,o);else if(l instanceof gs)r[o].push(l),l.facet.extensions&&s(l.facet.extensions,qi.default);else{let c=l.extension;if(!c)throw new Error(`Unrecognized extension value in extension set (${l}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);s(c,o)}}return s(i,qi.default),r.reduce((l,o)=>l.concat(o))}function rn(i,e){if(e&1)return 2;let t=e>>1,r=i.status[t];if(r==4)throw new Error("Cyclic dependency between fields and/or facets");if(r&2)return r;i.status[t]=4;let n=i.computeSlot(i,i.config.dynamicSlots[t]);return i.status[t]=2|n}function As(i,e){return e&1?i.config.staticValues[e>>1]:i.values[e>>1]}const Kd=oe.define(),Fl=oe.define({combine:i=>i.some(e=>e),static:!0}),Gd=oe.define({combine:i=>i.length?i[0]:void 0,static:!0}),Xd=oe.define(),Jd=oe.define(),Yd=oe.define(),Qd=oe.define({combine:i=>i.length?i[0]:!1});class gi{constructor(e,t){this.type=e,this.value=t}static define(){return new Kw}}class Kw{of(e){return new gi(this,e)}}class Gw{constructor(e){this.map=e}of(e){return new pe(this,e)}}class pe{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new pe(this.type,t)}is(e){return this.type==e}static define(e={}){return new Gw(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let r=[];for(let n of e){let s=n.map(t);s&&r.push(s)}return r}}pe.reconfigure=pe.define();pe.appendConfig=pe.define();class ze{constructor(e,t,r,n,s,l){this.startState=e,this.changes=t,this.selection=r,this.effects=n,this.annotations=s,this.scrollIntoView=l,this._doc=null,this._state=null,r&&Vd(r,t.newLength),s.some(o=>o.type==ze.time)||(this.annotations=s.concat(ze.time.of(Date.now())))}static create(e,t,r,n,s,l){return new ze(e,t,r,n,s,l)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(ze.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}ze.time=gi.define();ze.userEvent=gi.define();ze.addToHistory=gi.define();ze.remote=gi.define();function Xw(i,e){let t=[];for(let r=0,n=0;;){let s,l;if(r<i.length&&(n==e.length||e[n]>=i[r]))s=i[r++],l=i[r++];else if(n<e.length)s=e[n++],l=e[n++];else return t;!t.length||t[t.length-1]<s?t.push(s,l):t[t.length-1]<l&&(t[t.length-1]=l)}}function Zd(i,e,t){var r;let n,s,l;return t?(n=e.changes,s=qe.empty(e.changes.length),l=i.changes.compose(e.changes)):(n=e.changes.map(i.changes),s=i.changes.mapDesc(e.changes,!0),l=i.changes.compose(n)),{changes:l,selection:e.selection?e.selection.map(s):(r=i.selection)===null||r===void 0?void 0:r.map(n),effects:pe.mapEffects(i.effects,n).concat(pe.mapEffects(e.effects,s)),annotations:i.annotations.length?i.annotations.concat(e.annotations):e.annotations,scrollIntoView:i.scrollIntoView||e.scrollIntoView}}function Hl(i,e,t){let r=e.selection,n=gr(e.annotations);return e.userEvent&&(n=n.concat(ze.userEvent.of(e.userEvent))),{changes:e.changes instanceof qe?e.changes:qe.of(e.changes||[],t,i.facet(Gd)),selection:r&&(r instanceof G?r:G.single(r.anchor,r.head)),effects:gr(e.effects),annotations:n,scrollIntoView:!!e.scrollIntoView}}function ep(i,e,t){let r=Hl(i,e.length?e[0]:{},i.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let s=1;s<e.length;s++){e[s].filter===!1&&(t=!1);let l=!!e[s].sequential;r=Zd(r,Hl(i,e[s],l?r.changes.newLength:i.doc.length),l)}let n=ze.create(i,r.changes,r.selection,r.effects,r.annotations,r.scrollIntoView);return Yw(t?Jw(n):n)}function Jw(i){let e=i.startState,t=!0;for(let n of e.facet(Xd)){let s=n(i);if(s===!1){t=!1;break}Array.isArray(s)&&(t=t===!0?s:Xw(t,s))}if(t!==!0){let n,s;if(t===!1)s=i.changes.invertedDesc,n=qe.empty(e.doc.length);else{let l=i.changes.filter(t);n=l.changes,s=l.filtered.mapDesc(l.changes).invertedDesc}i=ze.create(e,n,i.selection&&i.selection.map(s),pe.mapEffects(i.effects,s),i.annotations,i.scrollIntoView)}let r=e.facet(Jd);for(let n=r.length-1;n>=0;n--){let s=r[n](i);s instanceof ze?i=s:Array.isArray(s)&&s.length==1&&s[0]instanceof ze?i=s[0]:i=ep(e,gr(s),!1)}return i}function Yw(i){let e=i.startState,t=e.facet(Yd),r=i;for(let n=t.length-1;n>=0;n--){let s=t[n](i);s&&Object.keys(s).length&&(r=Zd(r,Hl(e,s,i.changes.newLength),!0))}return r==i?i:ze.create(e,i.changes,i.selection,r.effects,r.annotations,r.scrollIntoView)}const Qw=[];function gr(i){return i==null?Qw:Array.isArray(i)?i:[i]}var Ne=(function(i){return i[i.Word=0]="Word",i[i.Space=1]="Space",i[i.Other=2]="Other",i})(Ne||(Ne={}));const Zw=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let jl;try{jl=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function eS(i){if(jl)return jl.test(i);for(let e=0;e<i.length;e++){let t=i[e];if(/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||Zw.test(t)))return!0}return!1}function tS(i){return e=>{if(!/\S/.test(e))return Ne.Space;if(eS(e))return Ne.Word;for(let t=0;t<i.length;t++)if(e.indexOf(i[t])>-1)return Ne.Word;return Ne.Other}}class Ce{constructor(e,t,r,n,s,l){this.config=e,this.doc=t,this.selection=r,this.values=n,this.status=e.statusTemplate.slice(),this.computeSlot=s,l&&(l._state=this);for(let o=0;o<this.config.dynamicSlots.length;o++)rn(this,o<<1);this.computeSlot=null}field(e,t=!0){let r=this.config.address[e.id];if(r==null){if(t)throw new RangeError("Field is not present in this state");return}return rn(this,r),As(this,r)}update(...e){return ep(this,e,!0)}applyTransaction(e){let t=this.config,{base:r,compartments:n}=t;for(let o of e.effects)o.is(ro.reconfigure)?(t&&(n=new Map,t.compartments.forEach((a,c)=>n.set(c,a)),t=null),n.set(o.value.compartment,o.value.extension)):o.is(pe.reconfigure)?(t=null,r=o.value):o.is(pe.appendConfig)&&(t=null,r=gr(r).concat(o.value));let s;t?s=e.startState.values.slice():(t=Es.resolve(r,n,this),s=new Ce(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(a,c)=>c.reconfigure(a,this),null).values);let l=e.startState.facet(Fl)?e.newSelection:e.newSelection.asSingle();new Ce(t,e.newDoc,l,s,(o,a)=>a.update(o,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:G.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,r=e(t.ranges[0]),n=this.changes(r.changes),s=[r.range],l=gr(r.effects);for(let o=1;o<t.ranges.length;o++){let a=e(t.ranges[o]),c=this.changes(a.changes),u=c.map(n);for(let f=0;f<o;f++)s[f]=s[f].map(u);let h=n.mapDesc(c,!0);s.push(a.range.map(h)),n=n.compose(u),l=pe.mapEffects(l,u).concat(pe.mapEffects(gr(a.effects),h))}return{changes:n,selection:G.create(s,t.mainIndex),effects:l}}changes(e=[]){return e instanceof qe?e:qe.of(e,this.doc.length,this.facet(Ce.lineSeparator))}toText(e){return Ae.of(e.split(this.facet(Ce.lineSeparator)||Bl))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(rn(this,t),As(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let r in e){let n=e[r];n instanceof et&&this.config.address[n.id]!=null&&(t[r]=n.spec.toJSON(this.field(e[r]),this))}return t}static fromJSON(e,t={},r){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(r){for(let s in r)if(Object.prototype.hasOwnProperty.call(e,s)){let l=r[s],o=e[s];n.push(l.init(a=>l.spec.fromJSON(o,a)))}}return Ce.create({doc:e.doc,selection:G.fromJSON(e.selection),extensions:t.extensions?n.concat([t.extensions]):n})}static create(e={}){let t=Es.resolve(e.extensions||[],new Map),r=e.doc instanceof Ae?e.doc:Ae.of((e.doc||"").split(t.staticFacet(Ce.lineSeparator)||Bl)),n=e.selection?e.selection instanceof G?e.selection:G.single(e.selection.anchor,e.selection.head):G.single(0);return Vd(n,r.length),t.staticFacet(Fl)||(n=n.asSingle()),new Ce(t,r,n,t.dynamicSlots.map(()=>null),(s,l)=>l.create(s),null)}get tabSize(){return this.facet(Ce.tabSize)}get lineBreak(){return this.facet(Ce.lineSeparator)||`
`}get readOnly(){return this.facet(Qd)}phrase(e,...t){for(let r of this.facet(Ce.phrases))if(Object.prototype.hasOwnProperty.call(r,e)){e=r[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,(r,n)=>{if(n=="$")return"$";let s=+(n||1);return!s||s>t.length?r:t[s-1]})),e}languageDataAt(e,t,r=-1){let n=[];for(let s of this.facet(Kd))for(let l of s(this,t,r))Object.prototype.hasOwnProperty.call(l,e)&&n.push(l[e]);return n}charCategorizer(e){let t=this.languageDataAt("wordChars",e);return tS(t.length?t[0]:"")}wordAt(e){let{text:t,from:r,length:n}=this.doc.lineAt(e),s=this.charCategorizer(e),l=e-r,o=e-r;for(;l>0;){let a=Ke(t,l,!1);if(s(t.slice(a,l))!=Ne.Word)break;l=a}for(;o<n;){let a=Ke(t,o);if(s(t.slice(o,a))!=Ne.Word)break;o=a}return l==o?null:G.range(l+r,o+r)}}Ce.allowMultipleSelections=Fl;Ce.tabSize=oe.define({combine:i=>i.length?i[0]:4});Ce.lineSeparator=Gd;Ce.readOnly=Qd;Ce.phrases=oe.define({compare(i,e){let t=Object.keys(i),r=Object.keys(e);return t.length==r.length&&t.every(n=>i[n]==e[n])}});Ce.languageData=Kd;Ce.changeFilter=Xd;Ce.transactionFilter=Jd;Ce.transactionExtender=Yd;ro.reconfigure=pe.define();function Ni(i,e,t={}){let r={};for(let n of i)for(let s of Object.keys(n)){let l=n[s],o=r[s];if(o===void 0)r[s]=l;else if(!(o===l||l===void 0))if(Object.hasOwnProperty.call(t,s))r[s]=t[s](o,l);else throw new Error("Config merge conflict for field "+s)}for(let n in e)r[n]===void 0&&(r[n]=e[n]);return r}class Mi{eq(e){return this==e}range(e,t=e){return zl.create(e,t,this)}}Mi.prototype.startSide=Mi.prototype.endSide=0;Mi.prototype.point=!1;Mi.prototype.mapMode=Qe.TrackDel;function Ka(i,e){return i==e||i.constructor==e.constructor&&i.eq(e)}let zl=class tp{constructor(e,t,r){this.from=e,this.to=t,this.value=r}static create(e,t,r){return new tp(e,t,r)}};function Wl(i,e){return i.from-e.from||i.value.startSide-e.value.startSide}class Ga{constructor(e,t,r,n){this.from=e,this.to=t,this.value=r,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(e,t,r,n=0){let s=r?this.to:this.from;for(let l=n,o=s.length;;){if(l==o)return l;let a=l+o>>1,c=s[a]-e||(r?this.value[a].endSide:this.value[a].startSide)-t;if(a==l)return c>=0?l:o;c>=0?o=a:l=a+1}}between(e,t,r,n){for(let s=this.findIndex(t,-1e9,!0),l=this.findIndex(r,1e9,!1,s);s<l;s++)if(n(this.from[s]+e,this.to[s]+e,this.value[s])===!1)return!1}map(e,t){let r=[],n=[],s=[],l=-1,o=-1;for(let a=0;a<this.value.length;a++){let c=this.value[a],u=this.from[a]+e,h=this.to[a]+e,f,d;if(u==h){let _=t.mapPos(u,c.startSide,c.mapMode);if(_==null||(f=d=_,c.startSide!=c.endSide&&(d=t.mapPos(u,c.endSide),d<f)))continue}else if(f=t.mapPos(u,c.startSide),d=t.mapPos(h,c.endSide),f>d||f==d&&c.startSide>0&&c.endSide<=0)continue;(d-f||c.endSide-c.startSide)<0||(l<0&&(l=f),c.point&&(o=Math.max(o,d-f)),r.push(c),n.push(f-l),s.push(d-l))}return{mapped:r.length?new Ga(n,s,r,o):null,pos:l}}}class ye{constructor(e,t,r,n){this.chunkPos=e,this.chunk=t,this.nextLayer=r,this.maxPoint=n}static create(e,t,r,n){return new ye(e,t,r,n)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:r=!1,filterFrom:n=0,filterTo:s=this.length}=e,l=e.filter;if(t.length==0&&!l)return this;if(r&&(t=t.slice().sort(Wl)),this.isEmpty)return t.length?ye.of(t):this;let o=new ip(this,null,-1).goto(0),a=0,c=[],u=new Li;for(;o.value||a<t.length;)if(a<t.length&&(o.from-t[a].from||o.startSide-t[a].value.startSide)>=0){let h=t[a++];u.addInner(h.from,h.to,h.value)||c.push(h)}else o.rangeIndex==1&&o.chunkIndex<this.chunk.length&&(a==t.length||this.chunkEnd(o.chunkIndex)<t[a].from)&&(!l||n>this.chunkEnd(o.chunkIndex)||s<this.chunkPos[o.chunkIndex])&&u.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!l||n>o.to||s<o.from||l(o.from,o.to,o.value))&&(u.addInner(o.from,o.to,o.value)||c.push(zl.create(o.from,o.to,o.value))),o.next());return u.finishInner(this.nextLayer.isEmpty&&!c.length?ye.empty:this.nextLayer.update({add:c,filter:l,filterFrom:n,filterTo:s}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],r=[],n=-1;for(let l=0;l<this.chunk.length;l++){let o=this.chunkPos[l],a=this.chunk[l],c=e.touchesRange(o,o+a.length);if(c===!1)n=Math.max(n,a.maxPoint),t.push(a),r.push(e.mapPos(o));else if(c===!0){let{mapped:u,pos:h}=a.map(o,e);u&&(n=Math.max(n,u.maxPoint),t.push(u),r.push(h))}}let s=this.nextLayer.map(e);return t.length==0?s:new ye(r,t,s||ye.empty,n)}between(e,t,r){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let s=this.chunkPos[n],l=this.chunk[n];if(t>=s&&e<=s+l.length&&l.between(s,e-s,t-s,r)===!1)return}this.nextLayer.between(e,t,r)}}iter(e=0){return un.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return un.from(e).goto(t)}static compare(e,t,r,n,s=-1){let l=e.filter(h=>h.maxPoint>0||!h.isEmpty&&h.maxPoint>=s),o=t.filter(h=>h.maxPoint>0||!h.isEmpty&&h.maxPoint>=s),a=Ih(l,o,r),c=new Vr(l,a,s),u=new Vr(o,a,s);r.iterGaps((h,f,d)=>Nh(c,h,u,f,d,n)),r.empty&&r.length==0&&Nh(c,0,u,0,0,n)}static eq(e,t,r=0,n){n==null&&(n=999999999);let s=e.filter(u=>!u.isEmpty&&t.indexOf(u)<0),l=t.filter(u=>!u.isEmpty&&e.indexOf(u)<0);if(s.length!=l.length)return!1;if(!s.length)return!0;let o=Ih(s,l),a=new Vr(s,o,0).goto(r),c=new Vr(l,o,0).goto(r);for(;;){if(a.to!=c.to||!$l(a.active,c.active)||a.point&&(!c.point||!Ka(a.point,c.point)))return!1;if(a.to>n)return!0;a.next(),c.next()}}static spans(e,t,r,n,s=-1){let l=new Vr(e,null,s).goto(t),o=t,a=l.openStart;for(;;){let c=Math.min(l.to,r);if(l.point){let u=l.activeForPoint(l.to),h=l.pointFrom<t?u.length+1:l.point.startSide<0?u.length:Math.min(u.length,a);n.point(o,c,l.point,u,h,l.pointRank),a=Math.min(l.openEnd(c),u.length)}else c>o&&(n.span(o,c,l.active,a),a=l.openEnd(c));if(l.to>r)return a+(l.point&&l.to>r?1:0);o=l.to,l.next()}}static of(e,t=!1){let r=new Li;for(let n of e instanceof zl?[e]:t?iS(e):e)r.add(n.from,n.to,n.value);return r.finish()}static join(e){if(!e.length)return ye.empty;let t=e[e.length-1];for(let r=e.length-2;r>=0;r--)for(let n=e[r];n!=ye.empty;n=n.nextLayer)t=new ye(n.chunkPos,n.chunk,t,Math.max(n.maxPoint,t.maxPoint));return t}}ye.empty=new ye([],[],null,-1);function iS(i){if(i.length>1)for(let e=i[0],t=1;t<i.length;t++){let r=i[t];if(Wl(e,r)>0)return i.slice().sort(Wl);e=r}return i}ye.empty.nextLayer=ye.empty;class Li{finishChunk(e){this.chunks.push(new Ga(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,t,r){this.addInner(e,t,r)||(this.nextLayer||(this.nextLayer=new Li)).add(e,t,r)}addInner(e,t,r){let n=e-this.lastTo||r.startSide-this.last.endSide;if(n<=0&&(e-this.lastFrom||r.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return n<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=r,this.lastFrom=e,this.lastTo=t,this.value.push(r),r.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let r=t.value.length-1;return this.last=t.value[r],this.lastFrom=t.from[r]+e,this.lastTo=t.to[r]+e,!0}finish(){return this.finishInner(ye.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=ye.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function Ih(i,e,t){let r=new Map;for(let s of i)for(let l=0;l<s.chunk.length;l++)s.chunk[l].maxPoint<=0&&r.set(s.chunk[l],s.chunkPos[l]);let n=new Set;for(let s of e)for(let l=0;l<s.chunk.length;l++){let o=r.get(s.chunk[l]);o!=null&&(t?t.mapPos(o):o)==s.chunkPos[l]&&!(t!=null&&t.touchesRange(o,o+s.chunk[l].length))&&n.add(s.chunk[l])}return n}class ip{constructor(e,t,r,n=0){this.layer=e,this.skip=t,this.minPoint=r,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,r){for(;this.chunkIndex<this.layer.chunk.length;){let n=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(n)||this.layer.chunkEnd(this.chunkIndex)<e||n.maxPoint<this.minPoint))break;this.chunkIndex++,r=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!r||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],r=e+t.from[this.rangeIndex];if(this.from=r,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class un{constructor(e){this.heap=e}static from(e,t=null,r=-1){let n=[];for(let s=0;s<e.length;s++)for(let l=e[s];!l.isEmpty;l=l.nextLayer)l.maxPoint>=r&&n.push(new ip(l,t,r,s));return n.length==1?n[0]:new un(n)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let r of this.heap)r.goto(e,t);for(let r=this.heap.length>>1;r>=0;r--)Uo(this.heap,r);return this.next(),this}forward(e,t){for(let r of this.heap)r.forward(e,t);for(let r=this.heap.length>>1;r>=0;r--)Uo(this.heap,r);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),Uo(this.heap,0)}}}function Uo(i,e){for(let t=i[e];;){let r=(e<<1)+1;if(r>=i.length)break;let n=i[r];if(r+1<i.length&&n.compare(i[r+1])>=0&&(n=i[r+1],r++),t.compare(n)<0)break;i[r]=t,i[e]=n,e=r}}class Vr{constructor(e,t,r){this.minPoint=r,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=un.from(e,t,r)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){Un(this.active,e),Un(this.activeTo,e),Un(this.activeRank,e),this.minActive=Fh(this.active,this.activeTo)}addActive(e){let t=0,{value:r,to:n,rank:s}=this.cursor;for(;t<this.activeRank.length&&(s-this.activeRank[t]||n-this.activeTo[t])>0;)t++;Vn(this.active,t,r),Vn(this.activeTo,t,n),Vn(this.activeRank,t,s),e&&Vn(e,t,this.cursor.from),this.minActive=Fh(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let r=this.openStart<0?[]:null;for(;;){let n=this.minActive;if(n>-1&&(this.activeTo[n]-this.cursor.from||this.active[n].endSide-this.cursor.startSide)<0){if(this.activeTo[n]>e){this.to=this.activeTo[n],this.endSide=this.active[n].endSide;break}this.removeActive(n),r&&Un(r,n)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let s=this.cursor.value;if(!s.point)this.addActive(r),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=s,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=s.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(r){this.openStart=0;for(let n=r.length-1;n>=0&&r[n]<e;n--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let r=this.active.length-1;r>=0&&!(this.activeRank[r]<this.pointRank);r--)(this.activeTo[r]>e||this.activeTo[r]==e&&this.active[r].endSide>=this.point.endSide)&&t.push(this.active[r]);return t.reverse()}openEnd(e){let t=0;for(let r=this.activeTo.length-1;r>=0&&this.activeTo[r]>e;r--)t++;return t}}function Nh(i,e,t,r,n,s){i.goto(e),t.goto(r);let l=r+n,o=r,a=r-e,c=!!s.boundChange;for(let u=!1;;){let h=i.to+a-t.to,f=h||i.endSide-t.endSide,d=f<0?i.to+a:t.to,_=Math.min(d,l);if(i.point||t.point?(i.point&&t.point&&Ka(i.point,t.point)&&$l(i.activeForPoint(i.to),t.activeForPoint(t.to))||s.comparePoint(o,_,i.point,t.point),u=!1):(u&&s.boundChange(o),_>o&&!$l(i.active,t.active)&&s.compareRange(o,_,i.active,t.active),c&&_<l&&(h||i.openEnd(d)!=t.openEnd(d))&&(u=!0)),d>l)break;o=d,f<=0&&i.next(),f>=0&&t.next()}}function $l(i,e){if(i.length!=e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!=e[t]&&!Ka(i[t],e[t]))return!1;return!0}function Un(i,e){for(let t=e,r=i.length-1;t<r;t++)i[t]=i[t+1];i.pop()}function Vn(i,e,t){for(let r=i.length-1;r>=e;r--)i[r+1]=i[r];i[e]=t}function Fh(i,e){let t=-1,r=1e9;for(let n=0;n<e.length;n++)(e[n]-r||i[n].endSide-i[t].endSide)<0&&(t=n,r=e[n]);return t}function no(i,e,t=i.length){let r=0;for(let n=0;n<t&&n<i.length;)i.charCodeAt(n)==9?(r+=e-r%e,n++):(r++,n=Ke(i,n));return r}function rS(i,e,t,r){for(let n=0,s=0;;){if(s>=e)return n;if(n==i.length)break;s+=i.charCodeAt(n)==9?t-s%t:1,n=Ke(i,n)}return i.length}const Ul="",Hh=typeof Symbol>"u"?"__"+Ul:Symbol.for(Ul),Vl=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),jh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class Ti{constructor(e,t){this.rules=[];let{finish:r}=t||{};function n(l){return/^@/.test(l)?[l]:l.split(/,\s*/)}function s(l,o,a,c){let u=[],h=/^@(\w+)\b/.exec(l[0]),f=h&&h[1]=="keyframes";if(h&&o==null)return a.push(l[0]+";");for(let d in o){let _=o[d];if(/&/.test(d))s(d.split(/,\s*/).map(y=>l.map(p=>y.replace(/&/,p))).reduce((y,p)=>y.concat(p)),_,a);else if(_&&typeof _=="object"){if(!h)throw new RangeError("The value of a property ("+d+") should be a primitive value.");s(n(d),_,u,f)}else _!=null&&u.push(d.replace(/_.*/,"").replace(/[A-Z]/g,y=>"-"+y.toLowerCase())+": "+_+";")}(u.length||f)&&a.push((r&&!h&&!c?l.map(r):l).join(", ")+" {"+u.join(" ")+"}")}for(let l in e)s(n(l),e[l],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=jh[Hh]||1;return jh[Hh]=e+1,Ul+e.toString(36)}static mount(e,t,r){let n=e[Vl],s=r&&r.nonce;n?s&&n.setNonce(s):n=new nS(e,s),n.mount(Array.isArray(t)?t:[t],e)}}let zh=new Map;class nS{constructor(e,t){let r=e.ownerDocument||e,n=r.defaultView;if(!e.head&&e.adoptedStyleSheets&&n.CSSStyleSheet){let s=zh.get(r);if(s)return e[Vl]=s;this.sheet=new n.CSSStyleSheet,zh.set(r,this)}else this.styleTag=r.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);this.modules=[],e[Vl]=this}mount(e,t){let r=this.sheet,n=0,s=0;for(let l=0;l<e.length;l++){let o=e[l],a=this.modules.indexOf(o);if(a<s&&a>-1&&(this.modules.splice(a,1),s--,a=-1),a==-1){if(this.modules.splice(s++,0,o),r)for(let c=0;c<o.rules.length;c++)r.insertRule(o.rules[c],n++)}else{for(;s<a;)n+=this.modules[s++].rules.length;n+=o.rules.length,s++}}if(r)t.adoptedStyleSheets.indexOf(this.sheet)<0&&(t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets]);else{let l="";for(let a=0;a<this.modules.length;a++)l+=this.modules[a].getRules()+`
`;this.styleTag.textContent=l;let o=t.head||t;this.styleTag.parentNode!=o&&o.insertBefore(this.styleTag,o.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}var Ri={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},fn={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},sS=typeof navigator<"u"&&/Mac/.test(navigator.platform),oS=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Ye=0;Ye<10;Ye++)Ri[48+Ye]=Ri[96+Ye]=String(Ye);for(var Ye=1;Ye<=24;Ye++)Ri[Ye+111]="F"+Ye;for(var Ye=65;Ye<=90;Ye++)Ri[Ye]=String.fromCharCode(Ye+32),fn[Ye]=String.fromCharCode(Ye);for(var Vo in Ri)fn.hasOwnProperty(Vo)||(fn[Vo]=Ri[Vo]);function lS(i){var e=sS&&i.metaKey&&i.shiftKey&&!i.ctrlKey&&!i.altKey||oS&&i.shiftKey&&i.key&&i.key.length==1||i.key=="Unidentified",t=!e&&i.key||(i.shiftKey?fn:Ri)[i.keyCode]||i.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}function Me(){var i=arguments[0];typeof i=="string"&&(i=document.createElement(i));var e=1,t=arguments[1];if(t&&typeof t=="object"&&t.nodeType==null&&!Array.isArray(t)){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=t[r];typeof n=="string"?i.setAttribute(r,n):n!=null&&(i[r]=n)}e++}for(;e<arguments.length;e++)rp(i,arguments[e]);return i}function rp(i,e){if(typeof e=="string")i.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)i.appendChild(e);else if(Array.isArray(e))for(var t=0;t<e.length;t++)rp(i,e[t]);else throw new RangeError("Unsupported child node: "+e)}let ut=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},ql=typeof document<"u"?document:{documentElement:{style:{}}};const Kl=/Edge\/(\d+)/.exec(ut.userAgent),np=/MSIE \d/.test(ut.userAgent),Gl=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ut.userAgent),so=!!(np||Gl||Kl),Wh=!so&&/gecko\/(\d+)/i.test(ut.userAgent),qo=!so&&/Chrome\/(\d+)/.exec(ut.userAgent),aS="webkitFontSmoothing"in ql.documentElement.style,Xl=!so&&/Apple Computer/.test(ut.vendor),$h=Xl&&(/Mobile\/\w+/.test(ut.userAgent)||ut.maxTouchPoints>2);var ne={mac:$h||/Mac/.test(ut.platform),windows:/Win/.test(ut.platform),linux:/Linux|X11/.test(ut.platform),ie:so,ie_version:np?ql.documentMode||6:Gl?+Gl[1]:Kl?+Kl[1]:0,gecko:Wh,gecko_version:Wh?+(/Firefox\/(\d+)/.exec(ut.userAgent)||[0,0])[1]:0,chrome:!!qo,chrome_version:qo?+qo[1]:0,ios:$h,android:/Android\b/.test(ut.userAgent),webkit_version:aS?+(/\bAppleWebKit\/(\d+)/.exec(ut.userAgent)||[0,0])[1]:0,safari:Xl,safari_version:Xl?+(/\bVersion\/(\d+(\.\d+)?)/.exec(ut.userAgent)||[0,0])[1]:0,tabSize:ql.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};function Xa(i,e){for(let t in i)t=="class"&&e.class?e.class+=" "+i.class:t=="style"&&e.style?e.style+=";"+i.style:e[t]=i[t];return e}const Ds=Object.create(null);function Ja(i,e,t){if(i==e)return!0;i||(i=Ds),e||(e=Ds);let r=Object.keys(i),n=Object.keys(e);if(r.length-0!=n.length-0)return!1;for(let s of r)if(s!=t&&(n.indexOf(s)==-1||i[s]!==e[s]))return!1;return!0}function cS(i,e){for(let t=i.attributes.length-1;t>=0;t--){let r=i.attributes[t].name;e[r]==null&&i.removeAttribute(r)}for(let t in e){let r=e[t];t=="style"?i.style.cssText=r:i.getAttribute(t)!=r&&i.setAttribute(t,r)}}function Uh(i,e,t){let r=!1;if(e)for(let n in e)t&&n in t||(r=!0,n=="style"?i.style.cssText="":i.removeAttribute(n));if(t)for(let n in t)e&&e[n]==t[n]||(r=!0,n=="style"?i.style.cssText=t[n]:i.setAttribute(n,t[n]));return r}function hS(i){let e=Object.create(null);for(let t=0;t<i.attributes.length;t++){let r=i.attributes[t];e[r.name]=r.value}return e}class Fi{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,r){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var bt=(function(i){return i[i.Text=0]="Text",i[i.WidgetBefore=1]="WidgetBefore",i[i.WidgetAfter=2]="WidgetAfter",i[i.WidgetRange=3]="WidgetRange",i})(bt||(bt={}));class he extends Mi{constructor(e,t,r,n){super(),this.startSide=e,this.endSide=t,this.widget=r,this.spec=n}get heightRelevant(){return!1}static mark(e){return new Tn(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),r=!!e.block;return t+=r&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new er(e,t,t,r,e.widget||null,!1)}static replace(e){let t=!!e.block,r,n;if(e.isBlockGap)r=-5e8,n=4e8;else{let{start:s,end:l}=sp(e,t);r=(s?t?-3e8:-1:5e8)-1,n=(l?t?2e8:1:-6e8)+1}return new er(e,r,n,t,e.widget||null,!0)}static line(e){return new Rn(e)}static set(e,t=!1){return ye.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}he.none=ye.empty;class Tn extends he{constructor(e){let{start:t,end:r}=sp(e);super(t?-1:5e8,r?1:-6e8,null,e),this.tagName=e.tagName||"span",this.attrs=e.class&&e.attributes?Xa(e.attributes,{class:e.class}):e.class?{class:e.class}:e.attributes||Ds}eq(e){return this==e||e instanceof Tn&&this.tagName==e.tagName&&Ja(this.attrs,e.attrs)}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}Tn.prototype.point=!1;class Rn extends he{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof Rn&&this.spec.class==e.spec.class&&Ja(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}Rn.prototype.mapMode=Qe.TrackBefore;Rn.prototype.point=!0;class er extends he{constructor(e,t,r,n,s,l){super(t,r,s,e),this.block=n,this.isReplace=l,this.mapMode=n?t<=0?Qe.TrackBefore:Qe.TrackAfter:Qe.TrackDel}get type(){return this.startSide!=this.endSide?bt.WidgetRange:this.startSide<=0?bt.WidgetBefore:bt.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof er&&uS(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}er.prototype.point=!0;function sp(i,e=!1){let{inclusiveStart:t,inclusiveEnd:r}=i;return t==null&&(t=i.inclusive),r==null&&(r=i.inclusive),{start:t??e,end:r??e}}function uS(i,e){return i==e||!!(i&&e&&i.compare(e))}function vr(i,e,t,r=0){let n=t.length-1;n>=0&&t[n]+r>=i?t[n]=Math.max(t[n],e):t.push(i,e)}class dn extends Mi{constructor(e,t){super(),this.tagName=e,this.attributes=t}eq(e){return e==this||e instanceof dn&&this.tagName==e.tagName&&Ja(this.attributes,e.attributes)}static create(e){return new dn(e.tagName,e.attributes||Ds)}static set(e,t=!1){return ye.of(e,t)}}dn.prototype.startSide=dn.prototype.endSide=-1;function Cr(i){let e;return i.nodeType==11?e=i.getSelection?i:i.ownerDocument:e=i,e.getSelection()}function Jl(i,e){return e?i==e||i.contains(e.nodeType!=1?e.parentNode:e):!1}function nn(i,e){if(!e.anchorNode)return!1;try{return Jl(i,e.anchorNode)}catch{return!1}}function vs(i){return i.nodeType==3?pn(i,0,i.nodeValue.length).getClientRects():i.nodeType==1?i.getClientRects():[]}function sn(i,e,t,r){return t?Vh(i,e,t,r,-1)||Vh(i,e,t,r,1):!1}function Bi(i){for(var e=0;;e++)if(i=i.previousSibling,!i)return e}function Ms(i){return i.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(i.nodeName)}function Vh(i,e,t,r,n){for(;;){if(i==t&&e==r)return!0;if(e==(n<0?0:di(i))){if(i.nodeName=="DIV")return!1;let s=i.parentNode;if(!s||s.nodeType!=1)return!1;e=Bi(i)+(n<0?0:1),i=s}else if(i.nodeType==1){if(i=i.childNodes[e+(n<0?-1:0)],i.nodeType==1&&i.contentEditable=="false")return!1;e=n<0?di(i):0}else return!1}}function di(i){return i.nodeType==3?i.nodeValue.length:i.childNodes.length}function Ls(i,e){let t=e?i.left:i.right;return{left:t,right:t,top:i.top,bottom:i.bottom}}function fS(i){let e=i.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:i.innerWidth,top:0,bottom:i.innerHeight}}function op(i,e){let t=e.width/i.offsetWidth,r=e.height/i.offsetHeight;return(t>.995&&t<1.005||!isFinite(t)||Math.abs(e.width-i.offsetWidth)<1)&&(t=1),(r>.995&&r<1.005||!isFinite(r)||Math.abs(e.height-i.offsetHeight)<1)&&(r=1),{scaleX:t,scaleY:r}}function dS(i,e,t,r,n,s,l,o){let a=i.ownerDocument,c=a.defaultView||window;for(let u=i,h=!1;u&&!h;)if(u.nodeType==1){let f,d=u==a.body,_=1,y=1;if(d)f=fS(c);else{if(/^(fixed|sticky)$/.test(getComputedStyle(u).position)&&(h=!0),u.scrollHeight<=u.clientHeight&&u.scrollWidth<=u.clientWidth){u=u.assignedSlot||u.parentNode;continue}let g=u.getBoundingClientRect();({scaleX:_,scaleY:y}=op(u,g)),f={left:g.left,right:g.left+u.clientWidth*_,top:g.top,bottom:g.top+u.clientHeight*y}}let p=0,m=0;if(n=="nearest")e.top<f.top?(m=e.top-(f.top+l),t>0&&e.bottom>f.bottom+m&&(m=e.bottom-f.bottom+l)):e.bottom>f.bottom&&(m=e.bottom-f.bottom+l,t<0&&e.top-m<f.top&&(m=e.top-(f.top+l)));else{let g=e.bottom-e.top,v=f.bottom-f.top;m=(n=="center"&&g<=v?e.top+g/2-v/2:n=="start"||n=="center"&&t<0?e.top-l:e.bottom-v+l)-f.top}if(r=="nearest"?e.left<f.left?(p=e.left-(f.left+s),t>0&&e.right>f.right+p&&(p=e.right-f.right+s)):e.right>f.right&&(p=e.right-f.right+s,t<0&&e.left<f.left+p&&(p=e.left-(f.left+s))):p=(r=="center"?e.left+(e.right-e.left)/2-(f.right-f.left)/2:r=="start"==o?e.left-s:e.right-(f.right-f.left)+s)-f.left,p||m)if(d)c.scrollBy(p,m);else{let g=0,v=0;if(m){let b=u.scrollTop;u.scrollTop+=m/y,v=(u.scrollTop-b)*y}if(p){let b=u.scrollLeft;u.scrollLeft+=p/_,g=(u.scrollLeft-b)*_}e={left:e.left-g,top:e.top-v,right:e.right-g,bottom:e.bottom-v},g&&Math.abs(g-p)<1&&(r="nearest"),v&&Math.abs(v-m)<1&&(n="nearest")}if(d)break;(e.top<f.top||e.bottom>f.bottom||e.left<f.left||e.right>f.right)&&(e={left:Math.max(e.left,f.left),right:Math.min(e.right,f.right),top:Math.max(e.top,f.top),bottom:Math.min(e.bottom,f.bottom)}),u=u.assignedSlot||u.parentNode}else if(u.nodeType==11)u=u.host;else break}function pS(i){let e=i.ownerDocument,t,r;for(let n=i.parentNode;n&&!(n==e.body||t&&r);)if(n.nodeType==1)!r&&n.scrollHeight>n.clientHeight&&(r=n),!t&&n.scrollWidth>n.clientWidth&&(t=n),n=n.assignedSlot||n.parentNode;else if(n.nodeType==11)n=n.host;else break;return{x:t,y:r}}class mS{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:r}=e;this.set(t,Math.min(e.anchorOffset,t?di(t):0),r,Math.min(e.focusOffset,r?di(r):0))}set(e,t,r,n){this.anchorNode=e,this.anchorOffset=t,this.focusNode=r,this.focusOffset=n}}let Vi=null;ne.safari&&ne.safari_version>=26&&(Vi=!1);function lp(i){if(i.setActive)return i.setActive();if(Vi)return i.focus(Vi);let e=[];for(let t=i;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(i.focus(Vi==null?{get preventScroll(){return Vi={preventScroll:!0},!0}}:void 0),!Vi){Vi=!1;for(let t=0;t<e.length;){let r=e[t++],n=e[t++],s=e[t++];r.scrollTop!=n&&(r.scrollTop=n),r.scrollLeft!=s&&(r.scrollLeft=s)}}}let qh;function pn(i,e,t=e){let r=qh||(qh=document.createRange());return r.setEnd(i,t),r.setStart(i,e),r}function _r(i,e,t,r){let n={key:e,code:e,keyCode:t,which:t,cancelable:!0};r&&({altKey:n.altKey,ctrlKey:n.ctrlKey,shiftKey:n.shiftKey,metaKey:n.metaKey}=r);let s=new KeyboardEvent("keydown",n);s.synthetic=!0,i.dispatchEvent(s);let l=new KeyboardEvent("keyup",n);return l.synthetic=!0,i.dispatchEvent(l),s.defaultPrevented||l.defaultPrevented}function gS(i){for(;i;){if(i&&(i.nodeType==9||i.nodeType==11&&i.host))return i;i=i.assignedSlot||i.parentNode}return null}function vS(i,e){let t=e.focusNode,r=e.focusOffset;if(!t||e.anchorNode!=t||e.anchorOffset!=r)return!1;for(r=Math.min(r,di(t));;)if(r){if(t.nodeType!=1)return!1;let n=t.childNodes[r-1];n.contentEditable=="false"?r--:(t=n,r=di(t))}else{if(t==i)return!0;r=Bi(t),t=t.parentNode}}function ap(i){return i.scrollTop>Math.max(1,i.scrollHeight-i.clientHeight-4)}function cp(i,e){for(let t=i,r=e;;){if(t.nodeType==3&&r>0)return{node:t,offset:r};if(t.nodeType==1&&r>0){if(t.contentEditable=="false")return null;t=t.childNodes[r-1],r=di(t)}else if(t.parentNode&&!Ms(t))r=Bi(t),t=t.parentNode;else return null}}function hp(i,e){for(let t=i,r=e;;){if(t.nodeType==3&&r<t.nodeValue.length)return{node:t,offset:r};if(t.nodeType==1&&r<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[r],r=0}else if(t.parentNode&&!Ms(t))r=Bi(t)+1,t=t.parentNode;else return null}}class zt{constructor(e,t,r=!0){this.node=e,this.offset=t,this.precise=r}static before(e,t){return new zt(e.parentNode,Bi(e),t)}static after(e,t){return new zt(e.parentNode,Bi(e)+1,t)}}var Fe=(function(i){return i[i.LTR=0]="LTR",i[i.RTL=1]="RTL",i})(Fe||(Fe={}));const tr=Fe.LTR,Ya=Fe.RTL;function up(i){let e=[];for(let t=0;t<i.length;t++)e.push(1<<+i[t]);return e}const _S=up("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),yS=up("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Yl=Object.create(null),Xt=[];for(let i of["()","[]","{}"]){let e=i.charCodeAt(0),t=i.charCodeAt(1);Yl[e]=t,Yl[t]=-e}function fp(i){return i<=247?_S[i]:1424<=i&&i<=1524?2:1536<=i&&i<=1785?yS[i-1536]:1774<=i&&i<=2220?4:8192<=i&&i<=8204?256:64336<=i&&i<=65023?4:1}const bS=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class ui{get dir(){return this.level%2?Ya:tr}constructor(e,t,r){this.from=e,this.to=t,this.level=r}side(e,t){return this.dir==t==e?this.to:this.from}forward(e,t){return e==(this.dir==t)}static find(e,t,r,n){let s=-1;for(let l=0;l<e.length;l++){let o=e[l];if(o.from<=t&&o.to>=t){if(o.level==r)return l;(s<0||(n!=0?n<0?o.from<t:o.to>t:e[s].level>o.level))&&(s=l)}}if(s<0)throw new RangeError("Index out of range");return s}}function dp(i,e){if(i.length!=e.length)return!1;for(let t=0;t<i.length;t++){let r=i[t],n=e[t];if(r.from!=n.from||r.to!=n.to||r.direction!=n.direction||!dp(r.inner,n.inner))return!1}return!0}const Le=[];function xS(i,e,t,r,n){for(let s=0;s<=r.length;s++){let l=s?r[s-1].to:e,o=s<r.length?r[s].from:t,a=s?256:n;for(let c=l,u=a,h=a;c<o;c++){let f=fp(i.charCodeAt(c));f==512?f=u:f==8&&h==4&&(f=16),Le[c]=f==4?2:f,f&7&&(h=f),u=f}for(let c=l,u=a,h=a;c<o;c++){let f=Le[c];if(f==128)c<o-1&&u==Le[c+1]&&u&24?f=Le[c]=u:Le[c]=256;else if(f==64){let d=c+1;for(;d<o&&Le[d]==64;)d++;let _=c&&u==8||d<t&&Le[d]==8?h==1?1:8:256;for(let y=c;y<d;y++)Le[y]=_;c=d-1}else f==8&&h==1&&(Le[c]=1);u=f,f&7&&(h=f)}}}function wS(i,e,t,r,n){let s=n==1?2:1;for(let l=0,o=0,a=0;l<=r.length;l++){let c=l?r[l-1].to:e,u=l<r.length?r[l].from:t;for(let h=c,f,d,_;h<u;h++)if(d=Yl[f=i.charCodeAt(h)])if(d<0){for(let y=o-3;y>=0;y-=3)if(Xt[y+1]==-d){let p=Xt[y+2],m=p&2?n:p&4?p&1?s:n:0;m&&(Le[h]=Le[Xt[y]]=m),o=y;break}}else{if(Xt.length==189)break;Xt[o++]=h,Xt[o++]=f,Xt[o++]=a}else if((_=Le[h])==2||_==1){let y=_==n;a=y?0:1;for(let p=o-3;p>=0;p-=3){let m=Xt[p+2];if(m&2)break;if(y)Xt[p+2]|=2;else{if(m&4)break;Xt[p+2]|=4}}}}}function SS(i,e,t,r){for(let n=0,s=r;n<=t.length;n++){let l=n?t[n-1].to:i,o=n<t.length?t[n].from:e;for(let a=l;a<o;){let c=Le[a];if(c==256){let u=a+1;for(;;)if(u==o){if(n==t.length)break;u=t[n++].to,o=n<t.length?t[n].from:e}else if(Le[u]==256)u++;else break;let h=s==1,f=(u<e?Le[u]:r)==1,d=h==f?h?1:2:r;for(let _=u,y=n,p=y?t[y-1].to:i;_>a;)_==p&&(_=t[--y].from,p=y?t[y-1].to:i),Le[--_]=d;a=u}else s=c,a++}}}function Ql(i,e,t,r,n,s,l){let o=r%2?2:1;if(r%2==n%2)for(let a=e,c=0;a<t;){let u=!0,h=!1;if(c==s.length||a<s[c].from){let y=Le[a];y!=o&&(u=!1,h=y==16)}let f=!u&&o==1?[]:null,d=u?r:r+1,_=a;e:for(;;)if(c<s.length&&_==s[c].from){if(h)break e;let y=s[c];if(!u)for(let p=y.to,m=c+1;;){if(p==t)break e;if(m<s.length&&s[m].from==p)p=s[m++].to;else{if(Le[p]==o)break e;break}}if(c++,f)f.push(y);else{y.from>a&&l.push(new ui(a,y.from,d));let p=y.direction==tr!=!(d%2);Zl(i,p?r+1:r,n,y.inner,y.from,y.to,l),a=y.to}_=y.to}else{if(_==t||(u?Le[_]!=o:Le[_]==o))break;_++}f?Ql(i,a,_,r+1,n,f,l):a<_&&l.push(new ui(a,_,d)),a=_}else for(let a=t,c=s.length;a>e;){let u=!0,h=!1;if(!c||a>s[c-1].to){let y=Le[a-1];y!=o&&(u=!1,h=y==16)}let f=!u&&o==1?[]:null,d=u?r:r+1,_=a;e:for(;;)if(c&&_==s[c-1].to){if(h)break e;let y=s[--c];if(!u)for(let p=y.from,m=c;;){if(p==e)break e;if(m&&s[m-1].to==p)p=s[--m].from;else{if(Le[p-1]==o)break e;break}}if(f)f.push(y);else{y.to<a&&l.push(new ui(y.to,a,d));let p=y.direction==tr!=!(d%2);Zl(i,p?r+1:r,n,y.inner,y.from,y.to,l),a=y.from}_=y.from}else{if(_==e||(u?Le[_-1]!=o:Le[_-1]==o))break;_--}f?Ql(i,_,a,r+1,n,f,l):_<a&&l.push(new ui(_,a,d)),a=_}}function Zl(i,e,t,r,n,s,l){let o=e%2?2:1;xS(i,n,s,r,o),wS(i,n,s,r,o),SS(n,s,r,o),Ql(i,n,s,e,t,r,l)}function kS(i,e,t){if(!i)return[new ui(0,0,e==Ya?1:0)];if(e==tr&&!t.length&&!bS.test(i))return pp(i.length);if(t.length)for(;i.length>Le.length;)Le[Le.length]=256;let r=[],n=e==tr?0:1;return Zl(i,n,n,t,0,i.length,r),r}function pp(i){return[new ui(0,i,0)]}let mp="";function CS(i,e,t,r,n){var s;let l=r.head-i.from,o=ui.find(e,l,(s=r.bidiLevel)!==null&&s!==void 0?s:-1,r.assoc),a=e[o],c=a.side(n,t);if(l==c){let f=o+=n?1:-1;if(f<0||f>=e.length)return null;a=e[o=f],l=a.side(!n,t),c=a.side(n,t)}let u=Ke(i.text,l,a.forward(n,t));(u<a.from||u>a.to)&&(u=c),mp=i.text.slice(Math.min(l,u),Math.max(l,u));let h=o==(n?e.length-1:0)?null:e[o+(n?1:-1)];return h&&u==c&&h.level+(n?0:1)<a.level?G.cursor(h.side(!n,t)+i.from,h.forward(n,t)?1:-1,h.level):G.cursor(u+i.from,a.forward(n,t)?-1:1,a.level)}function ES(i,e,t){for(let r=e;r<t;r++){let n=fp(i.charCodeAt(r));if(n==1)return tr;if(n==2||n==4)return Ya}return tr}const gp=oe.define(),vp=oe.define(),_p=oe.define(),yp=oe.define(),ea=oe.define(),bp=oe.define(),xp=oe.define(),Qa=oe.define(),Za=oe.define(),wp=oe.define({combine:i=>i.some(e=>e)}),AS=oe.define({combine:i=>i.some(e=>e)}),Sp=oe.define();class yr{constructor(e,t="nearest",r="nearest",n=5,s=5,l=!1){this.range=e,this.y=t,this.x=r,this.yMargin=n,this.xMargin=s,this.isSnapshot=l}map(e){return e.empty?this:new yr(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new yr(G.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const qn=pe.define({map:(i,e)=>i.map(e)}),kp=pe.define();function _t(i,e,t){let r=i.facet(yp);r.length?r[0](e):window.onerror&&window.onerror(String(e),t,void 0,void 0,e)||(t?console.error(t+":",e):console.error(e))}const hi=oe.define({combine:i=>i.length?i[0]:!0});let DS=0;const hr=oe.define({combine(i){return i.filter((e,t)=>{for(let r=0;r<t;r++)if(i[r].plugin==e.plugin)return!1;return!0})}});class st{constructor(e,t,r,n,s){this.id=e,this.create=t,this.domEventHandlers=r,this.domEventObservers=n,this.baseExtensions=s(this),this.extension=this.baseExtensions.concat(hr.of({plugin:this,arg:void 0}))}of(e){return this.baseExtensions.concat(hr.of({plugin:this,arg:e}))}static define(e,t){const{eventHandlers:r,eventObservers:n,provide:s,decorations:l}=t||{};return new st(DS++,e,r,n,o=>{let a=[];return l&&a.push(oo.of(c=>{let u=c.plugin(o);return u?l(u):he.none})),s&&a.push(s(o)),a})}static fromClass(e,t){return st.define((r,n)=>new e(r,n),t)}}class Ko{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}get plugin(){return this.spec&&this.spec.plugin}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(r){if(_t(t.state,r,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.plugin.create(e,this.spec.arg)}catch(t){_t(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(r){_t(e.state,r,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Cp=oe.define(),ec=oe.define(),oo=oe.define(),Ep=oe.define(),tc=oe.define(),Bn=oe.define(),Ap=oe.define();function Kh(i,e){let t=i.state.facet(Ap);if(!t.length)return t;let r=t.map(s=>s instanceof Function?s(i):s),n=[];return ye.spans(r,e.from,e.to,{point(){},span(s,l,o,a){let c=s-e.from,u=l-e.from,h=n;for(let f=o.length-1;f>=0;f--,a--){let d=o[f].spec.bidiIsolate,_;if(d==null&&(d=ES(e.text,c,u)),a>0&&h.length&&(_=h[h.length-1]).to==c&&_.direction==d)_.to=u,h=_.inner;else{let y={from:c,to:u,direction:d,inner:[]};h.push(y),h=y.inner}}}}),n}const Dp=oe.define();function ic(i){let e=0,t=0,r=0,n=0;for(let s of i.state.facet(Dp)){let l=s(i);l&&(l.left!=null&&(e=Math.max(e,l.left)),l.right!=null&&(t=Math.max(t,l.right)),l.top!=null&&(r=Math.max(r,l.top)),l.bottom!=null&&(n=Math.max(n,l.bottom)))}return{left:e,right:t,top:r,bottom:n}}const Xr=oe.define();class Bt{constructor(e,t,r,n){this.fromA=e,this.toA=t,this.fromB=r,this.toB=n}join(e){return new Bt(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,r=this;for(;t>0;t--){let n=e[t-1];if(!(n.fromA>r.toA)){if(n.toA<r.fromA)break;r=r.join(n),e.splice(t-1,1)}}return e.splice(t,0,r),e}static extendWithRanges(e,t){if(t.length==0)return e;let r=[];for(let n=0,s=0,l=0;;){let o=n<e.length?e[n].fromB:1e9,a=s<t.length?t[s]:1e9,c=Math.min(o,a);if(c==1e9)break;let u=c+l,h=c,f=u;for(;;)if(s<t.length&&t[s]<=h){let d=t[s+1];s+=2,h=Math.max(h,d);for(let _=n;_<e.length&&e[_].fromB<=h;_++)l=e[_].toA-e[_].toB;f=Math.max(f,d+l)}else if(n<e.length&&e[n].fromB<=h){let d=e[n++];h=Math.max(h,d.toB),f=Math.max(f,d.toA),l=d.toA-d.toB}else break;r.push(new Bt(u,f,c,h))}return r}}class Ts{constructor(e,t,r){this.view=e,this.state=t,this.transactions=r,this.flags=0,this.startState=e.state,this.changes=qe.empty(this.startState.doc.length);for(let s of r)this.changes=this.changes.compose(s.changes);let n=[];this.changes.iterChangedRanges((s,l,o,a)=>n.push(new Bt(s,l,o,a))),this.changedRanges=n}static create(e,t,r){return new Ts(e,t,r)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}const MS=[];class $e{constructor(e,t,r=0){this.dom=e,this.length=t,this.flags=r,this.parent=null,e.cmTile=this}get breakAfter(){return this.flags&1}get children(){return MS}isWidget(){return!1}get isHidden(){return!1}isComposite(){return!1}isLine(){return!1}isText(){return!1}isBlock(){return!1}get domAttrs(){return null}sync(e){if(this.flags|=2,this.flags&4){this.flags&=-5;let t=this.domAttrs;t&&cS(this.dom,t)}}toString(){return this.constructor.name+(this.children.length?`(${this.children})`:"")+(this.breakAfter?"#":"")}destroy(){this.parent=null}setDOM(e){this.dom=e,e.cmTile=this}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e,t=this.posAtStart){let r=t;for(let n of this.children){if(n==e)return r;r+=n.length+n.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}covers(e){return!0}coordsIn(e,t){return null}domPosFor(e,t){let r=Bi(this.dom),n=this.length?e>0:t>0;return new zt(this.parent.dom,r+(n?1:0),e==0||e==this.length)}markDirty(e){this.flags&=-3,e&&(this.flags|=4),this.parent&&this.parent.flags&2&&this.parent.markDirty(!1)}get overrideDOMText(){return null}get root(){for(let e=this;e;e=e.parent)if(e instanceof ao)return e;return null}static get(e){return e.cmTile}}class lo extends $e{constructor(e){super(e,0),this._children=[]}isComposite(){return!0}get children(){return this._children}get lastChild(){return this.children.length?this.children[this.children.length-1]:null}append(e){this.children.push(e),e.parent=this}sync(e){if(this.flags&2)return;super.sync(e);let t=this.dom,r=null,n,s=(e==null?void 0:e.node)==t?e:null,l=0;for(let o of this.children){if(o.sync(e),l+=o.length+o.breakAfter,n=r?r.nextSibling:t.firstChild,s&&n!=o.dom&&(s.written=!0),o.dom.parentNode==t)for(;n&&n!=o.dom;)n=Gh(n);else t.insertBefore(o.dom,n);r=o.dom}for(n=r?r.nextSibling:t.firstChild,s&&n&&(s.written=!0);n;)n=Gh(n);this.length=l}}function Gh(i){let e=i.nextSibling;return i.parentNode.removeChild(i),e}class ao extends lo{constructor(e,t){super(t),this.view=e}owns(e){for(;e;e=e.parent)if(e==this)return!0;return!1}isBlock(){return!0}nearest(e){for(;;){if(!e)return null;let t=$e.get(e);if(t&&this.owns(t))return t;e=e.parentNode}}blockTiles(e){for(let t=[],r=this,n=0,s=0;;)if(n==r.children.length){if(!t.length)return;r=r.parent,r.breakAfter&&s++,n=t.pop()}else{let l=r.children[n++];if(l instanceof Ei)t.push(n),r=l,n=0;else{let o=s+l.length,a=e(l,s);if(a!==void 0)return a;s=o+l.breakAfter}}}resolveBlock(e,t){let r,n=-1,s,l=-1;if(this.blockTiles((o,a)=>{let c=a+o.length;if(e>=a&&e<=c){if(o.isWidget()&&t>=-1&&t<=1){if(o.flags&32)return!0;o.flags&16&&(r=void 0)}(a<e||e==c&&(t<-1?o.length:o.covers(1)))&&(!r||!o.isWidget()&&r.isWidget())&&(r=o,n=e-a),(c>e||e==a&&(t>1?o.length:o.covers(-1)))&&(!s||!o.isWidget()&&s.isWidget())&&(s=o,l=e-a)}}),!r&&!s)throw new Error("No tile at position "+e);return r&&t<0||!s?{tile:r,offset:n}:{tile:s,offset:l}}}class Ei extends lo{constructor(e,t){super(e),this.wrapper=t}isBlock(){return!0}covers(e){return this.children.length?e<0?this.children[0].covers(-1):this.lastChild.covers(1):!1}get domAttrs(){return this.wrapper.attributes}static of(e,t){let r=new Ei(t||document.createElement(e.tagName),e);return t||(r.flags|=4),r}}class Er extends lo{constructor(e,t){super(e),this.attrs=t}isLine(){return!0}static start(e,t,r){let n=new Er(t||document.createElement("div"),e);return(!t||!r)&&(n.flags|=4),n}get domAttrs(){return this.attrs}resolveInline(e,t,r){let n=null,s=-1,l=null,o=-1;function a(u,h){for(let f=0,d=0;f<u.children.length&&d<=h;f++){let _=u.children[f],y=d+_.length;y>=h&&(_.isComposite()?a(_,h-d):(!l||l.isHidden&&(t>0||r&&TS(l,_)))&&(y>h||_.flags&32)?(l=_,o=h-d):(d<h||_.flags&16&&!_.isHidden)&&(n=_,s=h-d)),d=y}}a(this,e);let c=(t<0?n:l)||n||l;return c?{tile:c,offset:c==n?s:o}:null}coordsIn(e,t){let r=this.resolveInline(e,t,!0);return r?r.tile.coordsIn(Math.max(0,r.offset),t):LS(this)}domIn(e,t){let r=this.resolveInline(e,t);if(r){let{tile:n,offset:s}=r;if(this.dom.contains(n.dom))return n.isText()?new zt(n.dom,Math.min(n.dom.nodeValue.length,s)):n.domPosFor(s,n.flags&16?1:n.flags&32?-1:t);let l=r.tile.parent,o=!1;for(let a of l.children){if(o)return new zt(a.dom,0);a==r.tile&&(o=!0)}}return new zt(this.dom,0)}}function LS(i){let e=i.dom.lastChild;if(!e)return i.dom.getBoundingClientRect();let t=vs(e);return t[t.length-1]||null}function TS(i,e){let t=i.coordsIn(0,1),r=e.coordsIn(0,1);return t&&r&&r.top<t.bottom}class vt extends lo{constructor(e,t){super(e),this.mark=t}get domAttrs(){return this.mark.attrs}static of(e,t){let r=new vt(t||document.createElement(e.tagName),e);return t||(r.flags|=4),r}}class Xi extends $e{constructor(e,t){super(e,t.length),this.text=t}sync(e){this.flags&2||(super.sync(e),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text))}isText(){return!0}toString(){return JSON.stringify(this.text)}coordsIn(e,t){let r=this.dom.nodeValue.length;e>r&&(e=r);let n=e,s=e,l=0;e==0&&t<0||e==r&&t>=0?ne.chrome||ne.gecko||(e?(n--,l=1):s<r&&(s++,l=-1)):t<0?n--:s<r&&s++;let o=pn(this.dom,n,s).getClientRects();if(!o.length)return null;let a=o[(l?l<0:t>=0)?0:o.length-1];return ne.safari&&!l&&a.width==0&&(a=Array.prototype.find.call(o,c=>c.width)||a),l?Ls(a,l<0):a||null}static of(e,t){let r=new Xi(t||document.createTextNode(e),e);return t||(r.flags|=2),r}}class ir extends $e{constructor(e,t,r,n){super(e,t,n),this.widget=r}isWidget(){return!0}get isHidden(){return this.widget.isHidden}covers(e){return this.flags&48?!1:(this.flags&(e<0?64:128))>0}coordsIn(e,t){return this.coordsInWidget(e,t,!1)}coordsInWidget(e,t,r){let n=this.widget.coordsAt(this.dom,e,t);if(n)return n;if(r)return Ls(this.dom.getBoundingClientRect(),this.length?e==0:t<=0);{let s=this.dom.getClientRects(),l=null;if(!s.length)return null;let o=this.flags&16?!0:this.flags&32?!1:e>0;for(let a=o?s.length-1:0;l=s[a],!(e>0?a==0:a==s.length-1||l.top<l.bottom);a+=o?-1:1);return Ls(l,!o)}}get overrideDOMText(){if(!this.length)return Ae.empty;let{root:e}=this;if(!e)return Ae.empty;let t=this.posAtStart;return e.view.state.doc.slice(t,t+this.length)}destroy(){super.destroy(),this.widget.destroy(this.dom)}static of(e,t,r,n,s){return s||(s=e.toDOM(t),e.editable||(s.contentEditable="false")),new ir(s,r,e,n)}}class Rs extends $e{constructor(e){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),super(t,0,e)}get isHidden(){return!0}get overrideDOMText(){return Ae.empty}coordsIn(e){return this.dom.getBoundingClientRect()}}class RS{constructor(e){this.index=0,this.beforeBreak=!1,this.parents=[],this.tile=e}advance(e,t,r){let{tile:n,index:s,beforeBreak:l,parents:o}=this;for(;e||t>0;)if(n.isComposite())if(l){if(!e)break;r&&r.break(),e--,l=!1}else if(s==n.children.length){if(!e&&!o.length)break;r&&r.leave(n),l=!!n.breakAfter,{tile:n,index:s}=o.pop(),s++}else{let a=n.children[s],c=a.breakAfter;(t>0?a.length<=e:a.length<e)&&(!r||r.skip(a,0,a.length)!==!1||!a.isComposite)?(l=!!c,s++,e-=a.length):(o.push({tile:n,index:s}),n=a,s=0,r&&a.isComposite()&&r.enter(a))}else if(s==n.length)l=!!n.breakAfter,{tile:n,index:s}=o.pop(),s++;else if(e){let a=Math.min(e,n.length-s);r&&r.skip(n,s,s+a),e-=a,s+=a}else break;return this.tile=n,this.index=s,this.beforeBreak=l,this}get root(){return this.parents.length?this.parents[0].tile:this.tile}}class BS{constructor(e,t,r,n){this.from=e,this.to=t,this.wrapper=r,this.rank=n}}class OS{constructor(e,t,r){this.cache=e,this.root=t,this.blockWrappers=r,this.curLine=null,this.lastBlock=null,this.afterWidget=null,this.pos=0,this.wrappers=[],this.wrapperPos=0}addText(e,t,r,n){var s;this.flushBuffer();let l=this.ensureMarks(t,r),o=l.lastChild;if(o&&o.isText()&&!(o.flags&8)&&o.length+e.length<512){this.cache.reused.set(o,2);let a=l.children[l.children.length-1]=new Xi(o.dom,o.text+e);a.parent=l}else l.append(n||Xi.of(e,(s=this.cache.find(Xi))===null||s===void 0?void 0:s.dom));this.pos+=e.length,this.afterWidget=null}addComposition(e,t){let r=this.curLine;r.dom!=t.line.dom&&(r.setDOM(this.cache.reused.has(t.line)?Go(t.line.dom):t.line.dom),this.cache.reused.set(t.line,2));let n=r;for(let o=t.marks.length-1;o>=0;o--){let a=t.marks[o],c=n.lastChild;if(c instanceof vt&&c.mark.eq(a.mark))c.dom!=a.dom&&c.setDOM(Go(a.dom)),n=c;else{if(this.cache.reused.get(a)){let h=$e.get(a.dom);h&&h.setDOM(Go(a.dom))}let u=vt.of(a.mark,a.dom);n.append(u),n=u}this.cache.reused.set(a,2)}let s=$e.get(e.text);s&&this.cache.reused.set(s,2);let l=new Xi(e.text,e.text.nodeValue);l.flags|=8,n.append(l)}addInlineWidget(e,t,r){let n=this.afterWidget&&e.flags&48&&(this.afterWidget.flags&48)==(e.flags&48);n||this.flushBuffer();let s=this.ensureMarks(t,r);!n&&!(e.flags&16)&&s.append(this.getBuffer(1)),s.append(e),this.pos+=e.length,this.afterWidget=e}addMark(e,t,r){this.flushBuffer(),this.ensureMarks(t,r).append(e),this.pos+=e.length,this.afterWidget=null}addBlockWidget(e){this.getBlockPos().append(e),this.pos+=e.length,this.lastBlock=e,this.endLine()}continueWidget(e){let t=this.afterWidget||this.lastBlock;t.length+=e,this.pos+=e}addLineStart(e,t){var r;e||(e=Mp);let n=Er.start(e,t||((r=this.cache.find(Er))===null||r===void 0?void 0:r.dom),!!t);this.getBlockPos().append(this.lastBlock=this.curLine=n)}addLine(e){this.getBlockPos().append(e),this.pos+=e.length,this.lastBlock=e,this.endLine()}addBreak(){this.lastBlock.flags|=1,this.endLine(),this.pos++}addLineStartIfNotCovered(e){this.blockPosCovered()||this.addLineStart(e)}ensureLine(e){this.curLine||this.addLineStart(e)}ensureMarks(e,t){var r;let n=this.curLine;for(let s=e.length-1;s>=0;s--){let l=e[s],o;if(t>0&&(o=n.lastChild)&&o instanceof vt&&o.mark.eq(l))n=o,t--;else{let a=vt.of(l,(r=this.cache.find(vt,c=>c.mark.eq(l)))===null||r===void 0?void 0:r.dom);n.append(a),n=a,t=0}}return n}endLine(){if(this.curLine){this.flushBuffer();let e=this.curLine.lastChild;(!e||!Xh(this.curLine,!1)||e.dom.nodeName!="BR"&&e.isWidget()&&!(ne.ios&&Xh(this.curLine,!0)))&&this.curLine.append(this.cache.findWidget(Xo,0,32)||new ir(Xo.toDOM(),0,Xo,32)),this.curLine=this.afterWidget=null}}updateBlockWrappers(){this.wrapperPos>this.pos+1e4&&(this.blockWrappers.goto(this.pos),this.wrappers.length=0);for(let e=this.wrappers.length-1;e>=0;e--)this.wrappers[e].to<this.pos&&this.wrappers.splice(e,1);for(let e=this.blockWrappers;e.value&&e.from<=this.pos;e.next())if(e.to>=this.pos){let t=new BS(e.from,e.to,e.value,e.rank),r=this.wrappers.length;for(;r>0&&(this.wrappers[r-1].rank-t.rank||this.wrappers[r-1].to-t.to)<0;)r--;this.wrappers.splice(r,0,t)}this.wrapperPos=this.pos}getBlockPos(){var e;this.updateBlockWrappers();let t=this.root;for(let r of this.wrappers){let n=t.lastChild;if(r.from<this.pos&&n instanceof Ei&&n.wrapper.eq(r.wrapper))t=n;else{let s=Ei.of(r.wrapper,(e=this.cache.find(Ei,l=>l.wrapper.eq(r.wrapper)))===null||e===void 0?void 0:e.dom);t.append(s),t=s}}return t}blockPosCovered(){let e=this.lastBlock;return e!=null&&!e.breakAfter&&(!e.isWidget()||(e.flags&160)>0)}getBuffer(e){let t=2|(e<0?16:32),r=this.cache.find(Rs,void 0,1);return r&&(r.flags=t),r||new Rs(t)}flushBuffer(){this.afterWidget&&!(this.afterWidget.flags&32)&&(this.afterWidget.parent.append(this.getBuffer(-1)),this.afterWidget=null)}}class PS{constructor(e){this.skipCount=0,this.text="",this.textOff=0,this.cursor=e.iter()}skip(e){this.textOff+e<=this.text.length?this.textOff+=e:(this.skipCount+=e-(this.text.length-this.textOff),this.text="",this.textOff=0)}next(e){if(this.textOff==this.text.length){let{value:n,lineBreak:s,done:l}=this.cursor.next(this.skipCount);if(this.skipCount=0,l)throw new Error("Ran out of text content when drawing inline views");this.text=n;let o=this.textOff=Math.min(e,n.length);return s?null:n.slice(0,o)}let t=Math.min(this.text.length,this.textOff+e),r=this.text.slice(this.textOff,t);return this.textOff=t,r}}const Bs=[ir,Er,Xi,vt,Rs,Ei,ao];for(let i=0;i<Bs.length;i++)Bs[i].bucket=i;class IS{constructor(e){this.view=e,this.buckets=Bs.map(()=>[]),this.index=Bs.map(()=>0),this.reused=new Map}add(e){let t=e.constructor.bucket,r=this.buckets[t];r.length<6?r.push(e):r[this.index[t]=(this.index[t]+1)%6]=e}find(e,t,r=2){let n=e.bucket,s=this.buckets[n],l=this.index[n];for(let o=s.length-1;o>=0;o--){let a=(o+l)%s.length,c=s[a];if((!t||t(c))&&!this.reused.has(c))return s.splice(a,1),a<l&&this.index[n]--,this.reused.set(c,r),c}return null}findWidget(e,t,r){let n=this.buckets[0];if(n.length)for(let s=0,l=0;;s++){if(s==n.length){if(l)return null;l=1,s=0}let o=n[s];if(!this.reused.has(o)&&(l==0?o.widget.compare(e):o.widget.constructor==e.constructor&&e.updateDOM(o.dom,this.view)))return n.splice(s,1),s<this.index[0]&&this.index[0]--,o.widget==e&&o.length==t&&(o.flags&497)==r?(this.reused.set(o,1),o):(this.reused.set(o,2),new ir(o.dom,t,e,o.flags&-498|r))}}reuse(e){return this.reused.set(e,1),e}maybeReuse(e,t=2){if(!this.reused.has(e))return this.reused.set(e,t),e.dom}clear(){for(let e=0;e<this.buckets.length;e++)this.buckets[e].length=this.index[e]=0}}class NS{constructor(e,t,r,n,s){this.view=e,this.decorations=n,this.disallowBlockEffectsFor=s,this.openWidget=!1,this.openMarks=0,this.cache=new IS(e),this.text=new PS(e.state.doc),this.builder=new OS(this.cache,new ao(e,e.contentDOM),ye.iter(r)),this.cache.reused.set(t,2),this.old=new RS(t),this.reuseWalker={skip:(l,o,a)=>{if(this.cache.add(l),l.isComposite())return!1},enter:l=>this.cache.add(l),leave:()=>{},break:()=>{}}}run(e,t){let r=t&&this.getCompositionContext(t.text);for(let n=0,s=0,l=0;;){let o=l<e.length?e[l++]:null,a=o?o.fromA:this.old.root.length;if(a>n){let c=a-n;this.preserve(c,!l,!o),n=a,s+=c}if(!o)break;t&&o.fromA<=t.range.fromA&&o.toA>=t.range.toA?(this.forward(o.fromA,t.range.fromA,t.range.fromA<t.range.toA?1:-1),this.emit(s,t.range.fromB),this.cache.clear(),this.builder.addComposition(t,r),this.text.skip(t.range.toB-t.range.fromB),this.forward(t.range.fromA,o.toA),this.emit(t.range.toB,o.toB)):(this.forward(o.fromA,o.toA),this.emit(s,o.toB)),s=o.toB,n=o.toA}return this.builder.curLine&&this.builder.endLine(),this.builder.root}preserve(e,t,r){let n=jS(this.old),s=this.openMarks;this.old.advance(e,r?1:-1,{skip:(l,o,a)=>{if(l.isWidget())if(this.openWidget)this.builder.continueWidget(a-o);else{let c=a>0||o<l.length?ir.of(l.widget,this.view,a-o,l.flags&496,this.cache.maybeReuse(l)):this.cache.reuse(l);c.flags&256?(c.flags&=-2,this.builder.addBlockWidget(c)):(this.builder.ensureLine(null),this.builder.addInlineWidget(c,n,s),s=n.length)}else if(l.isText())this.builder.ensureLine(null),!o&&a==l.length?this.builder.addText(l.text,n,s,this.cache.reuse(l)):(this.cache.add(l),this.builder.addText(l.text.slice(o,a),n,s)),s=n.length;else if(l.isLine())l.flags&=-2,this.cache.reused.set(l,1),this.builder.addLine(l);else if(l instanceof Rs)this.cache.add(l);else if(l instanceof vt)this.builder.ensureLine(null),this.builder.addMark(l,n,s),this.cache.reused.set(l,1),s=n.length;else return!1;this.openWidget=!1},enter:l=>{l.isLine()?this.builder.addLineStart(l.attrs,this.cache.maybeReuse(l)):(this.cache.add(l),l instanceof vt&&n.unshift(l.mark)),this.openWidget=!1},leave:l=>{l.isLine()?n.length&&(n.length=s=0):l instanceof vt&&(n.shift(),s=Math.min(s,n.length))},break:()=>{this.builder.addBreak(),this.openWidget=!1}}),this.text.skip(e)}emit(e,t){let r=null,n=this.builder,s=0,l=ye.spans(this.decorations,e,t,{point:(o,a,c,u,h,f)=>{if(c instanceof er){if(this.disallowBlockEffectsFor[f]){if(c.block)throw new RangeError("Block decorations may not be specified via plugins");if(a>this.view.state.doc.lineAt(o).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}if(s=u.length,h>u.length)n.continueWidget(a-o);else{let d=c.widget||(c.block?Ar.block:Ar.inline),_=FS(c),y=this.cache.findWidget(d,a-o,_)||ir.of(d,this.view,a-o,_);c.block?(c.startSide>0&&n.addLineStartIfNotCovered(r),n.addBlockWidget(y)):(n.ensureLine(r),n.addInlineWidget(y,u,h))}r=null}else r=HS(r,c);a>o&&this.text.skip(a-o)},span:(o,a,c,u)=>{for(let h=o;h<a;){let f=this.text.next(Math.min(512,a-h));f==null?(n.addLineStartIfNotCovered(r),n.addBreak(),h++):(n.ensureLine(r),n.addText(f,c,h==o?u:c.length),h+=f.length),r=null}}});n.addLineStartIfNotCovered(r),this.openWidget=l>s,this.openMarks=l}forward(e,t,r=1){t-e<=10?this.old.advance(t-e,r,this.reuseWalker):(this.old.advance(5,-1,this.reuseWalker),this.old.advance(t-e-10,-1),this.old.advance(5,r,this.reuseWalker))}getCompositionContext(e){let t=[],r=null;for(let n=e.parentNode;;n=n.parentNode){let s=$e.get(n);if(n==this.view.contentDOM)break;s instanceof vt?t.push(s):s!=null&&s.isLine()?r=s:n.nodeName=="DIV"&&!r&&n!=this.view.contentDOM?r=new Er(n,Mp):t.push(vt.of(new Tn({tagName:n.nodeName.toLowerCase(),attributes:hS(n)}),n))}return{line:r,marks:t}}}function Xh(i,e){let t=r=>{for(let n of r.children)if((e?n.isText():n.length)||t(n))return!0;return!1};return t(i)}function FS(i){let e=i.isReplace?(i.startSide<0?64:0)|(i.endSide>0?128:0):i.startSide>0?32:16;return i.block&&(e|=256),e}const Mp={class:"cm-line"};function HS(i,e){let t=e.spec.attributes,r=e.spec.class;return!t&&!r||(i||(i={class:"cm-line"}),t&&Xa(t,i),r&&(i.class+=" "+r)),i}function jS(i){let e=[];for(let t=i.parents.length;t>1;t--){let r=t==i.parents.length?i.tile:i.parents[t].tile;r instanceof vt&&e.push(r.mark)}return e}function Go(i){let e=$e.get(i);return e&&e.setDOM(i.cloneNode()),i}class Ar extends Fi{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}Ar.inline=new Ar("span");Ar.block=new Ar("div");const Xo=new class extends Fi{toDOM(){return document.createElement("br")}get isHidden(){return!0}get editable(){return!0}};class Jh{constructor(e){this.view=e,this.decorations=[],this.blockWrappers=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.editContextFormatting=he.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.updateDeco(),this.tile=new ao(e,e.contentDOM),this.updateInner([new Bt(0,0,0,e.state.doc.length)],null)}update(e){var t;let r=e.changedRanges;this.minWidth>0&&r.length&&(r.every(({fromA:u,toA:h})=>h<this.minWidthFrom||u>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let n=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((t=this.domChanged)===null||t===void 0)&&t.newSel?n=this.domChanged.newSel.head:!XS(e.changes,this.hasComposition)&&!e.selectionSet&&(n=e.state.selection.main.head));let s=n>-1?WS(this.view,e.changes,n):null;if(this.domChanged=null,this.hasComposition){let{from:u,to:h}=this.hasComposition;r=new Bt(u,h,e.changes.mapPos(u,-1),e.changes.mapPos(h,1)).addToSet(r.slice())}this.hasComposition=s?{from:s.range.fromB,to:s.range.toB}:null,(ne.ie||ne.chrome)&&!s&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let l=this.decorations,o=this.blockWrappers;this.updateDeco();let a=VS(l,this.decorations,e.changes);a.length&&(r=Bt.extendWithRanges(r,a));let c=KS(o,this.blockWrappers,e.changes);return c.length&&(r=Bt.extendWithRanges(r,c)),s&&!r.some(u=>u.fromA<=s.range.fromA&&u.toA>=s.range.toA)&&(r=s.range.addToSet(r.slice())),this.tile.flags&2&&r.length==0?!1:(this.updateInner(r,s),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t){this.view.viewState.mustMeasureContent=!0;let{observer:r}=this.view;r.ignore(()=>{if(t||e.length){let l=this.tile,o=new NS(this.view,l,this.blockWrappers,this.decorations,this.dynamicDecorationMap);this.tile=o.run(e,t),ta(l,o.cache.reused)}this.tile.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.tile.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let s=ne.chrome||ne.ios?{node:r.selectionRange.focusNode,written:!1}:void 0;this.tile.sync(s),s&&(s.written||r.selectionRange.focusNode!=s.node||!this.tile.dom.contains(s.node))&&(this.forceSelection=!0),this.tile.dom.style.height=""});let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let s of this.tile.children)s.isWidget()&&s.widget instanceof Jo&&n.push(s.dom);r.updateGaps(n)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let t of e.transactions)for(let r of t.effects)r.is(kp)&&(this.editContextFormatting=r.value)}updateSelection(e=!1,t=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let{dom:r}=this.tile,n=this.view.root.activeElement,s=n==r,l=!s&&!(this.view.state.facet(hi)||r.tabIndex>-1)&&nn(r,this.view.observer.selectionRange)&&!(n&&r.contains(n));if(!(s||t||l))return;let o=this.forceSelection;this.forceSelection=!1;let a=this.view.state.selection.main,c,u;if(a.empty?u=c=this.inlineDOMNearPos(a.anchor,a.assoc||1):(u=this.inlineDOMNearPos(a.head,a.head==a.from?1:-1),c=this.inlineDOMNearPos(a.anchor,a.anchor==a.from?1:-1)),ne.gecko&&a.empty&&!this.hasComposition&&zS(c)){let f=document.createTextNode("");this.view.observer.ignore(()=>c.node.insertBefore(f,c.node.childNodes[c.offset]||null)),c=u=new zt(f,0),o=!0}let h=this.view.observer.selectionRange;(o||!h.focusNode||(!sn(c.node,c.offset,h.anchorNode,h.anchorOffset)||!sn(u.node,u.offset,h.focusNode,h.focusOffset))&&!this.suppressWidgetCursorChange(h,a))&&(this.view.observer.ignore(()=>{ne.android&&ne.chrome&&r.contains(h.focusNode)&&GS(h.focusNode,r)&&(r.blur(),r.focus({preventScroll:!0}));let f=Cr(this.view.root);if(f)if(a.empty){if(ne.gecko){let d=$S(c.node,c.offset);if(d&&d!=3){let _=(d==1?cp:hp)(c.node,c.offset);_&&(c=new zt(_.node,_.offset))}}f.collapse(c.node,c.offset),a.bidiLevel!=null&&f.caretBidiLevel!==void 0&&(f.caretBidiLevel=a.bidiLevel)}else if(f.extend){f.collapse(c.node,c.offset);try{f.extend(u.node,u.offset)}catch{}}else{let d=document.createRange();a.anchor>a.head&&([c,u]=[u,c]),d.setEnd(u.node,u.offset),d.setStart(c.node,c.offset),f.removeAllRanges(),f.addRange(d)}l&&this.view.root.activeElement==r&&(r.blur(),n&&n.focus())}),this.view.observer.setSelectionRange(c,u)),this.impreciseAnchor=c.precise?null:new zt(h.anchorNode,h.anchorOffset),this.impreciseHead=u.precise?null:new zt(h.focusNode,h.focusOffset)}suppressWidgetCursorChange(e,t){return this.hasComposition&&t.empty&&sn(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==t.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,r=Cr(e.root),{anchorNode:n,anchorOffset:s}=e.observer.selectionRange;if(!r||!t.empty||!t.assoc||!r.modify)return;let l=this.lineAt(t.head,t.assoc);if(!l)return;let o=l.posAtStart;if(t.head==o||t.head==o+l.length)return;let a=this.coordsAt(t.head,-1),c=this.coordsAt(t.head,1);if(!a||!c||a.bottom>c.top)return;let u=this.domAtPos(t.head+t.assoc,t.assoc);r.collapse(u.node,u.offset),r.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let h=e.observer.selectionRange;e.docView.posFromDOM(h.anchorNode,h.anchorOffset)!=t.from&&r.collapse(n,s)}posFromDOM(e,t){let r=this.tile.nearest(e);if(!r)return this.tile.dom.compareDocumentPosition(e)&2?0:this.view.state.doc.length;let n=r.posAtStart;if(r.isComposite()){let s;if(e==r.dom)s=r.dom.childNodes[t];else{let l=di(e)==0?0:t==0?-1:1;for(;;){let o=e.parentNode;if(o==r.dom)break;l==0&&o.firstChild!=o.lastChild&&(e==o.firstChild?l=-1:l=1),e=o}l<0?s=e:s=e.nextSibling}if(s==r.dom.firstChild)return n;for(;s&&!$e.get(s);)s=s.nextSibling;if(!s)return n+r.length;for(let l=0,o=n;;l++){let a=r.children[l];if(a.dom==s)return o;o+=a.length+a.breakAfter}}else return r.isText()?e==r.dom?n+t:n+(t?r.length:0):n}domAtPos(e,t){let{tile:r,offset:n}=this.tile.resolveBlock(e,t);return r.isWidget()?r.domPosFor(e,t):r.domIn(n,t)}inlineDOMNearPos(e,t){let r,n=-1,s=!1,l,o=-1,a=!1;return this.tile.blockTiles((c,u)=>{if(c.isWidget()){if(c.flags&32&&u>=e)return!0;c.flags&16&&(s=!0)}else{let h=u+c.length;if(u<=e&&(r=c,n=e-u,s=h<e),h>=e&&!l&&(l=c,o=e-u,a=u>e),u>e&&l)return!0}}),!r&&!l?this.domAtPos(e,t):(s&&l?r=null:a&&r&&(l=null),r&&t<0||!l?r.domIn(n,t):l.domIn(o,t))}coordsAt(e,t){let{tile:r,offset:n}=this.tile.resolveBlock(e,t);return r.isWidget()?r.widget instanceof Jo?null:r.coordsInWidget(n,t,!0):r.coordsIn(n,t)}lineAt(e,t){let{tile:r}=this.tile.resolveBlock(e,t);return r.isLine()?r:null}coordsForChar(e){let{tile:t,offset:r}=this.tile.resolveBlock(e,1);if(!t.isLine())return null;function n(s,l){if(s.isComposite())for(let o of s.children){if(o.length>=l){let a=n(o,l);if(a)return a}if(l-=o.length,l<0)break}else if(s.isText()&&l<s.length){let o=Ke(s.text,l);if(o==l)return null;let a=pn(s.dom,l,o).getClientRects();for(let c=0;c<a.length;c++){let u=a[c];if(c==a.length-1||u.top<u.bottom&&u.left<u.right)return u}}return null}return n(t,r)}measureVisibleLineHeights(e){let t=[],{from:r,to:n}=e,s=this.view.contentDOM.clientWidth,l=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1,a=this.view.textDirection==Fe.LTR,c=0,u=(h,f,d)=>{for(let _=0;_<h.children.length&&!(f>n);_++){let y=h.children[_],p=f+y.length,m=y.dom.getBoundingClientRect(),{height:g}=m;if(d&&!_&&(c+=m.top-d.top),y instanceof Ei)p>r&&u(y,f,m);else if(f>=r&&(c>0&&t.push(-c),t.push(g+c),c=0,l)){let v=y.dom.lastChild,b=v?vs(v):[];if(b.length){let S=b[b.length-1],x=a?S.right-m.left:m.right-S.left;x>o&&(o=x,this.minWidth=s,this.minWidthFrom=f,this.minWidthTo=p)}}d&&_==h.children.length-1&&(c+=d.bottom-m.bottom),f=p+y.breakAfter}};return u(this.tile,0,null),t}textDirectionAt(e){let{tile:t}=this.tile.resolveBlock(e,1);return getComputedStyle(t.dom).direction=="rtl"?Fe.RTL:Fe.LTR}measureTextSize(){let e=this.tile.blockTiles(l=>{if(l.isLine()&&l.children.length&&l.length<=20){let o=0,a;for(let c of l.children){if(!c.isText()||/[^ -~]/.test(c.text))return;let u=vs(c.dom);if(u.length!=1)return;o+=u[0].width,a=u[0].height}if(o)return{lineHeight:l.dom.getBoundingClientRect().height,charWidth:o/l.length,textHeight:a}}});if(e)return e;let t=document.createElement("div"),r,n,s;return t.className="cm-line",t.style.width="99999px",t.style.position="absolute",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.tile.dom.appendChild(t);let l=vs(t.firstChild)[0];r=t.getBoundingClientRect().height,n=l&&l.width?l.width/27:7,s=l&&l.height?l.height:r,t.remove()}),{lineHeight:r,charWidth:n,textHeight:s}}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let r=0,n=0;;n++){let s=n==t.viewports.length?null:t.viewports[n],l=s?s.from-1:this.view.state.doc.length;if(l>r){let o=(t.lineBlockAt(l).bottom-t.lineBlockAt(r).top)/this.view.scaleY;e.push(he.replace({widget:new Jo(o),block:!0,inclusive:!0,isBlockGap:!0}).range(r,l))}if(!s)break;r=s.to+1}return he.set(e)}updateDeco(){let e=1,t=this.view.state.facet(oo).map(s=>(this.dynamicDecorationMap[e++]=typeof s=="function")?s(this.view):s),r=!1,n=this.view.state.facet(tc).map((s,l)=>{let o=typeof s=="function";return o&&(r=!0),o?s(this.view):s});for(n.length&&(this.dynamicDecorationMap[e++]=r,t.push(ye.join(n))),this.decorations=[this.editContextFormatting,...t,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;this.blockWrappers=this.view.state.facet(Ep).map(s=>typeof s=="function"?s(this.view):s)}scrollIntoView(e){if(e.isSnapshot){let c=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=c.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}for(let c of this.view.state.facet(Sp))try{if(c(this.view,e.range,e))return!0}catch(u){_t(this.view.state,u,"scroll handler")}let{range:t}=e,r=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),n;if(!r)return;!t.empty&&(n=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(r={left:Math.min(r.left,n.left),top:Math.min(r.top,n.top),right:Math.max(r.right,n.right),bottom:Math.max(r.bottom,n.bottom)});let s=ic(this.view),l={left:r.left-s.left,top:r.top-s.top,right:r.right+s.right,bottom:r.bottom+s.bottom},{offsetWidth:o,offsetHeight:a}=this.view.scrollDOM;dS(this.view.scrollDOM,l,t.head<t.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,o),-o),Math.max(Math.min(e.yMargin,a),-a),this.view.textDirection==Fe.LTR)}lineHasWidget(e){let t=r=>r.isWidget()||r.children.some(t);return t(this.tile.resolveBlock(e,1).tile)}destroy(){ta(this.tile)}}function ta(i,e){let t=e==null?void 0:e.get(i);if(t!=1){t==null&&i.destroy();for(let r of i.children)ta(r,e)}}function zS(i){return i.node.nodeType==1&&i.node.firstChild&&(i.offset==0||i.node.childNodes[i.offset-1].contentEditable=="false")&&(i.offset==i.node.childNodes.length||i.node.childNodes[i.offset].contentEditable=="false")}function Lp(i,e){let t=i.observer.selectionRange;if(!t.focusNode)return null;let r=cp(t.focusNode,t.focusOffset),n=hp(t.focusNode,t.focusOffset),s=r||n;if(n&&r&&n.node!=r.node){let o=$e.get(n.node);if(!o||o.isText()&&o.text!=n.node.nodeValue)s=n;else if(i.docView.lastCompositionAfterCursor){let a=$e.get(r.node);!a||a.isText()&&a.text!=r.node.nodeValue||(s=n)}}if(i.docView.lastCompositionAfterCursor=s!=r,!s)return null;let l=e-s.offset;return{from:l,to:l+s.node.nodeValue.length,node:s.node}}function WS(i,e,t){let r=Lp(i,t);if(!r)return null;let{node:n,from:s,to:l}=r,o=n.nodeValue;if(/[\n\r]/.test(o)||i.state.doc.sliceString(r.from,r.to)!=o)return null;let a=e.invertedDesc;return{range:new Bt(a.mapPos(s),a.mapPos(l),s,l),text:n}}function $S(i,e){return i.nodeType!=1?0:(e&&i.childNodes[e-1].contentEditable=="false"?1:0)|(e<i.childNodes.length&&i.childNodes[e].contentEditable=="false"?2:0)}let US=class{constructor(){this.changes=[]}compareRange(e,t){vr(e,t,this.changes)}comparePoint(e,t){vr(e,t,this.changes)}boundChange(e){vr(e,e,this.changes)}};function VS(i,e,t){let r=new US;return ye.compare(i,e,t,r),r.changes}class qS{constructor(){this.changes=[]}compareRange(e,t){vr(e,t,this.changes)}comparePoint(){}boundChange(e){vr(e,e,this.changes)}}function KS(i,e,t){let r=new qS;return ye.compare(i,e,t,r),r.changes}function GS(i,e){for(let t=i;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function XS(i,e){let t=!1;return e&&i.iterChangedRanges((r,n)=>{r<e.to&&n>e.from&&(t=!0)}),t}class Jo extends Fi{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}function JS(i,e,t=1){let r=i.charCategorizer(e),n=i.doc.lineAt(e),s=e-n.from;if(n.length==0)return G.cursor(e);s==0?t=1:s==n.length&&(t=-1);let l=s,o=s;t<0?l=Ke(n.text,s,!1):o=Ke(n.text,s);let a=r(n.text.slice(l,o));for(;l>0;){let c=Ke(n.text,l,!1);if(r(n.text.slice(c,l))!=a)break;l=c}for(;o<n.length;){let c=Ke(n.text,o);if(r(n.text.slice(o,c))!=a)break;o=c}return G.range(l+n.from,o+n.from)}function YS(i,e,t,r,n){let s=Math.round((r-e.left)*i.defaultCharacterWidth);if(i.lineWrapping&&t.height>i.defaultLineHeight*1.5){let o=i.viewState.heightOracle.textHeight,a=Math.floor((n-t.top-(i.defaultLineHeight-o)*.5)/o);s+=a*i.viewState.heightOracle.lineLength}let l=i.state.sliceDoc(t.from,t.to);return t.from+rS(l,s,i.state.tabSize)}function QS(i,e,t){let r=i.lineBlockAt(e);if(Array.isArray(r.type)){let n;for(let s of r.type){if(s.from>e)break;if(!(s.to<e)){if(s.from<e&&s.to>e)return s;(!n||s.type==bt.Text&&(n.type!=s.type||(t<0?s.from<e:s.to>e)))&&(n=s)}}return n||r}return r}function ZS(i,e,t,r){let n=QS(i,e.head,e.assoc||-1),s=!r||n.type!=bt.Text||!(i.lineWrapping||n.widgetLineBreaks)?null:i.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head);if(s){let l=i.dom.getBoundingClientRect(),o=i.textDirectionAt(n.from),a=i.posAtCoords({x:t==(o==Fe.LTR)?l.right-1:l.left+1,y:(s.top+s.bottom)/2});if(a!=null)return G.cursor(a,t?-1:1)}return G.cursor(t?n.to:n.from,t?-1:1)}function Yh(i,e,t,r){let n=i.state.doc.lineAt(e.head),s=i.bidiSpans(n),l=i.textDirectionAt(n.from);for(let o=e,a=null;;){let c=CS(n,s,l,o,t),u=mp;if(!c){if(n.number==(t?i.state.doc.lines:1))return o;u=`
`,n=i.state.doc.line(n.number+(t?1:-1)),s=i.bidiSpans(n),c=i.visualLineSide(n,!t)}if(a){if(!a(u))return o}else{if(!r)return c;a=r(u)}o=c}}function ek(i,e,t){let r=i.state.charCategorizer(e),n=r(t);return s=>{let l=r(s);return n==Ne.Space&&(n=l),n==l}}function tk(i,e,t,r){let n=e.head,s=t?1:-1;if(n==(t?i.state.doc.length:0))return G.cursor(n,e.assoc);let l=e.goalColumn,o,a=i.contentDOM.getBoundingClientRect(),c=i.coordsAtPos(n,e.assoc||-1),u=i.documentTop;if(c)l==null&&(l=c.left-a.left),o=s<0?c.top:c.bottom;else{let _=i.viewState.lineBlockAt(n);l==null&&(l=Math.min(a.right-a.left,i.defaultCharacterWidth*(n-_.from))),o=(s<0?_.top:_.bottom)+u}let h=a.left+l,f=r??i.viewState.heightOracle.textHeight>>1,d=ia(i,{x:h,y:o+f*s},!1,s);return G.cursor(d.pos,d.assoc,void 0,l)}function on(i,e,t){for(;;){let r=0;for(let n of i)n.between(e-1,e+1,(s,l,o)=>{if(e>s&&e<l){let a=r||t||(e-s<l-e?-1:1);e=a<0?s:l,r=a}});if(!r)return e}}function Tp(i,e){let t=null;for(let r=0;r<e.ranges.length;r++){let n=e.ranges[r],s=null;if(n.empty){let l=on(i,n.from,0);l!=n.from&&(s=G.cursor(l,-1))}else{let l=on(i,n.from,-1),o=on(i,n.to,1);(l!=n.from||o!=n.to)&&(s=G.range(n.from==n.anchor?l:o,n.from==n.head?l:o))}s&&(t||(t=e.ranges.slice()),t[r]=s)}return t?G.create(t,e.mainIndex):e}function Yo(i,e,t){let r=on(i.state.facet(Bn).map(n=>n(i)),t.from,e.head>t.from?-1:1);return r==t.from?t:G.cursor(r,r<t.from?1:-1)}class ii{constructor(e,t){this.pos=e,this.assoc=t}}function ia(i,e,t,r){let n=i.contentDOM.getBoundingClientRect(),s=n.top+i.viewState.paddingTop,{x:l,y:o}=e,a=o-s,c;for(;;){if(a<0)return new ii(0,1);if(a>i.viewState.docHeight)return new ii(i.state.doc.length,-1);if(c=i.elementAtHeight(a),r==null)break;if(c.type==bt.Text){if(r<0?c.to<i.viewport.from:c.from>i.viewport.to)break;let f=i.docView.coordsAt(r<0?c.from:c.to,r);if(f&&(r<0?f.top<=a+s:f.bottom>=a+s))break}let h=i.viewState.heightOracle.textHeight/2;a=r>0?c.bottom+h:c.top-h}if(i.viewport.from>=c.to||i.viewport.to<=c.from){if(t)return null;if(c.type==bt.Text){let h=YS(i,n,c,l,o);return new ii(h,h==c.from?1:-1)}}if(c.type!=bt.Text)return a<(c.top+c.bottom)/2?new ii(c.from,1):new ii(c.to,-1);let u=i.docView.lineAt(c.from,2);return(!u||u.length!=c.length)&&(u=i.docView.lineAt(c.from,-2)),Rp(i,u,c.from,l,o)}function Rp(i,e,t,r,n){let s=-1,l=null,o=1e9,a=1e9,c=n,u=n,h=(f,d)=>{for(let _=0;_<f.length;_++){let y=f[_];if(y.top==y.bottom)continue;let p=y.left>r?y.left-r:y.right<r?r-y.right:0,m=y.top>n?y.top-n:y.bottom<n?n-y.bottom:0;y.top<=u&&y.bottom>=c&&(c=Math.min(y.top,c),u=Math.max(y.bottom,u),m=0),(s<0||(m-a||p-o)<0)&&(s>=0&&a&&o<p&&l.top<=u-2&&l.bottom>=c+2?a=0:(s=d,o=p,a=m,l=y))}};if(e.isText()){for(let d=0;d<e.length;){let _=Ke(e.text,d);if(h(pn(e.dom,d,_).getClientRects(),d),!o&&!a)break;d=_}return r>(l.left+l.right)/2==(Qh(i,s+t)==Fe.LTR)?new ii(t+Ke(e.text,s),-1):new ii(t+s,1)}else{if(!e.length)return new ii(t,1);for(let y=0;y<e.children.length;y++){let p=e.children[y];if(p.flags&48)continue;let m=(p.dom.nodeType==1?p.dom:pn(p.dom,0,p.length)).getClientRects();if(h(m,y),!o&&!a)break}let f=e.children[s],d=e.posBefore(f,t);return f.isComposite()||f.isText()?Rp(i,f,d,Math.max(l.left,Math.min(l.right,r)),n):r>(l.left+l.right)/2==(Qh(i,s+t)==Fe.LTR)?new ii(d+f.length,-1):new ii(d,1)}}function Qh(i,e){let t=i.state.doc.lineAt(e);return i.bidiSpans(t)[ui.find(i.bidiSpans(t),e-t.from,-1,1)].dir}const Jr="";class ik{constructor(e,t){this.points=e,this.view=t,this.text="",this.lineSeparator=t.state.facet(Ce.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=Jr}readRange(e,t){if(!e)return this;let r=e.parentNode;for(let n=e;;){this.findPointBefore(r,n);let s=this.text.length;this.readNode(n);let l=$e.get(n),o=n.nextSibling;if(o==t){l!=null&&l.breakAfter&&!o&&r!=this.view.contentDOM&&this.lineBreak();break}let a=$e.get(o);(l&&a?l.breakAfter:(l?l.breakAfter:Ms(n))||Ms(o)&&(n.nodeName!="BR"||l!=null&&l.isWidget())&&this.text.length>s)&&!nk(o,t)&&this.lineBreak(),n=o}return this.findPointBefore(r,t),this}readTextNode(e){let t=e.nodeValue;for(let r of this.points)r.node==e&&(r.pos=this.text.length+Math.min(r.offset,t.length));for(let r=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let s=-1,l=1,o;if(this.lineSeparator?(s=t.indexOf(this.lineSeparator,r),l=this.lineSeparator.length):(o=n.exec(t))&&(s=o.index,l=o[0].length),this.append(t.slice(r,s<0?t.length:s)),s<0)break;if(this.lineBreak(),l>1)for(let a of this.points)a.node==e&&a.pos>this.text.length&&(a.pos-=l-1);r=s+l}}readNode(e){let t=$e.get(e),r=t&&t.overrideDOMText;if(r!=null){this.findPointInside(e,r.length);for(let n=r.iter();!n.next().done;)n.lineBreak?this.lineBreak():this.append(n.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let r of this.points)r.node==e&&e.childNodes[r.offset]==t&&(r.pos=this.text.length)}findPointInside(e,t){for(let r of this.points)(e.nodeType==3?r.node==e:e.contains(r.node))&&(r.pos=this.text.length+(rk(e,r.node,r.offset)?t:0))}}function rk(i,e,t){for(;;){if(!e||t<di(e))return!1;if(e==i)return!0;t=Bi(e)+1,e=e.parentNode}}function nk(i,e){let t;for(;!(i==e||!i);i=i.nextSibling){let r=$e.get(i);if(!(r!=null&&r.isWidget()))return!1;r&&(t||(t=[])).push(r)}if(t)for(let r of t){let n=r.overrideDOMText;if(n!=null&&n.length)return!1}return!0}class Zh{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class sk{constructor(e,t,r,n){this.typeOver=n,this.bounds=null,this.text="",this.domChanged=t>-1;let{impreciseHead:s,impreciseAnchor:l}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=Bp(e.docView.tile,t,r,0))){let o=s||l?[]:lk(e),a=new ik(o,e);a.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=a.text,this.newSel=ak(o,this.bounds.from)}else{let o=e.observer.selectionRange,a=s&&s.node==o.focusNode&&s.offset==o.focusOffset||!Jl(e.contentDOM,o.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(o.focusNode,o.focusOffset),c=l&&l.node==o.anchorNode&&l.offset==o.anchorOffset||!Jl(e.contentDOM,o.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(o.anchorNode,o.anchorOffset),u=e.viewport;if((ne.ios||ne.chrome)&&e.state.selection.main.empty&&a!=c&&(u.from>0||u.to<e.state.doc.length)){let h=Math.min(a,c),f=Math.max(a,c),d=u.from-h,_=u.to-f;(d==0||d==1||h==0)&&(_==0||_==-1||f==e.state.doc.length)&&(a=0,c=e.state.doc.length)}e.inputState.composing>-1&&e.state.selection.ranges.length>1?this.newSel=e.state.selection.replaceRange(G.range(c,a)):this.newSel=G.single(c,a)}}}function Bp(i,e,t,r){if(i.isComposite()){let n=-1,s=-1,l=-1,o=-1;for(let a=0,c=r,u=r;a<i.children.length;a++){let h=i.children[a],f=c+h.length;if(c<e&&f>t)return Bp(h,e,t,c);if(f>=e&&n==-1&&(n=a,s=c),c>t&&h.dom.parentNode==i.dom){l=a,o=u;break}u=f,c=f+h.breakAfter}return{from:s,to:o<0?r+i.length:o,startDOM:(n?i.children[n-1].dom.nextSibling:null)||i.dom.firstChild,endDOM:l<i.children.length&&l>=0?i.children[l].dom:null}}else return i.isText()?{from:r,to:r+i.length,startDOM:i.dom,endDOM:i.dom.nextSibling}:null}function Op(i,e){let t,{newSel:r}=e,n=i.state.selection.main,s=i.inputState.lastKeyTime>Date.now()-100?i.inputState.lastKeyCode:-1;if(e.bounds){let{from:l,to:o}=e.bounds,a=n.from,c=null;(s===8||ne.android&&e.text.length<o-l)&&(a=n.to,c="end");let u=Pp(i.state.doc.sliceString(l,o,Jr),e.text,a-l,c);u&&(ne.chrome&&s==13&&u.toB==u.from+2&&e.text.slice(u.from,u.toB)==Jr+Jr&&u.toB--,t={from:l+u.from,to:l+u.toA,insert:Ae.of(e.text.slice(u.from,u.toB).split(Jr))})}else r&&(!i.hasFocus&&i.state.facet(hi)||Os(r,n))&&(r=null);if(!t&&!r)return!1;if(!t&&e.typeOver&&!n.empty&&r&&r.main.empty?t={from:n.from,to:n.to,insert:i.state.doc.slice(n.from,n.to)}:(ne.mac||ne.android)&&t&&t.from==t.to&&t.from==n.head-1&&/^\. ?$/.test(t.insert.toString())&&i.contentDOM.getAttribute("autocorrect")=="off"?(r&&t.insert.length==2&&(r=G.single(r.main.anchor-1,r.main.head-1)),t={from:t.from,to:t.to,insert:Ae.of([t.insert.toString().replace("."," ")])}):t&&t.from>=n.from&&t.to<=n.to&&(t.from!=n.from||t.to!=n.to)&&n.to-n.from-(t.to-t.from)<=4?t={from:n.from,to:n.to,insert:i.state.doc.slice(n.from,t.from).append(t.insert).append(i.state.doc.slice(t.to,n.to))}:i.state.doc.lineAt(n.from).to<n.to&&i.docView.lineHasWidget(n.to)&&i.inputState.insertingTextAt>Date.now()-50?t={from:n.from,to:n.to,insert:i.state.toText(i.inputState.insertingText)}:ne.chrome&&t&&t.from==t.to&&t.from==n.head&&t.insert.toString()==`
 `&&i.lineWrapping&&(r&&(r=G.single(r.main.anchor-1,r.main.head-1)),t={from:n.from,to:n.to,insert:Ae.of([" "])}),t)return rc(i,t,r,s);if(r&&!Os(r,n)){let l=!1,o="select";return i.inputState.lastSelectionTime>Date.now()-50&&(i.inputState.lastSelectionOrigin=="select"&&(l=!0),o=i.inputState.lastSelectionOrigin,o=="select.pointer"&&(r=Tp(i.state.facet(Bn).map(a=>a(i)),r))),i.dispatch({selection:r,scrollIntoView:l,userEvent:o}),!0}else return!1}function rc(i,e,t,r=-1){if(ne.ios&&i.inputState.flushIOSKey(e))return!0;let n=i.state.selection.main;if(ne.android&&(e.to==n.to&&(e.from==n.from||e.from==n.from-1&&i.state.sliceDoc(e.from,n.from)==" ")&&e.insert.length==1&&e.insert.lines==2&&_r(i.contentDOM,"Enter",13)||(e.from==n.from-1&&e.to==n.to&&e.insert.length==0||r==8&&e.insert.length<e.to-e.from&&e.to>n.head)&&_r(i.contentDOM,"Backspace",8)||e.from==n.from&&e.to==n.to+1&&e.insert.length==0&&_r(i.contentDOM,"Delete",46)))return!0;let s=e.insert.toString();i.inputState.composing>=0&&i.inputState.composing++;let l,o=()=>l||(l=ok(i,e,t));return i.state.facet(bp).some(a=>a(i,e.from,e.to,s,o))||i.dispatch(o()),!0}function ok(i,e,t){let r,n=i.state,s=n.selection.main,l=-1;if(e.from==e.to&&e.from<s.from||e.from>s.to){let a=e.from<s.from?-1:1,c=a<0?s.from:s.to,u=on(n.facet(Bn).map(h=>h(i)),c,a);e.from==u&&(l=u)}if(l>-1)r={changes:e,selection:G.cursor(e.from+e.insert.length,-1)};else if(e.from>=s.from&&e.to<=s.to&&e.to-e.from>=(s.to-s.from)/3&&(!t||t.main.empty&&t.main.from==e.from+e.insert.length)&&i.inputState.composing<0){let a=s.from<e.from?n.sliceDoc(s.from,e.from):"",c=s.to>e.to?n.sliceDoc(e.to,s.to):"";r=n.replaceSelection(i.state.toText(a+e.insert.sliceString(0,void 0,i.state.lineBreak)+c))}else{let a=n.changes(e),c=t&&t.main.to<=a.newLength?t.main:void 0;if(n.selection.ranges.length>1&&(i.inputState.composing>=0||i.inputState.compositionPendingChange)&&e.to<=s.to+10&&e.to>=s.to-10){let u=i.state.sliceDoc(e.from,e.to),h,f=t&&Lp(i,t.main.head);if(f){let _=e.insert.length-(e.to-e.from);h={from:f.from,to:f.to-_}}else h=i.state.doc.lineAt(s.head);let d=s.to-e.to;r=n.changeByRange(_=>{if(_.from==s.from&&_.to==s.to)return{changes:a,range:c||_.map(a)};let y=_.to-d,p=y-u.length;if(i.state.sliceDoc(p,y)!=u||y>=h.from&&p<=h.to)return{range:_};let m=n.changes({from:p,to:y,insert:e.insert}),g=_.to-s.to;return{changes:m,range:c?G.range(Math.max(0,c.anchor+g),Math.max(0,c.head+g)):_.map(m)}})}else r={changes:a,selection:c&&n.selection.replaceRange(c)}}let o="input.type";return(i.composing||i.inputState.compositionPendingChange&&i.inputState.compositionEndedAt>Date.now()-50)&&(i.inputState.compositionPendingChange=!1,o+=".compose",i.inputState.compositionFirstChange&&(o+=".start",i.inputState.compositionFirstChange=!1)),n.update(r,{userEvent:o,scrollIntoView:!0})}function Pp(i,e,t,r){let n=Math.min(i.length,e.length),s=0;for(;s<n&&i.charCodeAt(s)==e.charCodeAt(s);)s++;if(s==n&&i.length==e.length)return null;let l=i.length,o=e.length;for(;l>0&&o>0&&i.charCodeAt(l-1)==e.charCodeAt(o-1);)l--,o--;if(r=="end"){let a=Math.max(0,s-Math.min(l,o));t-=l+a-s}if(l<s&&i.length<e.length){let a=t<=s&&t>=l?s-t:0;s-=a,o=s+(o-l),l=s}else if(o<s){let a=t<=s&&t>=o?s-t:0;s-=a,l=s+(l-o),o=s}return{from:s,toA:l,toB:o}}function lk(i){let e=[];if(i.root.activeElement!=i.contentDOM)return e;let{anchorNode:t,anchorOffset:r,focusNode:n,focusOffset:s}=i.observer.selectionRange;return t&&(e.push(new Zh(t,r)),(n!=t||s!=r)&&e.push(new Zh(n,s))),e}function ak(i,e){if(i.length==0)return null;let t=i[0].pos,r=i.length==2?i[1].pos:t;return t>-1&&r>-1?G.single(t+e,r+e):null}function Os(i,e){return e.head==i.main.head&&e.anchor==i.main.anchor}class ck{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.insertingText="",this.insertingTextAt=0,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,ne.safari&&e.contentDOM.addEventListener("input",()=>null),ne.gecko&&kk(e.contentDOM.ownerDocument)}handleEvent(e){!vk(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||(this.view.updateState!=0?Promise.resolve().then(()=>this.runHandlers(e.type,e)):this.runHandlers(e.type,e))}runHandlers(e,t){let r=this.handlers[e];if(r){for(let n of r.observers)n(this.view,t);for(let n of r.handlers){if(t.defaultPrevented)break;if(n(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=hk(e),r=this.handlers,n=this.view.contentDOM;for(let s in t)if(s!="scroll"){let l=!t[s].handlers.length,o=r[s];o&&l!=!o.handlers.length&&(n.removeEventListener(s,this.handleEvent),o=null),o||n.addEventListener(s,this.handleEvent,{passive:l})}for(let s in r)s!="scroll"&&!t[s]&&n.removeEventListener(s,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&e.keyCode!=27&&Np.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),ne.android&&ne.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return ne.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((t=Ip.find(r=>r.keyCode==e.keyCode))&&!e.ctrlKey||uk.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=t||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(e){let t=this.pendingIOSKey;return!t||t.key=="Enter"&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString())?!1:(this.pendingIOSKey=void 0,_r(this.view.contentDOM,t.key,t.keyCode,t instanceof KeyboardEvent?t:void 0))}ignoreDuringComposition(e){return!/^key/.test(e.type)||e.synthetic?!1:this.composing>0?!0:ne.safari&&!ne.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function eu(i,e){return(t,r)=>{try{return e.call(i,r,t)}catch(n){_t(t.state,n)}}}function hk(i){let e=Object.create(null);function t(r){return e[r]||(e[r]={observers:[],handlers:[]})}for(let r of i){let n=r.spec,s=n&&n.plugin.domEventHandlers,l=n&&n.plugin.domEventObservers;if(s)for(let o in s){let a=s[o];a&&t(o).handlers.push(eu(r.value,a))}if(l)for(let o in l){let a=l[o];a&&t(o).observers.push(eu(r.value,a))}}for(let r in Ut)t(r).handlers.push(Ut[r]);for(let r in Nt)t(r).observers.push(Nt[r]);return e}const Ip=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],uk="dthko",Np=[16,17,18,20,91,92,224,225],Kn=6;function Gn(i){return Math.max(0,i)*.7+8}function fk(i,e){return Math.max(Math.abs(i.clientX-e.clientX),Math.abs(i.clientY-e.clientY))}class dk{constructor(e,t,r,n){this.view=e,this.startEvent=t,this.style=r,this.mustSelect=n,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParents=pS(e.contentDOM),this.atoms=e.state.facet(Bn).map(l=>l(e));let s=e.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(Ce.allowMultipleSelections)&&pk(e,t),this.dragging=gk(e,t)&&jp(t)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&fk(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let t=0,r=0,n=0,s=0,l=this.view.win.innerWidth,o=this.view.win.innerHeight;this.scrollParents.x&&({left:n,right:l}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:s,bottom:o}=this.scrollParents.y.getBoundingClientRect());let a=ic(this.view);e.clientX-a.left<=n+Kn?t=-Gn(n-e.clientX):e.clientX+a.right>=l-Kn&&(t=Gn(e.clientX-l)),e.clientY-a.top<=s+Kn?r=-Gn(s-e.clientY):e.clientY+a.bottom>=o-Kn&&(r=Gn(e.clientY-o)),this.setScrollSpeed(t,r)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:t}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),t&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=t,t=0),(e||t)&&this.view.win.scrollBy(e,t),this.dragging===!1&&this.select(this.lastEvent)}select(e){let{view:t}=this,r=Tp(this.atoms,this.style.get(e,this.extend,this.multiple));(this.mustSelect||!r.eq(t.state.selection,this.dragging===!1))&&this.view.dispatch({selection:r,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(t=>t.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function pk(i,e){let t=i.state.facet(gp);return t.length?t[0](e):ne.mac?e.metaKey:e.ctrlKey}function mk(i,e){let t=i.state.facet(vp);return t.length?t[0](e):ne.mac?!e.altKey:!e.ctrlKey}function gk(i,e){let{main:t}=i.state.selection;if(t.empty)return!1;let r=Cr(i.root);if(!r||r.rangeCount==0)return!0;let n=r.getRangeAt(0).getClientRects();for(let s=0;s<n.length;s++){let l=n[s];if(l.left<=e.clientX&&l.right>=e.clientX&&l.top<=e.clientY&&l.bottom>=e.clientY)return!0}return!1}function vk(i,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,r;t!=i.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(r=$e.get(t))&&r.isWidget()&&!r.isHidden&&r.widget.ignoreEvent(e))return!1;return!0}const Ut=Object.create(null),Nt=Object.create(null),Fp=ne.ie&&ne.ie_version<15||ne.ios&&ne.webkit_version<604;function _k(i){let e=i.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{i.focus(),t.remove(),Hp(i,t.value)},50)}function co(i,e,t){for(let r of i.facet(e))t=r(t,i);return t}function Hp(i,e){e=co(i.state,Qa,e);let{state:t}=i,r,n=1,s=t.toText(e),l=s.lines==t.selection.ranges.length;if(ra!=null&&t.selection.ranges.every(a=>a.empty)&&ra==s.toString()){let a=-1;r=t.changeByRange(c=>{let u=t.doc.lineAt(c.from);if(u.from==a)return{range:c};a=u.from;let h=t.toText((l?s.line(n++).text:e)+t.lineBreak);return{changes:{from:u.from,insert:h},range:G.cursor(c.from+h.length)}})}else l?r=t.changeByRange(a=>{let c=s.line(n++);return{changes:{from:a.from,to:a.to,insert:c.text},range:G.cursor(a.from+c.length)}}):r=t.replaceSelection(s);i.dispatch(r,{userEvent:"input.paste",scrollIntoView:!0})}Nt.scroll=i=>{i.inputState.lastScrollTop=i.scrollDOM.scrollTop,i.inputState.lastScrollLeft=i.scrollDOM.scrollLeft};Ut.keydown=(i,e)=>(i.inputState.setSelectionOrigin("select"),e.keyCode==27&&i.inputState.tabFocusMode!=0&&(i.inputState.tabFocusMode=Date.now()+2e3),!1);Nt.touchstart=(i,e)=>{i.inputState.lastTouchTime=Date.now(),i.inputState.setSelectionOrigin("select.pointer")};Nt.touchmove=i=>{i.inputState.setSelectionOrigin("select.pointer")};Ut.mousedown=(i,e)=>{if(i.observer.flush(),i.inputState.lastTouchTime>Date.now()-2e3)return!1;let t=null;for(let r of i.state.facet(_p))if(t=r(i,e),t)break;if(!t&&e.button==0&&(t=bk(i,e)),t){let r=!i.hasFocus;i.inputState.startMouseSelection(new dk(i,e,t,r)),r&&i.observer.ignore(()=>{lp(i.contentDOM);let s=i.root.activeElement;s&&!s.contains(i.contentDOM)&&s.blur()});let n=i.inputState.mouseSelection;if(n)return n.start(e),n.dragging===!1}else i.inputState.setSelectionOrigin("select.pointer");return!1};function tu(i,e,t,r){if(r==1)return G.cursor(e,t);if(r==2)return JS(i.state,e,t);{let n=i.docView.lineAt(e,t),s=i.state.doc.lineAt(n?n.posAtEnd:e),l=n?n.posAtStart:s.from,o=n?n.posAtEnd:s.to;return o<i.state.doc.length&&o==s.to&&o++,G.range(l,o)}}const yk=ne.ie&&ne.ie_version<=11;let iu=null,ru=0,nu=0;function jp(i){if(!yk)return i.detail;let e=iu,t=nu;return iu=i,nu=Date.now(),ru=!e||t>Date.now()-400&&Math.abs(e.clientX-i.clientX)<2&&Math.abs(e.clientY-i.clientY)<2?(ru+1)%3:1}function bk(i,e){let t=i.posAndSideAtCoords({x:e.clientX,y:e.clientY},!1),r=jp(e),n=i.state.selection;return{update(s){s.docChanged&&(t.pos=s.changes.mapPos(t.pos),n=n.map(s.changes))},get(s,l,o){let a=i.posAndSideAtCoords({x:s.clientX,y:s.clientY},!1),c,u=tu(i,a.pos,a.assoc,r);if(t.pos!=a.pos&&!l){let h=tu(i,t.pos,t.assoc,r),f=Math.min(h.from,u.from),d=Math.max(h.to,u.to);u=f<u.from?G.range(f,d):G.range(d,f)}return l?n.replaceRange(n.main.extend(u.from,u.to)):o&&r==1&&n.ranges.length>1&&(c=xk(n,a.pos))?c:o?n.addRange(u):G.create([u])}}}function xk(i,e){for(let t=0;t<i.ranges.length;t++){let{from:r,to:n}=i.ranges[t];if(r<=e&&n>=e)return G.create(i.ranges.slice(0,t).concat(i.ranges.slice(t+1)),i.mainIndex==t?0:i.mainIndex-(i.mainIndex>t?1:0))}return null}Ut.dragstart=(i,e)=>{let{selection:{main:t}}=i.state;if(e.target.draggable){let n=i.docView.tile.nearest(e.target);if(n&&n.isWidget()){let s=n.posAtStart,l=s+n.length;(s>=t.to||l<=t.from)&&(t=G.range(s,l))}}let{inputState:r}=i;return r.mouseSelection&&(r.mouseSelection.dragging=!0),r.draggedContent=t,e.dataTransfer&&(e.dataTransfer.setData("Text",co(i.state,Za,i.state.sliceDoc(t.from,t.to))),e.dataTransfer.effectAllowed="copyMove"),!1};Ut.dragend=i=>(i.inputState.draggedContent=null,!1);function su(i,e,t,r){if(t=co(i.state,Qa,t),!t)return;let n=i.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:s}=i.inputState,l=r&&s&&mk(i,e)?{from:s.from,to:s.to}:null,o={from:n,insert:t},a=i.state.changes(l?[l,o]:o);i.focus(),i.dispatch({changes:a,selection:{anchor:a.mapPos(n,-1),head:a.mapPos(n,1)},userEvent:l?"move.drop":"input.drop"}),i.inputState.draggedContent=null}Ut.drop=(i,e)=>{if(!e.dataTransfer)return!1;if(i.state.readOnly)return!0;let t=e.dataTransfer.files;if(t&&t.length){let r=Array(t.length),n=0,s=()=>{++n==t.length&&su(i,e,r.filter(l=>l!=null).join(i.state.lineBreak),!1)};for(let l=0;l<t.length;l++){let o=new FileReader;o.onerror=s,o.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(o.result)||(r[l]=o.result),s()},o.readAsText(t[l])}return!0}else{let r=e.dataTransfer.getData("Text");if(r)return su(i,e,r,!0),!0}return!1};Ut.paste=(i,e)=>{if(i.state.readOnly)return!0;i.observer.flush();let t=Fp?null:e.clipboardData;return t?(Hp(i,t.getData("text/plain")||t.getData("text/uri-list")),!0):(_k(i),!1)};function wk(i,e){let t=i.dom.parentNode;if(!t)return;let r=t.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px",r.value=e,r.focus(),r.selectionEnd=e.length,r.selectionStart=0,setTimeout(()=>{r.remove(),i.focus()},50)}function Sk(i){let e=[],t=[],r=!1;for(let n of i.selection.ranges)n.empty||(e.push(i.sliceDoc(n.from,n.to)),t.push(n));if(!e.length){let n=-1;for(let{from:s}of i.selection.ranges){let l=i.doc.lineAt(s);l.number>n&&(e.push(l.text),t.push({from:l.from,to:Math.min(i.doc.length,l.to+1)})),n=l.number}r=!0}return{text:co(i,Za,e.join(i.lineBreak)),ranges:t,linewise:r}}let ra=null;Ut.copy=Ut.cut=(i,e)=>{let t=Cr(i.root);if(t&&!nn(i.contentDOM,t))return!1;let{text:r,ranges:n,linewise:s}=Sk(i.state);if(!r&&!s)return!1;ra=s?r:null,e.type=="cut"&&!i.state.readOnly&&i.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"});let l=Fp?null:e.clipboardData;return l?(l.clearData(),l.setData("text/plain",r),!0):(wk(i,r),!1)};const zp=gi.define();function Wp(i,e){let t=[];for(let r of i.facet(xp)){let n=r(i,e);n&&t.push(n)}return t.length?i.update({effects:t,annotations:zp.of(!0)}):null}function $p(i){setTimeout(()=>{let e=i.hasFocus;if(e!=i.inputState.notifiedFocused){let t=Wp(i.state,e);t?i.dispatch(t):i.update([])}},10)}Nt.focus=i=>{i.inputState.lastFocusTime=Date.now(),!i.scrollDOM.scrollTop&&(i.inputState.lastScrollTop||i.inputState.lastScrollLeft)&&(i.scrollDOM.scrollTop=i.inputState.lastScrollTop,i.scrollDOM.scrollLeft=i.inputState.lastScrollLeft),$p(i)};Nt.blur=i=>{i.observer.clearSelectionRange(),$p(i)};Nt.compositionstart=Nt.compositionupdate=i=>{i.observer.editContext||(i.inputState.compositionFirstChange==null&&(i.inputState.compositionFirstChange=!0),i.inputState.composing<0&&(i.inputState.composing=0))};Nt.compositionend=i=>{i.observer.editContext||(i.inputState.composing=-1,i.inputState.compositionEndedAt=Date.now(),i.inputState.compositionPendingKey=!0,i.inputState.compositionPendingChange=i.observer.pendingRecords().length>0,i.inputState.compositionFirstChange=null,ne.chrome&&ne.android?i.observer.flushSoon():i.inputState.compositionPendingChange?Promise.resolve().then(()=>i.observer.flush()):setTimeout(()=>{i.inputState.composing<0&&i.docView.hasComposition&&i.update([])},50))};Nt.contextmenu=i=>{i.inputState.lastContextMenu=Date.now()};Ut.beforeinput=(i,e)=>{var t,r;if((e.inputType=="insertText"||e.inputType=="insertCompositionText")&&(i.inputState.insertingText=e.data,i.inputState.insertingTextAt=Date.now()),e.inputType=="insertReplacementText"&&i.observer.editContext){let s=(t=e.dataTransfer)===null||t===void 0?void 0:t.getData("text/plain"),l=e.getTargetRanges();if(s&&l.length){let o=l[0],a=i.posAtDOM(o.startContainer,o.startOffset),c=i.posAtDOM(o.endContainer,o.endOffset);return rc(i,{from:a,to:c,insert:i.state.toText(s)},null),!0}}let n;if(ne.chrome&&ne.android&&(n=Ip.find(s=>s.inputType==e.inputType))&&(i.observer.delayAndroidKey(n.key,n.keyCode),n.key=="Backspace"||n.key=="Delete")){let s=((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0;setTimeout(()=>{var l;(((l=window.visualViewport)===null||l===void 0?void 0:l.height)||0)>s+10&&i.hasFocus&&(i.contentDOM.blur(),i.focus())},100)}return ne.ios&&e.inputType=="deleteContentForward"&&i.observer.flushSoon(),ne.safari&&e.inputType=="insertText"&&i.inputState.composing>=0&&setTimeout(()=>Nt.compositionend(i,e),20),!1};const ou=new Set;function kk(i){ou.has(i)||(ou.add(i),i.addEventListener("copy",()=>{}),i.addEventListener("cut",()=>{}))}const lu=["pre-wrap","normal","pre-line","break-spaces"];let Dr=!1;function au(){Dr=!1}class Ck{constructor(e){this.lineWrapping=e,this.doc=Ae.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,t){let r=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(r+=Math.max(0,Math.ceil((t-e-r*this.lineLength*.5)/this.lineLength))),this.lineHeight*r}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/Math.max(1,this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return lu.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let r=0;r<e.length;r++){let n=e[r];n<0?r++:this.heightSamples[Math.floor(n*10)]||(t=!0,this.heightSamples[Math.floor(n*10)]=!0)}return t}refresh(e,t,r,n,s,l){let o=lu.indexOf(e)>-1,a=Math.abs(t-this.lineHeight)>.3||this.lineWrapping!=o||Math.abs(r-this.charWidth)>.1;if(this.lineWrapping=o,this.lineHeight=t,this.charWidth=r,this.textHeight=n,this.lineLength=s,a){this.heightSamples={};for(let c=0;c<l.length;c++){let u=l[c];u<0?c++:this.heightSamples[Math.floor(u*10)]=!0}}return a}}class Ek{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class jt{constructor(e,t,r,n,s){this.from=e,this.length=t,this.top=r,this.height=n,this._content=s}get type(){return typeof this._content=="number"?bt.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof er?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new jt(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var Ie=(function(i){return i[i.ByPos=0]="ByPos",i[i.ByHeight=1]="ByHeight",i[i.ByPosNoHeight=2]="ByPosNoHeight",i})(Ie||(Ie={}));const _s=.001;class dt{constructor(e,t,r=2){this.length=e,this.height=t,this.flags=r}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>_s&&(Dr=!0),this.height=e)}replace(e,t,r){return dt.of(r)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,r,n){let s=this,l=r.doc;for(let o=n.length-1;o>=0;o--){let{fromA:a,toA:c,fromB:u,toB:h}=n[o],f=s.lineAt(a,Ie.ByPosNoHeight,r.setDoc(t),0,0),d=f.to>=c?f:s.lineAt(c,Ie.ByPosNoHeight,r,0,0);for(h+=d.to-c,c=d.to;o>0&&f.from<=n[o-1].toA;)a=n[o-1].fromA,u=n[o-1].fromB,o--,a<f.from&&(f=s.lineAt(a,Ie.ByPosNoHeight,r,0,0));u+=f.from-a,a=f.from;let _=nc.build(r.setDoc(l),e,u,h);s=Ps(s,s.replace(a,c,_))}return s.updateHeight(r,0)}static empty(){return new Et(0,0,0)}static of(e){if(e.length==1)return e[0];let t=0,r=e.length,n=0,s=0;for(;;)if(t==r)if(n>s*2){let o=e[t-1];o.break?e.splice(--t,1,o.left,null,o.right):e.splice(--t,1,o.left,o.right),r+=1+o.break,n-=o.size}else if(s>n*2){let o=e[r];o.break?e.splice(r,1,o.left,null,o.right):e.splice(r,1,o.left,o.right),r+=2+o.break,s-=o.size}else break;else if(n<s){let o=e[t++];o&&(n+=o.size)}else{let o=e[--r];o&&(s+=o.size)}let l=0;return e[t-1]==null?(l=1,t--):e[t]==null&&(l=1,r++),new Dk(dt.of(e.slice(0,t)),l,dt.of(e.slice(r)))}}function Ps(i,e){return i==e?i:(i.constructor!=e.constructor&&(Dr=!0),e)}dt.prototype.size=1;const Ak=he.replace({});class Up extends dt{constructor(e,t,r){super(e,t),this.deco=r,this.spaceAbove=0}mainBlock(e,t){return new jt(t,this.length,e+this.spaceAbove,this.height-this.spaceAbove,this.deco||0)}blockAt(e,t,r,n){return this.spaceAbove&&e<r+this.spaceAbove?new jt(n,0,r,this.spaceAbove,Ak):this.mainBlock(r,n)}lineAt(e,t,r,n,s){let l=this.mainBlock(n,s);return this.spaceAbove?this.blockAt(0,r,n,s).join(l):l}forEachLine(e,t,r,n,s,l){e<=s+this.length&&t>=s&&l(this.lineAt(0,Ie.ByPos,r,n,s))}setMeasuredHeight(e){let t=e.heights[e.index++];t<0?(this.spaceAbove=-t,t=e.heights[e.index++]):this.spaceAbove=0,this.setHeight(t)}updateHeight(e,t=0,r=!1,n){return n&&n.from<=t&&n.more&&this.setMeasuredHeight(n),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Et extends Up{constructor(e,t,r){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0,this.spaceAbove=r}mainBlock(e,t){return new jt(t,this.length,e+this.spaceAbove,this.height-this.spaceAbove,this.breaks)}replace(e,t,r){let n=r[0];return r.length==1&&(n instanceof Et||n instanceof Je&&n.flags&4)&&Math.abs(this.length-n.length)<10?(n instanceof Je?n=new Et(n.length,this.height,this.spaceAbove):n.height=this.height,this.outdated||(n.outdated=!1),n):dt.of(r)}updateHeight(e,t=0,r=!1,n){return n&&n.from<=t&&n.more?this.setMeasuredHeight(n):(r||this.outdated)&&(this.spaceAbove=0,this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight)),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class Je extends dt{constructor(e){super(e,0)}heightMetrics(e,t){let r=e.doc.lineAt(t).number,n=e.doc.lineAt(t+this.length).number,s=n-r+1,l,o=0;if(e.lineWrapping){let a=Math.min(this.height,e.lineHeight*s);l=a/s,this.length>s+1&&(o=(this.height-a)/(this.length-s-1))}else l=this.height/s;return{firstLine:r,lastLine:n,perLine:l,perChar:o}}blockAt(e,t,r,n){let{firstLine:s,lastLine:l,perLine:o,perChar:a}=this.heightMetrics(t,n);if(t.lineWrapping){let c=n+(e<t.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-r)/this.height))*this.length)),u=t.doc.lineAt(c),h=o+u.length*a,f=Math.max(r,e-h/2);return new jt(u.from,u.length,f,h,0)}else{let c=Math.max(0,Math.min(l-s,Math.floor((e-r)/o))),{from:u,length:h}=t.doc.line(s+c);return new jt(u,h,r+o*c,o,0)}}lineAt(e,t,r,n,s){if(t==Ie.ByHeight)return this.blockAt(e,r,n,s);if(t==Ie.ByPosNoHeight){let{from:d,to:_}=r.doc.lineAt(e);return new jt(d,_-d,0,0,0)}let{firstLine:l,perLine:o,perChar:a}=this.heightMetrics(r,s),c=r.doc.lineAt(e),u=o+c.length*a,h=c.number-l,f=n+o*h+a*(c.from-s-h);return new jt(c.from,c.length,Math.max(n,Math.min(f,n+this.height-u)),u,0)}forEachLine(e,t,r,n,s,l){e=Math.max(e,s),t=Math.min(t,s+this.length);let{firstLine:o,perLine:a,perChar:c}=this.heightMetrics(r,s);for(let u=e,h=n;u<=t;){let f=r.doc.lineAt(u);if(u==e){let _=f.number-o;h+=a*_+c*(e-s-_)}let d=a+c*f.length;l(new jt(f.from,f.length,h,d,0)),h+=d,u=f.to+1}}replace(e,t,r){let n=this.length-t;if(n>0){let s=r[r.length-1];s instanceof Je?r[r.length-1]=new Je(s.length+n):r.push(null,new Je(n-1))}if(e>0){let s=r[0];s instanceof Je?r[0]=new Je(e+s.length):r.unshift(new Je(e-1),null)}return dt.of(r)}decomposeLeft(e,t){t.push(new Je(e-1),null)}decomposeRight(e,t){t.push(null,new Je(this.length-e-1))}updateHeight(e,t=0,r=!1,n){let s=t+this.length;if(n&&n.from<=t+this.length&&n.more){let l=[],o=Math.max(t,n.from),a=-1;for(n.from>t&&l.push(new Je(n.from-t-1).updateHeight(e,t));o<=s&&n.more;){let u=e.doc.lineAt(o).length;l.length&&l.push(null);let h=n.heights[n.index++],f=0;h<0&&(f=-h,h=n.heights[n.index++]),a==-1?a=h:Math.abs(h-a)>=_s&&(a=-2);let d=new Et(u,h,f);d.outdated=!1,l.push(d),o+=u+1}o<=s&&l.push(null,new Je(s-o).updateHeight(e,o));let c=dt.of(l);return(a<0||Math.abs(c.height-this.height)>=_s||Math.abs(a-this.heightMetrics(e,t).perLine)>=_s)&&(Dr=!0),Ps(this,c)}else(r||this.outdated)&&(this.setHeight(e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class Dk extends dt{constructor(e,t,r){super(e.length+t+r.length,e.height+r.height,t|(e.outdated||r.outdated?2:0)),this.left=e,this.right=r,this.size=e.size+r.size}get break(){return this.flags&1}blockAt(e,t,r,n){let s=r+this.left.height;return e<s?this.left.blockAt(e,t,r,n):this.right.blockAt(e,t,s,n+this.left.length+this.break)}lineAt(e,t,r,n,s){let l=n+this.left.height,o=s+this.left.length+this.break,a=t==Ie.ByHeight?e<l:e<o,c=a?this.left.lineAt(e,t,r,n,s):this.right.lineAt(e,t,r,l,o);if(this.break||(a?c.to<o:c.from>o))return c;let u=t==Ie.ByPosNoHeight?Ie.ByPosNoHeight:Ie.ByPos;return a?c.join(this.right.lineAt(o,u,r,l,o)):this.left.lineAt(o,u,r,n,s).join(c)}forEachLine(e,t,r,n,s,l){let o=n+this.left.height,a=s+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,r,n,s,l),t>=a&&this.right.forEachLine(e,t,r,o,a,l);else{let c=this.lineAt(a,Ie.ByPos,r,n,s);e<c.from&&this.left.forEachLine(e,c.from-1,r,n,s,l),c.to>=e&&c.from<=t&&l(c),t>c.to&&this.right.forEachLine(c.to+1,t,r,o,a,l)}}replace(e,t,r){let n=this.left.length+this.break;if(t<n)return this.balanced(this.left.replace(e,t,r),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-n,t-n,r));let s=[];e>0&&this.decomposeLeft(e,s);let l=s.length;for(let o of r)s.push(o);if(e>0&&cu(s,l-1),t<this.length){let o=s.length;this.decomposeRight(t,s),cu(s,o)}return dt.of(s)}decomposeLeft(e,t){let r=this.left.length;if(e<=r)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(r++,e>=r&&t.push(null)),e>r&&this.right.decomposeLeft(e-r,t)}decomposeRight(e,t){let r=this.left.length,n=r+this.break;if(e>=n)return this.right.decomposeRight(e-n,t);e<r&&this.left.decomposeRight(e,t),this.break&&e<n&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?dt.of(this.break?[e,null,t]:[e,t]):(this.left=Ps(this.left,e),this.right=Ps(this.right,t),this.setHeight(e.height+t.height),this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,r=!1,n){let{left:s,right:l}=this,o=t+s.length+this.break,a=null;return n&&n.from<=t+s.length&&n.more?a=s=s.updateHeight(e,t,r,n):s.updateHeight(e,t,r),n&&n.from<=o+l.length&&n.more?a=l=l.updateHeight(e,o,r,n):l.updateHeight(e,o,r),a?this.balanced(s,l):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function cu(i,e){let t,r;i[e]==null&&(t=i[e-1])instanceof Je&&(r=i[e+1])instanceof Je&&i.splice(e-1,3,new Je(t.length+1+r.length))}const Mk=5;class nc{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let r=Math.min(t,this.lineEnd),n=this.nodes[this.nodes.length-1];n instanceof Et?n.length+=r-this.pos:(r>this.pos||!this.isCovered)&&this.nodes.push(new Et(r-this.pos,-1,0)),this.writtenTo=r,t>r&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,r){if(e<t||r.heightRelevant){let n=r.widget?r.widget.estimatedHeight:0,s=r.widget?r.widget.lineBreaks:0;n<0&&(n=this.oracle.lineHeight);let l=t-e;r.block?this.addBlock(new Up(l,n,r)):(l||s||n>=Mk)&&this.addLineDeco(n,s,l)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new Et(this.pos-e,-1,0)),this.writtenTo=this.pos}blankContent(e,t){let r=new Je(t-e);return this.oracle.doc.lineAt(e).to==t&&(r.flags|=4),r}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof Et)return e;let t=new Et(0,-1,0);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,r){let n=this.ensureLine();n.length+=r,n.collapsed+=r,n.widgetHeight=Math.max(n.widgetHeight,e),n.breaks+=t,this.writtenTo=this.pos=this.pos+r}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof Et)&&!this.isCovered?this.nodes.push(new Et(0,-1,0)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let r=e;for(let n of this.nodes)n instanceof Et&&n.updateHeight(this.oracle,r),r+=n?n.length:1;return this.nodes}static build(e,t,r,n){let s=new nc(r,e);return ye.spans(t,r,n,s,0),s.finish(r)}}function Lk(i,e,t){let r=new Tk;return ye.compare(i,e,t,r,0),r.changes}class Tk{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,r,n){(e<t||r&&r.heightRelevant||n&&n.heightRelevant)&&vr(e,t,this.changes,5)}}function Rk(i,e){let t=i.getBoundingClientRect(),r=i.ownerDocument,n=r.defaultView||window,s=Math.max(0,t.left),l=Math.min(n.innerWidth,t.right),o=Math.max(0,t.top),a=Math.min(n.innerHeight,t.bottom);for(let c=i.parentNode;c&&c!=r.body;)if(c.nodeType==1){let u=c,h=window.getComputedStyle(u);if((u.scrollHeight>u.clientHeight||u.scrollWidth>u.clientWidth)&&h.overflow!="visible"){let f=u.getBoundingClientRect();s=Math.max(s,f.left),l=Math.min(l,f.right),o=Math.max(o,f.top),a=Math.min(c==i.parentNode?n.innerHeight:a,f.bottom)}c=h.position=="absolute"||h.position=="fixed"?u.offsetParent:u.parentNode}else if(c.nodeType==11)c=c.host;else break;return{left:s-t.left,right:Math.max(s,l)-t.left,top:o-(t.top+e),bottom:Math.max(o,a)-(t.top+e)}}function Bk(i){let e=i.getBoundingClientRect(),t=i.ownerDocument.defaultView||window;return e.left<t.innerWidth&&e.right>0&&e.top<t.innerHeight&&e.bottom>0}function Ok(i,e){let t=i.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class Qo{constructor(e,t,r,n){this.from=e,this.to=t,this.size=r,this.displaySize=n}static same(e,t){if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++){let n=e[r],s=t[r];if(n.from!=s.from||n.to!=s.to||n.size!=s.size)return!1}return!0}draw(e,t){return he.replace({widget:new Pk(this.displaySize*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}}class Pk extends Fi{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class hu{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=uu,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Fe.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(ec).some(r=>typeof r!="function"&&r.class=="cm-lineWrapping");this.heightOracle=new Ck(t),this.stateDeco=fu(e),this.heightMap=dt.empty().applyChanges(this.stateDeco,Ae.empty,this.heightOracle.setDoc(e.doc),[new Bt(0,0,0,e.doc.length)]);for(let r=0;r<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());r++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=he.set(this.lineGaps.map(r=>r.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let r=0;r<=1;r++){let n=r?t.head:t.anchor;if(!e.some(({from:s,to:l})=>n>=s&&n<=l)){let{from:s,to:l}=this.lineBlockAt(n);e.push(new Xn(s,l))}}return this.viewports=e.sort((r,n)=>r.from-n.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?uu:new sc(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(Yr(e,this.scaler))})}update(e,t=null){this.state=e.state;let r=this.stateDeco;this.stateDeco=fu(this.state);let n=e.changedRanges,s=Bt.extendWithRanges(n,Lk(r,this.stateDeco,e?e.changes:qe.empty(this.state.doc.length))),l=this.heightMap.height,o=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);au(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),s),(this.heightMap.height!=l||Dr)&&(e.flags|=2),o?(this.scrollAnchorPos=e.changes.mapPos(o.from,-1),this.scrollAnchorHeight=o.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=l);let a=s.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<a.from||t.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,t));let c=a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,e.flags|=this.updateForViewport(),(c||!e.changes.empty||e.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&(e.selectionSet||e.focusChanged)&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(AS)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,r=window.getComputedStyle(t),n=this.heightOracle,s=r.whiteSpace;this.defaultTextDirection=r.direction=="rtl"?Fe.RTL:Fe.LTR;let l=this.heightOracle.mustRefreshForWrapping(s)||this.mustMeasureContent,o=t.getBoundingClientRect(),a=l||this.mustMeasureContent||this.contentDOMHeight!=o.height;this.contentDOMHeight=o.height,this.mustMeasureContent=!1;let c=0,u=0;if(o.width&&o.height){let{scaleX:b,scaleY:S}=op(t,o);(b>.005&&Math.abs(this.scaleX-b)>.005||S>.005&&Math.abs(this.scaleY-S)>.005)&&(this.scaleX=b,this.scaleY=S,c|=16,l=a=!0)}let h=(parseInt(r.paddingTop)||0)*this.scaleY,f=(parseInt(r.paddingBottom)||0)*this.scaleY;(this.paddingTop!=h||this.paddingBottom!=f)&&(this.paddingTop=h,this.paddingBottom=f,c|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(n.lineWrapping&&(a=!0),this.editorWidth=e.scrollDOM.clientWidth,c|=16);let d=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=d&&(this.scrollAnchorHeight=-1,this.scrollTop=d),this.scrolledToBottom=ap(e.scrollDOM);let _=(this.printing?Ok:Rk)(t,this.paddingTop),y=_.top-this.pixelViewport.top,p=_.bottom-this.pixelViewport.bottom;this.pixelViewport=_;let m=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(m!=this.inView&&(this.inView=m,m&&(a=!0)),!this.inView&&!this.scrollTarget&&!Bk(e.dom))return 0;let g=o.width;if((this.contentDOMWidth!=g||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=o.width,this.editorHeight=e.scrollDOM.clientHeight,c|=16),a){let b=e.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(b)&&(l=!0),l||n.lineWrapping&&Math.abs(g-this.contentDOMWidth)>n.charWidth){let{lineHeight:S,charWidth:x,textHeight:k}=e.docView.measureTextSize();l=S>0&&n.refresh(s,S,x,k,Math.max(5,g/x),b),l&&(e.docView.minWidth=0,c|=16)}y>0&&p>0?u=Math.max(y,p):y<0&&p<0&&(u=Math.min(y,p)),au();for(let S of this.viewports){let x=S.from==this.viewport.from?b:e.docView.measureVisibleLineHeights(S);this.heightMap=(l?dt.empty().applyChanges(this.stateDeco,Ae.empty,this.heightOracle,[new Bt(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(n,0,l,new Ek(S.from,x))}Dr&&(c|=2)}let v=!this.viewportIsAppropriate(this.viewport,u)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return v&&(c&2&&(c|=this.updateScaler()),this.viewport=this.getViewport(u,this.scrollTarget),c|=this.updateForViewport()),(c&2||v)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(l?[]:this.lineGaps,e)),c|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),c}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let r=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),n=this.heightMap,s=this.heightOracle,{visibleTop:l,visibleBottom:o}=this,a=new Xn(n.lineAt(l-r*1e3,Ie.ByHeight,s,0,0).from,n.lineAt(o+(1-r)*1e3,Ie.ByHeight,s,0,0).to);if(t){let{head:c}=t.range;if(c<a.from||c>a.to){let u=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),h=n.lineAt(c,Ie.ByPos,s,0,0),f;t.y=="center"?f=(h.top+h.bottom)/2-u/2:t.y=="start"||t.y=="nearest"&&c<a.from?f=h.top:f=h.bottom-u,a=new Xn(n.lineAt(f-1e3/2,Ie.ByHeight,s,0,0).from,n.lineAt(f+u+1e3/2,Ie.ByHeight,s,0,0).to)}}return a}mapViewport(e,t){let r=t.mapPos(e.from,-1),n=t.mapPos(e.to,1);return new Xn(this.heightMap.lineAt(r,Ie.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(n,Ie.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},r=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(e,Ie.ByPos,this.heightOracle,0,0),{bottom:s}=this.heightMap.lineAt(t,Ie.ByPos,this.heightOracle,0,0),{visibleTop:l,visibleBottom:o}=this;return(e==0||n<=l-Math.max(10,Math.min(-r,250)))&&(t==this.state.doc.length||s>=o+Math.max(10,Math.min(r,250)))&&n>l-2*1e3&&s<o+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let r=[];for(let n of e)t.touchesRange(n.from,n.to)||r.push(new Qo(t.mapPos(n.from),t.mapPos(n.to),n.size,n.displaySize));return r}ensureLineGaps(e,t){let r=this.heightOracle.lineWrapping,n=r?1e4:2e3,s=n>>1,l=n<<1;if(this.defaultTextDirection!=Fe.LTR&&!r)return[];let o=[],a=(u,h,f,d)=>{if(h-u<s)return;let _=this.state.selection.main,y=[_.from];_.empty||y.push(_.to);for(let m of y)if(m>u&&m<h){a(u,m-10,f,d),a(m+10,h,f,d);return}let p=Nk(e,m=>m.from>=f.from&&m.to<=f.to&&Math.abs(m.from-u)<s&&Math.abs(m.to-h)<s&&!y.some(g=>m.from<g&&m.to>g));if(!p){if(h<f.to&&t&&r&&t.visibleRanges.some(v=>v.from<=h&&v.to>=h)){let v=t.moveToLineBoundary(G.cursor(h),!1,!0).head;v>u&&(h=v)}let m=this.gapSize(f,u,h,d),g=r||m<2e6?m:2e6;p=new Qo(u,h,m,g)}o.push(p)},c=u=>{if(u.length<l||u.type!=bt.Text)return;let h=Ik(u.from,u.to,this.stateDeco);if(h.total<l)return;let f=this.scrollTarget?this.scrollTarget.range.head:null,d,_;if(r){let y=n/this.heightOracle.lineLength*this.heightOracle.lineHeight,p,m;if(f!=null){let g=Yn(h,f),v=((this.visibleBottom-this.visibleTop)/2+y)/u.height;p=g-v,m=g+v}else p=(this.visibleTop-u.top-y)/u.height,m=(this.visibleBottom-u.top+y)/u.height;d=Jn(h,p),_=Jn(h,m)}else{let y=h.total*this.heightOracle.charWidth,p=n*this.heightOracle.charWidth,m=0;if(y>2e6)for(let x of e)x.from>=u.from&&x.from<u.to&&x.size!=x.displaySize&&x.from*this.heightOracle.charWidth+m<this.pixelViewport.left&&(m=x.size-x.displaySize);let g=this.pixelViewport.left+m,v=this.pixelViewport.right+m,b,S;if(f!=null){let x=Yn(h,f),k=((v-g)/2+p)/y;b=x-k,S=x+k}else b=(g-p)/y,S=(v+p)/y;d=Jn(h,b),_=Jn(h,S)}d>u.from&&a(u.from,d,u,h),_<u.to&&a(_,u.to,u,h)};for(let u of this.viewportLines)Array.isArray(u.type)?u.type.forEach(c):c(u);return o}gapSize(e,t,r,n){let s=Yn(n,r)-Yn(n,t);return this.heightOracle.lineWrapping?e.height*s:n.total*this.heightOracle.charWidth*s}updateLineGaps(e){Qo.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=he.set(e.map(t=>t.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(e){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let r=[];ye.spans(t,this.viewport.from,this.viewport.to,{span(s,l){r.push({from:s,to:l})},point(){}},20);let n=0;if(r.length!=this.visibleRanges.length)n=12;else for(let s=0;s<r.length&&!(n&8);s++){let l=this.visibleRanges[s],o=r[s];(l.from!=o.from||l.to!=o.to)&&(n|=4,e&&e.mapPos(l.from,-1)==o.from&&e.mapPos(l.to,1)==o.to||(n|=8))}return this.visibleRanges=r,n}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||Yr(this.heightMap.lineAt(e,Ie.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(t=>t.top<=e&&t.bottom>=e)||Yr(this.heightMap.lineAt(this.scaler.fromDOM(e),Ie.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return Yr(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Xn{constructor(e,t){this.from=e,this.to=t}}function Ik(i,e,t){let r=[],n=i,s=0;return ye.spans(t,i,e,{span(){},point(l,o){l>n&&(r.push({from:n,to:l}),s+=l-n),n=o}},20),n<e&&(r.push({from:n,to:e}),s+=e-n),{total:s,ranges:r}}function Jn({total:i,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let r=Math.floor(i*t);for(let n=0;;n++){let{from:s,to:l}=e[n],o=l-s;if(r<=o)return s+r;r-=o}}function Yn(i,e){let t=0;for(let{from:r,to:n}of i.ranges){if(e<=n){t+=e-r;break}t+=n-r}return t/i.total}function Nk(i,e){for(let t of i)if(e(t))return t}const uu={toDOM(i){return i},fromDOM(i){return i},scale:1,eq(i){return i==this}};function fu(i){let e=i.facet(oo).filter(r=>typeof r!="function"),t=i.facet(tc).filter(r=>typeof r!="function");return t.length&&e.push(ye.join(t)),e}class sc{constructor(e,t,r){let n=0,s=0,l=0;this.viewports=r.map(({from:o,to:a})=>{let c=t.lineAt(o,Ie.ByPos,e,0,0).top,u=t.lineAt(a,Ie.ByPos,e,0,0).bottom;return n+=u-c,{from:o,to:a,top:c,bottom:u,domTop:0,domBottom:0}}),this.scale=(7e6-n)/(t.height-n);for(let o of this.viewports)o.domTop=l+(o.top-s)*this.scale,l=o.domBottom=o.domTop+(o.bottom-o.top),s=o.bottom}toDOM(e){for(let t=0,r=0,n=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.top)return n+(e-r)*this.scale;if(e<=s.bottom)return s.domTop+(e-s.top);r=s.bottom,n=s.domBottom}}fromDOM(e){for(let t=0,r=0,n=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.domTop)return r+(e-n)/this.scale;if(e<=s.domBottom)return s.top+(e-s.domTop);r=s.bottom,n=s.domBottom}}eq(e){return e instanceof sc?this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every((t,r)=>t.from==e.viewports[r].from&&t.to==e.viewports[r].to):!1}}function Yr(i,e){if(e.scale==1)return i;let t=e.toDOM(i.top),r=e.toDOM(i.bottom);return new jt(i.from,i.length,t,r-t,Array.isArray(i._content)?i._content.map(n=>Yr(n,e)):i._content)}const Qn=oe.define({combine:i=>i.join(" ")}),na=oe.define({combine:i=>i.indexOf(!0)>-1}),sa=Ti.newName(),Vp=Ti.newName(),qp=Ti.newName(),Kp={"&light":"."+Vp,"&dark":"."+qp};function oa(i,e,t){return new Ti(e,{finish(r){return/&/.test(r)?r.replace(/&\w*/,n=>{if(n=="&")return i;if(!t||!t[n])throw new RangeError(`Unsupported selector: ${n}`);return t[n]}):i+" "+r}})}const Fk=oa("."+sa,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",zIndex:200},".cm-gutters-before":{insetInlineStart:0},".cm-gutters-after":{insetInlineEnd:0},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",border:"0px solid #ddd","&.cm-gutters-before":{borderRightWidth:"1px"},"&.cm-gutters-after":{borderLeftWidth:"1px"}},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-dialog":{padding:"2px 19px 4px 6px",position:"relative","& label":{fontSize:"80%"}},".cm-dialog-close":{position:"absolute",top:"3px",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",fontSize:"14px",padding:"0"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Kp),Hk={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Zo=ne.ie&&ne.ie_version<=11;class jk{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new mS,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let r of t)this.queue.push(r);(ne.ie&&ne.ie_version<=11||ne.ios&&e.composing)&&t.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&ne.android&&e.constructor.EDIT_CONTEXT!==!1&&!(ne.chrome&&ne.chrome_version<126)&&(this.editContext=new Wk(e),e.state.facet(hi)&&(e.contentDOM.editContext=this.editContext.editContext)),Zo&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var t;((t=this.view.docView)===null||t===void 0?void 0:t.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){(e.type=="change"||!e.type)&&!e.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,r)=>t!=e[r]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:r}=this,n=this.selectionRange;if(r.state.facet(hi)?r.root.activeElement!=this.dom:!nn(this.dom,n))return;let s=n.anchorNode&&r.docView.tile.nearest(n.anchorNode);if(s&&s.isWidget()&&s.widget.ignoreEvent(e)){t||(this.selectionChanged=!1);return}(ne.ie&&ne.ie_version<=11||ne.android&&ne.chrome)&&!r.state.selection.main.empty&&n.focusNode&&sn(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=Cr(e.root);if(!t)return!1;let r=ne.safari&&e.root.nodeType==11&&e.root.activeElement==this.dom&&zk(this.view,t)||t;if(!r||this.selectionRange.eq(r))return!1;let n=nn(this.dom,r);return n&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&vS(this.dom,r)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(r),n&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let r=this.dom;r;)if(r.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==r?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(r),r=r.assignedSlot||r.parentNode;else if(r.nodeType==11)r=r.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);for(let r of this.scrollTargets=t)r.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Hk),Zo&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Zo&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var r;if(!this.delayedAndroidKey){let n=()=>{let s=this.delayedAndroidKey;s&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=s.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&s.force&&_r(this.dom,s.key,s.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(n)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(!((r=this.delayedAndroidKey)===null||r===void 0)&&r.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,r=-1,n=!1;for(let s of e){let l=this.readMutation(s);l&&(l.typeOver&&(n=!0),t==-1?{from:t,to:r}=l:(t=Math.min(l.from,t),r=Math.max(l.to,r)))}return{from:t,to:r,typeOver:n}}readChange(){let{from:e,to:t,typeOver:r}=this.processRecords(),n=this.selectionChanged&&nn(this.dom,this.selectionRange);if(e<0&&!n)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let s=new sk(this.view,e,t,r);return this.view.docView.domChanged={newSel:s.newSel?s.newSel.main:null},s}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return this.view.requestMeasure(),!1;let r=this.view.state,n=Op(this.view,t);return this.view.state==r&&(t.domChanged||t.newSel&&!Os(this.view.state.selection,t.newSel.main))&&this.view.update([]),n}readMutation(e){let t=this.view.docView.tile.nearest(e.target);if(!t||t.isWidget())return null;if(t.markDirty(e.type=="attributes"),e.type=="childList"){let r=du(t,e.previousSibling||e.target.previousSibling,-1),n=du(t,e.nextSibling||e.target.nextSibling,1);return{from:r?t.posAfter(r):t.posAtStart,to:n?t.posBefore(n):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(hi)!=e.state.facet(hi)&&(e.view.contentDOM.editContext=e.state.facet(hi)?this.editContext.editContext:null))}destroy(){var e,t,r;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(r=this.resizeScroll)===null||r===void 0||r.disconnect();for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function du(i,e,t){for(;e;){let r=$e.get(e);if(r&&r.parent==i)return r;let n=e.parentNode;e=n!=i.dom?n:t>0?e.nextSibling:e.previousSibling}return null}function pu(i,e){let t=e.startContainer,r=e.startOffset,n=e.endContainer,s=e.endOffset,l=i.docView.domAtPos(i.state.selection.main.anchor,1);return sn(l.node,l.offset,n,s)&&([t,r,n,s]=[n,s,t,r]),{anchorNode:t,anchorOffset:r,focusNode:n,focusOffset:s}}function zk(i,e){if(e.getComposedRanges){let n=e.getComposedRanges(i.root)[0];if(n)return pu(i,n)}let t=null;function r(n){n.preventDefault(),n.stopImmediatePropagation(),t=n.getTargetRanges()[0]}return i.contentDOM.addEventListener("beforeinput",r,!0),i.dom.ownerDocument.execCommand("indent"),i.contentDOM.removeEventListener("beforeinput",r,!0),t?pu(i,t):null}class Wk{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let t=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=r=>{let n=e.state.selection.main,{anchor:s,head:l}=n,o=this.toEditorPos(r.updateRangeStart),a=this.toEditorPos(r.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:r.updateRangeStart,editorBase:o,drifted:!1});let c=a-o>r.text.length;o==this.from&&s<this.from?o=s:a==this.to&&s>this.to&&(a=s);let u=Pp(e.state.sliceDoc(o,a),r.text,(c?n.from:n.to)-o,c?"end":null);if(!u){let f=G.single(this.toEditorPos(r.selectionStart),this.toEditorPos(r.selectionEnd));Os(f,n)||e.dispatch({selection:f,userEvent:"select"});return}let h={from:u.from+o,to:u.toA+o,insert:Ae.of(r.text.slice(u.from,u.toB).split(`
`))};if((ne.mac||ne.android)&&h.from==l-1&&/^\. ?$/.test(r.text)&&e.contentDOM.getAttribute("autocorrect")=="off"&&(h={from:o,to:a,insert:Ae.of([r.text.replace("."," ")])}),this.pendingContextChange=h,!e.state.readOnly){let f=this.to-this.from+(h.to-h.from+h.insert.length);rc(e,h,G.single(this.toEditorPos(r.selectionStart,f),this.toEditorPos(r.selectionEnd,f)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state)),h.from<h.to&&!h.insert.length&&e.inputState.composing>=0&&!/[\\p{Alphabetic}\\p{Number}_]/.test(t.text.slice(Math.max(0,r.updateRangeStart-1),Math.min(t.text.length,r.updateRangeStart+1)))&&this.handlers.compositionend(r)},this.handlers.characterboundsupdate=r=>{let n=[],s=null;for(let l=this.toEditorPos(r.rangeStart),o=this.toEditorPos(r.rangeEnd);l<o;l++){let a=e.coordsForChar(l);s=a&&new DOMRect(a.left,a.top,a.right-a.left,a.bottom-a.top)||s||new DOMRect,n.push(s)}t.updateCharacterBounds(r.rangeStart,n)},this.handlers.textformatupdate=r=>{let n=[];for(let s of r.getTextFormats()){let l=s.underlineStyle,o=s.underlineThickness;if(!/none/i.test(l)&&!/none/i.test(o)){let a=this.toEditorPos(s.rangeStart),c=this.toEditorPos(s.rangeEnd);if(a<c){let u=`text-decoration: underline ${/^[a-z]/.test(l)?l+" ":l=="Dashed"?"dashed ":l=="Squiggle"?"wavy ":""}${/thin/i.test(o)?1:2}px`;n.push(he.mark({attributes:{style:u}}).range(a,c))}}}e.dispatch({effects:kp.of(he.set(n))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:r}=this.composing;this.composing=null,r&&this.reset(e.state)}};for(let r in this.handlers)t.addEventListener(r,this.handlers[r]);this.measureReq={read:r=>{this.editContext.updateControlBounds(r.contentDOM.getBoundingClientRect());let n=Cr(r.root);n&&n.rangeCount&&this.editContext.updateSelectionBounds(n.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let t=0,r=!1,n=this.pendingContextChange;return e.changes.iterChanges((s,l,o,a,c)=>{if(r)return;let u=c.length-(l-s);if(n&&l>=n.to)if(n.from==s&&n.to==l&&n.insert.eq(c)){n=this.pendingContextChange=null,t+=u,this.to+=u;return}else n=null,this.revertPending(e.state);if(s+=t,l+=t,l<=this.from)this.from+=u,this.to+=u;else if(s<this.to){if(s<this.from||l>this.to||this.to-this.from+c.length>3e4){r=!0;return}this.editContext.updateText(this.toContextPos(s),this.toContextPos(l),c.toString()),this.to+=u}t+=u}),n&&!r&&this.revertPending(e.state),!r}update(e){let t=this.pendingContextChange,r=e.startState.selection.main;this.composing&&(this.composing.drifted||!e.changes.touchesRange(r.from,r.to)&&e.transactions.some(n=>!n.isUserEvent("input.type")&&n.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):!this.applyEdits(e)||!this.rangeIsValid(e.state)?(this.pendingContextChange=null,this.reset(e.state)):(e.docChanged||e.selectionSet||t)&&this.setSelection(e.state),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:t}=e.selection.main;this.from=Math.max(0,t-1e4),this.to=Math.min(e.doc.length,t+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let t=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(t.from),this.toContextPos(t.from+t.insert.length),e.doc.sliceString(t.from,t.to))}setSelection(e){let{main:t}=e.selection,r=this.toContextPos(Math.max(this.from,Math.min(this.to,t.anchor))),n=this.toContextPos(t.head);(this.editContext.selectionStart!=r||this.editContext.selectionEnd!=n)&&this.editContext.updateSelection(r,n)}rangeIsValid(e){let{head:t}=e.selection.main;return!(this.from>0&&t-this.from<500||this.to<e.doc.length&&this.to-t<500||this.to-this.from>1e4*3)}toEditorPos(e,t=this.to-this.from){e=Math.min(e,t);let r=this.composing;return r&&r.drifted?r.editorBase+(e-r.contextBase):e+this.from}toContextPos(e){let t=this.composing;return t&&t.drifted?t.contextBase+(e-t.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}class se{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return!!this.inputState&&this.inputState.composing>0}get compositionStarted(){return!!this.inputState&&this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var t;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:r}=e;this.dispatchTransactions=e.dispatchTransactions||r&&(n=>n.forEach(s=>r(s,this)))||(n=>this.update(n)),this.dispatch=this.dispatch.bind(this),this._root=e.root||gS(e.parent)||document,this.viewState=new hu(e.state||Ce.create(e)),e.scrollTo&&e.scrollTo.is(qn)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(hr).map(n=>new Ko(n));for(let n of this.plugins)n.update(this);this.observer=new jk(this),this.inputState=new ck(this),this.inputState.ensureHandlers(this.plugins),this.docView=new Jh(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((t=document.fonts)===null||t===void 0)&&t.ready&&document.fonts.ready.then(()=>{this.viewState.mustMeasureContent=!0,this.requestMeasure()})}dispatch(...e){let t=e.length==1&&e[0]instanceof ze?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,r=!1,n,s=this.state;for(let f of e){if(f.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=f.state}if(this.destroyed){this.viewState.state=s;return}let l=this.hasFocus,o=0,a=null;e.some(f=>f.annotation(zp))?(this.inputState.notifiedFocused=l,o=1):l!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=l,a=Wp(s,l),a||(o=1));let c=this.observer.delayedAndroidKey,u=null;if(c?(this.observer.clearDelayedAndroidKey(),u=this.observer.readChange(),(u&&!this.state.doc.eq(s.doc)||!this.state.selection.eq(s.selection))&&(u=null)):this.observer.clear(),s.facet(Ce.phrases)!=this.state.facet(Ce.phrases))return this.setState(s);n=Ts.create(this,s,e),n.flags|=o;let h=this.viewState.scrollTarget;try{this.updateState=2;for(let f of e){if(h&&(h=h.map(f.changes)),f.scrollIntoView){let{main:d}=f.state.selection;h=new yr(d.empty?d:G.cursor(d.head,d.head>d.anchor?-1:1))}for(let d of f.effects)d.is(qn)&&(h=d.value.clip(this.state))}this.viewState.update(n,h),this.bidiCache=Is.update(this.bidiCache,n.changes),n.empty||(this.updatePlugins(n),this.inputState.update(n)),t=this.docView.update(n),this.state.facet(Xr)!=this.styleModules&&this.mountStyles(),r=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(f=>f.isUserEvent("select.pointer")))}finally{this.updateState=0}if(n.startState.facet(Qn)!=n.state.facet(Qn)&&(this.viewState.mustMeasureContent=!0),(t||r||h||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),t&&this.docViewUpdate(),!n.empty)for(let f of this.state.facet(ea))try{f(n)}catch(d){_t(this.state,d,"update listener")}(a||u)&&Promise.resolve().then(()=>{a&&this.state==a.startState&&this.dispatch(a),u&&!Op(this,u)&&c.force&&_r(this.contentDOM,c.key,c.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let r of this.plugins)r.destroy(this);this.viewState=new hu(e),this.plugins=e.facet(hr).map(r=>new Ko(r)),this.pluginMap.clear();for(let r of this.plugins)r.update(this);this.docView.destroy(),this.docView=new Jh(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(hr),r=e.state.facet(hr);if(t!=r){let n=[];for(let s of r){let l=t.indexOf(s);if(l<0)n.push(new Ko(s));else{let o=this.plugins[l];o.mustUpdate=e,n.push(o)}}for(let s of this.plugins)s.mustUpdate!=e&&s.destroy(this);this.plugins=n,this.pluginMap.clear()}else for(let n of this.plugins)n.mustUpdate=e;for(let n=0;n<this.plugins.length;n++)this.plugins[n].update(this);t!=r&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let t=e.value;if(t&&t.docViewUpdate)try{t.docViewUpdate(this)}catch(r){_t(this.state,r,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,r=this.scrollDOM,n=r.scrollTop*this.scaleY,{scrollAnchorPos:s,scrollAnchorHeight:l}=this.viewState;Math.abs(n-this.viewState.scrollTop)>1&&(l=-1),this.viewState.scrollAnchorHeight=-1;try{for(let o=0;;o++){if(l<0)if(ap(r))s=-1,l=this.viewState.heightMap.height;else{let d=this.viewState.scrollAnchorAt(n);s=d.from,l=d.top}this.updateState=1;let a=this.viewState.measure(this);if(!a&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(o>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let c=[];a&4||([this.measureRequests,c]=[c,this.measureRequests]);let u=c.map(d=>{try{return d.read(this)}catch(_){return _t(this.state,_),mu}}),h=Ts.create(this,this.state,[]),f=!1;h.flags|=a,t?t.flags|=a:t=h,this.updateState=2,h.empty||(this.updatePlugins(h),this.inputState.update(h),this.updateAttrs(),f=this.docView.update(h),f&&this.docViewUpdate());for(let d=0;d<c.length;d++)if(u[d]!=mu)try{let _=c[d];_.write&&_.write(u[d],this)}catch(_){_t(this.state,_)}if(f&&this.docView.updateSelection(!0),!h.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=-1;continue}else{let _=(s<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(s).top)-l;if(_>1||_<-1){n=n+_,r.scrollTop=n/this.scaleY,l=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let o of this.state.facet(ea))o(t)}get themeClasses(){return sa+" "+(this.state.facet(na)?qp:Vp)+" "+this.state.facet(Qn)}updateAttrs(){let e=gu(this,Cp,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(hi)?"true":"false",class:"cm-content",style:`${ne.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),gu(this,ec,t);let r=this.observer.ignore(()=>{let n=Uh(this.contentDOM,this.contentAttrs,t),s=Uh(this.dom,this.editorAttrs,e);return n||s});return this.editorAttrs=e,this.contentAttrs=t,r}showAnnouncements(e){let t=!0;for(let r of e)for(let n of r.effects)if(n.is(se.announce)){t&&(this.announceDOM.textContent=""),t=!1;let s=this.announceDOM.appendChild(document.createElement("div"));s.textContent=n.value}}mountStyles(){this.styleModules=this.state.facet(Xr);let e=this.state.facet(se.cspNonce);Ti.mount(this.root,this.styleModules.concat(Fk).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.plugin!=e)&&this.pluginMap.set(e,t=this.plugins.find(r=>r.plugin==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,r){return Yo(this,e,Yh(this,e,t,r))}moveByGroup(e,t){return Yo(this,e,Yh(this,e,t,r=>ek(this,e.head,r)))}visualLineSide(e,t){let r=this.bidiSpans(e),n=this.textDirectionAt(e.from),s=r[t?r.length-1:0];return G.cursor(s.side(t,n)+e.from,s.forward(!t,n)?1:-1)}moveToLineBoundary(e,t,r=!0){return ZS(this,e,t,r)}moveVertically(e,t,r){return Yo(this,e,tk(this,e,t,r))}domAtPos(e,t=1){return this.docView.domAtPos(e,t)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){this.readMeasured();let r=ia(this,e,t);return r&&r.pos}posAndSideAtCoords(e,t=!0){return this.readMeasured(),ia(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let r=this.docView.coordsAt(e,t);if(!r||r.left==r.right)return r;let n=this.state.doc.lineAt(e),s=this.bidiSpans(n),l=s[ui.find(s,e-n.from,-1,t)];return Ls(r,l.dir==Fe.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(wp)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>$k)return pp(e.length);let t=this.textDirectionAt(e.from),r;for(let s of this.bidiCache)if(s.from==e.from&&s.dir==t&&(s.fresh||dp(s.isolates,r=Kh(this,e))))return s.order;r||(r=Kh(this,e));let n=kS(e.text,t,r);return this.bidiCache.push(new Is(e.from,e.to,t,r,!0,n)),n}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||ne.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{lp(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return qn.of(new yr(typeof e=="number"?G.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:t}=this.scrollDOM,r=this.viewState.scrollAnchorAt(e);return qn.of(new yr(G.cursor(r.from),"start","start",r.top-e,t,!0))}setTabFocusMode(e){e==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof e=="boolean"?this.inputState.tabFocusMode=e?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return st.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return st.define(()=>({}),{eventObservers:e})}static theme(e,t){let r=Ti.newName(),n=[Qn.of(r),Xr.of(oa(`.${r}`,e))];return t&&t.dark&&n.push(na.of(!0)),n}static baseTheme(e){return nr.lowest(Xr.of(oa("."+sa,e,Kp)))}static findFromDOM(e){var t;let r=e.querySelector(".cm-content"),n=r&&$e.get(r)||$e.get(e);return((t=n==null?void 0:n.root)===null||t===void 0?void 0:t.view)||null}}se.styleModule=Xr;se.inputHandler=bp;se.clipboardInputFilter=Qa;se.clipboardOutputFilter=Za;se.scrollHandler=Sp;se.focusChangeEffect=xp;se.perLineTextDirection=wp;se.exceptionSink=yp;se.updateListener=ea;se.editable=hi;se.mouseSelectionStyle=_p;se.dragMovesSelection=vp;se.clickAddsSelectionRange=gp;se.decorations=oo;se.blockWrappers=Ep;se.outerDecorations=tc;se.atomicRanges=Bn;se.bidiIsolatedRanges=Ap;se.scrollMargins=Dp;se.darkTheme=na;se.cspNonce=oe.define({combine:i=>i.length?i[0]:""});se.contentAttributes=ec;se.editorAttributes=Cp;se.lineWrapping=se.contentAttributes.of({class:"cm-lineWrapping"});se.announce=pe.define();const $k=4096,mu={};class Is{constructor(e,t,r,n,s,l){this.from=e,this.to=t,this.dir=r,this.isolates=n,this.fresh=s,this.order=l}static update(e,t){if(t.empty&&!e.some(s=>s.fresh))return e;let r=[],n=e.length?e[e.length-1].dir:Fe.LTR;for(let s=Math.max(0,e.length-10);s<e.length;s++){let l=e[s];l.dir==n&&!t.touchesRange(l.from,l.to)&&r.push(new Is(t.mapPos(l.from,1),t.mapPos(l.to,-1),l.dir,l.isolates,!1,l.order))}return r}}function gu(i,e,t){for(let r=i.state.facet(e),n=r.length-1;n>=0;n--){let s=r[n],l=typeof s=="function"?s(i):s;l&&Xa(l,t)}return t}const Uk=ne.mac?"mac":ne.windows?"win":ne.linux?"linux":"key";function Vk(i,e){const t=i.split(/-(?!$)/);let r=t[t.length-1];r=="Space"&&(r=" ");let n,s,l,o;for(let a=0;a<t.length-1;++a){const c=t[a];if(/^(cmd|meta|m)$/i.test(c))o=!0;else if(/^a(lt)?$/i.test(c))n=!0;else if(/^(c|ctrl|control)$/i.test(c))s=!0;else if(/^s(hift)?$/i.test(c))l=!0;else if(/^mod$/i.test(c))e=="mac"?o=!0:s=!0;else throw new Error("Unrecognized modifier name: "+c)}return n&&(r="Alt-"+r),s&&(r="Ctrl-"+r),o&&(r="Meta-"+r),l&&(r="Shift-"+r),r}function Zn(i,e,t){return e.altKey&&(i="Alt-"+i),e.ctrlKey&&(i="Ctrl-"+i),e.metaKey&&(i="Meta-"+i),t!==!1&&e.shiftKey&&(i="Shift-"+i),i}const qk=nr.default(se.domEventHandlers({keydown(i,e){return Xp(Gp(e.state),i,e,"editor")}})),ho=oe.define({enables:qk}),vu=new WeakMap;function Gp(i){let e=i.facet(ho),t=vu.get(e);return t||vu.set(e,t=Xk(e.reduce((r,n)=>r.concat(n),[]))),t}function Kk(i,e,t){return Xp(Gp(i.state),e,i,t)}let ki=null;const Gk=4e3;function Xk(i,e=Uk){let t=Object.create(null),r=Object.create(null),n=(l,o)=>{let a=r[l];if(a==null)r[l]=o;else if(a!=o)throw new Error("Key binding "+l+" is used both as a regular binding and as a multi-stroke prefix")},s=(l,o,a,c,u)=>{var h,f;let d=t[l]||(t[l]=Object.create(null)),_=o.split(/ (?!$)/).map(m=>Vk(m,e));for(let m=1;m<_.length;m++){let g=_.slice(0,m).join(" ");n(g,!0),d[g]||(d[g]={preventDefault:!0,stopPropagation:!1,run:[v=>{let b=ki={view:v,prefix:g,scope:l};return setTimeout(()=>{ki==b&&(ki=null)},Gk),!0}]})}let y=_.join(" ");n(y,!1);let p=d[y]||(d[y]={preventDefault:!1,stopPropagation:!1,run:((f=(h=d._any)===null||h===void 0?void 0:h.run)===null||f===void 0?void 0:f.slice())||[]});a&&p.run.push(a),c&&(p.preventDefault=!0),u&&(p.stopPropagation=!0)};for(let l of i){let o=l.scope?l.scope.split(" "):["editor"];if(l.any)for(let c of o){let u=t[c]||(t[c]=Object.create(null));u._any||(u._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:h}=l;for(let f in u)u[f].run.push(d=>h(d,la))}let a=l[e]||l.key;if(a)for(let c of o)s(c,a,l.run,l.preventDefault,l.stopPropagation),l.shift&&s(c,"Shift-"+a,l.shift,l.preventDefault,l.stopPropagation)}return t}let la=null;function Xp(i,e,t,r){la=e;let n=lS(e),s=At(n,0),l=ti(s)==n.length&&n!=" ",o="",a=!1,c=!1,u=!1;ki&&ki.view==t&&ki.scope==r&&(o=ki.prefix+" ",Np.indexOf(e.keyCode)<0&&(c=!0,ki=null));let h=new Set,f=p=>{if(p){for(let m of p.run)if(!h.has(m)&&(h.add(m),m(t)))return p.stopPropagation&&(u=!0),!0;p.preventDefault&&(p.stopPropagation&&(u=!0),c=!0)}return!1},d=i[r],_,y;return d&&(f(d[o+Zn(n,e,!l)])?a=!0:l&&(e.altKey||e.metaKey||e.ctrlKey)&&!(ne.windows&&e.ctrlKey&&e.altKey)&&!(ne.mac&&e.altKey&&!(e.ctrlKey||e.metaKey))&&(_=Ri[e.keyCode])&&_!=n?(f(d[o+Zn(_,e,!0)])||e.shiftKey&&(y=fn[e.keyCode])!=n&&y!=_&&f(d[o+Zn(y,e,!1)]))&&(a=!0):l&&e.shiftKey&&f(d[o+Zn(n,e,!0)])&&(a=!0),!a&&f(d._any)&&(a=!0)),c&&(a=!0),a&&u&&e.stopPropagation(),la=null,a}function Jk(){return Qk}const Yk=he.line({class:"cm-activeLine"}),Qk=st.fromClass(class{constructor(i){this.decorations=this.getDeco(i)}update(i){(i.docChanged||i.selectionSet)&&(this.decorations=this.getDeco(i.view))}getDeco(i){let e=-1,t=[];for(let r of i.state.selection.ranges){let n=i.lineBlockAt(r.head);n.from>e&&(t.push(Yk.range(n.from)),e=n.from)}return he.set(t)}},{decorations:i=>i.decorations}),es="-10000px";class Jp{constructor(e,t,r,n){this.facet=t,this.createTooltipView=r,this.removeTooltipView=n,this.input=e.state.facet(t),this.tooltips=this.input.filter(l=>l);let s=null;this.tooltipViews=this.tooltips.map(l=>s=r(l,s))}update(e,t){var r;let n=e.state.facet(this.facet),s=n.filter(a=>a);if(n===this.input){for(let a of this.tooltipViews)a.update&&a.update(e);return!1}let l=[],o=t?[]:null;for(let a=0;a<s.length;a++){let c=s[a],u=-1;if(c){for(let h=0;h<this.tooltips.length;h++){let f=this.tooltips[h];f&&f.create==c.create&&(u=h)}if(u<0)l[a]=this.createTooltipView(c,a?l[a-1]:null),o&&(o[a]=!!c.above);else{let h=l[a]=this.tooltipViews[u];o&&(o[a]=t[u]),h.update&&h.update(e)}}}for(let a of this.tooltipViews)l.indexOf(a)<0&&(this.removeTooltipView(a),(r=a.destroy)===null||r===void 0||r.call(a));return t&&(o.forEach((a,c)=>t[c]=a),t.length=o.length),this.input=n,this.tooltips=s,this.tooltipViews=l,!0}}function Zk(i){let e=i.dom.ownerDocument.documentElement;return{top:0,left:0,bottom:e.clientHeight,right:e.clientWidth}}const el=oe.define({combine:i=>{var e,t,r;return{position:ne.ios?"absolute":((e=i.find(n=>n.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((t=i.find(n=>n.parent))===null||t===void 0?void 0:t.parent)||null,tooltipSpace:((r=i.find(n=>n.tooltipSpace))===null||r===void 0?void 0:r.tooltipSpace)||Zk}}}),_u=new WeakMap,oc=st.fromClass(class{constructor(i){this.view=i,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let e=i.state.facet(el);this.position=e.position,this.parent=e.parent,this.classes=i.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver=typeof ResizeObserver=="function"?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new Jp(i,lc,(t,r)=>this.createTooltip(t,r),t=>{this.resizeObserver&&this.resizeObserver.unobserve(t.dom),t.dom.remove()}),this.above=this.manager.tooltips.map(t=>!!t.above),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(t=>{Date.now()>this.lastTransaction-50&&t.length>0&&t[t.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),i.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let i of this.manager.tooltipViews)this.intersectionObserver.observe(i.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(i){i.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(i,this.above);e&&this.observeIntersection();let t=e||i.geometryChanged,r=i.state.facet(el);if(r.position!=this.position&&!this.madeAbsolute){this.position=r.position;for(let n of this.manager.tooltipViews)n.dom.style.position=this.position;t=!0}if(r.parent!=this.parent){this.parent&&this.container.remove(),this.parent=r.parent,this.createContainer();for(let n of this.manager.tooltipViews)this.container.appendChild(n.dom);t=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);t&&this.maybeMeasure()}createTooltip(i,e){let t=i.create(this.view),r=e?e.dom:null;if(t.dom.classList.add("cm-tooltip"),i.arrow&&!t.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let n=document.createElement("div");n.className="cm-tooltip-arrow",t.dom.appendChild(n)}return t.dom.style.position=this.position,t.dom.style.top=es,t.dom.style.left="0px",this.container.insertBefore(t.dom,r),t.mount&&t.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(t.dom),t}destroy(){var i,e,t;this.view.win.removeEventListener("resize",this.measureSoon);for(let r of this.manager.tooltipViews)r.dom.remove(),(i=r.destroy)===null||i===void 0||i.call(r);this.parent&&this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect(),(t=this.intersectionObserver)===null||t===void 0||t.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let i=1,e=1,t=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:s}=this.manager.tooltipViews[0];if(ne.safari){let l=s.getBoundingClientRect();t=Math.abs(l.top+1e4)>1||Math.abs(l.left)>1}else t=!!s.offsetParent&&s.offsetParent!=this.container.ownerDocument.body}if(t||this.position=="absolute")if(this.parent){let s=this.parent.getBoundingClientRect();s.width&&s.height&&(i=s.width/this.parent.offsetWidth,e=s.height/this.parent.offsetHeight)}else({scaleX:i,scaleY:e}=this.view.viewState);let r=this.view.scrollDOM.getBoundingClientRect(),n=ic(this.view);return{visible:{left:r.left+n.left,top:r.top+n.top,right:r.right-n.right,bottom:r.bottom-n.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map((s,l)=>{let o=this.manager.tooltipViews[l];return o.getCoords?o.getCoords(s.pos):this.view.coordsAtPos(s.pos)}),size:this.manager.tooltipViews.map(({dom:s})=>s.getBoundingClientRect()),space:this.view.state.facet(el).tooltipSpace(this.view),scaleX:i,scaleY:e,makeAbsolute:t}}writeMeasure(i){var e;if(i.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let o of this.manager.tooltipViews)o.dom.style.position="absolute"}let{visible:t,space:r,scaleX:n,scaleY:s}=i,l=[];for(let o=0;o<this.manager.tooltips.length;o++){let a=this.manager.tooltips[o],c=this.manager.tooltipViews[o],{dom:u}=c,h=i.pos[o],f=i.size[o];if(!h||a.clip!==!1&&(h.bottom<=Math.max(t.top,r.top)||h.top>=Math.min(t.bottom,r.bottom)||h.right<Math.max(t.left,r.left)-.1||h.left>Math.min(t.right,r.right)+.1)){u.style.top=es;continue}let d=a.arrow?c.dom.querySelector(".cm-tooltip-arrow"):null,_=d?7:0,y=f.right-f.left,p=(e=_u.get(c))!==null&&e!==void 0?e:f.bottom-f.top,m=c.offset||tC,g=this.view.textDirection==Fe.LTR,v=f.width>r.right-r.left?g?r.left:r.right-f.width:g?Math.max(r.left,Math.min(h.left-(d?14:0)+m.x,r.right-y)):Math.min(Math.max(r.left,h.left-y+(d?14:0)-m.x),r.right-y),b=this.above[o];!a.strictSide&&(b?h.top-p-_-m.y<r.top:h.bottom+p+_+m.y>r.bottom)&&b==r.bottom-h.bottom>h.top-r.top&&(b=this.above[o]=!b);let S=(b?h.top-r.top:r.bottom-h.bottom)-_;if(S<p&&c.resize!==!1){if(S<this.view.defaultLineHeight){u.style.top=es;continue}_u.set(c,p),u.style.height=(p=S)/s+"px"}else u.style.height&&(u.style.height="");let x=b?h.top-p-_-m.y:h.bottom+_+m.y,k=v+y;if(c.overlap!==!0)for(let w of l)w.left<k&&w.right>v&&w.top<x+p&&w.bottom>x&&(x=b?w.top-p-2-_:w.bottom+_+2);if(this.position=="absolute"?(u.style.top=(x-i.parent.top)/s+"px",yu(u,(v-i.parent.left)/n)):(u.style.top=x/s+"px",yu(u,v/n)),d){let w=h.left+(g?m.x:-m.x)-(v+14-7);d.style.left=w/n+"px"}c.overlap!==!0&&l.push({left:v,top:x,right:k,bottom:x+p}),u.classList.toggle("cm-tooltip-above",b),u.classList.toggle("cm-tooltip-below",!b),c.positioned&&c.positioned(i.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let i of this.manager.tooltipViews)i.dom.style.top=es}},{eventObservers:{scroll(){this.maybeMeasure()}}});function yu(i,e){let t=parseInt(i.style.left,10);(isNaN(t)||Math.abs(e-t)>1)&&(i.style.left=e+"px")}const eC=se.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),tC={x:0,y:0},lc=oe.define({enables:[oc,eC]}),Ns=oe.define({combine:i=>i.reduce((e,t)=>e.concat(t),[])});class uo{static create(e){return new uo(e)}constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new Jp(e,Ns,(t,r)=>this.createHostedView(t,r),t=>t.dom.remove())}createHostedView(e,t){let r=e.create(this.view);return r.dom.classList.add("cm-tooltip-section"),this.dom.insertBefore(r.dom,t?t.dom.nextSibling:this.dom.firstChild),this.mounted&&r.mount&&r.mount(this.view),r}mount(e){for(let t of this.manager.tooltipViews)t.mount&&t.mount(e);this.mounted=!0}positioned(e){for(let t of this.manager.tooltipViews)t.positioned&&t.positioned(e)}update(e){this.manager.update(e)}destroy(){var e;for(let t of this.manager.tooltipViews)(e=t.destroy)===null||e===void 0||e.call(t)}passProp(e){let t;for(let r of this.manager.tooltipViews){let n=r[e];if(n!==void 0){if(t===void 0)t=n;else if(t!==n)return}}return t}get offset(){return this.passProp("offset")}get getCoords(){return this.passProp("getCoords")}get overlap(){return this.passProp("overlap")}get resize(){return this.passProp("resize")}}const iC=lc.compute([Ns],i=>{let e=i.facet(Ns);return e.length===0?null:{pos:Math.min(...e.map(t=>t.pos)),end:Math.max(...e.map(t=>{var r;return(r=t.end)!==null&&r!==void 0?r:t.pos})),create:uo.create,above:e[0].above,arrow:e.some(t=>t.arrow)}});class rC{constructor(e,t,r,n,s){this.view=e,this.source=t,this.field=r,this.setHover=n,this.hoverTime=s,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active.length)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{view:e,lastMove:t}=this,r=e.docView.tile.nearest(t.target);if(!r)return;let n,s=1;if(r.isWidget())n=r.posAtStart;else{if(n=e.posAtCoords(t),n==null)return;let o=e.coordsAtPos(n);if(!o||t.y<o.top||t.y>o.bottom||t.x<o.left-e.defaultCharacterWidth||t.x>o.right+e.defaultCharacterWidth)return;let a=e.bidiSpans(e.state.doc.lineAt(n)).find(u=>u.from<=n&&u.to>=n),c=a&&a.dir==Fe.RTL?-1:1;s=t.x<o.left?-c:c}let l=this.source(e,n,s);if(l!=null&&l.then){let o=this.pending={pos:n};l.then(a=>{this.pending==o&&(this.pending=null,a&&!(Array.isArray(a)&&!a.length)&&e.dispatch({effects:this.setHover.of(Array.isArray(a)?a:[a])}))},a=>_t(e.state,a,"hover tooltip"))}else l&&!(Array.isArray(l)&&!l.length)&&e.dispatch({effects:this.setHover.of(Array.isArray(l)?l:[l])})}get tooltip(){let e=this.view.plugin(oc),t=e?e.manager.tooltips.findIndex(r=>r.create==uo.create):-1;return t>-1?e.manager.tooltipViews[t]:null}mousemove(e){var t,r;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let{active:n,tooltip:s}=this;if(n.length&&s&&!nC(s.dom,e)||this.pending){let{pos:l}=n[0]||this.pending,o=(r=(t=n[0])===null||t===void 0?void 0:t.end)!==null&&r!==void 0?r:l;(l==o?this.view.posAtCoords(this.lastMove)!=l:!sC(this.view,l,o,e.clientX,e.clientY))&&(this.view.dispatch({effects:this.setHover.of([])}),this.pending=null)}}mouseleave(e){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1;let{active:t}=this;if(t.length){let{tooltip:r}=this;r&&r.dom.contains(e.relatedTarget)?this.watchTooltipLeave(r.dom):this.view.dispatch({effects:this.setHover.of([])})}}watchTooltipLeave(e){let t=r=>{e.removeEventListener("mouseleave",t),this.active.length&&!this.view.dom.contains(r.relatedTarget)&&this.view.dispatch({effects:this.setHover.of([])})};e.addEventListener("mouseleave",t)}destroy(){clearTimeout(this.hoverTimeout),clearTimeout(this.restartTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}const ts=4;function nC(i,e){let{left:t,right:r,top:n,bottom:s}=i.getBoundingClientRect(),l;if(l=i.querySelector(".cm-tooltip-arrow")){let o=l.getBoundingClientRect();n=Math.min(o.top,n),s=Math.max(o.bottom,s)}return e.clientX>=t-ts&&e.clientX<=r+ts&&e.clientY>=n-ts&&e.clientY<=s+ts}function sC(i,e,t,r,n,s){let l=i.scrollDOM.getBoundingClientRect(),o=i.documentTop+i.documentPadding.top+i.contentHeight;if(l.left>r||l.right<r||l.top>n||Math.min(l.bottom,o)<n)return!1;let a=i.posAtCoords({x:r,y:n},!1);return a>=e&&a<=t}function oC(i,e={}){let t=pe.define(),r=et.define({create(){return[]},update(n,s){if(n.length&&(e.hideOnChange&&(s.docChanged||s.selection)?n=[]:e.hideOn&&(n=n.filter(l=>!e.hideOn(s,l))),s.docChanged)){let l=[];for(let o of n){let a=s.changes.mapPos(o.pos,-1,Qe.TrackDel);if(a!=null){let c=Object.assign(Object.create(null),o);c.pos=a,c.end!=null&&(c.end=s.changes.mapPos(c.end)),l.push(c)}}n=l}for(let l of s.effects)l.is(t)&&(n=l.value),l.is(lC)&&(n=[]);return n},provide:n=>Ns.from(n)});return{active:r,extension:[r,st.define(n=>new rC(n,i,r,t,e.hoverTime||300)),iC]}}function Yp(i,e){let t=i.plugin(oc);if(!t)return null;let r=t.manager.tooltips.indexOf(e);return r<0?null:t.manager.tooltipViews[r]}const lC=pe.define(),bu=oe.define({combine(i){let e,t;for(let r of i)e=e||r.topContainer,t=t||r.bottomContainer;return{topContainer:e,bottomContainer:t}}});function ac(i,e){let t=i.plugin(Qp),r=t?t.specs.indexOf(e):-1;return r>-1?t.panels[r]:null}const Qp=st.fromClass(class{constructor(i){this.input=i.state.facet(mn),this.specs=this.input.filter(t=>t),this.panels=this.specs.map(t=>t(i));let e=i.state.facet(bu);this.top=new is(i,!0,e.topContainer),this.bottom=new is(i,!1,e.bottomContainer),this.top.sync(this.panels.filter(t=>t.top)),this.bottom.sync(this.panels.filter(t=>!t.top));for(let t of this.panels)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}update(i){let e=i.state.facet(bu);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new is(i.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new is(i.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let t=i.state.facet(mn);if(t!=this.input){let r=t.filter(a=>a),n=[],s=[],l=[],o=[];for(let a of r){let c=this.specs.indexOf(a),u;c<0?(u=a(i.view),o.push(u)):(u=this.panels[c],u.update&&u.update(i)),n.push(u),(u.top?s:l).push(u)}this.specs=r,this.panels=n,this.top.sync(s),this.bottom.sync(l);for(let a of o)a.dom.classList.add("cm-panel"),a.mount&&a.mount()}else for(let r of this.panels)r.update&&r.update(i)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:i=>se.scrollMargins.of(e=>{let t=e.plugin(i);return t&&{top:t.top.scrollMargin(),bottom:t.bottom.scrollMargin()}})});class is{constructor(e,t,r){this.view=e,this.top=t,this.container=r,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=xu(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=xu(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function xu(i){let e=i.nextSibling;return i.remove(),e}const mn=oe.define({enables:Qp});function aC(i,e){let t,r=new Promise(l=>t=l),n=l=>cC(l,e,t);i.state.field(tl,!1)?i.dispatch({effects:Zp.of(n)}):i.dispatch({effects:pe.appendConfig.of(tl.init(()=>[n]))});let s=em.of(n);return{close:s,result:r.then(l=>((i.win.queueMicrotask||(a=>i.win.setTimeout(a,10)))(()=>{i.state.field(tl).indexOf(n)>-1&&i.dispatch({effects:s})}),l))}}const tl=et.define({create(){return[]},update(i,e){for(let t of e.effects)t.is(Zp)?i=[t.value].concat(i):t.is(em)&&(i=i.filter(r=>r!=t.value));return i},provide:i=>mn.computeN([i],e=>e.field(i))}),Zp=pe.define(),em=pe.define();function cC(i,e,t){let r=e.content?e.content(i,()=>l(null)):null;if(!r){if(r=Me("form"),e.input){let o=Me("input",e.input);/^(text|password|number|email|tel|url)$/.test(o.type)&&o.classList.add("cm-textfield"),o.name||(o.name="input"),r.appendChild(Me("label",(e.label||"")+": ",o))}else r.appendChild(document.createTextNode(e.label||""));r.appendChild(document.createTextNode(" ")),r.appendChild(Me("button",{class:"cm-button",type:"submit"},e.submitLabel||"OK"))}let n=r.nodeName=="FORM"?[r]:r.querySelectorAll("form");for(let o=0;o<n.length;o++){let a=n[o];a.addEventListener("keydown",c=>{c.keyCode==27?(c.preventDefault(),l(null)):c.keyCode==13&&(c.preventDefault(),l(a))}),a.addEventListener("submit",c=>{c.preventDefault(),l(a)})}let s=Me("div",r,Me("button",{onclick:()=>l(null),"aria-label":i.state.phrase("close"),class:"cm-dialog-close",type:"button"},[""]));e.class&&(s.className=e.class),s.classList.add("cm-dialog");function l(o){s.contains(s.ownerDocument.activeElement)&&i.focus(),t(o)}return{dom:s,top:e.top,mount:()=>{if(e.focus){let o;typeof e.focus=="string"?o=r.querySelector(e.focus):o=r.querySelector("input")||r.querySelector("button"),o&&"select"in o?o.select():o&&"focus"in o&&o.focus()}}}}class pi extends Mi{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}pi.prototype.elementClass="";pi.prototype.toDOM=void 0;pi.prototype.mapMode=Qe.TrackBefore;pi.prototype.startSide=pi.prototype.endSide=-1;pi.prototype.point=!0;const ys=oe.define(),hC=oe.define(),uC={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>ye.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{},side:"before"},ln=oe.define();function fC(i){return[tm(),ln.of({...uC,...i})]}const wu=oe.define({combine:i=>i.some(e=>e)});function tm(i){return[dC]}const dC=st.fromClass(class{constructor(i){this.view=i,this.domAfter=null,this.prevViewport=i.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters cm-gutters-before",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=i.state.facet(ln).map(e=>new ku(i,e)),this.fixed=!i.state.facet(wu);for(let e of this.gutters)e.config.side=="after"?this.getDOMAfter().appendChild(e.dom):this.dom.appendChild(e.dom);this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),i.scrollDOM.insertBefore(this.dom,i.contentDOM)}getDOMAfter(){return this.domAfter||(this.domAfter=document.createElement("div"),this.domAfter.className="cm-gutters cm-gutters-after",this.domAfter.setAttribute("aria-hidden","true"),this.domAfter.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.domAfter.style.position=this.fixed?"sticky":"",this.view.scrollDOM.appendChild(this.domAfter)),this.domAfter}update(i){if(this.updateGutters(i)){let e=this.prevViewport,t=i.view.viewport,r=Math.min(e.to,t.to)-Math.max(e.from,t.from);this.syncGutters(r<(t.to-t.from)*.8)}if(i.geometryChanged){let e=this.view.contentHeight/this.view.scaleY+"px";this.dom.style.minHeight=e,this.domAfter&&(this.domAfter.style.minHeight=e)}this.view.state.facet(wu)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":"",this.domAfter&&(this.domAfter.style.position=this.fixed?"sticky":"")),this.prevViewport=i.view.viewport}syncGutters(i){let e=this.dom.nextSibling;i&&(this.dom.remove(),this.domAfter&&this.domAfter.remove());let t=ye.iter(this.view.state.facet(ys),this.view.viewport.from),r=[],n=this.gutters.map(s=>new pC(s,this.view.viewport,-this.view.documentPadding.top));for(let s of this.view.viewportLineBlocks)if(r.length&&(r=[]),Array.isArray(s.type)){let l=!0;for(let o of s.type)if(o.type==bt.Text&&l){aa(t,r,o.from);for(let a of n)a.line(this.view,o,r);l=!1}else if(o.widget)for(let a of n)a.widget(this.view,o)}else if(s.type==bt.Text){aa(t,r,s.from);for(let l of n)l.line(this.view,s,r)}else if(s.widget)for(let l of n)l.widget(this.view,s);for(let s of n)s.finish();i&&(this.view.scrollDOM.insertBefore(this.dom,e),this.domAfter&&this.view.scrollDOM.appendChild(this.domAfter))}updateGutters(i){let e=i.startState.facet(ln),t=i.state.facet(ln),r=i.docChanged||i.heightChanged||i.viewportChanged||!ye.eq(i.startState.facet(ys),i.state.facet(ys),i.view.viewport.from,i.view.viewport.to);if(e==t)for(let n of this.gutters)n.update(i)&&(r=!0);else{r=!0;let n=[];for(let s of t){let l=e.indexOf(s);l<0?n.push(new ku(this.view,s)):(this.gutters[l].update(i),n.push(this.gutters[l]))}for(let s of this.gutters)s.dom.remove(),n.indexOf(s)<0&&s.destroy();for(let s of n)s.config.side=="after"?this.getDOMAfter().appendChild(s.dom):this.dom.appendChild(s.dom);this.gutters=n}return r}destroy(){for(let i of this.gutters)i.destroy();this.dom.remove(),this.domAfter&&this.domAfter.remove()}},{provide:i=>se.scrollMargins.of(e=>{let t=e.plugin(i);if(!t||t.gutters.length==0||!t.fixed)return null;let r=t.dom.offsetWidth*e.scaleX,n=t.domAfter?t.domAfter.offsetWidth*e.scaleX:0;return e.textDirection==Fe.LTR?{left:r,right:n}:{right:r,left:n}})});function Su(i){return Array.isArray(i)?i:[i]}function aa(i,e,t){for(;i.value&&i.from<=t;)i.from==t&&e.push(i.value),i.next()}class pC{constructor(e,t,r){this.gutter=e,this.height=r,this.i=0,this.cursor=ye.iter(e.markers,t.from)}addElement(e,t,r){let{gutter:n}=this,s=(t.top-this.height)/e.scaleY,l=t.height/e.scaleY;if(this.i==n.elements.length){let o=new im(e,l,s,r);n.elements.push(o),n.dom.appendChild(o.dom)}else n.elements[this.i].update(e,l,s,r);this.height=t.bottom,this.i++}line(e,t,r){let n=[];aa(this.cursor,n,t.from),r.length&&(n=n.concat(r));let s=this.gutter.config.lineMarker(e,t,n);s&&n.unshift(s);let l=this.gutter;n.length==0&&!l.config.renderEmptyElements||this.addElement(e,t,n)}widget(e,t){let r=this.gutter.config.widgetMarker(e,t.widget,t),n=r?[r]:null;for(let s of e.state.facet(hC)){let l=s(e,t.widget,t);l&&(n||(n=[])).push(l)}n&&this.addElement(e,t,n)}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class ku{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let r in t.domEventHandlers)this.dom.addEventListener(r,n=>{let s=n.target,l;if(s!=this.dom&&this.dom.contains(s)){for(;s.parentNode!=this.dom;)s=s.parentNode;let a=s.getBoundingClientRect();l=(a.top+a.bottom)/2}else l=n.clientY;let o=e.lineBlockAtHeight(l-e.documentTop);t.domEventHandlers[r](e,o,n)&&n.preventDefault()});this.markers=Su(t.markers(e)),t.initialSpacer&&(this.spacer=new im(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=Su(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let n=this.config.updateSpacer(this.spacer.markers[0],e);n!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[n])}let r=e.view.viewport;return!ye.eq(this.markers,t,r.from,r.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class im{constructor(e,t,r,n){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,r,n)}update(e,t,r,n){this.height!=t&&(this.height=t,this.dom.style.height=t+"px"),this.above!=r&&(this.dom.style.marginTop=(this.above=r)?r+"px":""),mC(this.markers,n)||this.setMarkers(e,n)}setMarkers(e,t){let r="cm-gutterElement",n=this.dom.firstChild;for(let s=0,l=0;;){let o=l,a=s<t.length?t[s++]:null,c=!1;if(a){let u=a.elementClass;u&&(r+=" "+u);for(let h=l;h<this.markers.length;h++)if(this.markers[h].compare(a)){o=h,c=!0;break}}else o=this.markers.length;for(;l<o;){let u=this.markers[l++];if(u.toDOM){u.destroy(n);let h=n.nextSibling;n.remove(),n=h}}if(!a)break;a.toDOM&&(c?n=n.nextSibling:this.dom.insertBefore(a.toDOM(e),n)),c&&l++}this.dom.className=r,this.markers=t}destroy(){this.setMarkers(null,[])}}function mC(i,e){if(i.length!=e.length)return!1;for(let t=0;t<i.length;t++)if(!i[t].compare(e[t]))return!1;return!0}const gC=oe.define(),vC=oe.define(),ur=oe.define({combine(i){return Ni(i,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let r=Object.assign({},e);for(let n in t){let s=r[n],l=t[n];r[n]=s?(o,a,c)=>s(o,a,c)||l(o,a,c):l}return r}})}});class il extends pi{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function rl(i,e){return i.state.facet(ur).formatNumber(e,i.state)}const _C=ln.compute([ur],i=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(gC)},lineMarker(e,t,r){return r.some(n=>n.toDOM)?null:new il(rl(e,e.state.doc.lineAt(t.from).number))},widgetMarker:(e,t,r)=>{for(let n of e.state.facet(vC)){let s=n(e,t,r);if(s)return s}return null},lineMarkerChange:e=>e.startState.facet(ur)!=e.state.facet(ur),initialSpacer(e){return new il(rl(e,Cu(e.state.doc.lines)))},updateSpacer(e,t){let r=rl(t.view,Cu(t.view.state.doc.lines));return r==e.number?e:new il(r)},domEventHandlers:i.facet(ur).domEventHandlers,side:"before"}));function yC(i={}){return[ur.of(i),tm(),_C]}function Cu(i){let e=9;for(;e<i;)e=e*10+9;return e}const bC=new class extends pi{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},xC=ys.compute(["selection"],i=>{let e=[],t=-1;for(let r of i.selection.ranges){let n=i.doc.lineAt(r.head).from;n>t&&(t=n,e.push(bC.range(n)))}return ye.of(e)});function wC(){return xC}const SC=1024;let kC=0;class Ot{constructor(e,t){this.from=e,this.to=t}}class xe{constructor(e={}){this.id=kC++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")}),this.combine=e.combine||null}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=xt.match(e)),t=>{let r=e(t);return r===void 0?null:[this,r]}}}xe.closedBy=new xe({deserialize:i=>i.split(" ")});xe.openedBy=new xe({deserialize:i=>i.split(" ")});xe.group=new xe({deserialize:i=>i.split(" ")});xe.isolate=new xe({deserialize:i=>{if(i&&i!="rtl"&&i!="ltr"&&i!="auto")throw new RangeError("Invalid value for isolate: "+i);return i||"auto"}});xe.contextHash=new xe({perNode:!0});xe.lookAhead=new xe({perNode:!0});xe.mounted=new xe({perNode:!0});class br{constructor(e,t,r,n=!1){this.tree=e,this.overlay=t,this.parser=r,this.bracketed=n}static get(e){return e&&e.props&&e.props[xe.mounted.id]}}const CC=Object.create(null);class xt{constructor(e,t,r,n=0){this.name=e,this.props=t,this.id=r,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):CC,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),n=new xt(e.name||"",t,e.id,r);if(e.props){for(let s of e.props)if(Array.isArray(s)||(s=s(n)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[s[0].id]=s[1]}}return n}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(xe.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let r in e)for(let n of r.split(" "))t[n]=e[r];return r=>{for(let n=r.prop(xe.group),s=-1;s<(n?n.length:0);s++){let l=t[s<0?r.name:n[s]];if(l)return l}}}}xt.none=new xt("",Object.create(null),0,8);class rm{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let r of this.types){let n=null;for(let s of e){let l=s(r);if(l){n||(n=Object.assign({},r.props));let o=l[1],a=l[0];a.combine&&a.id in n&&(o=a.combine(n[a.id],o)),n[a.id]=o}}t.push(n?new xt(r.name,n,r.id,r.flags):r)}return new rm(t)}}const rs=new WeakMap,Eu=new WeakMap;var Te;(function(i){i[i.ExcludeBuffers=1]="ExcludeBuffers",i[i.IncludeAnonymous=2]="IncludeAnonymous",i[i.IgnoreMounts=4]="IgnoreMounts",i[i.IgnoreOverlays=8]="IgnoreOverlays",i[i.EnterBracketed=16]="EnterBracketed"})(Te||(Te={}));class We{constructor(e,t,r,n,s){if(this.type=e,this.children=t,this.positions=r,this.length=n,this.props=null,s&&s.length){this.props=Object.create(null);for(let[l,o]of s)this.props[typeof l=="number"?l:l.id]=o}}toString(){let e=br.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let r of this.children){let n=r.toString();n&&(t&&(t+=","),t+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new Fs(this.topNode,e)}cursorAt(e,t=0,r=0){let n=rs.get(this)||this.topNode,s=new Fs(n);return s.moveTo(e,t),rs.set(this,s._tree),s}get topNode(){return new nt(this,0,0,null)}resolve(e,t=0){let r=gn(rs.get(this)||this.topNode,e,t,!1);return rs.set(this,r),r}resolveInner(e,t=0){let r=gn(Eu.get(this)||this.topNode,e,t,!0);return Eu.set(this,r),r}resolveStack(e,t=0){return DC(this,e,t)}iterate(e){let{enter:t,leave:r,from:n=0,to:s=this.length}=e,l=e.mode||0,o=(l&Te.IncludeAnonymous)>0;for(let a=this.cursor(l|Te.IncludeAnonymous);;){let c=!1;if(a.from<=s&&a.to>=n&&(!o&&a.type.isAnonymous||t(a)!==!1)){if(a.firstChild())continue;c=!0}for(;c&&r&&(o||!a.type.isAnonymous)&&r(a),!a.nextSibling();){if(!a.parent())return;c=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:uc(xt.none,this.children,this.positions,0,this.children.length,0,this.length,(t,r,n)=>new We(this.type,t,r,n,this.propValues),e.makeTree||((t,r,n)=>new We(xt.none,t,r,n)))}static build(e){return MC(e)}}We.empty=new We(xt.none,[],[],0);class cc{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new cc(this.buffer,this.index)}}class Oi{constructor(e,t,r){this.buffer=e,this.length=t,this.set=r}get type(){return xt.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],r=this.buffer[e+3],n=this.set.types[t],s=n.name;if(/\W/.test(s)&&!n.isError&&(s=JSON.stringify(s)),e+=4,r==e)return s;let l=[];for(;e<r;)l.push(this.childString(e)),e=this.buffer[e+3];return s+"("+l.join(",")+")"}findChild(e,t,r,n,s){let{buffer:l}=this,o=-1;for(let a=e;a!=t&&!(nm(s,n,l[a+1],l[a+2])&&(o=a,r>0));a=l[a+3]);return o}slice(e,t,r){let n=this.buffer,s=new Uint16Array(t-e),l=0;for(let o=e,a=0;o<t;){s[a++]=n[o++],s[a++]=n[o++]-r;let c=s[a++]=n[o++]-r;s[a++]=n[o++]-e,l=Math.max(l,c)}return new Oi(s,l,this.set)}}function nm(i,e,t,r){switch(i){case-2:return t<e;case-1:return r>=e&&t<e;case 0:return t<e&&r>e;case 1:return t<=e&&r>e;case 2:return r>e;case 4:return!0}}function gn(i,e,t,r){for(var n;i.from==i.to||(t<1?i.from>=e:i.from>e)||(t>-1?i.to<=e:i.to<e);){let l=!r&&i instanceof nt&&i.index<0?null:i.parent;if(!l)return i;i=l}let s=r?0:Te.IgnoreOverlays;if(r)for(let l=i,o=l.parent;o;l=o,o=l.parent)l instanceof nt&&l.index<0&&((n=o.enter(e,t,s))===null||n===void 0?void 0:n.from)!=l.from&&(i=o);for(;;){let l=i.enter(e,t,s);if(!l)return i;i=l}}class sm{cursor(e=0){return new Fs(this,e)}getChild(e,t=null,r=null){let n=Au(this,e,t,r);return n.length?n[0]:null}getChildren(e,t=null,r=null){return Au(this,e,t,r)}resolve(e,t=0){return gn(this,e,t,!1)}resolveInner(e,t=0){return gn(this,e,t,!0)}matchContext(e){return ca(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),r=this;for(;t;){let n=t.lastChild;if(!n||n.to!=t.to)break;n.type.isError&&n.from==n.to?(r=t,t=n.prevSibling):t=n}return r}get node(){return this}get next(){return this.parent}}class nt extends sm{constructor(e,t,r,n){super(),this._tree=e,this.from=t,this.index=r,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,r,n,s=0){for(let l=this;;){for(let{children:o,positions:a}=l._tree,c=t>0?o.length:-1;e!=c;e+=t){let u=o[e],h=a[e]+l.from,f;if(!(!(s&Te.EnterBracketed&&u instanceof We&&(f=br.get(u))&&!f.overlay&&f.bracketed&&r>=h&&r<=h+u.length)&&!nm(n,r,h,h+u.length))){if(u instanceof Oi){if(s&Te.ExcludeBuffers)continue;let d=u.findChild(0,u.buffer.length,t,r-h,n);if(d>-1)return new ri(new EC(l,u,e,h),null,d)}else if(s&Te.IncludeAnonymous||!u.type.isAnonymous||hc(u)){let d;if(!(s&Te.IgnoreMounts)&&(d=br.get(u))&&!d.overlay)return new nt(d.tree,h,e,l);let _=new nt(u,h,e,l);return s&Te.IncludeAnonymous||!_.type.isAnonymous?_:_.nextChild(t<0?u.children.length-1:0,t,r,n,s)}}}if(s&Te.IncludeAnonymous||!l.type.isAnonymous||(l.index>=0?e=l.index+t:e=t<0?-1:l._parent._tree.children.length,l=l._parent,!l))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}prop(e){return this._tree.prop(e)}enter(e,t,r=0){let n;if(!(r&Te.IgnoreOverlays)&&(n=br.get(this._tree))&&n.overlay){let s=e-this.from,l=r&Te.EnterBracketed&&n.bracketed;for(let{from:o,to:a}of n.overlay)if((t>0||l?o<=s:o<s)&&(t<0||l?a>=s:a>s))return new nt(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function Au(i,e,t,r){let n=i.cursor(),s=[];if(!n.firstChild())return s;if(t!=null){for(let l=!1;!l;)if(l=n.type.is(t),!n.nextSibling())return s}for(;;){if(r!=null&&n.type.is(r))return s;if(n.type.is(e)&&s.push(n.node),!n.nextSibling())return r==null?s:[]}}function ca(i,e,t=e.length-1){for(let r=i;t>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[t]&&e[t]!=r.name)return!1;t--}}return!0}class EC{constructor(e,t,r,n){this.parent=e,this.buffer=t,this.index=r,this.start=n}}class ri extends sm{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,r){super(),this.context=e,this._parent=t,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,t,r){let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,r);return s<0?null:new ri(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}prop(e){return this.type.prop(e)}enter(e,t,r=0){if(r&Te.ExcludeBuffers)return null;let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return s<0?null:new ri(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new ri(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new ri(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:r}=this.context,n=this.index+4,s=r.buffer[this.index+3];if(s>n){let l=r.buffer[this.index+1];e.push(r.slice(n,s,l)),t.push(0)}return new We(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function om(i){if(!i.length)return null;let e=0,t=i[0];for(let s=1;s<i.length;s++){let l=i[s];(l.from>t.from||l.to<t.to)&&(t=l,e=s)}let r=t instanceof nt&&t.index<0?null:t.parent,n=i.slice();return r?n[e]=r:n.splice(e,1),new AC(n,t)}class AC{constructor(e,t){this.heads=e,this.node=t}get next(){return om(this.heads)}}function DC(i,e,t){let r=i.resolveInner(e,t),n=null;for(let s=r instanceof nt?r:r.context.parent;s;s=s.parent)if(s.index<0){let l=s.parent;(n||(n=[r])).push(l.resolve(e,t)),s=l}else{let l=br.get(s.tree);if(l&&l.overlay&&l.overlay[0].from<=e&&l.overlay[l.overlay.length-1].to>=e){let o=new nt(l.tree,l.overlay[0].from+s.from,-1,s);(n||(n=[r])).push(gn(o,e,t,!1))}}return n?om(n):r}class Fs{get name(){return this.type.name}constructor(e,t=0){if(this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,this.mode=t&~Te.EnterBracketed,e instanceof nt)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:r,buffer:n}=this.buffer;return this.type=t||n.set.types[n.buffer[e]],this.from=r+n.buffer[e+1],this.to=r+n.buffer[e+2],!0}yield(e){return e?e instanceof nt?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,r,this.mode));let{buffer:n}=this.buffer,s=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,r);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,r=this.mode){return this.buffer?r&Te.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&Te.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&Te.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,r=this.stack.length-1;if(e<0){let n=r<0?0:this.stack[r]+4;if(this.index!=n)return this.yieldBuf(t.findChild(n,this.index,-1,0,4))}else{let n=t.buffer[this.index+3];if(n<(r<0?t.buffer.length:t.buffer[this.stack[r]+3]))return this.yieldBuf(n)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,r,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(n.buffer.buffer[s+3]<this.index)return!1;({index:t,parent:r}=n)}else({index:t,_parent:r}=this._tree);for(;r;{index:t,_parent:r}=r)if(t>-1)for(let s=t+e,l=e<0?-1:r._tree.children.length;s!=l;s+=e){let o=r._tree.children[s];if(this.mode&Te.IncludeAnonymous||o instanceof Oi||!o.type.isAnonymous||hc(o))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,r=0;if(e&&e.context==this.buffer)e:for(let n=this.index,s=this.stack.length;s>=0;){for(let l=e;l;l=l._parent)if(l.index==n){if(n==this.index)return l;t=l,r=s+1;break e}n=this.stack[--s]}for(let n=r;n<this.stack.length;n++)t=new ri(this.buffer,t,this.stack[n]);return this.bufferNode=new ri(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let r=0;;){let n=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){r++;continue}this.type.isAnonymous||(n=!0)}for(;;){if(n&&t&&t(this),n=this.type.isAnonymous,!r)return;if(this.nextSibling())break;this.parent(),r--,n=!0}}}matchContext(e){if(!this.buffer)return ca(this.node.parent,e);let{buffer:t}=this.buffer,{types:r}=t.set;for(let n=e.length-1,s=this.stack.length-1;n>=0;s--){if(s<0)return ca(this._tree,e,n);let l=r[t.buffer[this.stack[s]]];if(!l.isAnonymous){if(e[n]&&e[n]!=l.name)return!1;n--}}return!0}}function hc(i){return i.children.some(e=>e instanceof Oi||!e.type.isAnonymous||hc(e))}function MC(i){var e;let{buffer:t,nodeSet:r,maxBufferLength:n=SC,reused:s=[],minRepeatType:l=r.types.length}=i,o=Array.isArray(t)?new cc(t,t.length):t,a=r.types,c=0,u=0;function h(S,x,k,w,E,A){let{id:T,start:B,end:O,size:N}=o,j=u,z=c;if(N<0)if(o.next(),N==-1){let I=s[T];k.push(I),w.push(B-S);return}else if(N==-3){c=T;return}else if(N==-4){u=T;return}else throw new RangeError(`Unrecognized record size: ${N}`);let $=a[T],q,M,C=B-S;if(O-B<=n&&(M=p(o.pos-x,E))){let I=new Uint16Array(M.size-M.skip),F=o.pos-M.size,R=I.length;for(;o.pos>F;)R=m(M.start,I,R);q=new Oi(I,O-M.start,r),C=M.start-S}else{let I=o.pos-N;o.next();let F=[],R=[],X=T>=l?T:-1,ie=0,re=O;for(;o.pos>I;)X>=0&&o.id==X&&o.size>=0?(o.end<=re-n&&(_(F,R,B,ie,o.end,re,X,j,z),ie=F.length,re=o.end),o.next()):A>2500?f(B,I,F,R):h(B,I,F,R,X,A+1);if(X>=0&&ie>0&&ie<F.length&&_(F,R,B,ie,B,re,X,j,z),F.reverse(),R.reverse(),X>-1&&ie>0){let P=d($,z);q=uc($,F,R,0,F.length,0,O-B,P,P)}else q=y($,F,R,O-B,j-O,z)}k.push(q),w.push(C)}function f(S,x,k,w){let E=[],A=0,T=-1;for(;o.pos>x;){let{id:B,start:O,end:N,size:j}=o;if(j>4)o.next();else{if(T>-1&&O<T)break;T<0&&(T=N-n),E.push(B,O,N),A++,o.next()}}if(A){let B=new Uint16Array(A*4),O=E[E.length-2];for(let N=E.length-3,j=0;N>=0;N-=3)B[j++]=E[N],B[j++]=E[N+1]-O,B[j++]=E[N+2]-O,B[j++]=j;k.push(new Oi(B,E[2]-O,r)),w.push(O-S)}}function d(S,x){return(k,w,E)=>{let A=0,T=k.length-1,B,O;if(T>=0&&(B=k[T])instanceof We){if(!T&&B.type==S&&B.length==E)return B;(O=B.prop(xe.lookAhead))&&(A=w[T]+B.length+O)}return y(S,k,w,E,A,x)}}function _(S,x,k,w,E,A,T,B,O){let N=[],j=[];for(;S.length>w;)N.push(S.pop()),j.push(x.pop()+k-E);S.push(y(r.types[T],N,j,A-E,B-A,O)),x.push(E-k)}function y(S,x,k,w,E,A,T){if(A){let B=[xe.contextHash,A];T=T?[B].concat(T):[B]}if(E>25){let B=[xe.lookAhead,E];T=T?[B].concat(T):[B]}return new We(S,x,k,w,T)}function p(S,x){let k=o.fork(),w=0,E=0,A=0,T=k.end-n,B={size:0,start:0,skip:0};e:for(let O=k.pos-S;k.pos>O;){let N=k.size;if(k.id==x&&N>=0){B.size=w,B.start=E,B.skip=A,A+=4,w+=4,k.next();continue}let j=k.pos-N;if(N<0||j<O||k.start<T)break;let z=k.id>=l?4:0,$=k.start;for(k.next();k.pos>j;){if(k.size<0)if(k.size==-3||k.size==-4)z+=4;else break e;else k.id>=l&&(z+=4);k.next()}E=$,w+=N,A+=z}return(x<0||w==S)&&(B.size=w,B.start=E,B.skip=A),B.size>4?B:void 0}function m(S,x,k){let{id:w,start:E,end:A,size:T}=o;if(o.next(),T>=0&&w<l){let B=k;if(T>4){let O=o.pos-(T-4);for(;o.pos>O;)k=m(S,x,k)}x[--k]=B,x[--k]=A-S,x[--k]=E-S,x[--k]=w}else T==-3?c=w:T==-4&&(u=w);return k}let g=[],v=[];for(;o.pos>0;)h(i.start||0,i.bufferStart||0,g,v,-1,0);let b=(e=i.length)!==null&&e!==void 0?e:g.length?v[0]+g[0].length:0;return new We(a[i.topID],g.reverse(),v.reverse(),b)}const Du=new WeakMap;function bs(i,e){if(!i.isAnonymous||e instanceof Oi||e.type!=i)return 1;let t=Du.get(e);if(t==null){t=1;for(let r of e.children){if(r.type!=i||!(r instanceof We)){t=1;break}t+=bs(i,r)}Du.set(e,t)}return t}function uc(i,e,t,r,n,s,l,o,a){let c=0;for(let _=r;_<n;_++)c+=bs(i,e[_]);let u=Math.ceil(c*1.5/8),h=[],f=[];function d(_,y,p,m,g){for(let v=p;v<m;){let b=v,S=y[v],x=bs(i,_[v]);for(v++;v<m;v++){let k=bs(i,_[v]);if(x+k>=u)break;x+=k}if(v==b+1){if(x>u){let k=_[b];d(k.children,k.positions,0,k.children.length,y[b]+g);continue}h.push(_[b])}else{let k=y[v-1]+_[v-1].length-S;h.push(uc(i,_,y,b,v,S,k,null,a))}f.push(S+g-s)}}return d(e,t,r,n,0),(o||a)(h,f,l)}class hM{constructor(){this.map=new WeakMap}setBuffer(e,t,r){let n=this.map.get(e);n||this.map.set(e,n=new Map),n.set(t,r)}getBuffer(e,t){let r=this.map.get(e);return r&&r.get(t)}set(e,t){e instanceof ri?this.setBuffer(e.context.buffer,e.index,t):e instanceof nt&&this.map.set(e.tree,t)}get(e){return e instanceof ri?this.getBuffer(e.context.buffer,e.index):e instanceof nt?this.map.get(e.tree):void 0}cursorSet(e,t){e.buffer?this.setBuffer(e.buffer.buffer,e.index,t):this.map.set(e.tree,t)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}}class fi{constructor(e,t,r,n,s=!1,l=!1){this.from=e,this.to=t,this.tree=r,this.offset=n,this.open=(s?1:0)|(l?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],r=!1){let n=[new fi(0,e.length,e,0,!1,r)];for(let s of t)s.to>e.length&&n.push(s);return n}static applyChanges(e,t,r=128){if(!t.length)return e;let n=[],s=1,l=e.length?e[0]:null;for(let o=0,a=0,c=0;;o++){let u=o<t.length?t[o]:null,h=u?u.fromA:1e9;if(h-a>=r)for(;l&&l.from<h;){let f=l;if(a>=f.from||h<=f.to||c){let d=Math.max(f.from,a)-c,_=Math.min(f.to,h)-c;f=d>=_?null:new fi(d,_,f.tree,f.offset+c,o>0,!!u)}if(f&&n.push(f),l.to>h)break;l=s<e.length?e[s++]:null}if(!u)break;a=u.toA,c=u.toA-u.toB}return n}}class LC{startParse(e,t,r){return typeof e=="string"&&(e=new TC(e)),r=r?r.length?r.map(n=>new Ot(n.from,n.to)):[new Ot(0,0)]:[new Ot(0,e.length)],this.createParse(e,t||[],r)}parse(e,t,r){let n=this.startParse(e,t,r);for(;;){let s=n.advance();if(s)return s}}}class TC{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}function uM(i){return(e,t,r,n)=>new BC(e,i,t,r,n)}class Mu{constructor(e,t,r,n,s,l){this.parser=e,this.parse=t,this.overlay=r,this.bracketed=n,this.target=s,this.from=l}}function Lu(i){if(!i.length||i.some(e=>e.from>=e.to))throw new RangeError("Invalid inner parse ranges given: "+JSON.stringify(i))}class RC{constructor(e,t,r,n,s,l,o,a){this.parser=e,this.predicate=t,this.mounts=r,this.index=n,this.start=s,this.bracketed=l,this.target=o,this.prev=a,this.depth=0,this.ranges=[]}}const ha=new xe({perNode:!0});class BC{constructor(e,t,r,n,s){this.nest=t,this.input=r,this.fragments=n,this.ranges=s,this.inner=[],this.innerDone=0,this.baseTree=null,this.stoppedAt=null,this.baseParse=e}advance(){if(this.baseParse){let r=this.baseParse.advance();if(!r)return null;if(this.baseParse=null,this.baseTree=r,this.startInner(),this.stoppedAt!=null)for(let n of this.inner)n.parse.stopAt(this.stoppedAt)}if(this.innerDone==this.inner.length){let r=this.baseTree;return this.stoppedAt!=null&&(r=new We(r.type,r.children,r.positions,r.length,r.propValues.concat([[ha,this.stoppedAt]]))),r}let e=this.inner[this.innerDone],t=e.parse.advance();if(t){this.innerDone++;let r=Object.assign(Object.create(null),e.target.props);r[xe.mounted.id]=new br(t,e.overlay,e.parser,e.bracketed),e.target.props=r}return null}get parsedPos(){if(this.baseParse)return 0;let e=this.input.length;for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].from<e&&(e=Math.min(e,this.inner[t].parse.parsedPos));return e}stopAt(e){if(this.stoppedAt=e,this.baseParse)this.baseParse.stopAt(e);else for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].parse.stopAt(e)}startInner(){let e=new IC(this.fragments),t=null,r=null,n=new Fs(new nt(this.baseTree,this.ranges[0].from,0,null),Te.IncludeAnonymous|Te.IgnoreMounts);e:for(let s,l;;){let o=!0,a;if(this.stoppedAt!=null&&n.from>=this.stoppedAt)o=!1;else if(e.hasNode(n)){if(t){let c=t.mounts.find(u=>u.frag.from<=n.from&&u.frag.to>=n.to&&u.mount.overlay);if(c)for(let u of c.mount.overlay){let h=u.from+c.pos,f=u.to+c.pos;h>=n.from&&f<=n.to&&!t.ranges.some(d=>d.from<f&&d.to>h)&&t.ranges.push({from:h,to:f})}}o=!1}else if(r&&(l=OC(r.ranges,n.from,n.to)))o=l!=2;else if(!n.type.isAnonymous&&(s=this.nest(n,this.input))&&(n.from<n.to||!s.overlay)){n.tree||(PC(n),t&&t.depth++,r&&r.depth++);let c=e.findMounts(n.from,s.parser);if(typeof s.overlay=="function")t=new RC(s.parser,s.overlay,c,this.inner.length,n.from,!!s.bracketed,n.tree,t);else{let u=Bu(this.ranges,s.overlay||(n.from<n.to?[new Ot(n.from,n.to)]:[]));u.length&&Lu(u),(u.length||!s.overlay)&&this.inner.push(new Mu(s.parser,u.length?s.parser.startParse(this.input,Ou(c,u),u):s.parser.startParse(""),s.overlay?s.overlay.map(h=>new Ot(h.from-n.from,h.to-n.from)):null,!!s.bracketed,n.tree,u.length?u[0].from:n.from)),s.overlay?u.length&&(r={ranges:u,depth:0,prev:r}):o=!1}}else if(t&&(a=t.predicate(n))&&(a===!0&&(a=new Ot(n.from,n.to)),a.from<a.to)){let c=t.ranges.length-1;c>=0&&t.ranges[c].to==a.from?t.ranges[c]={from:t.ranges[c].from,to:a.to}:t.ranges.push(a)}if(o&&n.firstChild())t&&t.depth++,r&&r.depth++;else for(;!n.nextSibling();){if(!n.parent())break e;if(t&&!--t.depth){let c=Bu(this.ranges,t.ranges);c.length&&(Lu(c),this.inner.splice(t.index,0,new Mu(t.parser,t.parser.startParse(this.input,Ou(t.mounts,c),c),t.ranges.map(u=>new Ot(u.from-t.start,u.to-t.start)),t.bracketed,t.target,c[0].from))),t=t.prev}r&&!--r.depth&&(r=r.prev)}}}}function OC(i,e,t){for(let r of i){if(r.from>=t)break;if(r.to>e)return r.from<=e&&r.to>=t?2:1}return 0}function Tu(i,e,t,r,n,s){if(e<t){let l=i.buffer[e+1];r.push(i.slice(e,t,l)),n.push(l-s)}}function PC(i){let{node:e}=i,t=[],r=e.context.buffer;do t.push(i.index),i.parent();while(!i.tree);let n=i.tree,s=n.children.indexOf(r),l=n.children[s],o=l.buffer,a=[s];function c(u,h,f,d,_,y){let p=t[y],m=[],g=[];Tu(l,u,p,m,g,d);let v=o[p+1],b=o[p+2];a.push(m.length);let S=y?c(p+4,o[p+3],l.set.types[o[p]],v,b-v,y-1):e.toTree();return m.push(S),g.push(v-d),Tu(l,o[p+3],h,m,g,d),new We(f,m,g,_)}n.children[s]=c(0,o.length,xt.none,0,l.length,t.length-1);for(let u of a){let h=i.tree.children[u],f=i.tree.positions[u];i.yield(new nt(h,f+i.from,u,i._tree))}}class Ru{constructor(e,t){this.offset=t,this.done=!1,this.cursor=e.cursor(Te.IncludeAnonymous|Te.IgnoreMounts)}moveTo(e){let{cursor:t}=this,r=e-this.offset;for(;!this.done&&t.from<r;)t.to>=e&&t.enter(r,1,Te.IgnoreOverlays|Te.ExcludeBuffers)||t.next(!1)||(this.done=!0)}hasNode(e){if(this.moveTo(e.from),!this.done&&this.cursor.from+this.offset==e.from&&this.cursor.tree)for(let t=this.cursor.tree;;){if(t==e.tree)return!0;if(t.children.length&&t.positions[0]==0&&t.children[0]instanceof We)t=t.children[0];else break}return!1}}class IC{constructor(e){var t;if(this.fragments=e,this.curTo=0,this.fragI=0,e.length){let r=this.curFrag=e[0];this.curTo=(t=r.tree.prop(ha))!==null&&t!==void 0?t:r.to,this.inner=new Ru(r.tree,-r.offset)}else this.curFrag=this.inner=null}hasNode(e){for(;this.curFrag&&e.from>=this.curTo;)this.nextFrag();return this.curFrag&&this.curFrag.from<=e.from&&this.curTo>=e.to&&this.inner.hasNode(e)}nextFrag(){var e;if(this.fragI++,this.fragI==this.fragments.length)this.curFrag=this.inner=null;else{let t=this.curFrag=this.fragments[this.fragI];this.curTo=(e=t.tree.prop(ha))!==null&&e!==void 0?e:t.to,this.inner=new Ru(t.tree,-t.offset)}}findMounts(e,t){var r;let n=[];if(this.inner){this.inner.cursor.moveTo(e,1);for(let s=this.inner.cursor.node;s;s=s.parent){let l=(r=s.tree)===null||r===void 0?void 0:r.prop(xe.mounted);if(l&&l.parser==t)for(let o=this.fragI;o<this.fragments.length;o++){let a=this.fragments[o];if(a.from>=s.to)break;a.tree==this.curFrag.tree&&n.push({frag:a,pos:s.from-a.offset,mount:l})}}}return n}}function Bu(i,e){let t=null,r=e;for(let n=1,s=0;n<i.length;n++){let l=i[n-1].to,o=i[n].from;for(;s<r.length;s++){let a=r[s];if(a.from>=o)break;a.to<=l||(t||(r=t=e.slice()),a.from<l?(t[s]=new Ot(a.from,l),a.to>o&&t.splice(s+1,0,new Ot(o,a.to))):a.to>o?t[s--]=new Ot(o,a.to):t.splice(s--,1))}}return r}function NC(i,e,t,r){let n=0,s=0,l=!1,o=!1,a=-1e9,c=[];for(;;){let u=n==i.length?1e9:l?i[n].to:i[n].from,h=s==e.length?1e9:o?e[s].to:e[s].from;if(l!=o){let f=Math.max(a,t),d=Math.min(u,h,r);f<d&&c.push(new Ot(f,d))}if(a=Math.min(u,h),a==1e9)break;u==a&&(l?(l=!1,n++):l=!0),h==a&&(o?(o=!1,s++):o=!0)}return c}function Ou(i,e){let t=[];for(let{pos:r,mount:n,frag:s}of i){let l=r+(n.overlay?n.overlay[0].from:0),o=l+n.tree.length,a=Math.max(s.from,l),c=Math.min(s.to,o);if(n.overlay){let u=n.overlay.map(f=>new Ot(f.from+r,f.to+r)),h=NC(e,u,a,c);for(let f=0,d=a;;f++){let _=f==h.length,y=_?c:h[f].from;if(y>d&&t.push(new fi(d,y,n.tree,-l,s.from>=d||s.openStart,s.to<=y||s.openEnd)),_)break;d=h[f].to}}else t.push(new fi(a,c,n.tree,-l,s.from>=l||s.openStart,s.to<=o||s.openEnd))}return t}let FC=0;class Rt{constructor(e,t,r,n){this.name=e,this.set=t,this.base=r,this.modified=n,this.id=FC++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let r=typeof e=="string"?e:"?";if(e instanceof Rt&&(t=e),t!=null&&t.base)throw new Error("Can not derive from a modified tag");let n=new Rt(r,[],null,[]);if(n.set.push(n),t)for(let s of t.set)n.set.push(s);return n}static defineModifier(e){let t=new Hs(e);return r=>r.modified.indexOf(t)>-1?r:Hs.get(r.base||r,r.modified.concat(t).sort((n,s)=>n.id-s.id))}}let HC=0;class Hs{constructor(e){this.name=e,this.instances=[],this.id=HC++}static get(e,t){if(!t.length)return e;let r=t[0].instances.find(o=>o.base==e&&jC(t,o.modified));if(r)return r;let n=[],s=new Rt(e.name,n,e,t);for(let o of t)o.instances.push(s);let l=zC(t);for(let o of e.set)if(!o.modified.length)for(let a of l)n.push(Hs.get(o,a));return s}}function jC(i,e){return i.length==e.length&&i.every((t,r)=>t==e[r])}function zC(i){let e=[[]];for(let t=0;t<i.length;t++)for(let r=0,n=e.length;r<n;r++)e.push(e[r].concat(i[t]));return e.sort((t,r)=>r.length-t.length)}function WC(i){let e=Object.create(null);for(let t in i){let r=i[t];Array.isArray(r)||(r=[r]);for(let n of t.split(" "))if(n){let s=[],l=2,o=n;for(let h=0;;){if(o=="..."&&h>0&&h+3==n.length){l=1;break}let f=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(o);if(!f)throw new RangeError("Invalid path: "+n);if(s.push(f[0]=="*"?"":f[0][0]=='"'?JSON.parse(f[0]):f[0]),h+=f[0].length,h==n.length)break;let d=n[h++];if(h==n.length&&d=="!"){l=0;break}if(d!="/")throw new RangeError("Invalid path: "+n);o=n.slice(h)}let a=s.length-1,c=s[a];if(!c)throw new RangeError("Invalid path: "+n);let u=new vn(r,l,a>0?s.slice(0,a):null);e[c]=u.sort(e[c])}}return lm.add(e)}const lm=new xe({combine(i,e){let t,r,n;for(;i||e;){if(!i||e&&i.depth>=e.depth?(n=e,e=e.next):(n=i,i=i.next),t&&t.mode==n.mode&&!n.context&&!t.context)continue;let s=new vn(n.tags,n.mode,n.context);t?t.next=s:r=s,t=s}return r}});class vn{constructor(e,t,r,n){this.tags=e,this.mode=t,this.context=r,this.next=n}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}vn.empty=new vn([],2,null);function am(i,e){let t=Object.create(null);for(let s of i)if(!Array.isArray(s.tag))t[s.tag.id]=s.class;else for(let l of s.tag)t[l.id]=s.class;let{scope:r,all:n=null}=e||{};return{style:s=>{let l=n;for(let o of s)for(let a of o.set){let c=t[a.id];if(c){l=l?l+" "+c:c;break}}return l},scope:r}}function $C(i,e){let t=null;for(let r of i){let n=r.style(e);n&&(t=t?t+" "+n:n)}return t}function UC(i,e,t,r=0,n=i.length){let s=new VC(r,Array.isArray(e)?e:[e],t);s.highlightRange(i.cursor(),r,n,"",s.highlighters),s.flush(n)}class VC{constructor(e,t,r){this.at=e,this.highlighters=t,this.span=r,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,r,n,s){let{type:l,from:o,to:a}=e;if(o>=r||a<=t)return;l.isTop&&(s=this.highlighters.filter(d=>!d.scope||d.scope(l)));let c=n,u=qC(e)||vn.empty,h=$C(s,u.tags);if(h&&(c&&(c+=" "),c+=h,u.mode==1&&(n+=(n?" ":"")+h)),this.startSpan(Math.max(t,o),c),u.opaque)return;let f=e.tree&&e.tree.prop(xe.mounted);if(f&&f.overlay){let d=e.node.enter(f.overlay[0].from+o,1),_=this.highlighters.filter(p=>!p.scope||p.scope(f.tree.type)),y=e.firstChild();for(let p=0,m=o;;p++){let g=p<f.overlay.length?f.overlay[p]:null,v=g?g.from+o:a,b=Math.max(t,m),S=Math.min(r,v);if(b<S&&y)for(;e.from<S&&(this.highlightRange(e,b,S,n,s),this.startSpan(Math.min(S,e.to),c),!(e.to>=v||!e.nextSibling())););if(!g||v>r)break;m=g.to+o,m>t&&(this.highlightRange(d.cursor(),Math.max(t,g.from+o),Math.min(r,m),"",_),this.startSpan(Math.min(r,m),c))}y&&e.parent()}else if(e.firstChild()){f&&(n="");do if(!(e.to<=t)){if(e.from>=r)break;this.highlightRange(e,t,r,n,s),this.startSpan(Math.min(r,e.to),c)}while(e.nextSibling());e.parent()}}}function qC(i){let e=i.type.prop(lm);for(;e&&e.context&&!i.matchContext(e.context);)e=e.next;return e||null}const te=Rt.define,ns=te(),wi=te(),Pu=te(wi),Iu=te(wi),Si=te(),ss=te(Si),nl=te(Si),Qt=te(),Ui=te(Qt),Jt=te(),Yt=te(),ua=te(),qr=te(ua),os=te(),V={comment:ns,lineComment:te(ns),blockComment:te(ns),docComment:te(ns),name:wi,variableName:te(wi),typeName:Pu,tagName:te(Pu),propertyName:Iu,attributeName:te(Iu),className:te(wi),labelName:te(wi),namespace:te(wi),macroName:te(wi),literal:Si,string:ss,docString:te(ss),character:te(ss),attributeValue:te(ss),number:nl,integer:te(nl),float:te(nl),bool:te(Si),regexp:te(Si),escape:te(Si),color:te(Si),url:te(Si),keyword:Jt,self:te(Jt),null:te(Jt),atom:te(Jt),unit:te(Jt),modifier:te(Jt),operatorKeyword:te(Jt),controlKeyword:te(Jt),definitionKeyword:te(Jt),moduleKeyword:te(Jt),operator:Yt,derefOperator:te(Yt),arithmeticOperator:te(Yt),logicOperator:te(Yt),bitwiseOperator:te(Yt),compareOperator:te(Yt),updateOperator:te(Yt),definitionOperator:te(Yt),typeOperator:te(Yt),controlOperator:te(Yt),punctuation:ua,separator:te(ua),bracket:qr,angleBracket:te(qr),squareBracket:te(qr),paren:te(qr),brace:te(qr),content:Qt,heading:Ui,heading1:te(Ui),heading2:te(Ui),heading3:te(Ui),heading4:te(Ui),heading5:te(Ui),heading6:te(Ui),contentSeparator:te(Qt),list:te(Qt),quote:te(Qt),emphasis:te(Qt),strong:te(Qt),link:te(Qt),monospace:te(Qt),strikethrough:te(Qt),inserted:te(),deleted:te(),changed:te(),invalid:te(),meta:os,documentMeta:te(os),annotation:te(os),processingInstruction:te(os),definition:Rt.defineModifier("definition"),constant:Rt.defineModifier("constant"),function:Rt.defineModifier("function"),standard:Rt.defineModifier("standard"),local:Rt.defineModifier("local"),special:Rt.defineModifier("special")};for(let i in V){let e=V[i];e instanceof Rt&&(e.name=i)}am([{tag:V.link,class:"tok-link"},{tag:V.heading,class:"tok-heading"},{tag:V.emphasis,class:"tok-emphasis"},{tag:V.strong,class:"tok-strong"},{tag:V.keyword,class:"tok-keyword"},{tag:V.atom,class:"tok-atom"},{tag:V.bool,class:"tok-bool"},{tag:V.url,class:"tok-url"},{tag:V.labelName,class:"tok-labelName"},{tag:V.inserted,class:"tok-inserted"},{tag:V.deleted,class:"tok-deleted"},{tag:V.literal,class:"tok-literal"},{tag:V.string,class:"tok-string"},{tag:V.number,class:"tok-number"},{tag:[V.regexp,V.escape,V.special(V.string)],class:"tok-string2"},{tag:V.variableName,class:"tok-variableName"},{tag:V.local(V.variableName),class:"tok-variableName tok-local"},{tag:V.definition(V.variableName),class:"tok-variableName tok-definition"},{tag:V.special(V.variableName),class:"tok-variableName2"},{tag:V.definition(V.propertyName),class:"tok-propertyName tok-definition"},{tag:V.typeName,class:"tok-typeName"},{tag:V.namespace,class:"tok-namespace"},{tag:V.className,class:"tok-className"},{tag:V.macroName,class:"tok-macroName"},{tag:V.propertyName,class:"tok-propertyName"},{tag:V.operator,class:"tok-operator"},{tag:V.comment,class:"tok-comment"},{tag:V.meta,class:"tok-meta"},{tag:V.invalid,class:"tok-invalid"},{tag:V.punctuation,class:"tok-punctuation"}]);var sl;const fr=new xe;function KC(i){return oe.define({combine:i?e=>e.concat(i):void 0})}const GC=new xe;class Wt{constructor(e,t,r=[],n=""){this.data=e,this.name=n,Ce.prototype.hasOwnProperty("tree")||Object.defineProperty(Ce.prototype,"tree",{get(){return Ze(this)}}),this.parser=t,this.extension=[Pi.of(this),Ce.languageData.of((s,l,o)=>{let a=Nu(s,l,o),c=a.type.prop(fr);if(!c)return[];let u=s.facet(c),h=a.type.prop(GC);if(h){let f=a.resolve(l-a.from,o);for(let d of h)if(d.test(f,s)){let _=s.facet(d.facet);return d.type=="replace"?_:_.concat(u)}}return u})].concat(r)}isActiveAt(e,t,r=-1){return Nu(e,t,r).type.prop(fr)==this.data}findRegions(e){let t=e.facet(Pi);if((t==null?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let r=[],n=(s,l)=>{if(s.prop(fr)==this.data){r.push({from:l,to:l+s.length});return}let o=s.prop(xe.mounted);if(o){if(o.tree.prop(fr)==this.data){if(o.overlay)for(let a of o.overlay)r.push({from:a.from+l,to:a.to+l});else r.push({from:l,to:l+s.length});return}else if(o.overlay){let a=r.length;if(n(o.tree,o.overlay[0].from+l),r.length>a)return}}for(let a=0;a<s.children.length;a++){let c=s.children[a];c instanceof We&&n(c,s.positions[a]+l)}};return n(Ze(e),0),r}get allowsNesting(){return!0}}Wt.setState=pe.define();function Nu(i,e,t){let r=i.facet(Pi),n=Ze(i).topNode;if(!r||r.allowsNesting)for(let s=n;s;s=s.enter(e,t,Te.ExcludeBuffers|Te.EnterBracketed))s.type.isTop&&(n=s);return n}class fa extends Wt{constructor(e,t,r){super(e,t,[],r),this.parser=t}static define(e){let t=KC(e.languageData);return new fa(t,e.parser.configure({props:[fr.add(r=>r.isTop?t:void 0)]}),e.name)}configure(e,t){return new fa(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function Ze(i){let e=i.field(Wt.state,!1);return e?e.tree:We.empty}class XC{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let r=this.cursorPos-this.string.length;return e<r||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-r,t-r)}}let Kr=null;class js{constructor(e,t,r=[],n,s,l,o,a){this.parser=e,this.state=t,this.fragments=r,this.tree=n,this.treeLen=s,this.viewport=l,this.skipped=o,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(e,t,r){return new js(e,t,[],We.empty,0,r,[],null)}startParse(){return this.parser.startParse(new XC(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=We.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var r;if(typeof e=="number"){let n=Date.now()+e;e=()=>Date.now()>n}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let n=this.parse.advance();if(n)if(this.fragments=this.withoutTempSkipped(fi.addTree(n,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(r=this.parse.stoppedAt)!==null&&r!==void 0?r:this.state.doc.length,this.tree=n,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(fi.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=Kr;Kr=this;try{return e()}finally{Kr=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=Fu(e,t.from,t.to);return e}changes(e,t){let{fragments:r,tree:n,treeLen:s,viewport:l,skipped:o}=this;if(this.takeTree(),!e.empty){let a=[];if(e.iterChangedRanges((c,u,h,f)=>a.push({fromA:c,toA:u,fromB:h,toB:f})),r=fi.applyChanges(r,a),n=We.empty,s=0,l={from:e.mapPos(l.from,-1),to:e.mapPos(l.to,1)},this.skipped.length){o=[];for(let c of this.skipped){let u=e.mapPos(c.from,1),h=e.mapPos(c.to,-1);u<h&&o.push({from:u,to:h})}}}return new js(this.parser,t,r,n,s,l,o,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let r=0;r<this.skipped.length;r++){let{from:n,to:s}=this.skipped[r];n<e.to&&s>e.from&&(this.fragments=Fu(this.fragments,n,s),this.skipped.splice(r--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends LC{createParse(t,r,n){let s=n[0].from,l=n[n.length-1].to;return{parsedPos:s,advance(){let a=Kr;if(a){for(let c of n)a.tempSkipped.push(c);e&&(a.scheduleOn=a.scheduleOn?Promise.all([a.scheduleOn,e]):e)}return this.parsedPos=l,new We(xt.none,[],[],l-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return Kr}}function Fu(i,e,t){return fi.applyChanges(i,[{fromA:e,toA:t,fromB:e,toB:t}])}class Mr{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,r)||t.takeTree(),new Mr(t)}static init(e){let t=Math.min(3e3,e.doc.length),r=js.create(e.facet(Pi).parser,e,{from:0,to:t});return r.work(20,t)||r.takeTree(),new Mr(r)}}Wt.state=et.define({create:Mr.init,update(i,e){for(let t of e.effects)if(t.is(Wt.setState))return t.value;return e.startState.facet(Pi)!=e.state.facet(Pi)?Mr.init(e.state):i.apply(e)}});let cm=i=>{let e=setTimeout(()=>i(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(cm=i=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(i,{timeout:400})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const ol=typeof navigator<"u"&&(!((sl=navigator.scheduling)===null||sl===void 0)&&sl.isInputPending)?()=>navigator.scheduling.isInputPending():null,JC=st.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(Wt.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(Wt.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=cm(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:n}}=this.view,s=r.field(Wt.state);if(s.tree==s.context.tree&&s.context.isDone(n+1e5))return;let l=Date.now()+Math.min(this.chunkBudget,100,e&&!ol?Math.max(25,e.timeRemaining()-5):1e9),o=s.context.treeLen<n&&r.doc.length>n+1e3,a=s.context.work(()=>ol&&ol()||Date.now()>l,n+(o?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:Wt.setState.of(new Mr(s.context))})),this.chunkBudget>0&&!(a&&!o)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>_t(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Pi=oe.define({combine(i){return i.length?i[0]:null},enables:i=>[Wt.state,JC,se.contentAttributes.compute([i],e=>{let t=e.facet(i);return t&&t.name?{"data-language":t.name}:{}})]});class dM{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}class hm{constructor(e,t,r,n,s,l=void 0){this.name=e,this.alias=t,this.extensions=r,this.filename=n,this.loadFunc=s,this.support=l,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then(e=>this.support=e,e=>{throw this.loading=null,e}))}static of(e){let{load:t,support:r}=e;if(!t){if(!r)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");t=()=>Promise.resolve(r)}return new hm(e.name,(e.alias||[]).concat(e.name).map(n=>n.toLowerCase()),e.extensions||[],e.filename,t,r)}static matchFilename(e,t){for(let n of e)if(n.filename&&n.filename.test(t))return n;let r=/\.([^.]+)$/.exec(t);if(r){for(let n of e)if(n.extensions.indexOf(r[1])>-1)return n}return null}static matchLanguageName(e,t,r=!0){t=t.toLowerCase();for(let n of e)if(n.alias.some(s=>s==t))return n;if(r)for(let n of e)for(let s of n.alias){let l=t.indexOf(s);if(l>-1&&(s.length>2||!/\w/.test(t[l-1])&&!/\w/.test(t[l+s.length])))return n}return null}}const YC=oe.define(),fo=oe.define({combine:i=>{if(!i.length)return"  ";let e=i[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(i[0]));return e}});function zs(i){let e=i.facet(fo);return e.charCodeAt(0)==9?i.tabSize*e.length:e.length}function _n(i,e){let t="",r=i.tabSize,n=i.facet(fo)[0];if(n=="	"){for(;e>=r;)t+="	",e-=r;n=" "}for(let s=0;s<e;s++)t+=n;return t}function fc(i,e){i instanceof Ce&&(i=new po(i));for(let r of i.state.facet(YC)){let n=r(i,e);if(n!==void 0)return n}let t=Ze(i.state);return t.length>=e?ZC(i,t,e):null}class po{constructor(e,t={}){this.state=e,this.options=t,this.unit=zs(e)}lineAt(e,t=1){let r=this.state.doc.lineAt(e),{simulateBreak:n,simulateDoubleBreak:s}=this.options;return n!=null&&n>=r.from&&n<=r.to?s&&n==e?{text:"",from:e}:(t<0?n<e:n<=e)?{text:r.text.slice(n-r.from),from:n}:{text:r.text.slice(0,n-r.from),from:r.from}:r}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:n}=this.lineAt(e,t);return r.slice(e-n,Math.min(r.length,e+100-n))}column(e,t=1){let{text:r,from:n}=this.lineAt(e,t),s=this.countColumn(r,e-n),l=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return l>-1&&(s+=l-this.countColumn(r,r.search(/\S|$/))),s}countColumn(e,t=e.length){return no(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:r,from:n}=this.lineAt(e,t),s=this.options.overrideIndentation;if(s){let l=s(n);if(l>-1)return l}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const QC=new xe;function ZC(i,e,t){let r=e.resolveStack(t),n=e.resolveInner(t,-1).resolve(t,0).enterUnfinishedNodesBefore(t);if(n!=r.node){let s=[];for(let l=n;l&&!(l.from<r.node.from||l.to>r.node.to||l.from==r.node.from&&l.type==r.node.type);l=l.parent)s.push(l);for(let l=s.length-1;l>=0;l--)r={node:s[l],next:r}}return um(r,i,t)}function um(i,e,t){for(let r=i;r;r=r.next){let n=t2(r.node);if(n)return n(dc.create(e,t,r))}return 0}function e2(i){return i.pos==i.options.simulateBreak&&i.options.simulateDoubleBreak}function t2(i){let e=i.type.prop(QC);if(e)return e;let t=i.firstChild,r;if(t&&(r=t.type.prop(xe.closedBy))){let n=i.lastChild,s=n&&r.indexOf(n.name)>-1;return l=>fm(l,!0,1,void 0,s&&!e2(l)?n.from:void 0)}return i.parent==null?i2:null}function i2(){return 0}class dc extends po{constructor(e,t,r){super(e.state,e.options),this.base=e,this.pos=t,this.context=r}get node(){return this.context.node}static create(e,t,r){return new dc(e,t,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let r=e.resolve(t.from);for(;r.parent&&r.parent.from==r.from;)r=r.parent;if(r2(r,e))break;t=this.state.doc.lineAt(r.from)}return this.lineIndent(t.from)}continue(){return um(this.context.next,this.base,this.pos)}}function r2(i,e){for(let t=e;t;t=t.parent)if(i==t)return!0;return!1}function n2(i){let e=i.node,t=e.childAfter(e.from),r=e.lastChild;if(!t)return null;let n=i.options.simulateBreak,s=i.state.doc.lineAt(t.from),l=n==null||n<=s.from?s.to:Math.min(s.to,n);for(let o=t.to;;){let a=e.childAfter(o);if(!a||a==r)return null;if(!a.type.isSkipped){if(a.from>=l)return null;let c=/^ */.exec(s.text.slice(t.to-s.from))[0].length;return{from:t.from,to:t.to+c}}o=a.to}}function pM({closing:i,align:e=!0,units:t=1}){return r=>fm(r,e,t,i)}function fm(i,e,t,r,n){let s=i.textAfter,l=s.match(/^\s*/)[0].length,o=r&&s.slice(l,l+r.length)==r||n==i.pos+l,a=e?n2(i):null;return a?o?i.column(a.from):i.column(a.to):i.baseIndent+(o?0:i.unit*t)}const mM=i=>i.baseIndent;function gM({except:i,units:e=1}={}){return t=>{let r=i&&i.test(t.textAfter);return t.baseIndent+(r?0:e*t.unit)}}const s2=200;function o2(){return Ce.transactionFilter.of(i=>{if(!i.docChanged||!i.isUserEvent("input.type")&&!i.isUserEvent("input.complete"))return i;let e=i.startState.languageDataAt("indentOnInput",i.startState.selection.main.head);if(!e.length)return i;let t=i.newDoc,{head:r}=i.newSelection.main,n=t.lineAt(r);if(r>n.from+s2)return i;let s=t.sliceString(n.from,r);if(!e.some(c=>c.test(s)))return i;let{state:l}=i,o=-1,a=[];for(let{head:c}of l.selection.ranges){let u=l.doc.lineAt(c);if(u.from==o)continue;o=u.from;let h=fc(l,u.from);if(h==null)continue;let f=/^\s*/.exec(u.text)[0],d=_n(l,h);f!=d&&a.push({from:u.from,to:u.from+f.length,insert:d})}return a.length?[i,{changes:a,sequential:!0}]:i})}const l2=oe.define(),a2=new xe;function vM(i){let e=i.firstChild,t=i.lastChild;return e&&e.to<t.from?{from:e.to,to:t.type.isError?i.to:t.from}:null}function c2(i,e,t){let r=Ze(i);if(r.length<t)return null;let n=r.resolveStack(t,1),s=null;for(let l=n;l;l=l.next){let o=l.node;if(o.to<=t||o.from>t)continue;if(s&&o.from<e)break;let a=o.type.prop(a2);if(a&&(o.to<r.length-50||r.length==i.doc.length||!h2(o))){let c=a(o,i);c&&c.from<=t&&c.from>=e&&c.to>t&&(s=c)}}return s}function h2(i){let e=i.lastChild;return e&&e.to==i.to&&e.type.isError}function Hu(i,e,t){for(let r of i.facet(l2)){let n=r(i,e,t);if(n)return n}return c2(i,e,t)}function dm(i,e){let t=e.mapPos(i.from,1),r=e.mapPos(i.to,-1);return t>=r?void 0:{from:t,to:r}}const pm=pe.define({map:dm}),pc=pe.define({map:dm}),Ws=et.define({create(){return he.none},update(i,e){e.isUserEvent("delete")&&e.changes.iterChangedRanges((t,r)=>i=ju(i,t,r)),i=i.map(e.changes);for(let t of e.effects)if(t.is(pm)&&!u2(i,t.value.from,t.value.to)){let{preparePlaceholder:r}=e.state.facet(mm),n=r?he.replace({widget:new p2(r(e.state,t.value))}):zu;i=i.update({add:[n.range(t.value.from,t.value.to)]})}else t.is(pc)&&(i=i.update({filter:(r,n)=>t.value.from!=r||t.value.to!=n,filterFrom:t.value.from,filterTo:t.value.to}));return e.selection&&(i=ju(i,e.selection.main.head)),i},provide:i=>se.decorations.from(i),toJSON(i,e){let t=[];return i.between(0,e.doc.length,(r,n)=>{t.push(r,n)}),t},fromJSON(i){if(!Array.isArray(i)||i.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let t=0;t<i.length;){let r=i[t++],n=i[t++];if(typeof r!="number"||typeof n!="number")throw new RangeError("Invalid JSON for fold state");e.push(zu.range(r,n))}return he.set(e,!0)}});function ju(i,e,t=e){let r=!1;return i.between(e,t,(n,s)=>{n<t&&s>e&&(r=!0)}),r?i.update({filterFrom:e,filterTo:t,filter:(n,s)=>n>=t||s<=e}):i}function da(i,e,t){var r;let n=null;return(r=i.field(Ws,!1))===null||r===void 0||r.between(e,t,(s,l)=>{(!n||n.from>s)&&(n={from:s,to:l})}),n}function u2(i,e,t){let r=!1;return i.between(e,e,(n,s)=>{n==e&&s==t&&(r=!0)}),r}const f2={placeholderDOM:null,preparePlaceholder:null,placeholderText:""},mm=oe.define({combine(i){return Ni(i,f2)}});function d2(i){return[Ws,v2]}function gm(i,e){let{state:t}=i,r=t.facet(mm),n=l=>{let o=i.lineBlockAt(i.posAtDOM(l.target)),a=da(i.state,o.from,o.to);a&&i.dispatch({effects:pc.of(a)}),l.preventDefault()};if(r.placeholderDOM)return r.placeholderDOM(i,n,e);let s=document.createElement("span");return s.textContent=r.placeholderText,s.setAttribute("aria-label",t.phrase("folded code")),s.title=t.phrase("unfold"),s.className="cm-foldPlaceholder",s.onclick=n,s}const zu=he.replace({widget:new class extends Fi{toDOM(i){return gm(i,null)}}});class p2 extends Fi{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return gm(e,this.value)}}const m2={openText:"",closedText:"",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class ll extends pi{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function g2(i={}){let e={...m2,...i},t=new ll(e,!0),r=new ll(e,!1),n=st.fromClass(class{constructor(l){this.from=l.viewport.from,this.markers=this.buildMarkers(l)}update(l){(l.docChanged||l.viewportChanged||l.startState.facet(Pi)!=l.state.facet(Pi)||l.startState.field(Ws,!1)!=l.state.field(Ws,!1)||Ze(l.startState)!=Ze(l.state)||e.foldingChanged(l))&&(this.markers=this.buildMarkers(l.view))}buildMarkers(l){let o=new Li;for(let a of l.viewportLineBlocks){let c=da(l.state,a.from,a.to)?r:Hu(l.state,a.from,a.to)?t:null;c&&o.add(a.from,a.from,c)}return o.finish()}}),{domEventHandlers:s}=e;return[n,fC({class:"cm-foldGutter",markers(l){var o;return((o=l.plugin(n))===null||o===void 0?void 0:o.markers)||ye.empty},initialSpacer(){return new ll(e,!1)},domEventHandlers:{...s,click:(l,o,a)=>{if(s.click&&s.click(l,o,a))return!0;let c=da(l.state,o.from,o.to);if(c)return l.dispatch({effects:pc.of(c)}),!0;let u=Hu(l.state,o.from,o.to);return u?(l.dispatch({effects:pm.of(u)}),!0):!1}}}),d2()]}const v2=se.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class On{constructor(e,t){this.specs=e;let r;function n(o){let a=Ti.newName();return(r||(r=Object.create(null)))["."+a]=o,a}const s=typeof t.all=="string"?t.all:t.all?n(t.all):void 0,l=t.scope;this.scope=l instanceof Wt?o=>o.prop(fr)==l.data:l?o=>o==l:void 0,this.style=am(e.map(o=>({tag:o.tag,class:o.class||n(Object.assign({},o,{tag:null}))})),{all:s}).style,this.module=r?new Ti(r):null,this.themeType=t.themeType}static define(e,t){return new On(e,t||{})}}const pa=oe.define(),vm=oe.define({combine(i){return i.length?[i[0]]:null}});function al(i){let e=i.facet(pa);return e.length?e:i.facet(vm)}function _m(i,e){let t=[y2],r;return i instanceof On&&(i.module&&t.push(se.styleModule.of(i.module)),r=i.themeType),e!=null&&e.fallback?t.push(vm.of(i)):r?t.push(pa.computeN([se.darkTheme],n=>n.facet(se.darkTheme)==(r=="dark")?[i]:[])):t.push(pa.of(i)),t}class _2{constructor(e){this.markCache=Object.create(null),this.tree=Ze(e.state),this.decorations=this.buildDeco(e,al(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=Ze(e.state),r=al(e.state),n=r!=al(e.startState),{viewport:s}=e.view,l=e.changes.mapPos(this.decoratedTo,1);t.length<s.to&&!n&&t.type==this.tree.type&&l>=s.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=l):(t!=this.tree||e.viewportChanged||n)&&(this.tree=t,this.decorations=this.buildDeco(e.view,r),this.decoratedTo=s.to)}buildDeco(e,t){if(!t||!this.tree.length)return he.none;let r=new Li;for(let{from:n,to:s}of e.visibleRanges)UC(this.tree,t,(l,o,a)=>{r.add(l,o,this.markCache[a]||(this.markCache[a]=he.mark({class:a})))},n,s);return r.finish()}}const y2=nr.high(st.fromClass(_2,{decorations:i=>i.decorations})),b2=On.define([{tag:V.meta,color:"#404740"},{tag:V.link,textDecoration:"underline"},{tag:V.heading,textDecoration:"underline",fontWeight:"bold"},{tag:V.emphasis,fontStyle:"italic"},{tag:V.strong,fontWeight:"bold"},{tag:V.strikethrough,textDecoration:"line-through"},{tag:V.keyword,color:"#708"},{tag:[V.atom,V.bool,V.url,V.contentSeparator,V.labelName],color:"#219"},{tag:[V.literal,V.inserted],color:"#164"},{tag:[V.string,V.deleted],color:"#a11"},{tag:[V.regexp,V.escape,V.special(V.string)],color:"#e40"},{tag:V.definition(V.variableName),color:"#00f"},{tag:V.local(V.variableName),color:"#30a"},{tag:[V.typeName,V.namespace],color:"#085"},{tag:V.className,color:"#167"},{tag:[V.special(V.variableName),V.macroName],color:"#256"},{tag:V.definition(V.propertyName),color:"#00c"},{tag:V.comment,color:"#940"},{tag:V.invalid,color:"#f00"}]),x2=se.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),ym=1e4,bm="()[]{}",xm=oe.define({combine(i){return Ni(i,{afterCursor:!0,brackets:bm,maxScanDistance:ym,renderMatch:k2})}}),w2=he.mark({class:"cm-matchingBracket"}),S2=he.mark({class:"cm-nonmatchingBracket"});function k2(i){let e=[],t=i.matched?w2:S2;return e.push(t.range(i.start.from,i.start.to)),i.end&&e.push(t.range(i.end.from,i.end.to)),e}const C2=et.define({create(){return he.none},update(i,e){if(!e.docChanged&&!e.selection)return i;let t=[],r=e.state.facet(xm);for(let n of e.state.selection.ranges){if(!n.empty)continue;let s=ni(e.state,n.head,-1,r)||n.head>0&&ni(e.state,n.head-1,1,r)||r.afterCursor&&(ni(e.state,n.head,1,r)||n.head<e.state.doc.length&&ni(e.state,n.head+1,-1,r));s&&(t=t.concat(r.renderMatch(s,e.state)))}return he.set(t,!0)},provide:i=>se.decorations.from(i)}),E2=[C2,x2];function A2(i={}){return[xm.of(i),E2]}const D2=new xe;function ma(i,e,t){let r=i.prop(e<0?xe.openedBy:xe.closedBy);if(r)return r;if(i.name.length==1){let n=t.indexOf(i.name);if(n>-1&&n%2==(e<0?1:0))return[t[n+e]]}return null}function ga(i){let e=i.type.prop(D2);return e?e(i.node):i}function ni(i,e,t,r={}){let n=r.maxScanDistance||ym,s=r.brackets||bm,l=Ze(i),o=l.resolveInner(e,t);for(let a=o;a;a=a.parent){let c=ma(a.type,t,s);if(c&&a.from<a.to){let u=ga(a);if(u&&(t>0?e>=u.from&&e<u.to:e>u.from&&e<=u.to))return M2(i,e,t,a,u,c,s)}}return L2(i,e,t,l,o.type,n,s)}function M2(i,e,t,r,n,s,l){let o=r.parent,a={from:n.from,to:n.to},c=0,u=o==null?void 0:o.cursor();if(u&&(t<0?u.childBefore(r.from):u.childAfter(r.to)))do if(t<0?u.to<=r.from:u.from>=r.to){if(c==0&&s.indexOf(u.type.name)>-1&&u.from<u.to){let h=ga(u);return{start:a,end:h?{from:h.from,to:h.to}:void 0,matched:!0}}else if(ma(u.type,t,l))c++;else if(ma(u.type,-t,l)){if(c==0){let h=ga(u);return{start:a,end:h&&h.from<h.to?{from:h.from,to:h.to}:void 0,matched:!1}}c--}}while(t<0?u.prevSibling():u.nextSibling());return{start:a,matched:!1}}function L2(i,e,t,r,n,s,l){let o=t<0?i.sliceDoc(e-1,e):i.sliceDoc(e,e+1),a=l.indexOf(o);if(a<0||a%2==0!=t>0)return null;let c={from:t<0?e-1:e,to:t>0?e+1:e},u=i.doc.iterRange(e,t>0?i.doc.length:0),h=0;for(let f=0;!u.next().done&&f<=s;){let d=u.value;t<0&&(f+=d.length);let _=e+f*t;for(let y=t>0?0:d.length-1,p=t>0?d.length:-1;y!=p;y+=t){let m=l.indexOf(d[y]);if(!(m<0||r.resolveInner(_+y,1).type!=n))if(m%2==0==t>0)h++;else{if(h==1)return{start:c,end:{from:_+y,to:_+y+1},matched:m>>1==a>>1};h--}}t>0&&(f+=d.length)}return u.done?{start:c,matched:!1}:null}const T2=Object.create(null),Wu=[xt.none],$u=[],Uu=Object.create(null),R2=Object.create(null);for(let[i,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])R2[i]=B2(T2,e);function cl(i,e){$u.indexOf(i)>-1||($u.push(i),console.warn(e))}function B2(i,e){let t=[];for(let o of e.split(" ")){let a=[];for(let c of o.split(".")){let u=i[c]||V[c];u?typeof u=="function"?a.length?a=a.map(u):cl(c,`Modifier ${c} used at start of tag`):a.length?cl(c,`Tag ${c} used as modifier`):a=Array.isArray(u)?u:[u]:cl(c,`Unknown highlighting tag ${c}`)}for(let c of a)t.push(c)}if(!t.length)return 0;let r=e.replace(/ /g,"_"),n=r+" "+t.map(o=>o.id),s=Uu[n];if(s)return s.id;let l=Uu[n]=xt.define({id:Wu.length,name:r,props:[WC({[r]:t})]});return Wu.push(l),l.id}Fe.RTL,Fe.LTR;const O2=i=>{let{state:e}=i,t=e.doc.lineAt(e.selection.main.from),r=gc(i.state,t.from);return r.line?P2(i):r.block?N2(i):!1};function mc(i,e){return({state:t,dispatch:r})=>{if(t.readOnly)return!1;let n=i(e,t);return n?(r(t.update(n)),!0):!1}}const P2=mc(j2,0),I2=mc(wm,0),N2=mc((i,e)=>wm(i,e,H2(e)),0);function gc(i,e){let t=i.languageDataAt("commentTokens",e,1);return t.length?t[0]:{}}const Gr=50;function F2(i,{open:e,close:t},r,n){let s=i.sliceDoc(r-Gr,r),l=i.sliceDoc(n,n+Gr),o=/\s*$/.exec(s)[0].length,a=/^\s*/.exec(l)[0].length,c=s.length-o;if(s.slice(c-e.length,c)==e&&l.slice(a,a+t.length)==t)return{open:{pos:r-o,margin:o&&1},close:{pos:n+a,margin:a&&1}};let u,h;n-r<=2*Gr?u=h=i.sliceDoc(r,n):(u=i.sliceDoc(r,r+Gr),h=i.sliceDoc(n-Gr,n));let f=/^\s*/.exec(u)[0].length,d=/\s*$/.exec(h)[0].length,_=h.length-d-t.length;return u.slice(f,f+e.length)==e&&h.slice(_,_+t.length)==t?{open:{pos:r+f+e.length,margin:/\s/.test(u.charAt(f+e.length))?1:0},close:{pos:n-d-t.length,margin:/\s/.test(h.charAt(_-1))?1:0}}:null}function H2(i){let e=[];for(let t of i.selection.ranges){let r=i.doc.lineAt(t.from),n=t.to<=r.to?r:i.doc.lineAt(t.to);n.from>r.from&&n.from==t.to&&(n=t.to==r.to+1?r:i.doc.lineAt(t.to-1));let s=e.length-1;s>=0&&e[s].to>r.from?e[s].to=n.to:e.push({from:r.from+/^\s*/.exec(r.text)[0].length,to:n.to})}return e}function wm(i,e,t=e.selection.ranges){let r=t.map(s=>gc(e,s.from).block);if(!r.every(s=>s))return null;let n=t.map((s,l)=>F2(e,r[l],s.from,s.to));if(i!=2&&!n.every(s=>s))return{changes:e.changes(t.map((s,l)=>n[l]?[]:[{from:s.from,insert:r[l].open+" "},{from:s.to,insert:" "+r[l].close}]))};if(i!=1&&n.some(s=>s)){let s=[];for(let l=0,o;l<n.length;l++)if(o=n[l]){let a=r[l],{open:c,close:u}=o;s.push({from:c.pos-a.open.length,to:c.pos+c.margin},{from:u.pos-u.margin,to:u.pos+a.close.length})}return{changes:s}}return null}function j2(i,e,t=e.selection.ranges){let r=[],n=-1;for(let{from:s,to:l}of t){let o=r.length,a=1e9,c=gc(e,s).line;if(c){for(let u=s;u<=l;){let h=e.doc.lineAt(u);if(h.from>n&&(s==l||l>h.from)){n=h.from;let f=/^\s*/.exec(h.text)[0].length,d=f==h.length,_=h.text.slice(f,f+c.length)==c?f:-1;f<h.text.length&&f<a&&(a=f),r.push({line:h,comment:_,token:c,indent:f,empty:d,single:!1})}u=h.to+1}if(a<1e9)for(let u=o;u<r.length;u++)r[u].indent<r[u].line.text.length&&(r[u].indent=a);r.length==o+1&&(r[o].single=!0)}}if(i!=2&&r.some(s=>s.comment<0&&(!s.empty||s.single))){let s=[];for(let{line:o,token:a,indent:c,empty:u,single:h}of r)(h||!u)&&s.push({from:o.from+c,insert:a+" "});let l=e.changes(s);return{changes:l,selection:e.selection.map(l,1)}}else if(i!=1&&r.some(s=>s.comment>=0)){let s=[];for(let{line:l,comment:o,token:a}of r)if(o>=0){let c=l.from+o,u=c+a.length;l.text[u-l.from]==" "&&u++,s.push({from:c,to:u})}return{changes:s}}return null}const va=gi.define(),z2=gi.define(),W2=oe.define(),Sm=oe.define({combine(i){return Ni(i,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(r,n)=>e(r,n)||t(r,n)})}}),km=et.define({create(){return si.empty},update(i,e){let t=e.state.facet(Sm),r=e.annotation(va);if(r){let a=yt.fromTransaction(e,r.selection),c=r.side,u=c==0?i.undone:i.done;return a?u=$s(u,u.length,t.minDepth,a):u=Am(u,e.startState.selection),new si(c==0?r.rest:u,c==0?u:r.rest)}let n=e.annotation(z2);if((n=="full"||n=="before")&&(i=i.isolate()),e.annotation(ze.addToHistory)===!1)return e.changes.empty?i:i.addMapping(e.changes.desc);let s=yt.fromTransaction(e),l=e.annotation(ze.time),o=e.annotation(ze.userEvent);return s?i=i.addChanges(s,l,o,t,e):e.selection&&(i=i.addSelection(e.startState.selection,l,o,t.newGroupDelay)),(n=="full"||n=="after")&&(i=i.isolate()),i},toJSON(i){return{done:i.done.map(e=>e.toJSON()),undone:i.undone.map(e=>e.toJSON())}},fromJSON(i){return new si(i.done.map(yt.fromJSON),i.undone.map(yt.fromJSON))}});function $2(i={}){return[km,Sm.of(i),se.domEventHandlers({beforeinput(e,t){let r=e.inputType=="historyUndo"?Cm:e.inputType=="historyRedo"?_a:null;return r?(e.preventDefault(),r(t)):!1}})]}function mo(i,e){return function({state:t,dispatch:r}){if(!e&&t.readOnly)return!1;let n=t.field(km,!1);if(!n)return!1;let s=n.pop(i,t,e);return s?(r(s),!0):!1}}const Cm=mo(0,!1),_a=mo(1,!1),U2=mo(0,!0),V2=mo(1,!0);class yt{constructor(e,t,r,n,s){this.changes=e,this.effects=t,this.mapped=r,this.startSelection=n,this.selectionsAfter=s}setSelAfter(e){return new yt(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,r;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(r=this.startSelection)===null||r===void 0?void 0:r.toJSON(),selectionsAfter:this.selectionsAfter.map(n=>n.toJSON())}}static fromJSON(e){return new yt(e.changes&&qe.fromJSON(e.changes),[],e.mapped&&oi.fromJSON(e.mapped),e.startSelection&&G.fromJSON(e.startSelection),e.selectionsAfter.map(G.fromJSON))}static fromTransaction(e,t){let r=Pt;for(let n of e.startState.facet(W2)){let s=n(e);s.length&&(r=r.concat(s))}return!r.length&&e.changes.empty?null:new yt(e.changes.invert(e.startState.doc),r,void 0,t||e.startState.selection,Pt)}static selection(e){return new yt(void 0,Pt,void 0,void 0,e)}}function $s(i,e,t,r){let n=e+1>t+20?e-t-1:0,s=i.slice(n,e);return s.push(r),s}function q2(i,e){let t=[],r=!1;return i.iterChangedRanges((n,s)=>t.push(n,s)),e.iterChangedRanges((n,s,l,o)=>{for(let a=0;a<t.length;){let c=t[a++],u=t[a++];o>=c&&l<=u&&(r=!0)}}),r}function K2(i,e){return i.ranges.length==e.ranges.length&&i.ranges.filter((t,r)=>t.empty!=e.ranges[r].empty).length===0}function Em(i,e){return i.length?e.length?i.concat(e):i:e}const Pt=[],G2=200;function Am(i,e){if(i.length){let t=i[i.length-1],r=t.selectionsAfter.slice(Math.max(0,t.selectionsAfter.length-G2));return r.length&&r[r.length-1].eq(e)?i:(r.push(e),$s(i,i.length-1,1e9,t.setSelAfter(r)))}else return[yt.selection([e])]}function X2(i){let e=i[i.length-1],t=i.slice();return t[i.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),t}function hl(i,e){if(!i.length)return i;let t=i.length,r=Pt;for(;t;){let n=J2(i[t-1],e,r);if(n.changes&&!n.changes.empty||n.effects.length){let s=i.slice(0,t);return s[t-1]=n,s}else e=n.mapped,t--,r=n.selectionsAfter}return r.length?[yt.selection(r)]:Pt}function J2(i,e,t){let r=Em(i.selectionsAfter.length?i.selectionsAfter.map(o=>o.map(e)):Pt,t);if(!i.changes)return yt.selection(r);let n=i.changes.map(e),s=e.mapDesc(i.changes,!0),l=i.mapped?i.mapped.composeDesc(s):s;return new yt(n,pe.mapEffects(i.effects,e),l,i.startSelection.map(s),r)}const Y2=/^(input\.type|delete)($|\.)/;class si{constructor(e,t,r=0,n=void 0){this.done=e,this.undone=t,this.prevTime=r,this.prevUserEvent=n}isolate(){return this.prevTime?new si(this.done,this.undone):this}addChanges(e,t,r,n,s){let l=this.done,o=l[l.length-1];return o&&o.changes&&!o.changes.empty&&e.changes&&(!r||Y2.test(r))&&(!o.selectionsAfter.length&&t-this.prevTime<n.newGroupDelay&&n.joinToEvent(s,q2(o.changes,e.changes))||r=="input.type.compose")?l=$s(l,l.length-1,n.minDepth,new yt(e.changes.compose(o.changes),Em(pe.mapEffects(e.effects,o.changes),o.effects),o.mapped,o.startSelection,Pt)):l=$s(l,l.length,n.minDepth,e),new si(l,Pt,t,r)}addSelection(e,t,r,n){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:Pt;return s.length>0&&t-this.prevTime<n&&r==this.prevUserEvent&&r&&/^select($|\.)/.test(r)&&K2(s[s.length-1],e)?this:new si(Am(this.done,e),this.undone,t,r)}addMapping(e){return new si(hl(this.done,e),hl(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,r){let n=e==0?this.done:this.undone;if(n.length==0)return null;let s=n[n.length-1],l=s.selectionsAfter[0]||t.selection;if(r&&s.selectionsAfter.length)return t.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:va.of({side:e,rest:X2(n),selection:l}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let o=n.length==1?Pt:n.slice(0,n.length-1);return s.mapped&&(o=hl(o,s.mapped)),t.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:va.of({side:e,rest:o,selection:l}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}si.empty=new si(Pt,Pt);const Q2=[{key:"Mod-z",run:Cm,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:_a,preventDefault:!0},{linux:"Ctrl-Shift-z",run:_a,preventDefault:!0},{key:"Mod-u",run:U2,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:V2,preventDefault:!0}];function Ir(i,e){return G.create(i.ranges.map(e),i.mainIndex)}function Vt(i,e){return i.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function qt({state:i,dispatch:e},t){let r=Ir(i.selection,t);return r.eq(i.selection,!0)?!1:(e(Vt(i,r)),!0)}function go(i,e){return G.cursor(e?i.to:i.from)}function Dm(i,e){return qt(i,t=>t.empty?i.moveByChar(t,e):go(t,e))}function lt(i){return i.textDirectionAt(i.state.selection.main.head)==Fe.LTR}const Mm=i=>Dm(i,!lt(i)),Lm=i=>Dm(i,lt(i));function Tm(i,e){return qt(i,t=>t.empty?i.moveByGroup(t,e):go(t,e))}const Z2=i=>Tm(i,!lt(i)),eE=i=>Tm(i,lt(i));function tE(i,e,t){if(e.type.prop(t))return!0;let r=e.to-e.from;return r&&(r>2||/[^\s,.;:]/.test(i.sliceDoc(e.from,e.to)))||e.firstChild}function vo(i,e,t){let r=Ze(i).resolveInner(e.head),n=t?xe.closedBy:xe.openedBy;for(let a=e.head;;){let c=t?r.childAfter(a):r.childBefore(a);if(!c)break;tE(i,c,n)?r=c:a=t?c.to:c.from}let s=r.type.prop(n),l,o;return s&&(l=t?ni(i,r.from,1):ni(i,r.to,-1))&&l.matched?o=t?l.end.to:l.end.from:o=t?r.to:r.from,G.cursor(o,t?-1:1)}const iE=i=>qt(i,e=>vo(i.state,e,!lt(i))),rE=i=>qt(i,e=>vo(i.state,e,lt(i)));function Rm(i,e){return qt(i,t=>{if(!t.empty)return go(t,e);let r=i.moveVertically(t,e);return r.head!=t.head?r:i.moveToLineBoundary(t,e)})}const Bm=i=>Rm(i,!1),Om=i=>Rm(i,!0);function Pm(i){let e=i.scrollDOM.clientHeight<i.scrollDOM.scrollHeight-2,t=0,r=0,n;if(e){for(let s of i.state.facet(se.scrollMargins)){let l=s(i);l!=null&&l.top&&(t=Math.max(l==null?void 0:l.top,t)),l!=null&&l.bottom&&(r=Math.max(l==null?void 0:l.bottom,r))}n=i.scrollDOM.clientHeight-t-r}else n=(i.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:t,marginBottom:r,selfScroll:e,height:Math.max(i.defaultLineHeight,n-5)}}function Im(i,e){let t=Pm(i),{state:r}=i,n=Ir(r.selection,l=>l.empty?i.moveVertically(l,e,t.height):go(l,e));if(n.eq(r.selection))return!1;let s;if(t.selfScroll){let l=i.coordsAtPos(r.selection.main.head),o=i.scrollDOM.getBoundingClientRect(),a=o.top+t.marginTop,c=o.bottom-t.marginBottom;l&&l.top>a&&l.bottom<c&&(s=se.scrollIntoView(n.main.head,{y:"start",yMargin:l.top-a}))}return i.dispatch(Vt(r,n),{effects:s}),!0}const Vu=i=>Im(i,!1),ya=i=>Im(i,!0);function Hi(i,e,t){let r=i.lineBlockAt(e.head),n=i.moveToLineBoundary(e,t);if(n.head==e.head&&n.head!=(t?r.to:r.from)&&(n=i.moveToLineBoundary(e,t,!1)),!t&&n.head==r.from&&r.length){let s=/^\s*/.exec(i.state.sliceDoc(r.from,Math.min(r.from+100,r.to)))[0].length;s&&e.head!=r.from+s&&(n=G.cursor(r.from+s))}return n}const nE=i=>qt(i,e=>Hi(i,e,!0)),sE=i=>qt(i,e=>Hi(i,e,!1)),oE=i=>qt(i,e=>Hi(i,e,!lt(i))),lE=i=>qt(i,e=>Hi(i,e,lt(i))),aE=i=>qt(i,e=>G.cursor(i.lineBlockAt(e.head).from,1)),cE=i=>qt(i,e=>G.cursor(i.lineBlockAt(e.head).to,-1));function hE(i,e,t){let r=!1,n=Ir(i.selection,s=>{let l=ni(i,s.head,-1)||ni(i,s.head,1)||s.head>0&&ni(i,s.head-1,1)||s.head<i.doc.length&&ni(i,s.head+1,-1);if(!l||!l.end)return s;r=!0;let o=l.start.from==s.head?l.end.to:l.end.from;return G.cursor(o)});return r?(e(Vt(i,n)),!0):!1}const uE=({state:i,dispatch:e})=>hE(i,e);function Ft(i,e){let t=Ir(i.state.selection,r=>{let n=e(r);return G.range(r.anchor,n.head,n.goalColumn,n.bidiLevel||void 0)});return t.eq(i.state.selection)?!1:(i.dispatch(Vt(i.state,t)),!0)}function Nm(i,e){return Ft(i,t=>i.moveByChar(t,e))}const Fm=i=>Nm(i,!lt(i)),Hm=i=>Nm(i,lt(i));function jm(i,e){return Ft(i,t=>i.moveByGroup(t,e))}const fE=i=>jm(i,!lt(i)),dE=i=>jm(i,lt(i)),pE=i=>Ft(i,e=>vo(i.state,e,!lt(i))),mE=i=>Ft(i,e=>vo(i.state,e,lt(i)));function zm(i,e){return Ft(i,t=>i.moveVertically(t,e))}const Wm=i=>zm(i,!1),$m=i=>zm(i,!0);function Um(i,e){return Ft(i,t=>i.moveVertically(t,e,Pm(i).height))}const qu=i=>Um(i,!1),Ku=i=>Um(i,!0),gE=i=>Ft(i,e=>Hi(i,e,!0)),vE=i=>Ft(i,e=>Hi(i,e,!1)),_E=i=>Ft(i,e=>Hi(i,e,!lt(i))),yE=i=>Ft(i,e=>Hi(i,e,lt(i))),bE=i=>Ft(i,e=>G.cursor(i.lineBlockAt(e.head).from)),xE=i=>Ft(i,e=>G.cursor(i.lineBlockAt(e.head).to)),Gu=({state:i,dispatch:e})=>(e(Vt(i,{anchor:0})),!0),Xu=({state:i,dispatch:e})=>(e(Vt(i,{anchor:i.doc.length})),!0),Ju=({state:i,dispatch:e})=>(e(Vt(i,{anchor:i.selection.main.anchor,head:0})),!0),Yu=({state:i,dispatch:e})=>(e(Vt(i,{anchor:i.selection.main.anchor,head:i.doc.length})),!0),wE=({state:i,dispatch:e})=>(e(i.update({selection:{anchor:0,head:i.doc.length},userEvent:"select"})),!0),SE=({state:i,dispatch:e})=>{let t=_o(i).map(({from:r,to:n})=>G.range(r,Math.min(n+1,i.doc.length)));return e(i.update({selection:G.create(t),userEvent:"select"})),!0},kE=({state:i,dispatch:e})=>{let t=Ir(i.selection,r=>{let n=Ze(i),s=n.resolveStack(r.from,1);if(r.empty){let l=n.resolveStack(r.from,-1);l.node.from>=s.node.from&&l.node.to<=s.node.to&&(s=l)}for(let l=s;l;l=l.next){let{node:o}=l;if((o.from<r.from&&o.to>=r.to||o.to>r.to&&o.from<=r.from)&&l.next)return G.range(o.to,o.from)}return r});return t.eq(i.selection)?!1:(e(Vt(i,t)),!0)};function Vm(i,e){let{state:t}=i,r=t.selection,n=t.selection.ranges.slice();for(let s of t.selection.ranges){let l=t.doc.lineAt(s.head);if(e?l.to<i.state.doc.length:l.from>0)for(let o=s;;){let a=i.moveVertically(o,e);if(a.head<l.from||a.head>l.to){n.some(c=>c.head==a.head)||n.push(a);break}else{if(a.head==o.head)break;o=a}}}return n.length==r.ranges.length?!1:(i.dispatch(Vt(t,G.create(n,n.length-1))),!0)}const CE=i=>Vm(i,!1),EE=i=>Vm(i,!0),AE=({state:i,dispatch:e})=>{let t=i.selection,r=null;return t.ranges.length>1?r=G.create([t.main]):t.main.empty||(r=G.create([G.cursor(t.main.head)])),r?(e(Vt(i,r)),!0):!1};function Pn(i,e){if(i.state.readOnly)return!1;let t="delete.selection",{state:r}=i,n=r.changeByRange(s=>{let{from:l,to:o}=s;if(l==o){let a=e(s);a<l?(t="delete.backward",a=ls(i,a,!1)):a>l&&(t="delete.forward",a=ls(i,a,!0)),l=Math.min(l,a),o=Math.max(o,a)}else l=ls(i,l,!1),o=ls(i,o,!0);return l==o?{range:s}:{changes:{from:l,to:o},range:G.cursor(l,l<s.head?-1:1)}});return n.changes.empty?!1:(i.dispatch(r.update(n,{scrollIntoView:!0,userEvent:t,effects:t=="delete.selection"?se.announce.of(r.phrase("Selection deleted")):void 0})),!0)}function ls(i,e,t){if(i instanceof se)for(let r of i.state.facet(se.atomicRanges).map(n=>n(i)))r.between(e,e,(n,s)=>{n<e&&s>e&&(e=t?s:n)});return e}const qm=(i,e,t)=>Pn(i,r=>{let n=r.from,{state:s}=i,l=s.doc.lineAt(n),o,a;if(t&&!e&&n>l.from&&n<l.from+200&&!/[^ \t]/.test(o=l.text.slice(0,n-l.from))){if(o[o.length-1]=="	")return n-1;let c=no(o,s.tabSize),u=c%zs(s)||zs(s);for(let h=0;h<u&&o[o.length-1-h]==" ";h++)n--;a=n}else a=Ke(l.text,n-l.from,e,e)+l.from,a==n&&l.number!=(e?s.doc.lines:1)?a+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(l.text.slice(a-l.from,n-l.from))&&(a=Ke(l.text,a-l.from,!1,!1)+l.from);return a}),ba=i=>qm(i,!1,!0),Km=i=>qm(i,!0,!1),Gm=(i,e)=>Pn(i,t=>{let r=t.head,{state:n}=i,s=n.doc.lineAt(r),l=n.charCategorizer(r);for(let o=null;;){if(r==(e?s.to:s.from)){r==t.head&&s.number!=(e?n.doc.lines:1)&&(r+=e?1:-1);break}let a=Ke(s.text,r-s.from,e)+s.from,c=s.text.slice(Math.min(r,a)-s.from,Math.max(r,a)-s.from),u=l(c);if(o!=null&&u!=o)break;(c!=" "||r!=t.head)&&(o=u),r=a}return r}),Xm=i=>Gm(i,!1),DE=i=>Gm(i,!0),ME=i=>Pn(i,e=>{let t=i.lineBlockAt(e.head).to;return e.head<t?t:Math.min(i.state.doc.length,e.head+1)}),LE=i=>Pn(i,e=>{let t=i.moveToLineBoundary(e,!1).head;return e.head>t?t:Math.max(0,e.head-1)}),TE=i=>Pn(i,e=>{let t=i.moveToLineBoundary(e,!0).head;return e.head<t?t:Math.min(i.state.doc.length,e.head+1)}),RE=({state:i,dispatch:e})=>{if(i.readOnly)return!1;let t=i.changeByRange(r=>({changes:{from:r.from,to:r.to,insert:Ae.of(["",""])},range:G.cursor(r.from)}));return e(i.update(t,{scrollIntoView:!0,userEvent:"input"})),!0},BE=({state:i,dispatch:e})=>{if(i.readOnly)return!1;let t=i.changeByRange(r=>{if(!r.empty||r.from==0||r.from==i.doc.length)return{range:r};let n=r.from,s=i.doc.lineAt(n),l=n==s.from?n-1:Ke(s.text,n-s.from,!1)+s.from,o=n==s.to?n+1:Ke(s.text,n-s.from,!0)+s.from;return{changes:{from:l,to:o,insert:i.doc.slice(n,o).append(i.doc.slice(l,n))},range:G.cursor(o)}});return t.changes.empty?!1:(e(i.update(t,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function _o(i){let e=[],t=-1;for(let r of i.selection.ranges){let n=i.doc.lineAt(r.from),s=i.doc.lineAt(r.to);if(!r.empty&&r.to==s.from&&(s=i.doc.lineAt(r.to-1)),t>=n.number){let l=e[e.length-1];l.to=s.to,l.ranges.push(r)}else e.push({from:n.from,to:s.to,ranges:[r]});t=s.number+1}return e}function Jm(i,e,t){if(i.readOnly)return!1;let r=[],n=[];for(let s of _o(i)){if(t?s.to==i.doc.length:s.from==0)continue;let l=i.doc.lineAt(t?s.to+1:s.from-1),o=l.length+1;if(t){r.push({from:s.to,to:l.to},{from:s.from,insert:l.text+i.lineBreak});for(let a of s.ranges)n.push(G.range(Math.min(i.doc.length,a.anchor+o),Math.min(i.doc.length,a.head+o)))}else{r.push({from:l.from,to:s.from},{from:s.to,insert:i.lineBreak+l.text});for(let a of s.ranges)n.push(G.range(a.anchor-o,a.head-o))}}return r.length?(e(i.update({changes:r,scrollIntoView:!0,selection:G.create(n,i.selection.mainIndex),userEvent:"move.line"})),!0):!1}const OE=({state:i,dispatch:e})=>Jm(i,e,!1),PE=({state:i,dispatch:e})=>Jm(i,e,!0);function Ym(i,e,t){if(i.readOnly)return!1;let r=[];for(let s of _o(i))t?r.push({from:s.from,insert:i.doc.slice(s.from,s.to)+i.lineBreak}):r.push({from:s.to,insert:i.lineBreak+i.doc.slice(s.from,s.to)});let n=i.changes(r);return e(i.update({changes:n,selection:i.selection.map(n,t?1:-1),scrollIntoView:!0,userEvent:"input.copyline"})),!0}const IE=({state:i,dispatch:e})=>Ym(i,e,!1),NE=({state:i,dispatch:e})=>Ym(i,e,!0),FE=i=>{if(i.state.readOnly)return!1;let{state:e}=i,t=e.changes(_o(e).map(({from:n,to:s})=>(n>0?n--:s<e.doc.length&&s++,{from:n,to:s}))),r=Ir(e.selection,n=>{let s;if(i.lineWrapping){let l=i.lineBlockAt(n.head),o=i.coordsAtPos(n.head,n.assoc||1);o&&(s=l.bottom+i.documentTop-o.bottom+i.defaultLineHeight/2)}return i.moveVertically(n,!0,s)}).map(t);return i.dispatch({changes:t,selection:r,scrollIntoView:!0,userEvent:"delete.line"}),!0};function HE(i,e){if(/\(\)|\[\]|\{\}/.test(i.sliceDoc(e-1,e+1)))return{from:e,to:e};let t=Ze(i).resolveInner(e),r=t.childBefore(e),n=t.childAfter(e),s;return r&&n&&r.to<=e&&n.from>=e&&(s=r.type.prop(xe.closedBy))&&s.indexOf(n.name)>-1&&i.doc.lineAt(r.to).from==i.doc.lineAt(n.from).from&&!/\S/.test(i.sliceDoc(r.to,n.from))?{from:r.to,to:n.from}:null}const Qu=Qm(!1),jE=Qm(!0);function Qm(i){return({state:e,dispatch:t})=>{if(e.readOnly)return!1;let r=e.changeByRange(n=>{let{from:s,to:l}=n,o=e.doc.lineAt(s),a=!i&&s==l&&HE(e,s);i&&(s=l=(l<=o.to?o:e.doc.lineAt(l)).to);let c=new po(e,{simulateBreak:s,simulateDoubleBreak:!!a}),u=fc(c,s);for(u==null&&(u=no(/^\s*/.exec(e.doc.lineAt(s).text)[0],e.tabSize));l<o.to&&/\s/.test(o.text[l-o.from]);)l++;a?{from:s,to:l}=a:s>o.from&&s<o.from+100&&!/\S/.test(o.text.slice(0,s))&&(s=o.from);let h=["",_n(e,u)];return a&&h.push(_n(e,c.lineIndent(o.from,-1))),{changes:{from:s,to:l,insert:Ae.of(h)},range:G.cursor(s+1+h[1].length)}});return t(e.update(r,{scrollIntoView:!0,userEvent:"input"})),!0}}function vc(i,e){let t=-1;return i.changeByRange(r=>{let n=[];for(let l=r.from;l<=r.to;){let o=i.doc.lineAt(l);o.number>t&&(r.empty||r.to>o.from)&&(e(o,n,r),t=o.number),l=o.to+1}let s=i.changes(n);return{changes:n,range:G.range(s.mapPos(r.anchor,1),s.mapPos(r.head,1))}})}const zE=({state:i,dispatch:e})=>{if(i.readOnly)return!1;let t=Object.create(null),r=new po(i,{overrideIndentation:s=>{let l=t[s];return l??-1}}),n=vc(i,(s,l,o)=>{let a=fc(r,s.from);if(a==null)return;/\S/.test(s.text)||(a=0);let c=/^\s*/.exec(s.text)[0],u=_n(i,a);(c!=u||o.from<s.from+c.length)&&(t[s.from]=a,l.push({from:s.from,to:s.from+c.length,insert:u}))});return n.changes.empty||e(i.update(n,{userEvent:"indent"})),!0},Zm=({state:i,dispatch:e})=>i.readOnly?!1:(e(i.update(vc(i,(t,r)=>{r.push({from:t.from,insert:i.facet(fo)})}),{userEvent:"input.indent"})),!0),eg=({state:i,dispatch:e})=>i.readOnly?!1:(e(i.update(vc(i,(t,r)=>{let n=/^\s*/.exec(t.text)[0];if(!n)return;let s=no(n,i.tabSize),l=0,o=_n(i,Math.max(0,s-zs(i)));for(;l<n.length&&l<o.length&&n.charCodeAt(l)==o.charCodeAt(l);)l++;r.push({from:t.from+l,to:t.from+n.length,insert:o.slice(l)})}),{userEvent:"delete.dedent"})),!0),WE=i=>(i.setTabFocusMode(),!0),$E=[{key:"Ctrl-b",run:Mm,shift:Fm,preventDefault:!0},{key:"Ctrl-f",run:Lm,shift:Hm},{key:"Ctrl-p",run:Bm,shift:Wm},{key:"Ctrl-n",run:Om,shift:$m},{key:"Ctrl-a",run:aE,shift:bE},{key:"Ctrl-e",run:cE,shift:xE},{key:"Ctrl-d",run:Km},{key:"Ctrl-h",run:ba},{key:"Ctrl-k",run:ME},{key:"Ctrl-Alt-h",run:Xm},{key:"Ctrl-o",run:RE},{key:"Ctrl-t",run:BE},{key:"Ctrl-v",run:ya}],UE=[{key:"ArrowLeft",run:Mm,shift:Fm,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:Z2,shift:fE,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:oE,shift:_E,preventDefault:!0},{key:"ArrowRight",run:Lm,shift:Hm,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:eE,shift:dE,preventDefault:!0},{mac:"Cmd-ArrowRight",run:lE,shift:yE,preventDefault:!0},{key:"ArrowUp",run:Bm,shift:Wm,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Gu,shift:Ju},{mac:"Ctrl-ArrowUp",run:Vu,shift:qu},{key:"ArrowDown",run:Om,shift:$m,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Xu,shift:Yu},{mac:"Ctrl-ArrowDown",run:ya,shift:Ku},{key:"PageUp",run:Vu,shift:qu},{key:"PageDown",run:ya,shift:Ku},{key:"Home",run:sE,shift:vE,preventDefault:!0},{key:"Mod-Home",run:Gu,shift:Ju},{key:"End",run:nE,shift:gE,preventDefault:!0},{key:"Mod-End",run:Xu,shift:Yu},{key:"Enter",run:Qu,shift:Qu},{key:"Mod-a",run:wE},{key:"Backspace",run:ba,shift:ba,preventDefault:!0},{key:"Delete",run:Km,preventDefault:!0},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Xm,preventDefault:!0},{key:"Mod-Delete",mac:"Alt-Delete",run:DE,preventDefault:!0},{mac:"Mod-Backspace",run:LE,preventDefault:!0},{mac:"Mod-Delete",run:TE,preventDefault:!0}].concat($E.map(i=>({mac:i.key,run:i.run,shift:i.shift}))),VE=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:iE,shift:pE},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:rE,shift:mE},{key:"Alt-ArrowUp",run:OE},{key:"Shift-Alt-ArrowUp",run:IE},{key:"Alt-ArrowDown",run:PE},{key:"Shift-Alt-ArrowDown",run:NE},{key:"Mod-Alt-ArrowUp",run:CE},{key:"Mod-Alt-ArrowDown",run:EE},{key:"Escape",run:AE},{key:"Mod-Enter",run:jE},{key:"Alt-l",mac:"Ctrl-l",run:SE},{key:"Mod-i",run:kE,preventDefault:!0},{key:"Mod-[",run:eg},{key:"Mod-]",run:Zm},{key:"Mod-Alt-\\",run:zE},{key:"Shift-Mod-k",run:FE},{key:"Shift-Mod-\\",run:uE},{key:"Mod-/",run:O2},{key:"Alt-A",run:I2},{key:"Ctrl-m",mac:"Shift-Alt-m",run:WE}].concat(UE),qE={key:"Tab",run:Zm,shift:eg};class tg{constructor(e,t,r,n){this.state=e,this.pos=t,this.explicit=r,this.view=n,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(e){let t=Ze(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),r=Math.max(t.from,this.pos-250),n=t.text.slice(r-t.from,this.pos-t.from),s=n.search(ig(e,!1));return s<0?null:{from:r+s,to:this.pos,text:n.slice(s)}}get aborted(){return this.abortListeners==null}addEventListener(e,t,r){e=="abort"&&this.abortListeners&&(this.abortListeners.push(t),r&&r.onDocChange&&(this.abortOnDocChange=!0))}}function Zu(i){let e=Object.keys(i).join(""),t=/\w/.test(e);return t&&(e=e.replace(/\w/g,"")),`[${t?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function KE(i){let e=Object.create(null),t=Object.create(null);for(let{label:n}of i){e[n[0]]=!0;for(let s=1;s<n.length;s++)t[n[s]]=!0}let r=Zu(e)+Zu(t)+"*$";return[new RegExp("^"+r),new RegExp(r)]}function GE(i){let e=i.map(n=>typeof n=="string"?{label:n}:n),[t,r]=e.every(n=>/^\w+$/.test(n.label))?[/\w*$/,/\w+$/]:KE(e);return n=>{let s=n.matchBefore(r);return s||n.explicit?{from:s?s.from:n.pos,options:e,validFor:t}:null}}function _M(i,e){return t=>{for(let r=Ze(t.state).resolveInner(t.pos,-1);r;r=r.parent){if(i.indexOf(r.name)>-1)return null;if(r.type.isTop)break}return e(t)}}class ef{constructor(e,t,r,n){this.completion=e,this.source=t,this.match=r,this.score=n}}function Yi(i){return i.selection.main.from}function ig(i,e){var t;let{source:r}=i,n=e&&r[0]!="^",s=r[r.length-1]!="$";return!n&&!s?i:new RegExp(`${n?"^":""}(?:${r})${s?"$":""}`,(t=i.flags)!==null&&t!==void 0?t:i.ignoreCase?"i":"")}const _c=gi.define();function XE(i,e,t,r){let{main:n}=i.selection,s=t-n.from,l=r-n.from;return{...i.changeByRange(o=>{if(o!=n&&t!=r&&i.sliceDoc(o.from+s,o.from+l)!=i.sliceDoc(t,r))return{range:o};let a=i.toText(e);return{changes:{from:o.from+s,to:r==n.from?o.to:o.from+l,insert:a},range:G.cursor(o.from+s+a.length)}}),scrollIntoView:!0,userEvent:"input.complete"}}const tf=new WeakMap;function JE(i){if(!Array.isArray(i))return i;let e=tf.get(i);return e||tf.set(i,e=GE(i)),e}const Us=pe.define(),yn=pe.define();class YE{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let t=0;t<e.length;){let r=At(e,t),n=ti(r);this.chars.push(r);let s=e.slice(t,t+n),l=s.toUpperCase();this.folded.push(At(l==s?s.toLowerCase():l,0)),t+=n}this.astral=e.length!=this.chars.length}ret(e,t){return this.score=e,this.matched=t,this}match(e){if(this.pattern.length==0)return this.ret(-100,[]);if(e.length<this.pattern.length)return null;let{chars:t,folded:r,any:n,precise:s,byWord:l}=this;if(t.length==1){let g=At(e,0),v=ti(g),b=v==e.length?0:-100;if(g!=t[0])if(g==r[0])b+=-200;else return null;return this.ret(b,[0,v])}let o=e.indexOf(this.pattern);if(o==0)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let a=t.length,c=0;if(o<0){for(let g=0,v=Math.min(e.length,200);g<v&&c<a;){let b=At(e,g);(b==t[c]||b==r[c])&&(n[c++]=g),g+=ti(b)}if(c<a)return null}let u=0,h=0,f=!1,d=0,_=-1,y=-1,p=/[a-z]/.test(e),m=!0;for(let g=0,v=Math.min(e.length,200),b=0;g<v&&h<a;){let S=At(e,g);o<0&&(u<a&&S==t[u]&&(s[u++]=g),d<a&&(S==t[d]||S==r[d]?(d==0&&(_=g),y=g+1,d++):d=0));let x,k=S<255?S>=48&&S<=57||S>=97&&S<=122?2:S>=65&&S<=90?1:0:(x=Ua(S))!=x.toLowerCase()?1:x!=x.toUpperCase()?2:0;(!g||k==1&&p||b==0&&k!=0)&&(t[h]==S||r[h]==S&&(f=!0)?l[h++]=g:l.length&&(m=!1)),b=k,g+=ti(S)}return h==a&&l[0]==0&&m?this.result(-100+(f?-200:0),l,e):d==a&&_==0?this.ret(-200-e.length+(y==e.length?0:-100),[0,y]):o>-1?this.ret(-700-e.length,[o,o+this.pattern.length]):d==a?this.ret(-900-e.length,[_,y]):h==a?this.result(-100+(f?-200:0)+-700+(m?0:-1100),l,e):t.length==2?null:this.result((n[0]?-700:0)+-200+-1100,n,e)}result(e,t,r){let n=[],s=0;for(let l of t){let o=l+(this.astral?ti(At(r,l)):1);s&&n[s-1]==l?n[s-1]=o:(n[s++]=l,n[s++]=o)}return this.ret(e-r.length,n)}}class QE{constructor(e){this.pattern=e,this.matched=[],this.score=0,this.folded=e.toLowerCase()}match(e){if(e.length<this.pattern.length)return null;let t=e.slice(0,this.pattern.length),r=t==this.pattern?0:t.toLowerCase()==this.folded?-200:null;return r==null?null:(this.matched=[0,t.length],this.score=r+(e.length==this.pattern.length?0:-100),this)}}const Ge=oe.define({combine(i){return Ni(i,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:ZE,filterStrict:!1,compareCompletions:(e,t)=>(e.sortText||e.label).localeCompare(t.sortText||t.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,tooltipClass:(e,t)=>r=>rf(e(r),t(r)),optionClass:(e,t)=>r=>rf(e(r),t(r)),addToOptions:(e,t)=>e.concat(t),filterStrict:(e,t)=>e||t})}});function rf(i,e){return i?e?i+" "+e:i:e}function ZE(i,e,t,r,n,s){let l=i.textDirection==Fe.RTL,o=l,a=!1,c="top",u,h,f=e.left-n.left,d=n.right-e.right,_=r.right-r.left,y=r.bottom-r.top;if(o&&f<Math.min(_,d)?o=!1:!o&&d<Math.min(_,f)&&(o=!0),_<=(o?f:d))u=Math.max(n.top,Math.min(t.top,n.bottom-y))-e.top,h=Math.min(400,o?f:d);else{a=!0,h=Math.min(400,(l?e.right:n.right-e.left)-30);let g=n.bottom-e.bottom;g>=y||g>e.top?u=t.bottom-e.top:(c="bottom",u=e.bottom-t.top)}let p=(e.bottom-e.top)/s.offsetHeight,m=(e.right-e.left)/s.offsetWidth;return{style:`${c}: ${u/p}px; max-width: ${h/m}px`,class:"cm-completionInfo-"+(a?l?"left-narrow":"right-narrow":o?"left":"right")}}function eA(i){let e=i.addToOptions.slice();return i.icons&&e.push({render(t){let r=document.createElement("div");return r.classList.add("cm-completionIcon"),t.type&&r.classList.add(...t.type.split(/\s+/g).map(n=>"cm-completionIcon-"+n)),r.setAttribute("aria-hidden","true"),r},position:20}),e.push({render(t,r,n,s){let l=document.createElement("span");l.className="cm-completionLabel";let o=t.displayLabel||t.label,a=0;for(let c=0;c<s.length;){let u=s[c++],h=s[c++];u>a&&l.appendChild(document.createTextNode(o.slice(a,u)));let f=l.appendChild(document.createElement("span"));f.appendChild(document.createTextNode(o.slice(u,h))),f.className="cm-completionMatchedText",a=h}return a<o.length&&l.appendChild(document.createTextNode(o.slice(a))),l},position:50},{render(t){if(!t.detail)return null;let r=document.createElement("span");return r.className="cm-completionDetail",r.textContent=t.detail,r},position:80}),e.sort((t,r)=>t.position-r.position).map(t=>t.render)}function ul(i,e,t){if(i<=t)return{from:0,to:i};if(e<0&&(e=0),e<=i>>1){let n=Math.floor(e/t);return{from:n*t,to:(n+1)*t}}let r=Math.floor((i-e)/t);return{from:i-(r+1)*t,to:i-r*t}}class tA{constructor(e,t,r){this.view=e,this.stateField=t,this.applyCompletion=r,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:a=>this.placeInfo(a),key:this},this.space=null,this.currentClass="";let n=e.state.field(t),{options:s,selected:l}=n.open,o=e.state.facet(Ge);this.optionContent=eA(o),this.optionClass=o.optionClass,this.tooltipClass=o.tooltipClass,this.range=ul(s.length,l,o.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",a=>{let{options:c}=e.state.field(t).open;for(let u=a.target,h;u&&u!=this.dom;u=u.parentNode)if(u.nodeName=="LI"&&(h=/-(\d+)$/.exec(u.id))&&+h[1]<c.length){this.applyCompletion(e,c[+h[1]]),a.preventDefault();return}}),this.dom.addEventListener("focusout",a=>{let c=e.state.field(this.stateField,!1);c&&c.tooltip&&e.state.facet(Ge).closeOnBlur&&a.relatedTarget!=e.contentDOM&&e.dispatch({effects:yn.of(null)})}),this.showOptions(s,n.id)}mount(){this.updateSel()}showOptions(e,t){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,t,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(e){var t;let r=e.state.field(this.stateField),n=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),r!=n){let{options:s,selected:l,disabled:o}=r.open;(!n.open||n.open.options!=s)&&(this.range=ul(s.length,l,e.state.facet(Ge).maxRenderedOptions),this.showOptions(s,r.id)),this.updateSel(),o!=((t=n.open)===null||t===void 0?void 0:t.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!o)}}updateTooltipClass(e){let t=this.tooltipClass(e);if(t!=this.currentClass){for(let r of this.currentClass.split(" "))r&&this.dom.classList.remove(r);for(let r of t.split(" "))r&&this.dom.classList.add(r);this.currentClass=t}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;(t.selected>-1&&t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=ul(t.options.length,t.selected,this.view.state.facet(Ge).maxRenderedOptions),this.showOptions(t.options,e.id));let r=this.updateSelectedOption(t.selected);if(r){this.destroyInfo();let{completion:n}=t.options[t.selected],{info:s}=n;if(!s)return;let l=typeof s=="string"?document.createTextNode(s):s(n);if(!l)return;"then"in l?l.then(o=>{o&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(o,n)}).catch(o=>_t(this.view.state,o,"completion info")):(this.addInfoPane(l,n),r.setAttribute("aria-describedby",this.info.id))}}addInfoPane(e,t){this.destroyInfo();let r=this.info=document.createElement("div");if(r.className="cm-tooltip cm-completionInfo",r.id="cm-completionInfo-"+Math.floor(Math.random()*65535).toString(16),e.nodeType!=null)r.appendChild(e),this.infoDestroy=null;else{let{dom:n,destroy:s}=e;r.appendChild(n),this.infoDestroy=s||null}this.dom.appendChild(r),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let t=null;for(let r=this.list.firstChild,n=this.range.from;r;r=r.nextSibling,n++)r.nodeName!="LI"||!r.id?n--:n==e?r.hasAttribute("aria-selected")||(r.setAttribute("aria-selected","true"),t=r):r.hasAttribute("aria-selected")&&(r.removeAttribute("aria-selected"),r.removeAttribute("aria-describedby"));return t&&rA(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),r=this.info.getBoundingClientRect(),n=e.getBoundingClientRect(),s=this.space;if(!s){let l=this.dom.ownerDocument.documentElement;s={left:0,top:0,right:l.clientWidth,bottom:l.clientHeight}}return n.top>Math.min(s.bottom,t.bottom)-10||n.bottom<Math.max(s.top,t.top)+10?null:this.view.state.facet(Ge).positionInfo(this.view,t,n,r,s,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,t,r){const n=document.createElement("ul");n.id=t,n.setAttribute("role","listbox"),n.setAttribute("aria-expanded","true"),n.setAttribute("aria-label",this.view.state.phrase("Completions")),n.addEventListener("mousedown",l=>{l.target==n&&l.preventDefault()});let s=null;for(let l=r.from;l<r.to;l++){let{completion:o,match:a}=e[l],{section:c}=o;if(c){let f=typeof c=="string"?c:c.name;if(f!=s&&(l>r.from||r.from==0))if(s=f,typeof c!="string"&&c.header)n.appendChild(c.header(c));else{let d=n.appendChild(document.createElement("completion-section"));d.textContent=f}}const u=n.appendChild(document.createElement("li"));u.id=t+"-"+l,u.setAttribute("role","option");let h=this.optionClass(o);h&&(u.className=h);for(let f of this.optionContent){let d=f(o,this.view.state,this.view,a);d&&u.appendChild(d)}}return r.from&&n.classList.add("cm-completionListIncompleteTop"),r.to<e.length&&n.classList.add("cm-completionListIncompleteBottom"),n}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function iA(i,e){return t=>new tA(t,i,e)}function rA(i,e){let t=i.getBoundingClientRect(),r=e.getBoundingClientRect(),n=t.height/i.offsetHeight;r.top<t.top?i.scrollTop-=(t.top-r.top)/n:r.bottom>t.bottom&&(i.scrollTop+=(r.bottom-t.bottom)/n)}function nf(i){return(i.boost||0)*100+(i.apply?10:0)+(i.info?5:0)+(i.type?1:0)}function nA(i,e){let t=[],r=null,n=null,s=u=>{t.push(u);let{section:h}=u.completion;if(h){r||(r=[]);let f=typeof h=="string"?h:h.name;r.some(d=>d.name==f)||r.push(typeof h=="string"?{name:f}:h)}},l=e.facet(Ge);for(let u of i)if(u.hasResult()){let h=u.result.getMatch;if(u.result.filter===!1)for(let f of u.result.options)s(new ef(f,u.source,h?h(f):[],1e9-t.length));else{let f=e.sliceDoc(u.from,u.to),d,_=l.filterStrict?new QE(f):new YE(f);for(let y of u.result.options)if(d=_.match(y.label)){let p=y.displayLabel?h?h(y,d.matched):[]:d.matched,m=d.score+(y.boost||0);if(s(new ef(y,u.source,p,m)),typeof y.section=="object"&&y.section.rank==="dynamic"){let{name:g}=y.section;n||(n=Object.create(null)),n[g]=Math.max(m,n[g]||-1e9)}}}}if(r){let u=Object.create(null),h=0,f=(d,_)=>(d.rank==="dynamic"&&_.rank==="dynamic"?n[_.name]-n[d.name]:0)||(typeof d.rank=="number"?d.rank:1e9)-(typeof _.rank=="number"?_.rank:1e9)||(d.name<_.name?-1:1);for(let d of r.sort(f))h-=1e5,u[d.name]=h;for(let d of t){let{section:_}=d.completion;_&&(d.score+=u[typeof _=="string"?_:_.name])}}let o=[],a=null,c=l.compareCompletions;for(let u of t.sort((h,f)=>f.score-h.score||c(h.completion,f.completion))){let h=u.completion;!a||a.label!=h.label||a.detail!=h.detail||a.type!=null&&h.type!=null&&a.type!=h.type||a.apply!=h.apply||a.boost!=h.boost?o.push(u):nf(u.completion)>nf(a)&&(o[o.length-1]=u),a=u.completion}return o}class dr{constructor(e,t,r,n,s,l){this.options=e,this.attrs=t,this.tooltip=r,this.timestamp=n,this.selected=s,this.disabled=l}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new dr(this.options,sf(t,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,t,r,n,s,l){if(n&&!l&&e.some(c=>c.isPending))return n.setDisabled();let o=nA(e,t);if(!o.length)return n&&e.some(c=>c.isPending)?n.setDisabled():null;let a=t.facet(Ge).selectOnOpen?0:-1;if(n&&n.selected!=a&&n.selected!=-1){let c=n.options[n.selected].completion;for(let u=0;u<o.length;u++)if(o[u].completion==c){a=u;break}}return new dr(o,sf(r,a),{pos:e.reduce((c,u)=>u.hasResult()?Math.min(c,u.from):c,1e8),create:hA,above:s.aboveCursor},n?n.timestamp:Date.now(),a,!1)}map(e){return new dr(this.options,this.attrs,{...this.tooltip,pos:e.mapPos(this.tooltip.pos)},this.timestamp,this.selected,this.disabled)}setDisabled(){return new dr(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class Vs{constructor(e,t,r){this.active=e,this.id=t,this.open=r}static start(){return new Vs(aA,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:t}=e,r=t.facet(Ge),s=(r.override||t.languageDataAt("autocomplete",Yi(t)).map(JE)).map(a=>(this.active.find(u=>u.source==a)||new It(a,this.active.some(u=>u.state!=0)?1:0)).update(e,r));s.length==this.active.length&&s.every((a,c)=>a==this.active[c])&&(s=this.active);let l=this.open,o=e.effects.some(a=>a.is(yc));l&&e.docChanged&&(l=l.map(e.changes)),e.selection||s.some(a=>a.hasResult()&&e.changes.touchesRange(a.from,a.to))||!sA(s,this.active)||o?l=dr.build(s,t,this.id,l,r,o):l&&l.disabled&&!s.some(a=>a.isPending)&&(l=null),!l&&s.every(a=>!a.isPending)&&s.some(a=>a.hasResult())&&(s=s.map(a=>a.hasResult()?new It(a.source,0):a));for(let a of e.effects)a.is(ng)&&(l=l&&l.setSelected(a.value,this.id));return s==this.active&&l==this.open?this:new Vs(s,this.id,l)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?oA:lA}}function sA(i,e){if(i==e)return!0;for(let t=0,r=0;;){for(;t<i.length&&!i[t].hasResult();)t++;for(;r<e.length&&!e[r].hasResult();)r++;let n=t==i.length,s=r==e.length;if(n||s)return n==s;if(i[t++].result!=e[r++].result)return!1}}const oA={"aria-autocomplete":"list"},lA={};function sf(i,e){let t={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":i};return e>-1&&(t["aria-activedescendant"]=i+"-"+e),t}const aA=[];function rg(i,e){if(i.isUserEvent("input.complete")){let r=i.annotation(_c);if(r&&e.activateOnCompletion(r))return 12}let t=i.isUserEvent("input.type");return t&&e.activateOnTyping?5:t?1:i.isUserEvent("delete.backward")?2:i.selection?8:i.docChanged?16:0}class It{constructor(e,t,r=!1){this.source=e,this.state=t,this.explicit=r}hasResult(){return!1}get isPending(){return this.state==1}update(e,t){let r=rg(e,t),n=this;(r&8||r&16&&this.touches(e))&&(n=new It(n.source,0)),r&4&&n.state==0&&(n=new It(this.source,1)),n=n.updateFor(e,r);for(let s of e.effects)if(s.is(Us))n=new It(n.source,1,s.value);else if(s.is(yn))n=new It(n.source,0);else if(s.is(yc))for(let l of s.value)l.source==n.source&&(n=l);return n}updateFor(e,t){return this.map(e.changes)}map(e){return this}touches(e){return e.changes.touchesRange(Yi(e.state))}}class xr extends It{constructor(e,t,r,n,s,l){super(e,3,t),this.limit=r,this.result=n,this.from=s,this.to=l}hasResult(){return!0}updateFor(e,t){var r;if(!(t&3))return this.map(e.changes);let n=this.result;n.map&&!e.changes.empty&&(n=n.map(n,e.changes));let s=e.changes.mapPos(this.from),l=e.changes.mapPos(this.to,1),o=Yi(e.state);if(o>l||!n||t&2&&(Yi(e.startState)==this.from||o<this.limit))return new It(this.source,t&4?1:0);let a=e.changes.mapPos(this.limit);return cA(n.validFor,e.state,s,l)?new xr(this.source,this.explicit,a,n,s,l):n.update&&(n=n.update(n,s,l,new tg(e.state,o,!1)))?new xr(this.source,this.explicit,a,n,n.from,(r=n.to)!==null&&r!==void 0?r:Yi(e.state)):new It(this.source,1,this.explicit)}map(e){return e.empty?this:(this.result.map?this.result.map(this.result,e):this.result)?new xr(this.source,this.explicit,e.mapPos(this.limit),this.result,e.mapPos(this.from),e.mapPos(this.to,1)):new It(this.source,0)}touches(e){return e.changes.touchesRange(this.from,this.to)}}function cA(i,e,t,r){if(!i)return!1;let n=e.sliceDoc(t,r);return typeof i=="function"?i(n,t,r,e):ig(i,!0).test(n)}const yc=pe.define({map(i,e){return i.map(t=>t.map(e))}}),ng=pe.define(),gt=et.define({create(){return Vs.start()},update(i,e){return i.update(e)},provide:i=>[lc.from(i,e=>e.tooltip),se.contentAttributes.from(i,e=>e.attrs)]});function bc(i,e){const t=e.completion.apply||e.completion.label;let r=i.state.field(gt).active.find(n=>n.source==e.source);return r instanceof xr?(typeof t=="string"?i.dispatch({...XE(i.state,t,r.from,r.to),annotations:_c.of(e.completion)}):t(i,e.completion,r.from,r.to),!0):!1}const hA=iA(gt,bc);function as(i,e="option"){return t=>{let r=t.state.field(gt,!1);if(!r||!r.open||r.open.disabled||Date.now()-r.open.timestamp<t.state.facet(Ge).interactionDelay)return!1;let n=1,s;e=="page"&&(s=Yp(t,r.open.tooltip))&&(n=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let{length:l}=r.open.options,o=r.open.selected>-1?r.open.selected+n*(i?1:-1):i?0:l-1;return o<0?o=e=="page"?0:l-1:o>=l&&(o=e=="page"?l-1:0),t.dispatch({effects:ng.of(o)}),!0}}const uA=i=>{let e=i.state.field(gt,!1);return i.state.readOnly||!e||!e.open||e.open.selected<0||e.open.disabled||Date.now()-e.open.timestamp<i.state.facet(Ge).interactionDelay?!1:bc(i,e.open.options[e.open.selected])},fl=i=>i.state.field(gt,!1)?(i.dispatch({effects:Us.of(!0)}),!0):!1,fA=i=>{let e=i.state.field(gt,!1);return!e||!e.active.some(t=>t.state!=0)?!1:(i.dispatch({effects:yn.of(null)}),!0)};class dA{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const pA=50,mA=1e3,gA=st.fromClass(class{constructor(i){this.view=i,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let e of i.state.field(gt).active)e.isPending&&this.startQuery(e)}update(i){let e=i.state.field(gt),t=i.state.facet(Ge);if(!i.selectionSet&&!i.docChanged&&i.startState.field(gt)==e)return;let r=i.transactions.some(s=>{let l=rg(s,t);return l&8||(s.selection||s.docChanged)&&!(l&3)});for(let s=0;s<this.running.length;s++){let l=this.running[s];if(r||l.context.abortOnDocChange&&i.docChanged||l.updates.length+i.transactions.length>pA&&Date.now()-l.time>mA){for(let o of l.context.abortListeners)try{o()}catch(a){_t(this.view.state,a)}l.context.abortListeners=null,this.running.splice(s--,1)}else l.updates.push(...i.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),i.transactions.some(s=>s.effects.some(l=>l.is(Us)))&&(this.pendingStart=!0);let n=this.pendingStart?50:t.activateOnTypingDelay;if(this.debounceUpdate=e.active.some(s=>s.isPending&&!this.running.some(l=>l.active.source==s.source))?setTimeout(()=>this.startUpdate(),n):-1,this.composing!=0)for(let s of i.transactions)s.isUserEvent("input.type")?this.composing=2:this.composing==2&&s.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:i}=this.view,e=i.field(gt);for(let t of e.active)t.isPending&&!this.running.some(r=>r.active.source==t.source)&&this.startQuery(t);this.running.length&&e.open&&e.open.disabled&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(Ge).updateSyncTime))}startQuery(i){let{state:e}=this.view,t=Yi(e),r=new tg(e,t,i.explicit,this.view),n=new dA(i,r);this.running.push(n),Promise.resolve(i.source(r)).then(s=>{n.context.aborted||(n.done=s||null,this.scheduleAccept())},s=>{this.view.dispatch({effects:yn.of(null)}),_t(this.view.state,s)})}scheduleAccept(){this.running.every(i=>i.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(Ge).updateSyncTime))}accept(){var i;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],t=this.view.state.facet(Ge),r=this.view.state.field(gt);for(let n=0;n<this.running.length;n++){let s=this.running[n];if(s.done===void 0)continue;if(this.running.splice(n--,1),s.done){let o=Yi(s.updates.length?s.updates[0].startState:this.view.state),a=Math.min(o,s.done.from+(s.active.explicit?0:1)),c=new xr(s.active.source,s.active.explicit,a,s.done,s.done.from,(i=s.done.to)!==null&&i!==void 0?i:o);for(let u of s.updates)c=c.update(u,t);if(c.hasResult()){e.push(c);continue}}let l=r.active.find(o=>o.source==s.active.source);if(l&&l.isPending)if(s.done==null){let o=new It(s.active.source,0);for(let a of s.updates)o=o.update(a,t);o.isPending||e.push(o)}else this.startQuery(l)}(e.length||r.open&&r.open.disabled)&&this.view.dispatch({effects:yc.of(e)})}},{eventHandlers:{blur(i){let e=this.view.state.field(gt,!1);if(e&&e.tooltip&&this.view.state.facet(Ge).closeOnBlur){let t=e.open&&Yp(this.view,e.open.tooltip);(!t||!t.dom.contains(i.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:yn.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:Us.of(!1)}),20),this.composing=0}}}),vA=typeof navigator=="object"&&/Win/.test(navigator.platform),_A=nr.highest(se.domEventHandlers({keydown(i,e){let t=e.state.field(gt,!1);if(!t||!t.open||t.open.disabled||t.open.selected<0||i.key.length>1||i.ctrlKey&&!(vA&&i.altKey)||i.metaKey)return!1;let r=t.open.options[t.open.selected],n=t.active.find(l=>l.source==r.source),s=r.completion.commitCharacters||n.result.commitCharacters;return s&&s.indexOf(i.key)>-1&&bc(e,r),!1}})),sg=se.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'""',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"''"}},".cm-completionIcon-class":{"&:after":{content:"''"}},".cm-completionIcon-interface":{"&:after":{content:"''"}},".cm-completionIcon-variable":{"&:after":{content:"''"}},".cm-completionIcon-constant":{"&:after":{content:"''"}},".cm-completionIcon-type":{"&:after":{content:"''"}},".cm-completionIcon-enum":{"&:after":{content:"''"}},".cm-completionIcon-property":{"&:after":{content:"''"}},".cm-completionIcon-keyword":{"&:after":{content:"''"}},".cm-completionIcon-namespace":{"&:after":{content:"''"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class yA{constructor(e,t,r,n){this.field=e,this.line=t,this.from=r,this.to=n}}class xc{constructor(e,t,r){this.field=e,this.from=t,this.to=r}map(e){let t=e.mapPos(this.from,-1,Qe.TrackDel),r=e.mapPos(this.to,1,Qe.TrackDel);return t==null||r==null?null:new xc(this.field,t,r)}}class wc{constructor(e,t){this.lines=e,this.fieldPositions=t}instantiate(e,t){let r=[],n=[t],s=e.doc.lineAt(t),l=/^\s*/.exec(s.text)[0];for(let a of this.lines){if(r.length){let c=l,u=/^\t*/.exec(a)[0].length;for(let h=0;h<u;h++)c+=e.facet(fo);n.push(t+c.length-u),a=c+a.slice(u)}r.push(a),t+=a.length+1}let o=this.fieldPositions.map(a=>new xc(a.field,n[a.line]+a.from,n[a.line]+a.to));return{text:r,ranges:o}}static parse(e){let t=[],r=[],n=[],s;for(let l of e.split(/\r\n?|\n/)){for(;s=/[#$]\{(?:(\d+)(?::([^{}]*))?|((?:\\[{}]|[^{}])*))\}/.exec(l);){let o=s[1]?+s[1]:null,a=s[2]||s[3]||"",c=-1,u=a.replace(/\\[{}]/g,h=>h[1]);for(let h=0;h<t.length;h++)(o!=null?t[h].seq==o:u&&t[h].name==u)&&(c=h);if(c<0){let h=0;for(;h<t.length&&(o==null||t[h].seq!=null&&t[h].seq<o);)h++;t.splice(h,0,{seq:o,name:u}),c=h;for(let f of n)f.field>=c&&f.field++}for(let h of n)if(h.line==r.length&&h.from>s.index){let f=s[2]?3+(s[1]||"").length:2;h.from-=f,h.to-=f}n.push(new yA(c,r.length,s.index,s.index+u.length)),l=l.slice(0,s.index)+a+l.slice(s.index+s[0].length)}l=l.replace(/\\([{}])/g,(o,a,c)=>{for(let u of n)u.line==r.length&&u.from>c&&(u.from--,u.to--);return a}),r.push(l)}return new wc(r,n)}}let bA=he.widget({widget:new class extends Fi{toDOM(){let i=document.createElement("span");return i.className="cm-snippetFieldPosition",i}ignoreEvent(){return!1}}}),xA=he.mark({class:"cm-snippetField"});class Nr{constructor(e,t){this.ranges=e,this.active=t,this.deco=he.set(e.map(r=>(r.from==r.to?bA:xA).range(r.from,r.to)),!0)}map(e){let t=[];for(let r of this.ranges){let n=r.map(e);if(!n)return null;t.push(n)}return new Nr(t,this.active)}selectionInsideField(e){return e.ranges.every(t=>this.ranges.some(r=>r.field==this.active&&r.from<=t.from&&r.to>=t.to))}}const In=pe.define({map(i,e){return i&&i.map(e)}}),wA=pe.define(),bn=et.define({create(){return null},update(i,e){for(let t of e.effects){if(t.is(In))return t.value;if(t.is(wA)&&i)return new Nr(i.ranges,t.value)}return i&&e.docChanged&&(i=i.map(e.changes)),i&&e.selection&&!i.selectionInsideField(e.selection)&&(i=null),i},provide:i=>se.decorations.from(i,e=>e?e.deco:he.none)});function Sc(i,e){return G.create(i.filter(t=>t.field==e).map(t=>G.range(t.from,t.to)))}function SA(i){let e=wc.parse(i);return(t,r,n,s)=>{let{text:l,ranges:o}=e.instantiate(t.state,n),{main:a}=t.state.selection,c={changes:{from:n,to:s==a.from?a.to:s,insert:Ae.of(l)},scrollIntoView:!0,annotations:r?[_c.of(r),ze.userEvent.of("input.complete")]:void 0};if(o.length&&(c.selection=Sc(o,0)),o.some(u=>u.field>0)){let u=new Nr(o,0),h=c.effects=[In.of(u)];t.state.field(bn,!1)===void 0&&h.push(pe.appendConfig.of([bn,DA,MA,sg]))}t.dispatch(t.state.update(c))}}function og(i){return({state:e,dispatch:t})=>{let r=e.field(bn,!1);if(!r||i<0&&r.active==0)return!1;let n=r.active+i,s=i>0&&!r.ranges.some(l=>l.field==n+i);return t(e.update({selection:Sc(r.ranges,n),effects:In.of(s?null:new Nr(r.ranges,n)),scrollIntoView:!0})),!0}}const kA=({state:i,dispatch:e})=>i.field(bn,!1)?(e(i.update({effects:In.of(null)})),!0):!1,CA=og(1),EA=og(-1),AA=[{key:"Tab",run:CA,shift:EA},{key:"Escape",run:kA}],of=oe.define({combine(i){return i.length?i[0]:AA}}),DA=nr.highest(ho.compute([of],i=>i.facet(of)));function yM(i,e){return{...e,apply:SA(i)}}const MA=se.domEventHandlers({mousedown(i,e){let t=e.state.field(bn,!1),r;if(!t||(r=e.posAtCoords({x:i.clientX,y:i.clientY}))==null)return!1;let n=t.ranges.find(s=>s.from<=r&&s.to>=r);return!n||n.field==t.active?!1:(e.dispatch({selection:Sc(t.ranges,n.field),effects:In.of(t.ranges.some(s=>s.field>n.field)?new Nr(t.ranges,n.field):null),scrollIntoView:!0}),!0)}}),xn={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},Ji=pe.define({map(i,e){let t=e.mapPos(i,-1,Qe.TrackAfter);return t??void 0}}),kc=new class extends Mi{};kc.startSide=1;kc.endSide=-1;const lg=et.define({create(){return ye.empty},update(i,e){if(i=i.map(e.changes),e.selection){let t=e.state.doc.lineAt(e.selection.main.head);i=i.update({filter:r=>r>=t.from&&r<=t.to})}for(let t of e.effects)t.is(Ji)&&(i=i.update({add:[kc.range(t.value,t.value+1)]}));return i}});function LA(){return[RA,lg]}const dl="()[]{}<>";function ag(i){for(let e=0;e<dl.length;e+=2)if(dl.charCodeAt(e)==i)return dl.charAt(e+1);return Ua(i<128?i:i+1)}function cg(i,e){return i.languageDataAt("closeBrackets",e)[0]||xn}const TA=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),RA=se.inputHandler.of((i,e,t,r)=>{if((TA?i.composing:i.compositionStarted)||i.state.readOnly)return!1;let n=i.state.selection.main;if(r.length>2||r.length==2&&ti(At(r,0))==1||e!=n.from||t!=n.to)return!1;let s=PA(i.state,r);return s?(i.dispatch(s),!0):!1}),BA=({state:i,dispatch:e})=>{if(i.readOnly)return!1;let r=cg(i,i.selection.main.head).brackets||xn.brackets,n=null,s=i.changeByRange(l=>{if(l.empty){let o=IA(i.doc,l.head);for(let a of r)if(a==o&&yo(i.doc,l.head)==ag(At(a,0)))return{changes:{from:l.head-a.length,to:l.head+a.length},range:G.cursor(l.head-a.length)}}return{range:n=l}});return n||e(i.update(s,{scrollIntoView:!0,userEvent:"delete.backward"})),!n},OA=[{key:"Backspace",run:BA}];function PA(i,e){let t=cg(i,i.selection.main.head),r=t.brackets||xn.brackets;for(let n of r){let s=ag(At(n,0));if(e==n)return s==n?HA(i,n,r.indexOf(n+n+n)>-1,t):NA(i,n,s,t.before||xn.before);if(e==s&&hg(i,i.selection.main.from))return FA(i,n,s)}return null}function hg(i,e){let t=!1;return i.field(lg).between(0,i.doc.length,r=>{r==e&&(t=!0)}),t}function yo(i,e){let t=i.sliceString(e,e+2);return t.slice(0,ti(At(t,0)))}function IA(i,e){let t=i.sliceString(e-2,e);return ti(At(t,0))==t.length?t:t.slice(1)}function NA(i,e,t,r){let n=null,s=i.changeByRange(l=>{if(!l.empty)return{changes:[{insert:e,from:l.from},{insert:t,from:l.to}],effects:Ji.of(l.to+e.length),range:G.range(l.anchor+e.length,l.head+e.length)};let o=yo(i.doc,l.head);return!o||/\s/.test(o)||r.indexOf(o)>-1?{changes:{insert:e+t,from:l.head},effects:Ji.of(l.head+e.length),range:G.cursor(l.head+e.length)}:{range:n=l}});return n?null:i.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function FA(i,e,t){let r=null,n=i.changeByRange(s=>s.empty&&yo(i.doc,s.head)==t?{changes:{from:s.head,to:s.head+t.length,insert:t},range:G.cursor(s.head+t.length)}:r={range:s});return r?null:i.update(n,{scrollIntoView:!0,userEvent:"input.type"})}function HA(i,e,t,r){let n=r.stringPrefixes||xn.stringPrefixes,s=null,l=i.changeByRange(o=>{if(!o.empty)return{changes:[{insert:e,from:o.from},{insert:e,from:o.to}],effects:Ji.of(o.to+e.length),range:G.range(o.anchor+e.length,o.head+e.length)};let a=o.head,c=yo(i.doc,a),u;if(c==e){if(lf(i,a))return{changes:{insert:e+e,from:a},effects:Ji.of(a+e.length),range:G.cursor(a+e.length)};if(hg(i,a)){let f=t&&i.sliceDoc(a,a+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:a,to:a+f.length,insert:f},range:G.cursor(a+f.length)}}}else{if(t&&i.sliceDoc(a-2*e.length,a)==e+e&&(u=af(i,a-2*e.length,n))>-1&&lf(i,u))return{changes:{insert:e+e+e+e,from:a},effects:Ji.of(a+e.length),range:G.cursor(a+e.length)};if(i.charCategorizer(a)(c)!=Ne.Word&&af(i,a,n)>-1&&!jA(i,a,e,n))return{changes:{insert:e+e,from:a},effects:Ji.of(a+e.length),range:G.cursor(a+e.length)}}return{range:s=o}});return s?null:i.update(l,{scrollIntoView:!0,userEvent:"input.type"})}function lf(i,e){let t=Ze(i).resolveInner(e+1);return t.parent&&t.from==e}function jA(i,e,t,r){let n=Ze(i).resolveInner(e,-1),s=r.reduce((l,o)=>Math.max(l,o.length),0);for(let l=0;l<5;l++){let o=i.sliceDoc(n.from,Math.min(n.to,n.from+t.length+s)),a=o.indexOf(t);if(!a||a>-1&&r.indexOf(o.slice(0,a))>-1){let u=n.firstChild;for(;u&&u.from==n.from&&u.to-u.from>t.length+a;){if(i.sliceDoc(u.to-t.length,u.to)==t)return!1;u=u.firstChild}return!0}let c=n.to==e&&n.parent;if(!c)break;n=c}return!1}function af(i,e,t){let r=i.charCategorizer(e);if(r(i.sliceDoc(e-1,e))!=Ne.Word)return e;for(let n of t){let s=e-n.length;if(i.sliceDoc(s,e)==n&&r(i.sliceDoc(s-1,s))!=Ne.Word)return s}return-1}function zA(i={}){return[_A,gt,Ge.of(i),gA,$A,sg]}const WA=[{key:"Ctrl-Space",run:fl},{mac:"Alt-`",run:fl},{mac:"Alt-i",run:fl},{key:"Escape",run:fA},{key:"ArrowDown",run:as(!0)},{key:"ArrowUp",run:as(!1)},{key:"PageDown",run:as(!0,"page")},{key:"PageUp",run:as(!1,"page")},{key:"Enter",run:uA}],$A=nr.highest(ho.computeN([Ge],i=>i.facet(Ge).defaultKeymap?[WA]:[])),cf=typeof String.prototype.normalize=="function"?i=>i.normalize("NFKD"):i=>i;class Lr{constructor(e,t,r=0,n=e.length,s,l){this.test=l,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(r,n),this.bufferStart=r,this.normalize=s?o=>s(cf(o)):cf,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return At(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=Ua(e),r=this.bufferStart+this.bufferPos;this.bufferPos+=ti(e);let n=this.normalize(t);if(n.length)for(let s=0,l=r;;s++){let o=n.charCodeAt(s),a=this.match(o,l,this.bufferPos+this.bufferStart);if(s==n.length-1){if(a)return this.value=a,this;break}l==r&&s<t.length&&t.charCodeAt(s)==o&&l++}}}match(e,t,r){let n=null;for(let s=0;s<this.matches.length;s+=2){let l=this.matches[s],o=!1;this.query.charCodeAt(l)==e&&(l==this.query.length-1?n={from:this.matches[s+1],to:r}:(this.matches[s]++,o=!0)),o||(this.matches.splice(s,2),s-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?n={from:t,to:r}:this.matches.push(1,t)),n&&this.test&&!this.test(n.from,n.to,this.buffer,this.bufferStart)&&(n=null),n}}typeof Symbol<"u"&&(Lr.prototype[Symbol.iterator]=function(){return this});const ug={from:-1,to:-1,match:/.*/.exec("")},Cc="gm"+(/x/.unicode==null?"":"u");class fg{constructor(e,t,r,n=0,s=e.length){if(this.text=e,this.to=s,this.curLine="",this.done=!1,this.value=ug,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new dg(e,t,r,n,s);this.re=new RegExp(t,Cc+(r!=null&&r.ignoreCase?"i":"")),this.test=r==null?void 0:r.test,this.iter=e.iter();let l=e.lineAt(n);this.curLineStart=l.from,this.matchPos=qs(e,n),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let r=this.curLineStart+t.index,n=r+t[0].length;if(this.matchPos=qs(this.text,n+(r==n?1:0)),r==this.curLineStart+this.curLine.length&&this.nextLine(),(r<n||r>this.value.to)&&(!this.test||this.test(r,n,t)))return this.value={from:r,to:n,match:t},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const pl=new WeakMap;class wr{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,r){let n=pl.get(e);if(!n||n.from>=r||n.to<=t){let o=new wr(t,e.sliceString(t,r));return pl.set(e,o),o}if(n.from==t&&n.to==r)return n;let{text:s,from:l}=n;return l>t&&(s=e.sliceString(t,l)+s,l=t),n.to<r&&(s+=e.sliceString(n.to,r)),pl.set(e,new wr(l,s)),new wr(t,s.slice(t-l,r-l))}}class dg{constructor(e,t,r,n,s){this.text=e,this.to=s,this.done=!1,this.value=ug,this.matchPos=qs(e,n),this.re=new RegExp(t,Cc+(r!=null&&r.ignoreCase?"i":"")),this.test=r==null?void 0:r.test,this.flat=wr.get(e,n,this.chunkEnd(n+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t){let r=this.flat.from+t.index,n=r+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(r,n,t)))return this.value={from:r,to:n,match:t},this.matchPos=qs(this.text,n+(r==n?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=wr.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(fg.prototype[Symbol.iterator]=dg.prototype[Symbol.iterator]=function(){return this});function UA(i){try{return new RegExp(i,Cc),!0}catch{return!1}}function qs(i,e){if(e>=i.length)return e;let t=i.lineAt(e),r;for(;e<t.to&&(r=t.text.charCodeAt(e-t.from))>=56320&&r<57344;)e++;return e}const VA=i=>{let{state:e}=i,t=String(e.doc.lineAt(i.state.selection.main.head).number),{close:r,result:n}=aC(i,{label:e.phrase("Go to line"),input:{type:"text",name:"line",value:t},focus:!0,submitLabel:e.phrase("go")});return n.then(s=>{let l=s&&/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(s.elements.line.value);if(!l){i.dispatch({effects:r});return}let o=e.doc.lineAt(e.selection.main.head),[,a,c,u,h]=l,f=u?+u.slice(1):0,d=c?+c:o.number;if(c&&h){let p=d/100;a&&(p=p*(a=="-"?-1:1)+o.number/e.doc.lines),d=Math.round(e.doc.lines*p)}else c&&a&&(d=d*(a=="-"?-1:1)+o.number);let _=e.doc.line(Math.max(1,Math.min(e.doc.lines,d))),y=G.cursor(_.from+Math.max(0,Math.min(f,_.length)));i.dispatch({effects:[r,se.scrollIntoView(y.from,{y:"center"})],selection:y})}),!0},qA={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},KA=oe.define({combine(i){return Ni(i,qA,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})}});function GA(i){return[ZA,QA]}const XA=he.mark({class:"cm-selectionMatch"}),JA=he.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function hf(i,e,t,r){return(t==0||i(e.sliceDoc(t-1,t))!=Ne.Word)&&(r==e.doc.length||i(e.sliceDoc(r,r+1))!=Ne.Word)}function YA(i,e,t,r){return i(e.sliceDoc(t,t+1))==Ne.Word&&i(e.sliceDoc(r-1,r))==Ne.Word}const QA=st.fromClass(class{constructor(i){this.decorations=this.getDeco(i)}update(i){(i.selectionSet||i.docChanged||i.viewportChanged)&&(this.decorations=this.getDeco(i.view))}getDeco(i){let e=i.state.facet(KA),{state:t}=i,r=t.selection;if(r.ranges.length>1)return he.none;let n=r.main,s,l=null;if(n.empty){if(!e.highlightWordAroundCursor)return he.none;let a=t.wordAt(n.head);if(!a)return he.none;l=t.charCategorizer(n.head),s=t.sliceDoc(a.from,a.to)}else{let a=n.to-n.from;if(a<e.minSelectionLength||a>200)return he.none;if(e.wholeWords){if(s=t.sliceDoc(n.from,n.to),l=t.charCategorizer(n.head),!(hf(l,t,n.from,n.to)&&YA(l,t,n.from,n.to)))return he.none}else if(s=t.sliceDoc(n.from,n.to),!s)return he.none}let o=[];for(let a of i.visibleRanges){let c=new Lr(t.doc,s,a.from,a.to);for(;!c.next().done;){let{from:u,to:h}=c.value;if((!l||hf(l,t,u,h))&&(n.empty&&u<=n.from&&h>=n.to?o.push(JA.range(u,h)):(u>=n.to||h<=n.from)&&o.push(XA.range(u,h)),o.length>e.maxMatches))return he.none}}return he.set(o)}},{decorations:i=>i.decorations}),ZA=se.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),eD=({state:i,dispatch:e})=>{let{selection:t}=i,r=G.create(t.ranges.map(n=>i.wordAt(n.head)||G.cursor(n.head)),t.mainIndex);return r.eq(t)?!1:(e(i.update({selection:r})),!0)};function tD(i,e){let{main:t,ranges:r}=i.selection,n=i.wordAt(t.head),s=n&&n.from==t.from&&n.to==t.to;for(let l=!1,o=new Lr(i.doc,e,r[r.length-1].to);;)if(o.next(),o.done){if(l)return null;o=new Lr(i.doc,e,0,Math.max(0,r[r.length-1].from-1)),l=!0}else{if(l&&r.some(a=>a.from==o.value.from))continue;if(s){let a=i.wordAt(o.value.from);if(!a||a.from!=o.value.from||a.to!=o.value.to)continue}return o.value}}const iD=({state:i,dispatch:e})=>{let{ranges:t}=i.selection;if(t.some(s=>s.from===s.to))return eD({state:i,dispatch:e});let r=i.sliceDoc(t[0].from,t[0].to);if(i.selection.ranges.some(s=>i.sliceDoc(s.from,s.to)!=r))return!1;let n=tD(i,r);return n?(e(i.update({selection:i.selection.addRange(G.range(n.from,n.to),!1),effects:se.scrollIntoView(n.to)})),!0):!1},Fr=oe.define({combine(i){return Ni(i,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new gD(e),scrollToMatch:e=>se.scrollIntoView(e)})}});class pg{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||UA(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord,this.test=e.test}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(t,r)=>r=="n"?`
`:r=="r"?"\r":r=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord&&this.test==e.test}create(){return this.regexp?new aD(this):new sD(this)}getCursor(e,t=0,r){let n=e.doc?e:Ce.create({doc:e});return r==null&&(r=n.doc.length),this.regexp?cr(this,n,t,r):ar(this,n,t,r)}}class mg{constructor(e){this.spec=e}}function rD(i,e,t){return(r,n,s,l)=>{if(t&&!t(r,n,s,l))return!1;let o=r>=l&&n<=l+s.length?s.slice(r-l,n-l):e.doc.sliceString(r,n);return i(o,e,r,n)}}function ar(i,e,t,r){let n;return i.wholeWord&&(n=nD(e.doc,e.charCategorizer(e.selection.main.head))),i.test&&(n=rD(i.test,e,n)),new Lr(e.doc,i.unquoted,t,r,i.caseSensitive?void 0:s=>s.toLowerCase(),n)}function nD(i,e){return(t,r,n,s)=>((s>t||s+n.length<r)&&(s=Math.max(0,t-2),n=i.sliceString(s,Math.min(i.length,r+2))),(e(Ks(n,t-s))!=Ne.Word||e(Gs(n,t-s))!=Ne.Word)&&(e(Gs(n,r-s))!=Ne.Word||e(Ks(n,r-s))!=Ne.Word))}class sD extends mg{constructor(e){super(e)}nextMatch(e,t,r){let n=ar(this.spec,e,r,e.doc.length).nextOverlapping();if(n.done){let s=Math.min(e.doc.length,t+this.spec.unquoted.length);n=ar(this.spec,e,0,s).nextOverlapping()}return n.done||n.value.from==t&&n.value.to==r?null:n.value}prevMatchInRange(e,t,r){for(let n=r;;){let s=Math.max(t,n-1e4-this.spec.unquoted.length),l=ar(this.spec,e,s,n),o=null;for(;!l.nextOverlapping().done;)o=l.value;if(o)return o;if(s==t)return null;n-=1e4}}prevMatch(e,t,r){let n=this.prevMatchInRange(e,0,t);return n||(n=this.prevMatchInRange(e,Math.max(0,r-this.spec.unquoted.length),e.doc.length)),n&&(n.from!=t||n.to!=r)?n:null}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,t){let r=ar(this.spec,e,0,e.doc.length),n=[];for(;!r.next().done;){if(n.length>=t)return null;n.push(r.value)}return n}highlight(e,t,r,n){let s=ar(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(r+this.spec.unquoted.length,e.doc.length));for(;!s.next().done;)n(s.value.from,s.value.to)}}function oD(i,e,t){return(r,n,s)=>(!t||t(r,n,s))&&i(s[0],e,r,n)}function cr(i,e,t,r){let n;return i.wholeWord&&(n=lD(e.charCategorizer(e.selection.main.head))),i.test&&(n=oD(i.test,e,n)),new fg(e.doc,i.search,{ignoreCase:!i.caseSensitive,test:n},t,r)}function Ks(i,e){return i.slice(Ke(i,e,!1),e)}function Gs(i,e){return i.slice(e,Ke(i,e))}function lD(i){return(e,t,r)=>!r[0].length||(i(Ks(r.input,r.index))!=Ne.Word||i(Gs(r.input,r.index))!=Ne.Word)&&(i(Gs(r.input,r.index+r[0].length))!=Ne.Word||i(Ks(r.input,r.index+r[0].length))!=Ne.Word)}class aD extends mg{nextMatch(e,t,r){let n=cr(this.spec,e,r,e.doc.length).next();return n.done&&(n=cr(this.spec,e,0,t).next()),n.done?null:n.value}prevMatchInRange(e,t,r){for(let n=1;;n++){let s=Math.max(t,r-n*1e4),l=cr(this.spec,e,s,r),o=null;for(;!l.next().done;)o=l.value;if(o&&(s==t||o.from>s+10))return o;if(s==t)return null}}prevMatch(e,t,r){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,r,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&]|\d+)/g,(t,r)=>{if(r=="&")return e.match[0];if(r=="$")return"$";for(let n=r.length;n>0;n--){let s=+r.slice(0,n);if(s>0&&s<e.match.length)return e.match[s]+r.slice(n)}return t})}matchAll(e,t){let r=cr(this.spec,e,0,e.doc.length),n=[];for(;!r.next().done;){if(n.length>=t)return null;n.push(r.value)}return n}highlight(e,t,r,n){let s=cr(this.spec,e,Math.max(0,t-250),Math.min(r+250,e.doc.length));for(;!s.next().done;)n(s.value.from,s.value.to)}}const wn=pe.define(),Ec=pe.define(),Ai=et.define({create(i){return new ml(xa(i).create(),null)},update(i,e){for(let t of e.effects)t.is(wn)?i=new ml(t.value.create(),i.panel):t.is(Ec)&&(i=new ml(i.query,t.value?Ac:null));return i},provide:i=>mn.from(i,e=>e.panel)});class ml{constructor(e,t){this.query=e,this.panel=t}}const cD=he.mark({class:"cm-searchMatch"}),hD=he.mark({class:"cm-searchMatch cm-searchMatch-selected"}),uD=st.fromClass(class{constructor(i){this.view=i,this.decorations=this.highlight(i.state.field(Ai))}update(i){let e=i.state.field(Ai);(e!=i.startState.field(Ai)||i.docChanged||i.selectionSet||i.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:i,panel:e}){if(!e||!i.spec.valid)return he.none;let{view:t}=this,r=new Li;for(let n=0,s=t.visibleRanges,l=s.length;n<l;n++){let{from:o,to:a}=s[n];for(;n<l-1&&a>s[n+1].from-500;)a=s[++n].to;i.highlight(t.state,o,a,(c,u)=>{let h=t.state.selection.ranges.some(f=>f.from==c&&f.to==u);r.add(c,u,h?hD:cD)})}return r.finish()}},{decorations:i=>i.decorations});function Nn(i){return e=>{let t=e.state.field(Ai,!1);return t&&t.query.spec.valid?i(e,t):_g(e)}}const Xs=Nn((i,{query:e})=>{let{to:t}=i.state.selection.main,r=e.nextMatch(i.state,t,t);if(!r)return!1;let n=G.single(r.from,r.to),s=i.state.facet(Fr);return i.dispatch({selection:n,effects:[Dc(i,r),s.scrollToMatch(n.main,i)],userEvent:"select.search"}),vg(i),!0}),Js=Nn((i,{query:e})=>{let{state:t}=i,{from:r}=t.selection.main,n=e.prevMatch(t,r,r);if(!n)return!1;let s=G.single(n.from,n.to),l=i.state.facet(Fr);return i.dispatch({selection:s,effects:[Dc(i,n),l.scrollToMatch(s.main,i)],userEvent:"select.search"}),vg(i),!0}),fD=Nn((i,{query:e})=>{let t=e.matchAll(i.state,1e3);return!t||!t.length?!1:(i.dispatch({selection:G.create(t.map(r=>G.range(r.from,r.to))),userEvent:"select.search.matches"}),!0)}),dD=({state:i,dispatch:e})=>{let t=i.selection;if(t.ranges.length>1||t.main.empty)return!1;let{from:r,to:n}=t.main,s=[],l=0;for(let o=new Lr(i.doc,i.sliceDoc(r,n));!o.next().done;){if(s.length>1e3)return!1;o.value.from==r&&(l=s.length),s.push(G.range(o.value.from,o.value.to))}return e(i.update({selection:G.create(s,l),userEvent:"select.search.matches"})),!0},uf=Nn((i,{query:e})=>{let{state:t}=i,{from:r,to:n}=t.selection.main;if(t.readOnly)return!1;let s=e.nextMatch(t,r,r);if(!s)return!1;let l=s,o=[],a,c,u=[];l.from==r&&l.to==n&&(c=t.toText(e.getReplacement(l)),o.push({from:l.from,to:l.to,insert:c}),l=e.nextMatch(t,l.from,l.to),u.push(se.announce.of(t.phrase("replaced match on line $",t.doc.lineAt(r).number)+".")));let h=i.state.changes(o);return l&&(a=G.single(l.from,l.to).map(h),u.push(Dc(i,l)),u.push(t.facet(Fr).scrollToMatch(a.main,i))),i.dispatch({changes:h,selection:a,effects:u,userEvent:"input.replace"}),!0}),pD=Nn((i,{query:e})=>{if(i.state.readOnly)return!1;let t=e.matchAll(i.state,1e9).map(n=>{let{from:s,to:l}=n;return{from:s,to:l,insert:e.getReplacement(n)}});if(!t.length)return!1;let r=i.state.phrase("replaced $ matches",t.length)+".";return i.dispatch({changes:t,effects:se.announce.of(r),userEvent:"input.replace.all"}),!0});function Ac(i){return i.state.facet(Fr).createPanel(i)}function xa(i,e){var t,r,n,s,l;let o=i.selection.main,a=o.empty||o.to>o.from+100?"":i.sliceDoc(o.from,o.to);if(e&&!a)return e;let c=i.facet(Fr);return new pg({search:((t=e==null?void 0:e.literal)!==null&&t!==void 0?t:c.literal)?a:a.replace(/\n/g,"\\n"),caseSensitive:(r=e==null?void 0:e.caseSensitive)!==null&&r!==void 0?r:c.caseSensitive,literal:(n=e==null?void 0:e.literal)!==null&&n!==void 0?n:c.literal,regexp:(s=e==null?void 0:e.regexp)!==null&&s!==void 0?s:c.regexp,wholeWord:(l=e==null?void 0:e.wholeWord)!==null&&l!==void 0?l:c.wholeWord})}function gg(i){let e=ac(i,Ac);return e&&e.dom.querySelector("[main-field]")}function vg(i){let e=gg(i);e&&e==i.root.activeElement&&e.select()}const _g=i=>{let e=i.state.field(Ai,!1);if(e&&e.panel){let t=gg(i);if(t&&t!=i.root.activeElement){let r=xa(i.state,e.query.spec);r.valid&&i.dispatch({effects:wn.of(r)}),t.focus(),t.select()}}else i.dispatch({effects:[Ec.of(!0),e?wn.of(xa(i.state,e.query.spec)):pe.appendConfig.of(_D)]});return!0},yg=i=>{let e=i.state.field(Ai,!1);if(!e||!e.panel)return!1;let t=ac(i,Ac);return t&&t.dom.contains(i.root.activeElement)&&i.focus(),i.dispatch({effects:Ec.of(!1)}),!0},mD=[{key:"Mod-f",run:_g,scope:"editor search-panel"},{key:"F3",run:Xs,shift:Js,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:Xs,shift:Js,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:yg,scope:"editor search-panel"},{key:"Mod-Shift-l",run:dD},{key:"Mod-Alt-g",run:VA},{key:"Mod-d",run:iD,preventDefault:!0}];class gD{constructor(e){this.view=e;let t=this.query=e.state.field(Ai).query.spec;this.commit=this.commit.bind(this),this.searchField=Me("input",{value:t.search,placeholder:St(e,"Find"),"aria-label":St(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=Me("input",{value:t.replace,placeholder:St(e,"Replace"),"aria-label":St(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=Me("input",{type:"checkbox",name:"case",form:"",checked:t.caseSensitive,onchange:this.commit}),this.reField=Me("input",{type:"checkbox",name:"re",form:"",checked:t.regexp,onchange:this.commit}),this.wordField=Me("input",{type:"checkbox",name:"word",form:"",checked:t.wholeWord,onchange:this.commit});function r(n,s,l){return Me("button",{class:"cm-button",name:n,onclick:s,type:"button"},l)}this.dom=Me("div",{onkeydown:n=>this.keydown(n),class:"cm-search"},[this.searchField,r("next",()=>Xs(e),[St(e,"next")]),r("prev",()=>Js(e),[St(e,"previous")]),r("select",()=>fD(e),[St(e,"all")]),Me("label",null,[this.caseField,St(e,"match case")]),Me("label",null,[this.reField,St(e,"regexp")]),Me("label",null,[this.wordField,St(e,"by word")]),...e.state.readOnly?[]:[Me("br"),this.replaceField,r("replace",()=>uf(e),[St(e,"replace")]),r("replaceAll",()=>pD(e),[St(e,"replace all")])],Me("button",{name:"close",onclick:()=>yg(e),"aria-label":St(e,"close"),type:"button"},[""])])}commit(){let e=new pg({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:wn.of(e)}))}keydown(e){Kk(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?Js:Xs)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),uf(this.view))}update(e){for(let t of e.transactions)for(let r of t.effects)r.is(wn)&&!r.value.eq(this.query)&&this.setQuery(r.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(Fr).top}}function St(i,e){return i.state.phrase(e)}const cs=30,hs=/[\s\.,:;?!]/;function Dc(i,{from:e,to:t}){let r=i.state.doc.lineAt(e),n=i.state.doc.lineAt(t).to,s=Math.max(r.from,e-cs),l=Math.min(n,t+cs),o=i.state.sliceDoc(s,l);if(s!=r.from){for(let a=0;a<cs;a++)if(!hs.test(o[a+1])&&hs.test(o[a])){o=o.slice(a);break}}if(l!=n){for(let a=o.length-1;a>o.length-cs;a--)if(!hs.test(o[a-1])&&hs.test(o[a])){o=o.slice(0,a);break}}return se.announce.of(`${i.state.phrase("current match")}. ${o} ${i.state.phrase("on line")} ${r.number}.`)}const vD=se.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),_D=[Ai,nr.low(uD),vD];class ff{constructor(e,t,r){this.from=e,this.to=t,this.diagnostic=r}}class Ki{constructor(e,t,r){this.diagnostics=e,this.panel=t,this.selected=r}static init(e,t,r){let n=r.facet(Sn).markerFilter;n&&(e=n(e,r));let s=e.slice().sort((d,_)=>d.from-_.from||d.to-_.to),l=new Li,o=[],a=0,c=r.doc.iter(),u=0,h=r.doc.length;for(let d=0;;){let _=d==s.length?null:s[d];if(!_&&!o.length)break;let y,p;if(o.length)y=a,p=o.reduce((v,b)=>Math.min(v,b.to),_&&_.from>y?_.from:1e8);else{if(y=_.from,y>h)break;p=_.to,o.push(_),d++}for(;d<s.length;){let v=s[d];if(v.from==y&&(v.to>v.from||v.to==y))o.push(v),d++,p=Math.min(v.to,p);else{p=Math.min(v.from,p);break}}p=Math.min(p,h);let m=!1;if(o.some(v=>v.from==y&&(v.to==p||p==h))&&(m=y==p,!m&&p-y<10)){let v=y-(u+c.value.length);v>0&&(c.next(v),u=y);for(let b=y;;){if(b>=p){m=!0;break}if(!c.lineBreak&&u+c.value.length>b)break;b=u+c.value.length,u+=c.value.length,c.next()}}let g=TD(o);if(m)l.add(y,y,he.widget({widget:new AD(g),diagnostics:o.slice()}));else{let v=o.reduce((b,S)=>S.markClass?b+" "+S.markClass:b,"");l.add(y,p,he.mark({class:"cm-lintRange cm-lintRange-"+g+v,diagnostics:o.slice(),inclusiveEnd:o.some(b=>b.to>p)}))}if(a=p,a==h)break;for(let v=0;v<o.length;v++)o[v].to<=a&&o.splice(v--,1)}let f=l.finish();return new Ki(f,t,Tr(f))}}function Tr(i,e=null,t=0){let r=null;return i.between(t,1e9,(n,s,{spec:l})=>{if(!(e&&l.diagnostics.indexOf(e)<0))if(!r)r=new ff(n,s,e||l.diagnostics[0]);else{if(l.diagnostics.indexOf(r.diagnostic)<0)return!1;r=new ff(r.from,s,r.diagnostic)}}),r}function yD(i,e){let t=e.pos,r=e.end||t,n=i.state.facet(Sn).hideOn(i,t,r);if(n!=null)return n;let s=i.startState.doc.lineAt(e.pos);return!!(i.effects.some(l=>l.is(bg))||i.changes.touchesRange(s.from,Math.max(s.to,r)))}function bD(i,e){return i.field(Dt,!1)?e:e.concat(pe.appendConfig.of(RD))}const bg=pe.define(),Mc=pe.define(),xg=pe.define(),Dt=et.define({create(){return new Ki(he.none,null,null)},update(i,e){if(e.docChanged&&i.diagnostics.size){let t=i.diagnostics.map(e.changes),r=null,n=i.panel;if(i.selected){let s=e.changes.mapPos(i.selected.from,1);r=Tr(t,i.selected.diagnostic,s)||Tr(t,null,s)}!t.size&&n&&e.state.facet(Sn).autoPanel&&(n=null),i=new Ki(t,n,r)}for(let t of e.effects)if(t.is(bg)){let r=e.state.facet(Sn).autoPanel?t.value.length?kn.open:null:i.panel;i=Ki.init(t.value,r,e.state)}else t.is(Mc)?i=new Ki(i.diagnostics,t.value?kn.open:null,i.selected):t.is(xg)&&(i=new Ki(i.diagnostics,i.panel,t.value));return i},provide:i=>[mn.from(i,e=>e.panel),se.decorations.from(i,e=>e.diagnostics)]}),xD=he.mark({class:"cm-lintRange cm-lintRange-active"});function wD(i,e,t){let{diagnostics:r}=i.state.field(Dt),n,s=-1,l=-1;r.between(e-(t<0?1:0),e+(t>0?1:0),(a,c,{spec:u})=>{if(e>=a&&e<=c&&(a==c||(e>a||t>0)&&(e<c||t<0)))return n=u.diagnostics,s=a,l=c,!1});let o=i.state.facet(Sn).tooltipFilter;return n&&o&&(n=o(n,i.state)),n?{pos:s,end:l,above:i.state.doc.lineAt(s).to<l,create(){return{dom:SD(i,n)}}}:null}function SD(i,e){return Me("ul",{class:"cm-tooltip-lint"},e.map(t=>Sg(i,t,!1)))}const kD=i=>{let e=i.state.field(Dt,!1);(!e||!e.panel)&&i.dispatch({effects:bD(i.state,[Mc.of(!0)])});let t=ac(i,kn.open);return t&&t.dom.querySelector(".cm-panel-lint ul").focus(),!0},df=i=>{let e=i.state.field(Dt,!1);return!e||!e.panel?!1:(i.dispatch({effects:Mc.of(!1)}),!0)},CD=i=>{let e=i.state.field(Dt,!1);if(!e)return!1;let t=i.state.selection.main,r=e.diagnostics.iter(t.to+1);return!r.value&&(r=e.diagnostics.iter(0),!r.value||r.from==t.from&&r.to==t.to)?!1:(i.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0}),!0)},ED=[{key:"Mod-Shift-m",run:kD,preventDefault:!0},{key:"F8",run:CD}],Sn=oe.define({combine(i){return{sources:i.map(e=>e.source).filter(e=>e!=null),...Ni(i.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{delay:Math.max,markerFilter:pf,tooltipFilter:pf,needsRefresh:(e,t)=>e?t?r=>e(r)||t(r):e:t,hideOn:(e,t)=>e?t?(r,n,s)=>e(r,n,s)||t(r,n,s):e:t,autoPanel:(e,t)=>e||t})}}});function pf(i,e){return i?e?(t,r)=>e(i(t,r),r):i:e}function wg(i){let e=[];if(i)e:for(let{name:t}of i){for(let r=0;r<t.length;r++){let n=t[r];if(/[a-zA-Z]/.test(n)&&!e.some(s=>s.toLowerCase()==n.toLowerCase())){e.push(n);continue e}}e.push("")}return e}function Sg(i,e,t){var r;let n=t?wg(e.actions):[];return Me("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},Me("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage(i):e.message),(r=e.actions)===null||r===void 0?void 0:r.map((s,l)=>{let o=!1,a=d=>{if(d.preventDefault(),o)return;o=!0;let _=Tr(i.state.field(Dt).diagnostics,e);_&&s.apply(i,_.from,_.to)},{name:c}=s,u=n[l]?c.indexOf(n[l]):-1,h=u<0?c:[c.slice(0,u),Me("u",c.slice(u,u+1)),c.slice(u+1)],f=s.markClass?" "+s.markClass:"";return Me("button",{type:"button",class:"cm-diagnosticAction"+f,onclick:a,onmousedown:a,"aria-label":` Action: ${c}${u<0?"":` (access key "${n[l]})"`}.`},h)}),e.source&&Me("div",{class:"cm-diagnosticSource"},e.source))}class AD extends Fi{constructor(e){super(),this.sev=e}eq(e){return e.sev==this.sev}toDOM(){return Me("span",{class:"cm-lintPoint cm-lintPoint-"+this.sev})}}class mf{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=Sg(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class kn{constructor(e){this.view=e,this.items=[];let t=n=>{if(!(n.ctrlKey||n.altKey||n.metaKey)){if(n.keyCode==27)df(this.view),this.view.focus();else if(n.keyCode==38||n.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(n.keyCode==40||n.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(n.keyCode==36)this.moveSelection(0);else if(n.keyCode==35)this.moveSelection(this.items.length-1);else if(n.keyCode==13)this.view.focus();else if(n.keyCode>=65&&n.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:s}=this.items[this.selectedIndex],l=wg(s.actions);for(let o=0;o<l.length;o++)if(l[o].toUpperCase().charCodeAt(0)==n.keyCode){let a=Tr(this.view.state.field(Dt).diagnostics,s);a&&s.actions[o].apply(e,a.from,a.to)}}else return;n.preventDefault()}},r=n=>{for(let s=0;s<this.items.length;s++)this.items[s].dom.contains(n.target)&&this.moveSelection(s)};this.list=Me("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t,onclick:r}),this.dom=Me("div",{class:"cm-panel-lint"},this.list,Me("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>df(this.view)},"")),this.update()}get selectedIndex(){let e=this.view.state.field(Dt).selected;if(!e)return-1;for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:e,selected:t}=this.view.state.field(Dt),r=0,n=!1,s=null,l=new Set;for(e.between(0,this.view.state.doc.length,(o,a,{spec:c})=>{for(let u of c.diagnostics){if(l.has(u))continue;l.add(u);let h=-1,f;for(let d=r;d<this.items.length;d++)if(this.items[d].diagnostic==u){h=d;break}h<0?(f=new mf(this.view,u),this.items.splice(r,0,f),n=!0):(f=this.items[h],h>r&&(this.items.splice(r,h-r),n=!0)),t&&f.diagnostic==t.diagnostic?f.dom.hasAttribute("aria-selected")||(f.dom.setAttribute("aria-selected","true"),s=f):f.dom.hasAttribute("aria-selected")&&f.dom.removeAttribute("aria-selected"),r++}});r<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)n=!0,this.items.pop();this.items.length==0&&(this.items.push(new mf(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),n=!0),s?(this.list.setAttribute("aria-activedescendant",s.id),this.view.requestMeasure({key:this,read:()=>({sel:s.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:o,panel:a})=>{let c=a.height/this.list.offsetHeight;o.top<a.top?this.list.scrollTop-=(a.top-o.top)/c:o.bottom>a.bottom&&(this.list.scrollTop+=(o.bottom-a.bottom)/c)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),n&&this.sync()}sync(){let e=this.list.firstChild;function t(){let r=e;e=r.nextSibling,r.remove()}for(let r of this.items)if(r.dom.parentNode==this.list){for(;e!=r.dom;)t();e=r.dom.nextSibling}else this.list.insertBefore(r.dom,e);for(;e;)t()}moveSelection(e){if(this.selectedIndex<0)return;let t=this.view.state.field(Dt),r=Tr(t.diagnostics,this.items[e].diagnostic);r&&this.view.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0,effects:xg.of(r)})}static open(e){return new kn(e)}}function DD(i,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(i)}</svg>')`}function us(i){return DD(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${i}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const MD=se.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:us("#d11")},".cm-lintRange-warning":{backgroundImage:us("orange")},".cm-lintRange-info":{backgroundImage:us("#999")},".cm-lintRange-hint":{backgroundImage:us("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});function LD(i){return i=="error"?4:i=="warning"?3:i=="info"?2:1}function TD(i){let e="hint",t=1;for(let r of i){let n=LD(r.severity);n>t&&(t=n,e=r.severity)}return e}const RD=[Dt,se.decorations.compute([Dt],i=>{let{selected:e,panel:t}=i.field(Dt);return!e||!t||e.from==e.to?he.none:he.set([xD.range(e.from,e.to)])}),oC(wD,{hideOn:yD}),MD],BD="#e5c07b",gf="#e06c75",OD="#56b6c2",PD="#ffffff",xs="#abb2bf",wa="#7d8799",ID="#61afef",ND="#98c379",vf="#d19a66",FD="#c678dd",HD="#21252b",_f="#2c313a",yf="#282c34",gl="#353a42",jD="#3E4451",bf="#528bff",zD=se.theme({"&":{color:xs,backgroundColor:yf},".cm-content":{caretColor:bf},".cm-cursor, .cm-dropCursor":{borderLeftColor:bf},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:jD},".cm-panels":{backgroundColor:HD,color:xs},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:yf,color:wa,border:"none"},".cm-activeLineGutter":{backgroundColor:_f},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:gl},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:gl,borderBottomColor:gl},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:_f,color:xs}}},{dark:!0}),WD=On.define([{tag:V.keyword,color:FD},{tag:[V.name,V.deleted,V.character,V.propertyName,V.macroName],color:gf},{tag:[V.function(V.variableName),V.labelName],color:ID},{tag:[V.color,V.constant(V.name),V.standard(V.name)],color:vf},{tag:[V.definition(V.name),V.separator],color:xs},{tag:[V.typeName,V.className,V.number,V.changed,V.annotation,V.modifier,V.self,V.namespace],color:BD},{tag:[V.operator,V.operatorKeyword,V.url,V.escape,V.regexp,V.link,V.special(V.string)],color:OD},{tag:[V.meta,V.comment],color:wa},{tag:V.strong,fontWeight:"bold"},{tag:V.emphasis,fontStyle:"italic"},{tag:V.strikethrough,textDecoration:"line-through"},{tag:V.link,color:wa,textDecoration:"underline"},{tag:V.heading,fontWeight:"bold",color:gf},{tag:[V.atom,V.bool,V.special(V.variableName)],color:vf},{tag:[V.processingInstruction,V.string,V.inserted],color:ND},{tag:V.invalid,color:PD}]),$D=[zD,_m(WD)];async function UD(i){switch(i){case"python":{const{python:e}=await bi(async()=>{const{python:t}=await import("./index-D7cFLKlg.js");return{python:t}},__vite__mapDeps([0,1,2,3,4,5]));return e()}case"javascript":case"typescript":{const{javascript:e}=await bi(async()=>{const{javascript:t}=await import("./index-Cte_GxnQ.js");return{javascript:t}},__vite__mapDeps([6,1,2,3,4,5]));return e({jsx:!0,typescript:i==="typescript"})}case"sql":{const{sql:e}=await bi(async()=>{const{sql:t}=await import("./index-CKkdEfUE.js");return{sql:t}},__vite__mapDeps([7,1,2,3,4,5]));return e()}case"json":{const{json:e}=await bi(async()=>{const{json:t}=await import("./index-DuyWbSKH.js");return{json:t}},__vite__mapDeps([8,1,2,3,4,5]));return e()}case"yaml":{const{yaml:e}=await bi(async()=>{const{yaml:t}=await import("./index-Du4zVQDd.js");return{yaml:t}},__vite__mapDeps([9,1,2,3,4,5]));return e()}case"markdown":{const{markdown:e}=await bi(async()=>{const{markdown:t}=await import("./index-D8zySEht.js");return{markdown:t}},__vite__mapDeps([10,11,1,12,2,3,4,5,6]));return e()}case"html":{const{html:e}=await bi(async()=>{const{html:t}=await import("./index-OLvXkA4N.js");return{html:t}},__vite__mapDeps([11,1,12,2,3,4,5,6]));return e()}case"css":{const{css:e}=await bi(async()=>{const{css:t}=await import("./index-Lak4fBov.js");return{css:t}},__vite__mapDeps([12,1,2,3,4,5]));return e()}default:return[]}}const VD=H.memo(function({value:e,onChange:t,filePath:r,language:n,readOnly:s=!1,className:l=""}){const o=H.useRef(null),a=H.useRef(null),c=H.useRef(!1),u=n||(r?$g(An(r)):"text");return H.useEffect(()=>{if(!o.current)return;let h=!0;return(async()=>{const f=[yC(),Jk(),wC(),$2(),g2(),o2(),A2(),LA(),zA(),GA(),_m(b2,{fallback:!0}),$D,ho.of([...VE,...Q2,...OA,...mD,...ED,qE]),se.updateListener.of(m=>{m.docChanged&&!c.current&&t&&t(m.state.doc.toString())}),Ce.readOnly.of(s),se.theme({"&":{height:"100%",fontSize:"13px"},".cm-scroller":{fontFamily:"JetBrains Mono, Menlo, Monaco, Consolas, monospace",overflow:"auto"},".cm-gutters":{backgroundColor:"var(--color-bg-secondary)",borderRight:"1px solid var(--color-border)"}})],d=await UD(u),_=[...f,d];if(!h)return;const y=Ce.create({doc:e,extensions:_}),p=new se({state:y,parent:o.current});a.current=p})(),()=>{h=!1,a.current&&(a.current.destroy(),a.current=null)}},[]),H.useEffect(()=>{const h=a.current;if(!h)return;const f=h.state.doc.toString();f!==e&&(c.current=!0,h.dispatch({changes:{from:0,to:f.length,insert:e}}),c.current=!1)},[e]),D.jsx("div",{ref:o,className:`h-full w-full overflow-hidden ${l}`})},(i,e)=>i.value===e.value&&i.filePath===e.filePath&&i.readOnly===e.readOnly);function qD(i,e,t){if(e)return t?D.jsx(Af,{className:"h-4 w-4 text-yellow-500"}):D.jsx(kf,{className:"h-4 w-4 text-yellow-500"});switch(An(i)){case"py":return D.jsx(pr,{className:"h-4 w-4 text-blue-400"});case"js":case"jsx":case"ts":case"tsx":return D.jsx(pr,{className:"h-4 w-4 text-yellow-400"});case"json":return D.jsx(Ef,{className:"h-4 w-4 text-orange-400"});case"yaml":case"yml":return D.jsx(Qi,{className:"h-4 w-4 text-purple-400"});case"sql":return D.jsx(pr,{className:"h-4 w-4 text-green-400"});case"md":return D.jsx(Qi,{className:"h-4 w-4 text-gray-400"});default:return D.jsx(En,{className:"h-4 w-4 text-gray-400"})}}const KD=H.memo(function i({node:e,depth:t,selectedPath:r,expandedPaths:n,onToggleExpand:s,onFileSelect:l,onFileDelete:o}){const a=e.type==="directory",c=n.has(e.path),u=r===e.path,[h,f]=H.useState(!1),d=H.useCallback(()=>{a?s(e.path):l(e.path)},[a,e.path,s,l]),_=H.useCallback(y=>{y.stopPropagation(),o&&confirm(`Delete ${e.name}?`)&&o(e.path)},[e.name,e.path,o]);return D.jsxs(D.Fragment,{children:[D.jsxs("div",{className:ue("flex items-center gap-1 px-2 py-1 cursor-pointer hover:bg-[var(--color-bg-secondary)] transition-colors",u&&"bg-[var(--color-accent-primary)]/20 hover:bg-[var(--color-accent-primary)]/30"),style:{paddingLeft:`${t*12+8}px`},onClick:d,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:[a?D.jsx("span",{className:"w-4 h-4 flex items-center justify-center text-[var(--color-text-muted)]",children:c?D.jsx(Br,{className:"h-3 w-3"}):D.jsx(Ys,{className:"h-3 w-3"})}):D.jsx("span",{className:"w-4 h-4"}),qD(e.name,a,c),D.jsx("span",{className:"flex-1 text-xs text-[var(--color-text-primary)] truncate",children:e.name}),h&&o&&!a&&D.jsx("button",{onClick:_,className:"p-0.5 rounded hover:bg-red-500/20 text-[var(--color-text-muted)] hover:text-red-400 transition-colors",title:"Delete file",children:D.jsx(Ug,{className:"h-3 w-3"})})]}),a&&c&&e.children&&D.jsx(D.Fragment,{children:e.children.map(y=>D.jsx(i,{node:y,depth:t+1,selectedPath:r,expandedPaths:n,onToggleExpand:s,onFileSelect:l,onFileDelete:o},y.path))})]})});function GD({files:i,selectedPath:e,onFileSelect:t,onFileCreate:r,onFileDelete:n,onRefresh:s,isLoading:l=!1,className:o=""}){const[a,c]=H.useState(new Set),u=H.useCallback(h=>{c(f=>{const d=new Set(f);return d.has(h)?d.delete(h):d.add(h),d})},[]);return D.jsxs("div",{className:ue("flex flex-col h-full",o),children:[D.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-[var(--color-border)]",children:[D.jsx("span",{className:"text-xs font-medium text-[var(--color-text-muted)] uppercase tracking-wider",children:"Files"}),D.jsxs("div",{className:"flex items-center gap-1",children:[r&&D.jsx("button",{onClick:()=>{const h=prompt("Enter file name:");h&&r(h)},className:"p-1 rounded hover:bg-[var(--color-bg-secondary)] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors",title:"New file",children:D.jsx(bl,{className:"h-4 w-4"})}),s&&D.jsx("button",{onClick:s,disabled:l,className:"p-1 rounded hover:bg-[var(--color-bg-secondary)] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors disabled:opacity-50",title:"Refresh",children:D.jsx(Rr,{className:ue("h-4 w-4",l&&"animate-spin")})})]})]}),D.jsx("div",{className:"flex-1 overflow-y-auto py-1",children:i.length===0?D.jsx("div",{className:"px-3 py-4 text-xs text-[var(--color-text-muted)] text-center",children:l?"Loading files...":"No files yet"}):i.map(h=>D.jsx(KD,{node:h,depth:0,selectedPath:e,expandedPaths:a,onToggleExpand:u,onFileSelect:t,onFileDelete:n},h.path))})]})}function XD(i){switch(An(i)){case"py":return D.jsx(pr,{className:"h-3.5 w-3.5 text-blue-400"});case"js":case"jsx":case"ts":case"tsx":return D.jsx(pr,{className:"h-3.5 w-3.5 text-yellow-400"});case"json":return D.jsx(Ef,{className:"h-3.5 w-3.5 text-orange-400"});case"yaml":case"yml":return D.jsx(Qi,{className:"h-3.5 w-3.5 text-purple-400"});case"sql":return D.jsx(pr,{className:"h-3.5 w-3.5 text-green-400"});case"md":return D.jsx(Qi,{className:"h-3.5 w-3.5 text-gray-400"});default:return D.jsx(En,{className:"h-3.5 w-3.5 text-gray-400"})}}const JD=H.memo(function({tabs:e,activeTab:t,onTabSelect:r,onTabClose:n,className:s=""}){const l=H.useCallback((o,a)=>{o.stopPropagation(),n(a)},[n]);return e.length===0?null:D.jsx("div",{className:ue("flex items-center border-b border-[var(--color-border)] bg-[var(--color-bg-secondary)]/50 overflow-x-auto",s),children:e.map(o=>{const a=t===o.path;return D.jsxs("button",{onClick:()=>r(o.path),className:ue("flex items-center gap-1.5 px-3 py-2 text-xs border-r border-[var(--color-border)] min-w-0 max-w-[150px] group transition-colors",a?"bg-[var(--color-background)] text-[var(--color-text-primary)]":"text-[var(--color-text-muted)] hover:bg-[var(--color-background)]/50 hover:text-[var(--color-text-primary)]"),children:[XD(o.name),D.jsxs("span",{className:"truncate",children:[o.name,o.isDirty&&D.jsx("span",{className:"text-[var(--color-accent-primary)]",children:"*"})]}),D.jsx("span",{onClick:c=>l(c,o.path),className:ue("ml-auto p-0.5 rounded hover:bg-[var(--color-bg-secondary)] transition-colors",a?"opacity-100":"opacity-0 group-hover:opacity-100"),title:"Close",children:D.jsx(Cn,{className:"h-3 w-3"})})]},o.path)})})});function YD({projectId:i,className:e=""}){const[t,r]=H.useState(""),[n,s]=H.useState(""),[l,o]=H.useState(0),[a,c]=H.useState("deployed"),[u,h]=H.useState(!1),[f,d]=H.useState(null);H.useEffect(()=>{(async()=>{try{const b=await ds(i);b.app_url&&a==="deployed"&&(r(b.app_url),s(b.app_url))}catch{}})()},[i,a]),H.useEffect(()=>{const v=async()=>{try{const k=await(await fetch(`/api/projects/${i}/preview/status`)).json();if(k.status==="running"){if(h(!0),d(k.port),a==="local"){const w=`/api/projects/${i}/preview/`;r(w),s(w)}}else h(!1),d(null)}catch{h(!1),d(null)}};v();const b=setInterval(v,15e3),S=()=>{if(document.hidden)clearInterval(b);else{v();const x=setInterval(v,15e3);return()=>clearInterval(x)}};return document.addEventListener("visibilitychange",S),()=>{clearInterval(b),document.removeEventListener("visibilitychange",S)}},[i,a]);const _=H.useCallback(v=>{v.preventDefault(),n.trim()&&r(n.trim())},[n]),y=H.useCallback(()=>{o(v=>v+1)},[]),p=H.useCallback(()=>{t&&window.open(t,"_blank","noopener,noreferrer")},[t]),m=H.useCallback(async()=>{try{const b=await(await fetch(`/api/projects/${i}/preview/start`,{method:"POST"})).json();if(b.status==="started"||b.status==="already_running"){h(!0),d(b.port),c("local");const S=`/api/projects/${i}/preview/`;r(S),s(S),o(x=>x+1),Ct.success(`Preview server started on port ${b.port}`)}}catch(v){console.error("Failed to start preview server:",v),Ct.error("Failed to start preview server")}},[i]),g=H.useCallback(async()=>{try{await fetch(`/api/projects/${i}/preview/stop`,{method:"POST"}),h(!1),d(null),r(""),s(""),Ct.success("Preview server stopped")}catch(v){console.error("Failed to stop preview server:",v),Ct.error("Failed to stop preview server")}},[i]);return D.jsxs("div",{className:ue("flex flex-col h-full",e),children:[D.jsxs("div",{className:"flex items-center gap-2 h-8 px-2 bg-[var(--color-bg-secondary)]/50 border-b border-[var(--color-border)] flex-shrink-0",children:[D.jsxs("div",{className:"flex items-center gap-1 border border-[var(--color-border)] rounded overflow-hidden",children:[D.jsx("button",{onClick:()=>c("local"),className:ue("px-2 py-0.5 text-xs transition-colors",a==="local"?"bg-[var(--color-accent-primary)] text-white":"text-[var(--color-text-muted)] hover:bg-[var(--color-bg-secondary)]"),children:"Local"}),D.jsx("button",{onClick:()=>c("deployed"),className:ue("px-2 py-0.5 text-xs transition-colors",a==="deployed"?"bg-[var(--color-accent-primary)] text-white":"text-[var(--color-text-muted)] hover:bg-[var(--color-bg-secondary)]"),children:"Deployed"})]}),a==="local"&&D.jsx(D.Fragment,{children:u?D.jsxs(D.Fragment,{children:[D.jsxs("button",{onClick:g,className:"flex items-center gap-1 px-2 py-0.5 text-xs bg-red-500/20 text-red-400 rounded hover:bg-red-500/30 transition-colors",children:[D.jsx(U0,{className:"h-3 w-3"}),"Stop"]}),D.jsxs("span",{className:"text-xs text-[var(--color-text-muted)]",children:["Port ",f]})]}):D.jsxs("button",{onClick:m,className:"flex items-center gap-1 px-2 py-0.5 text-xs bg-green-500/20 text-green-400 rounded hover:bg-green-500/30 transition-colors",children:[D.jsx(Mf,{className:"h-3 w-3"}),"Start Server"]})}),D.jsx("button",{onClick:y,className:"p-1 rounded hover:bg-[var(--color-bg-secondary)] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors ml-auto",title:"Refresh",children:D.jsx(Rr,{className:"h-3 w-3"})}),D.jsx("button",{onClick:p,disabled:!t,className:"p-1 rounded hover:bg-[var(--color-bg-secondary)] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors disabled:opacity-30",title:"Open in new tab",children:D.jsx(Cf,{className:"h-3 w-3"})})]}),t&&D.jsxs("div",{className:"flex items-center gap-1.5 h-6 px-2 bg-[var(--color-background)]/50 border-b border-[var(--color-border)] flex-shrink-0",children:[D.jsx(_l,{className:"h-3 w-3 text-[var(--color-text-muted)]"}),D.jsx("form",{onSubmit:_,className:"flex-1 flex",children:D.jsx("input",{type:"text",value:n,onChange:v=>s(v.target.value),placeholder:"Enter URL...",className:"flex-1 h-4 px-2 text-xs bg-transparent border-none text-[var(--color-text-primary)] placeholder:text-[var(--color-text-muted)] focus:outline-none"})})]}),t?D.jsx("iframe",{src:t,className:"flex-1 w-full border-none bg-white",sandbox:"allow-scripts allow-same-origin allow-forms allow-popups",title:"App preview"},l):D.jsx("div",{className:"flex-1 flex items-center justify-center bg-[var(--color-background)]",children:D.jsxs("div",{className:"text-center",children:[D.jsx(_l,{className:"h-8 w-8 mx-auto text-[var(--color-text-muted)] opacity-50"}),D.jsx("p",{className:"mt-2 text-xs text-[var(--color-text-muted)]",children:"No app running. Deploy your app first or enter a URL above."})]})})]})}function QD({projectId:i,className:e=""}){const[t,r]=H.useState({status:"idle"}),[n,s]=H.useState([]),[l,o]=H.useState(!1);H.useEffect(()=>{(async()=>{try{const d=await ds(i);r(d)}catch(d){console.error("Failed to fetch deploy status:",d)}})()},[i]),H.useEffect(()=>{if(t.status!=="deploying")return;const f=new AbortController;return(async()=>{try{await Tg(i,y=>{s(p=>[...p,y])},f.signal);const _=await ds(i);r(_)}catch(_){_ instanceof Error&&_.name!=="AbortError"&&console.error("Failed to stream deploy logs:",_)}})(),()=>{f.abort()}},[i,t.status]);const a=H.useCallback(async()=>{try{s([]),o(!0),await Lg(i),r({status:"deploying"})}catch(f){console.error("Failed to deploy:",f),r({status:"error",error:f instanceof Error?f.message:"Unknown error"})}},[i]),c=H.useCallback(async()=>{try{const f=await ds(i);r(f)}catch(f){console.error("Failed to fetch deploy status:",f)}},[i]),u=()=>{switch(t.status){case"deploying":return"text-yellow-500";case"success":return"text-green-500";case"error":return"text-red-500";default:return"text-[var(--color-text-muted)]"}},h=()=>{switch(t.status){case"deploying":return D.jsx(Di,{className:"h-4 w-4 animate-spin"});case"success":return D.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"});case"error":return D.jsx(l0,{className:"h-4 w-4"});default:return D.jsx("span",{className:"w-2 h-2 rounded-full bg-gray-500"})}};return D.jsxs("div",{className:ue("border-t border-[var(--color-border)]",e),children:[D.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-[var(--color-bg-secondary)]/50",children:[D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx(Vg,{onClick:a,disabled:t.status==="deploying",className:"h-7 px-2 text-xs",children:t.status==="deploying"?D.jsxs(D.Fragment,{children:[D.jsx(Di,{className:"h-3 w-3 mr-1 animate-spin"}),"Deploying..."]}):D.jsxs(D.Fragment,{children:[D.jsx(Mf,{className:"h-3 w-3 mr-1"}),"Deploy"]})}),D.jsxs("div",{className:ue("flex items-center gap-1.5 text-xs",u()),children:[h(),D.jsx("span",{className:"capitalize",children:t.status})]}),t.app_url&&D.jsxs("a",{href:t.app_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-xs text-[var(--color-accent-primary)] hover:underline",children:[D.jsx(Cf,{className:"h-3 w-3"}),"Open App"]})]}),D.jsxs("div",{className:"flex items-center gap-1",children:[D.jsx("button",{onClick:c,className:"p-1 rounded hover:bg-[var(--color-bg-secondary)] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors",title:"Refresh status",children:D.jsx(Rr,{className:"h-3.5 w-3.5"})}),D.jsx("button",{onClick:()=>o(!l),className:"px-2 py-0.5 text-xs text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors",children:l?"Hide Logs":"Show Logs"})]})]}),l&&D.jsx("div",{className:"h-32 overflow-y-auto bg-[var(--color-background)] p-2 font-mono text-xs",children:n.length===0?D.jsx("div",{className:"text-[var(--color-text-muted)]",children:t.status==="deploying"?"Waiting for logs...":"No deployment logs"}):n.map((f,d)=>D.jsxs("div",{className:ue("py-0.5",f.level==="error"&&"text-red-400",f.level==="warning"&&"text-yellow-400",f.level==="info"&&"text-[var(--color-text-primary)]"),children:[D.jsxs("span",{className:"text-[var(--color-text-muted)]",children:["[",new Date(f.timestamp).toLocaleTimeString(),"]"]})," ",f.message]},d))}),t.error&&D.jsxs("div",{className:"px-3 py-2 bg-red-500/10 text-red-400 text-xs",children:["Error: ",t.error]})]})}const ZD=H.memo(function({paneId:e,tabs:t,activeTabPath:r,onTabSelect:n,onTabClose:s,onContentChange:l,isFocused:o=!1,onFocus:a,className:c=""}){const u=t.find(y=>y.path===r),h=H.useCallback(y=>{n(e,y)},[e,n]),f=H.useCallback(y=>{s(e,y)},[e,s]),d=H.useCallback(y=>{r&&l(e,r,y)},[e,r,l]),_=H.useCallback(()=>{a==null||a(e)},[e,a]);return D.jsxs("div",{className:`flex flex-col h-full min-w-0 ${c}`,onClick:_,children:[D.jsx(JD,{tabs:t.map(y=>({path:y.path,name:y.name,isDirty:y.isDirty})),activeTab:r,onTabSelect:h,onTabClose:f,className:o?"border-b-2 border-b-[var(--color-accent-primary)]":""}),D.jsx("div",{className:"flex-1 overflow-hidden",children:u?D.jsx(VD,{value:u.content,onChange:d,filePath:u.path}):D.jsx("div",{className:"h-full flex items-center justify-center text-[var(--color-text-muted)] text-sm",children:t.length===0?"No files open":"Select a file to edit"})})]})},(i,e)=>i.paneId===e.paneId&&i.activeTabPath===e.activeTabPath&&i.tabs===e.tabs&&i.isFocused===e.isFocused);function eM({direction:i,first:e,second:t,splitRatio:r,onSplitRatioChange:n,renderPane:s}){const l=H.useRef(null),o=H.useRef(null);H.useEffect(()=>{const c=o.current,u=l.current;if(!c||!u)return;let h=!1;const f=()=>{h=!0,document.body.style.cursor=i==="horizontal"?"col-resize":"row-resize",document.body.style.userSelect="none"},d=y=>{if(!h)return;const p=u.getBoundingClientRect();let m;i==="horizontal"?m=(y.clientX-p.left)/p.width*100:m=(y.clientY-p.top)/p.height*100,n(Math.min(Math.max(m,20),80))},_=()=>{h=!1,document.body.style.cursor="",document.body.style.userSelect=""};return c.addEventListener("mousedown",f),document.addEventListener("mousemove",d),document.addEventListener("mouseup",_),()=>{c.removeEventListener("mousedown",f),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",_)}},[i,n]);const a=i==="horizontal";return D.jsxs("div",{ref:l,className:ue("flex h-full",a?"flex-row":"flex-col"),children:[D.jsx("div",{style:{[a?"width":"height"]:`${r}%`},className:"overflow-hidden",children:s(e)}),D.jsx("div",{ref:o,className:ue("flex items-center justify-center bg-[var(--color-border)] hover:bg-[var(--color-accent-primary)]/50 transition-colors",a?"w-1 cursor-col-resize":"h-1 cursor-row-resize"),children:a?D.jsx(yl,{className:"h-4 w-4 text-[var(--color-text-muted)]"}):D.jsx(Df,{className:"h-4 w-4 text-[var(--color-text-muted)]"})}),D.jsx("div",{style:{[a?"width":"height"]:`${100-r}%`},className:"overflow-hidden",children:s(t)})]})}function tM({layout:i,panes:e,focusedPaneId:t,onLayoutChange:r,onFocusPane:n,onTabSelect:s,onTabClose:l,onContentChange:o,className:a=""}){const c=H.useCallback((h,f)=>{const d=(_,y)=>{if(y.length===0)return{..._,splitRatio:f};const[p,...m]=y;if(_.type==="split"){if(p==="first"&&_.first)return{..._,first:d(_.first,m)};if(p==="second"&&_.second)return{..._,second:d(_.second,m)}}return _};r(d(i,h))},[i,r]),u=H.useCallback((h,f=[])=>{if(h.type==="leaf"&&h.paneId){const d=e[h.paneId]||{tabs:[]};return D.jsx(ZD,{paneId:h.paneId,tabs:d.tabs,activeTabPath:d.activeTabPath,onTabSelect:s,onTabClose:l,onContentChange:o,isFocused:t===h.paneId,onFocus:n})}return h.type==="split"&&h.first&&h.second&&h.direction?D.jsx(eM,{direction:h.direction,first:h.first,second:h.second,splitRatio:h.splitRatio||50,onSplitRatioChange:d=>c(f,d),renderPane:d=>u(d,[...f,d===h.first?"first":"second"])}):null},[e,t,s,l,o,n,c]);return D.jsx("div",{className:ue("h-full overflow-hidden",a),children:u(i)})}function iM(i="main"){return{type:"leaf",paneId:i}}function Sa(i,e,t,r){return i.type==="leaf"&&i.paneId===e?{type:"split",direction:t,first:{type:"leaf",paneId:e},second:{type:"leaf",paneId:r},splitRatio:50}:i.type==="split"&&i.first&&i.second?{...i,first:Sa(i.first,e,t,r),second:Sa(i.second,e,t,r)}:i}function rM(i){const e=H.useCallback(t=>{const r=t.target,n=r.tagName==="INPUT"||r.tagName==="TEXTAREA"||r.isContentEditable;for(const s of i){if(n&&s.disableInInput!==!1&&!(s.key.toLowerCase()==="s"||s.key.toLowerCase()==="p"))continue;const l=t.key.toLowerCase()===s.key.toLowerCase(),o=!!s.ctrl===t.ctrlKey,a=!!s.meta===t.metaKey,c=!!s.shift===t.shiftKey,u=!!s.alt===t.altKey,f=navigator.platform.toUpperCase().indexOf("MAC")>=0?(s.meta||s.ctrl)===t.metaKey:(s.ctrl||s.meta)===t.ctrlKey;if(l&&c&&u){if(s.meta||s.ctrl){if(f){t.preventDefault(),s.action();return}}else if(o&&a){t.preventDefault(),s.action();return}}}},[i]);H.useEffect(()=>(window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)),[e])}function xf(i,e){return{key:i,meta:!0,ctrl:!0,action:e}}function fs(i,e){return{key:i,meta:!0,ctrl:!0,shift:!0,action:e}}function ka(i){return i.replace(/[^a-zA-Z0-9]/g,"_").toLowerCase()}function nM(i,e){if(!i)return"";const t=i.split("@")[0],r=ka(t);if(!e)return r;const n=ka(e);return`${r}_${n}`}function sM(){const{projectId:i}=Rg(),e=Bg(),{user:t,branding:r}=Og(),[n,s]=H.useState(null),[l,o]=H.useState(!0),[,a]=H.useState([]),[c,u]=H.useState(),[,h]=H.useState([]),[f,d]=H.useState(),[_]=H.useState("ai_dev_kit"),[y,p]=H.useState(""),[m,g]=H.useState(""),[v,b]=H.useState(!1),[S,x]=H.useState([]),[k,w]=H.useState(!1),[E,A]=H.useState(new Map),[T,B]=H.useState("explorer"),[O,N]=H.useState(200),[j,z]=H.useState(450),[$,q]=H.useState(!0),[M,C]=H.useState(300),[I,F]=H.useState(!1),[R,X]=H.useState("terminal"),[ie]=H.useState([]),[re,P]=H.useState(!1),[L,K]=H.useState(iM("main")),[W,Q]=H.useState({main:{tabs:[],activeTabPath:void 0}}),[Y,ge]=H.useState("main"),[Be,De]=H.useState(!1),[Ue,ce]=H.useState(!1),Ht=H.useMemo(()=>nM(t,(n==null?void 0:n.name)??null),[t,n==null?void 0:n.name]),vi=W[Y]||{activeTabPath:void 0},_i=H.useMemo(()=>[{id:"file.save",label:"Save File",shortcut:"Cmd+S",category:ci.FILE,action:()=>Xe()},{id:"file.quickOpen",label:"Go to File",shortcut:"Cmd+P",category:ci.FILE,action:()=>ce(!0)},{id:"view.toggleClaude",label:"Toggle Claude Terminal",shortcut:"Cmd+Shift+C",category:ci.VIEW,action:()=>q(ee=>!ee)},{id:"view.toggleTerminal",label:"Toggle Terminal",shortcut:"Cmd+`",category:ci.TERMINAL,action:()=>{F(ee=>!ee),I||X("terminal")}},{id:"view.toggleExplorer",label:"Toggle Explorer",shortcut:"Cmd+Shift+E",category:ci.VIEW,action:()=>B(ee=>ee==="explorer"?null:"explorer")},{id:"search.global",label:"Search in Files",shortcut:"Cmd+Shift+F",category:ci.SEARCH,action:()=>B("search")},{id:"editor.splitRight",label:"Split Editor Right",category:ci.VIEW,action:()=>de("horizontal")},{id:"editor.splitDown",label:"Split Editor Down",category:ci.VIEW,action:()=>de("vertical")},{id:"view.skills",label:"View System Prompt & Skills",category:ci.VIEW,action:()=>b(!0)}],[I]);rM([xf("s",()=>Xe()),xf("p",()=>ce(!0)),fs("p",()=>De(!0)),fs("f",()=>B("search")),fs("e",()=>B(ee=>ee==="explorer"?null:"explorer")),fs("c",()=>q(ee=>!ee)),{key:"`",meta:!0,action:()=>{F(ee=>!ee),I||X("terminal")}}]),H.useEffect(()=>{if(!i)return;(async()=>{try{o(!0);const[fe,ve,we,ct]=await Promise.all([Hg(i),jg().catch(()=>[]),zg().catch(()=>[]),Fn(i).catch(()=>[])]);s(fe),a(ve),h(we),x(ct),ve.length>0&&u(ve[0].cluster_id),we.length>0&&d(we[0].warehouse_id)}catch(fe){console.error("Failed to load project:",fe),Ct.error("Failed to load project"),e("/")}finally{o(!1)}})()},[i,e]),H.useEffect(()=>{Ht&&!y&&p(Ht)},[Ht,y]),H.useEffect(()=>{if(t&&(n!=null&&n.name)&&!m){const ee=ka(n.name);g(`/Workspace/Users/${t}/ai_dev_kit/${ee}`)}},[t,n==null?void 0:n.name,m]),H.useEffect(()=>{document.title=n!=null&&n.name?`${n.name} - ${r.app_title}`:r.app_title},[n==null?void 0:n.name,r.app_title]);const Lt=H.useCallback(async(ee,fe)=>{const ve=fe||Y,we=W[ve]||{tabs:[],activeTabPath:void 0};if(we.tabs.find(Oe=>Oe.path===ee)){Q(Oe=>({...Oe,[ve]:{...we,activeTabPath:ee}}));return}if(i)try{let Oe;const ht=E.get(ee),Kt=ht?Date.now()-ht.timestamp:1/0;ht&&Kt<6e4?Oe=ht.content:(Oe=(await Pg(i,ee)).content,A(Cg=>{const Hr=new Map(Cg);if(Hr.size>=50){let xo=null,Tc=1/0;for(const[Eg,Rc]of Hr)Rc.timestamp<Tc&&(Tc=Rc.timestamp,xo=Eg);xo&&Hr.delete(xo)}return Hr.set(ee,{content:Oe,timestamp:Date.now()}),Hr}));const bo=ee.split("/").pop()||ee,kg={path:ee,name:bo,content:Oe,originalContent:Oe,isDirty:!1};Q(Lc=>({...Lc,[ve]:{tabs:[...we.tabs,kg],activeTabPath:ee}}))}catch(Oe){console.error("Failed to load file:",Oe),Ct.error("Failed to load file")}},[i,Y,W,E]),yi=H.useCallback((ee,fe,ve)=>{Q(we=>{const ct=we[ee];return ct?{...we,[ee]:{...ct,tabs:ct.tabs.map(Oe=>Oe.path===fe?{...Oe,content:ve,isDirty:ve!==Oe.originalContent}:Oe)}}:we})},[]),Xe=H.useCallback(async()=>{const ee=W[Y];if(!(ee!=null&&ee.activeTabPath)||!i)return;const fe=ee.tabs.find(ve=>ve.path===ee.activeTabPath);if(fe)try{await Ig(i,fe.path,fe.content),A(ve=>{const we=new Map(ve);return we.delete(fe.path),we}),Q(ve=>({...ve,[Y]:{...ee,tabs:ee.tabs.map(we=>we.path===fe.path?{...we,originalContent:we.content,isDirty:!1}:we)}})),Ct.success("File saved")}catch(ve){console.error("Failed to save file:",ve),Ct.error("Failed to save file")}},[i,Y,W]),ai=H.useCallback((ee,fe)=>{Q(ve=>{const we=ve[ee];return we?{...ve,[ee]:{...we,activeTabPath:fe}}:ve}),ge(ee)},[]),pt=H.useCallback((ee,fe)=>{Q(ve=>{const we=ve[ee];if(!we)return ve;const ct=we.tabs.filter(ht=>ht.path!==fe);let Oe=we.activeTabPath;return we.activeTabPath===fe&&(Oe=ct.length>0?ct[ct.length-1].path:void 0),{...ve,[ee]:{tabs:ct,activeTabPath:Oe}}})},[]),U=H.useCallback(async ee=>{if(i)try{await Ng(i,ee);const fe=await Fn(i);x(fe),Lt(ee),Ct.success("File created")}catch(fe){console.error("Failed to create file:",fe),Ct.error("Failed to create file")}},[i,Lt]),Z=H.useCallback(async ee=>{if(i)try{await Fg(i,ee);const fe=await Fn(i);x(fe),Q(ve=>{const we={...ve};for(const ct of Object.keys(we)){const Oe=we[ct];if(Oe.tabs.some(ht=>ht.path===ee)){const ht=Oe.tabs.filter(bo=>bo.path!==ee);let Kt=Oe.activeTabPath;Oe.activeTabPath===ee&&(Kt=ht.length>0?ht[ht.length-1].path:void 0),we[ct]={tabs:ht,activeTabPath:Kt}}}return we}),Ct.success("File deleted")}catch(fe){console.error("Failed to delete file:",fe),Ct.error("Failed to delete file")}},[i]),le=H.useCallback(async()=>{if(i){w(!0);try{const ee=await Fn(i);x(ee)}catch(ee){console.error("Failed to refresh files:",ee),Ct.error("Failed to refresh files")}finally{w(!1)}}},[i]),de=H.useCallback(ee=>{const fe=`pane-${Date.now()}`;K(ve=>Sa(ve,Y,ee,fe)),Q(ve=>({...ve,[fe]:{tabs:[],activeTabPath:void 0}})),ge(fe)},[Y]),_e=H.useCallback((ee,fe)=>{Lt(ee)},[Lt]),Ve=H.useCallback((ee,fe)=>{const ve=`diff://${ee}`,we=W[Y]||{tabs:[],activeTabPath:void 0};if(we.tabs.find(Kt=>Kt.path===ve)){Q(Kt=>({...Kt,[Y]:{...we,activeTabPath:ve}}));return}const Oe=`${ee.split("/").pop()||ee} (diff)`,ht={path:ve,name:Oe,content:fe,originalContent:fe,isDirty:!1};Q(Kt=>({...Kt,[Y]:{tabs:[...we.tabs,ht],activeTabPath:ve}}))},[Y,W]);if(l)return D.jsx(Pc,{projectName:n==null?void 0:n.name,children:D.jsx("div",{className:"flex h-full items-center justify-center",children:D.jsx(Di,{className:"h-8 w-8 animate-spin text-[var(--color-text-muted)]"})})});const ke=T==="explorer"?D.jsx(GD,{files:S,selectedPath:vi.activeTabPath,onFileSelect:Lt,onFileCreate:U,onFileDelete:Z,onRefresh:le,isLoading:k}):T==="search"&&i?D.jsx(Aw,{projectId:i,onResultSelect:_e}):T==="git"&&i?D.jsx(Dw,{projectId:i,onOpenDiff:Ve}):null,at=n!=null&&n.template?qg(n.template):void 0,ji=at==null?void 0:at.suggestedPrompts,zi=R==="terminal"&&i?D.jsx(Mw,{projectId:i}):R==="output"?D.jsx(Nw,{lines:ie}):R==="deploy"&&i?D.jsx("div",{className:"h-full overflow-hidden",children:D.jsx(QD,{projectId:i})}):R==="preview"&&i?D.jsx(YD,{projectId:i}):null,tt=i?D.jsx(Iw,{projectId:i,isMaximized:re,onToggleMaximize:()=>P(ee=>!ee),suggestedPrompts:ji,onFilesChanged:le}):null;return D.jsxs(Pc,{projectName:n==null?void 0:n.name,children:[D.jsx(X0,{activeActivity:T,onActivityChange:ee=>{B(ee),ee==="chat"&&(q(!0),B(null))},leftSidebar:ke,leftSidebarWidth:O,onLeftSidebarWidthChange:N,rightSidebar:tt,rightSidebarWidth:j,onRightSidebarWidthChange:z,isRightSidebarOpen:$,isClaudeMaximized:re,maximizedContent:tt,bottomPanel:zi,bottomPanelHeight:M,onBottomPanelHeightChange:C,isBottomPanelOpen:I,onBottomPanelToggle:()=>F(ee=>!ee),bottomPanelTab:R,onBottomPanelTabChange:X,children:D.jsx(tM,{layout:L,panes:W,focusedPaneId:Y,onLayoutChange:K,onPaneStateChange:(ee,fe)=>Q(ve=>({...ve,[ee]:{...ve[ee],...fe}})),onFocusPane:ge,onTabSelect:ai,onTabClose:pt,onContentChange:yi})}),D.jsx(ww,{isOpen:Be,onClose:()=>De(!1),commands:_i}),D.jsx(kw,{isOpen:Ue,onClose:()=>ce(!1),files:S,onFileSelect:Lt}),v&&i&&D.jsx(bw,{projectId:i,systemPromptParams:{clusterId:c,warehouseId:f,defaultCatalog:_,defaultSchema:y,workspaceFolder:m},onClose:()=>b(!1)})]})}const bM=Object.freeze(Object.defineProperty({__proto__:null,default:sM},Symbol.toStringTag,{value:"Module"}));export{se as A,hm as B,tg as C,js as D,G as E,D2 as F,mM as G,GC as H,Te as I,SC as J,bM as K,dM as L,hM as N,LC as P,Rt as T,fa as a,QC as b,vM as c,pM as d,Ze as e,a2 as f,GE as g,yM as h,_M as i,gM as j,xt as k,xe as l,rm as m,We as n,l2 as o,uM as p,nr as q,ho as r,WC as s,V as t,Wt as u,KC as v,no as w,fo as x,Ce as y,fr as z};
