const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Zm9NbnRR.js","assets/index-BREUsmx4.js","assets/index-0X5Glbc3.js","assets/index-8Tz0fV_0.css","assets/templates-B6pygOvF.js","assets/sparkles-CxY9L_iN.js","assets/index-DgVWXTC4.js","assets/index-BeoPZG9s.js","assets/index-_z-BZI0l.js","assets/index-8oghqiEM.js","assets/index-Bwy8i-v7.js","assets/index-ZopEsRrs.js","assets/index-CrNZRIoI.js"])))=>i.map(i=>d[i]);
var fh=i=>{throw TypeError(i)};var dh=(i,e,t)=>e.has(i)||fh("Cannot "+t);var rn=(i,e,t)=>(dh(i,e,"read from private field"),t?t.call(i):e.get(i)),ph=(i,e,t)=>e.has(i)?fh("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),mh=(i,e,t,r)=>(dh(i,e,"write to private field"),r?r.call(i,t):e.set(i,t),t);import{c as De,r as N,j as D,g as Sd,f as gh,d as z0,e as W0,h as vh,R as Xr,s as $0,_ as Di,t as Lt,i as Is,k as V0,l as U0,m as q0,u as K0,a as G0,n as X0,o as J0,p as Y0,q as ns,v as Q0,w as Z0,x as ev,y as tv}from"./index-0X5Glbc3.js";import{c as ue,G as wd,a as iv,L as Ni,X as Vn,F as Cd,b as Un,g as qn,d as rv,T as nv,B as sv,M as _h,e as ov}from"./templates-B6pygOvF.js";import{S as Wl,C as lv,a as So}from"./sparkles-CxY9L_iN.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const av=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],cv=De("arrow-down",av);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hv=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],uv=De("arrow-up",hv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fv=[["path",{d:"m2 16 4.039-9.69a.5.5 0 0 1 .923 0L11 16",key:"d5nyq2"}],["path",{d:"M22 9v7",key:"pvm9v3"}],["path",{d:"M3.304 13h6.392",key:"1q3zxz"}],["circle",{cx:"18.5",cy:"12.5",r:"3.5",key:"z97x68"}]],dv=De("case-sensitive",fv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pv=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],yh=De("check",pv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mv=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Kn=De("chevron-down",mv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gv=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],bh=De("circle-alert",gv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vv=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],_v=De("circle-x",vv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yv=[["path",{d:"M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3",key:"11bfej"}]],bv=De("command",yv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xv=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],kd=De("external-link",xv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sv=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],wv=De("eye",Sv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cv=[["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}]],Mr=De("file-code",Cv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kv=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],Ed=De("file-json",kv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ev=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],ar=De("file-text",Ev);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Av=[["path",{d:"M15 2a2 2 0 0 1 1.414.586l4 4A2 2 0 0 1 21 8v7a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z",key:"1vo8kb"}],["path",{d:"M15 2v4a2 2 0 0 0 2 2h4",key:"sud9ri"}],["path",{d:"M5 7a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h8a2 2 0 0 0 1.732-1",key:"l4dndm"}]],Dv=De("files",Av);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lv=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],Ad=De("folder-open",Lv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mv=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Tv=De("funnel",Mv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rv=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],xh=De("globe",Rv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pv=[["circle",{cx:"12",cy:"9",r:"1",key:"124mty"}],["circle",{cx:"19",cy:"9",r:"1",key:"1ruzo2"}],["circle",{cx:"5",cy:"9",r:"1",key:"1a8b28"}],["circle",{cx:"12",cy:"15",r:"1",key:"1e56xg"}],["circle",{cx:"19",cy:"15",r:"1",key:"1a92ep"}],["circle",{cx:"5",cy:"15",r:"1",key:"5r1jwy"}]],Dd=De("grip-horizontal",Pv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bv=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],Ld=De("grip-vertical",Bv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ov=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],Iv=De("history",Ov);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nv=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],Fv=De("maximize-2",Nv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hv=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],jv=De("minimize-2",Hv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zv=[["path",{d:"M5 12h14",key:"1ays0h"}]],Wv=De("minus",zv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $v=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Md=De("play",$v);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vv=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],$l=De("plus",Vv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uv=[["path",{d:"M17 3v10",key:"15fgeh"}],["path",{d:"m12.67 5.5 8.66 5",key:"1gpheq"}],["path",{d:"m12.67 10.5 8.66-5",key:"1dkfa6"}],["path",{d:"M9 17a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-2z",key:"swwfx4"}]],qv=De("regex",Uv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kv=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Ya=De("search",Kv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gv=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Xv=De("settings",Gv);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jv=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Yv=De("square",Jv);function Qv(i,e){const t=getComputedStyle(i),r=parseFloat(t.fontSize);return e*r}function Zv(i,e){const t=getComputedStyle(i.ownerDocument.body),r=parseFloat(t.fontSize);return e*r}function e_(i){return i/100*window.innerHeight}function t_(i){return i/100*window.innerWidth}function i_(i){switch(typeof i){case"number":return[i,"px"];case"string":{const e=parseFloat(i);return i.endsWith("%")?[e,"%"]:i.endsWith("px")?[e,"px"]:i.endsWith("rem")?[e,"rem"]:i.endsWith("em")?[e,"em"]:i.endsWith("vh")?[e,"vh"]:i.endsWith("vw")?[e,"vw"]:[e,"%"]}}}function ss({groupSize:i,panelElement:e,styleProp:t}){let r;const[n,s]=i_(t);switch(s){case"%":{r=n/100*i;break}case"px":{r=n;break}case"rem":{r=Zv(e,n);break}case"em":{r=Qv(e,n);break}case"vh":{r=e_(n);break}case"vw":{r=t_(n);break}}return r}function qt(i){return parseFloat(i.toFixed(3))}function Hr({group:i}){const{orientation:e,panels:t}=i;return t.reduce((r,n)=>(r+=e==="horizontal"?n.element.offsetWidth:n.element.offsetHeight,r),0)}function Vl(i){const{panels:e}=i,t=Hr({group:i});return t===0?e.map(r=>({collapsedSize:0,collapsible:r.panelConstraints.collapsible===!0,defaultSize:void 0,disabled:r.panelConstraints.disabled,minSize:0,maxSize:100,panelId:r.id})):e.map(r=>{const{element:n,panelConstraints:s}=r;let l=0;if(s.collapsedSize!==void 0){const h=ss({groupSize:t,panelElement:n,styleProp:s.collapsedSize});l=qt(h/t*100)}let o;if(s.defaultSize!==void 0){const h=ss({groupSize:t,panelElement:n,styleProp:s.defaultSize});o=qt(h/t*100)}let a=0;if(s.minSize!==void 0){const h=ss({groupSize:t,panelElement:n,styleProp:s.minSize});a=qt(h/t*100)}let c=100;if(s.maxSize!==void 0){const h=ss({groupSize:t,panelElement:n,styleProp:s.maxSize});c=qt(h/t*100)}return{collapsedSize:l,collapsible:s.collapsible===!0,defaultSize:o,disabled:s.disabled,minSize:a,maxSize:c,panelId:r.id}})}function Ae(i,e="Assertion error"){if(!i)throw Error(e)}function Ul(i,e){return Array.from(e).sort(i==="horizontal"?r_:n_)}function r_(i,e){const t=i.element.offsetLeft-e.element.offsetLeft;return t!==0?t:i.element.offsetWidth-e.element.offsetWidth}function n_(i,e){const t=i.element.offsetTop-e.element.offsetTop;return t!==0?t:i.element.offsetHeight-e.element.offsetHeight}function Td(i){return i!==null&&typeof i=="object"&&"nodeType"in i&&i.nodeType===Node.ELEMENT_NODE}function Rd(i,e){return{x:i.x>=e.left&&i.x<=e.right?0:Math.min(Math.abs(i.x-e.left),Math.abs(i.x-e.right)),y:i.y>=e.top&&i.y<=e.bottom?0:Math.min(Math.abs(i.y-e.top),Math.abs(i.y-e.bottom))}}function s_({orientation:i,rects:e,targetRect:t}){const r={x:t.x+t.width/2,y:t.y+t.height/2};let n,s=Number.MAX_VALUE;for(const l of e){const{x:o,y:a}=Rd(r,l),c=i==="horizontal"?o:a;c<s&&(s=c,n=l)}return Ae(n,"No rect found"),n}let os;function o_(){return os===void 0&&(typeof matchMedia=="function"?os=!!matchMedia("(pointer:coarse)").matches:os=!1),os}function Pd(i){const{element:e,orientation:t,panels:r,separators:n}=i,s=Ul(t,Array.from(e.children).filter(Td).map(y=>({element:y}))).map(({element:y})=>y),l=[];let o=!1,a=!1,c=-1,h=-1,u=0,f,d=[];{let y=-1;for(const _ of s)_.hasAttribute("data-panel")&&(y++,_.ariaDisabled===null&&(u++,c===-1&&(c=y),h=y))}if(u>1){let y=-1;for(const _ of s)if(_.hasAttribute("data-panel")){y++;const m=r.find(p=>p.element===_);if(m){if(f){const p=f.element.getBoundingClientRect(),g=_.getBoundingClientRect();let v;if(a){const b=t==="horizontal"?new DOMRect(p.right,p.top,0,p.height):new DOMRect(p.left,p.bottom,p.width,0),S=t==="horizontal"?new DOMRect(g.left,g.top,0,g.height):new DOMRect(g.left,g.top,g.width,0);switch(d.length){case 0:{v=[b,S];break}case 1:{const x=d[0],C=s_({orientation:t,rects:[p,g],targetRect:x.element.getBoundingClientRect()});v=[x,C===p?S:b];break}default:{v=d;break}}}else d.length?v=d:v=[t==="horizontal"?new DOMRect(p.right,g.top,g.left-p.right,g.height):new DOMRect(g.left,p.bottom,g.width,g.top-p.bottom)];for(const b of v){let S="width"in b?b:b.element.getBoundingClientRect();const x=o_()?i.resizeTargetMinimumSize.coarse:i.resizeTargetMinimumSize.fine;if(S.width<x){const w=x-S.width;S=new DOMRect(S.x-w/2,S.y,S.width+w,S.height)}if(S.height<x){const w=x-S.height;S=new DOMRect(S.x,S.y-w/2,S.width,S.height+w)}const C=y<=c||y>h;!o&&!C&&l.push({group:i,groupSize:Hr({group:i}),panels:[f,m],separator:"width"in b?void 0:b,rect:S}),o=!1}}a=!1,f=m,d=[]}}else if(_.hasAttribute("data-separator")){_.ariaDisabled!==null&&(o=!0);const m=n.find(p=>p.element===_);m?d.push(m):(f=void 0,d=[])}else a=!0}return l}var Pi;class l_{constructor(){ph(this,Pi,{})}addListener(e,t){const r=rn(this,Pi)[e];return r===void 0?rn(this,Pi)[e]=[t]:r.includes(t)||r.push(t),()=>{this.removeListener(e,t)}}emit(e,t){const r=rn(this,Pi)[e];if(r!==void 0)if(r.length===1)r[0].call(null,t);else{let n=!1,s=null;const l=Array.from(r);for(let o=0;o<l.length;o++){const a=l[o];try{a.call(null,t)}catch(c){s===null&&(n=!0,s=c)}}if(n)throw s}}removeAllListeners(){mh(this,Pi,{})}removeListener(e,t){const r=rn(this,Pi)[e];if(r!==void 0){const n=r.indexOf(t);n>=0&&r.splice(n,1)}}}Pi=new WeakMap;function ft(i,e,t=0){return Math.abs(qt(i)-qt(e))<=t}let Ot={cursorFlags:0,interactionState:{state:"inactive"},mountedGroups:new Map};const yi=new l_;function mt(){return Ot}function gt(i){const e=typeof i=="function"?i(Ot):i;if(Ot===e)return Ot;const t=Ot;return Ot={...Ot,...e},e.cursorFlags!==void 0&&yi.emit("cursorFlagsChange",Ot.cursorFlags),e.interactionState!==void 0&&yi.emit("interactionStateChange",Ot.interactionState),e.mountedGroups!==void 0&&(Ot.mountedGroups.forEach((r,n)=>{r.derivedPanelConstraints.forEach(s=>{if(s.collapsible){const{layout:l}=t.mountedGroups.get(n)??{};if(l){const o=ft(s.collapsedSize,r.layout[s.panelId]),a=ft(s.collapsedSize,l[s.panelId]);o&&!a&&(n.inMemoryLastExpandedPanelSizes[s.panelId]=l[s.panelId])}}})}),yi.emit("mountedGroupsChange",Ot.mountedGroups)),Ot}function a_(i,e,t){let r,n={x:1/0,y:1/0};for(const s of e){const l=Rd(t,s.rect);switch(i){case"horizontal":{l.x<=n.x&&(r=s,n=l);break}case"vertical":{l.y<=n.y&&(r=s,n=l);break}}}return r?{distance:n,hitRegion:r}:void 0}function c_(i){return i!==null&&typeof i=="object"&&"nodeType"in i&&i.nodeType===Node.DOCUMENT_FRAGMENT_NODE}function h_(i,e){if(i===e)throw new Error("Cannot compare node with itself");const t={a:Ch(i),b:Ch(e)};let r;for(;t.a.at(-1)===t.b.at(-1);)r=t.a.pop(),t.b.pop();Ae(r,"Stacking order can only be calculated for elements with a common ancestor");const n={a:wh(Sh(t.a)),b:wh(Sh(t.b))};if(n.a===n.b){const s=r.childNodes,l={a:t.a.at(-1),b:t.b.at(-1)};let o=s.length;for(;o--;){const a=s[o];if(a===l.a)return 1;if(a===l.b)return-1}}return Math.sign(n.a-n.b)}const u_=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function f_(i){const e=getComputedStyle(Bd(i)??i).display;return e==="flex"||e==="inline-flex"}function d_(i){const e=getComputedStyle(i);return!!(e.position==="fixed"||e.zIndex!=="auto"&&(e.position!=="static"||f_(i))||+e.opacity<1||"transform"in e&&e.transform!=="none"||"webkitTransform"in e&&e.webkitTransform!=="none"||"mixBlendMode"in e&&e.mixBlendMode!=="normal"||"filter"in e&&e.filter!=="none"||"webkitFilter"in e&&e.webkitFilter!=="none"||"isolation"in e&&e.isolation==="isolate"||u_.test(e.willChange)||e.webkitOverflowScrolling==="touch")}function Sh(i){let e=i.length;for(;e--;){const t=i[e];if(Ae(t,"Missing node"),d_(t))return t}return null}function wh(i){return i&&Number(getComputedStyle(i).zIndex)||0}function Ch(i){const e=[];for(;i;)e.push(i),i=Bd(i);return e}function Bd(i){const{parentNode:e}=i;return c_(e)?e.host:e}function p_(i,e){return i.x<e.x+e.width&&i.x+i.width>e.x&&i.y<e.y+e.height&&i.y+i.height>e.y}function m_({groupElement:i,hitRegion:e,pointerEventTarget:t}){if(!Td(t)||t.contains(i)||i.contains(t))return!0;if(h_(t,i)>0){let r=t;for(;r;){if(r.contains(i))return!0;if(p_(r.getBoundingClientRect(),e))return!1;r=r.parentElement}}return!0}function Qa(i,e){const t=[];return e.forEach((r,n)=>{if(n.disabled)return;const s=Pd(n),l=a_(n.orientation,s,{x:i.clientX,y:i.clientY});l&&l.distance.x<=0&&l.distance.y<=0&&m_({groupElement:n.element,hitRegion:l.hitRegion.rect,pointerEventTarget:i.target})&&t.push(l.hitRegion)}),t}function g_(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!=e[t])return!1;return!0}function oi(i,e){return ft(i,e)?0:i>e?1:-1}function kr({overrideDisabledPanels:i,panelConstraints:e,prevSize:t,size:r}){const{collapsedSize:n=0,collapsible:s,disabled:l,maxSize:o=100,minSize:a=0}=e;if(l&&!i)return t;if(oi(r,a)<0)if(s){const c=(n+a)/2;oi(r,c)<0?r=n:r=a}else r=a;return r=Math.min(o,r),r=qt(r),r}function En({delta:i,initialLayout:e,panelConstraints:t,pivotIndices:r,prevLayout:n,trigger:s}){if(ft(i,0))return e;const l=s==="imperative-api",o=Object.values(e),a=Object.values(n),c=[...o],[h,u]=r;Ae(h!=null,"Invalid first pivot index"),Ae(u!=null,"Invalid second pivot index");let f=0;switch(s){case"keyboard":{{const _=i<0?u:h,m=t[_];Ae(m,`Panel constraints not found for index ${_}`);const{collapsedSize:p=0,collapsible:g,minSize:v=0}=m;if(g){const b=o[_];if(Ae(b!=null,`Previous layout not found for panel index ${_}`),ft(b,p)){const S=v-b;oi(S,Math.abs(i))>0&&(i=i<0?0-S:S)}}}{const _=i<0?h:u,m=t[_];Ae(m,`No panel constraints found for index ${_}`);const{collapsedSize:p=0,collapsible:g,minSize:v=0}=m;if(g){const b=o[_];if(Ae(b!=null,`Previous layout not found for panel index ${_}`),ft(b,v)){const S=b-p;oi(S,Math.abs(i))>0&&(i=i<0?0-S:S)}}}break}default:{const _=i<0?u:h,m=t[_];Ae(m,`Panel constraints not found for index ${_}`);const p=o[_],{collapsible:g,collapsedSize:v,minSize:b}=m;if(g&&oi(p,b)<0)if(i>0){const S=b-v,x=S/2,C=p+i;oi(C,b)<0&&(i=oi(i,x)<=0?0:S)}else{const S=b-v,x=100-S/2,C=p-i;oi(C,b)<0&&(i=oi(100+i,x)>0?0:-S)}break}}{const _=i<0?1:-1;let m=i<0?u:h,p=0;for(;;){const v=o[m];Ae(v!=null,`Previous layout not found for panel index ${m}`);const b=kr({overrideDisabledPanels:l,panelConstraints:t[m],prevSize:v,size:100})-v;if(p+=b,m+=_,m<0||m>=t.length)break}const g=Math.min(Math.abs(i),Math.abs(p));i=i<0?0-g:g}{let _=i<0?h:u;for(;_>=0&&_<t.length;){const m=Math.abs(i)-Math.abs(f),p=o[_];Ae(p!=null,`Previous layout not found for panel index ${_}`);const g=p-m,v=kr({overrideDisabledPanels:l,panelConstraints:t[_],prevSize:p,size:g});if(!ft(p,v)&&(f+=p-v,c[_]=v,f.toFixed(3).localeCompare(Math.abs(i).toFixed(3),void 0,{numeric:!0})>=0))break;i<0?_--:_++}}if(g_(a,c))return n;{const _=i<0?u:h,m=o[_];Ae(m!=null,`Previous layout not found for panel index ${_}`);const p=m+f,g=kr({overrideDisabledPanels:l,panelConstraints:t[_],prevSize:m,size:p});if(c[_]=g,!ft(g,p)){let v=p-g,b=i<0?u:h;for(;b>=0&&b<t.length;){const S=c[b];Ae(S!=null,`Previous layout not found for panel index ${b}`);const x=S+v,C=kr({overrideDisabledPanels:l,panelConstraints:t[b],prevSize:S,size:x});if(ft(S,C)||(v-=C-S,c[b]=C),ft(v,0))break;i>0?b--:b++}}}const d=Object.values(c).reduce((_,m)=>m+_,0);if(!ft(d,100,.1))return n;const y=Object.keys(n);return c.reduce((_,m,p)=>(_[y[p]]=m,_),{})}function cr(i,e){if(Object.keys(i).length!==Object.keys(e).length)return!1;for(const t in i)if(e[t]===void 0||oi(i[t],e[t])!==0)return!1;return!0}function hr({layout:i,panelConstraints:e}){const t=Object.values(i),r=[...t],n=r.reduce((o,a)=>o+a,0);if(r.length!==e.length)throw Error(`Invalid ${e.length} panel layout: ${r.map(o=>`${o}%`).join(", ")}`);if(!ft(n,100)&&r.length>0)for(let o=0;o<e.length;o++){const a=r[o];Ae(a!=null,`No layout data found for index ${o}`);const c=100/n*a;r[o]=c}let s=0;for(let o=0;o<e.length;o++){const a=t[o];Ae(a!=null,`No layout data found for index ${o}`);const c=r[o];Ae(c!=null,`No layout data found for index ${o}`);const h=kr({overrideDisabledPanels:!0,panelConstraints:e[o],prevSize:a,size:c});c!=h&&(s+=c-h,r[o]=h)}if(!ft(s,0))for(let o=0;o<e.length;o++){const a=r[o];Ae(a!=null,`No layout data found for index ${o}`);const c=a+s,h=kr({overrideDisabledPanels:!0,panelConstraints:e[o],prevSize:a,size:c});if(a!==h&&(s-=h-a,r[o]=h,ft(s,0)))break}const l=Object.keys(i);return r.reduce((o,a,c)=>(o[l[c]]=a,o),{})}function Od({groupId:i,panelId:e}){const t=()=>{const{mountedGroups:o}=mt();for(const[a,{defaultLayoutDeferred:c,derivedPanelConstraints:h,layout:u,separatorToPanels:f}]of o)if(a.id===i)return{defaultLayoutDeferred:c,derivedPanelConstraints:h,group:a,layout:u,separatorToPanels:f};throw Error(`Group ${i} not found`)},r=()=>{const o=t().derivedPanelConstraints.find(a=>a.panelId===e);if(o!==void 0)return o;throw Error(`Panel constraints not found for Panel ${e}`)},n=()=>{const o=t().group.panels.find(a=>a.id===e);if(o!==void 0)return o;throw Error(`Layout not found for Panel ${e}`)},s=()=>{const o=t().layout[e];if(o!==void 0)return o;throw Error(`Layout not found for Panel ${e}`)},l=o=>{const a=s();if(o===a)return;const{defaultLayoutDeferred:c,derivedPanelConstraints:h,group:u,layout:f,separatorToPanels:d}=t(),y=u.panels.findIndex(g=>g.id===e),_=y===u.panels.length-1,m=En({delta:_?a-o:o-a,initialLayout:f,panelConstraints:h,pivotIndices:_?[y-1,y]:[y,y+1],prevLayout:f,trigger:"imperative-api"}),p=hr({layout:m,panelConstraints:h});cr(f,p)||gt(g=>({mountedGroups:new Map(g.mountedGroups).set(u,{defaultLayoutDeferred:c,derivedPanelConstraints:h,layout:p,separatorToPanels:d})}))};return{collapse:()=>{const{collapsible:o,collapsedSize:a}=r(),{mutableValues:c}=n(),h=s();o&&h!==a&&(c.expandToSize=h,l(a))},expand:()=>{const{collapsible:o,collapsedSize:a,minSize:c}=r(),{mutableValues:h}=n(),u=s();if(o&&u===a){let f=h.expandToSize??c;f===0&&(f=1),l(f)}},getSize:()=>{const{group:o}=t(),a=s(),{element:c}=n(),h=o.orientation==="horizontal"?c.offsetWidth:c.offsetHeight;return{asPercentage:a,inPixels:h}},isCollapsed:()=>{const{collapsible:o,collapsedSize:a}=r(),c=s();return o&&ft(a,c)},resize:o=>{if(s()!==o){let a;switch(typeof o){case"number":{const{group:c}=t(),h=Hr({group:c});a=qt(o/h*100);break}case"string":{a=parseFloat(o);break}}l(a)}}}}function kh(i){if(i.defaultPrevented)return;const{mountedGroups:e}=mt();Qa(i,e).forEach(t=>{if(t.separator){const r=t.panels.find(n=>n.panelConstraints.defaultSize!==void 0);if(r){const n=r.panelConstraints.defaultSize,s=Od({groupId:t.group.id,panelId:r.id});s&&n!==void 0&&(s.resize(n),i.preventDefault())}}})}function Ns(i){const{mountedGroups:e}=mt();for(const[t]of e)if(t.separators.some(r=>r.element===i))return t;throw Error("Could not find parent Group for separator element")}function Id({groupId:i}){const e=()=>{const{mountedGroups:t}=mt();for(const[r,n]of t)if(r.id===i)return{group:r,...n};throw Error(`Could not find Group with id "${i}"`)};return{getLayout(){const{defaultLayoutDeferred:t,layout:r}=e();return t?{}:r},setLayout(t){const{defaultLayoutDeferred:r,derivedPanelConstraints:n,group:s,layout:l,separatorToPanels:o}=e(),a=hr({layout:t,panelConstraints:n});if(r)return l;if(!cr(l,a)){gt(h=>({mountedGroups:new Map(h.mountedGroups).set(s,{defaultLayoutDeferred:r,derivedPanelConstraints:n,layout:a,separatorToPanels:o})}));const c=s.panels.map(({id:h})=>h).join(",");s.inMemoryLayouts[c]=a}return a}}}function Nd(i){const{mountedGroups:e}=mt(),t=e.get(i);return Ae(t,`Mounted Group ${i.id} not found`),t}function Yi(i,e){const t=Ns(i),r=Nd(t),n=t.separators.find(h=>h.element===i);Ae(n,"Matching separator not found");const s=r.separatorToPanels.get(n);Ae(s,"Matching panels not found");const l=s.map(h=>t.panels.indexOf(h)),o=Id({groupId:t.id}).getLayout(),a=En({delta:e,initialLayout:o,panelConstraints:r.derivedPanelConstraints,pivotIndices:l,prevLayout:o,trigger:"keyboard"}),c=hr({layout:a,panelConstraints:r.derivedPanelConstraints});cr(o,c)||gt(h=>({mountedGroups:new Map(h.mountedGroups).set(t,{defaultLayoutDeferred:r.defaultLayoutDeferred,derivedPanelConstraints:r.derivedPanelConstraints,layout:c,separatorToPanels:r.separatorToPanels})}))}function Eh(i){if(i.defaultPrevented)return;const e=i.currentTarget,t=Ns(e);if(!t.disabled)switch(i.key){case"ArrowDown":{i.preventDefault(),t.orientation==="vertical"&&Yi(e,5);break}case"ArrowLeft":{i.preventDefault(),t.orientation==="horizontal"&&Yi(e,-5);break}case"ArrowRight":{i.preventDefault(),t.orientation==="horizontal"&&Yi(e,5);break}case"ArrowUp":{i.preventDefault(),t.orientation==="vertical"&&Yi(e,-5);break}case"End":{i.preventDefault(),Yi(e,100);break}case"Enter":{i.preventDefault();const r=Ns(e),{derivedPanelConstraints:n,layout:s,separatorToPanels:l}=Nd(r),o=r.separators.find(u=>u.element===e);Ae(o,"Matching separator not found");const a=l.get(o);Ae(a,"Matching panels not found");const c=a[0],h=n.find(u=>u.panelId===c.id);if(Ae(h,"Panel metadata not found"),h.collapsible){const u=s[c.id],f=h.collapsedSize===u?r.inMemoryLastExpandedPanelSizes[c.id]??h.minSize:h.collapsedSize;Yi(e,f-u)}break}case"F6":{i.preventDefault();const r=Ns(e).separators.map(l=>l.element),n=Array.from(r).findIndex(l=>l===i.currentTarget);Ae(n!==null,"Index not found");const s=i.shiftKey?n>0?n-1:r.length-1:n+1<r.length?n+1:0;r[s].focus();break}case"Home":{i.preventDefault(),Yi(e,-100);break}}}function Ah(i){if(i.defaultPrevented||i.pointerType==="mouse"&&i.button>0)return;const{mountedGroups:e}=mt(),t=Qa(i,e),r=new Map;let n=!1;t.forEach(s=>{s.separator&&(n||(n=!0,s.separator.element.focus()));const l=e.get(s.group);l&&r.set(s.group,l.layout)}),gt({interactionState:{hitRegions:t,initialLayoutMap:r,pointerDownAtPoint:{x:i.clientX,y:i.clientY},state:"active"}}),t.length&&i.preventDefault()}const v_=i=>i,qo=()=>{},Fd=1,Hd=2,jd=4,zd=8,Dh=3,Lh=12;let ls;function Mh(){return ls===void 0&&(ls=!1,typeof window<"u"&&(window.navigator.userAgent.includes("Chrome")||window.navigator.userAgent.includes("Firefox"))&&(ls=!0)),ls}function __({cursorFlags:i,groups:e,state:t}){let r=0,n=0;switch(t){case"active":case"hover":e.forEach(s=>{if(!s.disableCursor)switch(s.orientation){case"horizontal":{r++;break}case"vertical":{n++;break}}})}if(!(r===0&&n===0)){switch(t){case"active":{if(i&&Mh()){const s=(i&Fd)!==0,l=(i&Hd)!==0,o=(i&jd)!==0,a=(i&zd)!==0;if(s)return o?"se-resize":a?"ne-resize":"e-resize";if(l)return o?"sw-resize":a?"nw-resize":"w-resize";if(o)return"s-resize";if(a)return"n-resize"}break}}return Mh()?r>0&&n>0?"move":r>0?"ew-resize":"ns-resize":r>0&&n>0?"grab":r>0?"col-resize":"row-resize"}}const Th=new WeakMap;function Za(i){if(i.defaultView===null||i.defaultView===void 0)return;let{prevStyle:e,styleSheet:t}=Th.get(i)??{};t===void 0&&(t=new i.defaultView.CSSStyleSheet,i.adoptedStyleSheets.push(t));const{cursorFlags:r,interactionState:n}=mt();switch(n.state){case"active":case"hover":{const s=__({cursorFlags:r,groups:n.hitRegions.map(o=>o.group),state:n.state}),l=`*, *:hover {cursor: ${s} !important; ${n.state==="active"?"touch-action: none;":""} }`;if(e===l)return;e=l,s?t.cssRules.length===0?t.insertRule(l):t.replaceSync(l):t.cssRules.length===1&&t.deleteRule(0);break}case"inactive":{e=void 0,t.cssRules.length===1&&t.deleteRule(0);break}}Th.set(i,{prevStyle:e,styleSheet:t})}function Wd({document:i,event:e,hitRegions:t,initialLayoutMap:r,mountedGroups:n,pointerDownAtPoint:s,prevCursorFlags:l}){let o=0;const a=new Map(n);t.forEach(h=>{const{group:u,groupSize:f}=h,{disableCursor:d,orientation:y,panels:_}=u;let m=0;s?y==="horizontal"?m=(e.clientX-s.x)/f*100:m=(e.clientY-s.y)/f*100:y==="horizontal"?m=e.clientX<0?-100:100:m=e.clientY<0?-100:100;const p=r.get(u),{defaultLayoutDeferred:g,derivedPanelConstraints:v,layout:b,separatorToPanels:S}=n.get(u)??{defaultLayoutDeferred:!1};if(v&&p&&b&&S){const x=En({delta:m,initialLayout:p,panelConstraints:v,pivotIndices:h.panels.map(C=>_.indexOf(C)),prevLayout:b,trigger:"mouse-or-touch"});if(cr(x,b)){if(m!==0&&!d)switch(y){case"horizontal":{o|=m<0?Fd:Hd;break}case"vertical":{o|=m<0?jd:zd;break}}}else{a.set(h.group,{defaultLayoutDeferred:g,derivedPanelConstraints:v,layout:x,separatorToPanels:S});const C=h.group.panels.map(({id:w})=>w).join(",");h.group.inMemoryLayouts[C]=x}}});let c=0;e.movementX===0?c|=l&Dh:c|=o&Dh,e.movementY===0?c|=l&Lh:c|=o&Lh,gt({cursorFlags:c,mountedGroups:a}),Za(i)}function Rh(i){const{cursorFlags:e,interactionState:t,mountedGroups:r}=mt();switch(t.state){case"active":Wd({document:i.currentTarget,event:i,hitRegions:t.hitRegions,initialLayoutMap:t.initialLayoutMap,mountedGroups:r,prevCursorFlags:e})}}function Ph(i){if(i.defaultPrevented)return;const{cursorFlags:e,interactionState:t,mountedGroups:r}=mt();switch(t.state){case"active":{if(i.buttons===0){gt(n=>n.interactionState.state==="inactive"?n:{cursorFlags:0,interactionState:{state:"inactive"}}),gt(n=>({mountedGroups:new Map(n.mountedGroups)}));return}Wd({document:i.currentTarget,event:i,hitRegions:t.hitRegions,initialLayoutMap:t.initialLayoutMap,mountedGroups:r,pointerDownAtPoint:t.pointerDownAtPoint,prevCursorFlags:e});break}default:{const n=Qa(i,r);n.length===0?t.state!=="inactive"&&gt({interactionState:{state:"inactive"}}):gt({interactionState:{hitRegions:n,state:"hover"}}),Za(i.currentTarget);break}}}function Bh(i){if(i.relatedTarget instanceof HTMLIFrameElement){const{interactionState:e}=mt();switch(e.state){case"hover":gt({interactionState:{state:"inactive"}})}}}function Oh(i){if(i.defaultPrevented||i.pointerType==="mouse"&&i.button>0)return;const{interactionState:e}=mt();switch(e.state){case"active":gt({cursorFlags:0,interactionState:{state:"inactive"}}),e.hitRegions.length>0&&(Za(i.currentTarget),gt(t=>({mountedGroups:new Map(t.mountedGroups)})),i.preventDefault())}}function Ih(i){let e=0,t=0;const r={};for(const s of i)if(s.defaultSize!==void 0){e++;const l=qt(s.defaultSize);t+=l,r[s.panelId]=l}else r[s.panelId]=void 0;const n=i.length-e;if(n!==0){const s=qt((100-t)/n);for(const l of i)l.defaultSize===void 0&&(r[l.panelId]=s)}return r}function y_(i,e,t){if(!t[0])return;const r=i.panels.find(a=>a.element===e);if(!r||!r.onResize)return;const n=Hr({group:i}),s=i.orientation==="horizontal"?r.element.offsetWidth:r.element.offsetHeight,l=r.mutableValues.prevSize,o={asPercentage:qt(s/n*100),inPixels:s};r.mutableValues.prevSize=o,r.onResize(o,r.id,l)}function b_(i,e){if(Object.keys(i).length!==Object.keys(e).length)return!1;for(const t in i)if(i[t]!==e[t])return!1;return!0}function x_(i,e){const t=i.map(n=>n.id),r=Object.keys(e);if(t.length!==r.length)return!1;for(const n of t)if(!r.includes(n))return!1;return!0}const _r=new Map;function S_(i){let e=!0;Ae(i.element.ownerDocument.defaultView,"Cannot register an unmounted Group");const t=i.element.ownerDocument.defaultView.ResizeObserver,r=new Set,n=new Set,s=new t(y=>{for(const _ of y){const{borderBoxSize:m,target:p}=_;if(p===i.element){if(e){if(Hr({group:i})===0)return;gt(g=>{const v=g.mountedGroups.get(i);if(v){const b=Vl(i),S=v.defaultLayoutDeferred?Ih(b):v.layout,x=hr({layout:S,panelConstraints:b});return!v.defaultLayoutDeferred&&cr(S,x)&&b_(v.derivedPanelConstraints,b)?g:{mountedGroups:new Map(g.mountedGroups).set(i,{defaultLayoutDeferred:!1,derivedPanelConstraints:b,layout:x,separatorToPanels:v.separatorToPanels})}}return g})}}else y_(i,p,m)}});s.observe(i.element),i.panels.forEach(y=>{Ae(!r.has(y.id),`Panel ids must be unique; id "${y.id}" was used more than once`),r.add(y.id),y.onResize&&s.observe(y.element)});const l=Hr({group:i}),o=Vl(i),a=i.panels.map(({id:y})=>y).join(",");let c=i.defaultLayout;c&&(x_(i.panels,c)||(c=void 0));const h=i.inMemoryLayouts[a]??c??Ih(o),u=hr({layout:h,panelConstraints:o}),f=Pd(i),d=i.element.ownerDocument;return gt(y=>{const _=new Map;return _r.set(d,(_r.get(d)??0)+1),f.forEach(m=>{m.separator&&_.set(m.separator,m.panels)}),{mountedGroups:new Map(y.mountedGroups).set(i,{defaultLayoutDeferred:l===0,derivedPanelConstraints:o,layout:u,separatorToPanels:_})}}),i.separators.forEach(y=>{Ae(!n.has(y.id),`Separator ids must be unique; id "${y.id}" was used more than once`),n.add(y.id),y.element.addEventListener("keydown",Eh)}),_r.get(d)===1&&(d.addEventListener("dblclick",kh,!0),d.addEventListener("pointerdown",Ah,!0),d.addEventListener("pointerleave",Rh),d.addEventListener("pointermove",Ph),d.addEventListener("pointerout",Bh),d.addEventListener("pointerup",Oh,!0)),function(){e=!1,_r.set(d,Math.max(0,(_r.get(d)??0)-1)),gt(y=>{const _=new Map(y.mountedGroups);return _.delete(i),{mountedGroups:_}}),i.separators.forEach(y=>{y.element.removeEventListener("keydown",Eh)}),_r.get(d)||(d.removeEventListener("dblclick",kh,!0),d.removeEventListener("pointerdown",Ah,!0),d.removeEventListener("pointerleave",Rh),d.removeEventListener("pointermove",Ph),d.removeEventListener("pointerout",Bh),d.removeEventListener("pointerup",Oh,!0)),s.disconnect()}}function w_(){const[i,e]=N.useState({}),t=N.useCallback(()=>e({}),[]);return[i,t]}function ec(i){const e=N.useId();return`${i??e}`}const mr=typeof window<"u"?N.useLayoutEffect:N.useEffect;function gn(i){const e=N.useRef(i);return mr(()=>{e.current=i},[i]),N.useCallback((...t)=>{var r;return(r=e.current)==null?void 0:r.call(e,...t)},[e])}function tc(...i){return gn(e=>{i.forEach(t=>{if(t)switch(typeof t){case"function":{t(e);break}case"object":{t.current=e;break}}})})}function ic(i){const e=N.useRef({...i});return mr(()=>{for(const t in i)e.current[t]=i[t]},[i]),e.current}const $d=N.createContext(null);function C_(i,e){const t=N.useRef({getLayout:()=>({}),setLayout:v_});N.useImperativeHandle(e,()=>t.current,[]),mr(()=>{Object.assign(t.current,Id({groupId:i}))})}function ql({children:i,className:e,defaultLayout:t,disableCursor:r,disabled:n,elementRef:s,groupRef:l,id:o,onLayoutChange:a,onLayoutChanged:c,orientation:h="horizontal",resizeTargetMinimumSize:u={coarse:20,fine:10},style:f,...d}){const y=N.useRef({onLayoutChange:{},onLayoutChanged:{}}),_=gn(M=>{cr(y.current.onLayoutChange,M)||(y.current.onLayoutChange=M,a==null||a(M))}),m=gn(M=>{cr(y.current.onLayoutChanged,M)||(y.current.onLayoutChanged=M,c==null||c(M))}),p=ec(o),g=N.useRef(null),[v,b]=w_(),S=N.useRef({lastExpandedPanelSizes:{},layouts:{},panels:[],resizeTargetMinimumSize:u,separators:[]}),x=tc(g,s);C_(p,l);const C=gn((M,T)=>{const{interactionState:B,mountedGroups:F}=mt();for(const j of F.keys())if(j.id===M){const z=F.get(j);if(z){let $=!1;switch(B.state){case"active":{$=B.hitRegions.some(V=>V.group===j);break}}return{flexGrow:z.layout[T]??1,pointerEvents:$?"none":void 0}}}return{flexGrow:(t==null?void 0:t[T])??1}}),w=ic({defaultLayout:t,disableCursor:r}),E=N.useMemo(()=>({get disableCursor(){return!!w.disableCursor},getPanelStyles:C,id:p,orientation:h,registerPanel:M=>{const T=S.current;return T.panels=Ul(h,[...T.panels,M]),b(),()=>{T.panels=T.panels.filter(B=>B!==M),b()}},registerSeparator:M=>{const T=S.current;return T.separators=Ul(h,[...T.separators,M]),b(),()=>{T.separators=T.separators.filter(B=>B!==M),b()}},togglePanelDisabled:(M,T)=>{const B=S.current.panels.find(j=>j.id===M);B&&(B.panelConstraints.disabled=T);const{mountedGroups:F}=mt();for(const j of F.keys())if(j.id===p){const z=F.get(j);z&&(z.derivedPanelConstraints=Vl(j))}},toggleSeparatorDisabled:(M,T)=>{const B=S.current.separators.find(F=>F.id===M);B&&(B.disabled=T)}}),[C,p,b,h,w]),A=N.useRef(null);return mr(()=>{const M=g.current;if(M===null)return;const T=S.current;let B;if(w.defaultLayout!==void 0&&Object.keys(w.defaultLayout).length===T.panels.length){B={};for(const L of T.panels){const k=w.defaultLayout[L.id];k!==void 0&&(B[L.id]=k)}}const F={defaultLayout:B,disableCursor:!!w.disableCursor,disabled:!!n,element:M,id:p,inMemoryLastExpandedPanelSizes:S.current.lastExpandedPanelSizes,inMemoryLayouts:S.current.layouts,orientation:h,panels:T.panels,resizeTargetMinimumSize:T.resizeTargetMinimumSize,separators:T.separators};A.current=F;const j=S_(F),z=mt().mountedGroups.get(F);if(z){const{defaultLayoutDeferred:L,derivedPanelConstraints:k,layout:I}=z;!L&&k.length>0&&(_(I),m(I))}const $=yi.addListener("interactionStateChange",L=>{L.state}),V=yi.addListener("mountedGroupsChange",L=>{const k=L.get(F);if(k){const{defaultLayoutDeferred:I,derivedPanelConstraints:H,layout:P}=k;if(I||H.length===0)return;const{interactionState:X}=mt(),ee=X.state!=="active";_(P),ee&&m(P)}});return()=>{A.current=null,j(),$(),V()}},[n,p,m,_,h,v,w]),N.useEffect(()=>{const M=A.current;M&&(M.defaultLayout=t,M.disableCursor=!!r)}),D.jsx($d.Provider,{value:E,children:D.jsx("div",{...d,className:e,"data-group":!0,"data-testid":p,id:p,ref:x,style:{height:"100%",width:"100%",overflow:"hidden",...f,display:"flex",flexDirection:h==="horizontal"?"row":"column",flexWrap:"nowrap"},children:i})})}ql.displayName="Group";function rc(){const i=N.useContext($d);return Ae(i,"Group Context not found; did you render a Panel or Separator outside of a Group?"),i}function k_(i,e){const{id:t}=rc(),r=N.useRef({collapse:qo,expand:qo,getSize:()=>({asPercentage:0,inPixels:0}),isCollapsed:()=>!1,resize:qo});N.useImperativeHandle(e,()=>r.current,[]),mr(()=>{Object.assign(r.current,Od({groupId:t,panelId:i}))})}function xr({children:i,className:e,collapsedSize:t="0%",collapsible:r=!1,defaultSize:n,disabled:s,elementRef:l,id:o,maxSize:a="100%",minSize:c="0%",onResize:h,panelRef:u,style:f,...d}){const y=!!o,_=ec(o),m=ic({disabled:s}),p=N.useRef(null),g=tc(p,l),{getPanelStyles:v,id:b,registerPanel:S,togglePanelDisabled:x}=rc(),C=h!==null,w=gn((A,M,T)=>{h==null||h(A,o,T)});mr(()=>{const A=p.current;if(A!==null){const M={element:A,id:_,idIsStable:y,mutableValues:{expandToSize:void 0,prevSize:void 0},onResize:C?w:void 0,panelConstraints:{collapsedSize:t,collapsible:r,defaultSize:n,disabled:m.disabled,maxSize:a,minSize:c}};return S(M)}},[t,r,n,C,_,y,a,c,w,S,m]),N.useEffect(()=>{x(_,!!s)},[s,_,x]),k_(_,u);const E=N.useSyncExternalStore(A=>(yi.addListener("mountedGroupsChange",A),()=>{yi.removeListener("mountedGroupsChange",A)}),()=>JSON.stringify(v(b,_)),()=>JSON.stringify(v(b,_)));return D.jsx("div",{...d,"aria-disabled":s||void 0,"data-panel":!0,"data-testid":_,id:_,ref:g,style:{...E_,display:"flex",flexBasis:0,flexShrink:1,overflow:"hidden",...JSON.parse(E)},children:D.jsx("div",{className:e,style:{maxHeight:"100%",maxWidth:"100%",flexGrow:1,...f},children:i})})}xr.displayName="Panel";const E_={minHeight:0,maxHeight:"100%",height:"auto",minWidth:0,maxWidth:"100%",width:"auto",border:"none",borderWidth:0,padding:0,margin:0};function A_(){return N.useRef(null)}function D_({layout:i,panelConstraints:e,panelId:t,panelIndex:r}){let n,s;const l=i[t],o=e.find(a=>a.panelId===t);if(o){const a=o.maxSize,c=o.collapsible?o.collapsedSize:o.minSize,h=[r,r+1];s=hr({layout:En({delta:c-l,initialLayout:i,panelConstraints:e,pivotIndices:h,prevLayout:i}),panelConstraints:e})[t],n=hr({layout:En({delta:a-l,initialLayout:i,panelConstraints:e,pivotIndices:h,prevLayout:i}),panelConstraints:e})[t]}return{valueControls:t,valueMax:n,valueMin:s,valueNow:l}}function nc({children:i,className:e,disabled:t,elementRef:r,id:n,style:s,...l}){const o=ec(n),a=ic({disabled:t}),[c,h]=N.useState({}),[u,f]=N.useState("inactive"),d=N.useRef(null),y=tc(d,r),{disableCursor:_,id:m,orientation:p,registerSeparator:g,toggleSeparatorDisabled:v}=rc(),b=p==="horizontal"?"vertical":"horizontal";mr(()=>{const x=d.current;if(x!==null){const C={disabled:a.disabled,element:x,id:o},w=g(C),E=yi.addListener("interactionStateChange",M=>{f(M.state!=="inactive"&&M.hitRegions.some(T=>T.separator===C)?M.state:"inactive")}),A=yi.addListener("mountedGroupsChange",M=>{M.forEach(({derivedPanelConstraints:T,layout:B,separatorToPanels:F},j)=>{if(j.id===m){const z=F.get(C);if(z){const $=z[0],V=j.panels.indexOf($);h(D_({layout:B,panelConstraints:T,panelId:$.id,panelIndex:V}))}}})});return()=>{E(),A(),w()}}},[m,o,g,a]),N.useEffect(()=>{v(o,!!t)},[t,o,v]);let S;return t&&!_&&(S="not-allowed"),D.jsx("div",{...l,"aria-controls":c.valueControls,"aria-disabled":t||void 0,"aria-orientation":b,"aria-valuemax":c.valueMax,"aria-valuemin":c.valueMin,"aria-valuenow":c.valueNow,children:i,className:e,"data-separator":t?"disabled":u,"data-testid":o,id:o,ref:y,role:"separator",style:{flexBasis:"auto",cursor:S,...s,flexGrow:0,flexShrink:0},tabIndex:t?void 0:0})}nc.displayName="Separator";const L_=[{id:"explorer",icon:Dv,label:"Explorer"},{id:"search",icon:Ya,label:"Search"},{id:"git",icon:wd,label:"Source Control"},{id:"chat",icon:iv,label:"Chat"}];function M_({activeActivity:i,onActivityChange:e,className:t=""}){const r=n=>{e(i===n?null:n)};return D.jsxs("div",{className:ue("flex flex-col w-12 bg-[var(--color-bg-secondary)] border-r border-[var(--color-border)]",t),children:[D.jsx("div",{className:"flex flex-col",children:L_.map(n=>{const s=n.icon,l=i===n.id;return D.jsxs("button",{onClick:()=>r(n.id),className:ue("relative flex items-center justify-center h-12 w-12 transition-colors",l?"text-[var(--color-text-primary)]":"text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)]"),title:n.label,children:[l&&D.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-0.5 h-6 bg-[var(--color-accent-primary)]"}),D.jsx(s,{className:"h-5 w-5"})]},n.id)})}),D.jsx("div",{className:"flex-1"}),D.jsx("div",{className:"flex flex-col",children:D.jsx("button",{className:"flex items-center justify-center h-12 w-12 text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors",title:"Settings",children:D.jsx(Xv,{className:"h-5 w-5"})})})]})}function Nh({className:i}){return D.jsx(nc,{className:ue("w-1 bg-[var(--color-border)] hover:bg-[var(--color-accent-primary)]/50 flex items-center justify-center transition-colors",i),children:D.jsx(Ld,{className:"h-4 w-4 text-[var(--color-text-muted)]"})})}function T_({className:i}){return D.jsx(nc,{className:ue("h-1 bg-[var(--color-border)] hover:bg-[var(--color-accent-primary)]/50 flex items-center justify-center transition-colors",i),children:D.jsx(Dd,{className:"h-4 w-4 text-[var(--color-text-muted)]"})})}function R_({isOpen:i,onToggle:e,activeTab:t,onTabChange:r}){const n=[{id:"terminal",label:"Terminal"},{id:"output",label:"Output"},{id:"deploy",label:"Deploy"},{id:"preview",label:"Preview"}];return D.jsxs("div",{className:"flex items-center h-8 px-2 bg-[var(--color-bg-secondary)] border-b border-[var(--color-border)]",children:[D.jsx("div",{className:"flex items-center gap-1",children:n.map(s=>D.jsx("button",{onClick:()=>{r(s.id),i||e()},className:ue("px-2 py-1 text-xs font-medium rounded transition-colors",t===s.id&&i?"bg-[var(--color-bg-tertiary)] text-[var(--color-text-heading)]":"text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)]"),children:s.label},s.id))}),D.jsx("div",{className:"flex-1"}),D.jsx("button",{onClick:e,className:"p-1 text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors",children:i?"▼":"▲"})]})}function P_({activeActivity:i,onActivityChange:e,leftSidebar:t,leftSidebarWidth:r=200,onLeftSidebarWidthChange:n,children:s,rightSidebar:l,rightSidebarWidth:o=320,onRightSidebarWidthChange:a,isRightSidebarOpen:c=!0,bottomPanel:h,bottomPanelHeight:u=200,onBottomPanelHeightChange:f,isBottomPanelOpen:d=!1,onBottomPanelToggle:y,isClaudeMaximized:_=!1,maximizedContent:m,bottomPanelTab:p="terminal",onBottomPanelTabChange:g,className:v=""}){const b=A_(),S=i==="explorer"||i==="search"||i==="git",x=r/1200*100,C=o/1200*100,w=N.useCallback(T=>{n&&n(Math.round(T.inPixels))},[n]),E=N.useCallback(T=>{a&&a(Math.round(T.inPixels))},[a]),A=N.useCallback(T=>{f&&f(Math.round(T.inPixels))},[f]),M=N.useCallback(()=>{y&&y();const T=b.current;T&&(d?T.collapse():T.expand())},[d,y,b]);return D.jsxs("div",{className:ue("flex h-full ide-layout-container",v),children:[D.jsx(M_,{activeActivity:i,onActivityChange:e}),D.jsxs(ql,{orientation:"horizontal",className:"flex-1",children:[S&&t&&D.jsxs(D.Fragment,{children:[D.jsx(xr,{id:"left-sidebar",defaultSize:x,minSize:10,maxSize:30,onResize:w,className:"overflow-hidden",children:D.jsx("div",{className:"h-full border-r border-[var(--color-border)]",children:t})}),D.jsx(Nh,{})]}),D.jsx(xr,{id:"main-content",defaultSize:100-x-C,minSize:30,children:D.jsxs(ql,{orientation:"vertical",children:[D.jsx(xr,{id:"editor",defaultSize:d?70:100,minSize:20,children:D.jsx("div",{className:"h-full overflow-hidden",children:_&&m?m:s})}),!_&&h&&y&&g&&D.jsxs(D.Fragment,{children:[D.jsx(T_,{}),D.jsx(xr,{id:"bottom-panel",panelRef:b,defaultSize:d?30:0,minSize:0,maxSize:50,collapsible:!0,collapsedSize:0,onResize:A,children:D.jsxs("div",{className:"h-full flex flex-col bg-[var(--color-bg-secondary)]",children:[D.jsx(R_,{isOpen:d,onToggle:M,activeTab:p,onTabChange:g}),D.jsx("div",{className:"flex-1 overflow-hidden",children:h})]})})]})]})}),!_&&l&&c&&D.jsxs(D.Fragment,{children:[D.jsx(Nh,{}),D.jsx(xr,{id:"right-sidebar",defaultSize:C,minSize:15,maxSize:40,onResize:E,className:"overflow-hidden",children:D.jsx("div",{className:"h-full border-l border-[var(--color-border)]",children:l})})]})]})]})}function B_(i,e){const t={};return(i[i.length-1]===""?[...i,""]:i).join((t.padRight?" ":"")+","+(t.padLeft===!1?"":" ")).trim()}const O_=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,I_=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,N_={};function Fh(i,e){return(N_.jsx?I_:O_).test(i)}const F_=/[ \t\n\f\r]/g;function H_(i){return typeof i=="object"?i.type==="text"?Hh(i.value):!1:Hh(i)}function Hh(i){return i.replace(F_,"")===""}class Gn{constructor(e,t,r){this.normal=t,this.property=e,r&&(this.space=r)}}Gn.prototype.normal={};Gn.prototype.property={};Gn.prototype.space=void 0;function Vd(i,e){const t={},r={};for(const n of i)Object.assign(t,n.property),Object.assign(r,n.normal);return new Gn(t,r,e)}function Kl(i){return i.toLowerCase()}class Et{constructor(e,t){this.attribute=t,this.property=e}}Et.prototype.attribute="";Et.prototype.booleanish=!1;Et.prototype.boolean=!1;Et.prototype.commaOrSpaceSeparated=!1;Et.prototype.commaSeparated=!1;Et.prototype.defined=!1;Et.prototype.mustUseProperty=!1;Et.prototype.number=!1;Et.prototype.overloadedBoolean=!1;Et.prototype.property="";Et.prototype.spaceSeparated=!1;Et.prototype.space=void 0;let j_=0;const me=gr(),ze=gr(),Gl=gr(),J=gr(),Ie=gr(),Tr=gr(),Dt=gr();function gr(){return 2**++j_}const Xl=Object.freeze(Object.defineProperty({__proto__:null,boolean:me,booleanish:ze,commaOrSpaceSeparated:Dt,commaSeparated:Tr,number:J,overloadedBoolean:Gl,spaceSeparated:Ie},Symbol.toStringTag,{value:"Module"})),Ko=Object.keys(Xl);class sc extends Et{constructor(e,t,r,n){let s=-1;if(super(e,t),jh(this,"space",n),typeof r=="number")for(;++s<Ko.length;){const l=Ko[s];jh(this,Ko[s],(r&Xl[l])===Xl[l])}}}sc.prototype.defined=!0;function jh(i,e,t){t&&(i[e]=t)}function Jr(i){const e={},t={};for(const[r,n]of Object.entries(i.properties)){const s=new sc(r,i.transform(i.attributes||{},r),n,i.space);i.mustUseProperty&&i.mustUseProperty.includes(r)&&(s.mustUseProperty=!0),e[r]=s,t[Kl(r)]=r,t[Kl(s.attribute)]=r}return new Gn(e,t,i.space)}const Ud=Jr({properties:{ariaActiveDescendant:null,ariaAtomic:ze,ariaAutoComplete:null,ariaBusy:ze,ariaChecked:ze,ariaColCount:J,ariaColIndex:J,ariaColSpan:J,ariaControls:Ie,ariaCurrent:null,ariaDescribedBy:Ie,ariaDetails:null,ariaDisabled:ze,ariaDropEffect:Ie,ariaErrorMessage:null,ariaExpanded:ze,ariaFlowTo:Ie,ariaGrabbed:ze,ariaHasPopup:null,ariaHidden:ze,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Ie,ariaLevel:J,ariaLive:null,ariaModal:ze,ariaMultiLine:ze,ariaMultiSelectable:ze,ariaOrientation:null,ariaOwns:Ie,ariaPlaceholder:null,ariaPosInSet:J,ariaPressed:ze,ariaReadOnly:ze,ariaRelevant:null,ariaRequired:ze,ariaRoleDescription:Ie,ariaRowCount:J,ariaRowIndex:J,ariaRowSpan:J,ariaSelected:ze,ariaSetSize:J,ariaSort:null,ariaValueMax:J,ariaValueMin:J,ariaValueNow:J,ariaValueText:null,role:null},transform(i,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function qd(i,e){return e in i?i[e]:e}function Kd(i,e){return qd(i,e.toLowerCase())}const z_=Jr({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Tr,acceptCharset:Ie,accessKey:Ie,action:null,allow:null,allowFullScreen:me,allowPaymentRequest:me,allowUserMedia:me,alt:null,as:null,async:me,autoCapitalize:null,autoComplete:Ie,autoFocus:me,autoPlay:me,blocking:Ie,capture:null,charSet:null,checked:me,cite:null,className:Ie,cols:J,colSpan:null,content:null,contentEditable:ze,controls:me,controlsList:Ie,coords:J|Tr,crossOrigin:null,data:null,dateTime:null,decoding:null,default:me,defer:me,dir:null,dirName:null,disabled:me,download:Gl,draggable:ze,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:me,formTarget:null,headers:Ie,height:J,hidden:Gl,high:J,href:null,hrefLang:null,htmlFor:Ie,httpEquiv:Ie,id:null,imageSizes:null,imageSrcSet:null,inert:me,inputMode:null,integrity:null,is:null,isMap:me,itemId:null,itemProp:Ie,itemRef:Ie,itemScope:me,itemType:Ie,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:me,low:J,manifest:null,max:null,maxLength:J,media:null,method:null,min:null,minLength:J,multiple:me,muted:me,name:null,nonce:null,noModule:me,noValidate:me,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:me,optimum:J,pattern:null,ping:Ie,placeholder:null,playsInline:me,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:me,referrerPolicy:null,rel:Ie,required:me,reversed:me,rows:J,rowSpan:J,sandbox:Ie,scope:null,scoped:me,seamless:me,selected:me,shadowRootClonable:me,shadowRootDelegatesFocus:me,shadowRootMode:null,shape:null,size:J,sizes:null,slot:null,span:J,spellCheck:ze,src:null,srcDoc:null,srcLang:null,srcSet:null,start:J,step:null,style:null,tabIndex:J,target:null,title:null,translate:null,type:null,typeMustMatch:me,useMap:null,value:ze,width:J,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Ie,axis:null,background:null,bgColor:null,border:J,borderColor:null,bottomMargin:J,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:me,declare:me,event:null,face:null,frame:null,frameBorder:null,hSpace:J,leftMargin:J,link:null,longDesc:null,lowSrc:null,marginHeight:J,marginWidth:J,noResize:me,noHref:me,noShade:me,noWrap:me,object:null,profile:null,prompt:null,rev:null,rightMargin:J,rules:null,scheme:null,scrolling:ze,standby:null,summary:null,text:null,topMargin:J,valueType:null,version:null,vAlign:null,vLink:null,vSpace:J,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:me,disableRemotePlayback:me,prefix:null,property:null,results:J,security:null,unselectable:null},space:"html",transform:Kd}),W_=Jr({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Dt,accentHeight:J,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:J,amplitude:J,arabicForm:null,ascent:J,attributeName:null,attributeType:null,azimuth:J,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:J,by:null,calcMode:null,capHeight:J,className:Ie,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:J,diffuseConstant:J,direction:null,display:null,dur:null,divisor:J,dominantBaseline:null,download:me,dx:null,dy:null,edgeMode:null,editable:null,elevation:J,enableBackground:null,end:null,event:null,exponent:J,externalResourcesRequired:null,fill:null,fillOpacity:J,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Tr,g2:Tr,glyphName:Tr,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:J,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:J,horizOriginX:J,horizOriginY:J,id:null,ideographic:J,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:J,k:J,k1:J,k2:J,k3:J,k4:J,kernelMatrix:Dt,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:J,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:J,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:J,overlineThickness:J,paintOrder:null,panose1:null,path:null,pathLength:J,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Ie,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:J,pointsAtY:J,pointsAtZ:J,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Dt,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Dt,rev:Dt,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Dt,requiredFeatures:Dt,requiredFonts:Dt,requiredFormats:Dt,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:J,specularExponent:J,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:J,strikethroughThickness:J,string:null,stroke:null,strokeDashArray:Dt,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:J,strokeOpacity:J,strokeWidth:null,style:null,surfaceScale:J,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Dt,tabIndex:J,tableValues:null,target:null,targetX:J,targetY:J,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Dt,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:J,underlineThickness:J,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:J,values:null,vAlphabetic:J,vMathematical:J,vectorEffect:null,vHanging:J,vIdeographic:J,version:null,vertAdvY:J,vertOriginX:J,vertOriginY:J,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:J,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:qd}),Gd=Jr({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(i,e){return"xlink:"+e.slice(5).toLowerCase()}}),Xd=Jr({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:Kd}),Jd=Jr({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(i,e){return"xml:"+e.slice(3).toLowerCase()}}),$_={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},V_=/[A-Z]/g,zh=/-[a-z]/g,U_=/^data[-\w.:]+$/i;function q_(i,e){const t=Kl(e);let r=e,n=Et;if(t in i.normal)return i.property[i.normal[t]];if(t.length>4&&t.slice(0,4)==="data"&&U_.test(e)){if(e.charAt(4)==="-"){const s=e.slice(5).replace(zh,G_);r="data"+s.charAt(0).toUpperCase()+s.slice(1)}else{const s=e.slice(4);if(!zh.test(s)){let l=s.replace(V_,K_);l.charAt(0)!=="-"&&(l="-"+l),e="data"+l}}n=sc}return new n(r,e)}function K_(i){return"-"+i.toLowerCase()}function G_(i){return i.charAt(1).toUpperCase()}const X_=Vd([Ud,z_,Gd,Xd,Jd],"html"),oc=Vd([Ud,W_,Gd,Xd,Jd],"svg");function J_(i){return i.join(" ").trim()}var yr={},Go,Wh;function Y_(){if(Wh)return Go;Wh=1;var i=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,e=/\n/g,t=/^\s*/,r=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,n=/^:\s*/,s=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,l=/^[;\s]*/,o=/^\s+|\s+$/g,a=`
`,c="/",h="*",u="",f="comment",d="declaration";function y(m,p){if(typeof m!="string")throw new TypeError("First argument must be a string");if(!m)return[];p=p||{};var g=1,v=1;function b(F){var j=F.match(e);j&&(g+=j.length);var z=F.lastIndexOf(a);v=~z?F.length-z:v+F.length}function S(){var F={line:g,column:v};return function(j){return j.position=new x(F),E(),j}}function x(F){this.start=F,this.end={line:g,column:v},this.source=p.source}x.prototype.content=m;function C(F){var j=new Error(p.source+":"+g+":"+v+": "+F);if(j.reason=F,j.filename=p.source,j.line=g,j.column=v,j.source=m,!p.silent)throw j}function w(F){var j=F.exec(m);if(j){var z=j[0];return b(z),m=m.slice(z.length),j}}function E(){w(t)}function A(F){var j;for(F=F||[];j=M();)j!==!1&&F.push(j);return F}function M(){var F=S();if(!(c!=m.charAt(0)||h!=m.charAt(1))){for(var j=2;u!=m.charAt(j)&&(h!=m.charAt(j)||c!=m.charAt(j+1));)++j;if(j+=2,u===m.charAt(j-1))return C("End of comment missing");var z=m.slice(2,j-2);return v+=2,b(z),m=m.slice(j),v+=2,F({type:f,comment:z})}}function T(){var F=S(),j=w(r);if(j){if(M(),!w(n))return C("property missing ':'");var z=w(s),$=F({type:d,property:_(j[0].replace(i,u)),value:z?_(z[0].replace(i,u)):u});return w(l),$}}function B(){var F=[];A(F);for(var j;j=T();)j!==!1&&(F.push(j),A(F));return F}return E(),B()}function _(m){return m?m.replace(o,u):u}return Go=y,Go}var $h;function Q_(){if($h)return yr;$h=1;var i=yr&&yr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(yr,"__esModule",{value:!0}),yr.default=t;const e=i(Y_());function t(r,n){let s=null;if(!r||typeof r!="string")return s;const l=(0,e.default)(r),o=typeof n=="function";return l.forEach(a=>{if(a.type!=="declaration")return;const{property:c,value:h}=a;o?n(c,h,a):h&&(s=s||{},s[c]=h)}),s}return yr}var nn={},Vh;function Z_(){if(Vh)return nn;Vh=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.camelCase=void 0;var i=/^--[a-zA-Z0-9_-]+$/,e=/-([a-z])/g,t=/^[^-]+$/,r=/^-(webkit|moz|ms|o|khtml)-/,n=/^-(ms)-/,s=function(c){return!c||t.test(c)||i.test(c)},l=function(c,h){return h.toUpperCase()},o=function(c,h){return"".concat(h,"-")},a=function(c,h){return h===void 0&&(h={}),s(c)?c:(c=c.toLowerCase(),h.reactCompat?c=c.replace(n,o):c=c.replace(r,o),c.replace(e,l))};return nn.camelCase=a,nn}var sn,Uh;function ey(){if(Uh)return sn;Uh=1;var i=sn&&sn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}},e=i(Q_()),t=Z_();function r(n,s){var l={};return!n||typeof n!="string"||(0,e.default)(n,function(o,a){o&&a&&(l[(0,t.camelCase)(o,s)]=a)}),l}return r.default=r,sn=r,sn}var ty=ey();const iy=Sd(ty),Yd=Qd("end"),lc=Qd("start");function Qd(i){return e;function e(t){const r=t&&t.position&&t.position[i]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function ry(i){const e=lc(i),t=Yd(i);if(e&&t)return{start:e,end:t}}function vn(i){return!i||typeof i!="object"?"":"position"in i||"type"in i?qh(i.position):"start"in i||"end"in i?qh(i):"line"in i||"column"in i?Jl(i):""}function Jl(i){return Kh(i&&i.line)+":"+Kh(i&&i.column)}function qh(i){return Jl(i&&i.start)+"-"+Jl(i&&i.end)}function Kh(i){return i&&typeof i=="number"?i:1}class lt extends Error{constructor(e,t,r){super(),typeof t=="string"&&(r=t,t=void 0);let n="",s={},l=!1;if(t&&("line"in t&&"column"in t?s={place:t}:"start"in t&&"end"in t?s={place:t}:"type"in t?s={ancestors:[t],place:t.position}:s={...t}),typeof e=="string"?n=e:!s.cause&&e&&(l=!0,n=e.message,s.cause=e),!s.ruleId&&!s.source&&typeof r=="string"){const a=r.indexOf(":");a===-1?s.ruleId=r:(s.source=r.slice(0,a),s.ruleId=r.slice(a+1))}if(!s.place&&s.ancestors&&s.ancestors){const a=s.ancestors[s.ancestors.length-1];a&&(s.place=a.position)}const o=s.place&&"start"in s.place?s.place.start:s.place;this.ancestors=s.ancestors||void 0,this.cause=s.cause||void 0,this.column=o?o.column:void 0,this.fatal=void 0,this.file="",this.message=n,this.line=o?o.line:void 0,this.name=vn(s.place)||"1:1",this.place=s.place||void 0,this.reason=this.message,this.ruleId=s.ruleId||void 0,this.source=s.source||void 0,this.stack=l&&s.cause&&typeof s.cause.stack=="string"?s.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}lt.prototype.file="";lt.prototype.name="";lt.prototype.reason="";lt.prototype.message="";lt.prototype.stack="";lt.prototype.column=void 0;lt.prototype.line=void 0;lt.prototype.ancestors=void 0;lt.prototype.cause=void 0;lt.prototype.fatal=void 0;lt.prototype.place=void 0;lt.prototype.ruleId=void 0;lt.prototype.source=void 0;const ac={}.hasOwnProperty,ny=new Map,sy=/[A-Z]/g,oy=new Set(["table","tbody","thead","tfoot","tr"]),ly=new Set(["td","th"]),Zd="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function ay(i,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const t=e.filePath||void 0;let r;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=gy(t,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=my(t,e.jsx,e.jsxs)}const n={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:r,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:t,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?oc:X_,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},s=ep(n,i,void 0);return s&&typeof s!="string"?s:n.create(i,n.Fragment,{children:s||void 0},void 0)}function ep(i,e,t){if(e.type==="element")return cy(i,e,t);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return hy(i,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return fy(i,e,t);if(e.type==="mdxjsEsm")return uy(i,e);if(e.type==="root")return dy(i,e,t);if(e.type==="text")return py(i,e)}function cy(i,e,t){const r=i.schema;let n=r;e.tagName.toLowerCase()==="svg"&&r.space==="html"&&(n=oc,i.schema=n),i.ancestors.push(e);const s=ip(i,e.tagName,!1),l=vy(i,e);let o=hc(i,e);return oy.has(e.tagName)&&(o=o.filter(function(a){return typeof a=="string"?!H_(a):!0})),tp(i,l,s,e),cc(l,o),i.ancestors.pop(),i.schema=r,i.create(e,s,l,t)}function hy(i,e){if(e.data&&e.data.estree&&i.evaluater){const r=e.data.estree.body[0];return r.type,i.evaluater.evaluateExpression(r.expression)}An(i,e.position)}function uy(i,e){if(e.data&&e.data.estree&&i.evaluater)return i.evaluater.evaluateProgram(e.data.estree);An(i,e.position)}function fy(i,e,t){const r=i.schema;let n=r;e.name==="svg"&&r.space==="html"&&(n=oc,i.schema=n),i.ancestors.push(e);const s=e.name===null?i.Fragment:ip(i,e.name,!0),l=_y(i,e),o=hc(i,e);return tp(i,l,s,e),cc(l,o),i.ancestors.pop(),i.schema=r,i.create(e,s,l,t)}function dy(i,e,t){const r={};return cc(r,hc(i,e)),i.create(e,i.Fragment,r,t)}function py(i,e){return e.value}function tp(i,e,t,r){typeof t!="string"&&t!==i.Fragment&&i.passNode&&(e.node=r)}function cc(i,e){if(e.length>0){const t=e.length>1?e:e[0];t&&(i.children=t)}}function my(i,e,t){return r;function r(n,s,l,o){const c=Array.isArray(l.children)?t:e;return o?c(s,l,o):c(s,l)}}function gy(i,e){return t;function t(r,n,s,l){const o=Array.isArray(s.children),a=lc(r);return e(n,s,l,o,{columnNumber:a?a.column-1:void 0,fileName:i,lineNumber:a?a.line:void 0},void 0)}}function vy(i,e){const t={};let r,n;for(n in e.properties)if(n!=="children"&&ac.call(e.properties,n)){const s=yy(i,n,e.properties[n]);if(s){const[l,o]=s;i.tableCellAlignToStyle&&l==="align"&&typeof o=="string"&&ly.has(e.tagName)?r=o:t[l]=o}}if(r){const s=t.style||(t.style={});s[i.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return t}function _y(i,e){const t={};for(const r of e.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&i.evaluater){const s=r.data.estree.body[0];s.type;const l=s.expression;l.type;const o=l.properties[0];o.type,Object.assign(t,i.evaluater.evaluateExpression(o.argument))}else An(i,e.position);else{const n=r.name;let s;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&i.evaluater){const o=r.value.data.estree.body[0];o.type,s=i.evaluater.evaluateExpression(o.expression)}else An(i,e.position);else s=r.value===null?!0:r.value;t[n]=s}return t}function hc(i,e){const t=[];let r=-1;const n=i.passKeys?new Map:ny;for(;++r<e.children.length;){const s=e.children[r];let l;if(i.passKeys){const a=s.type==="element"?s.tagName:s.type==="mdxJsxFlowElement"||s.type==="mdxJsxTextElement"?s.name:void 0;if(a){const c=n.get(a)||0;l=a+"-"+c,n.set(a,c+1)}}const o=ep(i,s,l);o!==void 0&&t.push(o)}return t}function yy(i,e,t){const r=q_(i.schema,e);if(!(t==null||typeof t=="number"&&Number.isNaN(t))){if(Array.isArray(t)&&(t=r.commaSeparated?B_(t):J_(t)),r.property==="style"){let n=typeof t=="object"?t:by(i,String(t));return i.stylePropertyNameCase==="css"&&(n=xy(n)),["style",n]}return[i.elementAttributeNameCase==="react"&&r.space?$_[r.property]||r.property:r.attribute,t]}}function by(i,e){try{return iy(e,{reactCompat:!0})}catch(t){if(i.ignoreInvalidStyle)return{};const r=t,n=new lt("Cannot parse `style` attribute",{ancestors:i.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw n.file=i.filePath||void 0,n.url=Zd+"#cannot-parse-style-attribute",n}}function ip(i,e,t){let r;if(!t)r={type:"Literal",value:e};else if(e.includes(".")){const n=e.split(".");let s=-1,l;for(;++s<n.length;){const o=Fh(n[s])?{type:"Identifier",name:n[s]}:{type:"Literal",value:n[s]};l=l?{type:"MemberExpression",object:l,property:o,computed:!!(s&&o.type==="Literal"),optional:!1}:o}r=l}else r=Fh(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(r.type==="Literal"){const n=r.value;return ac.call(i.components,n)?i.components[n]:n}if(i.evaluater)return i.evaluater.evaluateExpression(r);An(i)}function An(i,e){const t=new lt("Cannot handle MDX estrees without `createEvaluater`",{ancestors:i.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw t.file=i.filePath||void 0,t.url=Zd+"#cannot-handle-mdx-estrees-without-createevaluater",t}function xy(i){const e={};let t;for(t in i)ac.call(i,t)&&(e[Sy(t)]=i[t]);return e}function Sy(i){let e=i.replace(sy,wy);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function wy(i){return"-"+i.toLowerCase()}const Xo={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},Cy={};function uc(i,e){const t=Cy,r=typeof t.includeImageAlt=="boolean"?t.includeImageAlt:!0,n=typeof t.includeHtml=="boolean"?t.includeHtml:!0;return rp(i,r,n)}function rp(i,e,t){if(ky(i)){if("value"in i)return i.type==="html"&&!t?"":i.value;if(e&&"alt"in i&&i.alt)return i.alt;if("children"in i)return Gh(i.children,e,t)}return Array.isArray(i)?Gh(i,e,t):""}function Gh(i,e,t){const r=[];let n=-1;for(;++n<i.length;)r[n]=rp(i[n],e,t);return r.join("")}function ky(i){return!!(i&&typeof i=="object")}const Xh=document.createElement("i");function fc(i){const e="&"+i+";";Xh.innerHTML=e;const t=Xh.textContent;return t.charCodeAt(t.length-1)===59&&i!=="semi"||t===e?!1:t}function Pt(i,e,t,r){const n=i.length;let s=0,l;if(e<0?e=-e>n?0:n+e:e=e>n?n:e,t=t>0?t:0,r.length<1e4)l=Array.from(r),l.unshift(e,t),i.splice(...l);else for(t&&i.splice(e,t);s<r.length;)l=r.slice(s,s+1e4),l.unshift(e,0),i.splice(...l),s+=1e4,e+=1e4}function It(i,e){return i.length>0?(Pt(i,i.length,0,e),i):e}const Jh={}.hasOwnProperty;function np(i){const e={};let t=-1;for(;++t<i.length;)Ey(e,i[t]);return e}function Ey(i,e){let t;for(t in e){const n=(Jh.call(i,t)?i[t]:void 0)||(i[t]={}),s=e[t];let l;if(s)for(l in s){Jh.call(n,l)||(n[l]=[]);const o=s[l];Ay(n[l],Array.isArray(o)?o:o?[o]:[])}}}function Ay(i,e){let t=-1;const r=[];for(;++t<e.length;)(e[t].add==="after"?i:r).push(e[t]);Pt(i,0,0,r)}function sp(i,e){const t=Number.parseInt(i,e);return t<9||t===11||t>13&&t<32||t>126&&t<160||t>55295&&t<57344||t>64975&&t<65008||(t&65535)===65535||(t&65535)===65534||t>1114111?"�":String.fromCodePoint(t)}function Xt(i){return i.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const pt=Ui(/[A-Za-z]/),nt=Ui(/[\dA-Za-z]/),Dy=Ui(/[#-'*+\--9=?A-Z^-~]/);function qs(i){return i!==null&&(i<32||i===127)}const Yl=Ui(/\d/),Ly=Ui(/[\dA-Fa-f]/),My=Ui(/[!-/:-@[-`{-~]/);function ae(i){return i!==null&&i<-2}function Pe(i){return i!==null&&(i<0||i===32)}function be(i){return i===-2||i===-1||i===32}const wo=Ui(new RegExp("\\p{P}|\\p{S}","u")),ur=Ui(/\s/);function Ui(i){return e;function e(t){return t!==null&&t>-1&&i.test(String.fromCharCode(t))}}function Yr(i){const e=[];let t=-1,r=0,n=0;for(;++t<i.length;){const s=i.charCodeAt(t);let l="";if(s===37&&nt(i.charCodeAt(t+1))&&nt(i.charCodeAt(t+2)))n=2;else if(s<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(s))||(l=String.fromCharCode(s));else if(s>55295&&s<57344){const o=i.charCodeAt(t+1);s<56320&&o>56319&&o<57344?(l=String.fromCharCode(s,o),n=1):l="�"}else l=String.fromCharCode(s);l&&(e.push(i.slice(r,t),encodeURIComponent(l)),r=t+n+1,l=""),n&&(t+=n,n=0)}return e.join("")+i.slice(r)}function we(i,e,t,r){const n=r?r-1:Number.POSITIVE_INFINITY;let s=0;return l;function l(a){return be(a)?(i.enter(t),o(a)):e(a)}function o(a){return be(a)&&s++<n?(i.consume(a),o):(i.exit(t),e(a))}}const Ty={tokenize:Ry};function Ry(i){const e=i.attempt(this.parser.constructs.contentInitial,r,n);let t;return e;function r(o){if(o===null){i.consume(o);return}return i.enter("lineEnding"),i.consume(o),i.exit("lineEnding"),we(i,e,"linePrefix")}function n(o){return i.enter("paragraph"),s(o)}function s(o){const a=i.enter("chunkText",{contentType:"text",previous:t});return t&&(t.next=a),t=a,l(o)}function l(o){if(o===null){i.exit("chunkText"),i.exit("paragraph"),i.consume(o);return}return ae(o)?(i.consume(o),i.exit("chunkText"),s):(i.consume(o),l)}}const Py={tokenize:By},Yh={tokenize:Oy};function By(i){const e=this,t=[];let r=0,n,s,l;return o;function o(v){if(r<t.length){const b=t[r];return e.containerState=b[1],i.attempt(b[0].continuation,a,c)(v)}return c(v)}function a(v){if(r++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,n&&g();const b=e.events.length;let S=b,x;for(;S--;)if(e.events[S][0]==="exit"&&e.events[S][1].type==="chunkFlow"){x=e.events[S][1].end;break}p(r);let C=b;for(;C<e.events.length;)e.events[C][1].end={...x},C++;return Pt(e.events,S+1,0,e.events.slice(b)),e.events.length=C,c(v)}return o(v)}function c(v){if(r===t.length){if(!n)return f(v);if(n.currentConstruct&&n.currentConstruct.concrete)return y(v);e.interrupt=!!(n.currentConstruct&&!n._gfmTableDynamicInterruptHack)}return e.containerState={},i.check(Yh,h,u)(v)}function h(v){return n&&g(),p(r),f(v)}function u(v){return e.parser.lazy[e.now().line]=r!==t.length,l=e.now().offset,y(v)}function f(v){return e.containerState={},i.attempt(Yh,d,y)(v)}function d(v){return r++,t.push([e.currentConstruct,e.containerState]),f(v)}function y(v){if(v===null){n&&g(),p(0),i.consume(v);return}return n=n||e.parser.flow(e.now()),i.enter("chunkFlow",{_tokenizer:n,contentType:"flow",previous:s}),_(v)}function _(v){if(v===null){m(i.exit("chunkFlow"),!0),p(0),i.consume(v);return}return ae(v)?(i.consume(v),m(i.exit("chunkFlow")),r=0,e.interrupt=void 0,o):(i.consume(v),_)}function m(v,b){const S=e.sliceStream(v);if(b&&S.push(null),v.previous=s,s&&(s.next=v),s=v,n.defineSkip(v.start),n.write(S),e.parser.lazy[v.start.line]){let x=n.events.length;for(;x--;)if(n.events[x][1].start.offset<l&&(!n.events[x][1].end||n.events[x][1].end.offset>l))return;const C=e.events.length;let w=C,E,A;for(;w--;)if(e.events[w][0]==="exit"&&e.events[w][1].type==="chunkFlow"){if(E){A=e.events[w][1].end;break}E=!0}for(p(r),x=C;x<e.events.length;)e.events[x][1].end={...A},x++;Pt(e.events,w+1,0,e.events.slice(C)),e.events.length=x}}function p(v){let b=t.length;for(;b-- >v;){const S=t[b];e.containerState=S[1],S[0].exit.call(e,i)}t.length=v}function g(){n.write([null]),s=void 0,n=void 0,e.containerState._closeFlow=void 0}}function Oy(i,e,t){return we(i,i.attempt(this.parser.constructs.document,e,t),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function jr(i){if(i===null||Pe(i)||ur(i))return 1;if(wo(i))return 2}function Co(i,e,t){const r=[];let n=-1;for(;++n<i.length;){const s=i[n].resolveAll;s&&!r.includes(s)&&(e=s(e,t),r.push(s))}return e}const Ql={name:"attention",resolveAll:Iy,tokenize:Ny};function Iy(i,e){let t=-1,r,n,s,l,o,a,c,h;for(;++t<i.length;)if(i[t][0]==="enter"&&i[t][1].type==="attentionSequence"&&i[t][1]._close){for(r=t;r--;)if(i[r][0]==="exit"&&i[r][1].type==="attentionSequence"&&i[r][1]._open&&e.sliceSerialize(i[r][1]).charCodeAt(0)===e.sliceSerialize(i[t][1]).charCodeAt(0)){if((i[r][1]._close||i[t][1]._open)&&(i[t][1].end.offset-i[t][1].start.offset)%3&&!((i[r][1].end.offset-i[r][1].start.offset+i[t][1].end.offset-i[t][1].start.offset)%3))continue;a=i[r][1].end.offset-i[r][1].start.offset>1&&i[t][1].end.offset-i[t][1].start.offset>1?2:1;const u={...i[r][1].end},f={...i[t][1].start};Qh(u,-a),Qh(f,a),l={type:a>1?"strongSequence":"emphasisSequence",start:u,end:{...i[r][1].end}},o={type:a>1?"strongSequence":"emphasisSequence",start:{...i[t][1].start},end:f},s={type:a>1?"strongText":"emphasisText",start:{...i[r][1].end},end:{...i[t][1].start}},n={type:a>1?"strong":"emphasis",start:{...l.start},end:{...o.end}},i[r][1].end={...l.start},i[t][1].start={...o.end},c=[],i[r][1].end.offset-i[r][1].start.offset&&(c=It(c,[["enter",i[r][1],e],["exit",i[r][1],e]])),c=It(c,[["enter",n,e],["enter",l,e],["exit",l,e],["enter",s,e]]),c=It(c,Co(e.parser.constructs.insideSpan.null,i.slice(r+1,t),e)),c=It(c,[["exit",s,e],["enter",o,e],["exit",o,e],["exit",n,e]]),i[t][1].end.offset-i[t][1].start.offset?(h=2,c=It(c,[["enter",i[t][1],e],["exit",i[t][1],e]])):h=0,Pt(i,r-1,t-r+3,c),t=r+c.length-h-2;break}}for(t=-1;++t<i.length;)i[t][1].type==="attentionSequence"&&(i[t][1].type="data");return i}function Ny(i,e){const t=this.parser.constructs.attentionMarkers.null,r=this.previous,n=jr(r);let s;return l;function l(a){return s=a,i.enter("attentionSequence"),o(a)}function o(a){if(a===s)return i.consume(a),o;const c=i.exit("attentionSequence"),h=jr(a),u=!h||h===2&&n||t.includes(a),f=!n||n===2&&h||t.includes(r);return c._open=!!(s===42?u:u&&(n||!f)),c._close=!!(s===42?f:f&&(h||!u)),e(a)}}function Qh(i,e){i.column+=e,i.offset+=e,i._bufferIndex+=e}const Fy={name:"autolink",tokenize:Hy};function Hy(i,e,t){let r=0;return n;function n(d){return i.enter("autolink"),i.enter("autolinkMarker"),i.consume(d),i.exit("autolinkMarker"),i.enter("autolinkProtocol"),s}function s(d){return pt(d)?(i.consume(d),l):d===64?t(d):c(d)}function l(d){return d===43||d===45||d===46||nt(d)?(r=1,o(d)):c(d)}function o(d){return d===58?(i.consume(d),r=0,a):(d===43||d===45||d===46||nt(d))&&r++<32?(i.consume(d),o):(r=0,c(d))}function a(d){return d===62?(i.exit("autolinkProtocol"),i.enter("autolinkMarker"),i.consume(d),i.exit("autolinkMarker"),i.exit("autolink"),e):d===null||d===32||d===60||qs(d)?t(d):(i.consume(d),a)}function c(d){return d===64?(i.consume(d),h):Dy(d)?(i.consume(d),c):t(d)}function h(d){return nt(d)?u(d):t(d)}function u(d){return d===46?(i.consume(d),r=0,h):d===62?(i.exit("autolinkProtocol").type="autolinkEmail",i.enter("autolinkMarker"),i.consume(d),i.exit("autolinkMarker"),i.exit("autolink"),e):f(d)}function f(d){if((d===45||nt(d))&&r++<63){const y=d===45?f:u;return i.consume(d),y}return t(d)}}const Xn={partial:!0,tokenize:jy};function jy(i,e,t){return r;function r(s){return be(s)?we(i,n,"linePrefix")(s):n(s)}function n(s){return s===null||ae(s)?e(s):t(s)}}const op={continuation:{tokenize:Wy},exit:$y,name:"blockQuote",tokenize:zy};function zy(i,e,t){const r=this;return n;function n(l){if(l===62){const o=r.containerState;return o.open||(i.enter("blockQuote",{_container:!0}),o.open=!0),i.enter("blockQuotePrefix"),i.enter("blockQuoteMarker"),i.consume(l),i.exit("blockQuoteMarker"),s}return t(l)}function s(l){return be(l)?(i.enter("blockQuotePrefixWhitespace"),i.consume(l),i.exit("blockQuotePrefixWhitespace"),i.exit("blockQuotePrefix"),e):(i.exit("blockQuotePrefix"),e(l))}}function Wy(i,e,t){const r=this;return n;function n(l){return be(l)?we(i,s,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(l):s(l)}function s(l){return i.attempt(op,e,t)(l)}}function $y(i){i.exit("blockQuote")}const lp={name:"characterEscape",tokenize:Vy};function Vy(i,e,t){return r;function r(s){return i.enter("characterEscape"),i.enter("escapeMarker"),i.consume(s),i.exit("escapeMarker"),n}function n(s){return My(s)?(i.enter("characterEscapeValue"),i.consume(s),i.exit("characterEscapeValue"),i.exit("characterEscape"),e):t(s)}}const ap={name:"characterReference",tokenize:Uy};function Uy(i,e,t){const r=this;let n=0,s,l;return o;function o(u){return i.enter("characterReference"),i.enter("characterReferenceMarker"),i.consume(u),i.exit("characterReferenceMarker"),a}function a(u){return u===35?(i.enter("characterReferenceMarkerNumeric"),i.consume(u),i.exit("characterReferenceMarkerNumeric"),c):(i.enter("characterReferenceValue"),s=31,l=nt,h(u))}function c(u){return u===88||u===120?(i.enter("characterReferenceMarkerHexadecimal"),i.consume(u),i.exit("characterReferenceMarkerHexadecimal"),i.enter("characterReferenceValue"),s=6,l=Ly,h):(i.enter("characterReferenceValue"),s=7,l=Yl,h(u))}function h(u){if(u===59&&n){const f=i.exit("characterReferenceValue");return l===nt&&!fc(r.sliceSerialize(f))?t(u):(i.enter("characterReferenceMarker"),i.consume(u),i.exit("characterReferenceMarker"),i.exit("characterReference"),e)}return l(u)&&n++<s?(i.consume(u),h):t(u)}}const Zh={partial:!0,tokenize:Ky},eu={concrete:!0,name:"codeFenced",tokenize:qy};function qy(i,e,t){const r=this,n={partial:!0,tokenize:S};let s=0,l=0,o;return a;function a(x){return c(x)}function c(x){const C=r.events[r.events.length-1];return s=C&&C[1].type==="linePrefix"?C[2].sliceSerialize(C[1],!0).length:0,o=x,i.enter("codeFenced"),i.enter("codeFencedFence"),i.enter("codeFencedFenceSequence"),h(x)}function h(x){return x===o?(l++,i.consume(x),h):l<3?t(x):(i.exit("codeFencedFenceSequence"),be(x)?we(i,u,"whitespace")(x):u(x))}function u(x){return x===null||ae(x)?(i.exit("codeFencedFence"),r.interrupt?e(x):i.check(Zh,_,b)(x)):(i.enter("codeFencedFenceInfo"),i.enter("chunkString",{contentType:"string"}),f(x))}function f(x){return x===null||ae(x)?(i.exit("chunkString"),i.exit("codeFencedFenceInfo"),u(x)):be(x)?(i.exit("chunkString"),i.exit("codeFencedFenceInfo"),we(i,d,"whitespace")(x)):x===96&&x===o?t(x):(i.consume(x),f)}function d(x){return x===null||ae(x)?u(x):(i.enter("codeFencedFenceMeta"),i.enter("chunkString",{contentType:"string"}),y(x))}function y(x){return x===null||ae(x)?(i.exit("chunkString"),i.exit("codeFencedFenceMeta"),u(x)):x===96&&x===o?t(x):(i.consume(x),y)}function _(x){return i.attempt(n,b,m)(x)}function m(x){return i.enter("lineEnding"),i.consume(x),i.exit("lineEnding"),p}function p(x){return s>0&&be(x)?we(i,g,"linePrefix",s+1)(x):g(x)}function g(x){return x===null||ae(x)?i.check(Zh,_,b)(x):(i.enter("codeFlowValue"),v(x))}function v(x){return x===null||ae(x)?(i.exit("codeFlowValue"),g(x)):(i.consume(x),v)}function b(x){return i.exit("codeFenced"),e(x)}function S(x,C,w){let E=0;return A;function A(j){return x.enter("lineEnding"),x.consume(j),x.exit("lineEnding"),M}function M(j){return x.enter("codeFencedFence"),be(j)?we(x,T,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(j):T(j)}function T(j){return j===o?(x.enter("codeFencedFenceSequence"),B(j)):w(j)}function B(j){return j===o?(E++,x.consume(j),B):E>=l?(x.exit("codeFencedFenceSequence"),be(j)?we(x,F,"whitespace")(j):F(j)):w(j)}function F(j){return j===null||ae(j)?(x.exit("codeFencedFence"),C(j)):w(j)}}}function Ky(i,e,t){const r=this;return n;function n(l){return l===null?t(l):(i.enter("lineEnding"),i.consume(l),i.exit("lineEnding"),s)}function s(l){return r.parser.lazy[r.now().line]?t(l):e(l)}}const Jo={name:"codeIndented",tokenize:Xy},Gy={partial:!0,tokenize:Jy};function Xy(i,e,t){const r=this;return n;function n(c){return i.enter("codeIndented"),we(i,s,"linePrefix",5)(c)}function s(c){const h=r.events[r.events.length-1];return h&&h[1].type==="linePrefix"&&h[2].sliceSerialize(h[1],!0).length>=4?l(c):t(c)}function l(c){return c===null?a(c):ae(c)?i.attempt(Gy,l,a)(c):(i.enter("codeFlowValue"),o(c))}function o(c){return c===null||ae(c)?(i.exit("codeFlowValue"),l(c)):(i.consume(c),o)}function a(c){return i.exit("codeIndented"),e(c)}}function Jy(i,e,t){const r=this;return n;function n(l){return r.parser.lazy[r.now().line]?t(l):ae(l)?(i.enter("lineEnding"),i.consume(l),i.exit("lineEnding"),n):we(i,s,"linePrefix",5)(l)}function s(l){const o=r.events[r.events.length-1];return o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(l):ae(l)?n(l):t(l)}}const Yy={name:"codeText",previous:Zy,resolve:Qy,tokenize:eb};function Qy(i){let e=i.length-4,t=3,r,n;if((i[t][1].type==="lineEnding"||i[t][1].type==="space")&&(i[e][1].type==="lineEnding"||i[e][1].type==="space")){for(r=t;++r<e;)if(i[r][1].type==="codeTextData"){i[t][1].type="codeTextPadding",i[e][1].type="codeTextPadding",t+=2,e-=2;break}}for(r=t-1,e++;++r<=e;)n===void 0?r!==e&&i[r][1].type!=="lineEnding"&&(n=r):(r===e||i[r][1].type==="lineEnding")&&(i[n][1].type="codeTextData",r!==n+2&&(i[n][1].end=i[r-1][1].end,i.splice(n+2,r-n-2),e-=r-n-2,r=n+2),n=void 0);return i}function Zy(i){return i!==96||this.events[this.events.length-1][1].type==="characterEscape"}function eb(i,e,t){let r=0,n,s;return l;function l(u){return i.enter("codeText"),i.enter("codeTextSequence"),o(u)}function o(u){return u===96?(i.consume(u),r++,o):(i.exit("codeTextSequence"),a(u))}function a(u){return u===null?t(u):u===32?(i.enter("space"),i.consume(u),i.exit("space"),a):u===96?(s=i.enter("codeTextSequence"),n=0,h(u)):ae(u)?(i.enter("lineEnding"),i.consume(u),i.exit("lineEnding"),a):(i.enter("codeTextData"),c(u))}function c(u){return u===null||u===32||u===96||ae(u)?(i.exit("codeTextData"),a(u)):(i.consume(u),c)}function h(u){return u===96?(i.consume(u),n++,h):n===r?(i.exit("codeTextSequence"),i.exit("codeText"),e(u)):(s.type="codeTextData",c(u))}}class tb{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,t){const r=t??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(e,r):e>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(e,t,r){const n=t||0;this.setCursor(Math.trunc(e));const s=this.right.splice(this.right.length-n,Number.POSITIVE_INFINITY);return r&&on(this.left,r),s.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),on(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),on(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const t=this.left.splice(e,Number.POSITIVE_INFINITY);on(this.right,t.reverse())}else{const t=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);on(this.left,t.reverse())}}}function on(i,e){let t=0;if(e.length<1e4)i.push(...e);else for(;t<e.length;)i.push(...e.slice(t,t+1e4)),t+=1e4}function cp(i){const e={};let t=-1,r,n,s,l,o,a,c;const h=new tb(i);for(;++t<h.length;){for(;t in e;)t=e[t];if(r=h.get(t),t&&r[1].type==="chunkFlow"&&h.get(t-1)[1].type==="listItemPrefix"&&(a=r[1]._tokenizer.events,s=0,s<a.length&&a[s][1].type==="lineEndingBlank"&&(s+=2),s<a.length&&a[s][1].type==="content"))for(;++s<a.length&&a[s][1].type!=="content";)a[s][1].type==="chunkText"&&(a[s][1]._isInFirstContentOfListItem=!0,s++);if(r[0]==="enter")r[1].contentType&&(Object.assign(e,ib(h,t)),t=e[t],c=!0);else if(r[1]._container){for(s=t,n=void 0;s--;)if(l=h.get(s),l[1].type==="lineEnding"||l[1].type==="lineEndingBlank")l[0]==="enter"&&(n&&(h.get(n)[1].type="lineEndingBlank"),l[1].type="lineEnding",n=s);else if(!(l[1].type==="linePrefix"||l[1].type==="listItemIndent"))break;n&&(r[1].end={...h.get(n)[1].start},o=h.slice(n,t),o.unshift(r),h.splice(n,t-n+1,o))}}return Pt(i,0,Number.POSITIVE_INFINITY,h.slice(0)),!c}function ib(i,e){const t=i.get(e)[1],r=i.get(e)[2];let n=e-1;const s=[];let l=t._tokenizer;l||(l=r.parser[t.contentType](t.start),t._contentTypeTextTrailing&&(l._contentTypeTextTrailing=!0));const o=l.events,a=[],c={};let h,u,f=-1,d=t,y=0,_=0;const m=[_];for(;d;){for(;i.get(++n)[1]!==d;);s.push(n),d._tokenizer||(h=r.sliceStream(d),d.next||h.push(null),u&&l.defineSkip(d.start),d._isInFirstContentOfListItem&&(l._gfmTasklistFirstContentOfListItem=!0),l.write(h),d._isInFirstContentOfListItem&&(l._gfmTasklistFirstContentOfListItem=void 0)),u=d,d=d.next}for(d=t;++f<o.length;)o[f][0]==="exit"&&o[f-1][0]==="enter"&&o[f][1].type===o[f-1][1].type&&o[f][1].start.line!==o[f][1].end.line&&(_=f+1,m.push(_),d._tokenizer=void 0,d.previous=void 0,d=d.next);for(l.events=[],d?(d._tokenizer=void 0,d.previous=void 0):m.pop(),f=m.length;f--;){const p=o.slice(m[f],m[f+1]),g=s.pop();a.push([g,g+p.length-1]),i.splice(g,2,p)}for(a.reverse(),f=-1;++f<a.length;)c[y+a[f][0]]=y+a[f][1],y+=a[f][1]-a[f][0]-1;return c}const rb={resolve:sb,tokenize:ob},nb={partial:!0,tokenize:lb};function sb(i){return cp(i),i}function ob(i,e){let t;return r;function r(o){return i.enter("content"),t=i.enter("chunkContent",{contentType:"content"}),n(o)}function n(o){return o===null?s(o):ae(o)?i.check(nb,l,s)(o):(i.consume(o),n)}function s(o){return i.exit("chunkContent"),i.exit("content"),e(o)}function l(o){return i.consume(o),i.exit("chunkContent"),t.next=i.enter("chunkContent",{contentType:"content",previous:t}),t=t.next,n}}function lb(i,e,t){const r=this;return n;function n(l){return i.exit("chunkContent"),i.enter("lineEnding"),i.consume(l),i.exit("lineEnding"),we(i,s,"linePrefix")}function s(l){if(l===null||ae(l))return t(l);const o=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(l):i.interrupt(r.parser.constructs.flow,t,e)(l)}}function hp(i,e,t,r,n,s,l,o,a){const c=a||Number.POSITIVE_INFINITY;let h=0;return u;function u(p){return p===60?(i.enter(r),i.enter(n),i.enter(s),i.consume(p),i.exit(s),f):p===null||p===32||p===41||qs(p)?t(p):(i.enter(r),i.enter(l),i.enter(o),i.enter("chunkString",{contentType:"string"}),_(p))}function f(p){return p===62?(i.enter(s),i.consume(p),i.exit(s),i.exit(n),i.exit(r),e):(i.enter(o),i.enter("chunkString",{contentType:"string"}),d(p))}function d(p){return p===62?(i.exit("chunkString"),i.exit(o),f(p)):p===null||p===60||ae(p)?t(p):(i.consume(p),p===92?y:d)}function y(p){return p===60||p===62||p===92?(i.consume(p),d):d(p)}function _(p){return!h&&(p===null||p===41||Pe(p))?(i.exit("chunkString"),i.exit(o),i.exit(l),i.exit(r),e(p)):h<c&&p===40?(i.consume(p),h++,_):p===41?(i.consume(p),h--,_):p===null||p===32||p===40||qs(p)?t(p):(i.consume(p),p===92?m:_)}function m(p){return p===40||p===41||p===92?(i.consume(p),_):_(p)}}function up(i,e,t,r,n,s){const l=this;let o=0,a;return c;function c(d){return i.enter(r),i.enter(n),i.consume(d),i.exit(n),i.enter(s),h}function h(d){return o>999||d===null||d===91||d===93&&!a||d===94&&!o&&"_hiddenFootnoteSupport"in l.parser.constructs?t(d):d===93?(i.exit(s),i.enter(n),i.consume(d),i.exit(n),i.exit(r),e):ae(d)?(i.enter("lineEnding"),i.consume(d),i.exit("lineEnding"),h):(i.enter("chunkString",{contentType:"string"}),u(d))}function u(d){return d===null||d===91||d===93||ae(d)||o++>999?(i.exit("chunkString"),h(d)):(i.consume(d),a||(a=!be(d)),d===92?f:u)}function f(d){return d===91||d===92||d===93?(i.consume(d),o++,u):u(d)}}function fp(i,e,t,r,n,s){let l;return o;function o(f){return f===34||f===39||f===40?(i.enter(r),i.enter(n),i.consume(f),i.exit(n),l=f===40?41:f,a):t(f)}function a(f){return f===l?(i.enter(n),i.consume(f),i.exit(n),i.exit(r),e):(i.enter(s),c(f))}function c(f){return f===l?(i.exit(s),a(l)):f===null?t(f):ae(f)?(i.enter("lineEnding"),i.consume(f),i.exit("lineEnding"),we(i,c,"linePrefix")):(i.enter("chunkString",{contentType:"string"}),h(f))}function h(f){return f===l||f===null||ae(f)?(i.exit("chunkString"),c(f)):(i.consume(f),f===92?u:h)}function u(f){return f===l||f===92?(i.consume(f),h):h(f)}}function _n(i,e){let t;return r;function r(n){return ae(n)?(i.enter("lineEnding"),i.consume(n),i.exit("lineEnding"),t=!0,r):be(n)?we(i,r,t?"linePrefix":"lineSuffix")(n):e(n)}}const ab={name:"definition",tokenize:hb},cb={partial:!0,tokenize:ub};function hb(i,e,t){const r=this;let n;return s;function s(d){return i.enter("definition"),l(d)}function l(d){return up.call(r,i,o,t,"definitionLabel","definitionLabelMarker","definitionLabelString")(d)}function o(d){return n=Xt(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),d===58?(i.enter("definitionMarker"),i.consume(d),i.exit("definitionMarker"),a):t(d)}function a(d){return Pe(d)?_n(i,c)(d):c(d)}function c(d){return hp(i,h,t,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(d)}function h(d){return i.attempt(cb,u,u)(d)}function u(d){return be(d)?we(i,f,"whitespace")(d):f(d)}function f(d){return d===null||ae(d)?(i.exit("definition"),r.parser.defined.push(n),e(d)):t(d)}}function ub(i,e,t){return r;function r(o){return Pe(o)?_n(i,n)(o):t(o)}function n(o){return fp(i,s,t,"definitionTitle","definitionTitleMarker","definitionTitleString")(o)}function s(o){return be(o)?we(i,l,"whitespace")(o):l(o)}function l(o){return o===null||ae(o)?e(o):t(o)}}const fb={name:"hardBreakEscape",tokenize:db};function db(i,e,t){return r;function r(s){return i.enter("hardBreakEscape"),i.consume(s),n}function n(s){return ae(s)?(i.exit("hardBreakEscape"),e(s)):t(s)}}const pb={name:"headingAtx",resolve:mb,tokenize:gb};function mb(i,e){let t=i.length-2,r=3,n,s;return i[r][1].type==="whitespace"&&(r+=2),t-2>r&&i[t][1].type==="whitespace"&&(t-=2),i[t][1].type==="atxHeadingSequence"&&(r===t-1||t-4>r&&i[t-2][1].type==="whitespace")&&(t-=r+1===t?2:4),t>r&&(n={type:"atxHeadingText",start:i[r][1].start,end:i[t][1].end},s={type:"chunkText",start:i[r][1].start,end:i[t][1].end,contentType:"text"},Pt(i,r,t-r+1,[["enter",n,e],["enter",s,e],["exit",s,e],["exit",n,e]])),i}function gb(i,e,t){let r=0;return n;function n(h){return i.enter("atxHeading"),s(h)}function s(h){return i.enter("atxHeadingSequence"),l(h)}function l(h){return h===35&&r++<6?(i.consume(h),l):h===null||Pe(h)?(i.exit("atxHeadingSequence"),o(h)):t(h)}function o(h){return h===35?(i.enter("atxHeadingSequence"),a(h)):h===null||ae(h)?(i.exit("atxHeading"),e(h)):be(h)?we(i,o,"whitespace")(h):(i.enter("atxHeadingText"),c(h))}function a(h){return h===35?(i.consume(h),a):(i.exit("atxHeadingSequence"),o(h))}function c(h){return h===null||h===35||Pe(h)?(i.exit("atxHeadingText"),o(h)):(i.consume(h),c)}}const vb=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],tu=["pre","script","style","textarea"],_b={concrete:!0,name:"htmlFlow",resolveTo:xb,tokenize:Sb},yb={partial:!0,tokenize:Cb},bb={partial:!0,tokenize:wb};function xb(i){let e=i.length;for(;e--&&!(i[e][0]==="enter"&&i[e][1].type==="htmlFlow"););return e>1&&i[e-2][1].type==="linePrefix"&&(i[e][1].start=i[e-2][1].start,i[e+1][1].start=i[e-2][1].start,i.splice(e-2,2)),i}function Sb(i,e,t){const r=this;let n,s,l,o,a;return c;function c(P){return h(P)}function h(P){return i.enter("htmlFlow"),i.enter("htmlFlowData"),i.consume(P),u}function u(P){return P===33?(i.consume(P),f):P===47?(i.consume(P),s=!0,_):P===63?(i.consume(P),n=3,r.interrupt?e:k):pt(P)?(i.consume(P),l=String.fromCharCode(P),m):t(P)}function f(P){return P===45?(i.consume(P),n=2,d):P===91?(i.consume(P),n=5,o=0,y):pt(P)?(i.consume(P),n=4,r.interrupt?e:k):t(P)}function d(P){return P===45?(i.consume(P),r.interrupt?e:k):t(P)}function y(P){const X="CDATA[";return P===X.charCodeAt(o++)?(i.consume(P),o===X.length?r.interrupt?e:T:y):t(P)}function _(P){return pt(P)?(i.consume(P),l=String.fromCharCode(P),m):t(P)}function m(P){if(P===null||P===47||P===62||Pe(P)){const X=P===47,ee=l.toLowerCase();return!X&&!s&&tu.includes(ee)?(n=1,r.interrupt?e(P):T(P)):vb.includes(l.toLowerCase())?(n=6,X?(i.consume(P),p):r.interrupt?e(P):T(P)):(n=7,r.interrupt&&!r.parser.lazy[r.now().line]?t(P):s?g(P):v(P))}return P===45||nt(P)?(i.consume(P),l+=String.fromCharCode(P),m):t(P)}function p(P){return P===62?(i.consume(P),r.interrupt?e:T):t(P)}function g(P){return be(P)?(i.consume(P),g):A(P)}function v(P){return P===47?(i.consume(P),A):P===58||P===95||pt(P)?(i.consume(P),b):be(P)?(i.consume(P),v):A(P)}function b(P){return P===45||P===46||P===58||P===95||nt(P)?(i.consume(P),b):S(P)}function S(P){return P===61?(i.consume(P),x):be(P)?(i.consume(P),S):v(P)}function x(P){return P===null||P===60||P===61||P===62||P===96?t(P):P===34||P===39?(i.consume(P),a=P,C):be(P)?(i.consume(P),x):w(P)}function C(P){return P===a?(i.consume(P),a=null,E):P===null||ae(P)?t(P):(i.consume(P),C)}function w(P){return P===null||P===34||P===39||P===47||P===60||P===61||P===62||P===96||Pe(P)?S(P):(i.consume(P),w)}function E(P){return P===47||P===62||be(P)?v(P):t(P)}function A(P){return P===62?(i.consume(P),M):t(P)}function M(P){return P===null||ae(P)?T(P):be(P)?(i.consume(P),M):t(P)}function T(P){return P===45&&n===2?(i.consume(P),z):P===60&&n===1?(i.consume(P),$):P===62&&n===4?(i.consume(P),I):P===63&&n===3?(i.consume(P),k):P===93&&n===5?(i.consume(P),L):ae(P)&&(n===6||n===7)?(i.exit("htmlFlowData"),i.check(yb,H,B)(P)):P===null||ae(P)?(i.exit("htmlFlowData"),B(P)):(i.consume(P),T)}function B(P){return i.check(bb,F,H)(P)}function F(P){return i.enter("lineEnding"),i.consume(P),i.exit("lineEnding"),j}function j(P){return P===null||ae(P)?B(P):(i.enter("htmlFlowData"),T(P))}function z(P){return P===45?(i.consume(P),k):T(P)}function $(P){return P===47?(i.consume(P),l="",V):T(P)}function V(P){if(P===62){const X=l.toLowerCase();return tu.includes(X)?(i.consume(P),I):T(P)}return pt(P)&&l.length<8?(i.consume(P),l+=String.fromCharCode(P),V):T(P)}function L(P){return P===93?(i.consume(P),k):T(P)}function k(P){return P===62?(i.consume(P),I):P===45&&n===2?(i.consume(P),k):T(P)}function I(P){return P===null||ae(P)?(i.exit("htmlFlowData"),H(P)):(i.consume(P),I)}function H(P){return i.exit("htmlFlow"),e(P)}}function wb(i,e,t){const r=this;return n;function n(l){return ae(l)?(i.enter("lineEnding"),i.consume(l),i.exit("lineEnding"),s):t(l)}function s(l){return r.parser.lazy[r.now().line]?t(l):e(l)}}function Cb(i,e,t){return r;function r(n){return i.enter("lineEnding"),i.consume(n),i.exit("lineEnding"),i.attempt(Xn,e,t)}}const kb={name:"htmlText",tokenize:Eb};function Eb(i,e,t){const r=this;let n,s,l;return o;function o(k){return i.enter("htmlText"),i.enter("htmlTextData"),i.consume(k),a}function a(k){return k===33?(i.consume(k),c):k===47?(i.consume(k),S):k===63?(i.consume(k),v):pt(k)?(i.consume(k),w):t(k)}function c(k){return k===45?(i.consume(k),h):k===91?(i.consume(k),s=0,y):pt(k)?(i.consume(k),g):t(k)}function h(k){return k===45?(i.consume(k),d):t(k)}function u(k){return k===null?t(k):k===45?(i.consume(k),f):ae(k)?(l=u,$(k)):(i.consume(k),u)}function f(k){return k===45?(i.consume(k),d):u(k)}function d(k){return k===62?z(k):k===45?f(k):u(k)}function y(k){const I="CDATA[";return k===I.charCodeAt(s++)?(i.consume(k),s===I.length?_:y):t(k)}function _(k){return k===null?t(k):k===93?(i.consume(k),m):ae(k)?(l=_,$(k)):(i.consume(k),_)}function m(k){return k===93?(i.consume(k),p):_(k)}function p(k){return k===62?z(k):k===93?(i.consume(k),p):_(k)}function g(k){return k===null||k===62?z(k):ae(k)?(l=g,$(k)):(i.consume(k),g)}function v(k){return k===null?t(k):k===63?(i.consume(k),b):ae(k)?(l=v,$(k)):(i.consume(k),v)}function b(k){return k===62?z(k):v(k)}function S(k){return pt(k)?(i.consume(k),x):t(k)}function x(k){return k===45||nt(k)?(i.consume(k),x):C(k)}function C(k){return ae(k)?(l=C,$(k)):be(k)?(i.consume(k),C):z(k)}function w(k){return k===45||nt(k)?(i.consume(k),w):k===47||k===62||Pe(k)?E(k):t(k)}function E(k){return k===47?(i.consume(k),z):k===58||k===95||pt(k)?(i.consume(k),A):ae(k)?(l=E,$(k)):be(k)?(i.consume(k),E):z(k)}function A(k){return k===45||k===46||k===58||k===95||nt(k)?(i.consume(k),A):M(k)}function M(k){return k===61?(i.consume(k),T):ae(k)?(l=M,$(k)):be(k)?(i.consume(k),M):E(k)}function T(k){return k===null||k===60||k===61||k===62||k===96?t(k):k===34||k===39?(i.consume(k),n=k,B):ae(k)?(l=T,$(k)):be(k)?(i.consume(k),T):(i.consume(k),F)}function B(k){return k===n?(i.consume(k),n=void 0,j):k===null?t(k):ae(k)?(l=B,$(k)):(i.consume(k),B)}function F(k){return k===null||k===34||k===39||k===60||k===61||k===96?t(k):k===47||k===62||Pe(k)?E(k):(i.consume(k),F)}function j(k){return k===47||k===62||Pe(k)?E(k):t(k)}function z(k){return k===62?(i.consume(k),i.exit("htmlTextData"),i.exit("htmlText"),e):t(k)}function $(k){return i.exit("htmlTextData"),i.enter("lineEnding"),i.consume(k),i.exit("lineEnding"),V}function V(k){return be(k)?we(i,L,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(k):L(k)}function L(k){return i.enter("htmlTextData"),l(k)}}const dc={name:"labelEnd",resolveAll:Mb,resolveTo:Tb,tokenize:Rb},Ab={tokenize:Pb},Db={tokenize:Bb},Lb={tokenize:Ob};function Mb(i){let e=-1;const t=[];for(;++e<i.length;){const r=i[e][1];if(t.push(i[e]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const n=r.type==="labelImage"?4:2;r.type="data",e+=n}}return i.length!==t.length&&Pt(i,0,i.length,t),i}function Tb(i,e){let t=i.length,r=0,n,s,l,o;for(;t--;)if(n=i[t][1],s){if(n.type==="link"||n.type==="labelLink"&&n._inactive)break;i[t][0]==="enter"&&n.type==="labelLink"&&(n._inactive=!0)}else if(l){if(i[t][0]==="enter"&&(n.type==="labelImage"||n.type==="labelLink")&&!n._balanced&&(s=t,n.type!=="labelLink")){r=2;break}}else n.type==="labelEnd"&&(l=t);const a={type:i[s][1].type==="labelLink"?"link":"image",start:{...i[s][1].start},end:{...i[i.length-1][1].end}},c={type:"label",start:{...i[s][1].start},end:{...i[l][1].end}},h={type:"labelText",start:{...i[s+r+2][1].end},end:{...i[l-2][1].start}};return o=[["enter",a,e],["enter",c,e]],o=It(o,i.slice(s+1,s+r+3)),o=It(o,[["enter",h,e]]),o=It(o,Co(e.parser.constructs.insideSpan.null,i.slice(s+r+4,l-3),e)),o=It(o,[["exit",h,e],i[l-2],i[l-1],["exit",c,e]]),o=It(o,i.slice(l+1)),o=It(o,[["exit",a,e]]),Pt(i,s,i.length,o),i}function Rb(i,e,t){const r=this;let n=r.events.length,s,l;for(;n--;)if((r.events[n][1].type==="labelImage"||r.events[n][1].type==="labelLink")&&!r.events[n][1]._balanced){s=r.events[n][1];break}return o;function o(f){return s?s._inactive?u(f):(l=r.parser.defined.includes(Xt(r.sliceSerialize({start:s.end,end:r.now()}))),i.enter("labelEnd"),i.enter("labelMarker"),i.consume(f),i.exit("labelMarker"),i.exit("labelEnd"),a):t(f)}function a(f){return f===40?i.attempt(Ab,h,l?h:u)(f):f===91?i.attempt(Db,h,l?c:u)(f):l?h(f):u(f)}function c(f){return i.attempt(Lb,h,u)(f)}function h(f){return e(f)}function u(f){return s._balanced=!0,t(f)}}function Pb(i,e,t){return r;function r(u){return i.enter("resource"),i.enter("resourceMarker"),i.consume(u),i.exit("resourceMarker"),n}function n(u){return Pe(u)?_n(i,s)(u):s(u)}function s(u){return u===41?h(u):hp(i,l,o,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(u)}function l(u){return Pe(u)?_n(i,a)(u):h(u)}function o(u){return t(u)}function a(u){return u===34||u===39||u===40?fp(i,c,t,"resourceTitle","resourceTitleMarker","resourceTitleString")(u):h(u)}function c(u){return Pe(u)?_n(i,h)(u):h(u)}function h(u){return u===41?(i.enter("resourceMarker"),i.consume(u),i.exit("resourceMarker"),i.exit("resource"),e):t(u)}}function Bb(i,e,t){const r=this;return n;function n(o){return up.call(r,i,s,l,"reference","referenceMarker","referenceString")(o)}function s(o){return r.parser.defined.includes(Xt(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(o):t(o)}function l(o){return t(o)}}function Ob(i,e,t){return r;function r(s){return i.enter("reference"),i.enter("referenceMarker"),i.consume(s),i.exit("referenceMarker"),n}function n(s){return s===93?(i.enter("referenceMarker"),i.consume(s),i.exit("referenceMarker"),i.exit("reference"),e):t(s)}}const Ib={name:"labelStartImage",resolveAll:dc.resolveAll,tokenize:Nb};function Nb(i,e,t){const r=this;return n;function n(o){return i.enter("labelImage"),i.enter("labelImageMarker"),i.consume(o),i.exit("labelImageMarker"),s}function s(o){return o===91?(i.enter("labelMarker"),i.consume(o),i.exit("labelMarker"),i.exit("labelImage"),l):t(o)}function l(o){return o===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(o):e(o)}}const Fb={name:"labelStartLink",resolveAll:dc.resolveAll,tokenize:Hb};function Hb(i,e,t){const r=this;return n;function n(l){return i.enter("labelLink"),i.enter("labelMarker"),i.consume(l),i.exit("labelMarker"),i.exit("labelLink"),s}function s(l){return l===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(l):e(l)}}const Yo={name:"lineEnding",tokenize:jb};function jb(i,e){return t;function t(r){return i.enter("lineEnding"),i.consume(r),i.exit("lineEnding"),we(i,e,"linePrefix")}}const Fs={name:"thematicBreak",tokenize:zb};function zb(i,e,t){let r=0,n;return s;function s(c){return i.enter("thematicBreak"),l(c)}function l(c){return n=c,o(c)}function o(c){return c===n?(i.enter("thematicBreakSequence"),a(c)):r>=3&&(c===null||ae(c))?(i.exit("thematicBreak"),e(c)):t(c)}function a(c){return c===n?(i.consume(c),r++,a):(i.exit("thematicBreakSequence"),be(c)?we(i,o,"whitespace")(c):o(c))}}const yt={continuation:{tokenize:Ub},exit:Kb,name:"list",tokenize:Vb},Wb={partial:!0,tokenize:Gb},$b={partial:!0,tokenize:qb};function Vb(i,e,t){const r=this,n=r.events[r.events.length-1];let s=n&&n[1].type==="linePrefix"?n[2].sliceSerialize(n[1],!0).length:0,l=0;return o;function o(d){const y=r.containerState.type||(d===42||d===43||d===45?"listUnordered":"listOrdered");if(y==="listUnordered"?!r.containerState.marker||d===r.containerState.marker:Yl(d)){if(r.containerState.type||(r.containerState.type=y,i.enter(y,{_container:!0})),y==="listUnordered")return i.enter("listItemPrefix"),d===42||d===45?i.check(Fs,t,c)(d):c(d);if(!r.interrupt||d===49)return i.enter("listItemPrefix"),i.enter("listItemValue"),a(d)}return t(d)}function a(d){return Yl(d)&&++l<10?(i.consume(d),a):(!r.interrupt||l<2)&&(r.containerState.marker?d===r.containerState.marker:d===41||d===46)?(i.exit("listItemValue"),c(d)):t(d)}function c(d){return i.enter("listItemMarker"),i.consume(d),i.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||d,i.check(Xn,r.interrupt?t:h,i.attempt(Wb,f,u))}function h(d){return r.containerState.initialBlankLine=!0,s++,f(d)}function u(d){return be(d)?(i.enter("listItemPrefixWhitespace"),i.consume(d),i.exit("listItemPrefixWhitespace"),f):t(d)}function f(d){return r.containerState.size=s+r.sliceSerialize(i.exit("listItemPrefix"),!0).length,e(d)}}function Ub(i,e,t){const r=this;return r.containerState._closeFlow=void 0,i.check(Xn,n,s);function n(o){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,we(i,e,"listItemIndent",r.containerState.size+1)(o)}function s(o){return r.containerState.furtherBlankLines||!be(o)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,l(o)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,i.attempt($b,e,l)(o))}function l(o){return r.containerState._closeFlow=!0,r.interrupt=void 0,we(i,i.attempt(yt,e,t),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o)}}function qb(i,e,t){const r=this;return we(i,n,"listItemIndent",r.containerState.size+1);function n(s){const l=r.events[r.events.length-1];return l&&l[1].type==="listItemIndent"&&l[2].sliceSerialize(l[1],!0).length===r.containerState.size?e(s):t(s)}}function Kb(i){i.exit(this.containerState.type)}function Gb(i,e,t){const r=this;return we(i,n,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function n(s){const l=r.events[r.events.length-1];return!be(s)&&l&&l[1].type==="listItemPrefixWhitespace"?e(s):t(s)}}const iu={name:"setextUnderline",resolveTo:Xb,tokenize:Jb};function Xb(i,e){let t=i.length,r,n,s;for(;t--;)if(i[t][0]==="enter"){if(i[t][1].type==="content"){r=t;break}i[t][1].type==="paragraph"&&(n=t)}else i[t][1].type==="content"&&i.splice(t,1),!s&&i[t][1].type==="definition"&&(s=t);const l={type:"setextHeading",start:{...i[r][1].start},end:{...i[i.length-1][1].end}};return i[n][1].type="setextHeadingText",s?(i.splice(n,0,["enter",l,e]),i.splice(s+1,0,["exit",i[r][1],e]),i[r][1].end={...i[s][1].end}):i[r][1]=l,i.push(["exit",l,e]),i}function Jb(i,e,t){const r=this;let n;return s;function s(c){let h=r.events.length,u;for(;h--;)if(r.events[h][1].type!=="lineEnding"&&r.events[h][1].type!=="linePrefix"&&r.events[h][1].type!=="content"){u=r.events[h][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||u)?(i.enter("setextHeadingLine"),n=c,l(c)):t(c)}function l(c){return i.enter("setextHeadingLineSequence"),o(c)}function o(c){return c===n?(i.consume(c),o):(i.exit("setextHeadingLineSequence"),be(c)?we(i,a,"lineSuffix")(c):a(c))}function a(c){return c===null||ae(c)?(i.exit("setextHeadingLine"),e(c)):t(c)}}const Yb={tokenize:Qb};function Qb(i){const e=this,t=i.attempt(Xn,r,i.attempt(this.parser.constructs.flowInitial,n,we(i,i.attempt(this.parser.constructs.flow,n,i.attempt(rb,n)),"linePrefix")));return t;function r(s){if(s===null){i.consume(s);return}return i.enter("lineEndingBlank"),i.consume(s),i.exit("lineEndingBlank"),e.currentConstruct=void 0,t}function n(s){if(s===null){i.consume(s);return}return i.enter("lineEnding"),i.consume(s),i.exit("lineEnding"),e.currentConstruct=void 0,t}}const Zb={resolveAll:pp()},e1=dp("string"),t1=dp("text");function dp(i){return{resolveAll:pp(i==="text"?i1:void 0),tokenize:e};function e(t){const r=this,n=this.parser.constructs[i],s=t.attempt(n,l,o);return l;function l(h){return c(h)?s(h):o(h)}function o(h){if(h===null){t.consume(h);return}return t.enter("data"),t.consume(h),a}function a(h){return c(h)?(t.exit("data"),s(h)):(t.consume(h),a)}function c(h){if(h===null)return!0;const u=n[h];let f=-1;if(u)for(;++f<u.length;){const d=u[f];if(!d.previous||d.previous.call(r,r.previous))return!0}return!1}}}function pp(i){return e;function e(t,r){let n=-1,s;for(;++n<=t.length;)s===void 0?t[n]&&t[n][1].type==="data"&&(s=n,n++):(!t[n]||t[n][1].type!=="data")&&(n!==s+2&&(t[s][1].end=t[n-1][1].end,t.splice(s+2,n-s-2),n=s+2),s=void 0);return i?i(t,r):t}}function i1(i,e){let t=0;for(;++t<=i.length;)if((t===i.length||i[t][1].type==="lineEnding")&&i[t-1][1].type==="data"){const r=i[t-1][1],n=e.sliceStream(r);let s=n.length,l=-1,o=0,a;for(;s--;){const c=n[s];if(typeof c=="string"){for(l=c.length;c.charCodeAt(l-1)===32;)o++,l--;if(l)break;l=-1}else if(c===-2)a=!0,o++;else if(c!==-1){s++;break}}if(e._contentTypeTextTrailing&&t===i.length&&(o=0),o){const c={type:t===i.length||a||o<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:s?l:r.start._bufferIndex+l,_index:r.start._index+s,line:r.end.line,column:r.end.column-o,offset:r.end.offset-o},end:{...r.end}};r.end={...c.start},r.start.offset===r.end.offset?Object.assign(r,c):(i.splice(t,0,["enter",c,e],["exit",c,e]),t+=2)}t++}return i}const r1={42:yt,43:yt,45:yt,48:yt,49:yt,50:yt,51:yt,52:yt,53:yt,54:yt,55:yt,56:yt,57:yt,62:op},n1={91:ab},s1={[-2]:Jo,[-1]:Jo,32:Jo},o1={35:pb,42:Fs,45:[iu,Fs],60:_b,61:iu,95:Fs,96:eu,126:eu},l1={38:ap,92:lp},a1={[-5]:Yo,[-4]:Yo,[-3]:Yo,33:Ib,38:ap,42:Ql,60:[Fy,kb],91:Fb,92:[fb,lp],93:dc,95:Ql,96:Yy},c1={null:[Ql,Zb]},h1={null:[42,95]},u1={null:[]},f1=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:h1,contentInitial:n1,disable:u1,document:r1,flow:o1,flowInitial:s1,insideSpan:c1,string:l1,text:a1},Symbol.toStringTag,{value:"Module"}));function d1(i,e,t){let r={_bufferIndex:-1,_index:0,line:t&&t.line||1,column:t&&t.column||1,offset:t&&t.offset||0};const n={},s=[];let l=[],o=[];const a={attempt:C(S),check:C(x),consume:g,enter:v,exit:b,interrupt:C(x,{interrupt:!0})},c={code:null,containerState:{},defineSkip:_,events:[],now:y,parser:i,previous:null,sliceSerialize:f,sliceStream:d,write:u};let h=e.tokenize.call(c,a);return e.resolveAll&&s.push(e),c;function u(M){return l=It(l,M),m(),l[l.length-1]!==null?[]:(w(e,0),c.events=Co(s,c.events,c),c.events)}function f(M,T){return m1(d(M),T)}function d(M){return p1(l,M)}function y(){const{_bufferIndex:M,_index:T,line:B,column:F,offset:j}=r;return{_bufferIndex:M,_index:T,line:B,column:F,offset:j}}function _(M){n[M.line]=M.column,A()}function m(){let M;for(;r._index<l.length;){const T=l[r._index];if(typeof T=="string")for(M=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===M&&r._bufferIndex<T.length;)p(T.charCodeAt(r._bufferIndex));else p(T)}}function p(M){h=h(M)}function g(M){ae(M)?(r.line++,r.column=1,r.offset+=M===-3?2:1,A()):M!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===l[r._index].length&&(r._bufferIndex=-1,r._index++)),c.previous=M}function v(M,T){const B=T||{};return B.type=M,B.start=y(),c.events.push(["enter",B,c]),o.push(B),B}function b(M){const T=o.pop();return T.end=y(),c.events.push(["exit",T,c]),T}function S(M,T){w(M,T.from)}function x(M,T){T.restore()}function C(M,T){return B;function B(F,j,z){let $,V,L,k;return Array.isArray(F)?H(F):"tokenize"in F?H([F]):I(F);function I(re){return O;function O(R){const K=R!==null&&re[R],W=R!==null&&re.null,Q=[...Array.isArray(K)?K:K?[K]:[],...Array.isArray(W)?W:W?[W]:[]];return H(Q)(R)}}function H(re){return $=re,V=0,re.length===0?z:P(re[V])}function P(re){return O;function O(R){return k=E(),L=re,re.partial||(c.currentConstruct=re),re.name&&c.parser.constructs.disable.null.includes(re.name)?ee():re.tokenize.call(T?Object.assign(Object.create(c),T):c,a,X,ee)(R)}}function X(re){return M(L,k),j}function ee(re){return k.restore(),++V<$.length?P($[V]):z}}}function w(M,T){M.resolveAll&&!s.includes(M)&&s.push(M),M.resolve&&Pt(c.events,T,c.events.length-T,M.resolve(c.events.slice(T),c)),M.resolveTo&&(c.events=M.resolveTo(c.events,c))}function E(){const M=y(),T=c.previous,B=c.currentConstruct,F=c.events.length,j=Array.from(o);return{from:F,restore:z};function z(){r=M,c.previous=T,c.currentConstruct=B,c.events.length=F,o=j,A()}}function A(){r.line in n&&r.column<2&&(r.column=n[r.line],r.offset+=n[r.line]-1)}}function p1(i,e){const t=e.start._index,r=e.start._bufferIndex,n=e.end._index,s=e.end._bufferIndex;let l;if(t===n)l=[i[t].slice(r,s)];else{if(l=i.slice(t,n),r>-1){const o=l[0];typeof o=="string"?l[0]=o.slice(r):l.shift()}s>0&&l.push(i[n].slice(0,s))}return l}function m1(i,e){let t=-1;const r=[];let n;for(;++t<i.length;){const s=i[t];let l;if(typeof s=="string")l=s;else switch(s){case-5:{l="\r";break}case-4:{l=`
`;break}case-3:{l=`\r
`;break}case-2:{l=e?" ":"	";break}case-1:{if(!e&&n)continue;l=" ";break}default:l=String.fromCharCode(s)}n=s===-2,r.push(l)}return r.join("")}function g1(i){const r={constructs:np([f1,...(i||{}).extensions||[]]),content:n(Ty),defined:[],document:n(Py),flow:n(Yb),lazy:{},string:n(e1),text:n(t1)};return r;function n(s){return l;function l(o){return d1(r,s,o)}}}function v1(i){for(;!cp(i););return i}const ru=/[\0\t\n\r]/g;function _1(){let i=1,e="",t=!0,r;return n;function n(s,l,o){const a=[];let c,h,u,f,d;for(s=e+(typeof s=="string"?s.toString():new TextDecoder(l||void 0).decode(s)),u=0,e="",t&&(s.charCodeAt(0)===65279&&u++,t=void 0);u<s.length;){if(ru.lastIndex=u,c=ru.exec(s),f=c&&c.index!==void 0?c.index:s.length,d=s.charCodeAt(f),!c){e=s.slice(u);break}if(d===10&&u===f&&r)a.push(-3),r=void 0;else switch(r&&(a.push(-5),r=void 0),u<f&&(a.push(s.slice(u,f)),i+=f-u),d){case 0:{a.push(65533),i++;break}case 9:{for(h=Math.ceil(i/4)*4,a.push(-2);i++<h;)a.push(-1);break}case 10:{a.push(-4),i=1;break}default:r=!0,i=1}u=f+1}return o&&(r&&a.push(-5),e&&a.push(e),a.push(null)),a}}const y1=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function b1(i){return i.replace(y1,x1)}function x1(i,e,t){if(e)return e;if(t.charCodeAt(0)===35){const n=t.charCodeAt(1),s=n===120||n===88;return sp(t.slice(s?2:1),s?16:10)}return fc(t)||i}const mp={}.hasOwnProperty;function S1(i,e,t){return typeof e!="string"&&(t=e,e=void 0),w1(t)(v1(g1(t).document().write(_1()(i,e,!0))))}function w1(i){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:s(ki),autolinkProtocol:E,autolinkEmail:E,atxHeading:s(Le),blockQuote:s(W),characterEscape:E,characterReference:E,codeFenced:s(Q),codeFencedFenceInfo:l,codeFencedFenceMeta:l,codeIndented:s(Q,l),codeText:s(Y,l),codeTextData:E,data:E,codeFlowValue:E,definition:s(ge),definitionDestinationString:l,definitionLabelString:l,definitionTitleString:l,emphasis:s(Be),hardBreakEscape:s(Ue),hardBreakTrailing:s(Ue),htmlFlow:s(ce,l),htmlFlowData:E,htmlText:s(ce,l),htmlTextData:E,image:s(Vt),label:l,link:s(ki),listItem:s(Bt),listItemValue:f,listOrdered:s(Ei,u),listUnordered:s(Ei),paragraph:s(Ai),reference:P,referenceString:l,resourceDestinationString:l,resourceTitleString:l,setextHeading:s(Le),strong:s(Je),thematicBreak:s(_t)},exit:{atxHeading:a(),atxHeadingSequence:S,autolink:a(),autolinkEmail:K,autolinkProtocol:R,blockQuote:a(),characterEscapeValue:A,characterReferenceMarkerHexadecimal:ee,characterReferenceMarkerNumeric:ee,characterReferenceValue:re,characterReference:O,codeFenced:a(m),codeFencedFence:_,codeFencedFenceInfo:d,codeFencedFenceMeta:y,codeFlowValue:A,codeIndented:a(p),codeText:a(j),codeTextData:A,data:A,definition:a(),definitionDestinationString:b,definitionLabelString:g,definitionTitleString:v,emphasis:a(),hardBreakEscape:a(T),hardBreakTrailing:a(T),htmlFlow:a(B),htmlFlowData:A,htmlText:a(F),htmlTextData:A,image:a($),label:L,labelText:V,lineEnding:M,link:a(z),listItem:a(),listOrdered:a(),listUnordered:a(),paragraph:a(),referenceString:X,resourceDestinationString:k,resourceTitleString:I,resource:H,setextHeading:a(w),setextHeadingLineSequence:C,setextHeadingText:x,strong:a(),thematicBreak:a()}};gp(e,(i||{}).mdastExtensions||[]);const t={};return r;function r(U){let Z={type:"root",children:[]};const le={stack:[Z],tokenStack:[],config:e,enter:o,exit:c,buffer:l,resume:h,data:t},de=[];let _e=-1;for(;++_e<U.length;)if(U[_e][1].type==="listOrdered"||U[_e][1].type==="listUnordered")if(U[_e][0]==="enter")de.push(_e);else{const qe=de.pop();_e=n(U,qe,_e)}for(_e=-1;++_e<U.length;){const qe=e[U[_e][0]];mp.call(qe,U[_e][1].type)&&qe[U[_e][1].type].call(Object.assign({sliceSerialize:U[_e][2].sliceSerialize},le),U[_e][1])}if(le.tokenStack.length>0){const qe=le.tokenStack[le.tokenStack.length-1];(qe[1]||nu).call(le,void 0,qe[0])}for(Z.position={start:Li(U.length>0?U[0][1].start:{line:1,column:1,offset:0}),end:Li(U.length>0?U[U.length-2][1].end:{line:1,column:1,offset:0})},_e=-1;++_e<e.transforms.length;)Z=e.transforms[_e](Z)||Z;return Z}function n(U,Z,le){let de=Z-1,_e=-1,qe=!1,Ce,ct,Xi,Ji;for(;++de<=le;){const it=U[de];switch(it[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{it[0]==="enter"?_e++:_e--,Ji=void 0;break}case"lineEndingBlank":{it[0]==="enter"&&(Ce&&!Ji&&!_e&&!Xi&&(Xi=de),Ji=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Ji=void 0}if(!_e&&it[0]==="enter"&&it[1].type==="listItemPrefix"||_e===-1&&it[0]==="exit"&&(it[1].type==="listUnordered"||it[1].type==="listOrdered")){if(Ce){let te=de;for(ct=void 0;te--;){const fe=U[te];if(fe[1].type==="lineEnding"||fe[1].type==="lineEndingBlank"){if(fe[0]==="exit")continue;ct&&(U[ct][1].type="lineEndingBlank",qe=!0),fe[1].type="lineEnding",ct=te}else if(!(fe[1].type==="linePrefix"||fe[1].type==="blockQuotePrefix"||fe[1].type==="blockQuotePrefixWhitespace"||fe[1].type==="blockQuoteMarker"||fe[1].type==="listItemIndent"))break}Xi&&(!ct||Xi<ct)&&(Ce._spread=!0),Ce.end=Object.assign({},ct?U[ct][1].start:it[1].end),U.splice(ct||de,0,["exit",Ce,it[2]]),de++,le++}if(it[1].type==="listItemPrefix"){const te={type:"listItem",_spread:!1,start:Object.assign({},it[1].start),end:void 0};Ce=te,U.splice(de,0,["enter",te,it[2]]),de++,le++,Xi=void 0,Ji=!0}}}return U[Z][1]._spread=qe,le}function s(U,Z){return le;function le(de){o.call(this,U(de),de),Z&&Z.call(this,de)}}function l(){this.stack.push({type:"fragment",children:[]})}function o(U,Z,le){this.stack[this.stack.length-1].children.push(U),this.stack.push(U),this.tokenStack.push([Z,le||void 0]),U.position={start:Li(Z.start),end:void 0}}function a(U){return Z;function Z(le){U&&U.call(this,le),c.call(this,le)}}function c(U,Z){const le=this.stack.pop(),de=this.tokenStack.pop();if(de)de[0].type!==U.type&&(Z?Z.call(this,U,de[0]):(de[1]||nu).call(this,U,de[0]));else throw new Error("Cannot close `"+U.type+"` ("+vn({start:U.start,end:U.end})+"): it’s not open");le.position.end=Li(U.end)}function h(){return uc(this.stack.pop())}function u(){this.data.expectingFirstListItemValue=!0}function f(U){if(this.data.expectingFirstListItemValue){const Z=this.stack[this.stack.length-2];Z.start=Number.parseInt(this.sliceSerialize(U),10),this.data.expectingFirstListItemValue=void 0}}function d(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.lang=U}function y(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.meta=U}function _(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function m(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.value=U.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function p(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.value=U.replace(/(\r?\n|\r)$/g,"")}function g(U){const Z=this.resume(),le=this.stack[this.stack.length-1];le.label=Z,le.identifier=Xt(this.sliceSerialize(U)).toLowerCase()}function v(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.title=U}function b(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.url=U}function S(U){const Z=this.stack[this.stack.length-1];if(!Z.depth){const le=this.sliceSerialize(U).length;Z.depth=le}}function x(){this.data.setextHeadingSlurpLineEnding=!0}function C(U){const Z=this.stack[this.stack.length-1];Z.depth=this.sliceSerialize(U).codePointAt(0)===61?1:2}function w(){this.data.setextHeadingSlurpLineEnding=void 0}function E(U){const le=this.stack[this.stack.length-1].children;let de=le[le.length-1];(!de||de.type!=="text")&&(de=mi(),de.position={start:Li(U.start),end:void 0},le.push(de)),this.stack.push(de)}function A(U){const Z=this.stack.pop();Z.value+=this.sliceSerialize(U),Z.position.end=Li(U.end)}function M(U){const Z=this.stack[this.stack.length-1];if(this.data.atHardBreak){const le=Z.children[Z.children.length-1];le.position.end=Li(U.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(Z.type)&&(E.call(this,U),A.call(this,U))}function T(){this.data.atHardBreak=!0}function B(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.value=U}function F(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.value=U}function j(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.value=U}function z(){const U=this.stack[this.stack.length-1];if(this.data.inReference){const Z=this.data.referenceType||"shortcut";U.type+="Reference",U.referenceType=Z,delete U.url,delete U.title}else delete U.identifier,delete U.label;this.data.referenceType=void 0}function $(){const U=this.stack[this.stack.length-1];if(this.data.inReference){const Z=this.data.referenceType||"shortcut";U.type+="Reference",U.referenceType=Z,delete U.url,delete U.title}else delete U.identifier,delete U.label;this.data.referenceType=void 0}function V(U){const Z=this.sliceSerialize(U),le=this.stack[this.stack.length-2];le.label=b1(Z),le.identifier=Xt(Z).toLowerCase()}function L(){const U=this.stack[this.stack.length-1],Z=this.resume(),le=this.stack[this.stack.length-1];if(this.data.inReference=!0,le.type==="link"){const de=U.children;le.children=de}else le.alt=Z}function k(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.url=U}function I(){const U=this.resume(),Z=this.stack[this.stack.length-1];Z.title=U}function H(){this.data.inReference=void 0}function P(){this.data.referenceType="collapsed"}function X(U){const Z=this.resume(),le=this.stack[this.stack.length-1];le.label=Z,le.identifier=Xt(this.sliceSerialize(U)).toLowerCase(),this.data.referenceType="full"}function ee(U){this.data.characterReferenceType=U.type}function re(U){const Z=this.sliceSerialize(U),le=this.data.characterReferenceType;let de;le?(de=sp(Z,le==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):de=fc(Z);const _e=this.stack[this.stack.length-1];_e.value+=de}function O(U){const Z=this.stack.pop();Z.position.end=Li(U.end)}function R(U){A.call(this,U);const Z=this.stack[this.stack.length-1];Z.url=this.sliceSerialize(U)}function K(U){A.call(this,U);const Z=this.stack[this.stack.length-1];Z.url="mailto:"+this.sliceSerialize(U)}function W(){return{type:"blockquote",children:[]}}function Q(){return{type:"code",lang:null,meta:null,value:""}}function Y(){return{type:"inlineCode",value:""}}function ge(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Be(){return{type:"emphasis",children:[]}}function Le(){return{type:"heading",depth:0,children:[]}}function Ue(){return{type:"break"}}function ce(){return{type:"html",value:""}}function Vt(){return{type:"image",title:null,url:"",alt:null}}function ki(){return{type:"link",title:null,url:"",children:[]}}function Ei(U){return{type:"list",ordered:U.type==="listOrdered",start:null,spread:U._spread,children:[]}}function Bt(U){return{type:"listItem",spread:U._spread,checked:null,children:[]}}function Ai(){return{type:"paragraph",children:[]}}function Je(){return{type:"strong",children:[]}}function mi(){return{type:"text",value:""}}function _t(){return{type:"thematicBreak"}}}function Li(i){return{line:i.line,column:i.column,offset:i.offset}}function gp(i,e){let t=-1;for(;++t<e.length;){const r=e[t];Array.isArray(r)?gp(i,r):C1(i,r)}}function C1(i,e){let t;for(t in e)if(mp.call(e,t))switch(t){case"canContainEols":{const r=e[t];r&&i[t].push(...r);break}case"transforms":{const r=e[t];r&&i[t].push(...r);break}case"enter":case"exit":{const r=e[t];r&&Object.assign(i[t],r);break}}}function nu(i,e){throw i?new Error("Cannot close `"+i.type+"` ("+vn({start:i.start,end:i.end})+"): a different token (`"+e.type+"`, "+vn({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+vn({start:e.start,end:e.end})+") is still open")}function k1(i){const e=this;e.parser=t;function t(r){return S1(r,{...e.data("settings"),...i,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function E1(i,e){const t={type:"element",tagName:"blockquote",properties:{},children:i.wrap(i.all(e),!0)};return i.patch(e,t),i.applyData(e,t)}function A1(i,e){const t={type:"element",tagName:"br",properties:{},children:[]};return i.patch(e,t),[i.applyData(e,t),{type:"text",value:`
`}]}function D1(i,e){const t=e.value?e.value+`
`:"",r={},n=e.lang?e.lang.split(/\s+/):[];n.length>0&&(r.className=["language-"+n[0]]);let s={type:"element",tagName:"code",properties:r,children:[{type:"text",value:t}]};return e.meta&&(s.data={meta:e.meta}),i.patch(e,s),s=i.applyData(e,s),s={type:"element",tagName:"pre",properties:{},children:[s]},i.patch(e,s),s}function L1(i,e){const t={type:"element",tagName:"del",properties:{},children:i.all(e)};return i.patch(e,t),i.applyData(e,t)}function M1(i,e){const t={type:"element",tagName:"em",properties:{},children:i.all(e)};return i.patch(e,t),i.applyData(e,t)}function T1(i,e){const t=typeof i.options.clobberPrefix=="string"?i.options.clobberPrefix:"user-content-",r=String(e.identifier).toUpperCase(),n=Yr(r.toLowerCase()),s=i.footnoteOrder.indexOf(r);let l,o=i.footnoteCounts.get(r);o===void 0?(o=0,i.footnoteOrder.push(r),l=i.footnoteOrder.length):l=s+1,o+=1,i.footnoteCounts.set(r,o);const a={type:"element",tagName:"a",properties:{href:"#"+t+"fn-"+n,id:t+"fnref-"+n+(o>1?"-"+o:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(l)}]};i.patch(e,a);const c={type:"element",tagName:"sup",properties:{},children:[a]};return i.patch(e,c),i.applyData(e,c)}function R1(i,e){const t={type:"element",tagName:"h"+e.depth,properties:{},children:i.all(e)};return i.patch(e,t),i.applyData(e,t)}function P1(i,e){if(i.options.allowDangerousHtml){const t={type:"raw",value:e.value};return i.patch(e,t),i.applyData(e,t)}}function vp(i,e){const t=e.referenceType;let r="]";if(t==="collapsed"?r+="[]":t==="full"&&(r+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+r}];const n=i.all(e),s=n[0];s&&s.type==="text"?s.value="["+s.value:n.unshift({type:"text",value:"["});const l=n[n.length-1];return l&&l.type==="text"?l.value+=r:n.push({type:"text",value:r}),n}function B1(i,e){const t=String(e.identifier).toUpperCase(),r=i.definitionById.get(t);if(!r)return vp(i,e);const n={src:Yr(r.url||""),alt:e.alt};r.title!==null&&r.title!==void 0&&(n.title=r.title);const s={type:"element",tagName:"img",properties:n,children:[]};return i.patch(e,s),i.applyData(e,s)}function O1(i,e){const t={src:Yr(e.url)};e.alt!==null&&e.alt!==void 0&&(t.alt=e.alt),e.title!==null&&e.title!==void 0&&(t.title=e.title);const r={type:"element",tagName:"img",properties:t,children:[]};return i.patch(e,r),i.applyData(e,r)}function I1(i,e){const t={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};i.patch(e,t);const r={type:"element",tagName:"code",properties:{},children:[t]};return i.patch(e,r),i.applyData(e,r)}function N1(i,e){const t=String(e.identifier).toUpperCase(),r=i.definitionById.get(t);if(!r)return vp(i,e);const n={href:Yr(r.url||"")};r.title!==null&&r.title!==void 0&&(n.title=r.title);const s={type:"element",tagName:"a",properties:n,children:i.all(e)};return i.patch(e,s),i.applyData(e,s)}function F1(i,e){const t={href:Yr(e.url)};e.title!==null&&e.title!==void 0&&(t.title=e.title);const r={type:"element",tagName:"a",properties:t,children:i.all(e)};return i.patch(e,r),i.applyData(e,r)}function H1(i,e,t){const r=i.all(e),n=t?j1(t):_p(e),s={},l=[];if(typeof e.checked=="boolean"){const h=r[0];let u;h&&h.type==="element"&&h.tagName==="p"?u=h:(u={type:"element",tagName:"p",properties:{},children:[]},r.unshift(u)),u.children.length>0&&u.children.unshift({type:"text",value:" "}),u.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),s.className=["task-list-item"]}let o=-1;for(;++o<r.length;){const h=r[o];(n||o!==0||h.type!=="element"||h.tagName!=="p")&&l.push({type:"text",value:`
`}),h.type==="element"&&h.tagName==="p"&&!n?l.push(...h.children):l.push(h)}const a=r[r.length-1];a&&(n||a.type!=="element"||a.tagName!=="p")&&l.push({type:"text",value:`
`});const c={type:"element",tagName:"li",properties:s,children:l};return i.patch(e,c),i.applyData(e,c)}function j1(i){let e=!1;if(i.type==="list"){e=i.spread||!1;const t=i.children;let r=-1;for(;!e&&++r<t.length;)e=_p(t[r])}return e}function _p(i){const e=i.spread;return e??i.children.length>1}function z1(i,e){const t={},r=i.all(e);let n=-1;for(typeof e.start=="number"&&e.start!==1&&(t.start=e.start);++n<r.length;){const l=r[n];if(l.type==="element"&&l.tagName==="li"&&l.properties&&Array.isArray(l.properties.className)&&l.properties.className.includes("task-list-item")){t.className=["contains-task-list"];break}}const s={type:"element",tagName:e.ordered?"ol":"ul",properties:t,children:i.wrap(r,!0)};return i.patch(e,s),i.applyData(e,s)}function W1(i,e){const t={type:"element",tagName:"p",properties:{},children:i.all(e)};return i.patch(e,t),i.applyData(e,t)}function $1(i,e){const t={type:"root",children:i.wrap(i.all(e))};return i.patch(e,t),i.applyData(e,t)}function V1(i,e){const t={type:"element",tagName:"strong",properties:{},children:i.all(e)};return i.patch(e,t),i.applyData(e,t)}function U1(i,e){const t=i.all(e),r=t.shift(),n=[];if(r){const l={type:"element",tagName:"thead",properties:{},children:i.wrap([r],!0)};i.patch(e.children[0],l),n.push(l)}if(t.length>0){const l={type:"element",tagName:"tbody",properties:{},children:i.wrap(t,!0)},o=lc(e.children[1]),a=Yd(e.children[e.children.length-1]);o&&a&&(l.position={start:o,end:a}),n.push(l)}const s={type:"element",tagName:"table",properties:{},children:i.wrap(n,!0)};return i.patch(e,s),i.applyData(e,s)}function q1(i,e,t){const r=t?t.children:void 0,s=(r?r.indexOf(e):1)===0?"th":"td",l=t&&t.type==="table"?t.align:void 0,o=l?l.length:e.children.length;let a=-1;const c=[];for(;++a<o;){const u=e.children[a],f={},d=l?l[a]:void 0;d&&(f.align=d);let y={type:"element",tagName:s,properties:f,children:[]};u&&(y.children=i.all(u),i.patch(u,y),y=i.applyData(u,y)),c.push(y)}const h={type:"element",tagName:"tr",properties:{},children:i.wrap(c,!0)};return i.patch(e,h),i.applyData(e,h)}function K1(i,e){const t={type:"element",tagName:"td",properties:{},children:i.all(e)};return i.patch(e,t),i.applyData(e,t)}const su=9,ou=32;function G1(i){const e=String(i),t=/\r?\n|\r/g;let r=t.exec(e),n=0;const s=[];for(;r;)s.push(lu(e.slice(n,r.index),n>0,!0),r[0]),n=r.index+r[0].length,r=t.exec(e);return s.push(lu(e.slice(n),n>0,!1)),s.join("")}function lu(i,e,t){let r=0,n=i.length;if(e){let s=i.codePointAt(r);for(;s===su||s===ou;)r++,s=i.codePointAt(r)}if(t){let s=i.codePointAt(n-1);for(;s===su||s===ou;)n--,s=i.codePointAt(n-1)}return n>r?i.slice(r,n):""}function X1(i,e){const t={type:"text",value:G1(String(e.value))};return i.patch(e,t),i.applyData(e,t)}function J1(i,e){const t={type:"element",tagName:"hr",properties:{},children:[]};return i.patch(e,t),i.applyData(e,t)}const Y1={blockquote:E1,break:A1,code:D1,delete:L1,emphasis:M1,footnoteReference:T1,heading:R1,html:P1,imageReference:B1,image:O1,inlineCode:I1,linkReference:N1,link:F1,listItem:H1,list:z1,paragraph:W1,root:$1,strong:V1,table:U1,tableCell:K1,tableRow:q1,text:X1,thematicBreak:J1,toml:as,yaml:as,definition:as,footnoteDefinition:as};function as(){}const yp=-1,ko=0,yn=1,Ks=2,pc=3,mc=4,gc=5,vc=6,bp=7,xp=8,au=typeof self=="object"?self:globalThis,Q1=(i,e)=>{const t=(n,s)=>(i.set(s,n),n),r=n=>{if(i.has(n))return i.get(n);const[s,l]=e[n];switch(s){case ko:case yp:return t(l,n);case yn:{const o=t([],n);for(const a of l)o.push(r(a));return o}case Ks:{const o=t({},n);for(const[a,c]of l)o[r(a)]=r(c);return o}case pc:return t(new Date(l),n);case mc:{const{source:o,flags:a}=l;return t(new RegExp(o,a),n)}case gc:{const o=t(new Map,n);for(const[a,c]of l)o.set(r(a),r(c));return o}case vc:{const o=t(new Set,n);for(const a of l)o.add(r(a));return o}case bp:{const{name:o,message:a}=l;return t(new au[o](a),n)}case xp:return t(BigInt(l),n);case"BigInt":return t(Object(BigInt(l)),n);case"ArrayBuffer":return t(new Uint8Array(l).buffer,l);case"DataView":{const{buffer:o}=new Uint8Array(l);return t(new DataView(o),l)}}return t(new au[s](l),n)};return r},cu=i=>Q1(new Map,i)(0),br="",{toString:Z1}={},{keys:ex}=Object,ln=i=>{const e=typeof i;if(e!=="object"||!i)return[ko,e];const t=Z1.call(i).slice(8,-1);switch(t){case"Array":return[yn,br];case"Object":return[Ks,br];case"Date":return[pc,br];case"RegExp":return[mc,br];case"Map":return[gc,br];case"Set":return[vc,br];case"DataView":return[yn,t]}return t.includes("Array")?[yn,t]:t.includes("Error")?[bp,t]:[Ks,t]},cs=([i,e])=>i===ko&&(e==="function"||e==="symbol"),tx=(i,e,t,r)=>{const n=(l,o)=>{const a=r.push(l)-1;return t.set(o,a),a},s=l=>{if(t.has(l))return t.get(l);let[o,a]=ln(l);switch(o){case ko:{let h=l;switch(a){case"bigint":o=xp,h=l.toString();break;case"function":case"symbol":if(i)throw new TypeError("unable to serialize "+a);h=null;break;case"undefined":return n([yp],l)}return n([o,h],l)}case yn:{if(a){let f=l;return a==="DataView"?f=new Uint8Array(l.buffer):a==="ArrayBuffer"&&(f=new Uint8Array(l)),n([a,[...f]],l)}const h=[],u=n([o,h],l);for(const f of l)h.push(s(f));return u}case Ks:{if(a)switch(a){case"BigInt":return n([a,l.toString()],l);case"Boolean":case"Number":case"String":return n([a,l.valueOf()],l)}if(e&&"toJSON"in l)return s(l.toJSON());const h=[],u=n([o,h],l);for(const f of ex(l))(i||!cs(ln(l[f])))&&h.push([s(f),s(l[f])]);return u}case pc:return n([o,l.toISOString()],l);case mc:{const{source:h,flags:u}=l;return n([o,{source:h,flags:u}],l)}case gc:{const h=[],u=n([o,h],l);for(const[f,d]of l)(i||!(cs(ln(f))||cs(ln(d))))&&h.push([s(f),s(d)]);return u}case vc:{const h=[],u=n([o,h],l);for(const f of l)(i||!cs(ln(f)))&&h.push(s(f));return u}}const{message:c}=l;return n([o,{name:a,message:c}],l)};return s},hu=(i,{json:e,lossy:t}={})=>{const r=[];return tx(!(e||t),!!e,new Map,r)(i),r},Gs=typeof structuredClone=="function"?(i,e)=>e&&("json"in e||"lossy"in e)?cu(hu(i,e)):structuredClone(i):(i,e)=>cu(hu(i,e));function ix(i,e){const t=[{type:"text",value:"↩"}];return e>1&&t.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),t}function rx(i,e){return"Back to reference "+(i+1)+(e>1?"-"+e:"")}function nx(i){const e=typeof i.options.clobberPrefix=="string"?i.options.clobberPrefix:"user-content-",t=i.options.footnoteBackContent||ix,r=i.options.footnoteBackLabel||rx,n=i.options.footnoteLabel||"Footnotes",s=i.options.footnoteLabelTagName||"h2",l=i.options.footnoteLabelProperties||{className:["sr-only"]},o=[];let a=-1;for(;++a<i.footnoteOrder.length;){const c=i.footnoteById.get(i.footnoteOrder[a]);if(!c)continue;const h=i.all(c),u=String(c.identifier).toUpperCase(),f=Yr(u.toLowerCase());let d=0;const y=[],_=i.footnoteCounts.get(u);for(;_!==void 0&&++d<=_;){y.length>0&&y.push({type:"text",value:" "});let g=typeof t=="string"?t:t(a,d);typeof g=="string"&&(g={type:"text",value:g}),y.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+f+(d>1?"-"+d:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(a,d),className:["data-footnote-backref"]},children:Array.isArray(g)?g:[g]})}const m=h[h.length-1];if(m&&m.type==="element"&&m.tagName==="p"){const g=m.children[m.children.length-1];g&&g.type==="text"?g.value+=" ":m.children.push({type:"text",value:" "}),m.children.push(...y)}else h.push(...y);const p={type:"element",tagName:"li",properties:{id:e+"fn-"+f},children:i.wrap(h,!0)};i.patch(c,p),o.push(p)}if(o.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:s,properties:{...Gs(l),id:"footnote-label"},children:[{type:"text",value:n}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:i.wrap(o,!0)},{type:"text",value:`
`}]}}const Eo=(function(i){if(i==null)return ax;if(typeof i=="function")return Ao(i);if(typeof i=="object")return Array.isArray(i)?sx(i):ox(i);if(typeof i=="string")return lx(i);throw new Error("Expected function, string, or object as test")});function sx(i){const e=[];let t=-1;for(;++t<i.length;)e[t]=Eo(i[t]);return Ao(r);function r(...n){let s=-1;for(;++s<e.length;)if(e[s].apply(this,n))return!0;return!1}}function ox(i){const e=i;return Ao(t);function t(r){const n=r;let s;for(s in i)if(n[s]!==e[s])return!1;return!0}}function lx(i){return Ao(e);function e(t){return t&&t.type===i}}function Ao(i){return e;function e(t,r,n){return!!(cx(t)&&i.call(this,t,typeof r=="number"?r:void 0,n||void 0))}}function ax(){return!0}function cx(i){return i!==null&&typeof i=="object"&&"type"in i}const Sp=[],hx=!0,Zl=!1,ux="skip";function wp(i,e,t,r){let n;typeof e=="function"&&typeof t!="function"?(r=t,t=e):n=e;const s=Eo(n),l=r?-1:1;o(i,void 0,[])();function o(a,c,h){const u=a&&typeof a=="object"?a:{};if(typeof u.type=="string"){const d=typeof u.tagName=="string"?u.tagName:typeof u.name=="string"?u.name:void 0;Object.defineProperty(f,"name",{value:"node ("+(a.type+(d?"<"+d+">":""))+")"})}return f;function f(){let d=Sp,y,_,m;if((!e||s(a,c,h[h.length-1]||void 0))&&(d=fx(t(a,h)),d[0]===Zl))return d;if("children"in a&&a.children){const p=a;if(p.children&&d[0]!==ux)for(_=(r?p.children.length:-1)+l,m=h.concat(p);_>-1&&_<p.children.length;){const g=p.children[_];if(y=o(g,_,m)(),y[0]===Zl)return y;_=typeof y[1]=="number"?y[1]:_+l}}return d}}}function fx(i){return Array.isArray(i)?i:typeof i=="number"?[hx,i]:i==null?Sp:[i]}function _c(i,e,t,r){let n,s,l;typeof e=="function"&&typeof t!="function"?(s=void 0,l=e,n=t):(s=e,l=t,n=r),wp(i,s,o,n);function o(a,c){const h=c[c.length-1],u=h?h.children.indexOf(a):void 0;return l(a,u,h)}}const ea={}.hasOwnProperty,dx={};function px(i,e){const t=e||dx,r=new Map,n=new Map,s=new Map,l={...Y1,...t.handlers},o={all:c,applyData:gx,definitionById:r,footnoteById:n,footnoteCounts:s,footnoteOrder:[],handlers:l,one:a,options:t,patch:mx,wrap:_x};return _c(i,function(h){if(h.type==="definition"||h.type==="footnoteDefinition"){const u=h.type==="definition"?r:n,f=String(h.identifier).toUpperCase();u.has(f)||u.set(f,h)}}),o;function a(h,u){const f=h.type,d=o.handlers[f];if(ea.call(o.handlers,f)&&d)return d(o,h,u);if(o.options.passThrough&&o.options.passThrough.includes(f)){if("children"in h){const{children:_,...m}=h,p=Gs(m);return p.children=o.all(h),p}return Gs(h)}return(o.options.unknownHandler||vx)(o,h,u)}function c(h){const u=[];if("children"in h){const f=h.children;let d=-1;for(;++d<f.length;){const y=o.one(f[d],h);if(y){if(d&&f[d-1].type==="break"&&(!Array.isArray(y)&&y.type==="text"&&(y.value=uu(y.value)),!Array.isArray(y)&&y.type==="element")){const _=y.children[0];_&&_.type==="text"&&(_.value=uu(_.value))}Array.isArray(y)?u.push(...y):u.push(y)}}}return u}}function mx(i,e){i.position&&(e.position=ry(i))}function gx(i,e){let t=e;if(i&&i.data){const r=i.data.hName,n=i.data.hChildren,s=i.data.hProperties;if(typeof r=="string")if(t.type==="element")t.tagName=r;else{const l="children"in t?t.children:[t];t={type:"element",tagName:r,properties:{},children:l}}t.type==="element"&&s&&Object.assign(t.properties,Gs(s)),"children"in t&&t.children&&n!==null&&n!==void 0&&(t.children=n)}return t}function vx(i,e){const t=e.data||{},r="value"in e&&!(ea.call(t,"hProperties")||ea.call(t,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:i.all(e)};return i.patch(e,r),i.applyData(e,r)}function _x(i,e){const t=[];let r=-1;for(e&&t.push({type:"text",value:`
`});++r<i.length;)r&&t.push({type:"text",value:`
`}),t.push(i[r]);return e&&i.length>0&&t.push({type:"text",value:`
`}),t}function uu(i){let e=0,t=i.charCodeAt(e);for(;t===9||t===32;)e++,t=i.charCodeAt(e);return i.slice(e)}function fu(i,e){const t=px(i,e),r=t.one(i,void 0),n=nx(t),s=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return n&&s.children.push({type:"text",value:`
`},n),s}function yx(i,e){return i&&"run"in i?async function(t,r){const n=fu(t,{file:r,...e});await i.run(n,r)}:function(t,r){return fu(t,{file:r,...i||e})}}function du(i){if(i)throw i}var Qo,pu;function bx(){if(pu)return Qo;pu=1;var i=Object.prototype.hasOwnProperty,e=Object.prototype.toString,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=function(c){return typeof Array.isArray=="function"?Array.isArray(c):e.call(c)==="[object Array]"},s=function(c){if(!c||e.call(c)!=="[object Object]")return!1;var h=i.call(c,"constructor"),u=c.constructor&&c.constructor.prototype&&i.call(c.constructor.prototype,"isPrototypeOf");if(c.constructor&&!h&&!u)return!1;var f;for(f in c);return typeof f>"u"||i.call(c,f)},l=function(c,h){t&&h.name==="__proto__"?t(c,h.name,{enumerable:!0,configurable:!0,value:h.newValue,writable:!0}):c[h.name]=h.newValue},o=function(c,h){if(h==="__proto__")if(i.call(c,h)){if(r)return r(c,h).value}else return;return c[h]};return Qo=function a(){var c,h,u,f,d,y,_=arguments[0],m=1,p=arguments.length,g=!1;for(typeof _=="boolean"&&(g=_,_=arguments[1]||{},m=2),(_==null||typeof _!="object"&&typeof _!="function")&&(_={});m<p;++m)if(c=arguments[m],c!=null)for(h in c)u=o(_,h),f=o(c,h),_!==f&&(g&&f&&(s(f)||(d=n(f)))?(d?(d=!1,y=u&&n(u)?u:[]):y=u&&s(u)?u:{},l(_,{name:h,newValue:a(g,y,f)})):typeof f<"u"&&l(_,{name:h,newValue:f}));return _},Qo}var xx=bx();const Zo=Sd(xx);function ta(i){if(typeof i!="object"||i===null)return!1;const e=Object.getPrototypeOf(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)}function Sx(){const i=[],e={run:t,use:r};return e;function t(...n){let s=-1;const l=n.pop();if(typeof l!="function")throw new TypeError("Expected function as last argument, not "+l);o(null,...n);function o(a,...c){const h=i[++s];let u=-1;if(a){l(a);return}for(;++u<n.length;)(c[u]===null||c[u]===void 0)&&(c[u]=n[u]);n=c,h?wx(h,o)(...c):l(null,...c)}}function r(n){if(typeof n!="function")throw new TypeError("Expected `middelware` to be a function, not "+n);return i.push(n),e}}function wx(i,e){let t;return r;function r(...l){const o=i.length>l.length;let a;o&&l.push(n);try{a=i.apply(this,l)}catch(c){const h=c;if(o&&t)throw h;return n(h)}o||(a&&a.then&&typeof a.then=="function"?a.then(s,n):a instanceof Error?n(a):s(a))}function n(l,...o){t||(t=!0,e(l,...o))}function s(l){n(null,l)}}const si={basename:Cx,dirname:kx,extname:Ex,join:Ax,sep:"/"};function Cx(i,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');Jn(i);let t=0,r=-1,n=i.length,s;if(e===void 0||e.length===0||e.length>i.length){for(;n--;)if(i.codePointAt(n)===47){if(s){t=n+1;break}}else r<0&&(s=!0,r=n+1);return r<0?"":i.slice(t,r)}if(e===i)return"";let l=-1,o=e.length-1;for(;n--;)if(i.codePointAt(n)===47){if(s){t=n+1;break}}else l<0&&(s=!0,l=n+1),o>-1&&(i.codePointAt(n)===e.codePointAt(o--)?o<0&&(r=n):(o=-1,r=l));return t===r?r=l:r<0&&(r=i.length),i.slice(t,r)}function kx(i){if(Jn(i),i.length===0)return".";let e=-1,t=i.length,r;for(;--t;)if(i.codePointAt(t)===47){if(r){e=t;break}}else r||(r=!0);return e<0?i.codePointAt(0)===47?"/":".":e===1&&i.codePointAt(0)===47?"//":i.slice(0,e)}function Ex(i){Jn(i);let e=i.length,t=-1,r=0,n=-1,s=0,l;for(;e--;){const o=i.codePointAt(e);if(o===47){if(l){r=e+1;break}continue}t<0&&(l=!0,t=e+1),o===46?n<0?n=e:s!==1&&(s=1):n>-1&&(s=-1)}return n<0||t<0||s===0||s===1&&n===t-1&&n===r+1?"":i.slice(n,t)}function Ax(...i){let e=-1,t;for(;++e<i.length;)Jn(i[e]),i[e]&&(t=t===void 0?i[e]:t+"/"+i[e]);return t===void 0?".":Dx(t)}function Dx(i){Jn(i);const e=i.codePointAt(0)===47;let t=Lx(i,!e);return t.length===0&&!e&&(t="."),t.length>0&&i.codePointAt(i.length-1)===47&&(t+="/"),e?"/"+t:t}function Lx(i,e){let t="",r=0,n=-1,s=0,l=-1,o,a;for(;++l<=i.length;){if(l<i.length)o=i.codePointAt(l);else{if(o===47)break;o=47}if(o===47){if(!(n===l-1||s===1))if(n!==l-1&&s===2){if(t.length<2||r!==2||t.codePointAt(t.length-1)!==46||t.codePointAt(t.length-2)!==46){if(t.length>2){if(a=t.lastIndexOf("/"),a!==t.length-1){a<0?(t="",r=0):(t=t.slice(0,a),r=t.length-1-t.lastIndexOf("/")),n=l,s=0;continue}}else if(t.length>0){t="",r=0,n=l,s=0;continue}}e&&(t=t.length>0?t+"/..":"..",r=2)}else t.length>0?t+="/"+i.slice(n+1,l):t=i.slice(n+1,l),r=l-n-1;n=l,s=0}else o===46&&s>-1?s++:s=-1}return t}function Jn(i){if(typeof i!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(i))}const Mx={cwd:Tx};function Tx(){return"/"}function ia(i){return!!(i!==null&&typeof i=="object"&&"href"in i&&i.href&&"protocol"in i&&i.protocol&&i.auth===void 0)}function Rx(i){if(typeof i=="string")i=new URL(i);else if(!ia(i)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+i+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(i.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return Px(i)}function Px(i){if(i.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=i.pathname;let t=-1;for(;++t<e.length;)if(e.codePointAt(t)===37&&e.codePointAt(t+1)===50){const r=e.codePointAt(t+2);if(r===70||r===102){const n=new TypeError("File URL path must not include encoded / characters");throw n.code="ERR_INVALID_FILE_URL_PATH",n}}return decodeURIComponent(e)}const el=["history","path","basename","stem","extname","dirname"];class Cp{constructor(e){let t;e?ia(e)?t={path:e}:typeof e=="string"||Bx(e)?t={value:e}:t=e:t={},this.cwd="cwd"in t?"":Mx.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<el.length;){const s=el[r];s in t&&t[s]!==void 0&&t[s]!==null&&(this[s]=s==="history"?[...t[s]]:t[s])}let n;for(n in t)el.includes(n)||(this[n]=t[n])}get basename(){return typeof this.path=="string"?si.basename(this.path):void 0}set basename(e){il(e,"basename"),tl(e,"basename"),this.path=si.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?si.dirname(this.path):void 0}set dirname(e){mu(this.basename,"dirname"),this.path=si.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?si.extname(this.path):void 0}set extname(e){if(tl(e,"extname"),mu(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=si.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){ia(e)&&(e=Rx(e)),il(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?si.basename(this.path,this.extname):void 0}set stem(e){il(e,"stem"),tl(e,"stem"),this.path=si.join(this.dirname||"",e+(this.extname||""))}fail(e,t,r){const n=this.message(e,t,r);throw n.fatal=!0,n}info(e,t,r){const n=this.message(e,t,r);return n.fatal=void 0,n}message(e,t,r){const n=new lt(e,t,r);return this.path&&(n.name=this.path+":"+n.name,n.file=this.path),n.fatal=!1,this.messages.push(n),n}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function tl(i,e){if(i&&i.includes(si.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+si.sep+"`")}function il(i,e){if(!i)throw new Error("`"+e+"` cannot be empty")}function mu(i,e){if(!i)throw new Error("Setting `"+e+"` requires `path` to be set too")}function Bx(i){return!!(i&&typeof i=="object"&&"byteLength"in i&&"byteOffset"in i)}const Ox=(function(i){const r=this.constructor.prototype,n=r[i],s=function(){return n.apply(s,arguments)};return Object.setPrototypeOf(s,r),s}),Ix={}.hasOwnProperty;class yc extends Ox{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=Sx()}copy(){const e=new yc;let t=-1;for(;++t<this.attachers.length;){const r=this.attachers[t];e.use(...r)}return e.data(Zo(!0,{},this.namespace)),e}data(e,t){return typeof e=="string"?arguments.length===2?(sl("data",this.frozen),this.namespace[e]=t,this):Ix.call(this.namespace,e)&&this.namespace[e]||void 0:e?(sl("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[t,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const n=t.call(e,...r);typeof n=="function"&&this.transformers.use(n)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const t=hs(e),r=this.parser||this.Parser;return rl("parse",r),r(String(t),t)}process(e,t){const r=this;return this.freeze(),rl("process",this.parser||this.Parser),nl("process",this.compiler||this.Compiler),t?n(void 0,t):new Promise(n);function n(s,l){const o=hs(e),a=r.parse(o);r.run(a,o,function(h,u,f){if(h||!u||!f)return c(h);const d=u,y=r.stringify(d,f);Hx(y)?f.value=y:f.result=y,c(h,f)});function c(h,u){h||!u?l(h):s?s(u):t(void 0,u)}}}processSync(e){let t=!1,r;return this.freeze(),rl("processSync",this.parser||this.Parser),nl("processSync",this.compiler||this.Compiler),this.process(e,n),vu("processSync","process",t),r;function n(s,l){t=!0,du(s),r=l}}run(e,t,r){gu(e),this.freeze();const n=this.transformers;return!r&&typeof t=="function"&&(r=t,t=void 0),r?s(void 0,r):new Promise(s);function s(l,o){const a=hs(t);n.run(e,a,c);function c(h,u,f){const d=u||e;h?o(h):l?l(d):r(void 0,d,f)}}}runSync(e,t){let r=!1,n;return this.run(e,t,s),vu("runSync","run",r),n;function s(l,o){du(l),n=o,r=!0}}stringify(e,t){this.freeze();const r=hs(t),n=this.compiler||this.Compiler;return nl("stringify",n),gu(e),n(e,r)}use(e,...t){const r=this.attachers,n=this.namespace;if(sl("use",this.frozen),e!=null)if(typeof e=="function")a(e,t);else if(typeof e=="object")Array.isArray(e)?o(e):l(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function s(c){if(typeof c=="function")a(c,[]);else if(typeof c=="object")if(Array.isArray(c)){const[h,...u]=c;a(h,u)}else l(c);else throw new TypeError("Expected usable value, not `"+c+"`")}function l(c){if(!("plugins"in c)&&!("settings"in c))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");o(c.plugins),c.settings&&(n.settings=Zo(!0,n.settings,c.settings))}function o(c){let h=-1;if(c!=null)if(Array.isArray(c))for(;++h<c.length;){const u=c[h];s(u)}else throw new TypeError("Expected a list of plugins, not `"+c+"`")}function a(c,h){let u=-1,f=-1;for(;++u<r.length;)if(r[u][0]===c){f=u;break}if(f===-1)r.push([c,...h]);else if(h.length>0){let[d,...y]=h;const _=r[f][1];ta(_)&&ta(d)&&(d=Zo(!0,_,d)),r[f]=[c,d,...y]}}}}const Nx=new yc().freeze();function rl(i,e){if(typeof e!="function")throw new TypeError("Cannot `"+i+"` without `parser`")}function nl(i,e){if(typeof e!="function")throw new TypeError("Cannot `"+i+"` without `compiler`")}function sl(i,e){if(e)throw new Error("Cannot call `"+i+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function gu(i){if(!ta(i)||typeof i.type!="string")throw new TypeError("Expected node, got `"+i+"`")}function vu(i,e,t){if(!t)throw new Error("`"+i+"` finished async. Use `"+e+"` instead")}function hs(i){return Fx(i)?i:new Cp(i)}function Fx(i){return!!(i&&typeof i=="object"&&"message"in i&&"messages"in i)}function Hx(i){return typeof i=="string"||jx(i)}function jx(i){return!!(i&&typeof i=="object"&&"byteLength"in i&&"byteOffset"in i)}const zx="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",_u=[],yu={allowDangerousHtml:!0},Wx=/^(https?|ircs?|mailto|xmpp)$/i,$x=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function Vx(i){const e=Ux(i),t=qx(i);return Kx(e.runSync(e.parse(t),t),i)}function Ux(i){const e=i.rehypePlugins||_u,t=i.remarkPlugins||_u,r=i.remarkRehypeOptions?{...i.remarkRehypeOptions,...yu}:yu;return Nx().use(k1).use(t).use(yx,r).use(e)}function qx(i){const e=i.children||"",t=new Cp;return typeof e=="string"&&(t.value=e),t}function Kx(i,e){const t=e.allowedElements,r=e.allowElement,n=e.components,s=e.disallowedElements,l=e.skipHtml,o=e.unwrapDisallowed,a=e.urlTransform||Gx;for(const h of $x)Object.hasOwn(e,h.from)&&(""+h.from+(h.to?"use `"+h.to+"` instead":"remove it")+zx+h.id,void 0);return e.className&&(i={type:"element",tagName:"div",properties:{className:e.className},children:i.type==="root"?i.children:[i]}),_c(i,c),ay(i,{Fragment:D.Fragment,components:n,ignoreInvalidStyle:!0,jsx:D.jsx,jsxs:D.jsxs,passKeys:!0,passNode:!0});function c(h,u,f){if(h.type==="raw"&&f&&typeof u=="number")return l?f.children.splice(u,1):f.children[u]={type:"text",value:h.value},u;if(h.type==="element"){let d;for(d in Xo)if(Object.hasOwn(Xo,d)&&Object.hasOwn(h.properties,d)){const y=h.properties[d],_=Xo[d];(_===null||_.includes(h.tagName))&&(h.properties[d]=a(String(y||""),d,h))}}if(h.type==="element"){let d=t?!t.includes(h.tagName):s?s.includes(h.tagName):!1;if(!d&&r&&typeof u=="number"&&(d=!r(h,u,f)),d&&f&&typeof u=="number")return o&&h.children?f.children.splice(u,1,...h.children):f.children.splice(u,1),u}}}function Gx(i){const e=i.indexOf(":"),t=i.indexOf("?"),r=i.indexOf("#"),n=i.indexOf("/");return e===-1||n!==-1&&e>n||t!==-1&&e>t||r!==-1&&e>r||Wx.test(i.slice(0,e))?i:""}function bu(i,e){const t=String(i);if(typeof e!="string")throw new TypeError("Expected character");let r=0,n=t.indexOf(e);for(;n!==-1;)r++,n=t.indexOf(e,n+e.length);return r}function Xx(i){if(typeof i!="string")throw new TypeError("Expected a string");return i.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Jx(i,e,t){const n=Eo((t||{}).ignore||[]),s=Yx(e);let l=-1;for(;++l<s.length;)wp(i,"text",o);function o(c,h){let u=-1,f;for(;++u<h.length;){const d=h[u],y=f?f.children:void 0;if(n(d,y?y.indexOf(d):void 0,f))return;f=d}if(f)return a(c,h)}function a(c,h){const u=h[h.length-1],f=s[l][0],d=s[l][1];let y=0;const m=u.children.indexOf(c);let p=!1,g=[];f.lastIndex=0;let v=f.exec(c.value);for(;v;){const b=v.index,S={index:v.index,input:v.input,stack:[...h,c]};let x=d(...v,S);if(typeof x=="string"&&(x=x.length>0?{type:"text",value:x}:void 0),x===!1?f.lastIndex=b+1:(y!==b&&g.push({type:"text",value:c.value.slice(y,b)}),Array.isArray(x)?g.push(...x):x&&g.push(x),y=b+v[0].length,p=!0),!f.global)break;v=f.exec(c.value)}return p?(y<c.value.length&&g.push({type:"text",value:c.value.slice(y)}),u.children.splice(m,1,...g)):g=[c],m+g.length}}function Yx(i){const e=[];if(!Array.isArray(i))throw new TypeError("Expected find and replace tuple or list of tuples");const t=!i[0]||Array.isArray(i[0])?i:[i];let r=-1;for(;++r<t.length;){const n=t[r];e.push([Qx(n[0]),Zx(n[1])])}return e}function Qx(i){return typeof i=="string"?new RegExp(Xx(i),"g"):i}function Zx(i){return typeof i=="function"?i:function(){return i}}const ol="phrasing",ll=["autolink","link","image","label"];function eS(){return{transforms:[lS],enter:{literalAutolink:iS,literalAutolinkEmail:al,literalAutolinkHttp:al,literalAutolinkWww:al},exit:{literalAutolink:oS,literalAutolinkEmail:sS,literalAutolinkHttp:rS,literalAutolinkWww:nS}}}function tS(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:ol,notInConstruct:ll},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:ol,notInConstruct:ll},{character:":",before:"[ps]",after:"\\/",inConstruct:ol,notInConstruct:ll}]}}function iS(i){this.enter({type:"link",title:null,url:"",children:[]},i)}function al(i){this.config.enter.autolinkProtocol.call(this,i)}function rS(i){this.config.exit.autolinkProtocol.call(this,i)}function nS(i){this.config.exit.data.call(this,i);const e=this.stack[this.stack.length-1];e.type,e.url="http://"+this.sliceSerialize(i)}function sS(i){this.config.exit.autolinkEmail.call(this,i)}function oS(i){this.exit(i)}function lS(i){Jx(i,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,aS],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),cS]],{ignore:["link","linkReference"]})}function aS(i,e,t,r,n){let s="";if(!kp(n)||(/^w/i.test(e)&&(t=e+t,e="",s="http://"),!hS(t)))return!1;const l=uS(t+r);if(!l[0])return!1;const o={type:"link",title:null,url:s+e+l[0],children:[{type:"text",value:e+l[0]}]};return l[1]?[o,{type:"text",value:l[1]}]:o}function cS(i,e,t,r){return!kp(r,!0)||/[-\d_]$/.test(t)?!1:{type:"link",title:null,url:"mailto:"+e+"@"+t,children:[{type:"text",value:e+"@"+t}]}}function hS(i){const e=i.split(".");return!(e.length<2||e[e.length-1]&&(/_/.test(e[e.length-1])||!/[a-zA-Z\d]/.test(e[e.length-1]))||e[e.length-2]&&(/_/.test(e[e.length-2])||!/[a-zA-Z\d]/.test(e[e.length-2])))}function uS(i){const e=/[!"&'),.:;<>?\]}]+$/.exec(i);if(!e)return[i,void 0];i=i.slice(0,e.index);let t=e[0],r=t.indexOf(")");const n=bu(i,"(");let s=bu(i,")");for(;r!==-1&&n>s;)i+=t.slice(0,r+1),t=t.slice(r+1),r=t.indexOf(")"),s++;return[i,t]}function kp(i,e){const t=i.input.charCodeAt(i.index-1);return(i.index===0||ur(t)||wo(t))&&(!e||t!==47)}Ep.peek=bS;function fS(){this.buffer()}function dS(i){this.enter({type:"footnoteReference",identifier:"",label:""},i)}function pS(){this.buffer()}function mS(i){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},i)}function gS(i){const e=this.resume(),t=this.stack[this.stack.length-1];t.type,t.identifier=Xt(this.sliceSerialize(i)).toLowerCase(),t.label=e}function vS(i){this.exit(i)}function _S(i){const e=this.resume(),t=this.stack[this.stack.length-1];t.type,t.identifier=Xt(this.sliceSerialize(i)).toLowerCase(),t.label=e}function yS(i){this.exit(i)}function bS(){return"["}function Ep(i,e,t,r){const n=t.createTracker(r);let s=n.move("[^");const l=t.enter("footnoteReference"),o=t.enter("reference");return s+=n.move(t.safe(t.associationId(i),{after:"]",before:s})),o(),l(),s+=n.move("]"),s}function xS(){return{enter:{gfmFootnoteCallString:fS,gfmFootnoteCall:dS,gfmFootnoteDefinitionLabelString:pS,gfmFootnoteDefinition:mS},exit:{gfmFootnoteCallString:gS,gfmFootnoteCall:vS,gfmFootnoteDefinitionLabelString:_S,gfmFootnoteDefinition:yS}}}function SS(i){let e=!1;return i&&i.firstLineBlank&&(e=!0),{handlers:{footnoteDefinition:t,footnoteReference:Ep},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function t(r,n,s,l){const o=s.createTracker(l);let a=o.move("[^");const c=s.enter("footnoteDefinition"),h=s.enter("label");return a+=o.move(s.safe(s.associationId(r),{before:a,after:"]"})),h(),a+=o.move("]:"),r.children&&r.children.length>0&&(o.shift(4),a+=o.move((e?`
`:" ")+s.indentLines(s.containerFlow(r,o.current()),e?Ap:wS))),c(),a}}function wS(i,e,t){return e===0?i:Ap(i,e,t)}function Ap(i,e,t){return(t?"":"    ")+i}const CS=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];Dp.peek=LS;function kS(){return{canContainEols:["delete"],enter:{strikethrough:AS},exit:{strikethrough:DS}}}function ES(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:CS}],handlers:{delete:Dp}}}function AS(i){this.enter({type:"delete",children:[]},i)}function DS(i){this.exit(i)}function Dp(i,e,t,r){const n=t.createTracker(r),s=t.enter("strikethrough");let l=n.move("~~");return l+=t.containerPhrasing(i,{...n.current(),before:l,after:"~"}),l+=n.move("~~"),s(),l}function LS(){return"~"}function MS(i){return i.length}function TS(i,e){const t=e||{},r=(t.align||[]).concat(),n=t.stringLength||MS,s=[],l=[],o=[],a=[];let c=0,h=-1;for(;++h<i.length;){const _=[],m=[];let p=-1;for(i[h].length>c&&(c=i[h].length);++p<i[h].length;){const g=RS(i[h][p]);if(t.alignDelimiters!==!1){const v=n(g);m[p]=v,(a[p]===void 0||v>a[p])&&(a[p]=v)}_.push(g)}l[h]=_,o[h]=m}let u=-1;if(typeof r=="object"&&"length"in r)for(;++u<c;)s[u]=xu(r[u]);else{const _=xu(r);for(;++u<c;)s[u]=_}u=-1;const f=[],d=[];for(;++u<c;){const _=s[u];let m="",p="";_===99?(m=":",p=":"):_===108?m=":":_===114&&(p=":");let g=t.alignDelimiters===!1?1:Math.max(1,a[u]-m.length-p.length);const v=m+"-".repeat(g)+p;t.alignDelimiters!==!1&&(g=m.length+g+p.length,g>a[u]&&(a[u]=g),d[u]=g),f[u]=v}l.splice(1,0,f),o.splice(1,0,d),h=-1;const y=[];for(;++h<l.length;){const _=l[h],m=o[h];u=-1;const p=[];for(;++u<c;){const g=_[u]||"";let v="",b="";if(t.alignDelimiters!==!1){const S=a[u]-(m[u]||0),x=s[u];x===114?v=" ".repeat(S):x===99?S%2?(v=" ".repeat(S/2+.5),b=" ".repeat(S/2-.5)):(v=" ".repeat(S/2),b=v):b=" ".repeat(S)}t.delimiterStart!==!1&&!u&&p.push("|"),t.padding!==!1&&!(t.alignDelimiters===!1&&g==="")&&(t.delimiterStart!==!1||u)&&p.push(" "),t.alignDelimiters!==!1&&p.push(v),p.push(g),t.alignDelimiters!==!1&&p.push(b),t.padding!==!1&&p.push(" "),(t.delimiterEnd!==!1||u!==c-1)&&p.push("|")}y.push(t.delimiterEnd===!1?p.join("").replace(/ +$/,""):p.join(""))}return y.join(`
`)}function RS(i){return i==null?"":String(i)}function xu(i){const e=typeof i=="string"?i.codePointAt(0):0;return e===67||e===99?99:e===76||e===108?108:e===82||e===114?114:0}function PS(i,e,t,r){const n=t.enter("blockquote"),s=t.createTracker(r);s.move("> "),s.shift(2);const l=t.indentLines(t.containerFlow(i,s.current()),BS);return n(),l}function BS(i,e,t){return">"+(t?"":" ")+i}function OS(i,e){return Su(i,e.inConstruct,!0)&&!Su(i,e.notInConstruct,!1)}function Su(i,e,t){if(typeof e=="string"&&(e=[e]),!e||e.length===0)return t;let r=-1;for(;++r<e.length;)if(i.includes(e[r]))return!0;return!1}function wu(i,e,t,r){let n=-1;for(;++n<t.unsafe.length;)if(t.unsafe[n].character===`
`&&OS(t.stack,t.unsafe[n]))return/[ \t]/.test(r.before)?"":" ";return`\\
`}function IS(i,e){const t=String(i);let r=t.indexOf(e),n=r,s=0,l=0;if(typeof e!="string")throw new TypeError("Expected substring");for(;r!==-1;)r===n?++s>l&&(l=s):s=1,n=r+e.length,r=t.indexOf(e,n);return l}function NS(i,e){return!!(e.options.fences===!1&&i.value&&!i.lang&&/[^ \r\n]/.test(i.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(i.value))}function FS(i){const e=i.options.fence||"`";if(e!=="`"&&e!=="~")throw new Error("Cannot serialize code with `"+e+"` for `options.fence`, expected `` ` `` or `~`");return e}function HS(i,e,t,r){const n=FS(t),s=i.value||"",l=n==="`"?"GraveAccent":"Tilde";if(NS(i,t)){const u=t.enter("codeIndented"),f=t.indentLines(s,jS);return u(),f}const o=t.createTracker(r),a=n.repeat(Math.max(IS(s,n)+1,3)),c=t.enter("codeFenced");let h=o.move(a);if(i.lang){const u=t.enter(`codeFencedLang${l}`);h+=o.move(t.safe(i.lang,{before:h,after:" ",encode:["`"],...o.current()})),u()}if(i.lang&&i.meta){const u=t.enter(`codeFencedMeta${l}`);h+=o.move(" "),h+=o.move(t.safe(i.meta,{before:h,after:`
`,encode:["`"],...o.current()})),u()}return h+=o.move(`
`),s&&(h+=o.move(s+`
`)),h+=o.move(a),c(),h}function jS(i,e,t){return(t?"":"    ")+i}function bc(i){const e=i.options.quote||'"';if(e!=='"'&&e!=="'")throw new Error("Cannot serialize title with `"+e+"` for `options.quote`, expected `\"`, or `'`");return e}function zS(i,e,t,r){const n=bc(t),s=n==='"'?"Quote":"Apostrophe",l=t.enter("definition");let o=t.enter("label");const a=t.createTracker(r);let c=a.move("[");return c+=a.move(t.safe(t.associationId(i),{before:c,after:"]",...a.current()})),c+=a.move("]: "),o(),!i.url||/[\0- \u007F]/.test(i.url)?(o=t.enter("destinationLiteral"),c+=a.move("<"),c+=a.move(t.safe(i.url,{before:c,after:">",...a.current()})),c+=a.move(">")):(o=t.enter("destinationRaw"),c+=a.move(t.safe(i.url,{before:c,after:i.title?" ":`
`,...a.current()}))),o(),i.title&&(o=t.enter(`title${s}`),c+=a.move(" "+n),c+=a.move(t.safe(i.title,{before:c,after:n,...a.current()})),c+=a.move(n),o()),l(),c}function WS(i){const e=i.options.emphasis||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize emphasis with `"+e+"` for `options.emphasis`, expected `*`, or `_`");return e}function Dn(i){return"&#x"+i.toString(16).toUpperCase()+";"}function Xs(i,e,t){const r=jr(i),n=jr(e);return r===void 0?n===void 0?t==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:n===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:r===1?n===void 0?{inside:!1,outside:!1}:n===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:n===void 0?{inside:!1,outside:!1}:n===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}Lp.peek=$S;function Lp(i,e,t,r){const n=WS(t),s=t.enter("emphasis"),l=t.createTracker(r),o=l.move(n);let a=l.move(t.containerPhrasing(i,{after:n,before:o,...l.current()}));const c=a.charCodeAt(0),h=Xs(r.before.charCodeAt(r.before.length-1),c,n);h.inside&&(a=Dn(c)+a.slice(1));const u=a.charCodeAt(a.length-1),f=Xs(r.after.charCodeAt(0),u,n);f.inside&&(a=a.slice(0,-1)+Dn(u));const d=l.move(n);return s(),t.attentionEncodeSurroundingInfo={after:f.outside,before:h.outside},o+a+d}function $S(i,e,t){return t.options.emphasis||"*"}function VS(i,e){let t=!1;return _c(i,function(r){if("value"in r&&/\r?\n|\r/.test(r.value)||r.type==="break")return t=!0,Zl}),!!((!i.depth||i.depth<3)&&uc(i)&&(e.options.setext||t))}function US(i,e,t,r){const n=Math.max(Math.min(6,i.depth||1),1),s=t.createTracker(r);if(VS(i,t)){const h=t.enter("headingSetext"),u=t.enter("phrasing"),f=t.containerPhrasing(i,{...s.current(),before:`
`,after:`
`});return u(),h(),f+`
`+(n===1?"=":"-").repeat(f.length-(Math.max(f.lastIndexOf("\r"),f.lastIndexOf(`
`))+1))}const l="#".repeat(n),o=t.enter("headingAtx"),a=t.enter("phrasing");s.move(l+" ");let c=t.containerPhrasing(i,{before:"# ",after:`
`,...s.current()});return/^[\t ]/.test(c)&&(c=Dn(c.charCodeAt(0))+c.slice(1)),c=c?l+" "+c:l,t.options.closeAtx&&(c+=" "+l),a(),o(),c}Mp.peek=qS;function Mp(i){return i.value||""}function qS(){return"<"}Tp.peek=KS;function Tp(i,e,t,r){const n=bc(t),s=n==='"'?"Quote":"Apostrophe",l=t.enter("image");let o=t.enter("label");const a=t.createTracker(r);let c=a.move("![");return c+=a.move(t.safe(i.alt,{before:c,after:"]",...a.current()})),c+=a.move("]("),o(),!i.url&&i.title||/[\0- \u007F]/.test(i.url)?(o=t.enter("destinationLiteral"),c+=a.move("<"),c+=a.move(t.safe(i.url,{before:c,after:">",...a.current()})),c+=a.move(">")):(o=t.enter("destinationRaw"),c+=a.move(t.safe(i.url,{before:c,after:i.title?" ":")",...a.current()}))),o(),i.title&&(o=t.enter(`title${s}`),c+=a.move(" "+n),c+=a.move(t.safe(i.title,{before:c,after:n,...a.current()})),c+=a.move(n),o()),c+=a.move(")"),l(),c}function KS(){return"!"}Rp.peek=GS;function Rp(i,e,t,r){const n=i.referenceType,s=t.enter("imageReference");let l=t.enter("label");const o=t.createTracker(r);let a=o.move("![");const c=t.safe(i.alt,{before:a,after:"]",...o.current()});a+=o.move(c+"]["),l();const h=t.stack;t.stack=[],l=t.enter("reference");const u=t.safe(t.associationId(i),{before:a,after:"]",...o.current()});return l(),t.stack=h,s(),n==="full"||!c||c!==u?a+=o.move(u+"]"):n==="shortcut"?a=a.slice(0,-1):a+=o.move("]"),a}function GS(){return"!"}Pp.peek=XS;function Pp(i,e,t){let r=i.value||"",n="`",s=-1;for(;new RegExp("(^|[^`])"+n+"([^`]|$)").test(r);)n+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++s<t.unsafe.length;){const l=t.unsafe[s],o=t.compilePattern(l);let a;if(l.atBreak)for(;a=o.exec(r);){let c=a.index;r.charCodeAt(c)===10&&r.charCodeAt(c-1)===13&&c--,r=r.slice(0,c)+" "+r.slice(a.index+1)}}return n+r+n}function XS(){return"`"}function Bp(i,e){const t=uc(i);return!!(!e.options.resourceLink&&i.url&&!i.title&&i.children&&i.children.length===1&&i.children[0].type==="text"&&(t===i.url||"mailto:"+t===i.url)&&/^[a-z][a-z+.-]+:/i.test(i.url)&&!/[\0- <>\u007F]/.test(i.url))}Op.peek=JS;function Op(i,e,t,r){const n=bc(t),s=n==='"'?"Quote":"Apostrophe",l=t.createTracker(r);let o,a;if(Bp(i,t)){const h=t.stack;t.stack=[],o=t.enter("autolink");let u=l.move("<");return u+=l.move(t.containerPhrasing(i,{before:u,after:">",...l.current()})),u+=l.move(">"),o(),t.stack=h,u}o=t.enter("link"),a=t.enter("label");let c=l.move("[");return c+=l.move(t.containerPhrasing(i,{before:c,after:"](",...l.current()})),c+=l.move("]("),a(),!i.url&&i.title||/[\0- \u007F]/.test(i.url)?(a=t.enter("destinationLiteral"),c+=l.move("<"),c+=l.move(t.safe(i.url,{before:c,after:">",...l.current()})),c+=l.move(">")):(a=t.enter("destinationRaw"),c+=l.move(t.safe(i.url,{before:c,after:i.title?" ":")",...l.current()}))),a(),i.title&&(a=t.enter(`title${s}`),c+=l.move(" "+n),c+=l.move(t.safe(i.title,{before:c,after:n,...l.current()})),c+=l.move(n),a()),c+=l.move(")"),o(),c}function JS(i,e,t){return Bp(i,t)?"<":"["}Ip.peek=YS;function Ip(i,e,t,r){const n=i.referenceType,s=t.enter("linkReference");let l=t.enter("label");const o=t.createTracker(r);let a=o.move("[");const c=t.containerPhrasing(i,{before:a,after:"]",...o.current()});a+=o.move(c+"]["),l();const h=t.stack;t.stack=[],l=t.enter("reference");const u=t.safe(t.associationId(i),{before:a,after:"]",...o.current()});return l(),t.stack=h,s(),n==="full"||!c||c!==u?a+=o.move(u+"]"):n==="shortcut"?a=a.slice(0,-1):a+=o.move("]"),a}function YS(){return"["}function xc(i){const e=i.options.bullet||"*";if(e!=="*"&&e!=="+"&&e!=="-")throw new Error("Cannot serialize items with `"+e+"` for `options.bullet`, expected `*`, `+`, or `-`");return e}function QS(i){const e=xc(i),t=i.options.bulletOther;if(!t)return e==="*"?"-":"*";if(t!=="*"&&t!=="+"&&t!=="-")throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(t===e)throw new Error("Expected `bullet` (`"+e+"`) and `bulletOther` (`"+t+"`) to be different");return t}function ZS(i){const e=i.options.bulletOrdered||".";if(e!=="."&&e!==")")throw new Error("Cannot serialize items with `"+e+"` for `options.bulletOrdered`, expected `.` or `)`");return e}function Np(i){const e=i.options.rule||"*";if(e!=="*"&&e!=="-"&&e!=="_")throw new Error("Cannot serialize rules with `"+e+"` for `options.rule`, expected `*`, `-`, or `_`");return e}function ew(i,e,t,r){const n=t.enter("list"),s=t.bulletCurrent;let l=i.ordered?ZS(t):xc(t);const o=i.ordered?l==="."?")":".":QS(t);let a=e&&t.bulletLastUsed?l===t.bulletLastUsed:!1;if(!i.ordered){const h=i.children?i.children[0]:void 0;if((l==="*"||l==="-")&&h&&(!h.children||!h.children[0])&&t.stack[t.stack.length-1]==="list"&&t.stack[t.stack.length-2]==="listItem"&&t.stack[t.stack.length-3]==="list"&&t.stack[t.stack.length-4]==="listItem"&&t.indexStack[t.indexStack.length-1]===0&&t.indexStack[t.indexStack.length-2]===0&&t.indexStack[t.indexStack.length-3]===0&&(a=!0),Np(t)===l&&h){let u=-1;for(;++u<i.children.length;){const f=i.children[u];if(f&&f.type==="listItem"&&f.children&&f.children[0]&&f.children[0].type==="thematicBreak"){a=!0;break}}}}a&&(l=o),t.bulletCurrent=l;const c=t.containerFlow(i,r);return t.bulletLastUsed=l,t.bulletCurrent=s,n(),c}function tw(i){const e=i.options.listItemIndent||"one";if(e!=="tab"&&e!=="one"&&e!=="mixed")throw new Error("Cannot serialize items with `"+e+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return e}function iw(i,e,t,r){const n=tw(t);let s=t.bulletCurrent||xc(t);e&&e.type==="list"&&e.ordered&&(s=(typeof e.start=="number"&&e.start>-1?e.start:1)+(t.options.incrementListMarker===!1?0:e.children.indexOf(i))+s);let l=s.length+1;(n==="tab"||n==="mixed"&&(e&&e.type==="list"&&e.spread||i.spread))&&(l=Math.ceil(l/4)*4);const o=t.createTracker(r);o.move(s+" ".repeat(l-s.length)),o.shift(l);const a=t.enter("listItem"),c=t.indentLines(t.containerFlow(i,o.current()),h);return a(),c;function h(u,f,d){return f?(d?"":" ".repeat(l))+u:(d?s:s+" ".repeat(l-s.length))+u}}function rw(i,e,t,r){const n=t.enter("paragraph"),s=t.enter("phrasing"),l=t.containerPhrasing(i,r);return s(),n(),l}const nw=Eo(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function sw(i,e,t,r){return(i.children.some(function(l){return nw(l)})?t.containerPhrasing:t.containerFlow).call(t,i,r)}function ow(i){const e=i.options.strong||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize strong with `"+e+"` for `options.strong`, expected `*`, or `_`");return e}Fp.peek=lw;function Fp(i,e,t,r){const n=ow(t),s=t.enter("strong"),l=t.createTracker(r),o=l.move(n+n);let a=l.move(t.containerPhrasing(i,{after:n,before:o,...l.current()}));const c=a.charCodeAt(0),h=Xs(r.before.charCodeAt(r.before.length-1),c,n);h.inside&&(a=Dn(c)+a.slice(1));const u=a.charCodeAt(a.length-1),f=Xs(r.after.charCodeAt(0),u,n);f.inside&&(a=a.slice(0,-1)+Dn(u));const d=l.move(n+n);return s(),t.attentionEncodeSurroundingInfo={after:f.outside,before:h.outside},o+a+d}function lw(i,e,t){return t.options.strong||"*"}function aw(i,e,t,r){return t.safe(i.value,r)}function cw(i){const e=i.options.ruleRepetition||3;if(e<3)throw new Error("Cannot serialize rules with repetition `"+e+"` for `options.ruleRepetition`, expected `3` or more");return e}function hw(i,e,t){const r=(Np(t)+(t.options.ruleSpaces?" ":"")).repeat(cw(t));return t.options.ruleSpaces?r.slice(0,-1):r}const Hp={blockquote:PS,break:wu,code:HS,definition:zS,emphasis:Lp,hardBreak:wu,heading:US,html:Mp,image:Tp,imageReference:Rp,inlineCode:Pp,link:Op,linkReference:Ip,list:ew,listItem:iw,paragraph:rw,root:sw,strong:Fp,text:aw,thematicBreak:hw};function uw(){return{enter:{table:fw,tableData:Cu,tableHeader:Cu,tableRow:pw},exit:{codeText:mw,table:dw,tableData:cl,tableHeader:cl,tableRow:cl}}}function fw(i){const e=i._align;this.enter({type:"table",align:e.map(function(t){return t==="none"?null:t}),children:[]},i),this.data.inTable=!0}function dw(i){this.exit(i),this.data.inTable=void 0}function pw(i){this.enter({type:"tableRow",children:[]},i)}function cl(i){this.exit(i)}function Cu(i){this.enter({type:"tableCell",children:[]},i)}function mw(i){let e=this.resume();this.data.inTable&&(e=e.replace(/\\([\\|])/g,gw));const t=this.stack[this.stack.length-1];t.type,t.value=e,this.exit(i)}function gw(i,e){return e==="|"?e:i}function vw(i){const e=i||{},t=e.tableCellPadding,r=e.tablePipeAlign,n=e.stringLength,s=t?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:f,table:l,tableCell:a,tableRow:o}};function l(d,y,_,m){return c(h(d,_,m),d.align)}function o(d,y,_,m){const p=u(d,_,m),g=c([p]);return g.slice(0,g.indexOf(`
`))}function a(d,y,_,m){const p=_.enter("tableCell"),g=_.enter("phrasing"),v=_.containerPhrasing(d,{...m,before:s,after:s});return g(),p(),v}function c(d,y){return TS(d,{align:y,alignDelimiters:r,padding:t,stringLength:n})}function h(d,y,_){const m=d.children;let p=-1;const g=[],v=y.enter("table");for(;++p<m.length;)g[p]=u(m[p],y,_);return v(),g}function u(d,y,_){const m=d.children;let p=-1;const g=[],v=y.enter("tableRow");for(;++p<m.length;)g[p]=a(m[p],d,y,_);return v(),g}function f(d,y,_){let m=Hp.inlineCode(d,y,_);return _.stack.includes("tableCell")&&(m=m.replace(/\|/g,"\\$&")),m}}function _w(){return{exit:{taskListCheckValueChecked:ku,taskListCheckValueUnchecked:ku,paragraph:bw}}}function yw(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:xw}}}function ku(i){const e=this.stack[this.stack.length-2];e.type,e.checked=i.type==="taskListCheckValueChecked"}function bw(i){const e=this.stack[this.stack.length-2];if(e&&e.type==="listItem"&&typeof e.checked=="boolean"){const t=this.stack[this.stack.length-1];t.type;const r=t.children[0];if(r&&r.type==="text"){const n=e.children;let s=-1,l;for(;++s<n.length;){const o=n[s];if(o.type==="paragraph"){l=o;break}}l===t&&(r.value=r.value.slice(1),r.value.length===0?t.children.shift():t.position&&r.position&&typeof r.position.start.offset=="number"&&(r.position.start.column++,r.position.start.offset++,t.position.start=Object.assign({},r.position.start)))}}this.exit(i)}function xw(i,e,t,r){const n=i.children[0],s=typeof i.checked=="boolean"&&n&&n.type==="paragraph",l="["+(i.checked?"x":" ")+"] ",o=t.createTracker(r);s&&o.move(l);let a=Hp.listItem(i,e,t,{...r,...o.current()});return s&&(a=a.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,c)),a;function c(h){return h+l}}function Sw(){return[eS(),xS(),kS(),uw(),_w()]}function ww(i){return{extensions:[tS(),SS(i),ES(),vw(i),yw()]}}const Cw={tokenize:Mw,partial:!0},jp={tokenize:Tw,partial:!0},zp={tokenize:Rw,partial:!0},Wp={tokenize:Pw,partial:!0},kw={tokenize:Bw,partial:!0},$p={name:"wwwAutolink",tokenize:Dw,previous:Up},Vp={name:"protocolAutolink",tokenize:Lw,previous:qp},wi={name:"emailAutolink",tokenize:Aw,previous:Kp},pi={};function Ew(){return{text:pi}}let Qi=48;for(;Qi<123;)pi[Qi]=wi,Qi++,Qi===58?Qi=65:Qi===91&&(Qi=97);pi[43]=wi;pi[45]=wi;pi[46]=wi;pi[95]=wi;pi[72]=[wi,Vp];pi[104]=[wi,Vp];pi[87]=[wi,$p];pi[119]=[wi,$p];function Aw(i,e,t){const r=this;let n,s;return l;function l(u){return!ra(u)||!Kp.call(r,r.previous)||Sc(r.events)?t(u):(i.enter("literalAutolink"),i.enter("literalAutolinkEmail"),o(u))}function o(u){return ra(u)?(i.consume(u),o):u===64?(i.consume(u),a):t(u)}function a(u){return u===46?i.check(kw,h,c)(u):u===45||u===95||nt(u)?(s=!0,i.consume(u),a):h(u)}function c(u){return i.consume(u),n=!0,a}function h(u){return s&&n&&pt(r.previous)?(i.exit("literalAutolinkEmail"),i.exit("literalAutolink"),e(u)):t(u)}}function Dw(i,e,t){const r=this;return n;function n(l){return l!==87&&l!==119||!Up.call(r,r.previous)||Sc(r.events)?t(l):(i.enter("literalAutolink"),i.enter("literalAutolinkWww"),i.check(Cw,i.attempt(jp,i.attempt(zp,s),t),t)(l))}function s(l){return i.exit("literalAutolinkWww"),i.exit("literalAutolink"),e(l)}}function Lw(i,e,t){const r=this;let n="",s=!1;return l;function l(u){return(u===72||u===104)&&qp.call(r,r.previous)&&!Sc(r.events)?(i.enter("literalAutolink"),i.enter("literalAutolinkHttp"),n+=String.fromCodePoint(u),i.consume(u),o):t(u)}function o(u){if(pt(u)&&n.length<5)return n+=String.fromCodePoint(u),i.consume(u),o;if(u===58){const f=n.toLowerCase();if(f==="http"||f==="https")return i.consume(u),a}return t(u)}function a(u){return u===47?(i.consume(u),s?c:(s=!0,a)):t(u)}function c(u){return u===null||qs(u)||Pe(u)||ur(u)||wo(u)?t(u):i.attempt(jp,i.attempt(zp,h),t)(u)}function h(u){return i.exit("literalAutolinkHttp"),i.exit("literalAutolink"),e(u)}}function Mw(i,e,t){let r=0;return n;function n(l){return(l===87||l===119)&&r<3?(r++,i.consume(l),n):l===46&&r===3?(i.consume(l),s):t(l)}function s(l){return l===null?t(l):e(l)}}function Tw(i,e,t){let r,n,s;return l;function l(c){return c===46||c===95?i.check(Wp,a,o)(c):c===null||Pe(c)||ur(c)||c!==45&&wo(c)?a(c):(s=!0,i.consume(c),l)}function o(c){return c===95?r=!0:(n=r,r=void 0),i.consume(c),l}function a(c){return n||r||!s?t(c):e(c)}}function Rw(i,e){let t=0,r=0;return n;function n(l){return l===40?(t++,i.consume(l),n):l===41&&r<t?s(l):l===33||l===34||l===38||l===39||l===41||l===42||l===44||l===46||l===58||l===59||l===60||l===63||l===93||l===95||l===126?i.check(Wp,e,s)(l):l===null||Pe(l)||ur(l)?e(l):(i.consume(l),n)}function s(l){return l===41&&r++,i.consume(l),n}}function Pw(i,e,t){return r;function r(o){return o===33||o===34||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===63||o===95||o===126?(i.consume(o),r):o===38?(i.consume(o),s):o===93?(i.consume(o),n):o===60||o===null||Pe(o)||ur(o)?e(o):t(o)}function n(o){return o===null||o===40||o===91||Pe(o)||ur(o)?e(o):r(o)}function s(o){return pt(o)?l(o):t(o)}function l(o){return o===59?(i.consume(o),r):pt(o)?(i.consume(o),l):t(o)}}function Bw(i,e,t){return r;function r(s){return i.consume(s),n}function n(s){return nt(s)?t(s):e(s)}}function Up(i){return i===null||i===40||i===42||i===95||i===91||i===93||i===126||Pe(i)}function qp(i){return!pt(i)}function Kp(i){return!(i===47||ra(i))}function ra(i){return i===43||i===45||i===46||i===95||nt(i)}function Sc(i){let e=i.length,t=!1;for(;e--;){const r=i[e][1];if((r.type==="labelLink"||r.type==="labelImage")&&!r._balanced){t=!0;break}if(r._gfmAutolinkLiteralWalkedInto){t=!1;break}}return i.length>0&&!t&&(i[i.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),t}const Ow={tokenize:$w,partial:!0};function Iw(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:jw,continuation:{tokenize:zw},exit:Ww}},text:{91:{name:"gfmFootnoteCall",tokenize:Hw},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:Nw,resolveTo:Fw}}}}function Nw(i,e,t){const r=this;let n=r.events.length;const s=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let l;for(;n--;){const a=r.events[n][1];if(a.type==="labelImage"){l=a;break}if(a.type==="gfmFootnoteCall"||a.type==="labelLink"||a.type==="label"||a.type==="image"||a.type==="link")break}return o;function o(a){if(!l||!l._balanced)return t(a);const c=Xt(r.sliceSerialize({start:l.end,end:r.now()}));return c.codePointAt(0)!==94||!s.includes(c.slice(1))?t(a):(i.enter("gfmFootnoteCallLabelMarker"),i.consume(a),i.exit("gfmFootnoteCallLabelMarker"),e(a))}}function Fw(i,e){let t=i.length;for(;t--;)if(i[t][1].type==="labelImage"&&i[t][0]==="enter"){i[t][1];break}i[t+1][1].type="data",i[t+3][1].type="gfmFootnoteCallLabelMarker";const r={type:"gfmFootnoteCall",start:Object.assign({},i[t+3][1].start),end:Object.assign({},i[i.length-1][1].end)},n={type:"gfmFootnoteCallMarker",start:Object.assign({},i[t+3][1].end),end:Object.assign({},i[t+3][1].end)};n.end.column++,n.end.offset++,n.end._bufferIndex++;const s={type:"gfmFootnoteCallString",start:Object.assign({},n.end),end:Object.assign({},i[i.length-1][1].start)},l={type:"chunkString",contentType:"string",start:Object.assign({},s.start),end:Object.assign({},s.end)},o=[i[t+1],i[t+2],["enter",r,e],i[t+3],i[t+4],["enter",n,e],["exit",n,e],["enter",s,e],["enter",l,e],["exit",l,e],["exit",s,e],i[i.length-2],i[i.length-1],["exit",r,e]];return i.splice(t,i.length-t+1,...o),i}function Hw(i,e,t){const r=this,n=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let s=0,l;return o;function o(u){return i.enter("gfmFootnoteCall"),i.enter("gfmFootnoteCallLabelMarker"),i.consume(u),i.exit("gfmFootnoteCallLabelMarker"),a}function a(u){return u!==94?t(u):(i.enter("gfmFootnoteCallMarker"),i.consume(u),i.exit("gfmFootnoteCallMarker"),i.enter("gfmFootnoteCallString"),i.enter("chunkString").contentType="string",c)}function c(u){if(s>999||u===93&&!l||u===null||u===91||Pe(u))return t(u);if(u===93){i.exit("chunkString");const f=i.exit("gfmFootnoteCallString");return n.includes(Xt(r.sliceSerialize(f)))?(i.enter("gfmFootnoteCallLabelMarker"),i.consume(u),i.exit("gfmFootnoteCallLabelMarker"),i.exit("gfmFootnoteCall"),e):t(u)}return Pe(u)||(l=!0),s++,i.consume(u),u===92?h:c}function h(u){return u===91||u===92||u===93?(i.consume(u),s++,c):c(u)}}function jw(i,e,t){const r=this,n=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let s,l=0,o;return a;function a(y){return i.enter("gfmFootnoteDefinition")._container=!0,i.enter("gfmFootnoteDefinitionLabel"),i.enter("gfmFootnoteDefinitionLabelMarker"),i.consume(y),i.exit("gfmFootnoteDefinitionLabelMarker"),c}function c(y){return y===94?(i.enter("gfmFootnoteDefinitionMarker"),i.consume(y),i.exit("gfmFootnoteDefinitionMarker"),i.enter("gfmFootnoteDefinitionLabelString"),i.enter("chunkString").contentType="string",h):t(y)}function h(y){if(l>999||y===93&&!o||y===null||y===91||Pe(y))return t(y);if(y===93){i.exit("chunkString");const _=i.exit("gfmFootnoteDefinitionLabelString");return s=Xt(r.sliceSerialize(_)),i.enter("gfmFootnoteDefinitionLabelMarker"),i.consume(y),i.exit("gfmFootnoteDefinitionLabelMarker"),i.exit("gfmFootnoteDefinitionLabel"),f}return Pe(y)||(o=!0),l++,i.consume(y),y===92?u:h}function u(y){return y===91||y===92||y===93?(i.consume(y),l++,h):h(y)}function f(y){return y===58?(i.enter("definitionMarker"),i.consume(y),i.exit("definitionMarker"),n.includes(s)||n.push(s),we(i,d,"gfmFootnoteDefinitionWhitespace")):t(y)}function d(y){return e(y)}}function zw(i,e,t){return i.check(Xn,e,i.attempt(Ow,e,t))}function Ww(i){i.exit("gfmFootnoteDefinition")}function $w(i,e,t){const r=this;return we(i,n,"gfmFootnoteDefinitionIndent",5);function n(s){const l=r.events[r.events.length-1];return l&&l[1].type==="gfmFootnoteDefinitionIndent"&&l[2].sliceSerialize(l[1],!0).length===4?e(s):t(s)}}function Vw(i){let t=(i||{}).singleTilde;const r={name:"strikethrough",tokenize:s,resolveAll:n};return t==null&&(t=!0),{text:{126:r},insideSpan:{null:[r]},attentionMarkers:{null:[126]}};function n(l,o){let a=-1;for(;++a<l.length;)if(l[a][0]==="enter"&&l[a][1].type==="strikethroughSequenceTemporary"&&l[a][1]._close){let c=a;for(;c--;)if(l[c][0]==="exit"&&l[c][1].type==="strikethroughSequenceTemporary"&&l[c][1]._open&&l[a][1].end.offset-l[a][1].start.offset===l[c][1].end.offset-l[c][1].start.offset){l[a][1].type="strikethroughSequence",l[c][1].type="strikethroughSequence";const h={type:"strikethrough",start:Object.assign({},l[c][1].start),end:Object.assign({},l[a][1].end)},u={type:"strikethroughText",start:Object.assign({},l[c][1].end),end:Object.assign({},l[a][1].start)},f=[["enter",h,o],["enter",l[c][1],o],["exit",l[c][1],o],["enter",u,o]],d=o.parser.constructs.insideSpan.null;d&&Pt(f,f.length,0,Co(d,l.slice(c+1,a),o)),Pt(f,f.length,0,[["exit",u,o],["enter",l[a][1],o],["exit",l[a][1],o],["exit",h,o]]),Pt(l,c-1,a-c+3,f),a=c+f.length-2;break}}for(a=-1;++a<l.length;)l[a][1].type==="strikethroughSequenceTemporary"&&(l[a][1].type="data");return l}function s(l,o,a){const c=this.previous,h=this.events;let u=0;return f;function f(y){return c===126&&h[h.length-1][1].type!=="characterEscape"?a(y):(l.enter("strikethroughSequenceTemporary"),d(y))}function d(y){const _=jr(c);if(y===126)return u>1?a(y):(l.consume(y),u++,d);if(u<2&&!t)return a(y);const m=l.exit("strikethroughSequenceTemporary"),p=jr(y);return m._open=!p||p===2&&!!_,m._close=!_||_===2&&!!p,o(y)}}}class Uw{constructor(){this.map=[]}add(e,t,r){qw(this,e,t,r)}consume(e){if(this.map.sort(function(s,l){return s[0]-l[0]}),this.map.length===0)return;let t=this.map.length;const r=[];for(;t>0;)t-=1,r.push(e.slice(this.map[t][0]+this.map[t][1]),this.map[t][2]),e.length=this.map[t][0];r.push(e.slice()),e.length=0;let n=r.pop();for(;n;){for(const s of n)e.push(s);n=r.pop()}this.map.length=0}}function qw(i,e,t,r){let n=0;if(!(t===0&&r.length===0)){for(;n<i.map.length;){if(i.map[n][0]===e){i.map[n][1]+=t,i.map[n][2].push(...r);return}n+=1}i.map.push([e,t,r])}}function Kw(i,e){let t=!1;const r=[];for(;e<i.length;){const n=i[e];if(t){if(n[0]==="enter")n[1].type==="tableContent"&&r.push(i[e+1][1].type==="tableDelimiterMarker"?"left":"none");else if(n[1].type==="tableContent"){if(i[e-1][1].type==="tableDelimiterMarker"){const s=r.length-1;r[s]=r[s]==="left"?"center":"right"}}else if(n[1].type==="tableDelimiterRow")break}else n[0]==="enter"&&n[1].type==="tableDelimiterRow"&&(t=!0);e+=1}return r}function Gw(){return{flow:{null:{name:"table",tokenize:Xw,resolveAll:Jw}}}}function Xw(i,e,t){const r=this;let n=0,s=0,l;return o;function o(A){let M=r.events.length-1;for(;M>-1;){const F=r.events[M][1].type;if(F==="lineEnding"||F==="linePrefix")M--;else break}const T=M>-1?r.events[M][1].type:null,B=T==="tableHead"||T==="tableRow"?x:a;return B===x&&r.parser.lazy[r.now().line]?t(A):B(A)}function a(A){return i.enter("tableHead"),i.enter("tableRow"),c(A)}function c(A){return A===124||(l=!0,s+=1),h(A)}function h(A){return A===null?t(A):ae(A)?s>1?(s=0,r.interrupt=!0,i.exit("tableRow"),i.enter("lineEnding"),i.consume(A),i.exit("lineEnding"),d):t(A):be(A)?we(i,h,"whitespace")(A):(s+=1,l&&(l=!1,n+=1),A===124?(i.enter("tableCellDivider"),i.consume(A),i.exit("tableCellDivider"),l=!0,h):(i.enter("data"),u(A)))}function u(A){return A===null||A===124||Pe(A)?(i.exit("data"),h(A)):(i.consume(A),A===92?f:u)}function f(A){return A===92||A===124?(i.consume(A),u):u(A)}function d(A){return r.interrupt=!1,r.parser.lazy[r.now().line]?t(A):(i.enter("tableDelimiterRow"),l=!1,be(A)?we(i,y,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(A):y(A))}function y(A){return A===45||A===58?m(A):A===124?(l=!0,i.enter("tableCellDivider"),i.consume(A),i.exit("tableCellDivider"),_):S(A)}function _(A){return be(A)?we(i,m,"whitespace")(A):m(A)}function m(A){return A===58?(s+=1,l=!0,i.enter("tableDelimiterMarker"),i.consume(A),i.exit("tableDelimiterMarker"),p):A===45?(s+=1,p(A)):A===null||ae(A)?b(A):S(A)}function p(A){return A===45?(i.enter("tableDelimiterFiller"),g(A)):S(A)}function g(A){return A===45?(i.consume(A),g):A===58?(l=!0,i.exit("tableDelimiterFiller"),i.enter("tableDelimiterMarker"),i.consume(A),i.exit("tableDelimiterMarker"),v):(i.exit("tableDelimiterFiller"),v(A))}function v(A){return be(A)?we(i,b,"whitespace")(A):b(A)}function b(A){return A===124?y(A):A===null||ae(A)?!l||n!==s?S(A):(i.exit("tableDelimiterRow"),i.exit("tableHead"),e(A)):S(A)}function S(A){return t(A)}function x(A){return i.enter("tableRow"),C(A)}function C(A){return A===124?(i.enter("tableCellDivider"),i.consume(A),i.exit("tableCellDivider"),C):A===null||ae(A)?(i.exit("tableRow"),e(A)):be(A)?we(i,C,"whitespace")(A):(i.enter("data"),w(A))}function w(A){return A===null||A===124||Pe(A)?(i.exit("data"),C(A)):(i.consume(A),A===92?E:w)}function E(A){return A===92||A===124?(i.consume(A),w):w(A)}}function Jw(i,e){let t=-1,r=!0,n=0,s=[0,0,0,0],l=[0,0,0,0],o=!1,a=0,c,h,u;const f=new Uw;for(;++t<i.length;){const d=i[t],y=d[1];d[0]==="enter"?y.type==="tableHead"?(o=!1,a!==0&&(Eu(f,e,a,c,h),h=void 0,a=0),c={type:"table",start:Object.assign({},y.start),end:Object.assign({},y.end)},f.add(t,0,[["enter",c,e]])):y.type==="tableRow"||y.type==="tableDelimiterRow"?(r=!0,u=void 0,s=[0,0,0,0],l=[0,t+1,0,0],o&&(o=!1,h={type:"tableBody",start:Object.assign({},y.start),end:Object.assign({},y.end)},f.add(t,0,[["enter",h,e]])),n=y.type==="tableDelimiterRow"?2:h?3:1):n&&(y.type==="data"||y.type==="tableDelimiterMarker"||y.type==="tableDelimiterFiller")?(r=!1,l[2]===0&&(s[1]!==0&&(l[0]=l[1],u=us(f,e,s,n,void 0,u),s=[0,0,0,0]),l[2]=t)):y.type==="tableCellDivider"&&(r?r=!1:(s[1]!==0&&(l[0]=l[1],u=us(f,e,s,n,void 0,u)),s=l,l=[s[1],t,0,0])):y.type==="tableHead"?(o=!0,a=t):y.type==="tableRow"||y.type==="tableDelimiterRow"?(a=t,s[1]!==0?(l[0]=l[1],u=us(f,e,s,n,t,u)):l[1]!==0&&(u=us(f,e,l,n,t,u)),n=0):n&&(y.type==="data"||y.type==="tableDelimiterMarker"||y.type==="tableDelimiterFiller")&&(l[3]=t)}for(a!==0&&Eu(f,e,a,c,h),f.consume(e.events),t=-1;++t<e.events.length;){const d=e.events[t];d[0]==="enter"&&d[1].type==="table"&&(d[1]._align=Kw(e.events,t))}return i}function us(i,e,t,r,n,s){const l=r===1?"tableHeader":r===2?"tableDelimiter":"tableData",o="tableContent";t[0]!==0&&(s.end=Object.assign({},Sr(e.events,t[0])),i.add(t[0],0,[["exit",s,e]]));const a=Sr(e.events,t[1]);if(s={type:l,start:Object.assign({},a),end:Object.assign({},a)},i.add(t[1],0,[["enter",s,e]]),t[2]!==0){const c=Sr(e.events,t[2]),h=Sr(e.events,t[3]),u={type:o,start:Object.assign({},c),end:Object.assign({},h)};if(i.add(t[2],0,[["enter",u,e]]),r!==2){const f=e.events[t[2]],d=e.events[t[3]];if(f[1].end=Object.assign({},d[1].end),f[1].type="chunkText",f[1].contentType="text",t[3]>t[2]+1){const y=t[2]+1,_=t[3]-t[2]-1;i.add(y,_,[])}}i.add(t[3]+1,0,[["exit",u,e]])}return n!==void 0&&(s.end=Object.assign({},Sr(e.events,n)),i.add(n,0,[["exit",s,e]]),s=void 0),s}function Eu(i,e,t,r,n){const s=[],l=Sr(e.events,t);n&&(n.end=Object.assign({},l),s.push(["exit",n,e])),r.end=Object.assign({},l),s.push(["exit",r,e]),i.add(t+1,0,s)}function Sr(i,e){const t=i[e],r=t[0]==="enter"?"start":"end";return t[1][r]}const Yw={name:"tasklistCheck",tokenize:Zw};function Qw(){return{text:{91:Yw}}}function Zw(i,e,t){const r=this;return n;function n(a){return r.previous!==null||!r._gfmTasklistFirstContentOfListItem?t(a):(i.enter("taskListCheck"),i.enter("taskListCheckMarker"),i.consume(a),i.exit("taskListCheckMarker"),s)}function s(a){return Pe(a)?(i.enter("taskListCheckValueUnchecked"),i.consume(a),i.exit("taskListCheckValueUnchecked"),l):a===88||a===120?(i.enter("taskListCheckValueChecked"),i.consume(a),i.exit("taskListCheckValueChecked"),l):t(a)}function l(a){return a===93?(i.enter("taskListCheckMarker"),i.consume(a),i.exit("taskListCheckMarker"),i.exit("taskListCheck"),o):t(a)}function o(a){return ae(a)?e(a):be(a)?i.check({tokenize:eC},e,t)(a):t(a)}}function eC(i,e,t){return we(i,r,"whitespace");function r(n){return n===null?t(n):e(n)}}function tC(i){return np([Ew(),Iw(),Vw(i),Gw(),Qw()])}const iC={};function rC(i){const e=this,t=i||iC,r=e.data(),n=r.micromarkExtensions||(r.micromarkExtensions=[]),s=r.fromMarkdownExtensions||(r.fromMarkdownExtensions=[]),l=r.toMarkdownExtensions||(r.toMarkdownExtensions=[]);n.push(tC(t)),s.push(Sw()),l.push(ww(t))}function Gp({node:i,level:e,selectedPath:t,expandedPaths:r,onSelect:n,onToggle:s}){const l=r.has(i.path),o=t===i.path,a=i.type==="directory",c=i.name.endsWith(".md"),h=()=>{a?s(i.path):n(i.path)};return D.jsxs("div",{children:[D.jsxs("button",{onClick:h,className:ue("flex w-full items-center gap-1.5 rounded-md px-2 py-1 text-left text-xs transition-colors",o?"bg-[var(--color-accent-primary)]/10 text-[var(--color-accent-primary)]":"text-[var(--color-text-secondary)] hover:bg-[var(--color-bg-secondary)] hover:text-[var(--color-text-primary)]"),style:{paddingLeft:`${e*12+8}px`},children:[a?D.jsxs(D.Fragment,{children:[l?D.jsx(Kn,{className:"h-3 w-3 flex-shrink-0 text-[var(--color-text-muted)]"}):D.jsx(So,{className:"h-3 w-3 flex-shrink-0 text-[var(--color-text-muted)]"}),l?D.jsx(Ad,{className:"h-3.5 w-3.5 flex-shrink-0 text-[var(--color-warning)]"}):D.jsx(Cd,{className:"h-3.5 w-3.5 flex-shrink-0 text-[var(--color-warning)]"})]}):D.jsxs(D.Fragment,{children:[D.jsx("span",{className:"w-3"}),c?D.jsx(ar,{className:"h-3.5 w-3.5 flex-shrink-0 text-[var(--color-accent-secondary)]"}):D.jsx(Un,{className:"h-3.5 w-3.5 flex-shrink-0 text-[var(--color-text-muted)]"})]}),D.jsx("span",{className:"truncate",children:i.name})]}),a&&l&&i.children&&D.jsx("div",{children:i.children.map(u=>D.jsx(Gp,{node:u,level:e+1,selectedPath:t,expandedPaths:r,onSelect:n,onToggle:s},u.path))})]})}function nC({projectId:i,systemPromptParams:e,onClose:t}){const[r,n]=N.useState([]),[s,l]=N.useState(!0),[o,a]=N.useState(null),[c,h]=N.useState("system_prompt"),[u,f]=N.useState(new Set),[d,y]=N.useState(""),[_,m]=N.useState(!1),[p,g]=N.useState(!1),[v,b]=N.useState(!1);N.useEffect(()=>{(async()=>{try{l(!0);const M=await vh(i);n(M);const T=new Set;M.forEach(B=>{B.type==="directory"&&T.add(B.path)}),f(T)}catch(M){console.error("Failed to load skills tree:",M)}finally{l(!1)}})()},[i]),N.useEffect(()=>{(async()=>{try{m(!0);const M=await gh(e);y(M),h("system_prompt")}catch(M){console.error("Failed to load system prompt:",M),y("Error loading system prompt")}finally{m(!1)}})()},[e]);const S=N.useCallback(async()=>{a(null),h("system_prompt"),m(!0);try{const A=await gh(e);y(A)}catch(A){console.error("Failed to load system prompt:",A),y("Error loading system prompt")}finally{m(!1)}},[e]),x=N.useCallback(async A=>{a(A),h("skill"),m(!0);try{const M=await z0(i,A);y(M.content)}catch(M){console.error("Failed to load skill file:",M),y("Error loading file")}finally{m(!1)}},[i]),C=N.useCallback(A=>{f(M=>{const T=new Set(M);return T.has(A)?T.delete(A):T.add(A),T})},[]),w=N.useCallback(async()=>{b(!0);try{await W0(i);const A=await vh(i);n(A);const M=new Set;A.forEach(T=>{T.type==="directory"&&M.add(T.path)}),f(M),a(null),h("system_prompt")}catch(A){console.error("Failed to reload skills:",A)}finally{b(!1)}},[i]),E=c==="system_prompt"||(o==null?void 0:o.endsWith(".md"));return D.jsxs("div",{className:"fixed inset-0 z-50 flex",children:[D.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:t}),D.jsxs("div",{className:"relative z-10 flex w-full h-full m-4 rounded-xl border border-[var(--color-border)] bg-[var(--color-background)] shadow-2xl overflow-hidden",children:[D.jsxs("div",{className:"w-64 flex-shrink-0 border-r border-[var(--color-border)] bg-[var(--color-bg-secondary)]/30 flex flex-col",children:[D.jsx("div",{className:"flex items-center justify-between px-4 py-3 border-b border-[var(--color-border)]",children:D.jsx("h2",{className:"text-sm font-semibold text-[var(--color-text-heading)]",children:"Documentation"})}),D.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[D.jsxs("button",{onClick:S,className:ue("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left text-xs transition-colors mb-2",c==="system_prompt"?"bg-[var(--color-accent-primary)]/10 text-[var(--color-accent-primary)]":"text-[var(--color-text-secondary)] hover:bg-[var(--color-bg-secondary)] hover:text-[var(--color-text-primary)]"),children:[D.jsx(Wl,{className:"h-3.5 w-3.5 flex-shrink-0"}),D.jsx("span",{className:"font-medium",children:"System Prompt"})]}),D.jsx("div",{className:"my-2 border-t border-[var(--color-border)]"}),D.jsxs("button",{onClick:w,disabled:v,className:"flex w-full items-center justify-center gap-2 rounded-lg px-3 py-2 text-xs font-medium bg-blue-600 text-white hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed mb-3 shadow-sm",children:[D.jsx(Xr,{className:ue("h-3.5 w-3.5 flex-shrink-0",v&&"animate-spin")}),D.jsx("span",{children:v?"Reloading...":"Reload project skills"})]}),D.jsx("div",{className:"px-2 py-1 text-[10px] font-semibold uppercase tracking-wider text-[var(--color-text-muted)]",children:"Skills"}),s?D.jsx("div",{className:"flex items-center justify-center py-8",children:D.jsx(Ni,{className:"h-4 w-4 animate-spin text-[var(--color-text-muted)]"})}):r.length===0?D.jsx("div",{className:"px-2 py-4 text-xs text-[var(--color-text-muted)]",children:"No skills available"}):D.jsx("div",{className:"space-y-0.5",children:r.map(A=>D.jsx(Gp,{node:A,level:0,selectedPath:o,expandedPaths:u,onSelect:x,onToggle:C},A.path))})]})]}),D.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[D.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-[var(--color-border)]",children:[D.jsx("div",{className:"flex items-center gap-2 min-w-0",children:c==="system_prompt"?D.jsxs(D.Fragment,{children:[D.jsx(Wl,{className:"h-4 w-4 flex-shrink-0 text-[var(--color-accent-primary)]"}),D.jsxs("div",{className:"min-w-0",children:[D.jsx("h3",{className:"text-sm font-semibold text-[var(--color-text-heading)] truncate",children:"System Prompt"}),D.jsx("p",{className:"text-xs text-[var(--color-text-muted)]",children:"Instructions injected to Claude Code"})]})]}):D.jsxs(D.Fragment,{children:[D.jsx(ar,{className:"h-4 w-4 flex-shrink-0 text-[var(--color-accent-secondary)]"}),D.jsxs("div",{className:"min-w-0",children:[D.jsx("h3",{className:"text-sm font-semibold text-[var(--color-text-heading)] truncate",children:(o==null?void 0:o.split("/").pop())||"Select a file"}),D.jsx("p",{className:"text-xs text-[var(--color-text-muted)] truncate",children:o||"Choose a skill file from the sidebar"})]})]})}),D.jsxs("div",{className:"flex items-center gap-2",children:[E&&D.jsx("button",{onClick:()=>g(!p),className:ue("flex items-center gap-1 px-2 py-1 rounded-md text-xs transition-colors",p?"bg-[var(--color-accent-primary)]/10 text-[var(--color-accent-primary)]":"text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-bg-secondary)]"),children:p?D.jsxs(D.Fragment,{children:[D.jsx(wv,{className:"h-3 w-3"}),"Rendered"]}):D.jsxs(D.Fragment,{children:[D.jsx(lv,{className:"h-3 w-3"}),"Raw"]})}),D.jsx("button",{onClick:t,className:"p-1 rounded-md text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-bg-secondary)] transition-colors",children:D.jsx(Vn,{className:"h-4 w-4"})})]})]}),D.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:_?D.jsx("div",{className:"flex items-center justify-center py-20",children:D.jsxs("div",{className:"flex flex-col items-center gap-3",children:[D.jsx(Ni,{className:"h-6 w-6 animate-spin text-[var(--color-accent-primary)]"}),D.jsx("p",{className:"text-xs text-[var(--color-text-muted)]",children:"Loading..."})]})}):p||!E?D.jsx("pre",{className:"text-xs font-mono text-[var(--color-text-primary)] whitespace-pre-wrap break-words bg-[var(--color-bg-secondary)]/50 p-4 rounded-lg border border-[var(--color-border)]",children:d}):D.jsx("div",{className:"prose prose-xs max-w-none text-[var(--color-text-primary)] text-xs leading-relaxed",children:D.jsx(Vx,{remarkPlugins:[rC],children:d})})})]})]})]})}const gi={FILE:"File",VIEW:"View",TERMINAL:"Terminal",SEARCH:"Search"};function sC(i){const e=navigator.platform.toUpperCase().indexOf("MAC")>=0;return i.replace("Cmd",e?"⌘":"Ctrl").replace("Alt",e?"⌥":"Alt").replace("Shift",e?"⇧":"Shift").replace("+"," ")}function oC({isOpen:i,onClose:e,commands:t}){const[r,n]=N.useState(""),[s,l]=N.useState(0),o=N.useRef(null),a=N.useRef(null),c=r?t.filter(f=>f.label.toLowerCase().includes(r.toLowerCase())||f.id.toLowerCase().includes(r.toLowerCase())||f.category&&f.category.toLowerCase().includes(r.toLowerCase())):t;N.useEffect(()=>{i&&(n(""),l(0),setTimeout(()=>{var f;return(f=o.current)==null?void 0:f.focus()},10))},[i]),N.useEffect(()=>{l(0)},[r]),N.useEffect(()=>{if(a.current){const f=a.current.children[s];f&&f.scrollIntoView({block:"nearest"})}},[s]);const h=N.useCallback(f=>{switch(f.key){case"ArrowDown":f.preventDefault(),l(d=>d<c.length-1?d+1:d);break;case"ArrowUp":f.preventDefault(),l(d=>d>0?d-1:d);break;case"Enter":f.preventDefault(),c[s]&&(c[s].action(),e());break;case"Escape":f.preventDefault(),e();break}},[c,s,e]),u=N.useCallback(f=>{f.action(),e()},[e]);return i?D.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-[20vh]",children:[D.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:e}),D.jsxs("div",{className:"relative w-full max-w-lg bg-[var(--color-background)] border border-[var(--color-border)] rounded-lg shadow-xl overflow-hidden",children:[D.jsxs("div",{className:"flex items-center gap-2 px-3 border-b border-[var(--color-border)]",children:[D.jsx(bv,{className:"h-4 w-4 text-[var(--color-text-muted)]"}),D.jsx("input",{ref:o,type:"text",value:r,onChange:f=>n(f.target.value),onKeyDown:h,placeholder:"Type a command or search...",className:"flex-1 h-12 bg-transparent text-sm text-[var(--color-text-primary)] placeholder:text-[var(--color-text-muted)] focus:outline-none"}),D.jsx("button",{onClick:e,className:"p-1 rounded hover:bg-[var(--color-bg-secondary)] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)]",children:D.jsx(Vn,{className:"h-4 w-4"})})]}),D.jsx("div",{ref:a,className:"max-h-80 overflow-y-auto py-2",children:c.length===0?D.jsx("div",{className:"px-3 py-8 text-center text-sm text-[var(--color-text-muted)]",children:"No commands found"}):c.map((f,d)=>D.jsxs("button",{onClick:()=>u(f),className:ue("w-full flex items-center justify-between px-3 py-2 text-sm transition-colors",d===s?"bg-[var(--color-accent-primary)]/10 text-[var(--color-text-primary)]":"text-[var(--color-text-secondary)] hover:bg-[var(--color-bg-secondary)]"),children:[D.jsxs("div",{className:"flex items-center gap-2",children:[f.category&&D.jsx("span",{className:"text-xs text-[var(--color-text-muted)]",children:f.category}),D.jsx("span",{children:f.label})]}),f.shortcut&&D.jsx("span",{className:"text-xs text-[var(--color-text-muted)] font-mono",children:sC(f.shortcut)})]},f.id))})]})]}):null}function Xp(i,e=""){const t=[];for(const r of i){const n=e?`${e}/${r.name}`:r.name;r.type==="file"&&t.push({path:n,name:r.name}),r.children&&t.push(...Xp(r.children,n))}return t}function Au(i,e){const t=i.toLowerCase(),r=e.toLowerCase();if(r===t)return{match:!0,score:100};if(r.includes(t))return{match:!0,score:80-r.indexOf(t)};let n=0,s=0;for(let l=0;l<r.length&&n<t.length;l++)r[l]===t[n]&&(n++,s+=1);return n===t.length?{match:!0,score:s}:{match:!1,score:0}}function lC(i){const e=qn(i),t={py:"text-blue-400",js:"text-yellow-400",jsx:"text-yellow-400",ts:"text-blue-400",tsx:"text-blue-400",json:"text-orange-400",yaml:"text-purple-400",yml:"text-purple-400",md:"text-gray-400",sql:"text-green-400"};return D.jsx(Un,{className:ue("h-4 w-4",t[e]||"text-gray-400")})}function aC({isOpen:i,onClose:e,files:t,onFileSelect:r}){const[n,s]=N.useState(""),[l,o]=N.useState(0),a=N.useRef(null),c=N.useRef(null),h=N.useMemo(()=>Xp(t),[t]),u=N.useMemo(()=>n?h.map(y=>{const _=Au(n,y.path),m=Au(n,y.name),p=Math.max(_.score,m.score*1.5);return{...y,score:p,match:_.match||m.match}}).filter(y=>y.match).sort((y,_)=>_.score-y.score).slice(0,50):h.slice(0,50),[h,n]);N.useEffect(()=>{i&&(s(""),o(0),setTimeout(()=>{var y;return(y=a.current)==null?void 0:y.focus()},10))},[i]),N.useEffect(()=>{o(0)},[n]),N.useEffect(()=>{if(c.current){const y=c.current.children[l];y&&y.scrollIntoView({block:"nearest"})}},[l]);const f=N.useCallback(y=>{switch(y.key){case"ArrowDown":y.preventDefault(),o(_=>_<u.length-1?_+1:_);break;case"ArrowUp":y.preventDefault(),o(_=>_>0?_-1:_);break;case"Enter":y.preventDefault(),u[l]&&(r(u[l].path),e());break;case"Escape":y.preventDefault(),e();break}},[u,l,r,e]),d=N.useCallback(y=>{r(y),e()},[r,e]);return i?D.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-[20vh]",children:[D.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:e}),D.jsxs("div",{className:"relative w-full max-w-lg bg-[var(--color-background)] border border-[var(--color-border)] rounded-lg shadow-xl overflow-hidden",children:[D.jsxs("div",{className:"flex items-center gap-2 px-3 border-b border-[var(--color-border)]",children:[D.jsx(Ya,{className:"h-4 w-4 text-[var(--color-text-muted)]"}),D.jsx("input",{ref:a,type:"text",value:n,onChange:y=>s(y.target.value),onKeyDown:f,placeholder:"Search files by name...",className:"flex-1 h-12 bg-transparent text-sm text-[var(--color-text-primary)] placeholder:text-[var(--color-text-muted)] focus:outline-none"}),D.jsx("button",{onClick:e,className:"p-1 rounded hover:bg-[var(--color-bg-secondary)] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)]",children:D.jsx(Vn,{className:"h-4 w-4"})})]}),D.jsx("div",{ref:c,className:"max-h-80 overflow-y-auto py-2",children:u.length===0?D.jsx("div",{className:"px-3 py-8 text-center text-sm text-[var(--color-text-muted)]",children:n?"No files found":"No files in project"}):u.map((y,_)=>D.jsxs("button",{onClick:()=>d(y.path),className:ue("w-full flex items-center gap-2 px-3 py-2 text-sm transition-colors",_===l?"bg-[var(--color-accent-primary)]/10 text-[var(--color-text-primary)]":"text-[var(--color-text-secondary)] hover:bg-[var(--color-bg-secondary)]"),children:[lC(y.name),D.jsx("span",{className:"truncate",children:y.name}),D.jsx("span",{className:"ml-auto text-xs text-[var(--color-text-muted)] truncate max-w-[200px]",children:y.path})]},y.path))})]})]}):null}function cC(i){const e=qn(i),t={py:"text-blue-400",js:"text-yellow-400",jsx:"text-yellow-400",ts:"text-blue-400",tsx:"text-blue-400",json:"text-orange-400",yaml:"text-purple-400",yml:"text-purple-400",md:"text-gray-400",sql:"text-green-400"};return D.jsx(Un,{className:ue("h-3.5 w-3.5 flex-shrink-0",t[e]||"text-gray-400")})}function hC({results:i,onResultSelect:e,className:t=""}){const[r,n]=N.useState(new Set),s=N.useMemo(()=>{const a={};for(const h of i)a[h.path]||(a[h.path]={path:h.path,matches:[]}),a[h.path].matches.push(h);const c=Object.keys(a);return r.size===0&&c.length>0&&n(new Set(c)),Object.values(a)},[i]),l=a=>{n(c=>{const h=new Set(c);return h.has(a)?h.delete(a):h.add(a),h})},o=(a,c,h)=>{const u=a.slice(0,c),f=a.slice(c,h),d=a.slice(h);return D.jsxs(D.Fragment,{children:[D.jsx("span",{className:"text-[var(--color-text-muted)]",children:u}),D.jsx("span",{className:"bg-[var(--color-accent-primary)]/30 text-[var(--color-accent-primary)]",children:f}),D.jsx("span",{className:"text-[var(--color-text-muted)]",children:d})]})};return D.jsx("div",{className:ue("text-xs",t),children:s.map(a=>{const c=r.has(a.path),h=a.path.split("/").pop()||a.path;return D.jsxs("div",{children:[D.jsxs("button",{onClick:()=>l(a.path),className:"w-full flex items-center gap-1 px-2 py-1 hover:bg-[var(--color-bg-secondary)] text-left",children:[c?D.jsx(Kn,{className:"h-3 w-3 text-[var(--color-text-muted)]"}):D.jsx(So,{className:"h-3 w-3 text-[var(--color-text-muted)]"}),cC(h),D.jsx("span",{className:"text-[var(--color-text-primary)] truncate",children:h}),D.jsx("span",{className:"ml-auto text-[var(--color-text-muted)]",children:a.matches.length})]}),c&&D.jsx("div",{className:"ml-4",children:a.matches.map((u,f)=>D.jsxs("button",{onClick:()=>e(u.path,u.line_number),className:"w-full flex items-start gap-2 px-2 py-1 hover:bg-[var(--color-bg-secondary)] text-left group",children:[D.jsx("span",{className:"text-[var(--color-text-muted)] w-8 text-right flex-shrink-0",children:u.line_number}),D.jsx("span",{className:"truncate font-mono",children:o(u.line_content.trim(),u.match_start,u.match_end)})]},`${u.path}-${u.line_number}-${f}`))})]},a.path)})})}function uC({projectId:i,onResultSelect:e,className:t=""}){const[r,n]=N.useState(""),[s,l]=N.useState(!1),[o,a]=N.useState(!1),[c,h]=N.useState(""),[u,f]=N.useState(!1),[d,y]=N.useState([]),[_,m]=N.useState(!1),[p,g]=N.useState(null),v=N.useRef(null),b=N.useRef(null),S=N.useCallback(async C=>{if(!C.trim()){y([]);return}m(!0),g(null);try{const w=await $0(i,{query:C,caseSensitive:s,regex:o,glob:c||void 0});y(w)}catch(w){g(w instanceof Error?w.message:"Search failed"),y([])}finally{m(!1)}},[i,s,o,c]);N.useEffect(()=>(b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{S(r)},300),()=>{b.current&&clearTimeout(b.current)}),[r,S]),N.useEffect(()=>{r.trim()&&S(r)},[s,o,c]);const x=C=>{C.key==="Escape"&&(n(""),y([]))};return D.jsxs("div",{className:ue("flex flex-col h-full",t),children:[D.jsxs("div",{className:"flex-shrink-0 p-2 border-b border-[var(--color-border)]",children:[D.jsx("div",{className:"flex items-center gap-1",children:D.jsxs("div",{className:"relative flex-1",children:[D.jsx(Ya,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-[var(--color-text-muted)]"}),D.jsx("input",{ref:v,type:"text",value:r,onChange:C=>n(C.target.value),onKeyDown:x,placeholder:"Search in files...",className:"w-full h-7 pl-7 pr-2 rounded-md border border-[var(--color-border)] bg-[var(--color-background)] text-xs text-[var(--color-text-primary)] placeholder:text-[var(--color-text-muted)] focus:outline-none focus:ring-1 focus:ring-[var(--color-accent-primary)]/50"}),r&&D.jsx("button",{onClick:()=>{n(""),y([])},className:"absolute right-2 top-1/2 -translate-y-1/2 text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)]",children:D.jsx(Vn,{className:"h-3 w-3"})})]})}),D.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[D.jsx("button",{onClick:()=>l(!s),className:ue("flex items-center justify-center h-6 w-6 rounded transition-colors",s?"bg-[var(--color-accent-primary)]/20 text-[var(--color-accent-primary)]":"text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-bg-secondary)]"),title:"Match case",children:D.jsx(dv,{className:"h-3.5 w-3.5"})}),D.jsx("button",{onClick:()=>a(!o),className:ue("flex items-center justify-center h-6 w-6 rounded transition-colors",o?"bg-[var(--color-accent-primary)]/20 text-[var(--color-accent-primary)]":"text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-bg-secondary)]"),title:"Use regular expression",children:D.jsx(qv,{className:"h-3.5 w-3.5"})}),D.jsx("button",{onClick:()=>f(!u),className:ue("flex items-center justify-center h-6 w-6 rounded transition-colors",u||c?"bg-[var(--color-accent-primary)]/20 text-[var(--color-accent-primary)]":"text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-bg-secondary)]"),title:"Filter files",children:D.jsx(Tv,{className:"h-3.5 w-3.5"})}),D.jsx("span",{className:"ml-auto text-[10px] text-[var(--color-text-muted)]",children:_?"Searching...":d.length>0?`${d.length} results`:""})]}),u&&D.jsx("div",{className:"mt-2",children:D.jsx("input",{type:"text",value:c,onChange:C=>h(C.target.value),placeholder:"File filter (e.g., *.py, src/**/*.ts)",className:"w-full h-7 px-2 rounded-md border border-[var(--color-border)] bg-[var(--color-background)] text-xs text-[var(--color-text-primary)] placeholder:text-[var(--color-text-muted)] focus:outline-none focus:ring-1 focus:ring-[var(--color-accent-primary)]/50"})})]}),D.jsx("div",{className:"flex-1 overflow-y-auto",children:p?D.jsx("div",{className:"p-3 text-xs text-red-400",children:p}):d.length===0&&r?D.jsx("div",{className:"p-3 text-xs text-[var(--color-text-muted)] text-center",children:_?"Searching...":"No results found"}):d.length===0?D.jsx("div",{className:"p-3 text-xs text-[var(--color-text-muted)] text-center",children:"Enter a search term to find in files"}):D.jsx(hC,{results:d,onResultSelect:e})})]})}const ei="/api";function fC({projectId:i,onOpenDiff:e,className:t=""}){var X,ee,re;const[r,n]=N.useState(null),[s,l]=N.useState([]),[o,a]=N.useState([]),[c,h]=N.useState(""),[u,f]=N.useState(!1),[d,y]=N.useState(null),[_,m]=N.useState(null),[p,g]=N.useState("changes"),[v,b]=N.useState(!1),[S,x]=N.useState({staged:!0,changes:!0,untracked:!0}),C=N.useRef(null),w=N.useCallback(async()=>{try{const O=await fetch(`${ei}/projects/${i}/git/status`);if(!O.ok){const K=await O.json().catch(()=>({detail:"Failed to get git status"}));throw new Error(K.detail)}const R=await O.json();n(R),m(null)}catch(O){m(O instanceof Error?O.message:"Failed to get git status")}},[i]),E=N.useCallback(async()=>{try{const O=await fetch(`${ei}/projects/${i}/git/log?limit=30`);if(!O.ok)return;const R=await O.json();l(R.commits||[])}catch{}},[i]),A=N.useCallback(async()=>{try{const O=await fetch(`${ei}/projects/${i}/git/branches`);if(!O.ok)return;const R=await O.json();a(R.branches||[])}catch{}},[i]);N.useEffect(()=>{f(!0),Promise.all([w(),E(),A()]).finally(()=>f(!1))},[w,E,A]),N.useEffect(()=>{C.current=setInterval(()=>{document.hidden||w()},3e4);const O=()=>{!document.hidden&&C.current&&w()};return document.addEventListener("visibilitychange",O),()=>{C.current&&clearInterval(C.current),document.removeEventListener("visibilitychange",O)}},[w]);const M=N.useCallback(async()=>{f(!0),await Promise.all([w(),E(),A()]),f(!1)},[w,E,A]),T=N.useCallback(async O=>{y("stage");try{const R=await fetch(`${ei}/projects/${i}/git/stage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:O})});if(!R.ok){const K=await R.json().catch(()=>({detail:"Stage failed"}));throw new Error(K.detail)}await w()}catch(R){m(R instanceof Error?R.message:"Stage failed")}finally{y(null)}},[i,w]),B=N.useCallback(async O=>{y("unstage");try{const R=await fetch(`${ei}/projects/${i}/git/unstage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:O})});if(!R.ok){const K=await R.json().catch(()=>({detail:"Unstage failed"}));throw new Error(K.detail)}await w()}catch(R){m(R instanceof Error?R.message:"Unstage failed")}finally{y(null)}},[i,w]),F=N.useCallback(async()=>{if(c.trim()){y("commit");try{const O=await fetch(`${ei}/projects/${i}/git/commit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:c})});if(!O.ok){const R=await O.json().catch(()=>({detail:"Commit failed"}));throw new Error(R.detail)}h(""),await Promise.all([w(),E()])}catch(O){m(O instanceof Error?O.message:"Commit failed")}finally{y(null)}}},[i,c,w,E]),j=N.useCallback(async()=>{y("push");try{const O=await fetch(`${ei}/projects/${i}/git/push`,{method:"POST"});if(!O.ok){const R=await O.json().catch(()=>({detail:"Push failed"}));throw new Error(R.detail)}await w()}catch(O){m(O instanceof Error?O.message:"Push failed")}finally{y(null)}},[i,w]),z=N.useCallback(async()=>{y("pull");try{const O=await fetch(`${ei}/projects/${i}/git/pull`,{method:"POST"});if(!O.ok){const R=await O.json().catch(()=>({detail:"Pull failed"}));throw new Error(R.detail)}await Promise.all([w(),E()])}catch(O){m(O instanceof Error?O.message:"Pull failed")}finally{y(null)}},[i,w,E]),$=N.useCallback(async O=>{y("checkout"),b(!1);try{const R=await fetch(`${ei}/projects/${i}/git/checkout`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch:O})});if(!R.ok){const K=await R.json().catch(()=>({detail:"Checkout failed"}));throw new Error(K.detail)}await M()}catch(R){m(R instanceof Error?R.message:"Checkout failed")}finally{y(null)}},[i,M]),V=N.useCallback(async O=>{if(e)try{const R=O.status==="staged",K=await fetch(`${ei}/projects/${i}/git/diff?file=${encodeURIComponent(O.path)}&staged=${R}`);if(!K.ok)return;const W=await K.json();e(O.path,W.diff||"")}catch{}},[i,e]),L=O=>{x(R=>({...R,[O]:!R[O]}))},k=((X=r==null?void 0:r.files)==null?void 0:X.filter(O=>O.status==="staged"||O.status==="staged+modified"))||[],I=((ee=r==null?void 0:r.files)==null?void 0:ee.filter(O=>O.status==="modified"||O.status==="staged+modified"))||[],H=((re=r==null?void 0:r.files)==null?void 0:re.filter(O=>O.status==="untracked"))||[],P=O=>{switch(O){case"A":return"text-green-400";case"D":return"text-red-400";case"M":return"text-yellow-400";case"R":return"text-blue-400";case"U":return"text-gray-400";default:return"text-gray-400"}};return u&&!r?D.jsx("div",{className:ue("flex items-center justify-center h-full",t),children:D.jsx(Ni,{className:"h-5 w-5 animate-spin text-[var(--color-text-muted)]"})}):D.jsxs("div",{className:ue("flex flex-col h-full text-sm",t),children:[D.jsxs("div",{className:"flex items-center justify-between px-3 h-9 border-b border-[var(--color-border)] flex-shrink-0",children:[D.jsx("span",{className:"text-xs font-semibold text-[var(--color-text-primary)] uppercase tracking-wider",children:"Source Control"}),D.jsx("div",{className:"flex items-center gap-1",children:D.jsx("button",{onClick:M,className:"p-1 text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors",title:"Refresh",children:D.jsx(Xr,{className:ue("h-3.5 w-3.5",u&&"animate-spin")})})})]}),D.jsxs("div",{className:"flex items-center gap-1 px-3 py-1.5 border-b border-[var(--color-border)] flex-shrink-0",children:[D.jsxs("div",{className:"relative flex-1",children:[D.jsxs("button",{onClick:()=>{b(!v),v||A()},className:"flex items-center gap-1.5 text-xs text-[var(--color-text-primary)] hover:text-[var(--color-accent-primary)] transition-colors",children:[D.jsx(wd,{className:"h-3.5 w-3.5"}),D.jsx("span",{className:"truncate",children:(r==null?void 0:r.branch)||"main"}),D.jsx(Kn,{className:"h-3 w-3"})]}),v&&D.jsx("div",{className:"absolute top-full left-0 mt-1 w-56 bg-[var(--color-bg-secondary)] border border-[var(--color-border)] rounded shadow-lg z-50 max-h-48 overflow-y-auto",children:o.map(O=>D.jsxs("button",{onClick:()=>$(O.name),className:ue("w-full text-left px-3 py-1.5 text-xs hover:bg-[var(--color-background)] transition-colors truncate",O.current?"text-[var(--color-accent-primary)] font-medium":"text-[var(--color-text-primary)]"),children:[O.current&&D.jsx(yh,{className:"h-3 w-3 inline mr-1"}),O.name]},O.name))})]}),D.jsxs("button",{onClick:z,disabled:d==="pull",className:"flex items-center gap-0.5 px-1.5 py-0.5 text-[10px] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-background)] rounded transition-colors disabled:opacity-50",title:"Pull",children:[D.jsx(cv,{className:"h-3 w-3"}),((r==null?void 0:r.behind)??0)>0&&D.jsx("span",{children:r==null?void 0:r.behind})]}),D.jsxs("button",{onClick:j,disabled:d==="push",className:"flex items-center gap-0.5 px-1.5 py-0.5 text-[10px] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-background)] rounded transition-colors disabled:opacity-50",title:"Push",children:[D.jsx(uv,{className:"h-3 w-3"}),((r==null?void 0:r.ahead)??0)>0&&D.jsx("span",{children:r==null?void 0:r.ahead})]})]}),D.jsxs("div",{className:"flex items-center border-b border-[var(--color-border)] flex-shrink-0",children:[D.jsxs("button",{onClick:()=>g("changes"),className:ue("flex items-center gap-1 px-3 py-1.5 text-xs transition-colors",p==="changes"?"text-[var(--color-text-primary)] border-b-2 border-[var(--color-accent-primary)]":"text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)]"),children:[D.jsx(ar,{className:"h-3 w-3"}),"Changes"]}),D.jsxs("button",{onClick:()=>{g("log"),E()},className:ue("flex items-center gap-1 px-3 py-1.5 text-xs transition-colors",p==="log"?"text-[var(--color-text-primary)] border-b-2 border-[var(--color-accent-primary)]":"text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)]"),children:[D.jsx(Iv,{className:"h-3 w-3"}),"Log"]})]}),_&&D.jsxs("div",{className:"px-3 py-2 text-xs text-red-400 bg-red-400/10 border-b border-[var(--color-border)]",children:[_,D.jsx("button",{onClick:()=>m(null),className:"ml-2 underline",children:"dismiss"})]}),p==="changes"?D.jsxs("div",{className:"flex-1 overflow-y-auto",children:[D.jsxs("div",{className:"px-3 py-2 border-b border-[var(--color-border)]",children:[D.jsx("textarea",{value:c,onChange:O=>h(O.target.value),placeholder:"Commit message",className:"w-full px-2 py-1.5 text-xs bg-[var(--color-background)] border border-[var(--color-border)] rounded text-[var(--color-text-primary)] placeholder:text-[var(--color-text-muted)] resize-none focus:outline-none focus:border-[var(--color-accent-primary)]",rows:3,onKeyDown:O=>{O.key==="Enter"&&(O.metaKey||O.ctrlKey)&&F()}}),D.jsxs("button",{onClick:F,disabled:!c.trim()||k.length===0||d==="commit",className:"mt-1.5 w-full flex items-center justify-center gap-1.5 px-3 py-1.5 text-xs font-medium bg-[var(--color-accent-primary)] text-white rounded hover:bg-[var(--color-accent-primary)]/80 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[d==="commit"?D.jsx(Ni,{className:"h-3 w-3 animate-spin"}):D.jsx(yh,{className:"h-3 w-3"}),"Commit (",k.length," staged)"]})]}),k.length>0&&D.jsx(hl,{title:"Staged Changes",count:k.length,expanded:S.staged,onToggle:()=>L("staged"),files:k,onAction:O=>B([O.path]),actionIcon:D.jsx(Wv,{className:"h-3 w-3"}),actionTitle:"Unstage",statusBadgeColor:P,onFileClick:V}),I.length>0&&D.jsx(hl,{title:"Changes",count:I.length,expanded:S.changes,onToggle:()=>L("changes"),files:I,onAction:O=>T([O.path]),actionIcon:D.jsx($l,{className:"h-3 w-3"}),actionTitle:"Stage",statusBadgeColor:P,onFileClick:V}),H.length>0&&D.jsx(hl,{title:"Untracked",count:H.length,expanded:S.untracked,onToggle:()=>L("untracked"),files:H,onAction:O=>T([O.path]),actionIcon:D.jsx($l,{className:"h-3 w-3"}),actionTitle:"Stage",statusBadgeColor:P,onFileClick:V}),k.length===0&&I.length===0&&H.length===0&&D.jsx("div",{className:"px-3 py-8 text-center text-xs text-[var(--color-text-muted)]",children:"No changes detected"})]}):D.jsx("div",{className:"flex-1 overflow-y-auto",children:s.length===0?D.jsx("div",{className:"px-3 py-8 text-center text-xs text-[var(--color-text-muted)]",children:"No commits yet"}):s.map(O=>D.jsx("div",{className:"px-3 py-2 border-b border-[var(--color-border)] hover:bg-[var(--color-background)]/50 transition-colors",children:D.jsxs("div",{className:"flex items-start gap-2",children:[D.jsx("span",{className:"text-[10px] font-mono text-[var(--color-accent-primary)] flex-shrink-0 mt-0.5",children:O.short_hash}),D.jsxs("div",{className:"min-w-0 flex-1",children:[D.jsx("div",{className:"text-xs text-[var(--color-text-primary)] truncate",children:O.message}),D.jsxs("div",{className:"text-[10px] text-[var(--color-text-muted)] mt-0.5",children:[O.author," - ",new Date(O.timestamp*1e3).toLocaleDateString()]})]})]})},O.hash))})]})}function hl({title:i,count:e,expanded:t,onToggle:r,files:n,onAction:s,actionIcon:l,actionTitle:o,statusBadgeColor:a,onFileClick:c}){return D.jsxs("div",{children:[D.jsxs("button",{onClick:r,className:"flex items-center gap-1 w-full px-3 py-1.5 text-[11px] font-semibold text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] uppercase tracking-wider transition-colors",children:[t?D.jsx(Kn,{className:"h-3 w-3"}):D.jsx(So,{className:"h-3 w-3"}),i,D.jsx("span",{className:"ml-auto text-[10px] font-normal bg-[var(--color-bg-secondary)] px-1.5 rounded",children:e})]}),t&&D.jsx("div",{children:n.map(h=>{const u=h.path.split("/").pop()||h.path,f=h.path.includes("/")?h.path.substring(0,h.path.lastIndexOf("/")):"";return D.jsxs("div",{className:"group flex items-center gap-1 px-3 py-1 hover:bg-[var(--color-background)]/50 transition-colors cursor-pointer",onClick:()=>c(h),children:[D.jsx("span",{className:ue("text-[10px] font-mono w-4 text-center flex-shrink-0",a(h.change_type)),children:h.change_type}),D.jsx("span",{className:"text-xs text-[var(--color-text-primary)] truncate",children:u}),f&&D.jsx("span",{className:"text-[10px] text-[var(--color-text-muted)] truncate ml-1",children:f}),D.jsx("button",{onClick:d=>{d.stopPropagation(),s(h)},className:"ml-auto p-0.5 text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] opacity-0 group-hover:opacity-100 transition-all",title:o,children:l})]},`${h.path}-${h.status}`)})})]})}function dC({projectId:i,className:e=""}){const[t,r]=N.useState([{id:"welcome",type:"output",content:`Terminal ready. Working directory: /projects/${i}`,timestamp:new Date}]),[n,s]=N.useState(""),[l,o]=N.useState(!1),[a,c]=N.useState([]),[h,u]=N.useState(-1),f=N.useRef(null),d=N.useRef(null);N.useEffect(()=>{d.current&&(d.current.scrollTop=d.current.scrollHeight)},[t]);const y=N.useCallback(()=>{var p;(p=f.current)==null||p.focus()},[]),_=N.useCallback(async p=>{if(!p.trim())return;const g={id:`input-${Date.now()}`,type:"input",content:`$ ${p}`,timestamp:new Date};r(v=>[...v,g]),c(v=>[...v,p]),u(-1),o(!0);try{const v=await fetch(`/api/projects/${i}/terminal/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:p})}),b=await v.json();if(b.stdout){const S={id:`output-${Date.now()}`,type:"output",content:b.stdout,timestamp:new Date};r(x=>[...x,S])}if(b.stderr){const S={id:`error-${Date.now()}`,type:"error",content:b.stderr,timestamp:new Date};r(x=>[...x,S])}if(!v.ok&&b.detail){const S={id:`error-${Date.now()}`,type:"error",content:b.detail,timestamp:new Date};r(x=>[...x,S])}}catch(v){const b={id:`error-${Date.now()}`,type:"error",content:v instanceof Error?v.message:"Command execution failed",timestamp:new Date};r(S=>[...S,b])}finally{o(!1)}},[i]),m=N.useCallback(p=>{if(p.key==="Enter"&&!l)_(n),s("");else if(p.key==="ArrowUp"){if(p.preventDefault(),a.length>0){const g=h<a.length-1?h+1:h;u(g),s(a[a.length-1-g]||"")}}else if(p.key==="ArrowDown")if(p.preventDefault(),h>0){const g=h-1;u(g),s(a[a.length-1-g]||"")}else h===0&&(u(-1),s(""));else p.key==="c"&&p.ctrlKey?(s(""),r(g=>[...g,{id:`interrupt-${Date.now()}`,type:"output",content:"^C",timestamp:new Date}])):p.key==="l"&&p.ctrlKey&&(p.preventDefault(),r([]))},[n,l,a,h,_]);return D.jsxs("div",{ref:d,className:ue("h-full bg-[#1e1e1e] text-[#d4d4d4] font-mono text-xs overflow-y-auto p-2 cursor-text",e),onClick:y,children:[t.map(p=>D.jsx("div",{className:ue("whitespace-pre-wrap break-all",p.type==="input"&&"text-[#569cd6]",p.type==="error"&&"text-[#f14c4c]",p.type==="output"&&"text-[#d4d4d4]"),children:p.content},p.id)),D.jsxs("div",{className:"flex items-center",children:[D.jsx("span",{className:"text-[#569cd6] mr-1",children:"$"}),D.jsx("input",{ref:f,type:"text",value:n,onChange:p=>s(p.target.value),onKeyDown:m,disabled:l,className:"flex-1 bg-transparent outline-none text-[#d4d4d4] caret-[#d4d4d4]",autoFocus:!0}),l&&D.jsx("span",{className:"animate-pulse ml-2 text-[#808080]",children:"Running..."})]})]})}var ul={exports:{}},Du;function pC(){return Du||(Du=1,(function(i,e){(function(t,r){i.exports=r()})(globalThis,(()=>(()=>{var t={4567:function(l,o,a){var c=this&&this.__decorate||function(g,v,b,S){var x,C=arguments.length,w=C<3?v:S===null?S=Object.getOwnPropertyDescriptor(v,b):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(g,v,b,S);else for(var E=g.length-1;E>=0;E--)(x=g[E])&&(w=(C<3?x(w):C>3?x(v,b,w):x(v,b))||w);return C>3&&w&&Object.defineProperty(v,b,w),w},h=this&&this.__param||function(g,v){return function(b,S){v(b,S,g)}};Object.defineProperty(o,"__esModule",{value:!0}),o.AccessibilityManager=void 0;const u=a(9042),f=a(9924),d=a(844),y=a(4725),_=a(2585),m=a(3656);let p=o.AccessibilityManager=class extends d.Disposable{constructor(g,v,b,S){super(),this._terminal=g,this._coreBrowserService=b,this._renderService=S,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let x=0;x<this._terminal.rows;x++)this._rowElements[x]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[x]);if(this._topBoundaryFocusListener=x=>this._handleBoundaryFocus(x,0),this._bottomBoundaryFocusListener=x=>this._handleBoundaryFocus(x,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new f.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize((x=>this._handleResize(x.rows)))),this.register(this._terminal.onRender((x=>this._refreshRows(x.start,x.end)))),this.register(this._terminal.onScroll((()=>this._refreshRows()))),this.register(this._terminal.onA11yChar((x=>this._handleChar(x)))),this.register(this._terminal.onLineFeed((()=>this._handleChar(`
`)))),this.register(this._terminal.onA11yTab((x=>this._handleTab(x)))),this.register(this._terminal.onKey((x=>this._handleKey(x.key)))),this.register(this._terminal.onBlur((()=>this._clearLiveRegion()))),this.register(this._renderService.onDimensionsChange((()=>this._refreshRowsDimensions()))),this.register((0,m.addDisposableDomListener)(document,"selectionchange",(()=>this._handleSelectionChange()))),this.register(this._coreBrowserService.onDprChange((()=>this._refreshRowsDimensions()))),this._refreshRows(),this.register((0,d.toDisposable)((()=>{this._accessibilityContainer.remove(),this._rowElements.length=0})))}_handleTab(g){for(let v=0;v<g;v++)this._handleChar(" ")}_handleChar(g){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==g&&(this._charsToAnnounce+=g):this._charsToAnnounce+=g,g===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=u.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(g){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(g)||this._charsToConsume.push(g)}_refreshRows(g,v){this._liveRegionDebouncer.refresh(g,v,this._terminal.rows)}_renderRows(g,v){const b=this._terminal.buffer,S=b.lines.length.toString();for(let x=g;x<=v;x++){const C=b.lines.get(b.ydisp+x),w=[],E=(C==null?void 0:C.translateToString(!0,void 0,void 0,w))||"",A=(b.ydisp+x+1).toString(),M=this._rowElements[x];M&&(E.length===0?(M.innerText=" ",this._rowColumns.set(M,[0,1])):(M.textContent=E,this._rowColumns.set(M,w)),M.setAttribute("aria-posinset",A),M.setAttribute("aria-setsize",S))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(g,v){const b=g.target,S=this._rowElements[v===0?1:this._rowElements.length-2];if(b.getAttribute("aria-posinset")===(v===0?"1":`${this._terminal.buffer.lines.length}`)||g.relatedTarget!==S)return;let x,C;if(v===0?(x=b,C=this._rowElements.pop(),this._rowContainer.removeChild(C)):(x=this._rowElements.shift(),C=b,this._rowContainer.removeChild(x)),x.removeEventListener("focus",this._topBoundaryFocusListener),C.removeEventListener("focus",this._bottomBoundaryFocusListener),v===0){const w=this._createAccessibilityTreeNode();this._rowElements.unshift(w),this._rowContainer.insertAdjacentElement("afterbegin",w)}else{const w=this._createAccessibilityTreeNode();this._rowElements.push(w),this._rowContainer.appendChild(w)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(v===0?-1:1),this._rowElements[v===0?1:this._rowElements.length-2].focus(),g.preventDefault(),g.stopImmediatePropagation()}_handleSelectionChange(){var E;if(this._rowElements.length===0)return;const g=document.getSelection();if(!g)return;if(g.isCollapsed)return void(this._rowContainer.contains(g.anchorNode)&&this._terminal.clearSelection());if(!g.anchorNode||!g.focusNode)return void console.error("anchorNode and/or focusNode are null");let v={node:g.anchorNode,offset:g.anchorOffset},b={node:g.focusNode,offset:g.focusOffset};if((v.node.compareDocumentPosition(b.node)&Node.DOCUMENT_POSITION_PRECEDING||v.node===b.node&&v.offset>b.offset)&&([v,b]=[b,v]),v.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(v={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(v.node))return;const S=this._rowElements.slice(-1)[0];if(b.node.compareDocumentPosition(S)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(b={node:S,offset:((E=S.textContent)==null?void 0:E.length)??0}),!this._rowContainer.contains(b.node))return;const x=({node:A,offset:M})=>{const T=A instanceof Text?A.parentNode:A;let B=parseInt(T==null?void 0:T.getAttribute("aria-posinset"),10)-1;if(isNaN(B))return console.warn("row is invalid. Race condition?"),null;const F=this._rowColumns.get(T);if(!F)return console.warn("columns is null. Race condition?"),null;let j=M<F.length?F[M]:F.slice(-1)[0]+1;return j>=this._terminal.cols&&(++B,j=0),{row:B,column:j}},C=x(v),w=x(b);if(C&&w){if(C.row>w.row||C.row===w.row&&C.column>=w.column)throw new Error("invalid range");this._terminal.select(C.column,C.row,(w.row-C.row)*this._terminal.cols-C.column+w.column)}}_handleResize(g){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let v=this._rowContainer.children.length;v<this._terminal.rows;v++)this._rowElements[v]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[v]);for(;this._rowElements.length>g;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const g=this._coreBrowserService.mainDocument.createElement("div");return g.setAttribute("role","listitem"),g.tabIndex=-1,this._refreshRowDimensions(g),g}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let g=0;g<this._terminal.rows;g++)this._refreshRowDimensions(this._rowElements[g])}}_refreshRowDimensions(g){g.style.height=`${this._renderService.dimensions.css.cell.height}px`}};o.AccessibilityManager=p=c([h(1,_.IInstantiationService),h(2,y.ICoreBrowserService),h(3,y.IRenderService)],p)},3614:(l,o)=>{function a(f){return f.replace(/\r?\n/g,"\r")}function c(f,d){return d?"\x1B[200~"+f+"\x1B[201~":f}function h(f,d,y,_){f=c(f=a(f),y.decPrivateModes.bracketedPasteMode&&_.rawOptions.ignoreBracketedPasteMode!==!0),y.triggerDataEvent(f,!0),d.value=""}function u(f,d,y){const _=y.getBoundingClientRect(),m=f.clientX-_.left-10,p=f.clientY-_.top-10;d.style.width="20px",d.style.height="20px",d.style.left=`${m}px`,d.style.top=`${p}px`,d.style.zIndex="1000",d.focus()}Object.defineProperty(o,"__esModule",{value:!0}),o.rightClickHandler=o.moveTextAreaUnderMouseCursor=o.paste=o.handlePasteEvent=o.copyHandler=o.bracketTextForPaste=o.prepareTextForTerminal=void 0,o.prepareTextForTerminal=a,o.bracketTextForPaste=c,o.copyHandler=function(f,d){f.clipboardData&&f.clipboardData.setData("text/plain",d.selectionText),f.preventDefault()},o.handlePasteEvent=function(f,d,y,_){f.stopPropagation(),f.clipboardData&&h(f.clipboardData.getData("text/plain"),d,y,_)},o.paste=h,o.moveTextAreaUnderMouseCursor=u,o.rightClickHandler=function(f,d,y,_,m){u(f,d,y),m&&_.rightClickSelect(f),d.value=_.selectionText,d.select()}},7239:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ColorContrastCache=void 0;const c=a(1505);o.ColorContrastCache=class{constructor(){this._color=new c.TwoKeyMap,this._css=new c.TwoKeyMap}setCss(h,u,f){this._css.set(h,u,f)}getCss(h,u){return this._css.get(h,u)}setColor(h,u,f){this._color.set(h,u,f)}getColor(h,u){return this._color.get(h,u)}clear(){this._color.clear(),this._css.clear()}}},3656:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.addDisposableDomListener=void 0,o.addDisposableDomListener=function(a,c,h,u){a.addEventListener(c,h,u);let f=!1;return{dispose:()=>{f||(f=!0,a.removeEventListener(c,h,u))}}}},3551:function(l,o,a){var c=this&&this.__decorate||function(p,g,v,b){var S,x=arguments.length,C=x<3?g:b===null?b=Object.getOwnPropertyDescriptor(g,v):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(p,g,v,b);else for(var w=p.length-1;w>=0;w--)(S=p[w])&&(C=(x<3?S(C):x>3?S(g,v,C):S(g,v))||C);return x>3&&C&&Object.defineProperty(g,v,C),C},h=this&&this.__param||function(p,g){return function(v,b){g(v,b,p)}};Object.defineProperty(o,"__esModule",{value:!0}),o.Linkifier=void 0;const u=a(3656),f=a(8460),d=a(844),y=a(2585),_=a(4725);let m=o.Linkifier=class extends d.Disposable{get currentLink(){return this._currentLink}constructor(p,g,v,b,S){super(),this._element=p,this._mouseService=g,this._renderService=v,this._bufferService=b,this._linkProviderService=S,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new f.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new f.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,d.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,d.toDisposable)((()=>{var x;this._lastMouseEvent=void 0,(x=this._activeProviderReplies)==null||x.clear()}))),this.register(this._bufferService.onResize((()=>{this._clearCurrentLink(),this._wasResized=!0}))),this.register((0,u.addDisposableDomListener)(this._element,"mouseleave",(()=>{this._isMouseOut=!0,this._clearCurrentLink()}))),this.register((0,u.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,u.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,u.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(p){this._lastMouseEvent=p;const g=this._positionFromMouseEvent(p,this._element,this._mouseService);if(!g)return;this._isMouseOut=!1;const v=p.composedPath();for(let b=0;b<v.length;b++){const S=v[b];if(S.classList.contains("xterm"))break;if(S.classList.contains("xterm-hover"))return}this._lastBufferCell&&g.x===this._lastBufferCell.x&&g.y===this._lastBufferCell.y||(this._handleHover(g),this._lastBufferCell=g)}_handleHover(p){if(this._activeLine!==p.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(p,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,p)||(this._clearCurrentLink(),this._askForLink(p,!0))}_askForLink(p,g){var b,S;this._activeProviderReplies&&g||((b=this._activeProviderReplies)==null||b.forEach((x=>{x==null||x.forEach((C=>{C.link.dispose&&C.link.dispose()}))})),this._activeProviderReplies=new Map,this._activeLine=p.y);let v=!1;for(const[x,C]of this._linkProviderService.linkProviders.entries())g?(S=this._activeProviderReplies)!=null&&S.get(x)&&(v=this._checkLinkProviderResult(x,p,v)):C.provideLinks(p.y,(w=>{var A,M;if(this._isMouseOut)return;const E=w==null?void 0:w.map((T=>({link:T})));(A=this._activeProviderReplies)==null||A.set(x,E),v=this._checkLinkProviderResult(x,p,v),((M=this._activeProviderReplies)==null?void 0:M.size)===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(p.y,this._activeProviderReplies)}))}_removeIntersectingLinks(p,g){const v=new Set;for(let b=0;b<g.size;b++){const S=g.get(b);if(S)for(let x=0;x<S.length;x++){const C=S[x],w=C.link.range.start.y<p?0:C.link.range.start.x,E=C.link.range.end.y>p?this._bufferService.cols:C.link.range.end.x;for(let A=w;A<=E;A++){if(v.has(A)){S.splice(x--,1);break}v.add(A)}}}}_checkLinkProviderResult(p,g,v){var x;if(!this._activeProviderReplies)return v;const b=this._activeProviderReplies.get(p);let S=!1;for(let C=0;C<p;C++)this._activeProviderReplies.has(C)&&!this._activeProviderReplies.get(C)||(S=!0);if(!S&&b){const C=b.find((w=>this._linkAtPosition(w.link,g)));C&&(v=!0,this._handleNewLink(C))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!v)for(let C=0;C<this._activeProviderReplies.size;C++){const w=(x=this._activeProviderReplies.get(C))==null?void 0:x.find((E=>this._linkAtPosition(E.link,g)));if(w){v=!0,this._handleNewLink(w);break}}return v}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(p){if(!this._currentLink)return;const g=this._positionFromMouseEvent(p,this._element,this._mouseService);g&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,g)&&this._currentLink.link.activate(p,this._currentLink.link.text)}_clearCurrentLink(p,g){this._currentLink&&this._lastMouseEvent&&(!p||!g||this._currentLink.link.range.start.y>=p&&this._currentLink.link.range.end.y<=g)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,d.disposeArray)(this._linkCacheDisposables))}_handleNewLink(p){if(!this._lastMouseEvent)return;const g=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);g&&this._linkAtPosition(p.link,g)&&(this._currentLink=p,this._currentLink.state={decorations:{underline:p.link.decorations===void 0||p.link.decorations.underline,pointerCursor:p.link.decorations===void 0||p.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,p.link,this._lastMouseEvent),p.link.decorations={},Object.defineProperties(p.link.decorations,{pointerCursor:{get:()=>{var v,b;return(b=(v=this._currentLink)==null?void 0:v.state)==null?void 0:b.decorations.pointerCursor},set:v=>{var b;(b=this._currentLink)!=null&&b.state&&this._currentLink.state.decorations.pointerCursor!==v&&(this._currentLink.state.decorations.pointerCursor=v,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",v))}},underline:{get:()=>{var v,b;return(b=(v=this._currentLink)==null?void 0:v.state)==null?void 0:b.decorations.underline},set:v=>{var b,S,x;(b=this._currentLink)!=null&&b.state&&((x=(S=this._currentLink)==null?void 0:S.state)==null?void 0:x.decorations.underline)!==v&&(this._currentLink.state.decorations.underline=v,this._currentLink.state.isHovered&&this._fireUnderlineEvent(p.link,v))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((v=>{if(!this._currentLink)return;const b=v.start===0?0:v.start+1+this._bufferService.buffer.ydisp,S=this._bufferService.buffer.ydisp+1+v.end;if(this._currentLink.link.range.start.y>=b&&this._currentLink.link.range.end.y<=S&&(this._clearCurrentLink(b,S),this._lastMouseEvent)){const x=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);x&&this._askForLink(x,!1)}}))))}_linkHover(p,g,v){var b;(b=this._currentLink)!=null&&b.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(g,!0),this._currentLink.state.decorations.pointerCursor&&p.classList.add("xterm-cursor-pointer")),g.hover&&g.hover(v,g.text)}_fireUnderlineEvent(p,g){const v=p.range,b=this._bufferService.buffer.ydisp,S=this._createLinkUnderlineEvent(v.start.x-1,v.start.y-b-1,v.end.x,v.end.y-b-1,void 0);(g?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(S)}_linkLeave(p,g,v){var b;(b=this._currentLink)!=null&&b.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(g,!1),this._currentLink.state.decorations.pointerCursor&&p.classList.remove("xterm-cursor-pointer")),g.leave&&g.leave(v,g.text)}_linkAtPosition(p,g){const v=p.range.start.y*this._bufferService.cols+p.range.start.x,b=p.range.end.y*this._bufferService.cols+p.range.end.x,S=g.y*this._bufferService.cols+g.x;return v<=S&&S<=b}_positionFromMouseEvent(p,g,v){const b=v.getCoords(p,g,this._bufferService.cols,this._bufferService.rows);if(b)return{x:b[0],y:b[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(p,g,v,b,S){return{x1:p,y1:g,x2:v,y2:b,cols:this._bufferService.cols,fg:S}}};o.Linkifier=m=c([h(1,_.IMouseService),h(2,_.IRenderService),h(3,y.IBufferService),h(4,_.ILinkProviderService)],m)},9042:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.tooMuchOutput=o.promptLabel=void 0,o.promptLabel="Terminal input",o.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(l,o,a){var c=this&&this.__decorate||function(_,m,p,g){var v,b=arguments.length,S=b<3?m:g===null?g=Object.getOwnPropertyDescriptor(m,p):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(_,m,p,g);else for(var x=_.length-1;x>=0;x--)(v=_[x])&&(S=(b<3?v(S):b>3?v(m,p,S):v(m,p))||S);return b>3&&S&&Object.defineProperty(m,p,S),S},h=this&&this.__param||function(_,m){return function(p,g){m(p,g,_)}};Object.defineProperty(o,"__esModule",{value:!0}),o.OscLinkProvider=void 0;const u=a(511),f=a(2585);let d=o.OscLinkProvider=class{constructor(_,m,p){this._bufferService=_,this._optionsService=m,this._oscLinkService=p}provideLinks(_,m){var E;const p=this._bufferService.buffer.lines.get(_-1);if(!p)return void m(void 0);const g=[],v=this._optionsService.rawOptions.linkHandler,b=new u.CellData,S=p.getTrimmedLength();let x=-1,C=-1,w=!1;for(let A=0;A<S;A++)if(C!==-1||p.hasContent(A)){if(p.loadCell(A,b),b.hasExtendedAttrs()&&b.extended.urlId){if(C===-1){C=A,x=b.extended.urlId;continue}w=b.extended.urlId!==x}else C!==-1&&(w=!0);if(w||C!==-1&&A===S-1){const M=(E=this._oscLinkService.getLinkData(x))==null?void 0:E.uri;if(M){const T={start:{x:C+1,y:_},end:{x:A+(w||A!==S-1?0:1),y:_}};let B=!1;if(!(v!=null&&v.allowNonHttpProtocols))try{const F=new URL(M);["http:","https:"].includes(F.protocol)||(B=!0)}catch{B=!0}B||g.push({text:M,range:T,activate:(F,j)=>v?v.activate(F,j,T):y(0,j),hover:(F,j)=>{var z;return(z=v==null?void 0:v.hover)==null?void 0:z.call(v,F,j,T)},leave:(F,j)=>{var z;return(z=v==null?void 0:v.leave)==null?void 0:z.call(v,F,j,T)}})}w=!1,b.hasExtendedAttrs()&&b.extended.urlId?(C=A,x=b.extended.urlId):(C=-1,x=-1)}}m(g)}};function y(_,m){if(confirm(`Do you want to navigate to ${m}?

WARNING: This link could potentially be dangerous`)){const p=window.open();if(p){try{p.opener=null}catch{}p.location.href=m}else console.warn("Opening link blocked as opener could not be cleared")}}o.OscLinkProvider=d=c([h(0,f.IBufferService),h(1,f.IOptionsService),h(2,f.IOscLinkService)],d)},6193:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.RenderDebouncer=void 0,o.RenderDebouncer=class{constructor(a,c){this._renderCallback=a,this._coreBrowserService=c,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(a){return this._refreshCallbacks.push(a),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh()))),this._animationFrame}refresh(a,c,h){this._rowCount=h,a=a!==void 0?a:0,c=c!==void 0?c:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,c):c,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const a=Math.max(this._rowStart,0),c=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,c),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const a of this._refreshCallbacks)a(0);this._refreshCallbacks=[]}}},3236:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Terminal=void 0;const c=a(3614),h=a(3656),u=a(3551),f=a(9042),d=a(3730),y=a(1680),_=a(3107),m=a(5744),p=a(2950),g=a(1296),v=a(428),b=a(4269),S=a(5114),x=a(8934),C=a(3230),w=a(9312),E=a(4725),A=a(6731),M=a(8055),T=a(8969),B=a(8460),F=a(844),j=a(6114),z=a(8437),$=a(2584),V=a(7399),L=a(5941),k=a(9074),I=a(2585),H=a(5435),P=a(4567),X=a(779);class ee extends T.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(O={}){super(O),this.browser=j,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new F.MutableDisposable),this._onCursorMove=this.register(new B.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new B.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new B.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new B.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new B.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new B.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new B.EventEmitter),this._onBlur=this.register(new B.EventEmitter),this._onA11yCharEmitter=this.register(new B.EventEmitter),this._onA11yTabEmitter=this.register(new B.EventEmitter),this._onWillOpen=this.register(new B.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(k.DecorationService),this._instantiationService.setService(I.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(X.LinkProviderService),this._instantiationService.setService(E.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(d.OscLinkProvider)),this.register(this._inputHandler.onRequestBell((()=>this._onBell.fire()))),this.register(this._inputHandler.onRequestRefreshRows(((R,K)=>this.refresh(R,K)))),this.register(this._inputHandler.onRequestSendFocus((()=>this._reportFocus()))),this.register(this._inputHandler.onRequestReset((()=>this.reset()))),this.register(this._inputHandler.onRequestWindowsOptionsReport((R=>this._reportWindowsOptions(R)))),this.register(this._inputHandler.onColor((R=>this._handleColorEvent(R)))),this.register((0,B.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,B.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,B.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,B.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize((R=>this._afterResize(R.cols,R.rows)))),this.register((0,F.toDisposable)((()=>{var R,K;this._customKeyEventHandler=void 0,(K=(R=this.element)==null?void 0:R.parentNode)==null||K.removeChild(this.element)})))}_handleColorEvent(O){if(this._themeService)for(const R of O){let K,W="";switch(R.index){case 256:K="foreground",W="10";break;case 257:K="background",W="11";break;case 258:K="cursor",W="12";break;default:K="ansi",W="4;"+R.index}switch(R.type){case 0:const Q=M.color.toColorRGB(K==="ansi"?this._themeService.colors.ansi[R.index]:this._themeService.colors[K]);this.coreService.triggerDataEvent(`${$.C0.ESC}]${W};${(0,L.toRgbString)(Q)}${$.C1_ESCAPED.ST}`);break;case 1:if(K==="ansi")this._themeService.modifyColors((Y=>Y.ansi[R.index]=M.channels.toColor(...R.color)));else{const Y=K;this._themeService.modifyColors((ge=>ge[Y]=M.channels.toColor(...R.color)))}break;case 2:this._themeService.restoreColor(R.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(O){O?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(P.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(O){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent($.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var O;return(O=this.textarea)==null?void 0:O.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent($.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const O=this.buffer.ybase+this.buffer.y,R=this.buffer.lines.get(O);if(!R)return;const K=Math.min(this.buffer.x,this.cols-1),W=this._renderService.dimensions.css.cell.height,Q=R.getWidth(K),Y=this._renderService.dimensions.css.cell.width*Q,ge=this.buffer.y*this._renderService.dimensions.css.cell.height,Be=K*this._renderService.dimensions.css.cell.width;this.textarea.style.left=Be+"px",this.textarea.style.top=ge+"px",this.textarea.style.width=Y+"px",this.textarea.style.height=W+"px",this.textarea.style.lineHeight=W+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,h.addDisposableDomListener)(this.element,"copy",(R=>{this.hasSelection()&&(0,c.copyHandler)(R,this._selectionService)})));const O=R=>(0,c.handlePasteEvent)(R,this.textarea,this.coreService,this.optionsService);this.register((0,h.addDisposableDomListener)(this.textarea,"paste",O)),this.register((0,h.addDisposableDomListener)(this.element,"paste",O)),j.isFirefox?this.register((0,h.addDisposableDomListener)(this.element,"mousedown",(R=>{R.button===2&&(0,c.rightClickHandler)(R,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))):this.register((0,h.addDisposableDomListener)(this.element,"contextmenu",(R=>{(0,c.rightClickHandler)(R,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))),j.isLinux&&this.register((0,h.addDisposableDomListener)(this.element,"auxclick",(R=>{R.button===1&&(0,c.moveTextAreaUnderMouseCursor)(R,this.textarea,this.screenElement)})))}_bindKeys(){this.register((0,h.addDisposableDomListener)(this.textarea,"keyup",(O=>this._keyUp(O)),!0)),this.register((0,h.addDisposableDomListener)(this.textarea,"keydown",(O=>this._keyDown(O)),!0)),this.register((0,h.addDisposableDomListener)(this.textarea,"keypress",(O=>this._keyPress(O)),!0)),this.register((0,h.addDisposableDomListener)(this.textarea,"compositionstart",(()=>this._compositionHelper.compositionstart()))),this.register((0,h.addDisposableDomListener)(this.textarea,"compositionupdate",(O=>this._compositionHelper.compositionupdate(O)))),this.register((0,h.addDisposableDomListener)(this.textarea,"compositionend",(()=>this._compositionHelper.compositionend()))),this.register((0,h.addDisposableDomListener)(this.textarea,"input",(O=>this._inputEvent(O)),!0)),this.register(this.onRender((()=>this._compositionHelper.updateCompositionElements())))}open(O){var K;if(!O)throw new Error("Terminal requires a parent element.");if(O.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),((K=this.element)==null?void 0:K.ownerDocument.defaultView)&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=O.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),O.appendChild(this.element);const R=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),R.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,h.addDisposableDomListener)(this.screenElement,"mousemove",(W=>this.updateCursorStyle(W)))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),R.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",f.promptLabel),j.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(S.CoreBrowserService,this.textarea,O.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(E.ICoreBrowserService,this._coreBrowserService),this.register((0,h.addDisposableDomListener)(this.textarea,"focus",(W=>this._handleTextAreaFocus(W)))),this.register((0,h.addDisposableDomListener)(this.textarea,"blur",(()=>this._handleTextAreaBlur()))),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(v.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(E.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(A.ThemeService),this._instantiationService.setService(E.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(b.CharacterJoinerService),this._instantiationService.setService(E.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(C.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(E.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange((W=>this._onRender.fire(W)))),this.onResize((W=>this._renderService.resize(W.cols,W.rows))),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(p.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(x.MouseService),this._instantiationService.setService(E.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(u.Linkifier,this.screenElement)),this.element.appendChild(R);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(y.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines((W=>this.scrollLines(W.amount,W.suppressScrollEvent,1))),this.register(this._inputHandler.onRequestSyncScrollBar((()=>this.viewport.syncScrollArea()))),this.register(this.viewport),this.register(this.onCursorMove((()=>{this._renderService.handleCursorMove(),this._syncTextArea()}))),this.register(this.onResize((()=>this._renderService.handleResize(this.cols,this.rows)))),this.register(this.onBlur((()=>this._renderService.handleBlur()))),this.register(this.onFocus((()=>this._renderService.handleFocus()))),this.register(this._renderService.onDimensionsChange((()=>this.viewport.syncScrollArea()))),this._selectionService=this.register(this._instantiationService.createInstance(w.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(E.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines((W=>this.scrollLines(W.amount,W.suppressScrollEvent)))),this.register(this._selectionService.onSelectionChange((()=>this._onSelectionChange.fire()))),this.register(this._selectionService.onRequestRedraw((W=>this._renderService.handleSelectionChanged(W.start,W.end,W.columnSelectMode)))),this.register(this._selectionService.onLinuxMouseSelection((W=>{this.textarea.value=W,this.textarea.focus(),this.textarea.select()}))),this.register(this._onScroll.event((W=>{this.viewport.syncScrollArea(),this._selectionService.refresh()}))),this.register((0,h.addDisposableDomListener)(this._viewportElement,"scroll",(()=>this._selectionService.refresh()))),this.register(this._instantiationService.createInstance(_.BufferDecorationRenderer,this.screenElement)),this.register((0,h.addDisposableDomListener)(this.element,"mousedown",(W=>this._selectionService.handleMouseDown(W)))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(P.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",(W=>this._handleScreenReaderModeOptionChange(W)))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(m.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",(W=>{!this._overviewRulerRenderer&&W&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(m.OverviewRulerRenderer,this._viewportElement,this.screenElement)))})),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(g.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){const O=this,R=this.element;function K(Y){const ge=O._mouseService.getMouseReportCoords(Y,O.screenElement);if(!ge)return!1;let Be,Le;switch(Y.overrideType||Y.type){case"mousemove":Le=32,Y.buttons===void 0?(Be=3,Y.button!==void 0&&(Be=Y.button<3?Y.button:3)):Be=1&Y.buttons?0:4&Y.buttons?1:2&Y.buttons?2:3;break;case"mouseup":Le=0,Be=Y.button<3?Y.button:3;break;case"mousedown":Le=1,Be=Y.button<3?Y.button:3;break;case"wheel":if(O._customWheelEventHandler&&O._customWheelEventHandler(Y)===!1||O.viewport.getLinesScrolled(Y)===0)return!1;Le=Y.deltaY<0?0:1,Be=4;break;default:return!1}return!(Le===void 0||Be===void 0||Be>4)&&O.coreMouseService.triggerMouseEvent({col:ge.col,row:ge.row,x:ge.x,y:ge.y,button:Be,action:Le,ctrl:Y.ctrlKey,alt:Y.altKey,shift:Y.shiftKey})}const W={mouseup:null,wheel:null,mousedrag:null,mousemove:null},Q={mouseup:Y=>(K(Y),Y.buttons||(this._document.removeEventListener("mouseup",W.mouseup),W.mousedrag&&this._document.removeEventListener("mousemove",W.mousedrag)),this.cancel(Y)),wheel:Y=>(K(Y),this.cancel(Y,!0)),mousedrag:Y=>{Y.buttons&&K(Y)},mousemove:Y=>{Y.buttons||K(Y)}};this.register(this.coreMouseService.onProtocolChange((Y=>{Y?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(Y)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&Y?W.mousemove||(R.addEventListener("mousemove",Q.mousemove),W.mousemove=Q.mousemove):(R.removeEventListener("mousemove",W.mousemove),W.mousemove=null),16&Y?W.wheel||(R.addEventListener("wheel",Q.wheel,{passive:!1}),W.wheel=Q.wheel):(R.removeEventListener("wheel",W.wheel),W.wheel=null),2&Y?W.mouseup||(W.mouseup=Q.mouseup):(this._document.removeEventListener("mouseup",W.mouseup),W.mouseup=null),4&Y?W.mousedrag||(W.mousedrag=Q.mousedrag):(this._document.removeEventListener("mousemove",W.mousedrag),W.mousedrag=null)}))),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,h.addDisposableDomListener)(R,"mousedown",(Y=>{if(Y.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(Y))return K(Y),W.mouseup&&this._document.addEventListener("mouseup",W.mouseup),W.mousedrag&&this._document.addEventListener("mousemove",W.mousedrag),this.cancel(Y)}))),this.register((0,h.addDisposableDomListener)(R,"wheel",(Y=>{if(!W.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(Y)===!1)return!1;if(!this.buffer.hasScrollback){const ge=this.viewport.getLinesScrolled(Y);if(ge===0)return;const Be=$.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(Y.deltaY<0?"A":"B");let Le="";for(let Ue=0;Ue<Math.abs(ge);Ue++)Le+=Be;return this.coreService.triggerDataEvent(Le,!0),this.cancel(Y,!0)}return this.viewport.handleWheel(Y)?this.cancel(Y):void 0}}),{passive:!1})),this.register((0,h.addDisposableDomListener)(R,"touchstart",(Y=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(Y),this.cancel(Y)}),{passive:!0})),this.register((0,h.addDisposableDomListener)(R,"touchmove",(Y=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(Y)?void 0:this.cancel(Y)}),{passive:!1}))}refresh(O,R){var K;(K=this._renderService)==null||K.refreshRows(O,R)}updateCursorStyle(O){var R;(R=this._selectionService)!=null&&R.shouldColumnSelect(O)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(O,R,K=0){var W;K===1?(super.scrollLines(O,R,K),this.refresh(0,this.rows-1)):(W=this.viewport)==null||W.scrollLines(O)}paste(O){(0,c.paste)(O,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(O){this._customKeyEventHandler=O}attachCustomWheelEventHandler(O){this._customWheelEventHandler=O}registerLinkProvider(O){return this._linkProviderService.registerLinkProvider(O)}registerCharacterJoiner(O){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const R=this._characterJoinerService.register(O);return this.refresh(0,this.rows-1),R}deregisterCharacterJoiner(O){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(O)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(O){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+O)}registerDecoration(O){return this._decorationService.registerDecoration(O)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(O,R,K){this._selectionService.setSelection(O,R,K)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var O;(O=this._selectionService)==null||O.clearSelection()}selectAll(){var O;(O=this._selectionService)==null||O.selectAll()}selectLines(O,R){var K;(K=this._selectionService)==null||K.selectLines(O,R)}_keyDown(O){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(O)===!1)return!1;const R=this.browser.isMac&&this.options.macOptionIsMeta&&O.altKey;if(!R&&!this._compositionHelper.keydown(O))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;R||O.key!=="Dead"&&O.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const K=(0,V.evaluateKeyboardEvent)(O,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(O),K.type===3||K.type===2){const W=this.rows-1;return this.scrollLines(K.type===2?-W:W),this.cancel(O,!0)}return K.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,O)||(K.cancel&&this.cancel(O,!0),!K.key||!!(O.key&&!O.ctrlKey&&!O.altKey&&!O.metaKey&&O.key.length===1&&O.key.charCodeAt(0)>=65&&O.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(K.key!==$.C0.ETX&&K.key!==$.C0.CR||(this.textarea.value=""),this._onKey.fire({key:K.key,domEvent:O}),this._showCursor(),this.coreService.triggerDataEvent(K.key,!0),!this.optionsService.rawOptions.screenReaderMode||O.altKey||O.ctrlKey?this.cancel(O,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(O,R){const K=O.isMac&&!this.options.macOptionIsMeta&&R.altKey&&!R.ctrlKey&&!R.metaKey||O.isWindows&&R.altKey&&R.ctrlKey&&!R.metaKey||O.isWindows&&R.getModifierState("AltGraph");return R.type==="keypress"?K:K&&(!R.keyCode||R.keyCode>47)}_keyUp(O){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(O)===!1||((function(R){return R.keyCode===16||R.keyCode===17||R.keyCode===18})(O)||this.focus(),this.updateCursorStyle(O),this._keyPressHandled=!1)}_keyPress(O){let R;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(O)===!1)return!1;if(this.cancel(O),O.charCode)R=O.charCode;else if(O.which===null||O.which===void 0)R=O.keyCode;else{if(O.which===0||O.charCode===0)return!1;R=O.which}return!(!R||(O.altKey||O.ctrlKey||O.metaKey)&&!this._isThirdLevelShift(this.browser,O)||(R=String.fromCharCode(R),this._onKey.fire({key:R,domEvent:O}),this._showCursor(),this.coreService.triggerDataEvent(R,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(O){if(O.data&&O.inputType==="insertText"&&(!O.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const R=O.data;return this.coreService.triggerDataEvent(R,!0),this.cancel(O),!0}return!1}resize(O,R){O!==this.cols||R!==this.rows?super.resize(O,R):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(O,R){var K,W;(K=this._charSizeService)==null||K.measure(),(W=this.viewport)==null||W.syncScrollArea(!0)}clear(){var O;if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let R=1;R<this.rows;R++)this.buffer.lines.push(this.buffer.getBlankLine(z.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),(O=this.viewport)==null||O.reset(),this.refresh(0,this.rows-1)}}reset(){var R,K;this.options.rows=this.rows,this.options.cols=this.cols;const O=this._customKeyEventHandler;this._setup(),super.reset(),(R=this._selectionService)==null||R.reset(),this._decorationService.reset(),(K=this.viewport)==null||K.reset(),this._customKeyEventHandler=O,this.refresh(0,this.rows-1)}clearTextureAtlas(){var O;(O=this._renderService)==null||O.clearTextureAtlas()}_reportFocus(){var O;(O=this.element)!=null&&O.classList.contains("focus")?this.coreService.triggerDataEvent($.C0.ESC+"[I"):this.coreService.triggerDataEvent($.C0.ESC+"[O")}_reportWindowsOptions(O){if(this._renderService)switch(O){case H.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const R=this._renderService.dimensions.css.canvas.width.toFixed(0),K=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${$.C0.ESC}[4;${K};${R}t`);break;case H.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const W=this._renderService.dimensions.css.cell.width.toFixed(0),Q=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${$.C0.ESC}[6;${Q};${W}t`)}}cancel(O,R){if(this.options.cancelEvents||R)return O.preventDefault(),O.stopPropagation(),!1}}o.Terminal=ee},9924:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TimeBasedDebouncer=void 0,o.TimeBasedDebouncer=class{constructor(a,c=1e3){this._renderCallback=a,this._debounceThresholdMS=c,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(a,c,h){this._rowCount=h,a=a!==void 0?a:0,c=c!==void 0?c:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,c):c;const u=Date.now();if(u-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=u,this._innerRefresh();else if(!this._additionalRefreshRequested){const f=u-this._lastRefreshMs,d=this._debounceThresholdMS-f;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout((()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0}),d)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const a=Math.max(this._rowStart,0),c=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,c)}}},1680:function(l,o,a){var c=this&&this.__decorate||function(p,g,v,b){var S,x=arguments.length,C=x<3?g:b===null?b=Object.getOwnPropertyDescriptor(g,v):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(p,g,v,b);else for(var w=p.length-1;w>=0;w--)(S=p[w])&&(C=(x<3?S(C):x>3?S(g,v,C):S(g,v))||C);return x>3&&C&&Object.defineProperty(g,v,C),C},h=this&&this.__param||function(p,g){return function(v,b){g(v,b,p)}};Object.defineProperty(o,"__esModule",{value:!0}),o.Viewport=void 0;const u=a(3656),f=a(4725),d=a(8460),y=a(844),_=a(2585);let m=o.Viewport=class extends y.Disposable{constructor(p,g,v,b,S,x,C,w){super(),this._viewportElement=p,this._scrollArea=g,this._bufferService=v,this._optionsService=b,this._charSizeService=S,this._renderService=x,this._coreBrowserService=C,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new d.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,u.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((E=>this._activeBuffer=E.activeBuffer))),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange((E=>this._renderDimensions=E))),this._handleThemeChange(w.colors),this.register(w.onChangeColors((E=>this._handleThemeChange(E)))),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.syncScrollArea()))),setTimeout((()=>this.syncScrollArea()))}_handleThemeChange(p){this._viewportElement.style.backgroundColor=p.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame((()=>this.syncScrollArea()))}_refresh(p){if(p)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const g=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==g&&(this._lastRecordedBufferHeight=g,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const p=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==p&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=p),this._refreshAnimationFrame=null}syncScrollArea(p=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(p);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(p)}_handleScroll(p){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const g=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:g,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const p=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(p*(this._smoothScrollState.target-this._smoothScrollState.origin)),p<1?this._coreBrowserService.window.requestAnimationFrame((()=>this._smoothScroll())):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(p,g){const v=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(g<0&&this._viewportElement.scrollTop!==0||g>0&&v<this._lastRecordedBufferHeight)||(p.cancelable&&p.preventDefault(),!1)}handleWheel(p){const g=this._getPixelsScrolled(p);return g!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+g:this._smoothScrollState.target+=g,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=g,this._bubbleScroll(p,g))}scrollLines(p){if(p!==0)if(this._optionsService.rawOptions.smoothScrollDuration){const g=p*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+g,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:p,suppressScrollEvent:!1})}_getPixelsScrolled(p){if(p.deltaY===0||p.shiftKey)return 0;let g=this._applyScrollModifier(p.deltaY,p);return p.deltaMode===WheelEvent.DOM_DELTA_LINE?g*=this._currentRowHeight:p.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(g*=this._currentRowHeight*this._bufferService.rows),g}getBufferElements(p,g){var w;let v,b="";const S=[],x=g??this._bufferService.buffer.lines.length,C=this._bufferService.buffer.lines;for(let E=p;E<x;E++){const A=C.get(E);if(!A)continue;const M=(w=C.get(E+1))==null?void 0:w.isWrapped;if(b+=A.translateToString(!M),!M||E===C.length-1){const T=document.createElement("div");T.textContent=b,S.push(T),b.length>0&&(v=T),b=""}}return{bufferElements:S,cursorElement:v}}getLinesScrolled(p){if(p.deltaY===0||p.shiftKey)return 0;let g=this._applyScrollModifier(p.deltaY,p);return p.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(g/=this._currentRowHeight+0,this._wheelPartialScroll+=g,g=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):p.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(g*=this._bufferService.rows),g}_applyScrollModifier(p,g){const v=this._optionsService.rawOptions.fastScrollModifier;return v==="alt"&&g.altKey||v==="ctrl"&&g.ctrlKey||v==="shift"&&g.shiftKey?p*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:p*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(p){this._lastTouchY=p.touches[0].pageY}handleTouchMove(p){const g=this._lastTouchY-p.touches[0].pageY;return this._lastTouchY=p.touches[0].pageY,g!==0&&(this._viewportElement.scrollTop+=g,this._bubbleScroll(p,g))}};o.Viewport=m=c([h(2,_.IBufferService),h(3,_.IOptionsService),h(4,f.ICharSizeService),h(5,f.IRenderService),h(6,f.ICoreBrowserService),h(7,f.IThemeService)],m)},3107:function(l,o,a){var c=this&&this.__decorate||function(_,m,p,g){var v,b=arguments.length,S=b<3?m:g===null?g=Object.getOwnPropertyDescriptor(m,p):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(_,m,p,g);else for(var x=_.length-1;x>=0;x--)(v=_[x])&&(S=(b<3?v(S):b>3?v(m,p,S):v(m,p))||S);return b>3&&S&&Object.defineProperty(m,p,S),S},h=this&&this.__param||function(_,m){return function(p,g){m(p,g,_)}};Object.defineProperty(o,"__esModule",{value:!0}),o.BufferDecorationRenderer=void 0;const u=a(4725),f=a(844),d=a(2585);let y=o.BufferDecorationRenderer=class extends f.Disposable{constructor(_,m,p,g,v){super(),this._screenElement=_,this._bufferService=m,this._coreBrowserService=p,this._decorationService=g,this._renderService=v,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange((()=>this._doRefreshDecorations()))),this.register(this._renderService.onDimensionsChange((()=>{this._dimensionsChanged=!0,this._queueRefresh()}))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt}))),this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh()))),this.register(this._decorationService.onDecorationRemoved((b=>this._removeDecoration(b)))),this.register((0,f.toDisposable)((()=>{this._container.remove(),this._decorationElements.clear()})))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback((()=>{this._doRefreshDecorations(),this._animationFrame=void 0})))}_doRefreshDecorations(){for(const _ of this._decorationService.decorations)this._renderDecoration(_);this._dimensionsChanged=!1}_renderDecoration(_){this._refreshStyle(_),this._dimensionsChanged&&this._refreshXPosition(_)}_createElement(_){var g;const m=this._coreBrowserService.mainDocument.createElement("div");m.classList.add("xterm-decoration"),m.classList.toggle("xterm-decoration-top-layer",((g=_==null?void 0:_.options)==null?void 0:g.layer)==="top"),m.style.width=`${Math.round((_.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,m.style.height=(_.options.height||1)*this._renderService.dimensions.css.cell.height+"px",m.style.top=(_.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",m.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const p=_.options.x??0;return p&&p>this._bufferService.cols&&(m.style.display="none"),this._refreshXPosition(_,m),m}_refreshStyle(_){const m=_.marker.line-this._bufferService.buffers.active.ydisp;if(m<0||m>=this._bufferService.rows)_.element&&(_.element.style.display="none",_.onRenderEmitter.fire(_.element));else{let p=this._decorationElements.get(_);p||(p=this._createElement(_),_.element=p,this._decorationElements.set(_,p),this._container.appendChild(p),_.onDispose((()=>{this._decorationElements.delete(_),p.remove()}))),p.style.top=m*this._renderService.dimensions.css.cell.height+"px",p.style.display=this._altBufferIsActive?"none":"block",_.onRenderEmitter.fire(p)}}_refreshXPosition(_,m=_.element){if(!m)return;const p=_.options.x??0;(_.options.anchor||"left")==="right"?m.style.right=p?p*this._renderService.dimensions.css.cell.width+"px":"":m.style.left=p?p*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(_){var m;(m=this._decorationElements.get(_))==null||m.remove(),this._decorationElements.delete(_),_.dispose()}};o.BufferDecorationRenderer=y=c([h(1,d.IBufferService),h(2,u.ICoreBrowserService),h(3,d.IDecorationService),h(4,u.IRenderService)],y)},5871:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ColorZoneStore=void 0,o.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(a){if(a.options.overviewRulerOptions){for(const c of this._zones)if(c.color===a.options.overviewRulerOptions.color&&c.position===a.options.overviewRulerOptions.position){if(this._lineIntersectsZone(c,a.marker.line))return;if(this._lineAdjacentToZone(c,a.marker.line,a.options.overviewRulerOptions.position))return void this._addLineToZone(c,a.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=a.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=a.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=a.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=a.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:a.options.overviewRulerOptions.color,position:a.options.overviewRulerOptions.position,startBufferLine:a.marker.line,endBufferLine:a.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(a){this._linePadding=a}_lineIntersectsZone(a,c){return c>=a.startBufferLine&&c<=a.endBufferLine}_lineAdjacentToZone(a,c,h){return c>=a.startBufferLine-this._linePadding[h||"full"]&&c<=a.endBufferLine+this._linePadding[h||"full"]}_addLineToZone(a,c){a.startBufferLine=Math.min(a.startBufferLine,c),a.endBufferLine=Math.max(a.endBufferLine,c)}}},5744:function(l,o,a){var c=this&&this.__decorate||function(v,b,S,x){var C,w=arguments.length,E=w<3?b:x===null?x=Object.getOwnPropertyDescriptor(b,S):x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(v,b,S,x);else for(var A=v.length-1;A>=0;A--)(C=v[A])&&(E=(w<3?C(E):w>3?C(b,S,E):C(b,S))||E);return w>3&&E&&Object.defineProperty(b,S,E),E},h=this&&this.__param||function(v,b){return function(S,x){b(S,x,v)}};Object.defineProperty(o,"__esModule",{value:!0}),o.OverviewRulerRenderer=void 0;const u=a(5871),f=a(4725),d=a(844),y=a(2585),_={full:0,left:0,center:0,right:0},m={full:0,left:0,center:0,right:0},p={full:0,left:0,center:0,right:0};let g=o.OverviewRulerRenderer=class extends d.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(v,b,S,x,C,w,E){var M;super(),this._viewportElement=v,this._screenElement=b,this._bufferService=S,this._decorationService=x,this._renderService=C,this._optionsService=w,this._coreBrowserService=E,this._colorZoneStore=new u.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(M=this._viewportElement.parentElement)==null||M.insertBefore(this._canvas,this._viewportElement);const A=this._canvas.getContext("2d");if(!A)throw new Error("Ctx cannot be null");this._ctx=A,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,d.toDisposable)((()=>{var T;(T=this._canvas)==null||T.remove()})))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh(void 0,!0)))),this.register(this._decorationService.onDecorationRemoved((()=>this._queueRefresh(void 0,!0))))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"}))),this.register(this._bufferService.onScroll((()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender((()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)}))),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",(()=>this._queueRefresh(!0)))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh(!0)))),this._queueRefresh(!0)}_refreshDrawConstants(){const v=Math.floor(this._canvas.width/3),b=Math.ceil(this._canvas.width/3);m.full=this._canvas.width,m.left=v,m.center=b,m.right=v,this._refreshDrawHeightConstants(),p.full=0,p.left=0,p.center=m.left,p.right=m.left+m.center}_refreshDrawHeightConstants(){_.full=Math.round(2*this._coreBrowserService.dpr);const v=this._canvas.height/this._bufferService.buffer.lines.length,b=Math.round(Math.max(Math.min(v,12),6)*this._coreBrowserService.dpr);_.left=b,_.center=b,_.right=b}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*_.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*_.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*_.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*_.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const b of this._decorationService.decorations)this._colorZoneStore.addDecoration(b);this._ctx.lineWidth=1;const v=this._colorZoneStore.zones;for(const b of v)b.position!=="full"&&this._renderColorZone(b);for(const b of v)b.position==="full"&&this._renderColorZone(b);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(v){this._ctx.fillStyle=v.color,this._ctx.fillRect(p[v.position||"full"],Math.round((this._canvas.height-1)*(v.startBufferLine/this._bufferService.buffers.active.lines.length)-_[v.position||"full"]/2),m[v.position||"full"],Math.round((this._canvas.height-1)*((v.endBufferLine-v.startBufferLine)/this._bufferService.buffers.active.lines.length)+_[v.position||"full"]))}_queueRefresh(v,b){this._shouldUpdateDimensions=v||this._shouldUpdateDimensions,this._shouldUpdateAnchor=b||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._refreshDecorations(),this._animationFrame=void 0})))}};o.OverviewRulerRenderer=g=c([h(2,y.IBufferService),h(3,y.IDecorationService),h(4,f.IRenderService),h(5,y.IOptionsService),h(6,f.ICoreBrowserService)],g)},2950:function(l,o,a){var c=this&&this.__decorate||function(_,m,p,g){var v,b=arguments.length,S=b<3?m:g===null?g=Object.getOwnPropertyDescriptor(m,p):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(_,m,p,g);else for(var x=_.length-1;x>=0;x--)(v=_[x])&&(S=(b<3?v(S):b>3?v(m,p,S):v(m,p))||S);return b>3&&S&&Object.defineProperty(m,p,S),S},h=this&&this.__param||function(_,m){return function(p,g){m(p,g,_)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CompositionHelper=void 0;const u=a(4725),f=a(2585),d=a(2584);let y=o.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(_,m,p,g,v,b){this._textarea=_,this._compositionView=m,this._bufferService=p,this._optionsService=g,this._coreService=v,this._renderService=b,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(_){this._compositionView.textContent=_.data,this.updateCompositionElements(),setTimeout((()=>{this._compositionPosition.end=this._textarea.value.length}),0)}compositionend(){this._finalizeComposition(!0)}keydown(_){if(this._isComposing||this._isSendingComposition){if(_.keyCode===229||_.keyCode===16||_.keyCode===17||_.keyCode===18)return!1;this._finalizeComposition(!1)}return _.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(_){if(this._compositionView.classList.remove("active"),this._isComposing=!1,_){const m={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout((()=>{if(this._isSendingComposition){let p;this._isSendingComposition=!1,m.start+=this._dataAlreadySent.length,p=this._isComposing?this._textarea.value.substring(m.start,m.end):this._textarea.value.substring(m.start),p.length>0&&this._coreService.triggerDataEvent(p,!0)}}),0)}else{this._isSendingComposition=!1;const m=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(m,!0)}}_handleAnyTextareaChanges(){const _=this._textarea.value;setTimeout((()=>{if(!this._isComposing){const m=this._textarea.value,p=m.replace(_,"");this._dataAlreadySent=p,m.length>_.length?this._coreService.triggerDataEvent(p,!0):m.length<_.length?this._coreService.triggerDataEvent(`${d.C0.DEL}`,!0):m.length===_.length&&m!==_&&this._coreService.triggerDataEvent(m,!0)}}),0)}updateCompositionElements(_){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const m=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),p=this._renderService.dimensions.css.cell.height,g=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,v=m*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=v+"px",this._compositionView.style.top=g+"px",this._compositionView.style.height=p+"px",this._compositionView.style.lineHeight=p+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const b=this._compositionView.getBoundingClientRect();this._textarea.style.left=v+"px",this._textarea.style.top=g+"px",this._textarea.style.width=Math.max(b.width,1)+"px",this._textarea.style.height=Math.max(b.height,1)+"px",this._textarea.style.lineHeight=b.height+"px"}_||setTimeout((()=>this.updateCompositionElements(!0)),0)}}};o.CompositionHelper=y=c([h(2,f.IBufferService),h(3,f.IOptionsService),h(4,f.ICoreService),h(5,u.IRenderService)],y)},9806:(l,o)=>{function a(c,h,u){const f=u.getBoundingClientRect(),d=c.getComputedStyle(u),y=parseInt(d.getPropertyValue("padding-left")),_=parseInt(d.getPropertyValue("padding-top"));return[h.clientX-f.left-y,h.clientY-f.top-_]}Object.defineProperty(o,"__esModule",{value:!0}),o.getCoords=o.getCoordsRelativeToElement=void 0,o.getCoordsRelativeToElement=a,o.getCoords=function(c,h,u,f,d,y,_,m,p){if(!y)return;const g=a(c,h,u);return g?(g[0]=Math.ceil((g[0]+(p?_/2:0))/_),g[1]=Math.ceil(g[1]/m),g[0]=Math.min(Math.max(g[0],1),f+(p?1:0)),g[1]=Math.min(Math.max(g[1],1),d),g):void 0}},9504:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.moveToCellSequence=void 0;const c=a(2584);function h(m,p,g,v){const b=m-u(m,g),S=p-u(p,g),x=Math.abs(b-S)-(function(C,w,E){let A=0;const M=C-u(C,E),T=w-u(w,E);for(let B=0;B<Math.abs(M-T);B++){const F=f(C,w)==="A"?-1:1,j=E.buffer.lines.get(M+F*B);j!=null&&j.isWrapped&&A++}return A})(m,p,g);return _(x,y(f(m,p),v))}function u(m,p){let g=0,v=p.buffer.lines.get(m),b=v==null?void 0:v.isWrapped;for(;b&&m>=0&&m<p.rows;)g++,v=p.buffer.lines.get(--m),b=v==null?void 0:v.isWrapped;return g}function f(m,p){return m>p?"A":"B"}function d(m,p,g,v,b,S){let x=m,C=p,w="";for(;x!==g||C!==v;)x+=b?1:-1,b&&x>S.cols-1?(w+=S.buffer.translateBufferLineToString(C,!1,m,x),x=0,m=0,C++):!b&&x<0&&(w+=S.buffer.translateBufferLineToString(C,!1,0,m+1),x=S.cols-1,m=x,C--);return w+S.buffer.translateBufferLineToString(C,!1,m,x)}function y(m,p){const g=p?"O":"[";return c.C0.ESC+g+m}function _(m,p){m=Math.floor(m);let g="";for(let v=0;v<m;v++)g+=p;return g}o.moveToCellSequence=function(m,p,g,v){const b=g.buffer.x,S=g.buffer.y;if(!g.buffer.hasScrollback)return(function(w,E,A,M,T,B){return h(E,M,T,B).length===0?"":_(d(w,E,w,E-u(E,T),!1,T).length,y("D",B))})(b,S,0,p,g,v)+h(S,p,g,v)+(function(w,E,A,M,T,B){let F;F=h(E,M,T,B).length>0?M-u(M,T):E;const j=M,z=(function($,V,L,k,I,H){let P;return P=h(L,k,I,H).length>0?k-u(k,I):V,$<L&&P<=k||$>=L&&P<k?"C":"D"})(w,E,A,M,T,B);return _(d(w,F,A,j,z==="C",T).length,y(z,B))})(b,S,m,p,g,v);let x;if(S===p)return x=b>m?"D":"C",_(Math.abs(b-m),y(x,v));x=S>p?"D":"C";const C=Math.abs(S-p);return _((function(w,E){return E.cols-w})(S>p?m:b,g)+(C-1)*g.cols+1+((S>p?b:m)-1),y(x,v))}},1296:function(l,o,a){var c=this&&this.__decorate||function(B,F,j,z){var $,V=arguments.length,L=V<3?F:z===null?z=Object.getOwnPropertyDescriptor(F,j):z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")L=Reflect.decorate(B,F,j,z);else for(var k=B.length-1;k>=0;k--)($=B[k])&&(L=(V<3?$(L):V>3?$(F,j,L):$(F,j))||L);return V>3&&L&&Object.defineProperty(F,j,L),L},h=this&&this.__param||function(B,F){return function(j,z){F(j,z,B)}};Object.defineProperty(o,"__esModule",{value:!0}),o.DomRenderer=void 0;const u=a(3787),f=a(2550),d=a(2223),y=a(6171),_=a(6052),m=a(4725),p=a(8055),g=a(8460),v=a(844),b=a(2585),S="xterm-dom-renderer-owner-",x="xterm-rows",C="xterm-fg-",w="xterm-bg-",E="xterm-focus",A="xterm-selection";let M=1,T=o.DomRenderer=class extends v.Disposable{constructor(B,F,j,z,$,V,L,k,I,H,P,X,ee){super(),this._terminal=B,this._document=F,this._element=j,this._screenElement=z,this._viewportElement=$,this._helperContainer=V,this._linkifier2=L,this._charSizeService=I,this._optionsService=H,this._bufferService=P,this._coreBrowserService=X,this._themeService=ee,this._terminalClass=M++,this._rowElements=[],this._selectionRenderModel=(0,_.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new g.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(x),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(A),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,y.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._themeService.onChangeColors((re=>this._injectCss(re)))),this._injectCss(this._themeService.colors),this._rowFactory=k.createInstance(u.DomRendererRowFactory,document),this._element.classList.add(S+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline((re=>this._handleLinkHover(re)))),this.register(this._linkifier2.onHideLinkUnderline((re=>this._handleLinkLeave(re)))),this.register((0,v.toDisposable)((()=>{this._element.classList.remove(S+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()}))),this._widthCache=new f.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const B=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*B,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*B),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/B),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/B),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const j of this._rowElements)j.style.width=`${this.dimensions.css.canvas.width}px`,j.style.height=`${this.dimensions.css.cell.height}px`,j.style.lineHeight=`${this.dimensions.css.cell.height}px`,j.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const F=`${this._terminalSelector} .${x} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=F,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(B){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let F=`${this._terminalSelector} .${x} { color: ${B.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;F+=`${this._terminalSelector} .${x} .xterm-dim { color: ${p.color.multiplyOpacity(B.foreground,.5).css};}`,F+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;const j=`blink_underline_${this._terminalClass}`,z=`blink_bar_${this._terminalClass}`,$=`blink_block_${this._terminalClass}`;F+=`@keyframes ${j} { 50% {  border-bottom-style: hidden; }}`,F+=`@keyframes ${z} { 50% {  box-shadow: none; }}`,F+=`@keyframes ${$} { 0% {  background-color: ${B.cursor.css};  color: ${B.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${B.cursor.css}; }}`,F+=`${this._terminalSelector} .${x}.${E} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${j} 1s step-end infinite;}${this._terminalSelector} .${x}.${E} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${z} 1s step-end infinite;}${this._terminalSelector} .${x}.${E} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${$} 1s step-end infinite;}${this._terminalSelector} .${x} .xterm-cursor.xterm-cursor-block { background-color: ${B.cursor.css}; color: ${B.cursorAccent.css};}${this._terminalSelector} .${x} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${B.cursor.css} !important; color: ${B.cursorAccent.css} !important;}${this._terminalSelector} .${x} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${B.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${x} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${B.cursor.css} inset;}${this._terminalSelector} .${x} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${B.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,F+=`${this._terminalSelector} .${A} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${A} div { position: absolute; background-color: ${B.selectionBackgroundOpaque.css};}${this._terminalSelector} .${A} div { position: absolute; background-color: ${B.selectionInactiveBackgroundOpaque.css};}`;for(const[V,L]of B.ansi.entries())F+=`${this._terminalSelector} .${C}${V} { color: ${L.css}; }${this._terminalSelector} .${C}${V}.xterm-dim { color: ${p.color.multiplyOpacity(L,.5).css}; }${this._terminalSelector} .${w}${V} { background-color: ${L.css}; }`;F+=`${this._terminalSelector} .${C}${d.INVERTED_DEFAULT_COLOR} { color: ${p.color.opaque(B.background).css}; }${this._terminalSelector} .${C}${d.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${p.color.multiplyOpacity(p.color.opaque(B.background),.5).css}; }${this._terminalSelector} .${w}${d.INVERTED_DEFAULT_COLOR} { background-color: ${B.foreground.css}; }`,this._themeStyleElement.textContent=F}_setDefaultSpacing(){const B=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${B}px`,this._rowFactory.defaultSpacing=B}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(B,F){for(let j=this._rowElements.length;j<=F;j++){const z=this._document.createElement("div");this._rowContainer.appendChild(z),this._rowElements.push(z)}for(;this._rowElements.length>F;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(B,F){this._refreshRowElements(B,F),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(E),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(E),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(B,F,j){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(B,F,j),this.renderRows(0,this._bufferService.rows-1),!B||!F)return;this._selectionRenderModel.update(this._terminal,B,F,j);const z=this._selectionRenderModel.viewportStartRow,$=this._selectionRenderModel.viewportEndRow,V=this._selectionRenderModel.viewportCappedStartRow,L=this._selectionRenderModel.viewportCappedEndRow;if(V>=this._bufferService.rows||L<0)return;const k=this._document.createDocumentFragment();if(j){const I=B[0]>F[0];k.appendChild(this._createSelectionElement(V,I?F[0]:B[0],I?B[0]:F[0],L-V+1))}else{const I=z===V?B[0]:0,H=V===$?F[0]:this._bufferService.cols;k.appendChild(this._createSelectionElement(V,I,H));const P=L-V-1;if(k.appendChild(this._createSelectionElement(V+1,0,this._bufferService.cols,P)),V!==L){const X=$===L?F[0]:this._bufferService.cols;k.appendChild(this._createSelectionElement(L,0,X))}}this._selectionContainer.appendChild(k)}_createSelectionElement(B,F,j,z=1){const $=this._document.createElement("div"),V=F*this.dimensions.css.cell.width;let L=this.dimensions.css.cell.width*(j-F);return V+L>this.dimensions.css.canvas.width&&(L=this.dimensions.css.canvas.width-V),$.style.height=z*this.dimensions.css.cell.height+"px",$.style.top=B*this.dimensions.css.cell.height+"px",$.style.left=`${V}px`,$.style.width=`${L}px`,$}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const B of this._rowElements)B.replaceChildren()}renderRows(B,F){const j=this._bufferService.buffer,z=j.ybase+j.y,$=Math.min(j.x,this._bufferService.cols-1),V=this._optionsService.rawOptions.cursorBlink,L=this._optionsService.rawOptions.cursorStyle,k=this._optionsService.rawOptions.cursorInactiveStyle;for(let I=B;I<=F;I++){const H=I+j.ydisp,P=this._rowElements[I],X=j.lines.get(H);if(!P||!X)break;P.replaceChildren(...this._rowFactory.createRow(X,H,H===z,L,k,$,V,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${S}${this._terminalClass}`}_handleLinkHover(B){this._setCellUnderline(B.x1,B.x2,B.y1,B.y2,B.cols,!0)}_handleLinkLeave(B){this._setCellUnderline(B.x1,B.x2,B.y1,B.y2,B.cols,!1)}_setCellUnderline(B,F,j,z,$,V){j<0&&(B=0),z<0&&(F=0);const L=this._bufferService.rows-1;j=Math.max(Math.min(j,L),0),z=Math.max(Math.min(z,L),0),$=Math.min($,this._bufferService.cols);const k=this._bufferService.buffer,I=k.ybase+k.y,H=Math.min(k.x,$-1),P=this._optionsService.rawOptions.cursorBlink,X=this._optionsService.rawOptions.cursorStyle,ee=this._optionsService.rawOptions.cursorInactiveStyle;for(let re=j;re<=z;++re){const O=re+k.ydisp,R=this._rowElements[re],K=k.lines.get(O);if(!R||!K)break;R.replaceChildren(...this._rowFactory.createRow(K,O,O===I,X,ee,H,P,this.dimensions.css.cell.width,this._widthCache,V?re===j?B:0:-1,V?(re===z?F:$)-1:-1))}}};o.DomRenderer=T=c([h(7,b.IInstantiationService),h(8,m.ICharSizeService),h(9,b.IOptionsService),h(10,b.IBufferService),h(11,m.ICoreBrowserService),h(12,m.IThemeService)],T)},3787:function(l,o,a){var c=this&&this.__decorate||function(x,C,w,E){var A,M=arguments.length,T=M<3?C:E===null?E=Object.getOwnPropertyDescriptor(C,w):E;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(x,C,w,E);else for(var B=x.length-1;B>=0;B--)(A=x[B])&&(T=(M<3?A(T):M>3?A(C,w,T):A(C,w))||T);return M>3&&T&&Object.defineProperty(C,w,T),T},h=this&&this.__param||function(x,C){return function(w,E){C(w,E,x)}};Object.defineProperty(o,"__esModule",{value:!0}),o.DomRendererRowFactory=void 0;const u=a(2223),f=a(643),d=a(511),y=a(2585),_=a(8055),m=a(4725),p=a(4269),g=a(6171),v=a(3734);let b=o.DomRendererRowFactory=class{constructor(x,C,w,E,A,M,T){this._document=x,this._characterJoinerService=C,this._optionsService=w,this._coreBrowserService=E,this._coreService=A,this._decorationService=M,this._themeService=T,this._workCell=new d.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(x,C,w){this._selectionStart=x,this._selectionEnd=C,this._columnSelectMode=w}createRow(x,C,w,E,A,M,T,B,F,j,z){const $=[],V=this._characterJoinerService.getJoinedCharacters(C),L=this._themeService.colors;let k,I=x.getNoBgTrimmedLength();w&&I<M+1&&(I=M+1);let H=0,P="",X=0,ee=0,re=0,O=!1,R=0,K=!1,W=0;const Q=[],Y=j!==-1&&z!==-1;for(let ge=0;ge<I;ge++){x.loadCell(ge,this._workCell);let Be=this._workCell.getWidth();if(Be===0)continue;let Le=!1,Ue=ge,ce=this._workCell;if(V.length>0&&ge===V[0][0]){Le=!0;const Ce=V.shift();ce=new p.JoinedCellData(this._workCell,x.translateToString(!0,Ce[0],Ce[1]),Ce[1]-Ce[0]),Ue=Ce[1]-1,Be=ce.getWidth()}const Vt=this._isCellInSelection(ge,C),ki=w&&ge===M,Ei=Y&&ge>=j&&ge<=z;let Bt=!1;this._decorationService.forEachDecorationAtCell(ge,C,void 0,(Ce=>{Bt=!0}));let Ai=ce.getChars()||f.WHITESPACE_CELL_CHAR;if(Ai===" "&&(ce.isUnderline()||ce.isOverline())&&(Ai=" "),W=Be*B-F.get(Ai,ce.isBold(),ce.isItalic()),k){if(H&&(Vt&&K||!Vt&&!K&&ce.bg===X)&&(Vt&&K&&L.selectionForeground||ce.fg===ee)&&ce.extended.ext===re&&Ei===O&&W===R&&!ki&&!Le&&!Bt){ce.isInvisible()?P+=f.WHITESPACE_CELL_CHAR:P+=Ai,H++;continue}H&&(k.textContent=P),k=this._document.createElement("span"),H=0,P=""}else k=this._document.createElement("span");if(X=ce.bg,ee=ce.fg,re=ce.extended.ext,O=Ei,R=W,K=Vt,Le&&M>=ge&&M<=Ue&&(M=ge),!this._coreService.isCursorHidden&&ki&&this._coreService.isCursorInitialized){if(Q.push("xterm-cursor"),this._coreBrowserService.isFocused)T&&Q.push("xterm-cursor-blink"),Q.push(E==="bar"?"xterm-cursor-bar":E==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(A)switch(A){case"outline":Q.push("xterm-cursor-outline");break;case"block":Q.push("xterm-cursor-block");break;case"bar":Q.push("xterm-cursor-bar");break;case"underline":Q.push("xterm-cursor-underline")}}if(ce.isBold()&&Q.push("xterm-bold"),ce.isItalic()&&Q.push("xterm-italic"),ce.isDim()&&Q.push("xterm-dim"),P=ce.isInvisible()?f.WHITESPACE_CELL_CHAR:ce.getChars()||f.WHITESPACE_CELL_CHAR,ce.isUnderline()&&(Q.push(`xterm-underline-${ce.extended.underlineStyle}`),P===" "&&(P=" "),!ce.isUnderlineColorDefault()))if(ce.isUnderlineColorRGB())k.style.textDecorationColor=`rgb(${v.AttributeData.toColorRGB(ce.getUnderlineColor()).join(",")})`;else{let Ce=ce.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&ce.isBold()&&Ce<8&&(Ce+=8),k.style.textDecorationColor=L.ansi[Ce].css}ce.isOverline()&&(Q.push("xterm-overline"),P===" "&&(P=" ")),ce.isStrikethrough()&&Q.push("xterm-strikethrough"),Ei&&(k.style.textDecoration="underline");let Je=ce.getFgColor(),mi=ce.getFgColorMode(),_t=ce.getBgColor(),U=ce.getBgColorMode();const Z=!!ce.isInverse();if(Z){const Ce=Je;Je=_t,_t=Ce;const ct=mi;mi=U,U=ct}let le,de,_e,qe=!1;switch(this._decorationService.forEachDecorationAtCell(ge,C,void 0,(Ce=>{Ce.options.layer!=="top"&&qe||(Ce.backgroundColorRGB&&(U=50331648,_t=Ce.backgroundColorRGB.rgba>>8&16777215,le=Ce.backgroundColorRGB),Ce.foregroundColorRGB&&(mi=50331648,Je=Ce.foregroundColorRGB.rgba>>8&16777215,de=Ce.foregroundColorRGB),qe=Ce.options.layer==="top")})),!qe&&Vt&&(le=this._coreBrowserService.isFocused?L.selectionBackgroundOpaque:L.selectionInactiveBackgroundOpaque,_t=le.rgba>>8&16777215,U=50331648,qe=!0,L.selectionForeground&&(mi=50331648,Je=L.selectionForeground.rgba>>8&16777215,de=L.selectionForeground)),qe&&Q.push("xterm-decoration-top"),U){case 16777216:case 33554432:_e=L.ansi[_t],Q.push(`xterm-bg-${_t}`);break;case 50331648:_e=_.channels.toColor(_t>>16,_t>>8&255,255&_t),this._addStyle(k,`background-color:#${S((_t>>>0).toString(16),"0",6)}`);break;default:Z?(_e=L.foreground,Q.push(`xterm-bg-${u.INVERTED_DEFAULT_COLOR}`)):_e=L.background}switch(le||ce.isDim()&&(le=_.color.multiplyOpacity(_e,.5)),mi){case 16777216:case 33554432:ce.isBold()&&Je<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(Je+=8),this._applyMinimumContrast(k,_e,L.ansi[Je],ce,le,void 0)||Q.push(`xterm-fg-${Je}`);break;case 50331648:const Ce=_.channels.toColor(Je>>16&255,Je>>8&255,255&Je);this._applyMinimumContrast(k,_e,Ce,ce,le,de)||this._addStyle(k,`color:#${S(Je.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(k,_e,L.foreground,ce,le,de)||Z&&Q.push(`xterm-fg-${u.INVERTED_DEFAULT_COLOR}`)}Q.length&&(k.className=Q.join(" "),Q.length=0),ki||Le||Bt?k.textContent=P:H++,W!==this.defaultSpacing&&(k.style.letterSpacing=`${W}px`),$.push(k),ge=Ue}return k&&H&&(k.textContent=P),$}_applyMinimumContrast(x,C,w,E,A,M){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,g.treatGlyphAsBackgroundColor)(E.getCode()))return!1;const T=this._getContrastCache(E);let B;if(A||M||(B=T.getColor(C.rgba,w.rgba)),B===void 0){const F=this._optionsService.rawOptions.minimumContrastRatio/(E.isDim()?2:1);B=_.color.ensureContrastRatio(A||C,M||w,F),T.setColor((A||C).rgba,(M||w).rgba,B??null)}return!!B&&(this._addStyle(x,`color:${B.css}`),!0)}_getContrastCache(x){return x.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(x,C){x.setAttribute("style",`${x.getAttribute("style")||""}${C};`)}_isCellInSelection(x,C){const w=this._selectionStart,E=this._selectionEnd;return!(!w||!E)&&(this._columnSelectMode?w[0]<=E[0]?x>=w[0]&&C>=w[1]&&x<E[0]&&C<=E[1]:x<w[0]&&C>=w[1]&&x>=E[0]&&C<=E[1]:C>w[1]&&C<E[1]||w[1]===E[1]&&C===w[1]&&x>=w[0]&&x<E[0]||w[1]<E[1]&&C===E[1]&&x<E[0]||w[1]<E[1]&&C===w[1]&&x>=w[0])}};function S(x,C,w){for(;x.length<w;)x=C+x;return x}o.DomRendererRowFactory=b=c([h(1,m.ICharacterJoinerService),h(2,y.IOptionsService),h(3,m.ICoreBrowserService),h(4,y.ICoreService),h(5,y.IDecorationService),h(6,m.IThemeService)],b)},2550:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.WidthCache=void 0,o.WidthCache=class{constructor(a,c){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=a.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const h=a.createElement("span");h.classList.add("xterm-char-measure-element");const u=a.createElement("span");u.classList.add("xterm-char-measure-element"),u.style.fontWeight="bold";const f=a.createElement("span");f.classList.add("xterm-char-measure-element"),f.style.fontStyle="italic";const d=a.createElement("span");d.classList.add("xterm-char-measure-element"),d.style.fontWeight="bold",d.style.fontStyle="italic",this._measureElements=[h,u,f,d],this._container.appendChild(h),this._container.appendChild(u),this._container.appendChild(f),this._container.appendChild(d),c.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(a,c,h,u){a===this._font&&c===this._fontSize&&h===this._weight&&u===this._weightBold||(this._font=a,this._fontSize=c,this._weight=h,this._weightBold=u,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${h}`,this._measureElements[1].style.fontWeight=`${u}`,this._measureElements[2].style.fontWeight=`${h}`,this._measureElements[3].style.fontWeight=`${u}`,this.clear())}get(a,c,h){let u=0;if(!c&&!h&&a.length===1&&(u=a.charCodeAt(0))<256){if(this._flat[u]!==-9999)return this._flat[u];const y=this._measure(a,0);return y>0&&(this._flat[u]=y),y}let f=a;c&&(f+="B"),h&&(f+="I");let d=this._holey.get(f);if(d===void 0){let y=0;c&&(y|=1),h&&(y|=2),d=this._measure(a,y),d>0&&this._holey.set(f,d)}return d}_measure(a,c){const h=this._measureElements[c];return h.textContent=a.repeat(32),h.offsetWidth/32}}},2223:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TEXT_BASELINE=o.DIM_OPACITY=o.INVERTED_DEFAULT_COLOR=void 0;const c=a(6114);o.INVERTED_DEFAULT_COLOR=257,o.DIM_OPACITY=.5,o.TEXT_BASELINE=c.isFirefox||c.isLegacyEdge?"bottom":"ideographic"},6171:(l,o)=>{function a(h){return 57508<=h&&h<=57558}function c(h){return h>=128512&&h<=128591||h>=127744&&h<=128511||h>=128640&&h<=128767||h>=9728&&h<=9983||h>=9984&&h<=10175||h>=65024&&h<=65039||h>=129280&&h<=129535||h>=127462&&h<=127487}Object.defineProperty(o,"__esModule",{value:!0}),o.computeNextVariantOffset=o.createRenderDimensions=o.treatGlyphAsBackgroundColor=o.allowRescaling=o.isEmoji=o.isRestrictedPowerlineGlyph=o.isPowerlineGlyph=o.throwIfFalsy=void 0,o.throwIfFalsy=function(h){if(!h)throw new Error("value must not be falsy");return h},o.isPowerlineGlyph=a,o.isRestrictedPowerlineGlyph=function(h){return 57520<=h&&h<=57527},o.isEmoji=c,o.allowRescaling=function(h,u,f,d){return u===1&&f>Math.ceil(1.5*d)&&h!==void 0&&h>255&&!c(h)&&!a(h)&&!(function(y){return 57344<=y&&y<=63743})(h)},o.treatGlyphAsBackgroundColor=function(h){return a(h)||(function(u){return 9472<=u&&u<=9631})(h)},o.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},o.computeNextVariantOffset=function(h,u,f=0){return(h-(2*Math.round(u)-f))%(2*Math.round(u))}},6052:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.createSelectionRenderModel=void 0;class a{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(h,u,f,d=!1){if(this.selectionStart=u,this.selectionEnd=f,!u||!f||u[0]===f[0]&&u[1]===f[1])return void this.clear();const y=h.buffers.active.ydisp,_=u[1]-y,m=f[1]-y,p=Math.max(_,0),g=Math.min(m,h.rows-1);p>=h.rows||g<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=d,this.viewportStartRow=_,this.viewportEndRow=m,this.viewportCappedStartRow=p,this.viewportCappedEndRow=g,this.startCol=u[0],this.endCol=f[0])}isCellSelected(h,u,f){return!!this.hasSelection&&(f-=h.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?u>=this.startCol&&f>=this.viewportCappedStartRow&&u<this.endCol&&f<=this.viewportCappedEndRow:u<this.startCol&&f>=this.viewportCappedStartRow&&u>=this.endCol&&f<=this.viewportCappedEndRow:f>this.viewportStartRow&&f<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&f===this.viewportStartRow&&u>=this.startCol&&u<this.endCol||this.viewportStartRow<this.viewportEndRow&&f===this.viewportEndRow&&u<this.endCol||this.viewportStartRow<this.viewportEndRow&&f===this.viewportStartRow&&u>=this.startCol)}}o.createSelectionRenderModel=function(){return new a}},456:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.SelectionModel=void 0,o.SelectionModel=class{constructor(a){this._bufferService=a,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?a%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)-1]:[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[a,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[Math.max(a,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const a=this.selectionStart,c=this.selectionEnd;return!(!a||!c)&&(a[1]>c[1]||a[1]===c[1]&&a[0]>c[0])}handleTrim(a){return this.selectionStart&&(this.selectionStart[1]-=a),this.selectionEnd&&(this.selectionEnd[1]-=a),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(l,o,a){var c=this&&this.__decorate||function(g,v,b,S){var x,C=arguments.length,w=C<3?v:S===null?S=Object.getOwnPropertyDescriptor(v,b):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(g,v,b,S);else for(var E=g.length-1;E>=0;E--)(x=g[E])&&(w=(C<3?x(w):C>3?x(v,b,w):x(v,b))||w);return C>3&&w&&Object.defineProperty(v,b,w),w},h=this&&this.__param||function(g,v){return function(b,S){v(b,S,g)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CharSizeService=void 0;const u=a(2585),f=a(8460),d=a(844);let y=o.CharSizeService=class extends d.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(g,v,b){super(),this._optionsService=b,this.width=0,this.height=0,this._onCharSizeChange=this.register(new f.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new p(this._optionsService))}catch{this._measureStrategy=this.register(new m(g,v,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],(()=>this.measure())))}measure(){const g=this._measureStrategy.measure();g.width===this.width&&g.height===this.height||(this.width=g.width,this.height=g.height,this._onCharSizeChange.fire())}};o.CharSizeService=y=c([h(2,u.IOptionsService)],y);class _ extends d.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(v,b){v!==void 0&&v>0&&b!==void 0&&b>0&&(this._result.width=v,this._result.height=b)}}class m extends _{constructor(v,b,S){super(),this._document=v,this._parentElement=b,this._optionsService=S,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class p extends _{constructor(v){super(),this._optionsService=v,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");const b=this._ctx.measureText("W");if(!("width"in b&&"fontBoundingBoxAscent"in b&&"fontBoundingBoxDescent"in b))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;const v=this._ctx.measureText("W");return this._validateAndSet(v.width,v.fontBoundingBoxAscent+v.fontBoundingBoxDescent),this._result}}},4269:function(l,o,a){var c=this&&this.__decorate||function(p,g,v,b){var S,x=arguments.length,C=x<3?g:b===null?b=Object.getOwnPropertyDescriptor(g,v):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(p,g,v,b);else for(var w=p.length-1;w>=0;w--)(S=p[w])&&(C=(x<3?S(C):x>3?S(g,v,C):S(g,v))||C);return x>3&&C&&Object.defineProperty(g,v,C),C},h=this&&this.__param||function(p,g){return function(v,b){g(v,b,p)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CharacterJoinerService=o.JoinedCellData=void 0;const u=a(3734),f=a(643),d=a(511),y=a(2585);class _ extends u.AttributeData{constructor(g,v,b){super(),this.content=0,this.combinedData="",this.fg=g.fg,this.bg=g.bg,this.combinedData=v,this._width=b}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(g){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}o.JoinedCellData=_;let m=o.CharacterJoinerService=class Jp{constructor(g){this._bufferService=g,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new d.CellData}register(g){const v={id:this._nextCharacterJoinerId++,handler:g};return this._characterJoiners.push(v),v.id}deregister(g){for(let v=0;v<this._characterJoiners.length;v++)if(this._characterJoiners[v].id===g)return this._characterJoiners.splice(v,1),!0;return!1}getJoinedCharacters(g){if(this._characterJoiners.length===0)return[];const v=this._bufferService.buffer.lines.get(g);if(!v||v.length===0)return[];const b=[],S=v.translateToString(!0);let x=0,C=0,w=0,E=v.getFg(0),A=v.getBg(0);for(let M=0;M<v.getTrimmedLength();M++)if(v.loadCell(M,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==E||this._workCell.bg!==A){if(M-x>1){const T=this._getJoinedRanges(S,w,C,v,x);for(let B=0;B<T.length;B++)b.push(T[B])}x=M,w=C,E=this._workCell.fg,A=this._workCell.bg}C+=this._workCell.getChars().length||f.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-x>1){const M=this._getJoinedRanges(S,w,C,v,x);for(let T=0;T<M.length;T++)b.push(M[T])}return b}_getJoinedRanges(g,v,b,S,x){const C=g.substring(v,b);let w=[];try{w=this._characterJoiners[0].handler(C)}catch(E){console.error(E)}for(let E=1;E<this._characterJoiners.length;E++)try{const A=this._characterJoiners[E].handler(C);for(let M=0;M<A.length;M++)Jp._mergeRanges(w,A[M])}catch(A){console.error(A)}return this._stringRangesToCellRanges(w,S,x),w}_stringRangesToCellRanges(g,v,b){let S=0,x=!1,C=0,w=g[S];if(w){for(let E=b;E<this._bufferService.cols;E++){const A=v.getWidth(E),M=v.getString(E).length||f.WHITESPACE_CELL_CHAR.length;if(A!==0){if(!x&&w[0]<=C&&(w[0]=E,x=!0),w[1]<=C){if(w[1]=E,w=g[++S],!w)break;w[0]<=C?(w[0]=E,x=!0):x=!1}C+=M}}w&&(w[1]=this._bufferService.cols)}}static _mergeRanges(g,v){let b=!1;for(let S=0;S<g.length;S++){const x=g[S];if(b){if(v[1]<=x[0])return g[S-1][1]=v[1],g;if(v[1]<=x[1])return g[S-1][1]=Math.max(v[1],x[1]),g.splice(S,1),g;g.splice(S,1),S--}else{if(v[1]<=x[0])return g.splice(S,0,v),g;if(v[1]<=x[1])return x[0]=Math.min(v[0],x[0]),g;v[0]<x[1]&&(x[0]=Math.min(v[0],x[0]),b=!0)}}return b?g[g.length-1][1]=v[1]:g.push(v),g}};o.CharacterJoinerService=m=c([h(0,y.IBufferService)],m)},5114:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CoreBrowserService=void 0;const c=a(844),h=a(8460),u=a(3656);class f extends c.Disposable{constructor(_,m,p){super(),this._textarea=_,this._window=m,this.mainDocument=p,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new d(this._window),this._onDprChange=this.register(new h.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new h.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange((g=>this._screenDprMonitor.setWindow(g)))),this.register((0,h.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",(()=>this._isFocused=!0)),this._textarea.addEventListener("blur",(()=>this._isFocused=!1))}get window(){return this._window}set window(_){this._window!==_&&(this._window=_,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask((()=>this._cachedIsFocused=void 0))),this._cachedIsFocused}}o.CoreBrowserService=f;class d extends c.Disposable{constructor(_){super(),this._parentWindow=_,this._windowResizeListener=this.register(new c.MutableDisposable),this._onDprChange=this.register(new h.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,c.toDisposable)((()=>this.clearListener())))}setWindow(_){this._parentWindow=_,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,u.addDisposableDomListener)(this._parentWindow,"resize",(()=>this._setDprAndFireIfDiffers()))}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){var _;this._outerListener&&((_=this._resolutionMediaMatchList)==null||_.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.LinkProviderService=void 0;const c=a(844);class h extends c.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,c.toDisposable)((()=>this.linkProviders.length=0)))}registerLinkProvider(f){return this.linkProviders.push(f),{dispose:()=>{const d=this.linkProviders.indexOf(f);d!==-1&&this.linkProviders.splice(d,1)}}}}o.LinkProviderService=h},8934:function(l,o,a){var c=this&&this.__decorate||function(y,_,m,p){var g,v=arguments.length,b=v<3?_:p===null?p=Object.getOwnPropertyDescriptor(_,m):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(y,_,m,p);else for(var S=y.length-1;S>=0;S--)(g=y[S])&&(b=(v<3?g(b):v>3?g(_,m,b):g(_,m))||b);return v>3&&b&&Object.defineProperty(_,m,b),b},h=this&&this.__param||function(y,_){return function(m,p){_(m,p,y)}};Object.defineProperty(o,"__esModule",{value:!0}),o.MouseService=void 0;const u=a(4725),f=a(9806);let d=o.MouseService=class{constructor(y,_){this._renderService=y,this._charSizeService=_}getCoords(y,_,m,p,g){return(0,f.getCoords)(window,y,_,m,p,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,g)}getMouseReportCoords(y,_){const m=(0,f.getCoordsRelativeToElement)(window,y,_);if(this._charSizeService.hasValidSize)return m[0]=Math.min(Math.max(m[0],0),this._renderService.dimensions.css.canvas.width-1),m[1]=Math.min(Math.max(m[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(m[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(m[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(m[0]),y:Math.floor(m[1])}}};o.MouseService=d=c([h(0,u.IRenderService),h(1,u.ICharSizeService)],d)},3230:function(l,o,a){var c=this&&this.__decorate||function(g,v,b,S){var x,C=arguments.length,w=C<3?v:S===null?S=Object.getOwnPropertyDescriptor(v,b):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(g,v,b,S);else for(var E=g.length-1;E>=0;E--)(x=g[E])&&(w=(C<3?x(w):C>3?x(v,b,w):x(v,b))||w);return C>3&&w&&Object.defineProperty(v,b,w),w},h=this&&this.__param||function(g,v){return function(b,S){v(b,S,g)}};Object.defineProperty(o,"__esModule",{value:!0}),o.RenderService=void 0;const u=a(6193),f=a(4725),d=a(8460),y=a(844),_=a(7226),m=a(2585);let p=o.RenderService=class extends y.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(g,v,b,S,x,C,w,E){super(),this._rowCount=g,this._charSizeService=S,this._renderer=this.register(new y.MutableDisposable),this._pausedResizeTask=new _.DebouncedIdleTask,this._observerDisposable=this.register(new y.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new d.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new d.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new d.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new d.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new u.RenderDebouncer(((A,M)=>this._renderRows(A,M)),w),this.register(this._renderDebouncer),this.register(w.onDprChange((()=>this.handleDevicePixelRatioChange()))),this.register(C.onResize((()=>this._fullRefresh()))),this.register(C.buffers.onBufferActivate((()=>{var A;return(A=this._renderer.value)==null?void 0:A.clear()}))),this.register(b.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._charSizeService.onCharSizeChange((()=>this.handleCharSizeChanged()))),this.register(x.onDecorationRegistered((()=>this._fullRefresh()))),this.register(x.onDecorationRemoved((()=>this._fullRefresh()))),this.register(b.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],(()=>{this.clear(),this.handleResize(C.cols,C.rows),this._fullRefresh()}))),this.register(b.onMultipleOptionChange(["cursorBlink","cursorStyle"],(()=>this.refreshRows(C.buffer.y,C.buffer.y,!0)))),this.register(E.onChangeColors((()=>this._fullRefresh()))),this._registerIntersectionObserver(w.window,v),this.register(w.onWindowChange((A=>this._registerIntersectionObserver(A,v))))}_registerIntersectionObserver(g,v){if("IntersectionObserver"in g){const b=new g.IntersectionObserver((S=>this._handleIntersectionChange(S[S.length-1])),{threshold:0});b.observe(v),this._observerDisposable.value=(0,y.toDisposable)((()=>b.disconnect()))}}_handleIntersectionChange(g){this._isPaused=g.isIntersecting===void 0?g.intersectionRatio===0:!g.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(g,v,b=!1){this._isPaused?this._needsFullRefresh=!0:(b||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(g,v,this._rowCount))}_renderRows(g,v){this._renderer.value&&(g=Math.min(g,this._rowCount-1),v=Math.min(v,this._rowCount-1),this._renderer.value.renderRows(g,v),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:g,end:v}),this._onRender.fire({start:g,end:v}),this._isNextRenderRedrawOnly=!0)}resize(g,v){this._rowCount=v,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(g){this._renderer.value=g,this._renderer.value&&(this._renderer.value.onRequestRedraw((v=>this.refreshRows(v.start,v.end,!0))),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(g){return this._renderDebouncer.addRefreshCallback(g)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var g,v;this._renderer.value&&((v=(g=this._renderer.value).clearTextureAtlas)==null||v.call(g),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(g,v){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set((()=>{var b;return(b=this._renderer.value)==null?void 0:b.handleResize(g,v)})):this._renderer.value.handleResize(g,v),this._fullRefresh())}handleCharSizeChanged(){var g;(g=this._renderer.value)==null||g.handleCharSizeChanged()}handleBlur(){var g;(g=this._renderer.value)==null||g.handleBlur()}handleFocus(){var g;(g=this._renderer.value)==null||g.handleFocus()}handleSelectionChanged(g,v,b){var S;this._selectionState.start=g,this._selectionState.end=v,this._selectionState.columnSelectMode=b,(S=this._renderer.value)==null||S.handleSelectionChanged(g,v,b)}handleCursorMove(){var g;(g=this._renderer.value)==null||g.handleCursorMove()}clear(){var g;(g=this._renderer.value)==null||g.clear()}};o.RenderService=p=c([h(2,m.IOptionsService),h(3,f.ICharSizeService),h(4,m.IDecorationService),h(5,m.IBufferService),h(6,f.ICoreBrowserService),h(7,f.IThemeService)],p)},9312:function(l,o,a){var c=this&&this.__decorate||function(w,E,A,M){var T,B=arguments.length,F=B<3?E:M===null?M=Object.getOwnPropertyDescriptor(E,A):M;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")F=Reflect.decorate(w,E,A,M);else for(var j=w.length-1;j>=0;j--)(T=w[j])&&(F=(B<3?T(F):B>3?T(E,A,F):T(E,A))||F);return B>3&&F&&Object.defineProperty(E,A,F),F},h=this&&this.__param||function(w,E){return function(A,M){E(A,M,w)}};Object.defineProperty(o,"__esModule",{value:!0}),o.SelectionService=void 0;const u=a(9806),f=a(9504),d=a(456),y=a(4725),_=a(8460),m=a(844),p=a(6114),g=a(4841),v=a(511),b=a(2585),S=" ",x=new RegExp(S,"g");let C=o.SelectionService=class extends m.Disposable{constructor(w,E,A,M,T,B,F,j,z){super(),this._element=w,this._screenElement=E,this._linkifier=A,this._bufferService=M,this._coreService=T,this._mouseService=B,this._optionsService=F,this._renderService=j,this._coreBrowserService=z,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new v.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new _.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new _.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new _.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new _.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=$=>this._handleMouseMove($),this._mouseUpListener=$=>this._handleMouseUp($),this._coreService.onUserInput((()=>{this.hasSelection&&this.clearSelection()})),this._trimListener=this._bufferService.buffer.lines.onTrim(($=>this._handleTrim($))),this.register(this._bufferService.buffers.onBufferActivate(($=>this._handleBufferActivate($)))),this.enable(),this._model=new d.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,m.toDisposable)((()=>{this._removeMouseDownListeners()})))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const w=this._model.finalSelectionStart,E=this._model.finalSelectionEnd;return!(!w||!E||w[0]===E[0]&&w[1]===E[1])}get selectionText(){const w=this._model.finalSelectionStart,E=this._model.finalSelectionEnd;if(!w||!E)return"";const A=this._bufferService.buffer,M=[];if(this._activeSelectionMode===3){if(w[0]===E[0])return"";const T=w[0]<E[0]?w[0]:E[0],B=w[0]<E[0]?E[0]:w[0];for(let F=w[1];F<=E[1];F++){const j=A.translateBufferLineToString(F,!0,T,B);M.push(j)}}else{const T=w[1]===E[1]?E[0]:void 0;M.push(A.translateBufferLineToString(w[1],!0,w[0],T));for(let B=w[1]+1;B<=E[1]-1;B++){const F=A.lines.get(B),j=A.translateBufferLineToString(B,!0);F!=null&&F.isWrapped?M[M.length-1]+=j:M.push(j)}if(w[1]!==E[1]){const B=A.lines.get(E[1]),F=A.translateBufferLineToString(E[1],!0,0,E[0]);B&&B.isWrapped?M[M.length-1]+=F:M.push(F)}}return M.map((T=>T.replace(x," "))).join(p.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(w){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._refresh()))),p.isLinux&&w&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(w){const E=this._getMouseBufferCoords(w),A=this._model.finalSelectionStart,M=this._model.finalSelectionEnd;return!!(A&&M&&E)&&this._areCoordsInSelection(E,A,M)}isCellInSelection(w,E){const A=this._model.finalSelectionStart,M=this._model.finalSelectionEnd;return!(!A||!M)&&this._areCoordsInSelection([w,E],A,M)}_areCoordsInSelection(w,E,A){return w[1]>E[1]&&w[1]<A[1]||E[1]===A[1]&&w[1]===E[1]&&w[0]>=E[0]&&w[0]<A[0]||E[1]<A[1]&&w[1]===A[1]&&w[0]<A[0]||E[1]<A[1]&&w[1]===E[1]&&w[0]>=E[0]}_selectWordAtCursor(w,E){var T,B;const A=(B=(T=this._linkifier.currentLink)==null?void 0:T.link)==null?void 0:B.range;if(A)return this._model.selectionStart=[A.start.x-1,A.start.y-1],this._model.selectionStartLength=(0,g.getRangeLength)(A,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const M=this._getMouseBufferCoords(w);return!!M&&(this._selectWordAt(M,E),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(w,E){this._model.clearSelection(),w=Math.max(w,0),E=Math.min(E,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,w],this._model.selectionEnd=[this._bufferService.cols,E],this.refresh(),this._onSelectionChange.fire()}_handleTrim(w){this._model.handleTrim(w)&&this.refresh()}_getMouseBufferCoords(w){const E=this._mouseService.getCoords(w,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(E)return E[0]--,E[1]--,E[1]+=this._bufferService.buffer.ydisp,E}_getMouseEventScrollAmount(w){let E=(0,u.getCoordsRelativeToElement)(this._coreBrowserService.window,w,this._screenElement)[1];const A=this._renderService.dimensions.css.canvas.height;return E>=0&&E<=A?0:(E>A&&(E-=A),E=Math.min(Math.max(E,-50),50),E/=50,E/Math.abs(E)+Math.round(14*E))}shouldForceSelection(w){return p.isMac?w.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:w.shiftKey}handleMouseDown(w){if(this._mouseDownTimeStamp=w.timeStamp,(w.button!==2||!this.hasSelection)&&w.button===0){if(!this._enabled){if(!this.shouldForceSelection(w))return;w.stopPropagation()}w.preventDefault(),this._dragScrollAmount=0,this._enabled&&w.shiftKey?this._handleIncrementalClick(w):w.detail===1?this._handleSingleClick(w):w.detail===2?this._handleDoubleClick(w):w.detail===3&&this._handleTripleClick(w),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval((()=>this._dragScroll()),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(w){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(w))}_handleSingleClick(w){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(w)?3:0,this._model.selectionStart=this._getMouseBufferCoords(w),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const E=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);E&&E.length!==this._model.selectionStart[0]&&E.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(w){this._selectWordAtCursor(w,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(w){const E=this._getMouseBufferCoords(w);E&&(this._activeSelectionMode=2,this._selectLineAt(E[1]))}shouldColumnSelect(w){return w.altKey&&!(p.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(w){if(w.stopImmediatePropagation(),!this._model.selectionStart)return;const E=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(w),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(w),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const A=this._bufferService.buffer;if(this._model.selectionEnd[1]<A.lines.length){const M=A.lines.get(this._model.selectionEnd[1]);M&&M.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}E&&E[0]===this._model.selectionEnd[0]&&E[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const w=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(w.ydisp+this._bufferService.rows,w.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=w.ydisp),this.refresh()}}_handleMouseUp(w){const E=w.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&E<500&&w.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const A=this._mouseService.getCoords(w,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(A&&A[0]!==void 0&&A[1]!==void 0){const M=(0,f.moveToCellSequence)(A[0]-1,A[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(M,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const w=this._model.finalSelectionStart,E=this._model.finalSelectionEnd,A=!(!w||!E||w[0]===E[0]&&w[1]===E[1]);A?w&&E&&(this._oldSelectionStart&&this._oldSelectionEnd&&w[0]===this._oldSelectionStart[0]&&w[1]===this._oldSelectionStart[1]&&E[0]===this._oldSelectionEnd[0]&&E[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(w,E,A)):this._oldHasSelection&&this._fireOnSelectionChange(w,E,A)}_fireOnSelectionChange(w,E,A){this._oldSelectionStart=w,this._oldSelectionEnd=E,this._oldHasSelection=A,this._onSelectionChange.fire()}_handleBufferActivate(w){this.clearSelection(),this._trimListener.dispose(),this._trimListener=w.activeBuffer.lines.onTrim((E=>this._handleTrim(E)))}_convertViewportColToCharacterIndex(w,E){let A=E;for(let M=0;E>=M;M++){const T=w.loadCell(M,this._workCell).getChars().length;this._workCell.getWidth()===0?A--:T>1&&E!==M&&(A+=T-1)}return A}setSelection(w,E,A){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[w,E],this._model.selectionStartLength=A,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(w){this._isClickInSelection(w)||(this._selectWordAtCursor(w,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(w,E,A=!0,M=!0){if(w[0]>=this._bufferService.cols)return;const T=this._bufferService.buffer,B=T.lines.get(w[1]);if(!B)return;const F=T.translateBufferLineToString(w[1],!1);let j=this._convertViewportColToCharacterIndex(B,w[0]),z=j;const $=w[0]-j;let V=0,L=0,k=0,I=0;if(F.charAt(j)===" "){for(;j>0&&F.charAt(j-1)===" ";)j--;for(;z<F.length&&F.charAt(z+1)===" ";)z++}else{let X=w[0],ee=w[0];B.getWidth(X)===0&&(V++,X--),B.getWidth(ee)===2&&(L++,ee++);const re=B.getString(ee).length;for(re>1&&(I+=re-1,z+=re-1);X>0&&j>0&&!this._isCharWordSeparator(B.loadCell(X-1,this._workCell));){B.loadCell(X-1,this._workCell);const O=this._workCell.getChars().length;this._workCell.getWidth()===0?(V++,X--):O>1&&(k+=O-1,j-=O-1),j--,X--}for(;ee<B.length&&z+1<F.length&&!this._isCharWordSeparator(B.loadCell(ee+1,this._workCell));){B.loadCell(ee+1,this._workCell);const O=this._workCell.getChars().length;this._workCell.getWidth()===2?(L++,ee++):O>1&&(I+=O-1,z+=O-1),z++,ee++}}z++;let H=j+$-V+k,P=Math.min(this._bufferService.cols,z-j+V+L-k-I);if(E||F.slice(j,z).trim()!==""){if(A&&H===0&&B.getCodePoint(0)!==32){const X=T.lines.get(w[1]-1);if(X&&B.isWrapped&&X.getCodePoint(this._bufferService.cols-1)!==32){const ee=this._getWordAt([this._bufferService.cols-1,w[1]-1],!1,!0,!1);if(ee){const re=this._bufferService.cols-ee.start;H-=re,P+=re}}}if(M&&H+P===this._bufferService.cols&&B.getCodePoint(this._bufferService.cols-1)!==32){const X=T.lines.get(w[1]+1);if(X!=null&&X.isWrapped&&X.getCodePoint(0)!==32){const ee=this._getWordAt([0,w[1]+1],!1,!1,!0);ee&&(P+=ee.length)}}return{start:H,length:P}}}_selectWordAt(w,E){const A=this._getWordAt(w,E);if(A){for(;A.start<0;)A.start+=this._bufferService.cols,w[1]--;this._model.selectionStart=[A.start,w[1]],this._model.selectionStartLength=A.length}}_selectToWordAt(w){const E=this._getWordAt(w,!0);if(E){let A=w[1];for(;E.start<0;)E.start+=this._bufferService.cols,A--;if(!this._model.areSelectionValuesReversed())for(;E.start+E.length>this._bufferService.cols;)E.length-=this._bufferService.cols,A++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?E.start:E.start+E.length,A]}}_isCharWordSeparator(w){return w.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(w.getChars())>=0}_selectLineAt(w){const E=this._bufferService.buffer.getWrappedRangeForLine(w),A={start:{x:0,y:E.first},end:{x:this._bufferService.cols-1,y:E.last}};this._model.selectionStart=[0,E.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,g.getRangeLength)(A,this._bufferService.cols)}};o.SelectionService=C=c([h(3,b.IBufferService),h(4,b.ICoreService),h(5,y.IMouseService),h(6,b.IOptionsService),h(7,y.IRenderService),h(8,y.ICoreBrowserService)],C)},4725:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ILinkProviderService=o.IThemeService=o.ICharacterJoinerService=o.ISelectionService=o.IRenderService=o.IMouseService=o.ICoreBrowserService=o.ICharSizeService=void 0;const c=a(8343);o.ICharSizeService=(0,c.createDecorator)("CharSizeService"),o.ICoreBrowserService=(0,c.createDecorator)("CoreBrowserService"),o.IMouseService=(0,c.createDecorator)("MouseService"),o.IRenderService=(0,c.createDecorator)("RenderService"),o.ISelectionService=(0,c.createDecorator)("SelectionService"),o.ICharacterJoinerService=(0,c.createDecorator)("CharacterJoinerService"),o.IThemeService=(0,c.createDecorator)("ThemeService"),o.ILinkProviderService=(0,c.createDecorator)("LinkProviderService")},6731:function(l,o,a){var c=this&&this.__decorate||function(C,w,E,A){var M,T=arguments.length,B=T<3?w:A===null?A=Object.getOwnPropertyDescriptor(w,E):A;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(C,w,E,A);else for(var F=C.length-1;F>=0;F--)(M=C[F])&&(B=(T<3?M(B):T>3?M(w,E,B):M(w,E))||B);return T>3&&B&&Object.defineProperty(w,E,B),B},h=this&&this.__param||function(C,w){return function(E,A){w(E,A,C)}};Object.defineProperty(o,"__esModule",{value:!0}),o.ThemeService=o.DEFAULT_ANSI_COLORS=void 0;const u=a(7239),f=a(8055),d=a(8460),y=a(844),_=a(2585),m=f.css.toColor("#ffffff"),p=f.css.toColor("#000000"),g=f.css.toColor("#ffffff"),v=f.css.toColor("#000000"),b={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};o.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const C=[f.css.toColor("#2e3436"),f.css.toColor("#cc0000"),f.css.toColor("#4e9a06"),f.css.toColor("#c4a000"),f.css.toColor("#3465a4"),f.css.toColor("#75507b"),f.css.toColor("#06989a"),f.css.toColor("#d3d7cf"),f.css.toColor("#555753"),f.css.toColor("#ef2929"),f.css.toColor("#8ae234"),f.css.toColor("#fce94f"),f.css.toColor("#729fcf"),f.css.toColor("#ad7fa8"),f.css.toColor("#34e2e2"),f.css.toColor("#eeeeec")],w=[0,95,135,175,215,255];for(let E=0;E<216;E++){const A=w[E/36%6|0],M=w[E/6%6|0],T=w[E%6];C.push({css:f.channels.toCss(A,M,T),rgba:f.channels.toRgba(A,M,T)})}for(let E=0;E<24;E++){const A=8+10*E;C.push({css:f.channels.toCss(A,A,A),rgba:f.channels.toRgba(A,A,A)})}return C})());let S=o.ThemeService=class extends y.Disposable{get colors(){return this._colors}constructor(C){super(),this._optionsService=C,this._contrastCache=new u.ColorContrastCache,this._halfContrastCache=new u.ColorContrastCache,this._onChangeColors=this.register(new d.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:m,background:p,cursor:g,cursorAccent:v,selectionForeground:void 0,selectionBackgroundTransparent:b,selectionBackgroundOpaque:f.color.blend(p,b),selectionInactiveBackgroundTransparent:b,selectionInactiveBackgroundOpaque:f.color.blend(p,b),ansi:o.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",(()=>this._contrastCache.clear()))),this.register(this._optionsService.onSpecificOptionChange("theme",(()=>this._setTheme(this._optionsService.rawOptions.theme))))}_setTheme(C={}){const w=this._colors;if(w.foreground=x(C.foreground,m),w.background=x(C.background,p),w.cursor=x(C.cursor,g),w.cursorAccent=x(C.cursorAccent,v),w.selectionBackgroundTransparent=x(C.selectionBackground,b),w.selectionBackgroundOpaque=f.color.blend(w.background,w.selectionBackgroundTransparent),w.selectionInactiveBackgroundTransparent=x(C.selectionInactiveBackground,w.selectionBackgroundTransparent),w.selectionInactiveBackgroundOpaque=f.color.blend(w.background,w.selectionInactiveBackgroundTransparent),w.selectionForeground=C.selectionForeground?x(C.selectionForeground,f.NULL_COLOR):void 0,w.selectionForeground===f.NULL_COLOR&&(w.selectionForeground=void 0),f.color.isOpaque(w.selectionBackgroundTransparent)&&(w.selectionBackgroundTransparent=f.color.opacity(w.selectionBackgroundTransparent,.3)),f.color.isOpaque(w.selectionInactiveBackgroundTransparent)&&(w.selectionInactiveBackgroundTransparent=f.color.opacity(w.selectionInactiveBackgroundTransparent,.3)),w.ansi=o.DEFAULT_ANSI_COLORS.slice(),w.ansi[0]=x(C.black,o.DEFAULT_ANSI_COLORS[0]),w.ansi[1]=x(C.red,o.DEFAULT_ANSI_COLORS[1]),w.ansi[2]=x(C.green,o.DEFAULT_ANSI_COLORS[2]),w.ansi[3]=x(C.yellow,o.DEFAULT_ANSI_COLORS[3]),w.ansi[4]=x(C.blue,o.DEFAULT_ANSI_COLORS[4]),w.ansi[5]=x(C.magenta,o.DEFAULT_ANSI_COLORS[5]),w.ansi[6]=x(C.cyan,o.DEFAULT_ANSI_COLORS[6]),w.ansi[7]=x(C.white,o.DEFAULT_ANSI_COLORS[7]),w.ansi[8]=x(C.brightBlack,o.DEFAULT_ANSI_COLORS[8]),w.ansi[9]=x(C.brightRed,o.DEFAULT_ANSI_COLORS[9]),w.ansi[10]=x(C.brightGreen,o.DEFAULT_ANSI_COLORS[10]),w.ansi[11]=x(C.brightYellow,o.DEFAULT_ANSI_COLORS[11]),w.ansi[12]=x(C.brightBlue,o.DEFAULT_ANSI_COLORS[12]),w.ansi[13]=x(C.brightMagenta,o.DEFAULT_ANSI_COLORS[13]),w.ansi[14]=x(C.brightCyan,o.DEFAULT_ANSI_COLORS[14]),w.ansi[15]=x(C.brightWhite,o.DEFAULT_ANSI_COLORS[15]),C.extendedAnsi){const E=Math.min(w.ansi.length-16,C.extendedAnsi.length);for(let A=0;A<E;A++)w.ansi[A+16]=x(C.extendedAnsi[A],o.DEFAULT_ANSI_COLORS[A+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(C){this._restoreColor(C),this._onChangeColors.fire(this.colors)}_restoreColor(C){if(C!==void 0)switch(C){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[C]=this._restoreColors.ansi[C]}else for(let w=0;w<this._restoreColors.ansi.length;++w)this._colors.ansi[w]=this._restoreColors.ansi[w]}modifyColors(C){C(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function x(C,w){if(C!==void 0)try{return f.css.toColor(C)}catch{}return w}o.ThemeService=S=c([h(0,_.IOptionsService)],S)},6349:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CircularList=void 0;const c=a(8460),h=a(844);class u extends h.Disposable{constructor(d){super(),this._maxLength=d,this.onDeleteEmitter=this.register(new c.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new c.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new c.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(d){if(this._maxLength===d)return;const y=new Array(d);for(let _=0;_<Math.min(d,this.length);_++)y[_]=this._array[this._getCyclicIndex(_)];this._array=y,this._maxLength=d,this._startIndex=0}get length(){return this._length}set length(d){if(d>this._length)for(let y=this._length;y<d;y++)this._array[y]=void 0;this._length=d}get(d){return this._array[this._getCyclicIndex(d)]}set(d,y){this._array[this._getCyclicIndex(d)]=y}push(d){this._array[this._getCyclicIndex(this._length)]=d,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(d,y,..._){if(y){for(let m=d;m<this._length-y;m++)this._array[this._getCyclicIndex(m)]=this._array[this._getCyclicIndex(m+y)];this._length-=y,this.onDeleteEmitter.fire({index:d,amount:y})}for(let m=this._length-1;m>=d;m--)this._array[this._getCyclicIndex(m+_.length)]=this._array[this._getCyclicIndex(m)];for(let m=0;m<_.length;m++)this._array[this._getCyclicIndex(d+m)]=_[m];if(_.length&&this.onInsertEmitter.fire({index:d,amount:_.length}),this._length+_.length>this._maxLength){const m=this._length+_.length-this._maxLength;this._startIndex+=m,this._length=this._maxLength,this.onTrimEmitter.fire(m)}else this._length+=_.length}trimStart(d){d>this._length&&(d=this._length),this._startIndex+=d,this._length-=d,this.onTrimEmitter.fire(d)}shiftElements(d,y,_){if(!(y<=0)){if(d<0||d>=this._length)throw new Error("start argument out of range");if(d+_<0)throw new Error("Cannot shift elements in list beyond index 0");if(_>0){for(let p=y-1;p>=0;p--)this.set(d+p+_,this.get(d+p));const m=d+y+_-this._length;if(m>0)for(this._length+=m;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let m=0;m<y;m++)this.set(d+m+_,this.get(d+m))}}_getCyclicIndex(d){return(this._startIndex+d)%this._maxLength}}o.CircularList=u},1439:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.clone=void 0,o.clone=function a(c,h=5){if(typeof c!="object")return c;const u=Array.isArray(c)?[]:{};for(const f in c)u[f]=h<=1?c[f]:c[f]&&a(c[f],h-1);return u}},8055:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.contrastRatio=o.toPaddedHex=o.rgba=o.rgb=o.css=o.color=o.channels=o.NULL_COLOR=void 0;let a=0,c=0,h=0,u=0;var f,d,y,_,m;function p(v){const b=v.toString(16);return b.length<2?"0"+b:b}function g(v,b){return v<b?(b+.05)/(v+.05):(v+.05)/(b+.05)}o.NULL_COLOR={css:"#00000000",rgba:0},(function(v){v.toCss=function(b,S,x,C){return C!==void 0?`#${p(b)}${p(S)}${p(x)}${p(C)}`:`#${p(b)}${p(S)}${p(x)}`},v.toRgba=function(b,S,x,C=255){return(b<<24|S<<16|x<<8|C)>>>0},v.toColor=function(b,S,x,C){return{css:v.toCss(b,S,x,C),rgba:v.toRgba(b,S,x,C)}}})(f||(o.channels=f={})),(function(v){function b(S,x){return u=Math.round(255*x),[a,c,h]=m.toChannels(S.rgba),{css:f.toCss(a,c,h,u),rgba:f.toRgba(a,c,h,u)}}v.blend=function(S,x){if(u=(255&x.rgba)/255,u===1)return{css:x.css,rgba:x.rgba};const C=x.rgba>>24&255,w=x.rgba>>16&255,E=x.rgba>>8&255,A=S.rgba>>24&255,M=S.rgba>>16&255,T=S.rgba>>8&255;return a=A+Math.round((C-A)*u),c=M+Math.round((w-M)*u),h=T+Math.round((E-T)*u),{css:f.toCss(a,c,h),rgba:f.toRgba(a,c,h)}},v.isOpaque=function(S){return(255&S.rgba)==255},v.ensureContrastRatio=function(S,x,C){const w=m.ensureContrastRatio(S.rgba,x.rgba,C);if(w)return f.toColor(w>>24&255,w>>16&255,w>>8&255)},v.opaque=function(S){const x=(255|S.rgba)>>>0;return[a,c,h]=m.toChannels(x),{css:f.toCss(a,c,h),rgba:x}},v.opacity=b,v.multiplyOpacity=function(S,x){return u=255&S.rgba,b(S,u*x/255)},v.toColorRGB=function(S){return[S.rgba>>24&255,S.rgba>>16&255,S.rgba>>8&255]}})(d||(o.color=d={})),(function(v){let b,S;try{const x=document.createElement("canvas");x.width=1,x.height=1;const C=x.getContext("2d",{willReadFrequently:!0});C&&(b=C,b.globalCompositeOperation="copy",S=b.createLinearGradient(0,0,1,1))}catch{}v.toColor=function(x){if(x.match(/#[\da-f]{3,8}/i))switch(x.length){case 4:return a=parseInt(x.slice(1,2).repeat(2),16),c=parseInt(x.slice(2,3).repeat(2),16),h=parseInt(x.slice(3,4).repeat(2),16),f.toColor(a,c,h);case 5:return a=parseInt(x.slice(1,2).repeat(2),16),c=parseInt(x.slice(2,3).repeat(2),16),h=parseInt(x.slice(3,4).repeat(2),16),u=parseInt(x.slice(4,5).repeat(2),16),f.toColor(a,c,h,u);case 7:return{css:x,rgba:(parseInt(x.slice(1),16)<<8|255)>>>0};case 9:return{css:x,rgba:parseInt(x.slice(1),16)>>>0}}const C=x.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(C)return a=parseInt(C[1]),c=parseInt(C[2]),h=parseInt(C[3]),u=Math.round(255*(C[5]===void 0?1:parseFloat(C[5]))),f.toColor(a,c,h,u);if(!b||!S)throw new Error("css.toColor: Unsupported css format");if(b.fillStyle=S,b.fillStyle=x,typeof b.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(b.fillRect(0,0,1,1),[a,c,h,u]=b.getImageData(0,0,1,1).data,u!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:f.toRgba(a,c,h,u),css:x}}})(y||(o.css=y={})),(function(v){function b(S,x,C){const w=S/255,E=x/255,A=C/255;return .2126*(w<=.03928?w/12.92:Math.pow((w+.055)/1.055,2.4))+.7152*(E<=.03928?E/12.92:Math.pow((E+.055)/1.055,2.4))+.0722*(A<=.03928?A/12.92:Math.pow((A+.055)/1.055,2.4))}v.relativeLuminance=function(S){return b(S>>16&255,S>>8&255,255&S)},v.relativeLuminance2=b})(_||(o.rgb=_={})),(function(v){function b(x,C,w){const E=x>>24&255,A=x>>16&255,M=x>>8&255;let T=C>>24&255,B=C>>16&255,F=C>>8&255,j=g(_.relativeLuminance2(T,B,F),_.relativeLuminance2(E,A,M));for(;j<w&&(T>0||B>0||F>0);)T-=Math.max(0,Math.ceil(.1*T)),B-=Math.max(0,Math.ceil(.1*B)),F-=Math.max(0,Math.ceil(.1*F)),j=g(_.relativeLuminance2(T,B,F),_.relativeLuminance2(E,A,M));return(T<<24|B<<16|F<<8|255)>>>0}function S(x,C,w){const E=x>>24&255,A=x>>16&255,M=x>>8&255;let T=C>>24&255,B=C>>16&255,F=C>>8&255,j=g(_.relativeLuminance2(T,B,F),_.relativeLuminance2(E,A,M));for(;j<w&&(T<255||B<255||F<255);)T=Math.min(255,T+Math.ceil(.1*(255-T))),B=Math.min(255,B+Math.ceil(.1*(255-B))),F=Math.min(255,F+Math.ceil(.1*(255-F))),j=g(_.relativeLuminance2(T,B,F),_.relativeLuminance2(E,A,M));return(T<<24|B<<16|F<<8|255)>>>0}v.blend=function(x,C){if(u=(255&C)/255,u===1)return C;const w=C>>24&255,E=C>>16&255,A=C>>8&255,M=x>>24&255,T=x>>16&255,B=x>>8&255;return a=M+Math.round((w-M)*u),c=T+Math.round((E-T)*u),h=B+Math.round((A-B)*u),f.toRgba(a,c,h)},v.ensureContrastRatio=function(x,C,w){const E=_.relativeLuminance(x>>8),A=_.relativeLuminance(C>>8);if(g(E,A)<w){if(A<E){const B=b(x,C,w),F=g(E,_.relativeLuminance(B>>8));if(F<w){const j=S(x,C,w);return F>g(E,_.relativeLuminance(j>>8))?B:j}return B}const M=S(x,C,w),T=g(E,_.relativeLuminance(M>>8));if(T<w){const B=b(x,C,w);return T>g(E,_.relativeLuminance(B>>8))?M:B}return M}},v.reduceLuminance=b,v.increaseLuminance=S,v.toChannels=function(x){return[x>>24&255,x>>16&255,x>>8&255,255&x]}})(m||(o.rgba=m={})),o.toPaddedHex=p,o.contrastRatio=g},8969:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CoreTerminal=void 0;const c=a(844),h=a(2585),u=a(4348),f=a(7866),d=a(744),y=a(7302),_=a(6975),m=a(8460),p=a(1753),g=a(1480),v=a(7994),b=a(9282),S=a(5435),x=a(5981),C=a(2660);let w=!1;class E extends c.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new m.EventEmitter),this._onScroll.event((M=>{var T;(T=this._onScrollApi)==null||T.fire(M.position)}))),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(M){for(const T in M)this.optionsService.options[T]=M[T]}constructor(M){super(),this._windowsWrappingHeuristics=this.register(new c.MutableDisposable),this._onBinary=this.register(new m.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new m.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new m.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new m.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new m.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new m.EventEmitter),this._instantiationService=new u.InstantiationService,this.optionsService=this.register(new y.OptionsService(M)),this._instantiationService.setService(h.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(d.BufferService)),this._instantiationService.setService(h.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(f.LogService)),this._instantiationService.setService(h.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(_.CoreService)),this._instantiationService.setService(h.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(p.CoreMouseService)),this._instantiationService.setService(h.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(g.UnicodeService)),this._instantiationService.setService(h.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(v.CharsetService),this._instantiationService.setService(h.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(C.OscLinkService),this._instantiationService.setService(h.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new S.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,m.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,m.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,m.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,m.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom((()=>this.scrollToBottom()))),this.register(this.coreService.onUserInput((()=>this._writeBuffer.handleUserInput()))),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],(()=>this._handleWindowsPtyOptionChange()))),this.register(this._bufferService.onScroll((T=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this.register(this._inputHandler.onScroll((T=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this._writeBuffer=this.register(new x.WriteBuffer(((T,B)=>this._inputHandler.parse(T,B)))),this.register((0,m.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(M,T){this._writeBuffer.write(M,T)}writeSync(M,T){this._logService.logLevel<=h.LogLevelEnum.WARN&&!w&&(this._logService.warn("writeSync is unreliable and will be removed soon."),w=!0),this._writeBuffer.writeSync(M,T)}input(M,T=!0){this.coreService.triggerDataEvent(M,T)}resize(M,T){isNaN(M)||isNaN(T)||(M=Math.max(M,d.MINIMUM_COLS),T=Math.max(T,d.MINIMUM_ROWS),this._bufferService.resize(M,T))}scroll(M,T=!1){this._bufferService.scroll(M,T)}scrollLines(M,T,B){this._bufferService.scrollLines(M,T,B)}scrollPages(M){this.scrollLines(M*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(M){const T=M-this._bufferService.buffer.ydisp;T!==0&&this.scrollLines(T)}registerEscHandler(M,T){return this._inputHandler.registerEscHandler(M,T)}registerDcsHandler(M,T){return this._inputHandler.registerDcsHandler(M,T)}registerCsiHandler(M,T){return this._inputHandler.registerCsiHandler(M,T)}registerOscHandler(M,T){return this._inputHandler.registerOscHandler(M,T)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let M=!1;const T=this.optionsService.rawOptions.windowsPty;T&&T.buildNumber!==void 0&&T.buildNumber!==void 0?M=T.backend==="conpty"&&T.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(M=!0),M?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const M=[];M.push(this.onLineFeed(b.updateWindowsModeWrappedState.bind(null,this._bufferService))),M.push(this.registerCsiHandler({final:"H"},(()=>((0,b.updateWindowsModeWrappedState)(this._bufferService),!1)))),this._windowsWrappingHeuristics.value=(0,c.toDisposable)((()=>{for(const T of M)T.dispose()}))}}}o.CoreTerminal=E},8460:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.runAndSubscribe=o.forwardEvent=o.EventEmitter=void 0,o.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=a=>(this._listeners.push(a),{dispose:()=>{if(!this._disposed){for(let c=0;c<this._listeners.length;c++)if(this._listeners[c]===a)return void this._listeners.splice(c,1)}}})),this._event}fire(a,c){const h=[];for(let u=0;u<this._listeners.length;u++)h.push(this._listeners[u]);for(let u=0;u<h.length;u++)h[u].call(void 0,a,c)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},o.forwardEvent=function(a,c){return a((h=>c.fire(h)))},o.runAndSubscribe=function(a,c){return c(void 0),a((h=>c(h)))}},5435:function(l,o,a){var c=this&&this.__decorate||function(V,L,k,I){var H,P=arguments.length,X=P<3?L:I===null?I=Object.getOwnPropertyDescriptor(L,k):I;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")X=Reflect.decorate(V,L,k,I);else for(var ee=V.length-1;ee>=0;ee--)(H=V[ee])&&(X=(P<3?H(X):P>3?H(L,k,X):H(L,k))||X);return P>3&&X&&Object.defineProperty(L,k,X),X},h=this&&this.__param||function(V,L){return function(k,I){L(k,I,V)}};Object.defineProperty(o,"__esModule",{value:!0}),o.InputHandler=o.WindowsOptionsReportType=void 0;const u=a(2584),f=a(7116),d=a(2015),y=a(844),_=a(482),m=a(8437),p=a(8460),g=a(643),v=a(511),b=a(3734),S=a(2585),x=a(1480),C=a(6242),w=a(6351),E=a(5941),A={"(":0,")":1,"*":2,"+":3,"-":1,".":2},M=131072;function T(V,L){if(V>24)return L.setWinLines||!1;switch(V){case 1:return!!L.restoreWin;case 2:return!!L.minimizeWin;case 3:return!!L.setWinPosition;case 4:return!!L.setWinSizePixels;case 5:return!!L.raiseWin;case 6:return!!L.lowerWin;case 7:return!!L.refreshWin;case 8:return!!L.setWinSizeChars;case 9:return!!L.maximizeWin;case 10:return!!L.fullscreenWin;case 11:return!!L.getWinState;case 13:return!!L.getWinPosition;case 14:return!!L.getWinSizePixels;case 15:return!!L.getScreenSizePixels;case 16:return!!L.getCellSizePixels;case 18:return!!L.getWinSizeChars;case 19:return!!L.getScreenSizeChars;case 20:return!!L.getIconTitle;case 21:return!!L.getWinTitle;case 22:return!!L.pushTitle;case 23:return!!L.popTitle;case 24:return!!L.setWinLines}return!1}var B;(function(V){V[V.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",V[V.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(B||(o.WindowsOptionsReportType=B={}));let F=0;class j extends y.Disposable{getAttrData(){return this._curAttrData}constructor(L,k,I,H,P,X,ee,re,O=new d.EscapeSequenceParser){super(),this._bufferService=L,this._charsetService=k,this._coreService=I,this._logService=H,this._optionsService=P,this._oscLinkService=X,this._coreMouseService=ee,this._unicodeService=re,this._parser=O,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new _.StringToUtf32,this._utf8Decoder=new _.Utf8ToUtf32,this._workCell=new v.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=m.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=m.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new p.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new p.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new p.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new p.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new p.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new p.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new p.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new p.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new p.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new p.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new p.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new p.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new p.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new z(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((R=>this._activeBuffer=R.activeBuffer))),this._parser.setCsiHandlerFallback(((R,K)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(R),params:K.toArray()})})),this._parser.setEscHandlerFallback((R=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(R)})})),this._parser.setExecuteHandlerFallback((R=>{this._logService.debug("Unknown EXECUTE code: ",{code:R})})),this._parser.setOscHandlerFallback(((R,K,W)=>{this._logService.debug("Unknown OSC code: ",{identifier:R,action:K,data:W})})),this._parser.setDcsHandlerFallback(((R,K,W)=>{K==="HOOK"&&(W=W.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(R),action:K,payload:W})})),this._parser.setPrintHandler(((R,K,W)=>this.print(R,K,W))),this._parser.registerCsiHandler({final:"@"},(R=>this.insertChars(R))),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(R=>this.scrollLeft(R))),this._parser.registerCsiHandler({final:"A"},(R=>this.cursorUp(R))),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(R=>this.scrollRight(R))),this._parser.registerCsiHandler({final:"B"},(R=>this.cursorDown(R))),this._parser.registerCsiHandler({final:"C"},(R=>this.cursorForward(R))),this._parser.registerCsiHandler({final:"D"},(R=>this.cursorBackward(R))),this._parser.registerCsiHandler({final:"E"},(R=>this.cursorNextLine(R))),this._parser.registerCsiHandler({final:"F"},(R=>this.cursorPrecedingLine(R))),this._parser.registerCsiHandler({final:"G"},(R=>this.cursorCharAbsolute(R))),this._parser.registerCsiHandler({final:"H"},(R=>this.cursorPosition(R))),this._parser.registerCsiHandler({final:"I"},(R=>this.cursorForwardTab(R))),this._parser.registerCsiHandler({final:"J"},(R=>this.eraseInDisplay(R,!1))),this._parser.registerCsiHandler({prefix:"?",final:"J"},(R=>this.eraseInDisplay(R,!0))),this._parser.registerCsiHandler({final:"K"},(R=>this.eraseInLine(R,!1))),this._parser.registerCsiHandler({prefix:"?",final:"K"},(R=>this.eraseInLine(R,!0))),this._parser.registerCsiHandler({final:"L"},(R=>this.insertLines(R))),this._parser.registerCsiHandler({final:"M"},(R=>this.deleteLines(R))),this._parser.registerCsiHandler({final:"P"},(R=>this.deleteChars(R))),this._parser.registerCsiHandler({final:"S"},(R=>this.scrollUp(R))),this._parser.registerCsiHandler({final:"T"},(R=>this.scrollDown(R))),this._parser.registerCsiHandler({final:"X"},(R=>this.eraseChars(R))),this._parser.registerCsiHandler({final:"Z"},(R=>this.cursorBackwardTab(R))),this._parser.registerCsiHandler({final:"`"},(R=>this.charPosAbsolute(R))),this._parser.registerCsiHandler({final:"a"},(R=>this.hPositionRelative(R))),this._parser.registerCsiHandler({final:"b"},(R=>this.repeatPrecedingCharacter(R))),this._parser.registerCsiHandler({final:"c"},(R=>this.sendDeviceAttributesPrimary(R))),this._parser.registerCsiHandler({prefix:">",final:"c"},(R=>this.sendDeviceAttributesSecondary(R))),this._parser.registerCsiHandler({final:"d"},(R=>this.linePosAbsolute(R))),this._parser.registerCsiHandler({final:"e"},(R=>this.vPositionRelative(R))),this._parser.registerCsiHandler({final:"f"},(R=>this.hVPosition(R))),this._parser.registerCsiHandler({final:"g"},(R=>this.tabClear(R))),this._parser.registerCsiHandler({final:"h"},(R=>this.setMode(R))),this._parser.registerCsiHandler({prefix:"?",final:"h"},(R=>this.setModePrivate(R))),this._parser.registerCsiHandler({final:"l"},(R=>this.resetMode(R))),this._parser.registerCsiHandler({prefix:"?",final:"l"},(R=>this.resetModePrivate(R))),this._parser.registerCsiHandler({final:"m"},(R=>this.charAttributes(R))),this._parser.registerCsiHandler({final:"n"},(R=>this.deviceStatus(R))),this._parser.registerCsiHandler({prefix:"?",final:"n"},(R=>this.deviceStatusPrivate(R))),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(R=>this.softReset(R))),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(R=>this.setCursorStyle(R))),this._parser.registerCsiHandler({final:"r"},(R=>this.setScrollRegion(R))),this._parser.registerCsiHandler({final:"s"},(R=>this.saveCursor(R))),this._parser.registerCsiHandler({final:"t"},(R=>this.windowOptions(R))),this._parser.registerCsiHandler({final:"u"},(R=>this.restoreCursor(R))),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(R=>this.insertColumns(R))),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(R=>this.deleteColumns(R))),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(R=>this.selectProtected(R))),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(R=>this.requestMode(R,!0))),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(R=>this.requestMode(R,!1))),this._parser.setExecuteHandler(u.C0.BEL,(()=>this.bell())),this._parser.setExecuteHandler(u.C0.LF,(()=>this.lineFeed())),this._parser.setExecuteHandler(u.C0.VT,(()=>this.lineFeed())),this._parser.setExecuteHandler(u.C0.FF,(()=>this.lineFeed())),this._parser.setExecuteHandler(u.C0.CR,(()=>this.carriageReturn())),this._parser.setExecuteHandler(u.C0.BS,(()=>this.backspace())),this._parser.setExecuteHandler(u.C0.HT,(()=>this.tab())),this._parser.setExecuteHandler(u.C0.SO,(()=>this.shiftOut())),this._parser.setExecuteHandler(u.C0.SI,(()=>this.shiftIn())),this._parser.setExecuteHandler(u.C1.IND,(()=>this.index())),this._parser.setExecuteHandler(u.C1.NEL,(()=>this.nextLine())),this._parser.setExecuteHandler(u.C1.HTS,(()=>this.tabSet())),this._parser.registerOscHandler(0,new C.OscHandler((R=>(this.setTitle(R),this.setIconName(R),!0)))),this._parser.registerOscHandler(1,new C.OscHandler((R=>this.setIconName(R)))),this._parser.registerOscHandler(2,new C.OscHandler((R=>this.setTitle(R)))),this._parser.registerOscHandler(4,new C.OscHandler((R=>this.setOrReportIndexedColor(R)))),this._parser.registerOscHandler(8,new C.OscHandler((R=>this.setHyperlink(R)))),this._parser.registerOscHandler(10,new C.OscHandler((R=>this.setOrReportFgColor(R)))),this._parser.registerOscHandler(11,new C.OscHandler((R=>this.setOrReportBgColor(R)))),this._parser.registerOscHandler(12,new C.OscHandler((R=>this.setOrReportCursorColor(R)))),this._parser.registerOscHandler(104,new C.OscHandler((R=>this.restoreIndexedColor(R)))),this._parser.registerOscHandler(110,new C.OscHandler((R=>this.restoreFgColor(R)))),this._parser.registerOscHandler(111,new C.OscHandler((R=>this.restoreBgColor(R)))),this._parser.registerOscHandler(112,new C.OscHandler((R=>this.restoreCursorColor(R)))),this._parser.registerEscHandler({final:"7"},(()=>this.saveCursor())),this._parser.registerEscHandler({final:"8"},(()=>this.restoreCursor())),this._parser.registerEscHandler({final:"D"},(()=>this.index())),this._parser.registerEscHandler({final:"E"},(()=>this.nextLine())),this._parser.registerEscHandler({final:"H"},(()=>this.tabSet())),this._parser.registerEscHandler({final:"M"},(()=>this.reverseIndex())),this._parser.registerEscHandler({final:"="},(()=>this.keypadApplicationMode())),this._parser.registerEscHandler({final:">"},(()=>this.keypadNumericMode())),this._parser.registerEscHandler({final:"c"},(()=>this.fullReset())),this._parser.registerEscHandler({final:"n"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"o"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"|"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"}"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"~"},(()=>this.setgLevel(1))),this._parser.registerEscHandler({intermediates:"%",final:"@"},(()=>this.selectDefaultCharset())),this._parser.registerEscHandler({intermediates:"%",final:"G"},(()=>this.selectDefaultCharset()));for(const R in f.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:R},(()=>this.selectCharset("("+R))),this._parser.registerEscHandler({intermediates:")",final:R},(()=>this.selectCharset(")"+R))),this._parser.registerEscHandler({intermediates:"*",final:R},(()=>this.selectCharset("*"+R))),this._parser.registerEscHandler({intermediates:"+",final:R},(()=>this.selectCharset("+"+R))),this._parser.registerEscHandler({intermediates:"-",final:R},(()=>this.selectCharset("-"+R))),this._parser.registerEscHandler({intermediates:".",final:R},(()=>this.selectCharset("."+R))),this._parser.registerEscHandler({intermediates:"/",final:R},(()=>this.selectCharset("/"+R)));this._parser.registerEscHandler({intermediates:"#",final:"8"},(()=>this.screenAlignmentPattern())),this._parser.setErrorHandler((R=>(this._logService.error("Parsing error: ",R),R))),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new w.DcsHandler(((R,K)=>this.requestStatusString(R,K))))}_preserveStack(L,k,I,H){this._parseStack.paused=!0,this._parseStack.cursorStartX=L,this._parseStack.cursorStartY=k,this._parseStack.decodedLength=I,this._parseStack.position=H}_logSlowResolvingAsync(L){this._logService.logLevel<=S.LogLevelEnum.WARN&&Promise.race([L,new Promise(((k,I)=>setTimeout((()=>I("#SLOW_TIMEOUT")),5e3)))]).catch((k=>{if(k!=="#SLOW_TIMEOUT")throw k;console.warn("async parser handler taking longer than 5000 ms")}))}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(L,k){let I,H=this._activeBuffer.x,P=this._activeBuffer.y,X=0;const ee=this._parseStack.paused;if(ee){if(I=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,k))return this._logSlowResolvingAsync(I),I;H=this._parseStack.cursorStartX,P=this._parseStack.cursorStartY,this._parseStack.paused=!1,L.length>M&&(X=this._parseStack.position+M)}if(this._logService.logLevel<=S.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof L=="string"?` "${L}"`:` "${Array.prototype.map.call(L,(R=>String.fromCharCode(R))).join("")}"`),typeof L=="string"?L.split("").map((R=>R.charCodeAt(0))):L),this._parseBuffer.length<L.length&&this._parseBuffer.length<M&&(this._parseBuffer=new Uint32Array(Math.min(L.length,M))),ee||this._dirtyRowTracker.clearRange(),L.length>M)for(let R=X;R<L.length;R+=M){const K=R+M<L.length?R+M:L.length,W=typeof L=="string"?this._stringDecoder.decode(L.substring(R,K),this._parseBuffer):this._utf8Decoder.decode(L.subarray(R,K),this._parseBuffer);if(I=this._parser.parse(this._parseBuffer,W))return this._preserveStack(H,P,W,R),this._logSlowResolvingAsync(I),I}else if(!ee){const R=typeof L=="string"?this._stringDecoder.decode(L,this._parseBuffer):this._utf8Decoder.decode(L,this._parseBuffer);if(I=this._parser.parse(this._parseBuffer,R))return this._preserveStack(H,P,R,0),this._logSlowResolvingAsync(I),I}this._activeBuffer.x===H&&this._activeBuffer.y===P||this._onCursorMove.fire();const re=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),O=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);O<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(O,this._bufferService.rows-1),Math.min(re,this._bufferService.rows-1))}print(L,k,I){let H,P;const X=this._charsetService.charset,ee=this._optionsService.rawOptions.screenReaderMode,re=this._bufferService.cols,O=this._coreService.decPrivateModes.wraparound,R=this._coreService.modes.insertMode,K=this._curAttrData;let W=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&I-k>0&&W.getWidth(this._activeBuffer.x-1)===2&&W.setCellFromCodepoint(this._activeBuffer.x-1,0,1,K);let Q=this._parser.precedingJoinState;for(let Y=k;Y<I;++Y){if(H=L[Y],H<127&&X){const Ue=X[String.fromCharCode(H)];Ue&&(H=Ue.charCodeAt(0))}const ge=this._unicodeService.charProperties(H,Q);P=x.UnicodeService.extractWidth(ge);const Be=x.UnicodeService.extractShouldJoin(ge),Le=Be?x.UnicodeService.extractWidth(Q):0;if(Q=ge,ee&&this._onA11yChar.fire((0,_.stringFromCodePoint)(H)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+P-Le>re){if(O){const Ue=W;let ce=this._activeBuffer.x-Le;for(this._activeBuffer.x=Le,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),W=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),Le>0&&W instanceof m.BufferLine&&W.copyCellsFrom(Ue,ce,0,Le,!1);ce<re;)Ue.setCellFromCodepoint(ce++,0,1,K)}else if(this._activeBuffer.x=re-1,P===2)continue}if(Be&&this._activeBuffer.x){const Ue=W.getWidth(this._activeBuffer.x-1)?1:2;W.addCodepointToCell(this._activeBuffer.x-Ue,H,P);for(let ce=P-Le;--ce>=0;)W.setCellFromCodepoint(this._activeBuffer.x++,0,0,K)}else if(R&&(W.insertCells(this._activeBuffer.x,P-Le,this._activeBuffer.getNullCell(K)),W.getWidth(re-1)===2&&W.setCellFromCodepoint(re-1,g.NULL_CELL_CODE,g.NULL_CELL_WIDTH,K)),W.setCellFromCodepoint(this._activeBuffer.x++,H,P,K),P>0)for(;--P;)W.setCellFromCodepoint(this._activeBuffer.x++,0,0,K)}this._parser.precedingJoinState=Q,this._activeBuffer.x<re&&I-k>0&&W.getWidth(this._activeBuffer.x)===0&&!W.hasContent(this._activeBuffer.x)&&W.setCellFromCodepoint(this._activeBuffer.x,0,1,K),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(L,k){return L.final!=="t"||L.prefix||L.intermediates?this._parser.registerCsiHandler(L,k):this._parser.registerCsiHandler(L,(I=>!T(I.params[0],this._optionsService.rawOptions.windowOptions)||k(I)))}registerDcsHandler(L,k){return this._parser.registerDcsHandler(L,new w.DcsHandler(k))}registerEscHandler(L,k){return this._parser.registerEscHandler(L,k)}registerOscHandler(L,k){return this._parser.registerOscHandler(L,new C.OscHandler(k))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var L;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&((L=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))!=null&&L.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const k=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);k.hasWidth(this._activeBuffer.x)&&!k.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const L=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-L),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(L=this._bufferService.cols-1){this._activeBuffer.x=Math.min(L,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(L,k){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=L,this._activeBuffer.y=this._activeBuffer.scrollTop+k):(this._activeBuffer.x=L,this._activeBuffer.y=k),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(L,k){this._restrictCursor(),this._setCursor(this._activeBuffer.x+L,this._activeBuffer.y+k)}cursorUp(L){const k=this._activeBuffer.y-this._activeBuffer.scrollTop;return k>=0?this._moveCursor(0,-Math.min(k,L.params[0]||1)):this._moveCursor(0,-(L.params[0]||1)),!0}cursorDown(L){const k=this._activeBuffer.scrollBottom-this._activeBuffer.y;return k>=0?this._moveCursor(0,Math.min(k,L.params[0]||1)):this._moveCursor(0,L.params[0]||1),!0}cursorForward(L){return this._moveCursor(L.params[0]||1,0),!0}cursorBackward(L){return this._moveCursor(-(L.params[0]||1),0),!0}cursorNextLine(L){return this.cursorDown(L),this._activeBuffer.x=0,!0}cursorPrecedingLine(L){return this.cursorUp(L),this._activeBuffer.x=0,!0}cursorCharAbsolute(L){return this._setCursor((L.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(L){return this._setCursor(L.length>=2?(L.params[1]||1)-1:0,(L.params[0]||1)-1),!0}charPosAbsolute(L){return this._setCursor((L.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(L){return this._moveCursor(L.params[0]||1,0),!0}linePosAbsolute(L){return this._setCursor(this._activeBuffer.x,(L.params[0]||1)-1),!0}vPositionRelative(L){return this._moveCursor(0,L.params[0]||1),!0}hVPosition(L){return this.cursorPosition(L),!0}tabClear(L){const k=L.params[0];return k===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:k===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(L){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let k=L.params[0]||1;for(;k--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(L){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let k=L.params[0]||1;for(;k--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(L){const k=L.params[0];return k===1&&(this._curAttrData.bg|=536870912),k!==2&&k!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(L,k,I,H=!1,P=!1){const X=this._activeBuffer.lines.get(this._activeBuffer.ybase+L);X.replaceCells(k,I,this._activeBuffer.getNullCell(this._eraseAttrData()),P),H&&(X.isWrapped=!1)}_resetBufferLine(L,k=!1){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+L);I&&(I.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),k),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+L),I.isWrapped=!1)}eraseInDisplay(L,k=!1){let I;switch(this._restrictCursor(this._bufferService.cols),L.params[0]){case 0:for(I=this._activeBuffer.y,this._dirtyRowTracker.markDirty(I),this._eraseInBufferLine(I++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,k);I<this._bufferService.rows;I++)this._resetBufferLine(I,k);this._dirtyRowTracker.markDirty(I);break;case 1:for(I=this._activeBuffer.y,this._dirtyRowTracker.markDirty(I),this._eraseInBufferLine(I,0,this._activeBuffer.x+1,!0,k),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(I+1).isWrapped=!1);I--;)this._resetBufferLine(I,k);this._dirtyRowTracker.markDirty(0);break;case 2:for(I=this._bufferService.rows,this._dirtyRowTracker.markDirty(I-1);I--;)this._resetBufferLine(I,k);this._dirtyRowTracker.markDirty(0);break;case 3:const H=this._activeBuffer.lines.length-this._bufferService.rows;H>0&&(this._activeBuffer.lines.trimStart(H),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-H,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-H,0),this._onScroll.fire(0))}return!0}eraseInLine(L,k=!1){switch(this._restrictCursor(this._bufferService.cols),L.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,k);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,k);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,k)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(L){this._restrictCursor();let k=L.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const I=this._activeBuffer.ybase+this._activeBuffer.y,H=this._bufferService.rows-1-this._activeBuffer.scrollBottom,P=this._bufferService.rows-1+this._activeBuffer.ybase-H+1;for(;k--;)this._activeBuffer.lines.splice(P-1,1),this._activeBuffer.lines.splice(I,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(L){this._restrictCursor();let k=L.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const I=this._activeBuffer.ybase+this._activeBuffer.y;let H;for(H=this._bufferService.rows-1-this._activeBuffer.scrollBottom,H=this._bufferService.rows-1+this._activeBuffer.ybase-H;k--;)this._activeBuffer.lines.splice(I,1),this._activeBuffer.lines.splice(H,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(L){this._restrictCursor();const k=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return k&&(k.insertCells(this._activeBuffer.x,L.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(L){this._restrictCursor();const k=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return k&&(k.deleteCells(this._activeBuffer.x,L.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(L){let k=L.params[0]||1;for(;k--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(L){let k=L.params[0]||1;for(;k--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(m.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(L){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const k=L.params[0]||1;for(let I=this._activeBuffer.scrollTop;I<=this._activeBuffer.scrollBottom;++I){const H=this._activeBuffer.lines.get(this._activeBuffer.ybase+I);H.deleteCells(0,k,this._activeBuffer.getNullCell(this._eraseAttrData())),H.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(L){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const k=L.params[0]||1;for(let I=this._activeBuffer.scrollTop;I<=this._activeBuffer.scrollBottom;++I){const H=this._activeBuffer.lines.get(this._activeBuffer.ybase+I);H.insertCells(0,k,this._activeBuffer.getNullCell(this._eraseAttrData())),H.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(L){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const k=L.params[0]||1;for(let I=this._activeBuffer.scrollTop;I<=this._activeBuffer.scrollBottom;++I){const H=this._activeBuffer.lines.get(this._activeBuffer.ybase+I);H.insertCells(this._activeBuffer.x,k,this._activeBuffer.getNullCell(this._eraseAttrData())),H.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(L){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const k=L.params[0]||1;for(let I=this._activeBuffer.scrollTop;I<=this._activeBuffer.scrollBottom;++I){const H=this._activeBuffer.lines.get(this._activeBuffer.ybase+I);H.deleteCells(this._activeBuffer.x,k,this._activeBuffer.getNullCell(this._eraseAttrData())),H.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(L){this._restrictCursor();const k=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return k&&(k.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(L.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(L){const k=this._parser.precedingJoinState;if(!k)return!0;const I=L.params[0]||1,H=x.UnicodeService.extractWidth(k),P=this._activeBuffer.x-H,X=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(P),ee=new Uint32Array(X.length*I);let re=0;for(let R=0;R<X.length;){const K=X.codePointAt(R)||0;ee[re++]=K,R+=K>65535?2:1}let O=re;for(let R=1;R<I;++R)ee.copyWithin(O,0,re),O+=re;return this.print(ee,0,O),!0}sendDeviceAttributesPrimary(L){return L.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(u.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(u.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(L){return L.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(u.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(u.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(L.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(u.C0.ESC+"[>83;40003;0c")),!0}_is(L){return(this._optionsService.rawOptions.termName+"").indexOf(L)===0}setMode(L){for(let k=0;k<L.length;k++)switch(L.params[k]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(L){for(let k=0;k<L.length;k++)switch(L.params[k]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,f.DEFAULT_CHARSET),this._charsetService.setgCharset(1,f.DEFAULT_CHARSET),this._charsetService.setgCharset(2,f.DEFAULT_CHARSET),this._charsetService.setgCharset(3,f.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(L){for(let k=0;k<L.length;k++)switch(L.params[k]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(L){for(let k=0;k<L.length;k++)switch(L.params[k]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),L.params[k]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(L,k){const I=this._coreService.decPrivateModes,{activeProtocol:H,activeEncoding:P}=this._coreMouseService,X=this._coreService,{buffers:ee,cols:re}=this._bufferService,{active:O,alt:R}=ee,K=this._optionsService.rawOptions,W=Be=>Be?1:2,Q=L.params[0];return Y=Q,ge=k?Q===2?4:Q===4?W(X.modes.insertMode):Q===12?3:Q===20?W(K.convertEol):0:Q===1?W(I.applicationCursorKeys):Q===3?K.windowOptions.setWinLines?re===80?2:re===132?1:0:0:Q===6?W(I.origin):Q===7?W(I.wraparound):Q===8?3:Q===9?W(H==="X10"):Q===12?W(K.cursorBlink):Q===25?W(!X.isCursorHidden):Q===45?W(I.reverseWraparound):Q===66?W(I.applicationKeypad):Q===67?4:Q===1e3?W(H==="VT200"):Q===1002?W(H==="DRAG"):Q===1003?W(H==="ANY"):Q===1004?W(I.sendFocus):Q===1005?4:Q===1006?W(P==="SGR"):Q===1015?4:Q===1016?W(P==="SGR_PIXELS"):Q===1048?1:Q===47||Q===1047||Q===1049?W(O===R):Q===2004?W(I.bracketedPasteMode):0,X.triggerDataEvent(`${u.C0.ESC}[${k?"":"?"}${Y};${ge}$y`),!0;var Y,ge}_updateAttrColor(L,k,I,H,P){return k===2?(L|=50331648,L&=-16777216,L|=b.AttributeData.fromColorRGB([I,H,P])):k===5&&(L&=-50331904,L|=33554432|255&I),L}_extractColor(L,k,I){const H=[0,0,-1,0,0,0];let P=0,X=0;do{if(H[X+P]=L.params[k+X],L.hasSubParams(k+X)){const ee=L.getSubParams(k+X);let re=0;do H[1]===5&&(P=1),H[X+re+1+P]=ee[re];while(++re<ee.length&&re+X+1+P<H.length);break}if(H[1]===5&&X+P>=2||H[1]===2&&X+P>=5)break;H[1]&&(P=1)}while(++X+k<L.length&&X+P<H.length);for(let ee=2;ee<H.length;++ee)H[ee]===-1&&(H[ee]=0);switch(H[0]){case 38:I.fg=this._updateAttrColor(I.fg,H[1],H[3],H[4],H[5]);break;case 48:I.bg=this._updateAttrColor(I.bg,H[1],H[3],H[4],H[5]);break;case 58:I.extended=I.extended.clone(),I.extended.underlineColor=this._updateAttrColor(I.extended.underlineColor,H[1],H[3],H[4],H[5])}return X}_processUnderline(L,k){k.extended=k.extended.clone(),(!~L||L>5)&&(L=1),k.extended.underlineStyle=L,k.fg|=268435456,L===0&&(k.fg&=-268435457),k.updateExtended()}_processSGR0(L){L.fg=m.DEFAULT_ATTR_DATA.fg,L.bg=m.DEFAULT_ATTR_DATA.bg,L.extended=L.extended.clone(),L.extended.underlineStyle=0,L.extended.underlineColor&=-67108864,L.updateExtended()}charAttributes(L){if(L.length===1&&L.params[0]===0)return this._processSGR0(this._curAttrData),!0;const k=L.length;let I;const H=this._curAttrData;for(let P=0;P<k;P++)I=L.params[P],I>=30&&I<=37?(H.fg&=-50331904,H.fg|=16777216|I-30):I>=40&&I<=47?(H.bg&=-50331904,H.bg|=16777216|I-40):I>=90&&I<=97?(H.fg&=-50331904,H.fg|=16777224|I-90):I>=100&&I<=107?(H.bg&=-50331904,H.bg|=16777224|I-100):I===0?this._processSGR0(H):I===1?H.fg|=134217728:I===3?H.bg|=67108864:I===4?(H.fg|=268435456,this._processUnderline(L.hasSubParams(P)?L.getSubParams(P)[0]:1,H)):I===5?H.fg|=536870912:I===7?H.fg|=67108864:I===8?H.fg|=1073741824:I===9?H.fg|=2147483648:I===2?H.bg|=134217728:I===21?this._processUnderline(2,H):I===22?(H.fg&=-134217729,H.bg&=-134217729):I===23?H.bg&=-67108865:I===24?(H.fg&=-268435457,this._processUnderline(0,H)):I===25?H.fg&=-536870913:I===27?H.fg&=-67108865:I===28?H.fg&=-1073741825:I===29?H.fg&=2147483647:I===39?(H.fg&=-67108864,H.fg|=16777215&m.DEFAULT_ATTR_DATA.fg):I===49?(H.bg&=-67108864,H.bg|=16777215&m.DEFAULT_ATTR_DATA.bg):I===38||I===48||I===58?P+=this._extractColor(L,P,H):I===53?H.bg|=1073741824:I===55?H.bg&=-1073741825:I===59?(H.extended=H.extended.clone(),H.extended.underlineColor=-1,H.updateExtended()):I===100?(H.fg&=-67108864,H.fg|=16777215&m.DEFAULT_ATTR_DATA.fg,H.bg&=-67108864,H.bg|=16777215&m.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",I);return!0}deviceStatus(L){switch(L.params[0]){case 5:this._coreService.triggerDataEvent(`${u.C0.ESC}[0n`);break;case 6:const k=this._activeBuffer.y+1,I=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${u.C0.ESC}[${k};${I}R`)}return!0}deviceStatusPrivate(L){if(L.params[0]===6){const k=this._activeBuffer.y+1,I=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${u.C0.ESC}[?${k};${I}R`)}return!0}softReset(L){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=m.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(L){const k=L.params[0]||1;switch(k){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const I=k%2==1;return this._optionsService.options.cursorBlink=I,!0}setScrollRegion(L){const k=L.params[0]||1;let I;return(L.length<2||(I=L.params[1])>this._bufferService.rows||I===0)&&(I=this._bufferService.rows),I>k&&(this._activeBuffer.scrollTop=k-1,this._activeBuffer.scrollBottom=I-1,this._setCursor(0,0)),!0}windowOptions(L){if(!T(L.params[0],this._optionsService.rawOptions.windowOptions))return!0;const k=L.length>1?L.params[1]:0;switch(L.params[0]){case 14:k!==2&&this._onRequestWindowsOptionsReport.fire(B.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(B.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${u.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:k!==0&&k!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),k!==0&&k!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:k!==0&&k!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),k!==0&&k!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(L){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(L){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(L){return this._windowTitle=L,this._onTitleChange.fire(L),!0}setIconName(L){return this._iconName=L,!0}setOrReportIndexedColor(L){const k=[],I=L.split(";");for(;I.length>1;){const H=I.shift(),P=I.shift();if(/^\d+$/.exec(H)){const X=parseInt(H);if($(X))if(P==="?")k.push({type:0,index:X});else{const ee=(0,E.parseColor)(P);ee&&k.push({type:1,index:X,color:ee})}}}return k.length&&this._onColor.fire(k),!0}setHyperlink(L){const k=L.split(";");return!(k.length<2)&&(k[1]?this._createHyperlink(k[0],k[1]):!k[0]&&this._finishHyperlink())}_createHyperlink(L,k){this._getCurrentLinkId()&&this._finishHyperlink();const I=L.split(":");let H;const P=I.findIndex((X=>X.startsWith("id=")));return P!==-1&&(H=I[P].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:H,uri:k}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(L,k){const I=L.split(";");for(let H=0;H<I.length&&!(k>=this._specialColors.length);++H,++k)if(I[H]==="?")this._onColor.fire([{type:0,index:this._specialColors[k]}]);else{const P=(0,E.parseColor)(I[H]);P&&this._onColor.fire([{type:1,index:this._specialColors[k],color:P}])}return!0}setOrReportFgColor(L){return this._setOrReportSpecialColor(L,0)}setOrReportBgColor(L){return this._setOrReportSpecialColor(L,1)}setOrReportCursorColor(L){return this._setOrReportSpecialColor(L,2)}restoreIndexedColor(L){if(!L)return this._onColor.fire([{type:2}]),!0;const k=[],I=L.split(";");for(let H=0;H<I.length;++H)if(/^\d+$/.exec(I[H])){const P=parseInt(I[H]);$(P)&&k.push({type:2,index:P})}return k.length&&this._onColor.fire(k),!0}restoreFgColor(L){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(L){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(L){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,f.DEFAULT_CHARSET),!0}selectCharset(L){return L.length!==2?(this.selectDefaultCharset(),!0):(L[0]==="/"||this._charsetService.setgCharset(A[L[0]],f.CHARSETS[L[1]]||f.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const L=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,L,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=m.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=m.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(L){return this._charsetService.setgLevel(L),!0}screenAlignmentPattern(){const L=new v.CellData;L.content=4194373,L.fg=this._curAttrData.fg,L.bg=this._curAttrData.bg,this._setCursor(0,0);for(let k=0;k<this._bufferService.rows;++k){const I=this._activeBuffer.ybase+this._activeBuffer.y+k,H=this._activeBuffer.lines.get(I);H&&(H.fill(L),H.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(L,k){const I=this._bufferService.buffer,H=this._optionsService.rawOptions;return(P=>(this._coreService.triggerDataEvent(`${u.C0.ESC}${P}${u.C0.ESC}\\`),!0))(L==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:L==='"p'?'P1$r61;1"p':L==="r"?`P1$r${I.scrollTop+1};${I.scrollBottom+1}r`:L==="m"?"P1$r0m":L===" q"?`P1$r${{block:2,underline:4,bar:6}[H.cursorStyle]-(H.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(L,k){this._dirtyRowTracker.markRangeDirty(L,k)}}o.InputHandler=j;let z=class{constructor(V){this._bufferService=V,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(V){V<this.start?this.start=V:V>this.end&&(this.end=V)}markRangeDirty(V,L){V>L&&(F=V,V=L,L=F),V<this.start&&(this.start=V),L>this.end&&(this.end=L)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function $(V){return 0<=V&&V<256}z=c([h(0,S.IBufferService)],z)},844:(l,o)=>{function a(c){for(const h of c)h.dispose();c.length=0}Object.defineProperty(o,"__esModule",{value:!0}),o.getDisposeArrayDisposable=o.disposeArray=o.toDisposable=o.MutableDisposable=o.Disposable=void 0,o.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const c of this._disposables)c.dispose();this._disposables.length=0}register(c){return this._disposables.push(c),c}unregister(c){const h=this._disposables.indexOf(c);h!==-1&&this._disposables.splice(h,1)}},o.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(c){var h;this._isDisposed||c===this._value||((h=this._value)==null||h.dispose(),this._value=c)}clear(){this.value=void 0}dispose(){var c;this._isDisposed=!0,(c=this._value)==null||c.dispose(),this._value=void 0}},o.toDisposable=function(c){return{dispose:c}},o.disposeArray=a,o.getDisposeArrayDisposable=function(c){return{dispose:()=>a(c)}}},1505:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.FourKeyMap=o.TwoKeyMap=void 0;class a{constructor(){this._data={}}set(h,u,f){this._data[h]||(this._data[h]={}),this._data[h][u]=f}get(h,u){return this._data[h]?this._data[h][u]:void 0}clear(){this._data={}}}o.TwoKeyMap=a,o.FourKeyMap=class{constructor(){this._data=new a}set(c,h,u,f,d){this._data.get(c,h)||this._data.set(c,h,new a),this._data.get(c,h).set(u,f,d)}get(c,h,u,f){var d;return(d=this._data.get(c,h))==null?void 0:d.get(u,f)}clear(){this._data.clear()}}},6114:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.isChromeOS=o.isLinux=o.isWindows=o.isIphone=o.isIpad=o.isMac=o.getSafariVersion=o.isSafari=o.isLegacyEdge=o.isFirefox=o.isNode=void 0,o.isNode=typeof process<"u"&&"title"in process;const a=o.isNode?"node":navigator.userAgent,c=o.isNode?"node":navigator.platform;o.isFirefox=a.includes("Firefox"),o.isLegacyEdge=a.includes("Edge"),o.isSafari=/^((?!chrome|android).)*safari/i.test(a),o.getSafariVersion=function(){if(!o.isSafari)return 0;const h=a.match(/Version\/(\d+)/);return h===null||h.length<2?0:parseInt(h[1])},o.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(c),o.isIpad=c==="iPad",o.isIphone=c==="iPhone",o.isWindows=["Windows","Win16","Win32","WinCE"].includes(c),o.isLinux=c.indexOf("Linux")>=0,o.isChromeOS=/\bCrOS\b/.test(a)},6106:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.SortedList=void 0;let a=0;o.SortedList=class{constructor(c){this._getKey=c,this._array=[]}clear(){this._array.length=0}insert(c){this._array.length!==0?(a=this._search(this._getKey(c)),this._array.splice(a,0,c)):this._array.push(c)}delete(c){if(this._array.length===0)return!1;const h=this._getKey(c);if(h===void 0||(a=this._search(h),a===-1)||this._getKey(this._array[a])!==h)return!1;do if(this._array[a]===c)return this._array.splice(a,1),!0;while(++a<this._array.length&&this._getKey(this._array[a])===h);return!1}*getKeyIterator(c){if(this._array.length!==0&&(a=this._search(c),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===c))do yield this._array[a];while(++a<this._array.length&&this._getKey(this._array[a])===c)}forEachByKey(c,h){if(this._array.length!==0&&(a=this._search(c),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===c))do h(this._array[a]);while(++a<this._array.length&&this._getKey(this._array[a])===c)}values(){return[...this._array].values()}_search(c){let h=0,u=this._array.length-1;for(;u>=h;){let f=h+u>>1;const d=this._getKey(this._array[f]);if(d>c)u=f-1;else{if(!(d<c)){for(;f>0&&this._getKey(this._array[f-1])===c;)f--;return f}h=f+1}}return h}}},7226:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DebouncedIdleTask=o.IdleTaskQueue=o.PriorityTaskQueue=void 0;const c=a(6114);class h{constructor(){this._tasks=[],this._i=0}enqueue(d){this._tasks.push(d),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(d){this._idleCallback=void 0;let y=0,_=0,m=d.timeRemaining(),p=0;for(;this._i<this._tasks.length;){if(y=Date.now(),this._tasks[this._i]()||this._i++,y=Math.max(1,Date.now()-y),_=Math.max(y,_),p=d.timeRemaining(),1.5*_>p)return m-y<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(m-y))}ms`),void this._start();m=p}this.clear()}}class u extends h{_requestCallback(d){return setTimeout((()=>d(this._createDeadline(16))))}_cancelCallback(d){clearTimeout(d)}_createDeadline(d){const y=Date.now()+d;return{timeRemaining:()=>Math.max(0,y-Date.now())}}}o.PriorityTaskQueue=u,o.IdleTaskQueue=!c.isNode&&"requestIdleCallback"in window?class extends h{_requestCallback(f){return requestIdleCallback(f)}_cancelCallback(f){cancelIdleCallback(f)}}:u,o.DebouncedIdleTask=class{constructor(){this._queue=new o.IdleTaskQueue}set(f){this._queue.clear(),this._queue.enqueue(f)}flush(){this._queue.flush()}}},9282:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.updateWindowsModeWrappedState=void 0;const c=a(643);o.updateWindowsModeWrappedState=function(h){const u=h.buffer.lines.get(h.buffer.ybase+h.buffer.y-1),f=u==null?void 0:u.get(h.cols-1),d=h.buffer.lines.get(h.buffer.ybase+h.buffer.y);d&&f&&(d.isWrapped=f[c.CHAR_DATA_CODE_INDEX]!==c.NULL_CELL_CODE&&f[c.CHAR_DATA_CODE_INDEX]!==c.WHITESPACE_CELL_CODE)}},3734:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ExtendedAttrs=o.AttributeData=void 0;class a{constructor(){this.fg=0,this.bg=0,this.extended=new c}static toColorRGB(u){return[u>>>16&255,u>>>8&255,255&u]}static fromColorRGB(u){return(255&u[0])<<16|(255&u[1])<<8|255&u[2]}clone(){const u=new a;return u.fg=this.fg,u.bg=this.bg,u.extended=this.extended.clone(),u}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}o.AttributeData=a;class c{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(u){this._ext=u}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(u){this._ext&=-469762049,this._ext|=u<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(u){this._ext&=-67108864,this._ext|=67108863&u}get urlId(){return this._urlId}set urlId(u){this._urlId=u}get underlineVariantOffset(){const u=(3758096384&this._ext)>>29;return u<0?4294967288^u:u}set underlineVariantOffset(u){this._ext&=536870911,this._ext|=u<<29&3758096384}constructor(u=0,f=0){this._ext=0,this._urlId=0,this._ext=u,this._urlId=f}clone(){return new c(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}o.ExtendedAttrs=c},9092:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Buffer=o.MAX_BUFFER_SIZE=void 0;const c=a(6349),h=a(7226),u=a(3734),f=a(8437),d=a(4634),y=a(511),_=a(643),m=a(4863),p=a(7116);o.MAX_BUFFER_SIZE=4294967295,o.Buffer=class{constructor(g,v,b){this._hasScrollback=g,this._optionsService=v,this._bufferService=b,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=f.DEFAULT_ATTR_DATA.clone(),this.savedCharset=p.DEFAULT_CHARSET,this.markers=[],this._nullCell=y.CellData.fromCharData([0,_.NULL_CELL_CHAR,_.NULL_CELL_WIDTH,_.NULL_CELL_CODE]),this._whitespaceCell=y.CellData.fromCharData([0,_.WHITESPACE_CELL_CHAR,_.WHITESPACE_CELL_WIDTH,_.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new h.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new c.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(g){return g?(this._nullCell.fg=g.fg,this._nullCell.bg=g.bg,this._nullCell.extended=g.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new u.ExtendedAttrs),this._nullCell}getWhitespaceCell(g){return g?(this._whitespaceCell.fg=g.fg,this._whitespaceCell.bg=g.bg,this._whitespaceCell.extended=g.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new u.ExtendedAttrs),this._whitespaceCell}getBlankLine(g,v){return new f.BufferLine(this._bufferService.cols,this.getNullCell(g),v)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const g=this.ybase+this.y-this.ydisp;return g>=0&&g<this._rows}_getCorrectBufferLength(g){if(!this._hasScrollback)return g;const v=g+this._optionsService.rawOptions.scrollback;return v>o.MAX_BUFFER_SIZE?o.MAX_BUFFER_SIZE:v}fillViewportRows(g){if(this.lines.length===0){g===void 0&&(g=f.DEFAULT_ATTR_DATA);let v=this._rows;for(;v--;)this.lines.push(this.getBlankLine(g))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new c.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(g,v){const b=this.getNullCell(f.DEFAULT_ATTR_DATA);let S=0;const x=this._getCorrectBufferLength(v);if(x>this.lines.maxLength&&(this.lines.maxLength=x),this.lines.length>0){if(this._cols<g)for(let w=0;w<this.lines.length;w++)S+=+this.lines.get(w).resize(g,b);let C=0;if(this._rows<v)for(let w=this._rows;w<v;w++)this.lines.length<v+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new f.BufferLine(g,b)):this.ybase>0&&this.lines.length<=this.ybase+this.y+C+1?(this.ybase--,C++,this.ydisp>0&&this.ydisp--):this.lines.push(new f.BufferLine(g,b)));else for(let w=this._rows;w>v;w--)this.lines.length>v+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(x<this.lines.maxLength){const w=this.lines.length-x;w>0&&(this.lines.trimStart(w),this.ybase=Math.max(this.ybase-w,0),this.ydisp=Math.max(this.ydisp-w,0),this.savedY=Math.max(this.savedY-w,0)),this.lines.maxLength=x}this.x=Math.min(this.x,g-1),this.y=Math.min(this.y,v-1),C&&(this.y+=C),this.savedX=Math.min(this.savedX,g-1),this.scrollTop=0}if(this.scrollBottom=v-1,this._isReflowEnabled&&(this._reflow(g,v),this._cols>g))for(let C=0;C<this.lines.length;C++)S+=+this.lines.get(C).resize(g,b);this._cols=g,this._rows=v,this._memoryCleanupQueue.clear(),S>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue((()=>this._batchedMemoryCleanup())))}_batchedMemoryCleanup(){let g=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,g=!1);let v=0;for(;this._memoryCleanupPosition<this.lines.length;)if(v+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),v>100)return!0;return g}get _isReflowEnabled(){const g=this._optionsService.rawOptions.windowsPty;return g&&g.buildNumber?this._hasScrollback&&g.backend==="conpty"&&g.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(g,v){this._cols!==g&&(g>this._cols?this._reflowLarger(g,v):this._reflowSmaller(g,v))}_reflowLarger(g,v){const b=(0,d.reflowLargerGetLinesToRemove)(this.lines,this._cols,g,this.ybase+this.y,this.getNullCell(f.DEFAULT_ATTR_DATA));if(b.length>0){const S=(0,d.reflowLargerCreateNewLayout)(this.lines,b);(0,d.reflowLargerApplyNewLayout)(this.lines,S.layout),this._reflowLargerAdjustViewport(g,v,S.countRemoved)}}_reflowLargerAdjustViewport(g,v,b){const S=this.getNullCell(f.DEFAULT_ATTR_DATA);let x=b;for(;x-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<v&&this.lines.push(new f.BufferLine(g,S))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-b,0)}_reflowSmaller(g,v){const b=this.getNullCell(f.DEFAULT_ATTR_DATA),S=[];let x=0;for(let C=this.lines.length-1;C>=0;C--){let w=this.lines.get(C);if(!w||!w.isWrapped&&w.getTrimmedLength()<=g)continue;const E=[w];for(;w.isWrapped&&C>0;)w=this.lines.get(--C),E.unshift(w);const A=this.ybase+this.y;if(A>=C&&A<C+E.length)continue;const M=E[E.length-1].getTrimmedLength(),T=(0,d.reflowSmallerGetNewLineLengths)(E,this._cols,g),B=T.length-E.length;let F;F=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+B):Math.max(0,this.lines.length-this.lines.maxLength+B);const j=[];for(let I=0;I<B;I++){const H=this.getBlankLine(f.DEFAULT_ATTR_DATA,!0);j.push(H)}j.length>0&&(S.push({start:C+E.length+x,newLines:j}),x+=j.length),E.push(...j);let z=T.length-1,$=T[z];$===0&&(z--,$=T[z]);let V=E.length-B-1,L=M;for(;V>=0;){const I=Math.min(L,$);if(E[z]===void 0)break;if(E[z].copyCellsFrom(E[V],L-I,$-I,I,!0),$-=I,$===0&&(z--,$=T[z]),L-=I,L===0){V--;const H=Math.max(V,0);L=(0,d.getWrappedLineTrimmedLength)(E,H,this._cols)}}for(let I=0;I<E.length;I++)T[I]<g&&E[I].setCell(T[I],b);let k=B-F;for(;k-- >0;)this.ybase===0?this.y<v-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+x)-v&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+B,this.ybase+v-1)}if(S.length>0){const C=[],w=[];for(let z=0;z<this.lines.length;z++)w.push(this.lines.get(z));const E=this.lines.length;let A=E-1,M=0,T=S[M];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+x);let B=0;for(let z=Math.min(this.lines.maxLength-1,E+x-1);z>=0;z--)if(T&&T.start>A+B){for(let $=T.newLines.length-1;$>=0;$--)this.lines.set(z--,T.newLines[$]);z++,C.push({index:A+1,amount:T.newLines.length}),B+=T.newLines.length,T=S[++M]}else this.lines.set(z,w[A--]);let F=0;for(let z=C.length-1;z>=0;z--)C[z].index+=F,this.lines.onInsertEmitter.fire(C[z]),F+=C[z].amount;const j=Math.max(0,E+x-this.lines.maxLength);j>0&&this.lines.onTrimEmitter.fire(j)}}translateBufferLineToString(g,v,b=0,S){const x=this.lines.get(g);return x?x.translateToString(v,b,S):""}getWrappedRangeForLine(g){let v=g,b=g;for(;v>0&&this.lines.get(v).isWrapped;)v--;for(;b+1<this.lines.length&&this.lines.get(b+1).isWrapped;)b++;return{first:v,last:b}}setupTabStops(g){for(g!=null?this.tabs[g]||(g=this.prevStop(g)):(this.tabs={},g=0);g<this._cols;g+=this._optionsService.rawOptions.tabStopWidth)this.tabs[g]=!0}prevStop(g){for(g==null&&(g=this.x);!this.tabs[--g]&&g>0;);return g>=this._cols?this._cols-1:g<0?0:g}nextStop(g){for(g==null&&(g=this.x);!this.tabs[++g]&&g<this._cols;);return g>=this._cols?this._cols-1:g<0?0:g}clearMarkers(g){this._isClearing=!0;for(let v=0;v<this.markers.length;v++)this.markers[v].line===g&&(this.markers[v].dispose(),this.markers.splice(v--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let g=0;g<this.markers.length;g++)this.markers[g].dispose(),this.markers.splice(g--,1);this._isClearing=!1}addMarker(g){const v=new m.Marker(g);return this.markers.push(v),v.register(this.lines.onTrim((b=>{v.line-=b,v.line<0&&v.dispose()}))),v.register(this.lines.onInsert((b=>{v.line>=b.index&&(v.line+=b.amount)}))),v.register(this.lines.onDelete((b=>{v.line>=b.index&&v.line<b.index+b.amount&&v.dispose(),v.line>b.index&&(v.line-=b.amount)}))),v.register(v.onDispose((()=>this._removeMarker(v)))),v}_removeMarker(g){this._isClearing||this.markers.splice(this.markers.indexOf(g),1)}}},8437:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferLine=o.DEFAULT_ATTR_DATA=void 0;const c=a(3734),h=a(511),u=a(643),f=a(482);o.DEFAULT_ATTR_DATA=Object.freeze(new c.AttributeData);let d=0;class y{constructor(m,p,g=!1){this.isWrapped=g,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*m);const v=p||h.CellData.fromCharData([0,u.NULL_CELL_CHAR,u.NULL_CELL_WIDTH,u.NULL_CELL_CODE]);for(let b=0;b<m;++b)this.setCell(b,v);this.length=m}get(m){const p=this._data[3*m+0],g=2097151&p;return[this._data[3*m+1],2097152&p?this._combined[m]:g?(0,f.stringFromCodePoint)(g):"",p>>22,2097152&p?this._combined[m].charCodeAt(this._combined[m].length-1):g]}set(m,p){this._data[3*m+1]=p[u.CHAR_DATA_ATTR_INDEX],p[u.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[m]=p[1],this._data[3*m+0]=2097152|m|p[u.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*m+0]=p[u.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|p[u.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(m){return this._data[3*m+0]>>22}hasWidth(m){return 12582912&this._data[3*m+0]}getFg(m){return this._data[3*m+1]}getBg(m){return this._data[3*m+2]}hasContent(m){return 4194303&this._data[3*m+0]}getCodePoint(m){const p=this._data[3*m+0];return 2097152&p?this._combined[m].charCodeAt(this._combined[m].length-1):2097151&p}isCombined(m){return 2097152&this._data[3*m+0]}getString(m){const p=this._data[3*m+0];return 2097152&p?this._combined[m]:2097151&p?(0,f.stringFromCodePoint)(2097151&p):""}isProtected(m){return 536870912&this._data[3*m+2]}loadCell(m,p){return d=3*m,p.content=this._data[d+0],p.fg=this._data[d+1],p.bg=this._data[d+2],2097152&p.content&&(p.combinedData=this._combined[m]),268435456&p.bg&&(p.extended=this._extendedAttrs[m]),p}setCell(m,p){2097152&p.content&&(this._combined[m]=p.combinedData),268435456&p.bg&&(this._extendedAttrs[m]=p.extended),this._data[3*m+0]=p.content,this._data[3*m+1]=p.fg,this._data[3*m+2]=p.bg}setCellFromCodepoint(m,p,g,v){268435456&v.bg&&(this._extendedAttrs[m]=v.extended),this._data[3*m+0]=p|g<<22,this._data[3*m+1]=v.fg,this._data[3*m+2]=v.bg}addCodepointToCell(m,p,g){let v=this._data[3*m+0];2097152&v?this._combined[m]+=(0,f.stringFromCodePoint)(p):2097151&v?(this._combined[m]=(0,f.stringFromCodePoint)(2097151&v)+(0,f.stringFromCodePoint)(p),v&=-2097152,v|=2097152):v=p|4194304,g&&(v&=-12582913,v|=g<<22),this._data[3*m+0]=v}insertCells(m,p,g){if((m%=this.length)&&this.getWidth(m-1)===2&&this.setCellFromCodepoint(m-1,0,1,g),p<this.length-m){const v=new h.CellData;for(let b=this.length-m-p-1;b>=0;--b)this.setCell(m+p+b,this.loadCell(m+b,v));for(let b=0;b<p;++b)this.setCell(m+b,g)}else for(let v=m;v<this.length;++v)this.setCell(v,g);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,g)}deleteCells(m,p,g){if(m%=this.length,p<this.length-m){const v=new h.CellData;for(let b=0;b<this.length-m-p;++b)this.setCell(m+b,this.loadCell(m+p+b,v));for(let b=this.length-p;b<this.length;++b)this.setCell(b,g)}else for(let v=m;v<this.length;++v)this.setCell(v,g);m&&this.getWidth(m-1)===2&&this.setCellFromCodepoint(m-1,0,1,g),this.getWidth(m)!==0||this.hasContent(m)||this.setCellFromCodepoint(m,0,1,g)}replaceCells(m,p,g,v=!1){if(v)for(m&&this.getWidth(m-1)===2&&!this.isProtected(m-1)&&this.setCellFromCodepoint(m-1,0,1,g),p<this.length&&this.getWidth(p-1)===2&&!this.isProtected(p)&&this.setCellFromCodepoint(p,0,1,g);m<p&&m<this.length;)this.isProtected(m)||this.setCell(m,g),m++;else for(m&&this.getWidth(m-1)===2&&this.setCellFromCodepoint(m-1,0,1,g),p<this.length&&this.getWidth(p-1)===2&&this.setCellFromCodepoint(p,0,1,g);m<p&&m<this.length;)this.setCell(m++,g)}resize(m,p){if(m===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const g=3*m;if(m>this.length){if(this._data.buffer.byteLength>=4*g)this._data=new Uint32Array(this._data.buffer,0,g);else{const v=new Uint32Array(g);v.set(this._data),this._data=v}for(let v=this.length;v<m;++v)this.setCell(v,p)}else{this._data=this._data.subarray(0,g);const v=Object.keys(this._combined);for(let S=0;S<v.length;S++){const x=parseInt(v[S],10);x>=m&&delete this._combined[x]}const b=Object.keys(this._extendedAttrs);for(let S=0;S<b.length;S++){const x=parseInt(b[S],10);x>=m&&delete this._extendedAttrs[x]}}return this.length=m,4*g*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const m=new Uint32Array(this._data.length);return m.set(this._data),this._data=m,1}return 0}fill(m,p=!1){if(p)for(let g=0;g<this.length;++g)this.isProtected(g)||this.setCell(g,m);else{this._combined={},this._extendedAttrs={};for(let g=0;g<this.length;++g)this.setCell(g,m)}}copyFrom(m){this.length!==m.length?this._data=new Uint32Array(m._data):this._data.set(m._data),this.length=m.length,this._combined={};for(const p in m._combined)this._combined[p]=m._combined[p];this._extendedAttrs={};for(const p in m._extendedAttrs)this._extendedAttrs[p]=m._extendedAttrs[p];this.isWrapped=m.isWrapped}clone(){const m=new y(0);m._data=new Uint32Array(this._data),m.length=this.length;for(const p in this._combined)m._combined[p]=this._combined[p];for(const p in this._extendedAttrs)m._extendedAttrs[p]=this._extendedAttrs[p];return m.isWrapped=this.isWrapped,m}getTrimmedLength(){for(let m=this.length-1;m>=0;--m)if(4194303&this._data[3*m+0])return m+(this._data[3*m+0]>>22);return 0}getNoBgTrimmedLength(){for(let m=this.length-1;m>=0;--m)if(4194303&this._data[3*m+0]||50331648&this._data[3*m+2])return m+(this._data[3*m+0]>>22);return 0}copyCellsFrom(m,p,g,v,b){const S=m._data;if(b)for(let C=v-1;C>=0;C--){for(let w=0;w<3;w++)this._data[3*(g+C)+w]=S[3*(p+C)+w];268435456&S[3*(p+C)+2]&&(this._extendedAttrs[g+C]=m._extendedAttrs[p+C])}else for(let C=0;C<v;C++){for(let w=0;w<3;w++)this._data[3*(g+C)+w]=S[3*(p+C)+w];268435456&S[3*(p+C)+2]&&(this._extendedAttrs[g+C]=m._extendedAttrs[p+C])}const x=Object.keys(m._combined);for(let C=0;C<x.length;C++){const w=parseInt(x[C],10);w>=p&&(this._combined[w-p+g]=m._combined[w])}}translateToString(m,p,g,v){p=p??0,g=g??this.length,m&&(g=Math.min(g,this.getTrimmedLength())),v&&(v.length=0);let b="";for(;p<g;){const S=this._data[3*p+0],x=2097151&S,C=2097152&S?this._combined[p]:x?(0,f.stringFromCodePoint)(x):u.WHITESPACE_CELL_CHAR;if(b+=C,v)for(let w=0;w<C.length;++w)v.push(p);p+=S>>22||1}return v&&v.push(p),b}}o.BufferLine=y},4841:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.getRangeLength=void 0,o.getRangeLength=function(a,c){if(a.start.y>a.end.y)throw new Error(`Buffer range end (${a.end.x}, ${a.end.y}) cannot be before start (${a.start.x}, ${a.start.y})`);return c*(a.end.y-a.start.y)+(a.end.x-a.start.x+1)}},4634:(l,o)=>{function a(c,h,u){if(h===c.length-1)return c[h].getTrimmedLength();const f=!c[h].hasContent(u-1)&&c[h].getWidth(u-1)===1,d=c[h+1].getWidth(0)===2;return f&&d?u-1:u}Object.defineProperty(o,"__esModule",{value:!0}),o.getWrappedLineTrimmedLength=o.reflowSmallerGetNewLineLengths=o.reflowLargerApplyNewLayout=o.reflowLargerCreateNewLayout=o.reflowLargerGetLinesToRemove=void 0,o.reflowLargerGetLinesToRemove=function(c,h,u,f,d){const y=[];for(let _=0;_<c.length-1;_++){let m=_,p=c.get(++m);if(!p.isWrapped)continue;const g=[c.get(_)];for(;m<c.length&&p.isWrapped;)g.push(p),p=c.get(++m);if(f>=_&&f<m){_+=g.length-1;continue}let v=0,b=a(g,v,h),S=1,x=0;for(;S<g.length;){const w=a(g,S,h),E=w-x,A=u-b,M=Math.min(E,A);g[v].copyCellsFrom(g[S],x,b,M,!1),b+=M,b===u&&(v++,b=0),x+=M,x===w&&(S++,x=0),b===0&&v!==0&&g[v-1].getWidth(u-1)===2&&(g[v].copyCellsFrom(g[v-1],u-1,b++,1,!1),g[v-1].setCell(u-1,d))}g[v].replaceCells(b,u,d);let C=0;for(let w=g.length-1;w>0&&(w>v||g[w].getTrimmedLength()===0);w--)C++;C>0&&(y.push(_+g.length-C),y.push(C)),_+=g.length-1}return y},o.reflowLargerCreateNewLayout=function(c,h){const u=[];let f=0,d=h[f],y=0;for(let _=0;_<c.length;_++)if(d===_){const m=h[++f];c.onDeleteEmitter.fire({index:_-y,amount:m}),_+=m-1,y+=m,d=h[++f]}else u.push(_);return{layout:u,countRemoved:y}},o.reflowLargerApplyNewLayout=function(c,h){const u=[];for(let f=0;f<h.length;f++)u.push(c.get(h[f]));for(let f=0;f<u.length;f++)c.set(f,u[f]);c.length=h.length},o.reflowSmallerGetNewLineLengths=function(c,h,u){const f=[],d=c.map(((p,g)=>a(c,g,h))).reduce(((p,g)=>p+g));let y=0,_=0,m=0;for(;m<d;){if(d-m<u){f.push(d-m);break}y+=u;const p=a(c,_,h);y>p&&(y-=p,_++);const g=c[_].getWidth(y-1)===2;g&&y--;const v=g?u-1:u;f.push(v),m+=v}return f},o.getWrappedLineTrimmedLength=a},5295:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferSet=void 0;const c=a(8460),h=a(844),u=a(9092);class f extends h.Disposable{constructor(y,_){super(),this._optionsService=y,this._bufferService=_,this._onBufferActivate=this.register(new c.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.resize(this._bufferService.cols,this._bufferService.rows)))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",(()=>this.setupTabStops())))}reset(){this._normal=new u.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new u.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(y){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(y),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(y,_){this._normal.resize(y,_),this._alt.resize(y,_),this.setupTabStops(y)}setupTabStops(y){this._normal.setupTabStops(y),this._alt.setupTabStops(y)}}o.BufferSet=f},511:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CellData=void 0;const c=a(482),h=a(643),u=a(3734);class f extends u.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new u.ExtendedAttrs,this.combinedData=""}static fromCharData(y){const _=new f;return _.setFromCharData(y),_}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,c.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(y){this.fg=y[h.CHAR_DATA_ATTR_INDEX],this.bg=0;let _=!1;if(y[h.CHAR_DATA_CHAR_INDEX].length>2)_=!0;else if(y[h.CHAR_DATA_CHAR_INDEX].length===2){const m=y[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=m&&m<=56319){const p=y[h.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=p&&p<=57343?this.content=1024*(m-55296)+p-56320+65536|y[h.CHAR_DATA_WIDTH_INDEX]<<22:_=!0}else _=!0}else this.content=y[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|y[h.CHAR_DATA_WIDTH_INDEX]<<22;_&&(this.combinedData=y[h.CHAR_DATA_CHAR_INDEX],this.content=2097152|y[h.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}o.CellData=f},643:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.WHITESPACE_CELL_CODE=o.WHITESPACE_CELL_WIDTH=o.WHITESPACE_CELL_CHAR=o.NULL_CELL_CODE=o.NULL_CELL_WIDTH=o.NULL_CELL_CHAR=o.CHAR_DATA_CODE_INDEX=o.CHAR_DATA_WIDTH_INDEX=o.CHAR_DATA_CHAR_INDEX=o.CHAR_DATA_ATTR_INDEX=o.DEFAULT_EXT=o.DEFAULT_ATTR=o.DEFAULT_COLOR=void 0,o.DEFAULT_COLOR=0,o.DEFAULT_ATTR=256|o.DEFAULT_COLOR<<9,o.DEFAULT_EXT=0,o.CHAR_DATA_ATTR_INDEX=0,o.CHAR_DATA_CHAR_INDEX=1,o.CHAR_DATA_WIDTH_INDEX=2,o.CHAR_DATA_CODE_INDEX=3,o.NULL_CELL_CHAR="",o.NULL_CELL_WIDTH=1,o.NULL_CELL_CODE=0,o.WHITESPACE_CELL_CHAR=" ",o.WHITESPACE_CELL_WIDTH=1,o.WHITESPACE_CELL_CODE=32},4863:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Marker=void 0;const c=a(8460),h=a(844);class u{get id(){return this._id}constructor(d){this.line=d,this.isDisposed=!1,this._disposables=[],this._id=u._nextId++,this._onDispose=this.register(new c.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,h.disposeArray)(this._disposables),this._disposables.length=0)}register(d){return this._disposables.push(d),d}}o.Marker=u,u._nextId=1},7116:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DEFAULT_CHARSET=o.CHARSETS=void 0,o.CHARSETS={},o.DEFAULT_CHARSET=o.CHARSETS.B,o.CHARSETS[0]={"`":"◆",a:"▒",b:"␉",c:"␌",d:"␍",e:"␊",f:"°",g:"±",h:"␤",i:"␋",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"},o.CHARSETS.A={"#":"£"},o.CHARSETS.B=void 0,o.CHARSETS[4]={"#":"£","@":"¾","[":"ij","\\":"½","]":"|","{":"¨","|":"f","}":"¼","~":"´"},o.CHARSETS.C=o.CHARSETS[5]={"[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},o.CHARSETS.R={"#":"£","@":"à","[":"°","\\":"ç","]":"§","{":"é","|":"ù","}":"è","~":"¨"},o.CHARSETS.Q={"@":"à","[":"â","\\":"ç","]":"ê","^":"î","`":"ô","{":"é","|":"ù","}":"è","~":"û"},o.CHARSETS.K={"@":"§","[":"Ä","\\":"Ö","]":"Ü","{":"ä","|":"ö","}":"ü","~":"ß"},o.CHARSETS.Y={"#":"£","@":"§","[":"°","\\":"ç","]":"é","`":"ù","{":"à","|":"ò","}":"è","~":"ì"},o.CHARSETS.E=o.CHARSETS[6]={"@":"Ä","[":"Æ","\\":"Ø","]":"Å","^":"Ü","`":"ä","{":"æ","|":"ø","}":"å","~":"ü"},o.CHARSETS.Z={"#":"£","@":"§","[":"¡","\\":"Ñ","]":"¿","{":"°","|":"ñ","}":"ç"},o.CHARSETS.H=o.CHARSETS[7]={"@":"É","[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},o.CHARSETS["="]={"#":"ù","@":"à","[":"é","\\":"ç","]":"ê","^":"î",_:"è","`":"ô","{":"ä","|":"ö","}":"ü","~":"û"}},2584:(l,o)=>{var a,c,h;Object.defineProperty(o,"__esModule",{value:!0}),o.C1_ESCAPED=o.C1=o.C0=void 0,(function(u){u.NUL="\0",u.SOH="",u.STX="",u.ETX="",u.EOT="",u.ENQ="",u.ACK="",u.BEL="\x07",u.BS="\b",u.HT="	",u.LF=`
`,u.VT="\v",u.FF="\f",u.CR="\r",u.SO="",u.SI="",u.DLE="",u.DC1="",u.DC2="",u.DC3="",u.DC4="",u.NAK="",u.SYN="",u.ETB="",u.CAN="",u.EM="",u.SUB="",u.ESC="\x1B",u.FS="",u.GS="",u.RS="",u.US="",u.SP=" ",u.DEL=""})(a||(o.C0=a={})),(function(u){u.PAD="",u.HOP="",u.BPH="",u.NBH="",u.IND="",u.NEL="",u.SSA="",u.ESA="",u.HTS="",u.HTJ="",u.VTS="",u.PLD="",u.PLU="",u.RI="",u.SS2="",u.SS3="",u.DCS="",u.PU1="",u.PU2="",u.STS="",u.CCH="",u.MW="",u.SPA="",u.EPA="",u.SOS="",u.SGCI="",u.SCI="",u.CSI="",u.ST="",u.OSC="",u.PM="",u.APC=""})(c||(o.C1=c={})),(function(u){u.ST=`${a.ESC}\\`})(h||(o.C1_ESCAPED=h={}))},7399:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.evaluateKeyboardEvent=void 0;const c=a(2584),h={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};o.evaluateKeyboardEvent=function(u,f,d,y){const _={type:0,cancel:!1,key:void 0},m=(u.shiftKey?1:0)|(u.altKey?2:0)|(u.ctrlKey?4:0)|(u.metaKey?8:0);switch(u.keyCode){case 0:u.key==="UIKeyInputUpArrow"?_.key=f?c.C0.ESC+"OA":c.C0.ESC+"[A":u.key==="UIKeyInputLeftArrow"?_.key=f?c.C0.ESC+"OD":c.C0.ESC+"[D":u.key==="UIKeyInputRightArrow"?_.key=f?c.C0.ESC+"OC":c.C0.ESC+"[C":u.key==="UIKeyInputDownArrow"&&(_.key=f?c.C0.ESC+"OB":c.C0.ESC+"[B");break;case 8:_.key=u.ctrlKey?"\b":c.C0.DEL,u.altKey&&(_.key=c.C0.ESC+_.key);break;case 9:if(u.shiftKey){_.key=c.C0.ESC+"[Z";break}_.key=c.C0.HT,_.cancel=!0;break;case 13:_.key=u.altKey?c.C0.ESC+c.C0.CR:c.C0.CR,_.cancel=!0;break;case 27:_.key=c.C0.ESC,u.altKey&&(_.key=c.C0.ESC+c.C0.ESC),_.cancel=!0;break;case 37:if(u.metaKey)break;m?(_.key=c.C0.ESC+"[1;"+(m+1)+"D",_.key===c.C0.ESC+"[1;3D"&&(_.key=c.C0.ESC+(d?"b":"[1;5D"))):_.key=f?c.C0.ESC+"OD":c.C0.ESC+"[D";break;case 39:if(u.metaKey)break;m?(_.key=c.C0.ESC+"[1;"+(m+1)+"C",_.key===c.C0.ESC+"[1;3C"&&(_.key=c.C0.ESC+(d?"f":"[1;5C"))):_.key=f?c.C0.ESC+"OC":c.C0.ESC+"[C";break;case 38:if(u.metaKey)break;m?(_.key=c.C0.ESC+"[1;"+(m+1)+"A",d||_.key!==c.C0.ESC+"[1;3A"||(_.key=c.C0.ESC+"[1;5A")):_.key=f?c.C0.ESC+"OA":c.C0.ESC+"[A";break;case 40:if(u.metaKey)break;m?(_.key=c.C0.ESC+"[1;"+(m+1)+"B",d||_.key!==c.C0.ESC+"[1;3B"||(_.key=c.C0.ESC+"[1;5B")):_.key=f?c.C0.ESC+"OB":c.C0.ESC+"[B";break;case 45:u.shiftKey||u.ctrlKey||(_.key=c.C0.ESC+"[2~");break;case 46:_.key=m?c.C0.ESC+"[3;"+(m+1)+"~":c.C0.ESC+"[3~";break;case 36:_.key=m?c.C0.ESC+"[1;"+(m+1)+"H":f?c.C0.ESC+"OH":c.C0.ESC+"[H";break;case 35:_.key=m?c.C0.ESC+"[1;"+(m+1)+"F":f?c.C0.ESC+"OF":c.C0.ESC+"[F";break;case 33:u.shiftKey?_.type=2:u.ctrlKey?_.key=c.C0.ESC+"[5;"+(m+1)+"~":_.key=c.C0.ESC+"[5~";break;case 34:u.shiftKey?_.type=3:u.ctrlKey?_.key=c.C0.ESC+"[6;"+(m+1)+"~":_.key=c.C0.ESC+"[6~";break;case 112:_.key=m?c.C0.ESC+"[1;"+(m+1)+"P":c.C0.ESC+"OP";break;case 113:_.key=m?c.C0.ESC+"[1;"+(m+1)+"Q":c.C0.ESC+"OQ";break;case 114:_.key=m?c.C0.ESC+"[1;"+(m+1)+"R":c.C0.ESC+"OR";break;case 115:_.key=m?c.C0.ESC+"[1;"+(m+1)+"S":c.C0.ESC+"OS";break;case 116:_.key=m?c.C0.ESC+"[15;"+(m+1)+"~":c.C0.ESC+"[15~";break;case 117:_.key=m?c.C0.ESC+"[17;"+(m+1)+"~":c.C0.ESC+"[17~";break;case 118:_.key=m?c.C0.ESC+"[18;"+(m+1)+"~":c.C0.ESC+"[18~";break;case 119:_.key=m?c.C0.ESC+"[19;"+(m+1)+"~":c.C0.ESC+"[19~";break;case 120:_.key=m?c.C0.ESC+"[20;"+(m+1)+"~":c.C0.ESC+"[20~";break;case 121:_.key=m?c.C0.ESC+"[21;"+(m+1)+"~":c.C0.ESC+"[21~";break;case 122:_.key=m?c.C0.ESC+"[23;"+(m+1)+"~":c.C0.ESC+"[23~";break;case 123:_.key=m?c.C0.ESC+"[24;"+(m+1)+"~":c.C0.ESC+"[24~";break;default:if(!u.ctrlKey||u.shiftKey||u.altKey||u.metaKey)if(d&&!y||!u.altKey||u.metaKey)!d||u.altKey||u.ctrlKey||u.shiftKey||!u.metaKey?u.key&&!u.ctrlKey&&!u.altKey&&!u.metaKey&&u.keyCode>=48&&u.key.length===1?_.key=u.key:u.key&&u.ctrlKey&&(u.key==="_"&&(_.key=c.C0.US),u.key==="@"&&(_.key=c.C0.NUL)):u.keyCode===65&&(_.type=1);else{const p=h[u.keyCode],g=p==null?void 0:p[u.shiftKey?1:0];if(g)_.key=c.C0.ESC+g;else if(u.keyCode>=65&&u.keyCode<=90){const v=u.ctrlKey?u.keyCode-64:u.keyCode+32;let b=String.fromCharCode(v);u.shiftKey&&(b=b.toUpperCase()),_.key=c.C0.ESC+b}else if(u.keyCode===32)_.key=c.C0.ESC+(u.ctrlKey?c.C0.NUL:" ");else if(u.key==="Dead"&&u.code.startsWith("Key")){let v=u.code.slice(3,4);u.shiftKey||(v=v.toLowerCase()),_.key=c.C0.ESC+v,_.cancel=!0}}else u.keyCode>=65&&u.keyCode<=90?_.key=String.fromCharCode(u.keyCode-64):u.keyCode===32?_.key=c.C0.NUL:u.keyCode>=51&&u.keyCode<=55?_.key=String.fromCharCode(u.keyCode-51+27):u.keyCode===56?_.key=c.C0.DEL:u.keyCode===219?_.key=c.C0.ESC:u.keyCode===220?_.key=c.C0.FS:u.keyCode===221&&(_.key=c.C0.GS)}return _}},482:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Utf8ToUtf32=o.StringToUtf32=o.utf32ToString=o.stringFromCodePoint=void 0,o.stringFromCodePoint=function(a){return a>65535?(a-=65536,String.fromCharCode(55296+(a>>10))+String.fromCharCode(a%1024+56320)):String.fromCharCode(a)},o.utf32ToString=function(a,c=0,h=a.length){let u="";for(let f=c;f<h;++f){let d=a[f];d>65535?(d-=65536,u+=String.fromCharCode(55296+(d>>10))+String.fromCharCode(d%1024+56320)):u+=String.fromCharCode(d)}return u},o.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(a,c){const h=a.length;if(!h)return 0;let u=0,f=0;if(this._interim){const d=a.charCodeAt(f++);56320<=d&&d<=57343?c[u++]=1024*(this._interim-55296)+d-56320+65536:(c[u++]=this._interim,c[u++]=d),this._interim=0}for(let d=f;d<h;++d){const y=a.charCodeAt(d);if(55296<=y&&y<=56319){if(++d>=h)return this._interim=y,u;const _=a.charCodeAt(d);56320<=_&&_<=57343?c[u++]=1024*(y-55296)+_-56320+65536:(c[u++]=y,c[u++]=_)}else y!==65279&&(c[u++]=y)}return u}},o.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(a,c){const h=a.length;if(!h)return 0;let u,f,d,y,_=0,m=0,p=0;if(this.interim[0]){let b=!1,S=this.interim[0];S&=(224&S)==192?31:(240&S)==224?15:7;let x,C=0;for(;(x=63&this.interim[++C])&&C<4;)S<<=6,S|=x;const w=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,E=w-C;for(;p<E;){if(p>=h)return 0;if(x=a[p++],(192&x)!=128){p--,b=!0;break}this.interim[C++]=x,S<<=6,S|=63&x}b||(w===2?S<128?p--:c[_++]=S:w===3?S<2048||S>=55296&&S<=57343||S===65279||(c[_++]=S):S<65536||S>1114111||(c[_++]=S)),this.interim.fill(0)}const g=h-4;let v=p;for(;v<h;){for(;!(!(v<g)||128&(u=a[v])||128&(f=a[v+1])||128&(d=a[v+2])||128&(y=a[v+3]));)c[_++]=u,c[_++]=f,c[_++]=d,c[_++]=y,v+=4;if(u=a[v++],u<128)c[_++]=u;else if((224&u)==192){if(v>=h)return this.interim[0]=u,_;if(f=a[v++],(192&f)!=128){v--;continue}if(m=(31&u)<<6|63&f,m<128){v--;continue}c[_++]=m}else if((240&u)==224){if(v>=h)return this.interim[0]=u,_;if(f=a[v++],(192&f)!=128){v--;continue}if(v>=h)return this.interim[0]=u,this.interim[1]=f,_;if(d=a[v++],(192&d)!=128){v--;continue}if(m=(15&u)<<12|(63&f)<<6|63&d,m<2048||m>=55296&&m<=57343||m===65279)continue;c[_++]=m}else if((248&u)==240){if(v>=h)return this.interim[0]=u,_;if(f=a[v++],(192&f)!=128){v--;continue}if(v>=h)return this.interim[0]=u,this.interim[1]=f,_;if(d=a[v++],(192&d)!=128){v--;continue}if(v>=h)return this.interim[0]=u,this.interim[1]=f,this.interim[2]=d,_;if(y=a[v++],(192&y)!=128){v--;continue}if(m=(7&u)<<18|(63&f)<<12|(63&d)<<6|63&y,m<65536||m>1114111)continue;c[_++]=m}}return _}}},225:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.UnicodeV6=void 0;const c=a(1480),h=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],u=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let f;o.UnicodeV6=class{constructor(){if(this.version="6",!f){f=new Uint8Array(65536),f.fill(1),f[0]=0,f.fill(0,1,32),f.fill(0,127,160),f.fill(2,4352,4448),f[9001]=2,f[9002]=2,f.fill(2,11904,42192),f[12351]=1,f.fill(2,44032,55204),f.fill(2,63744,64256),f.fill(2,65040,65050),f.fill(2,65072,65136),f.fill(2,65280,65377),f.fill(2,65504,65511);for(let d=0;d<h.length;++d)f.fill(0,h[d][0],h[d][1]+1)}}wcwidth(d){return d<32?0:d<127?1:d<65536?f[d]:(function(y,_){let m,p=0,g=_.length-1;if(y<_[0][0]||y>_[g][1])return!1;for(;g>=p;)if(m=p+g>>1,y>_[m][1])p=m+1;else{if(!(y<_[m][0]))return!0;g=m-1}return!1})(d,u)?0:d>=131072&&d<=196605||d>=196608&&d<=262141?2:1}charProperties(d,y){let _=this.wcwidth(d),m=_===0&&y!==0;if(m){const p=c.UnicodeService.extractWidth(y);p===0?m=!1:p>_&&(_=p)}return c.UnicodeService.createPropertyValue(0,_,m)}}},5981:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.WriteBuffer=void 0;const c=a(8460),h=a(844);class u extends h.Disposable{constructor(d){super(),this._action=d,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new c.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(d,y){if(y!==void 0&&this._syncCalls>y)return void(this._syncCalls=0);if(this._pendingData+=d.length,this._writeBuffer.push(d),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let _;for(this._isSyncWriting=!0;_=this._writeBuffer.shift();){this._action(_);const m=this._callbacks.shift();m&&m()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(d,y){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=d.length,this._writeBuffer.push(d),this._callbacks.push(y),void this._innerWrite();setTimeout((()=>this._innerWrite()))}this._pendingData+=d.length,this._writeBuffer.push(d),this._callbacks.push(y)}_innerWrite(d=0,y=!0){const _=d||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const m=this._writeBuffer[this._bufferOffset],p=this._action(m,y);if(p){const v=b=>Date.now()-_>=12?setTimeout((()=>this._innerWrite(0,b))):this._innerWrite(_,b);return void p.catch((b=>(queueMicrotask((()=>{throw b})),Promise.resolve(!1)))).then(v)}const g=this._callbacks[this._bufferOffset];if(g&&g(),this._bufferOffset++,this._pendingData-=m.length,Date.now()-_>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout((()=>this._innerWrite()))):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}o.WriteBuffer=u},5941:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.toRgbString=o.parseColor=void 0;const a=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,c=/^[\da-f]+$/;function h(u,f){const d=u.toString(16),y=d.length<2?"0"+d:d;switch(f){case 4:return d[0];case 8:return y;case 12:return(y+y).slice(0,3);default:return y+y}}o.parseColor=function(u){if(!u)return;let f=u.toLowerCase();if(f.indexOf("rgb:")===0){f=f.slice(4);const d=a.exec(f);if(d){const y=d[1]?15:d[4]?255:d[7]?4095:65535;return[Math.round(parseInt(d[1]||d[4]||d[7]||d[10],16)/y*255),Math.round(parseInt(d[2]||d[5]||d[8]||d[11],16)/y*255),Math.round(parseInt(d[3]||d[6]||d[9]||d[12],16)/y*255)]}}else if(f.indexOf("#")===0&&(f=f.slice(1),c.exec(f)&&[3,6,9,12].includes(f.length))){const d=f.length/3,y=[0,0,0];for(let _=0;_<3;++_){const m=parseInt(f.slice(d*_,d*_+d),16);y[_]=d===1?m<<4:d===2?m:d===3?m>>4:m>>8}return y}},o.toRgbString=function(u,f=16){const[d,y,_]=u;return`rgb:${h(d,f)}/${h(y,f)}/${h(_,f)}`}},5770:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PAYLOAD_LIMIT=void 0,o.PAYLOAD_LIMIT=1e7},6351:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DcsHandler=o.DcsParser=void 0;const c=a(482),h=a(8742),u=a(5770),f=[];o.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=f,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=f}registerHandler(y,_){this._handlers[y]===void 0&&(this._handlers[y]=[]);const m=this._handlers[y];return m.push(_),{dispose:()=>{const p=m.indexOf(_);p!==-1&&m.splice(p,1)}}}clearHandler(y){this._handlers[y]&&delete this._handlers[y]}setHandlerFallback(y){this._handlerFb=y}reset(){if(this._active.length)for(let y=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;y>=0;--y)this._active[y].unhook(!1);this._stack.paused=!1,this._active=f,this._ident=0}hook(y,_){if(this.reset(),this._ident=y,this._active=this._handlers[y]||f,this._active.length)for(let m=this._active.length-1;m>=0;m--)this._active[m].hook(_);else this._handlerFb(this._ident,"HOOK",_)}put(y,_,m){if(this._active.length)for(let p=this._active.length-1;p>=0;p--)this._active[p].put(y,_,m);else this._handlerFb(this._ident,"PUT",(0,c.utf32ToString)(y,_,m))}unhook(y,_=!0){if(this._active.length){let m=!1,p=this._active.length-1,g=!1;if(this._stack.paused&&(p=this._stack.loopPosition-1,m=_,g=this._stack.fallThrough,this._stack.paused=!1),!g&&m===!1){for(;p>=0&&(m=this._active[p].unhook(y),m!==!0);p--)if(m instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=p,this._stack.fallThrough=!1,m;p--}for(;p>=0;p--)if(m=this._active[p].unhook(!1),m instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=p,this._stack.fallThrough=!0,m}else this._handlerFb(this._ident,"UNHOOK",y);this._active=f,this._ident=0}};const d=new h.Params;d.addParam(0),o.DcsHandler=class{constructor(y){this._handler=y,this._data="",this._params=d,this._hitLimit=!1}hook(y){this._params=y.length>1||y.params[0]?y.clone():d,this._data="",this._hitLimit=!1}put(y,_,m){this._hitLimit||(this._data+=(0,c.utf32ToString)(y,_,m),this._data.length>u.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(y){let _=!1;if(this._hitLimit)_=!1;else if(y&&(_=this._handler(this._data,this._params),_ instanceof Promise))return _.then((m=>(this._params=d,this._data="",this._hitLimit=!1,m)));return this._params=d,this._data="",this._hitLimit=!1,_}}},2015:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.EscapeSequenceParser=o.VT500_TRANSITION_TABLE=o.TransitionTable=void 0;const c=a(844),h=a(8742),u=a(6242),f=a(6351);class d{constructor(p){this.table=new Uint8Array(p)}setDefault(p,g){this.table.fill(p<<4|g)}add(p,g,v,b){this.table[g<<8|p]=v<<4|b}addMany(p,g,v,b){for(let S=0;S<p.length;S++)this.table[g<<8|p[S]]=v<<4|b}}o.TransitionTable=d;const y=160;o.VT500_TRANSITION_TABLE=(function(){const m=new d(4095),p=Array.apply(null,Array(256)).map(((C,w)=>w)),g=(C,w)=>p.slice(C,w),v=g(32,127),b=g(0,24);b.push(25),b.push.apply(b,g(28,32));const S=g(0,14);let x;for(x in m.setDefault(1,0),m.addMany(v,0,2,0),S)m.addMany([24,26,153,154],x,3,0),m.addMany(g(128,144),x,3,0),m.addMany(g(144,152),x,3,0),m.add(156,x,0,0),m.add(27,x,11,1),m.add(157,x,4,8),m.addMany([152,158,159],x,0,7),m.add(155,x,11,3),m.add(144,x,11,9);return m.addMany(b,0,3,0),m.addMany(b,1,3,1),m.add(127,1,0,1),m.addMany(b,8,0,8),m.addMany(b,3,3,3),m.add(127,3,0,3),m.addMany(b,4,3,4),m.add(127,4,0,4),m.addMany(b,6,3,6),m.addMany(b,5,3,5),m.add(127,5,0,5),m.addMany(b,2,3,2),m.add(127,2,0,2),m.add(93,1,4,8),m.addMany(v,8,5,8),m.add(127,8,5,8),m.addMany([156,27,24,26,7],8,6,0),m.addMany(g(28,32),8,0,8),m.addMany([88,94,95],1,0,7),m.addMany(v,7,0,7),m.addMany(b,7,0,7),m.add(156,7,0,0),m.add(127,7,0,7),m.add(91,1,11,3),m.addMany(g(64,127),3,7,0),m.addMany(g(48,60),3,8,4),m.addMany([60,61,62,63],3,9,4),m.addMany(g(48,60),4,8,4),m.addMany(g(64,127),4,7,0),m.addMany([60,61,62,63],4,0,6),m.addMany(g(32,64),6,0,6),m.add(127,6,0,6),m.addMany(g(64,127),6,0,0),m.addMany(g(32,48),3,9,5),m.addMany(g(32,48),5,9,5),m.addMany(g(48,64),5,0,6),m.addMany(g(64,127),5,7,0),m.addMany(g(32,48),4,9,5),m.addMany(g(32,48),1,9,2),m.addMany(g(32,48),2,9,2),m.addMany(g(48,127),2,10,0),m.addMany(g(48,80),1,10,0),m.addMany(g(81,88),1,10,0),m.addMany([89,90,92],1,10,0),m.addMany(g(96,127),1,10,0),m.add(80,1,11,9),m.addMany(b,9,0,9),m.add(127,9,0,9),m.addMany(g(28,32),9,0,9),m.addMany(g(32,48),9,9,12),m.addMany(g(48,60),9,8,10),m.addMany([60,61,62,63],9,9,10),m.addMany(b,11,0,11),m.addMany(g(32,128),11,0,11),m.addMany(g(28,32),11,0,11),m.addMany(b,10,0,10),m.add(127,10,0,10),m.addMany(g(28,32),10,0,10),m.addMany(g(48,60),10,8,10),m.addMany([60,61,62,63],10,0,11),m.addMany(g(32,48),10,9,12),m.addMany(b,12,0,12),m.add(127,12,0,12),m.addMany(g(28,32),12,0,12),m.addMany(g(32,48),12,9,12),m.addMany(g(48,64),12,0,11),m.addMany(g(64,127),12,12,13),m.addMany(g(64,127),10,12,13),m.addMany(g(64,127),9,12,13),m.addMany(b,13,13,13),m.addMany(v,13,13,13),m.add(127,13,0,13),m.addMany([27,156,24,26],13,14,0),m.add(y,0,2,0),m.add(y,8,5,8),m.add(y,6,0,6),m.add(y,11,0,11),m.add(y,13,13,13),m})();class _ extends c.Disposable{constructor(p=o.VT500_TRANSITION_TABLE){super(),this._transitions=p,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new h.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(g,v,b)=>{},this._executeHandlerFb=g=>{},this._csiHandlerFb=(g,v)=>{},this._escHandlerFb=g=>{},this._errorHandlerFb=g=>g,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,c.toDisposable)((()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)}))),this._oscParser=this.register(new u.OscParser),this._dcsParser=this.register(new f.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},(()=>!0))}_identifier(p,g=[64,126]){let v=0;if(p.prefix){if(p.prefix.length>1)throw new Error("only one byte as prefix supported");if(v=p.prefix.charCodeAt(0),v&&60>v||v>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(p.intermediates){if(p.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let S=0;S<p.intermediates.length;++S){const x=p.intermediates.charCodeAt(S);if(32>x||x>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");v<<=8,v|=x}}if(p.final.length!==1)throw new Error("final must be a single byte");const b=p.final.charCodeAt(0);if(g[0]>b||b>g[1])throw new Error(`final must be in range ${g[0]} .. ${g[1]}`);return v<<=8,v|=b,v}identToString(p){const g=[];for(;p;)g.push(String.fromCharCode(255&p)),p>>=8;return g.reverse().join("")}setPrintHandler(p){this._printHandler=p}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(p,g){const v=this._identifier(p,[48,126]);this._escHandlers[v]===void 0&&(this._escHandlers[v]=[]);const b=this._escHandlers[v];return b.push(g),{dispose:()=>{const S=b.indexOf(g);S!==-1&&b.splice(S,1)}}}clearEscHandler(p){this._escHandlers[this._identifier(p,[48,126])]&&delete this._escHandlers[this._identifier(p,[48,126])]}setEscHandlerFallback(p){this._escHandlerFb=p}setExecuteHandler(p,g){this._executeHandlers[p.charCodeAt(0)]=g}clearExecuteHandler(p){this._executeHandlers[p.charCodeAt(0)]&&delete this._executeHandlers[p.charCodeAt(0)]}setExecuteHandlerFallback(p){this._executeHandlerFb=p}registerCsiHandler(p,g){const v=this._identifier(p);this._csiHandlers[v]===void 0&&(this._csiHandlers[v]=[]);const b=this._csiHandlers[v];return b.push(g),{dispose:()=>{const S=b.indexOf(g);S!==-1&&b.splice(S,1)}}}clearCsiHandler(p){this._csiHandlers[this._identifier(p)]&&delete this._csiHandlers[this._identifier(p)]}setCsiHandlerFallback(p){this._csiHandlerFb=p}registerDcsHandler(p,g){return this._dcsParser.registerHandler(this._identifier(p),g)}clearDcsHandler(p){this._dcsParser.clearHandler(this._identifier(p))}setDcsHandlerFallback(p){this._dcsParser.setHandlerFallback(p)}registerOscHandler(p,g){return this._oscParser.registerHandler(p,g)}clearOscHandler(p){this._oscParser.clearHandler(p)}setOscHandlerFallback(p){this._oscParser.setHandlerFallback(p)}setErrorHandler(p){this._errorHandler=p}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(p,g,v,b,S){this._parseStack.state=p,this._parseStack.handlers=g,this._parseStack.handlerPos=v,this._parseStack.transition=b,this._parseStack.chunkPos=S}parse(p,g,v){let b,S=0,x=0,C=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,C=this._parseStack.chunkPos+1;else{if(v===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const w=this._parseStack.handlers;let E=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(v===!1&&E>-1){for(;E>=0&&(b=w[E](this._params),b!==!0);E--)if(b instanceof Promise)return this._parseStack.handlerPos=E,b}this._parseStack.handlers=[];break;case 4:if(v===!1&&E>-1){for(;E>=0&&(b=w[E](),b!==!0);E--)if(b instanceof Promise)return this._parseStack.handlerPos=E,b}this._parseStack.handlers=[];break;case 6:if(S=p[this._parseStack.chunkPos],b=this._dcsParser.unhook(S!==24&&S!==26,v),b)return b;S===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(S=p[this._parseStack.chunkPos],b=this._oscParser.end(S!==24&&S!==26,v),b)return b;S===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,C=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let w=C;w<g;++w){switch(S=p[w],x=this._transitions.table[this.currentState<<8|(S<160?S:y)],x>>4){case 2:for(let B=w+1;;++B){if(B>=g||(S=p[B])<32||S>126&&S<y){this._printHandler(p,w,B),w=B-1;break}if(++B>=g||(S=p[B])<32||S>126&&S<y){this._printHandler(p,w,B),w=B-1;break}if(++B>=g||(S=p[B])<32||S>126&&S<y){this._printHandler(p,w,B),w=B-1;break}if(++B>=g||(S=p[B])<32||S>126&&S<y){this._printHandler(p,w,B),w=B-1;break}}break;case 3:this._executeHandlers[S]?this._executeHandlers[S]():this._executeHandlerFb(S),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:w,code:S,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const E=this._csiHandlers[this._collect<<8|S];let A=E?E.length-1:-1;for(;A>=0&&(b=E[A](this._params),b!==!0);A--)if(b instanceof Promise)return this._preserveStack(3,E,A,x,w),b;A<0&&this._csiHandlerFb(this._collect<<8|S,this._params),this.precedingJoinState=0;break;case 8:do switch(S){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(S-48)}while(++w<g&&(S=p[w])>47&&S<60);w--;break;case 9:this._collect<<=8,this._collect|=S;break;case 10:const M=this._escHandlers[this._collect<<8|S];let T=M?M.length-1:-1;for(;T>=0&&(b=M[T](),b!==!0);T--)if(b instanceof Promise)return this._preserveStack(4,M,T,x,w),b;T<0&&this._escHandlerFb(this._collect<<8|S),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|S,this._params);break;case 13:for(let B=w+1;;++B)if(B>=g||(S=p[B])===24||S===26||S===27||S>127&&S<y){this._dcsParser.put(p,w,B),w=B-1;break}break;case 14:if(b=this._dcsParser.unhook(S!==24&&S!==26),b)return this._preserveStack(6,[],0,x,w),b;S===27&&(x|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let B=w+1;;B++)if(B>=g||(S=p[B])<32||S>127&&S<y){this._oscParser.put(p,w,B),w=B-1;break}break;case 6:if(b=this._oscParser.end(S!==24&&S!==26),b)return this._preserveStack(5,[],0,x,w),b;S===27&&(x|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&x}}}o.EscapeSequenceParser=_},6242:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.OscHandler=o.OscParser=void 0;const c=a(5770),h=a(482),u=[];o.OscParser=class{constructor(){this._state=0,this._active=u,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(f,d){this._handlers[f]===void 0&&(this._handlers[f]=[]);const y=this._handlers[f];return y.push(d),{dispose:()=>{const _=y.indexOf(d);_!==-1&&y.splice(_,1)}}}clearHandler(f){this._handlers[f]&&delete this._handlers[f]}setHandlerFallback(f){this._handlerFb=f}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=u}reset(){if(this._state===2)for(let f=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;f>=0;--f)this._active[f].end(!1);this._stack.paused=!1,this._active=u,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||u,this._active.length)for(let f=this._active.length-1;f>=0;f--)this._active[f].start();else this._handlerFb(this._id,"START")}_put(f,d,y){if(this._active.length)for(let _=this._active.length-1;_>=0;_--)this._active[_].put(f,d,y);else this._handlerFb(this._id,"PUT",(0,h.utf32ToString)(f,d,y))}start(){this.reset(),this._state=1}put(f,d,y){if(this._state!==3){if(this._state===1)for(;d<y;){const _=f[d++];if(_===59){this._state=2,this._start();break}if(_<48||57<_)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+_-48}this._state===2&&y-d>0&&this._put(f,d,y)}}end(f,d=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let y=!1,_=this._active.length-1,m=!1;if(this._stack.paused&&(_=this._stack.loopPosition-1,y=d,m=this._stack.fallThrough,this._stack.paused=!1),!m&&y===!1){for(;_>=0&&(y=this._active[_].end(f),y!==!0);_--)if(y instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=_,this._stack.fallThrough=!1,y;_--}for(;_>=0;_--)if(y=this._active[_].end(!1),y instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=_,this._stack.fallThrough=!0,y}else this._handlerFb(this._id,"END",f);this._active=u,this._id=-1,this._state=0}}},o.OscHandler=class{constructor(f){this._handler=f,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(f,d,y){this._hitLimit||(this._data+=(0,h.utf32ToString)(f,d,y),this._data.length>c.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(f){let d=!1;if(this._hitLimit)d=!1;else if(f&&(d=this._handler(this._data),d instanceof Promise))return d.then((y=>(this._data="",this._hitLimit=!1,y)));return this._data="",this._hitLimit=!1,d}}},8742:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Params=void 0;const a=2147483647;class c{static fromArray(u){const f=new c;if(!u.length)return f;for(let d=Array.isArray(u[0])?1:0;d<u.length;++d){const y=u[d];if(Array.isArray(y))for(let _=0;_<y.length;++_)f.addSubParam(y[_]);else f.addParam(y)}return f}constructor(u=32,f=32){if(this.maxLength=u,this.maxSubParamsLength=f,f>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(u),this.length=0,this._subParams=new Int32Array(f),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(u),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const u=new c(this.maxLength,this.maxSubParamsLength);return u.params.set(this.params),u.length=this.length,u._subParams.set(this._subParams),u._subParamsLength=this._subParamsLength,u._subParamsIdx.set(this._subParamsIdx),u._rejectDigits=this._rejectDigits,u._rejectSubDigits=this._rejectSubDigits,u._digitIsSub=this._digitIsSub,u}toArray(){const u=[];for(let f=0;f<this.length;++f){u.push(this.params[f]);const d=this._subParamsIdx[f]>>8,y=255&this._subParamsIdx[f];y-d>0&&u.push(Array.prototype.slice.call(this._subParams,d,y))}return u}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(u){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(u<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=u>a?a:u}}addSubParam(u){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(u<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=u>a?a:u,this._subParamsIdx[this.length-1]++}}hasSubParams(u){return(255&this._subParamsIdx[u])-(this._subParamsIdx[u]>>8)>0}getSubParams(u){const f=this._subParamsIdx[u]>>8,d=255&this._subParamsIdx[u];return d-f>0?this._subParams.subarray(f,d):null}getSubParamsAll(){const u={};for(let f=0;f<this.length;++f){const d=this._subParamsIdx[f]>>8,y=255&this._subParamsIdx[f];y-d>0&&(u[f]=this._subParams.slice(d,y))}return u}addDigit(u){let f;if(this._rejectDigits||!(f=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const d=this._digitIsSub?this._subParams:this.params,y=d[f-1];d[f-1]=~y?Math.min(10*y+u,a):u}}o.Params=c},5741:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.AddonManager=void 0,o.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let a=this._addons.length-1;a>=0;a--)this._addons[a].instance.dispose()}loadAddon(a,c){const h={instance:c,dispose:c.dispose,isDisposed:!1};this._addons.push(h),c.dispose=()=>this._wrappedAddonDispose(h),c.activate(a)}_wrappedAddonDispose(a){if(a.isDisposed)return;let c=-1;for(let h=0;h<this._addons.length;h++)if(this._addons[h]===a){c=h;break}if(c===-1)throw new Error("Could not dispose an addon that has not been loaded");a.isDisposed=!0,a.dispose.apply(a.instance),this._addons.splice(c,1)}}},8771:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferApiView=void 0;const c=a(3785),h=a(511);o.BufferApiView=class{constructor(u,f){this._buffer=u,this.type=f}init(u){return this._buffer=u,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(u){const f=this._buffer.lines.get(u);if(f)return new c.BufferLineApiView(f)}getNullCell(){return new h.CellData}}},3785:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferLineApiView=void 0;const c=a(511);o.BufferLineApiView=class{constructor(h){this._line=h}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(h,u){if(!(h<0||h>=this._line.length))return u?(this._line.loadCell(h,u),u):this._line.loadCell(h,new c.CellData)}translateToString(h,u,f){return this._line.translateToString(h,u,f)}}},8285:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferNamespaceApi=void 0;const c=a(8771),h=a(8460),u=a(844);class f extends u.Disposable{constructor(y){super(),this._core=y,this._onBufferChange=this.register(new h.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new c.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new c.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate((()=>this._onBufferChange.fire(this.active)))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}o.BufferNamespaceApi=f},7975:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ParserApi=void 0,o.ParserApi=class{constructor(a){this._core=a}registerCsiHandler(a,c){return this._core.registerCsiHandler(a,(h=>c(h.toArray())))}addCsiHandler(a,c){return this.registerCsiHandler(a,c)}registerDcsHandler(a,c){return this._core.registerDcsHandler(a,((h,u)=>c(h,u.toArray())))}addDcsHandler(a,c){return this.registerDcsHandler(a,c)}registerEscHandler(a,c){return this._core.registerEscHandler(a,c)}addEscHandler(a,c){return this.registerEscHandler(a,c)}registerOscHandler(a,c){return this._core.registerOscHandler(a,c)}addOscHandler(a,c){return this.registerOscHandler(a,c)}}},7090:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.UnicodeApi=void 0,o.UnicodeApi=class{constructor(a){this._core=a}register(a){this._core.unicodeService.register(a)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(a){this._core.unicodeService.activeVersion=a}}},744:function(l,o,a){var c=this&&this.__decorate||function(m,p,g,v){var b,S=arguments.length,x=S<3?p:v===null?v=Object.getOwnPropertyDescriptor(p,g):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(m,p,g,v);else for(var C=m.length-1;C>=0;C--)(b=m[C])&&(x=(S<3?b(x):S>3?b(p,g,x):b(p,g))||x);return S>3&&x&&Object.defineProperty(p,g,x),x},h=this&&this.__param||function(m,p){return function(g,v){p(g,v,m)}};Object.defineProperty(o,"__esModule",{value:!0}),o.BufferService=o.MINIMUM_ROWS=o.MINIMUM_COLS=void 0;const u=a(8460),f=a(844),d=a(5295),y=a(2585);o.MINIMUM_COLS=2,o.MINIMUM_ROWS=1;let _=o.BufferService=class extends f.Disposable{get buffer(){return this.buffers.active}constructor(m){super(),this.isUserScrolling=!1,this._onResize=this.register(new u.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new u.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(m.rawOptions.cols||0,o.MINIMUM_COLS),this.rows=Math.max(m.rawOptions.rows||0,o.MINIMUM_ROWS),this.buffers=this.register(new d.BufferSet(m,this))}resize(m,p){this.cols=m,this.rows=p,this.buffers.resize(m,p),this._onResize.fire({cols:m,rows:p})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(m,p=!1){const g=this.buffer;let v;v=this._cachedBlankLine,v&&v.length===this.cols&&v.getFg(0)===m.fg&&v.getBg(0)===m.bg||(v=g.getBlankLine(m,p),this._cachedBlankLine=v),v.isWrapped=p;const b=g.ybase+g.scrollTop,S=g.ybase+g.scrollBottom;if(g.scrollTop===0){const x=g.lines.isFull;S===g.lines.length-1?x?g.lines.recycle().copyFrom(v):g.lines.push(v.clone()):g.lines.splice(S+1,0,v.clone()),x?this.isUserScrolling&&(g.ydisp=Math.max(g.ydisp-1,0)):(g.ybase++,this.isUserScrolling||g.ydisp++)}else{const x=S-b+1;g.lines.shiftElements(b+1,x-1,-1),g.lines.set(S,v.clone())}this.isUserScrolling||(g.ydisp=g.ybase),this._onScroll.fire(g.ydisp)}scrollLines(m,p,g){const v=this.buffer;if(m<0){if(v.ydisp===0)return;this.isUserScrolling=!0}else m+v.ydisp>=v.ybase&&(this.isUserScrolling=!1);const b=v.ydisp;v.ydisp=Math.max(Math.min(v.ydisp+m,v.ybase),0),b!==v.ydisp&&(p||this._onScroll.fire(v.ydisp))}};o.BufferService=_=c([h(0,y.IOptionsService)],_)},7994:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CharsetService=void 0,o.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(a){this.glevel=a,this.charset=this._charsets[a]}setgCharset(a,c){this._charsets[a]=c,this.glevel===a&&(this.charset=c)}}},1753:function(l,o,a){var c=this&&this.__decorate||function(v,b,S,x){var C,w=arguments.length,E=w<3?b:x===null?x=Object.getOwnPropertyDescriptor(b,S):x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(v,b,S,x);else for(var A=v.length-1;A>=0;A--)(C=v[A])&&(E=(w<3?C(E):w>3?C(b,S,E):C(b,S))||E);return w>3&&E&&Object.defineProperty(b,S,E),E},h=this&&this.__param||function(v,b){return function(S,x){b(S,x,v)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CoreMouseService=void 0;const u=a(2585),f=a(8460),d=a(844),y={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:v=>v.button!==4&&v.action===1&&(v.ctrl=!1,v.alt=!1,v.shift=!1,!0)},VT200:{events:19,restrict:v=>v.action!==32},DRAG:{events:23,restrict:v=>v.action!==32||v.button!==3},ANY:{events:31,restrict:v=>!0}};function _(v,b){let S=(v.ctrl?16:0)|(v.shift?4:0)|(v.alt?8:0);return v.button===4?(S|=64,S|=v.action):(S|=3&v.button,4&v.button&&(S|=64),8&v.button&&(S|=128),v.action===32?S|=32:v.action!==0||b||(S|=3)),S}const m=String.fromCharCode,p={DEFAULT:v=>{const b=[_(v,!1)+32,v.col+32,v.row+32];return b[0]>255||b[1]>255||b[2]>255?"":`\x1B[M${m(b[0])}${m(b[1])}${m(b[2])}`},SGR:v=>{const b=v.action===0&&v.button!==4?"m":"M";return`\x1B[<${_(v,!0)};${v.col};${v.row}${b}`},SGR_PIXELS:v=>{const b=v.action===0&&v.button!==4?"m":"M";return`\x1B[<${_(v,!0)};${v.x};${v.y}${b}`}};let g=o.CoreMouseService=class extends d.Disposable{constructor(v,b){super(),this._bufferService=v,this._coreService=b,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new f.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const S of Object.keys(y))this.addProtocol(S,y[S]);for(const S of Object.keys(p))this.addEncoding(S,p[S]);this.reset()}addProtocol(v,b){this._protocols[v]=b}addEncoding(v,b){this._encodings[v]=b}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(v){if(!this._protocols[v])throw new Error(`unknown protocol "${v}"`);this._activeProtocol=v,this._onProtocolChange.fire(this._protocols[v].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(v){if(!this._encodings[v])throw new Error(`unknown encoding "${v}"`);this._activeEncoding=v}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(v){if(v.col<0||v.col>=this._bufferService.cols||v.row<0||v.row>=this._bufferService.rows||v.button===4&&v.action===32||v.button===3&&v.action!==32||v.button!==4&&(v.action===2||v.action===3)||(v.col++,v.row++,v.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,v,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(v))return!1;const b=this._encodings[this._activeEncoding](v);return b&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(b):this._coreService.triggerDataEvent(b,!0)),this._lastEvent=v,!0}explainEvents(v){return{down:!!(1&v),up:!!(2&v),drag:!!(4&v),move:!!(8&v),wheel:!!(16&v)}}_equalEvents(v,b,S){if(S){if(v.x!==b.x||v.y!==b.y)return!1}else if(v.col!==b.col||v.row!==b.row)return!1;return v.button===b.button&&v.action===b.action&&v.ctrl===b.ctrl&&v.alt===b.alt&&v.shift===b.shift}};o.CoreMouseService=g=c([h(0,u.IBufferService),h(1,u.ICoreService)],g)},6975:function(l,o,a){var c=this&&this.__decorate||function(g,v,b,S){var x,C=arguments.length,w=C<3?v:S===null?S=Object.getOwnPropertyDescriptor(v,b):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(g,v,b,S);else for(var E=g.length-1;E>=0;E--)(x=g[E])&&(w=(C<3?x(w):C>3?x(v,b,w):x(v,b))||w);return C>3&&w&&Object.defineProperty(v,b,w),w},h=this&&this.__param||function(g,v){return function(b,S){v(b,S,g)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CoreService=void 0;const u=a(1439),f=a(8460),d=a(844),y=a(2585),_=Object.freeze({insertMode:!1}),m=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let p=o.CoreService=class extends d.Disposable{constructor(g,v,b){super(),this._bufferService=g,this._logService=v,this._optionsService=b,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new f.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new f.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new f.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new f.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,u.clone)(_),this.decPrivateModes=(0,u.clone)(m)}reset(){this.modes=(0,u.clone)(_),this.decPrivateModes=(0,u.clone)(m)}triggerDataEvent(g,v=!1){if(this._optionsService.rawOptions.disableStdin)return;const b=this._bufferService.buffer;v&&this._optionsService.rawOptions.scrollOnUserInput&&b.ybase!==b.ydisp&&this._onRequestScrollToBottom.fire(),v&&this._onUserInput.fire(),this._logService.debug(`sending data "${g}"`,(()=>g.split("").map((S=>S.charCodeAt(0))))),this._onData.fire(g)}triggerBinaryEvent(g){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${g}"`,(()=>g.split("").map((v=>v.charCodeAt(0))))),this._onBinary.fire(g))}};o.CoreService=p=c([h(0,y.IBufferService),h(1,y.ILogService),h(2,y.IOptionsService)],p)},9074:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DecorationService=void 0;const c=a(8055),h=a(8460),u=a(844),f=a(6106);let d=0,y=0;class _ extends u.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new f.SortedList((g=>g==null?void 0:g.marker.line)),this._onDecorationRegistered=this.register(new h.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new h.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,u.toDisposable)((()=>this.reset())))}registerDecoration(g){if(g.marker.isDisposed)return;const v=new m(g);if(v){const b=v.marker.onDispose((()=>v.dispose()));v.onDispose((()=>{v&&(this._decorations.delete(v)&&this._onDecorationRemoved.fire(v),b.dispose())})),this._decorations.insert(v),this._onDecorationRegistered.fire(v)}return v}reset(){for(const g of this._decorations.values())g.dispose();this._decorations.clear()}*getDecorationsAtCell(g,v,b){let S=0,x=0;for(const C of this._decorations.getKeyIterator(v))S=C.options.x??0,x=S+(C.options.width??1),g>=S&&g<x&&(!b||(C.options.layer??"bottom")===b)&&(yield C)}forEachDecorationAtCell(g,v,b,S){this._decorations.forEachByKey(v,(x=>{d=x.options.x??0,y=d+(x.options.width??1),g>=d&&g<y&&(!b||(x.options.layer??"bottom")===b)&&S(x)}))}}o.DecorationService=_;class m extends u.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=c.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=c.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(g){super(),this.options=g,this.onRenderEmitter=this.register(new h.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new h.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=g.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.InstantiationService=o.ServiceCollection=void 0;const c=a(2585),h=a(8343);class u{constructor(...d){this._entries=new Map;for(const[y,_]of d)this.set(y,_)}set(d,y){const _=this._entries.get(d);return this._entries.set(d,y),_}forEach(d){for(const[y,_]of this._entries.entries())d(y,_)}has(d){return this._entries.has(d)}get(d){return this._entries.get(d)}}o.ServiceCollection=u,o.InstantiationService=class{constructor(){this._services=new u,this._services.set(c.IInstantiationService,this)}setService(f,d){this._services.set(f,d)}getService(f){return this._services.get(f)}createInstance(f,...d){const y=(0,h.getServiceDependencies)(f).sort(((p,g)=>p.index-g.index)),_=[];for(const p of y){const g=this._services.get(p.id);if(!g)throw new Error(`[createInstance] ${f.name} depends on UNKNOWN service ${p.id}.`);_.push(g)}const m=y.length>0?y[0].index:d.length;if(d.length!==m)throw new Error(`[createInstance] First service dependency of ${f.name} at position ${m+1} conflicts with ${d.length} static arguments`);return new f(...d,..._)}}},7866:function(l,o,a){var c=this&&this.__decorate||function(m,p,g,v){var b,S=arguments.length,x=S<3?p:v===null?v=Object.getOwnPropertyDescriptor(p,g):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(m,p,g,v);else for(var C=m.length-1;C>=0;C--)(b=m[C])&&(x=(S<3?b(x):S>3?b(p,g,x):b(p,g))||x);return S>3&&x&&Object.defineProperty(p,g,x),x},h=this&&this.__param||function(m,p){return function(g,v){p(g,v,m)}};Object.defineProperty(o,"__esModule",{value:!0}),o.traceCall=o.setTraceLogger=o.LogService=void 0;const u=a(844),f=a(2585),d={trace:f.LogLevelEnum.TRACE,debug:f.LogLevelEnum.DEBUG,info:f.LogLevelEnum.INFO,warn:f.LogLevelEnum.WARN,error:f.LogLevelEnum.ERROR,off:f.LogLevelEnum.OFF};let y,_=o.LogService=class extends u.Disposable{get logLevel(){return this._logLevel}constructor(m){super(),this._optionsService=m,this._logLevel=f.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",(()=>this._updateLogLevel()))),y=this}_updateLogLevel(){this._logLevel=d[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(m){for(let p=0;p<m.length;p++)typeof m[p]=="function"&&(m[p]=m[p]())}_log(m,p,g){this._evalLazyOptionalParams(g),m.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+p,...g)}trace(m,...p){var g;this._logLevel<=f.LogLevelEnum.TRACE&&this._log(((g=this._optionsService.options.logger)==null?void 0:g.trace.bind(this._optionsService.options.logger))??console.log,m,p)}debug(m,...p){var g;this._logLevel<=f.LogLevelEnum.DEBUG&&this._log(((g=this._optionsService.options.logger)==null?void 0:g.debug.bind(this._optionsService.options.logger))??console.log,m,p)}info(m,...p){var g;this._logLevel<=f.LogLevelEnum.INFO&&this._log(((g=this._optionsService.options.logger)==null?void 0:g.info.bind(this._optionsService.options.logger))??console.info,m,p)}warn(m,...p){var g;this._logLevel<=f.LogLevelEnum.WARN&&this._log(((g=this._optionsService.options.logger)==null?void 0:g.warn.bind(this._optionsService.options.logger))??console.warn,m,p)}error(m,...p){var g;this._logLevel<=f.LogLevelEnum.ERROR&&this._log(((g=this._optionsService.options.logger)==null?void 0:g.error.bind(this._optionsService.options.logger))??console.error,m,p)}};o.LogService=_=c([h(0,f.IOptionsService)],_),o.setTraceLogger=function(m){y=m},o.traceCall=function(m,p,g){if(typeof g.value!="function")throw new Error("not supported");const v=g.value;g.value=function(...b){if(y.logLevel!==f.LogLevelEnum.TRACE)return v.apply(this,b);y.trace(`GlyphRenderer#${v.name}(${b.map((x=>JSON.stringify(x))).join(", ")})`);const S=v.apply(this,b);return y.trace(`GlyphRenderer#${v.name} return`,S),S}}},7302:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.OptionsService=o.DEFAULT_OPTIONS=void 0;const c=a(8460),h=a(844),u=a(6114);o.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:u.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const f=["normal","bold","100","200","300","400","500","600","700","800","900"];class d extends h.Disposable{constructor(_){super(),this._onOptionChange=this.register(new c.EventEmitter),this.onOptionChange=this._onOptionChange.event;const m={...o.DEFAULT_OPTIONS};for(const p in _)if(p in m)try{const g=_[p];m[p]=this._sanitizeAndValidateOption(p,g)}catch(g){console.error(g)}this.rawOptions=m,this.options={...m},this._setupOptions(),this.register((0,h.toDisposable)((()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null})))}onSpecificOptionChange(_,m){return this.onOptionChange((p=>{p===_&&m(this.rawOptions[_])}))}onMultipleOptionChange(_,m){return this.onOptionChange((p=>{_.indexOf(p)!==-1&&m()}))}_setupOptions(){const _=p=>{if(!(p in o.DEFAULT_OPTIONS))throw new Error(`No option with key "${p}"`);return this.rawOptions[p]},m=(p,g)=>{if(!(p in o.DEFAULT_OPTIONS))throw new Error(`No option with key "${p}"`);g=this._sanitizeAndValidateOption(p,g),this.rawOptions[p]!==g&&(this.rawOptions[p]=g,this._onOptionChange.fire(p))};for(const p in this.rawOptions){const g={get:_.bind(this,p),set:m.bind(this,p)};Object.defineProperty(this.options,p,g)}}_sanitizeAndValidateOption(_,m){switch(_){case"cursorStyle":if(m||(m=o.DEFAULT_OPTIONS[_]),!(function(p){return p==="block"||p==="underline"||p==="bar"})(m))throw new Error(`"${m}" is not a valid value for ${_}`);break;case"wordSeparator":m||(m=o.DEFAULT_OPTIONS[_]);break;case"fontWeight":case"fontWeightBold":if(typeof m=="number"&&1<=m&&m<=1e3)break;m=f.includes(m)?m:o.DEFAULT_OPTIONS[_];break;case"cursorWidth":m=Math.floor(m);case"lineHeight":case"tabStopWidth":if(m<1)throw new Error(`${_} cannot be less than 1, value: ${m}`);break;case"minimumContrastRatio":m=Math.max(1,Math.min(21,Math.round(10*m)/10));break;case"scrollback":if((m=Math.min(m,4294967295))<0)throw new Error(`${_} cannot be less than 0, value: ${m}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(m<=0)throw new Error(`${_} cannot be less than or equal to 0, value: ${m}`);break;case"rows":case"cols":if(!m&&m!==0)throw new Error(`${_} must be numeric, value: ${m}`);break;case"windowsPty":m=m??{}}return m}}o.OptionsService=d},2660:function(l,o,a){var c=this&&this.__decorate||function(d,y,_,m){var p,g=arguments.length,v=g<3?y:m===null?m=Object.getOwnPropertyDescriptor(y,_):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(d,y,_,m);else for(var b=d.length-1;b>=0;b--)(p=d[b])&&(v=(g<3?p(v):g>3?p(y,_,v):p(y,_))||v);return g>3&&v&&Object.defineProperty(y,_,v),v},h=this&&this.__param||function(d,y){return function(_,m){y(_,m,d)}};Object.defineProperty(o,"__esModule",{value:!0}),o.OscLinkService=void 0;const u=a(2585);let f=o.OscLinkService=class{constructor(d){this._bufferService=d,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(d){const y=this._bufferService.buffer;if(d.id===void 0){const b=y.addMarker(y.ybase+y.y),S={data:d,id:this._nextId++,lines:[b]};return b.onDispose((()=>this._removeMarkerFromLink(S,b))),this._dataByLinkId.set(S.id,S),S.id}const _=d,m=this._getEntryIdKey(_),p=this._entriesWithId.get(m);if(p)return this.addLineToLink(p.id,y.ybase+y.y),p.id;const g=y.addMarker(y.ybase+y.y),v={id:this._nextId++,key:this._getEntryIdKey(_),data:_,lines:[g]};return g.onDispose((()=>this._removeMarkerFromLink(v,g))),this._entriesWithId.set(v.key,v),this._dataByLinkId.set(v.id,v),v.id}addLineToLink(d,y){const _=this._dataByLinkId.get(d);if(_&&_.lines.every((m=>m.line!==y))){const m=this._bufferService.buffer.addMarker(y);_.lines.push(m),m.onDispose((()=>this._removeMarkerFromLink(_,m)))}}getLinkData(d){var y;return(y=this._dataByLinkId.get(d))==null?void 0:y.data}_getEntryIdKey(d){return`${d.id};;${d.uri}`}_removeMarkerFromLink(d,y){const _=d.lines.indexOf(y);_!==-1&&(d.lines.splice(_,1),d.lines.length===0&&(d.data.id!==void 0&&this._entriesWithId.delete(d.key),this._dataByLinkId.delete(d.id)))}};o.OscLinkService=f=c([h(0,u.IBufferService)],f)},8343:(l,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.createDecorator=o.getServiceDependencies=o.serviceRegistry=void 0;const a="di$target",c="di$dependencies";o.serviceRegistry=new Map,o.getServiceDependencies=function(h){return h[c]||[]},o.createDecorator=function(h){if(o.serviceRegistry.has(h))return o.serviceRegistry.get(h);const u=function(f,d,y){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(_,m,p){m[a]===m?m[c].push({id:_,index:p}):(m[c]=[{id:_,index:p}],m[a]=m)})(u,f,y)};return u.toString=()=>h,o.serviceRegistry.set(h,u),u}},2585:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.IDecorationService=o.IUnicodeService=o.IOscLinkService=o.IOptionsService=o.ILogService=o.LogLevelEnum=o.IInstantiationService=o.ICharsetService=o.ICoreService=o.ICoreMouseService=o.IBufferService=void 0;const c=a(8343);var h;o.IBufferService=(0,c.createDecorator)("BufferService"),o.ICoreMouseService=(0,c.createDecorator)("CoreMouseService"),o.ICoreService=(0,c.createDecorator)("CoreService"),o.ICharsetService=(0,c.createDecorator)("CharsetService"),o.IInstantiationService=(0,c.createDecorator)("InstantiationService"),(function(u){u[u.TRACE=0]="TRACE",u[u.DEBUG=1]="DEBUG",u[u.INFO=2]="INFO",u[u.WARN=3]="WARN",u[u.ERROR=4]="ERROR",u[u.OFF=5]="OFF"})(h||(o.LogLevelEnum=h={})),o.ILogService=(0,c.createDecorator)("LogService"),o.IOptionsService=(0,c.createDecorator)("OptionsService"),o.IOscLinkService=(0,c.createDecorator)("OscLinkService"),o.IUnicodeService=(0,c.createDecorator)("UnicodeService"),o.IDecorationService=(0,c.createDecorator)("DecorationService")},1480:(l,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.UnicodeService=void 0;const c=a(8460),h=a(225);class u{static extractShouldJoin(d){return(1&d)!=0}static extractWidth(d){return d>>1&3}static extractCharKind(d){return d>>3}static createPropertyValue(d,y,_=!1){return(16777215&d)<<3|(3&y)<<1|(_?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new c.EventEmitter,this.onChange=this._onChange.event;const d=new h.UnicodeV6;this.register(d),this._active=d.version,this._activeProvider=d}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(d){if(!this._providers[d])throw new Error(`unknown Unicode version "${d}"`);this._active=d,this._activeProvider=this._providers[d],this._onChange.fire(d)}register(d){this._providers[d.version]=d}wcwidth(d){return this._activeProvider.wcwidth(d)}getStringCellWidth(d){let y=0,_=0;const m=d.length;for(let p=0;p<m;++p){let g=d.charCodeAt(p);if(55296<=g&&g<=56319){if(++p>=m)return y+this.wcwidth(g);const S=d.charCodeAt(p);56320<=S&&S<=57343?g=1024*(g-55296)+S-56320+65536:y+=this.wcwidth(S)}const v=this.charProperties(g,_);let b=u.extractWidth(v);u.extractShouldJoin(v)&&(b-=u.extractWidth(_)),y+=b,_=v}return y}charProperties(d,y){return this._activeProvider.charProperties(d,y)}}o.UnicodeService=u}},r={};function n(l){var o=r[l];if(o!==void 0)return o.exports;var a=r[l]={exports:{}};return t[l].call(a.exports,a,a.exports,n),a.exports}var s={};return(()=>{var l=s;Object.defineProperty(l,"__esModule",{value:!0}),l.Terminal=void 0;const o=n(9042),a=n(3236),c=n(844),h=n(5741),u=n(8285),f=n(7975),d=n(7090),y=["cols","rows"];class _ extends c.Disposable{constructor(p){super(),this._core=this.register(new a.Terminal(p)),this._addonManager=this.register(new h.AddonManager),this._publicOptions={...this._core.options};const g=b=>this._core.options[b],v=(b,S)=>{this._checkReadonlyOptions(b),this._core.options[b]=S};for(const b in this._core.options){const S={get:g.bind(this,b),set:v.bind(this,b)};Object.defineProperty(this._publicOptions,b,S)}}_checkReadonlyOptions(p){if(y.includes(p))throw new Error(`Option "${p}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new f.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new d.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new u.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const p=this._core.coreService.decPrivateModes;let g="none";switch(this._core.coreMouseService.activeProtocol){case"X10":g="x10";break;case"VT200":g="vt200";break;case"DRAG":g="drag";break;case"ANY":g="any"}return{applicationCursorKeysMode:p.applicationCursorKeys,applicationKeypadMode:p.applicationKeypad,bracketedPasteMode:p.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:g,originMode:p.origin,reverseWraparoundMode:p.reverseWraparound,sendFocusMode:p.sendFocus,wraparoundMode:p.wraparound}}get options(){return this._publicOptions}set options(p){for(const g in p)this._publicOptions[g]=p[g]}blur(){this._core.blur()}focus(){this._core.focus()}input(p,g=!0){this._core.input(p,g)}resize(p,g){this._verifyIntegers(p,g),this._core.resize(p,g)}open(p){this._core.open(p)}attachCustomKeyEventHandler(p){this._core.attachCustomKeyEventHandler(p)}attachCustomWheelEventHandler(p){this._core.attachCustomWheelEventHandler(p)}registerLinkProvider(p){return this._core.registerLinkProvider(p)}registerCharacterJoiner(p){return this._checkProposedApi(),this._core.registerCharacterJoiner(p)}deregisterCharacterJoiner(p){this._checkProposedApi(),this._core.deregisterCharacterJoiner(p)}registerMarker(p=0){return this._verifyIntegers(p),this._core.registerMarker(p)}registerDecoration(p){return this._checkProposedApi(),this._verifyPositiveIntegers(p.x??0,p.width??0,p.height??0),this._core.registerDecoration(p)}hasSelection(){return this._core.hasSelection()}select(p,g,v){this._verifyIntegers(p,g,v),this._core.select(p,g,v)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(p,g){this._verifyIntegers(p,g),this._core.selectLines(p,g)}dispose(){super.dispose()}scrollLines(p){this._verifyIntegers(p),this._core.scrollLines(p)}scrollPages(p){this._verifyIntegers(p),this._core.scrollPages(p)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(p){this._verifyIntegers(p),this._core.scrollToLine(p)}clear(){this._core.clear()}write(p,g){this._core.write(p,g)}writeln(p,g){this._core.write(p),this._core.write(`\r
`,g)}paste(p){this._core.paste(p)}refresh(p,g){this._verifyIntegers(p,g),this._core.refresh(p,g)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(p){this._addonManager.loadAddon(this,p)}static get strings(){return o}_verifyIntegers(...p){for(const g of p)if(g===1/0||isNaN(g)||g%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...p){for(const g of p)if(g&&(g===1/0||isNaN(g)||g%1!=0||g<0))throw new Error("This API only accepts positive integers")}}l.Terminal=_})(),s})()))})(ul)),ul.exports}var mC=pC(),fl={exports:{}},Lu;function gC(){return Lu||(Lu=1,(function(i,e){(function(t,r){i.exports=r()})(self,(()=>(()=>{var t={};return(()=>{var r=t;Object.defineProperty(r,"__esModule",{value:!0}),r.FitAddon=void 0,r.FitAddon=class{activate(n){this._terminal=n}dispose(){}fit(){const n=this.proposeDimensions();if(!n||!this._terminal||isNaN(n.cols)||isNaN(n.rows))return;const s=this._terminal._core;this._terminal.rows===n.rows&&this._terminal.cols===n.cols||(s._renderService.clear(),this._terminal.resize(n.cols,n.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;const n=this._terminal._core,s=n._renderService.dimensions;if(s.css.cell.width===0||s.css.cell.height===0)return;const l=this._terminal.options.scrollback===0?0:n.viewport.scrollBarWidth,o=window.getComputedStyle(this._terminal.element.parentElement),a=parseInt(o.getPropertyValue("height")),c=Math.max(0,parseInt(o.getPropertyValue("width"))),h=window.getComputedStyle(this._terminal.element),u=a-(parseInt(h.getPropertyValue("padding-top"))+parseInt(h.getPropertyValue("padding-bottom"))),f=c-(parseInt(h.getPropertyValue("padding-right"))+parseInt(h.getPropertyValue("padding-left")))-l;return{cols:Math.max(2,Math.floor(f/s.css.cell.width)),rows:Math.max(1,Math.floor(u/s.css.cell.height))}}}})(),t})()))})(fl)),fl.exports}var vC=gC(),dl={exports:{}},Mu;function _C(){return Mu||(Mu=1,(function(i,e){(function(t,r){i.exports=r()})(self,(()=>(()=>{var t={6:(l,o)=>{function a(h){try{const u=new URL(h),f=u.password&&u.username?`${u.protocol}//${u.username}:${u.password}@${u.host}`:u.username?`${u.protocol}//${u.username}@${u.host}`:`${u.protocol}//${u.host}`;return h.toLocaleLowerCase().startsWith(f.toLocaleLowerCase())}catch{return!1}}Object.defineProperty(o,"__esModule",{value:!0}),o.LinkComputer=o.WebLinkProvider=void 0,o.WebLinkProvider=class{constructor(h,u,f,d={}){this._terminal=h,this._regex=u,this._handler=f,this._options=d}provideLinks(h,u){const f=c.computeLink(h,this._regex,this._terminal,this._handler);u(this._addCallbacks(f))}_addCallbacks(h){return h.map((u=>(u.leave=this._options.leave,u.hover=(f,d)=>{if(this._options.hover){const{range:y}=u;this._options.hover(f,d,y)}},u)))}};class c{static computeLink(u,f,d,y){const _=new RegExp(f.source,(f.flags||"")+"g"),[m,p]=c._getWindowedLineStrings(u-1,d),g=m.join("");let v;const b=[];for(;v=_.exec(g);){const S=v[0];if(!a(S))continue;const[x,C]=c._mapStrIdx(d,p,0,v.index),[w,E]=c._mapStrIdx(d,x,C,S.length);if(x===-1||C===-1||w===-1||E===-1)continue;const A={start:{x:C+1,y:x+1},end:{x:E,y:w+1}};b.push({range:A,text:S,activate:y})}return b}static _getWindowedLineStrings(u,f){let d,y=u,_=u,m=0,p="";const g=[];if(d=f.buffer.active.getLine(u)){const v=d.translateToString(!0);if(d.isWrapped&&v[0]!==" "){for(m=0;(d=f.buffer.active.getLine(--y))&&m<2048&&(p=d.translateToString(!0),m+=p.length,g.push(p),d.isWrapped&&p.indexOf(" ")===-1););g.reverse()}for(g.push(v),m=0;(d=f.buffer.active.getLine(++_))&&d.isWrapped&&m<2048&&(p=d.translateToString(!0),m+=p.length,g.push(p),p.indexOf(" ")===-1););}return[g,y]}static _mapStrIdx(u,f,d,y){const _=u.buffer.active,m=_.getNullCell();let p=d;for(;y;){const g=_.getLine(f);if(!g)return[-1,-1];for(let v=p;v<g.length;++v){g.getCell(v,m);const b=m.getChars();if(m.getWidth()&&(y-=b.length||1,v===g.length-1&&b==="")){const S=_.getLine(f+1);S&&S.isWrapped&&(S.getCell(0,m),m.getWidth()===2&&(y+=1))}if(y<0)return[f,v]}f++,p=0}return[f,p]}}o.LinkComputer=c}},r={};function n(l){var o=r[l];if(o!==void 0)return o.exports;var a=r[l]={exports:{}};return t[l](a,a.exports,n),a.exports}var s={};return(()=>{var l=s;Object.defineProperty(l,"__esModule",{value:!0}),l.WebLinksAddon=void 0;const o=n(6),a=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function c(h,u){const f=window.open();if(f){try{f.opener=null}catch{}f.location.href=u}else console.warn("Opening link blocked as opener could not be cleared")}l.WebLinksAddon=class{constructor(h=c,u={}){this._handler=h,this._options=u}activate(h){this._terminal=h;const u=this._options,f=u.urlRegex||a;this._linkProvider=this._terminal.registerLinkProvider(new o.WebLinkProvider(this._terminal,f,this._handler,u))}dispose(){var h;(h=this._linkProvider)==null||h.dispose()}}})(),s})()))})(dl)),dl.exports}var yC=_C();const Zi="/api";function bC({projectId:i,isMaximized:e=!1,onToggleMaximize:t,suggestedPrompts:r,className:n="",onFilesChanged:s}){const l=N.useRef(null),o=N.useRef(null),a=N.useRef(null),c=N.useRef(null),h=N.useRef(null),u=N.useRef(0),f=N.useRef(100),[d,y]=N.useState("connecting"),[_,m]=N.useState(null),[p,g]=N.useState(!1),v=N.useRef(!1),b=N.useRef(!1),S=N.useRef(null),x=N.useRef(0),C=N.useRef(""),w=N.useRef(null),E=N.useCallback(()=>{h.current&&(clearTimeout(h.current),h.current=null)},[]),A=N.useCallback(()=>{const z=C.current;C.current="",w.current=null;const $=c.current;!z||!$||fetch(`${Zi}/projects/${i}/pty/${$}/input`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:btoa(z)})}).catch(()=>{})},[i]),M=N.useCallback(async z=>{const $=o.current;if(!$)return;const{cols:V,rows:L}=$;try{(await fetch(`${Zi}/projects/${i}/pty/${z}/resize`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cols:V,rows:L})})).ok||(console.warn("Resize failed, reconnecting terminal..."),S.current&&S.current())}catch(k){console.error("Resize error:",k),S.current&&S.current()}},[i]),T=N.useCallback(z=>{E(),f.current=50;const $=async()=>{var V,L;try{const k=f.current<200?3:1,I=await fetch(`${Zi}/projects/${i}/pty/${z}/output?timeout=${k}`,{method:"POST"});if(I.status===404){console.warn("Session lost (404), reconnecting..."),E(),S.current&&S.current();return}if(!I.ok)throw new Error(`HTTP ${I.status}`);const H=await I.json();if(u.current=0,H.output){f.current=50;const P=atob(H.output),X=new Uint8Array(P.length);for(let ee=0;ee<P.length;ee++)X[ee]=P.charCodeAt(ee);(V=o.current)==null||V.write(X)}else f.current=Math.min(f.current*2,2e3);H.files_modified_at&&H.files_modified_at>x.current&&(x.current=H.files_modified_at,s==null||s()),H.exited?((L=o.current)==null||L.writeln(`\r
\x1B[33m⚠ Process exited\x1B[0m`),y("disconnected"),E()):h.current=setTimeout($,f.current)}catch{u.current++,u.current>=5?(y("error"),m("Connection lost"),E()):h.current=setTimeout($,f.current)}};$()},[i,E,s]),B=N.useCallback(async()=>{var z,$,V;if(!(!o.current||v.current)){v.current=!0,y("connecting"),m(null);try{const L=await fetch(`${Zi}/projects/${i}/pty/create`,{method:"POST"});if(!L.ok){const I=await L.json().catch(()=>({detail:`HTTP ${L.status}`}));throw new Error(I.detail||`HTTP ${L.status}`)}const k=await L.json();c.current=k.session_id,y("connected"),(z=o.current)==null||z.writeln(`\x1B[32m✓ Connected (session ${k.session_id.slice(0,8)})\x1B[0m`),($=o.current)==null||$.writeln(""),T(k.session_id),setTimeout(()=>{if(a.current)try{a.current.fit()}catch{}M(k.session_id)},100)}catch(L){y("error"),m(L instanceof Error?L.message:String(L)),(V=o.current)==null||V.writeln(`\x1B[31m✗ Error: ${L instanceof Error?L.message:L}\x1B[0m`)}finally{v.current=!1}}},[i,T,M]);N.useEffect(()=>{if(!l.current||o.current)return;const z=new mC.Terminal({cursorBlink:!0,fontSize:13,fontFamily:"JetBrains Mono, Menlo, Monaco, Consolas, monospace",theme:{background:"#1e1e1e",foreground:"#d4d4d4",cursor:"#d4d4d4",cursorAccent:"#1e1e1e",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#ffffff"},allowProposedApi:!0}),$=new vC.FitAddon,V=new yC.WebLinksAddon;return z.loadAddon($),z.loadAddon(V),z.open(l.current),requestAnimationFrame(()=>{try{$.fit()}catch{}}),o.current=z,a.current=$,z.writeln("\x1B[1;34m╭─────────────────────────────────────────────────────╮\x1B[0m"),z.writeln("\x1B[1;34m│\x1B[0m  \x1B[1;33mClaude Code Terminal\x1B[0m                               \x1B[1;34m│\x1B[0m"),z.writeln("\x1B[1;34m│\x1B[0m  Connecting to Databricks-authenticated session...  \x1B[1;34m│\x1B[0m"),z.writeln("\x1B[1;34m╰─────────────────────────────────────────────────────╯\x1B[0m"),z.writeln(""),z.onData(L=>{c.current&&(C.current+=L,f.current=50,w.current||(w.current=setTimeout(()=>{A()},15)))}),()=>{z.dispose(),o.current=null,a.current=null}},[]),N.useEffect(()=>{const z=setTimeout(()=>{o.current&&B()},100);return()=>{clearTimeout(z),E(),w.current&&(clearTimeout(w.current),w.current=null)}},[B,E,i]),N.useEffect(()=>{const z=()=>{const $=c.current;$&&navigator.sendBeacon(`${Zi}/projects/${i}/pty/${$}/terminate`,"")};return window.addEventListener("beforeunload",z),()=>window.removeEventListener("beforeunload",z)},[i]),N.useEffect(()=>{const z=()=>{if(a.current&&o.current)try{a.current.fit();const k=c.current;k&&M(k)}catch{}};let $;const V=()=>{clearTimeout($),$=setTimeout(z,250)};window.addEventListener("resize",V);const L=new ResizeObserver(V);return l.current&&L.observe(l.current),()=>{window.removeEventListener("resize",V),L.disconnect(),clearTimeout($)}},[M]);const F=N.useCallback(z=>{g(!0);const $=c.current;if(!$)return;const V=btoa(z+`
`);fetch(`${Zi}/projects/${i}/pty/${$}/input`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:V})}).catch(()=>{})},[i]),j=N.useCallback(()=>{if(b.current)return;b.current=!0,o.current&&o.current.write(`\r
\x1B[33mReconnecting session...\x1B[0m\r
`),E();const z=c.current;z&&(fetch(`${Zi}/projects/${i}/pty/${z}`,{method:"DELETE"}).catch(()=>{}),c.current=null),v.current=!1,B().then(()=>{b.current=!1}).catch($=>{console.error("Reconnection failed:",$),b.current=!1,y("error")})},[B,i,E]);return S.current=j,D.jsxs("div",{className:ue("relative h-full w-full flex flex-col",n),children:[D.jsxs("div",{className:"flex items-center justify-between h-8 px-3 bg-[#252526] border-b border-[#3c3c3c] flex-shrink-0",children:[D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx("span",{className:"text-xs text-[#d4d4d4] font-medium",children:"Claude Code"}),D.jsxs("span",{className:ue("inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px]",d==="connected"&&"bg-green-500/20 text-green-400",d==="connecting"&&"bg-blue-500/20 text-blue-400",d==="disconnected"&&"bg-yellow-500/20 text-yellow-400",d==="error"&&"bg-red-500/20 text-red-400"),children:[d==="connecting"&&D.jsx(Ni,{className:"h-2.5 w-2.5 animate-spin"}),d==="connected"&&"●",d==="disconnected"&&"○",d==="error"&&D.jsx(bh,{className:"h-2.5 w-2.5"}),d]})]}),D.jsxs("div",{className:"flex items-center gap-1",children:[(d==="disconnected"||d==="error")&&D.jsxs("button",{onClick:j,className:"flex items-center gap-1 px-2 py-0.5 text-[10px] text-[#d4d4d4] hover:text-white hover:bg-[#3c3c3c] rounded transition-colors",children:[D.jsx(Xr,{className:"h-2.5 w-2.5"}),"Reconnect"]}),t&&D.jsx("button",{onClick:t,className:"flex items-center justify-center p-1 text-[#d4d4d4] hover:text-white hover:bg-[#3c3c3c] rounded transition-colors",title:e?"Restore":"Maximize",children:e?D.jsx(jv,{className:"h-3.5 w-3.5"}):D.jsx(Fv,{className:"h-3.5 w-3.5"})})]})]}),D.jsx("div",{ref:l,className:"flex-1 overflow-hidden",style:{padding:"8px"}}),r&&r.length>0&&!p&&d==="connected"&&D.jsx("div",{className:"absolute bottom-2 left-2 right-2 z-10",children:D.jsxs("div",{className:"bg-[#252526]/95 border border-[#3c3c3c] rounded-lg p-3 backdrop-blur-sm",children:[D.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[D.jsx(Wl,{className:"h-3 w-3 text-[#d4d4d4]"}),D.jsx("span",{className:"text-[10px] text-[#808080] uppercase tracking-wide",children:"Suggested prompts"})]}),D.jsx("div",{className:"flex flex-col gap-1.5",children:r.map((z,$)=>D.jsx("button",{onClick:()=>F(z),className:"text-left text-xs text-[#d4d4d4] hover:text-white bg-[#1e1e1e] hover:bg-[#2d2d2d] rounded px-2.5 py-1.5 transition-colors border border-[#3c3c3c] hover:border-[#505050]",children:z},$))})]})}),d==="error"&&_&&D.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 z-10",children:D.jsxs("div",{className:"bg-[#252526] border border-[#3c3c3c] rounded-lg p-4 max-w-md text-center",children:[D.jsx(bh,{className:"h-8 w-8 text-red-400 mx-auto mb-2"}),D.jsx("h3",{className:"text-sm font-medium text-[#d4d4d4] mb-1",children:"Connection Error"}),D.jsx("p",{className:"text-xs text-[#808080] mb-3",children:_}),D.jsx("button",{onClick:j,className:"px-3 py-1.5 bg-[#0e639c] hover:bg-[#1177bb] text-white text-xs rounded transition-colors",children:"Try Again"})]})})]})}function xC({lines:i,className:e=""}){return i.length===0?D.jsx("div",{className:ue("h-full flex items-center justify-center text-[var(--color-text-muted)] text-sm",e),children:"No output yet"}):D.jsx("div",{className:ue("h-full overflow-y-auto bg-[var(--color-background)] p-2 font-mono text-xs",e),children:i.map(t=>D.jsxs("div",{className:ue("py-0.5",t.level==="error"&&"text-red-400",t.level==="warning"&&"text-yellow-400",t.level==="info"&&"text-[var(--color-text-primary)]"),children:[D.jsxs("span",{className:"text-[var(--color-text-muted)]",children:["[",t.timestamp.toLocaleTimeString(),"]"]}),t.source&&D.jsxs("span",{className:"text-[var(--color-accent-primary)] ml-1",children:["[",t.source,"]"]}),D.jsx("span",{className:"ml-1",children:t.message})]},t.id))})}let na=[],Yp=[];(()=>{let i="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(e=>e?parseInt(e,36):1);for(let e=0,t=0;e<i.length;e++)(e%2?Yp:na).push(t=t+i[e])})();function SC(i){if(i<768)return!1;for(let e=0,t=na.length;;){let r=e+t>>1;if(i<na[r])t=r;else if(i>=Yp[r])e=r+1;else return!0;if(e==t)return!1}}function Tu(i){return i>=127462&&i<=127487}const Ru=8205;function wC(i,e,t=!0,r=!0){return(t?Qp:CC)(i,e,r)}function Qp(i,e,t){if(e==i.length)return e;e&&Zp(i.charCodeAt(e))&&em(i.charCodeAt(e-1))&&e--;let r=pl(i,e);for(e+=Pu(r);e<i.length;){let n=pl(i,e);if(r==Ru||n==Ru||t&&SC(n))e+=Pu(n),r=n;else if(Tu(n)){let s=0,l=e-2;for(;l>=0&&Tu(pl(i,l));)s++,l-=2;if(s%2==0)break;e+=2}else break}return e}function CC(i,e,t){for(;e>0;){let r=Qp(i,e-2,t);if(r<e)return r;e--}return 0}function pl(i,e){let t=i.charCodeAt(e);if(!em(t)||e+1==i.length)return t;let r=i.charCodeAt(e+1);return Zp(r)?(t-55296<<10)+(r-56320)+65536:t}function Zp(i){return i>=56320&&i<57344}function em(i){return i>=55296&&i<56320}function Pu(i){return i<65536?1:2}let Ee=class tm{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,r){[e,t]=zr(this,e,t);let n=[];return this.decompose(0,e,n,2),r.length&&r.decompose(0,r.length,n,3),this.decompose(t,this.length,n,1),li.from(n,this.length-(t-e)+r.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){[e,t]=zr(this,e,t);let r=[];return this.decompose(e,t,r,0),li.from(r,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),r=this.length-this.scanIdentical(e,-1),n=new bn(this),s=new bn(e);for(let l=t,o=t;;){if(n.next(l),s.next(l),l=0,n.lineBreak!=s.lineBreak||n.done!=s.done||n.value!=s.value)return!1;if(o+=n.value.length,n.done||o>=r)return!0}}iter(e=1){return new bn(this,e)}iterRange(e,t=this.length){return new im(this,e,t)}iterLines(e,t){let r;if(e==null)r=this.iter();else{t==null&&(t=this.lines+1);let n=this.line(e).from;r=this.iterRange(n,Math.max(n,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new rm(r)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?tm.empty:e.length<=32?new je(e):li.from(je.split(e,[]))}};class je extends Ee{constructor(e,t=kC(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,r,n){for(let s=0;;s++){let l=this.text[s],o=n+l.length;if((t?r:o)>=e)return new EC(n,o,r,l);n=o+1,r++}}decompose(e,t,r,n){let s=e<=0&&t>=this.length?this:new je(Bu(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(n&1){let l=r.pop(),o=Hs(s.text,l.text.slice(),0,s.length);if(o.length<=32)r.push(new je(o,l.length+s.length));else{let a=o.length>>1;r.push(new je(o.slice(0,a)),new je(o.slice(a)))}}else r.push(s)}replace(e,t,r){if(!(r instanceof je))return super.replace(e,t,r);[e,t]=zr(this,e,t);let n=Hs(this.text,Hs(r.text,Bu(this.text,0,e)),t),s=this.length+r.length-(t-e);return n.length<=32?new je(n,s):li.from(je.split(n,[]),s)}sliceString(e,t=this.length,r=`
`){[e,t]=zr(this,e,t);let n="";for(let s=0,l=0;s<=t&&l<this.text.length;l++){let o=this.text[l],a=s+o.length;s>e&&l&&(n+=r),e<a&&t>s&&(n+=o.slice(Math.max(0,e-s),t-s)),s=a+1}return n}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let r=[],n=-1;for(let s of e)r.push(s),n+=s.length+1,r.length==32&&(t.push(new je(r,n)),r=[],n=-1);return n>-1&&t.push(new je(r,n)),t}}class li extends Ee{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let r of e)this.lines+=r.lines}lineInner(e,t,r,n){for(let s=0;;s++){let l=this.children[s],o=n+l.length,a=r+l.lines-1;if((t?a:o)>=e)return l.lineInner(e,t,r,n);n=o+1,r=a+1}}decompose(e,t,r,n){for(let s=0,l=0;l<=t&&s<this.children.length;s++){let o=this.children[s],a=l+o.length;if(e<=a&&t>=l){let c=n&((l<=e?1:0)|(a>=t?2:0));l>=e&&a<=t&&!c?r.push(o):o.decompose(e-l,t-l,r,c)}l=a+1}}replace(e,t,r){if([e,t]=zr(this,e,t),r.lines<this.lines)for(let n=0,s=0;n<this.children.length;n++){let l=this.children[n],o=s+l.length;if(e>=s&&t<=o){let a=l.replace(e-s,t-s,r),c=this.lines-l.lines+a.lines;if(a.lines<c>>4&&a.lines>c>>6){let h=this.children.slice();return h[n]=a,new li(h,this.length-(t-e)+r.length)}return super.replace(s,o,a)}s=o+1}return super.replace(e,t,r)}sliceString(e,t=this.length,r=`
`){[e,t]=zr(this,e,t);let n="";for(let s=0,l=0;s<this.children.length&&l<=t;s++){let o=this.children[s],a=l+o.length;l>e&&s&&(n+=r),e<a&&t>l&&(n+=o.sliceString(e-l,t-l,r)),l=a+1}return n}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof li))return 0;let r=0,[n,s,l,o]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;n+=t,s+=t){if(n==l||s==o)return r;let a=this.children[n],c=e.children[s];if(a!=c)return r+a.scanIdentical(c,t);r+=a.length+1}}static from(e,t=e.reduce((r,n)=>r+n.length+1,-1)){let r=0;for(let d of e)r+=d.lines;if(r<32){let d=[];for(let y of e)y.flatten(d);return new je(d,t)}let n=Math.max(32,r>>5),s=n<<1,l=n>>1,o=[],a=0,c=-1,h=[];function u(d){let y;if(d.lines>s&&d instanceof li)for(let _ of d.children)u(_);else d.lines>l&&(a>l||!a)?(f(),o.push(d)):d instanceof je&&a&&(y=h[h.length-1])instanceof je&&d.lines+y.lines<=32?(a+=d.lines,c+=d.length+1,h[h.length-1]=new je(y.text.concat(d.text),y.length+1+d.length)):(a+d.lines>n&&f(),a+=d.lines,c+=d.length+1,h.push(d))}function f(){a!=0&&(o.push(h.length==1?h[0]:li.from(h,c)),c=-1,a=h.length=0)}for(let d of e)u(d);return f(),o.length==1?o[0]:new li(o,t)}}Ee.empty=new je([""],0);function kC(i){let e=-1;for(let t of i)e+=t.length+1;return e}function Hs(i,e,t=0,r=1e9){for(let n=0,s=0,l=!0;s<i.length&&n<=r;s++){let o=i[s],a=n+o.length;a>=t&&(a>r&&(o=o.slice(0,r-n)),n<t&&(o=o.slice(t-n)),l?(e[e.length-1]+=o,l=!1):e.push(o)),n=a+1}return e}function Bu(i,e,t){return Hs(i,[""],e,t)}class bn{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof je?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let r=this.nodes.length-1,n=this.nodes[r],s=this.offsets[r],l=s>>1,o=n instanceof je?n.text.length:n.children.length;if(l==(t>0?o:0)){if(r==0)return this.done=!0,this.value="",this;t>0&&this.offsets[r-1]++,this.nodes.pop(),this.offsets.pop()}else if((s&1)==(t>0?0:1)){if(this.offsets[r]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(n instanceof je){let a=n.text[l+(t<0?-1:0)];if(this.offsets[r]+=t,a.length>Math.max(0,e))return this.value=e==0?a:t>0?a.slice(e):a.slice(0,a.length-e),this;e-=a.length}else{let a=n.children[l+(t<0?-1:0)];e>a.length?(e-=a.length,this.offsets[r]+=t):(t<0&&this.offsets[r]--,this.nodes.push(a),this.offsets.push(t>0?1:(a instanceof je?a.text.length:a.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class im{constructor(e,t,r){this.value="",this.done=!1,this.cursor=new bn(e,t>r?-1:1),this.pos=t>r?e.length:0,this.from=Math.min(t,r),this.to=Math.max(t,r)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let r=t<0?this.pos-this.from:this.to-this.pos;e>r&&(e=r),r-=e;let{value:n}=this.cursor.next(e);return this.pos+=(n.length+e)*t,this.value=n.length<=r?n:t<0?n.slice(n.length-r):n.slice(0,r),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class rm{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:r,value:n}=this.inner.next(e);return t&&this.afterBreak?(this.value="",this.afterBreak=!1):t?(this.done=!0,this.value=""):r?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(Ee.prototype[Symbol.iterator]=function(){return this.iter()},bn.prototype[Symbol.iterator]=im.prototype[Symbol.iterator]=rm.prototype[Symbol.iterator]=function(){return this});class EC{constructor(e,t,r,n){this.from=e,this.to=t,this.number=r,this.text=n}get length(){return this.to-this.from}}function zr(i,e,t){return e=Math.max(0,Math.min(i.length,e)),[e,Math.max(e,Math.min(i.length,t))]}function Ge(i,e,t=!0,r=!0){return wC(i,e,t,r)}function AC(i){return i>=56320&&i<57344}function DC(i){return i>=55296&&i<56320}function Tt(i,e){let t=i.charCodeAt(e);if(!DC(t)||e+1==i.length)return t;let r=i.charCodeAt(e+1);return AC(r)?(t-55296<<10)+(r-56320)+65536:t}function wc(i){return i<=65535?String.fromCharCode(i):(i-=65536,String.fromCharCode((i>>10)+55296,(i&1023)+56320))}function ai(i){return i<65536?1:2}const sa=/\r\n?|\n/;var Ze=(function(i){return i[i.Simple=0]="Simple",i[i.TrackDel=1]="TrackDel",i[i.TrackBefore=2]="TrackBefore",i[i.TrackAfter=3]="TrackAfter",i})(Ze||(Ze={}));class di{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let r=this.sections[t+1];e+=r<0?this.sections[t]:r}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,r=0,n=0;t<this.sections.length;){let s=this.sections[t++],l=this.sections[t++];l<0?(e(r,n,s),n+=s):n+=l,r+=s}}iterChangedRanges(e,t=!1){oa(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let r=this.sections[t++],n=this.sections[t++];n<0?e.push(r,n):e.push(n,r)}return new di(e)}composeDesc(e){return this.empty?e:e.empty?this:nm(this,e)}mapDesc(e,t=!1){return e.empty?this:la(this,e,t)}mapPos(e,t=-1,r=Ze.Simple){let n=0,s=0;for(let l=0;l<this.sections.length;){let o=this.sections[l++],a=this.sections[l++],c=n+o;if(a<0){if(c>e)return s+(e-n);s+=o}else{if(r!=Ze.Simple&&c>=e&&(r==Ze.TrackDel&&n<e&&c>e||r==Ze.TrackBefore&&n<e||r==Ze.TrackAfter&&c>e))return null;if(c>e||c==e&&t<0&&!o)return e==n||t<0?s:s+a;s+=a}n=c}if(e>n)throw new RangeError(`Position ${e} is out of range for changeset of length ${n}`);return s}touchesRange(e,t=e){for(let r=0,n=0;r<this.sections.length&&n<=t;){let s=this.sections[r++],l=this.sections[r++],o=n+s;if(l>=0&&n<=t&&o>=e)return n<e&&o>t?"cover":!0;n=o}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let r=this.sections[t++],n=this.sections[t++];e+=(e?" ":"")+r+(n>=0?":"+n:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new di(e)}static create(e){return new di(e)}}class Ke extends di{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return oa(this,(t,r,n,s,l)=>e=e.replace(n,n+(r-t),l),!1),e}mapDesc(e,t=!1){return la(this,e,t,!0)}invert(e){let t=this.sections.slice(),r=[];for(let n=0,s=0;n<t.length;n+=2){let l=t[n],o=t[n+1];if(o>=0){t[n]=o,t[n+1]=l;let a=n>>1;for(;r.length<a;)r.push(Ee.empty);r.push(l?e.slice(s,s+l):Ee.empty)}s+=l}return new Ke(t,r)}compose(e){return this.empty?e:e.empty?this:nm(this,e,!0)}map(e,t=!1){return e.empty?this:la(this,e,t,!0)}iterChanges(e,t=!1){oa(this,e,t)}get desc(){return di.create(this.sections)}filter(e){let t=[],r=[],n=[],s=new Ln(this);e:for(let l=0,o=0;;){let a=l==e.length?1e9:e[l++];for(;o<a||o==a&&s.len==0;){if(s.done)break e;let h=Math.min(s.len,a-o);rt(n,h,-1);let u=s.ins==-1?-1:s.off==0?s.ins:0;rt(t,h,u),u>0&&Bi(r,t,s.text),s.forward(h),o+=h}let c=e[l++];for(;o<c;){if(s.done)break e;let h=Math.min(s.len,c-o);rt(t,h,-1),rt(n,h,s.ins==-1?-1:s.off==0?s.ins:0),s.forward(h),o+=h}}return{changes:new Ke(t,r),filtered:di.create(n)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let r=this.sections[t],n=this.sections[t+1];n<0?e.push(r):n==0?e.push([r]):e.push([r].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,r){let n=[],s=[],l=0,o=null;function a(h=!1){if(!h&&!n.length)return;l<t&&rt(n,t-l,-1);let u=new Ke(n,s);o=o?o.compose(u.map(o)):u,n=[],s=[],l=0}function c(h){if(Array.isArray(h))for(let u of h)c(u);else if(h instanceof Ke){if(h.length!=t)throw new RangeError(`Mismatched change set length (got ${h.length}, expected ${t})`);a(),o=o?o.compose(h.map(o)):h}else{let{from:u,to:f=u,insert:d}=h;if(u>f||u<0||f>t)throw new RangeError(`Invalid change range ${u} to ${f} (in doc of length ${t})`);let y=d?typeof d=="string"?Ee.of(d.split(r||sa)):d:Ee.empty,_=y.length;if(u==f&&_==0)return;u<l&&a(),u>l&&rt(n,u-l,-1),rt(n,f-u,_),Bi(s,n,y),l=f}}return c(e),a(!o),o}static empty(e){return new Ke(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],r=[];for(let n=0;n<e.length;n++){let s=e[n];if(typeof s=="number")t.push(s,-1);else{if(!Array.isArray(s)||typeof s[0]!="number"||s.some((l,o)=>o&&typeof l!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(s.length==1)t.push(s[0],0);else{for(;r.length<n;)r.push(Ee.empty);r[n]=Ee.of(s.slice(1)),t.push(s[0],r[n].length)}}}return new Ke(t,r)}static createSet(e,t){return new Ke(e,t)}}function rt(i,e,t,r=!1){if(e==0&&t<=0)return;let n=i.length-2;n>=0&&t<=0&&t==i[n+1]?i[n]+=e:n>=0&&e==0&&i[n]==0?i[n+1]+=t:r?(i[n]+=e,i[n+1]+=t):i.push(e,t)}function Bi(i,e,t){if(t.length==0)return;let r=e.length-2>>1;if(r<i.length)i[i.length-1]=i[i.length-1].append(t);else{for(;i.length<r;)i.push(Ee.empty);i.push(t)}}function oa(i,e,t){let r=i.inserted;for(let n=0,s=0,l=0;l<i.sections.length;){let o=i.sections[l++],a=i.sections[l++];if(a<0)n+=o,s+=o;else{let c=n,h=s,u=Ee.empty;for(;c+=o,h+=a,a&&r&&(u=u.append(r[l-2>>1])),!(t||l==i.sections.length||i.sections[l+1]<0);)o=i.sections[l++],a=i.sections[l++];e(n,c,s,h,u),n=c,s=h}}}function la(i,e,t,r=!1){let n=[],s=r?[]:null,l=new Ln(i),o=new Ln(e);for(let a=-1;;){if(l.done&&o.len||o.done&&l.len)throw new Error("Mismatched change set lengths");if(l.ins==-1&&o.ins==-1){let c=Math.min(l.len,o.len);rt(n,c,-1),l.forward(c),o.forward(c)}else if(o.ins>=0&&(l.ins<0||a==l.i||l.off==0&&(o.len<l.len||o.len==l.len&&!t))){let c=o.len;for(rt(n,o.ins,-1);c;){let h=Math.min(l.len,c);l.ins>=0&&a<l.i&&l.len<=h&&(rt(n,0,l.ins),s&&Bi(s,n,l.text),a=l.i),l.forward(h),c-=h}o.next()}else if(l.ins>=0){let c=0,h=l.len;for(;h;)if(o.ins==-1){let u=Math.min(h,o.len);c+=u,h-=u,o.forward(u)}else if(o.ins==0&&o.len<h)h-=o.len,o.next();else break;rt(n,c,a<l.i?l.ins:0),s&&a<l.i&&Bi(s,n,l.text),a=l.i,l.forward(l.len-h)}else{if(l.done&&o.done)return s?Ke.createSet(n,s):di.create(n);throw new Error("Mismatched change set lengths")}}}function nm(i,e,t=!1){let r=[],n=t?[]:null,s=new Ln(i),l=new Ln(e);for(let o=!1;;){if(s.done&&l.done)return n?Ke.createSet(r,n):di.create(r);if(s.ins==0)rt(r,s.len,0,o),s.next();else if(l.len==0&&!l.done)rt(r,0,l.ins,o),n&&Bi(n,r,l.text),l.next();else{if(s.done||l.done)throw new Error("Mismatched change set lengths");{let a=Math.min(s.len2,l.len),c=r.length;if(s.ins==-1){let h=l.ins==-1?-1:l.off?0:l.ins;rt(r,a,h,o),n&&h&&Bi(n,r,l.text)}else l.ins==-1?(rt(r,s.off?0:s.len,a,o),n&&Bi(n,r,s.textBit(a))):(rt(r,s.off?0:s.len,l.off?0:l.ins,o),n&&!l.off&&Bi(n,r,l.text));o=(s.ins>a||l.ins>=0&&l.len>a)&&(o||r.length>c),s.forward2(a),l.forward(a)}}}}class Ln{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?Ee.empty:e[t]}textBit(e){let{inserted:t}=this.set,r=this.i-2>>1;return r>=t.length&&!e?Ee.empty:t[r].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class nr{constructor(e,t,r){this.from=e,this.to=t,this.flags=r}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,t=-1){let r,n;return this.empty?r=n=e.mapPos(this.from,t):(r=e.mapPos(this.from,1),n=e.mapPos(this.to,-1)),r==this.from&&n==this.to?this:new nr(r,n,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return G.range(e,t);let r=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return G.range(this.anchor,r)}eq(e,t=!1){return this.anchor==e.anchor&&this.head==e.head&&this.goalColumn==e.goalColumn&&(!t||!this.empty||this.assoc==e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return G.range(e.anchor,e.head)}static create(e,t,r){return new nr(e,t,r)}}class G{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:G.create(this.ranges.map(r=>r.map(e,t)),this.mainIndex)}eq(e,t=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let r=0;r<this.ranges.length;r++)if(!this.ranges[r].eq(e.ranges[r],t))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new G([this.main],0)}addRange(e,t=!0){return G.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let r=this.ranges.slice();return r[t]=e,G.create(r,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new G(e.ranges.map(t=>nr.fromJSON(t)),e.main)}static single(e,t=e){return new G([G.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let r=0,n=0;n<e.length;n++){let s=e[n];if(s.empty?s.from<=r:s.from<r)return G.normalized(e.slice(),t);r=s.to}return new G(e,t)}static cursor(e,t=0,r,n){return nr.create(e,e,(t==0?0:t<0?8:16)|(r==null?7:Math.min(6,r))|(n??16777215)<<6)}static range(e,t,r,n){let s=(r??16777215)<<6|(n==null?7:Math.min(6,n));return t<e?nr.create(t,e,48|s):nr.create(e,t,(t>e?8:0)|s)}static normalized(e,t=0){let r=e[t];e.sort((n,s)=>n.from-s.from),t=e.indexOf(r);for(let n=1;n<e.length;n++){let s=e[n],l=e[n-1];if(s.empty?s.from<=l.to:s.from<l.to){let o=l.from,a=Math.max(s.to,l.to);n<=t&&t--,e.splice(--n,2,s.anchor>s.head?G.range(a,o):G.range(o,a))}}return new G(e,t)}}function sm(i,e){for(let t of i.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let Cc=0;class oe{constructor(e,t,r,n,s){this.combine=e,this.compareInput=t,this.compare=r,this.isStatic=n,this.id=Cc++,this.default=e([]),this.extensions=typeof s=="function"?s(this):s}get reader(){return this}static define(e={}){return new oe(e.combine||(t=>t),e.compareInput||((t,r)=>t===r),e.compare||(e.combine?(t,r)=>t===r:kc),!!e.static,e.enables)}of(e){return new js([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new js(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new js(e,this,2,t)}from(e,t){return t||(t=r=>r),this.compute([e],r=>t(r.field(e)))}}function kc(i,e){return i==e||i.length==e.length&&i.every((t,r)=>t===e[r])}class js{constructor(e,t,r,n){this.dependencies=e,this.facet=t,this.type=r,this.value=n,this.id=Cc++}dynamicSlot(e){var t;let r=this.value,n=this.facet.compareInput,s=this.id,l=e[s]>>1,o=this.type==2,a=!1,c=!1,h=[];for(let u of this.dependencies)u=="doc"?a=!0:u=="selection"?c=!0:(((t=e[u.id])!==null&&t!==void 0?t:1)&1)==0&&h.push(e[u.id]);return{create(u){return u.values[l]=r(u),1},update(u,f){if(a&&f.docChanged||c&&(f.docChanged||f.selection)||aa(u,h)){let d=r(u);if(o?!Ou(d,u.values[l],n):!n(d,u.values[l]))return u.values[l]=d,1}return 0},reconfigure:(u,f)=>{let d,y=f.config.address[s];if(y!=null){let _=Ys(f,y);if(this.dependencies.every(m=>m instanceof oe?f.facet(m)===u.facet(m):m instanceof tt?f.field(m,!1)==u.field(m,!1):!0)||(o?Ou(d=r(u),_,n):n(d=r(u),_)))return u.values[l]=_,0}else d=r(u);return u.values[l]=d,1}}}}function Ou(i,e,t){if(i.length!=e.length)return!1;for(let r=0;r<i.length;r++)if(!t(i[r],e[r]))return!1;return!0}function aa(i,e){let t=!1;for(let r of e)xn(i,r)&1&&(t=!0);return t}function LC(i,e,t){let r=t.map(a=>i[a.id]),n=t.map(a=>a.type),s=r.filter(a=>!(a&1)),l=i[e.id]>>1;function o(a){let c=[];for(let h=0;h<r.length;h++){let u=Ys(a,r[h]);if(n[h]==2)for(let f of u)c.push(f);else c.push(u)}return e.combine(c)}return{create(a){for(let c of r)xn(a,c);return a.values[l]=o(a),1},update(a,c){if(!aa(a,s))return 0;let h=o(a);return e.compare(h,a.values[l])?0:(a.values[l]=h,1)},reconfigure(a,c){let h=aa(a,r),u=c.config.facets[e.id],f=c.facet(e);if(u&&!h&&kc(t,u))return a.values[l]=f,0;let d=o(a);return e.compare(d,f)?(a.values[l]=f,0):(a.values[l]=d,1)}}}const fs=oe.define({static:!0});class tt{constructor(e,t,r,n,s){this.id=e,this.createF=t,this.updateF=r,this.compareF=n,this.spec=s,this.provides=void 0}static define(e){let t=new tt(Cc++,e.create,e.update,e.compare||((r,n)=>r===n),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(fs).find(r=>r.field==this);return((t==null?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:r=>(r.values[t]=this.create(r),1),update:(r,n)=>{let s=r.values[t],l=this.updateF(s,n);return this.compareF(s,l)?0:(r.values[t]=l,1)},reconfigure:(r,n)=>{let s=r.facet(fs),l=n.facet(fs),o;return(o=s.find(a=>a.field==this))&&o!=l.find(a=>a.field==this)?(r.values[t]=o.create(r),1):n.config.address[this.id]!=null?(r.values[t]=n.field(this),0):(r.values[t]=this.create(r),1)}}}init(e){return[this,fs.of({field:this,create:e})]}get extension(){return this}}const ir={lowest:4,low:3,default:2,high:1,highest:0};function an(i){return e=>new om(e,i)}const vr={highest:an(ir.highest),high:an(ir.high),default:an(ir.default),low:an(ir.low),lowest:an(ir.lowest)};class om{constructor(e,t){this.inner=e,this.prec=t}}class Do{of(e){return new ca(this,e)}reconfigure(e){return Do.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class ca{constructor(e,t){this.compartment=e,this.inner=t}}class Js{constructor(e,t,r,n,s,l){for(this.base=e,this.compartments=t,this.dynamicSlots=r,this.address=n,this.staticValues=s,this.facets=l,this.statusTemplate=[];this.statusTemplate.length<r.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,r){let n=[],s=Object.create(null),l=new Map;for(let f of MC(e,t,l))f instanceof tt?n.push(f):(s[f.facet.id]||(s[f.facet.id]=[])).push(f);let o=Object.create(null),a=[],c=[];for(let f of n)o[f.id]=c.length<<1,c.push(d=>f.slot(d));let h=r==null?void 0:r.config.facets;for(let f in s){let d=s[f],y=d[0].facet,_=h&&h[f]||[];if(d.every(m=>m.type==0))if(o[y.id]=a.length<<1|1,kc(_,d))a.push(r.facet(y));else{let m=y.combine(d.map(p=>p.value));a.push(r&&y.compare(m,r.facet(y))?r.facet(y):m)}else{for(let m of d)m.type==0?(o[m.id]=a.length<<1|1,a.push(m.value)):(o[m.id]=c.length<<1,c.push(p=>m.dynamicSlot(p)));o[y.id]=c.length<<1,c.push(m=>LC(m,y,d))}}let u=c.map(f=>f(o));return new Js(e,l,u,o,a,s)}}function MC(i,e,t){let r=[[],[],[],[],[]],n=new Map;function s(l,o){let a=n.get(l);if(a!=null){if(a<=o)return;let c=r[a].indexOf(l);c>-1&&r[a].splice(c,1),l instanceof ca&&t.delete(l.compartment)}if(n.set(l,o),Array.isArray(l))for(let c of l)s(c,o);else if(l instanceof ca){if(t.has(l.compartment))throw new RangeError("Duplicate use of compartment in extensions");let c=e.get(l.compartment)||l.inner;t.set(l.compartment,c),s(c,o)}else if(l instanceof om)s(l.inner,l.prec);else if(l instanceof tt)r[o].push(l),l.provides&&s(l.provides,o);else if(l instanceof js)r[o].push(l),l.facet.extensions&&s(l.facet.extensions,ir.default);else{let c=l.extension;if(!c)throw new Error(`Unrecognized extension value in extension set (${l}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);s(c,o)}}return s(i,ir.default),r.reduce((l,o)=>l.concat(o))}function xn(i,e){if(e&1)return 2;let t=e>>1,r=i.status[t];if(r==4)throw new Error("Cyclic dependency between fields and/or facets");if(r&2)return r;i.status[t]=4;let n=i.computeSlot(i,i.config.dynamicSlots[t]);return i.status[t]=2|n}function Ys(i,e){return e&1?i.config.staticValues[e>>1]:i.values[e>>1]}const lm=oe.define(),ha=oe.define({combine:i=>i.some(e=>e),static:!0}),am=oe.define({combine:i=>i.length?i[0]:void 0,static:!0}),cm=oe.define(),hm=oe.define(),um=oe.define(),fm=oe.define({combine:i=>i.length?i[0]:!1});class Ci{constructor(e,t){this.type=e,this.value=t}static define(){return new TC}}class TC{of(e){return new Ci(this,e)}}class RC{constructor(e){this.map=e}of(e){return new pe(this,e)}}class pe{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new pe(this.type,t)}is(e){return this.type==e}static define(e={}){return new RC(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let r=[];for(let n of e){let s=n.map(t);s&&r.push(s)}return r}}pe.reconfigure=pe.define();pe.appendConfig=pe.define();class We{constructor(e,t,r,n,s,l){this.startState=e,this.changes=t,this.selection=r,this.effects=n,this.annotations=s,this.scrollIntoView=l,this._doc=null,this._state=null,r&&sm(r,t.newLength),s.some(o=>o.type==We.time)||(this.annotations=s.concat(We.time.of(Date.now())))}static create(e,t,r,n,s,l){return new We(e,t,r,n,s,l)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(We.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}We.time=Ci.define();We.userEvent=Ci.define();We.addToHistory=Ci.define();We.remote=Ci.define();function PC(i,e){let t=[];for(let r=0,n=0;;){let s,l;if(r<i.length&&(n==e.length||e[n]>=i[r]))s=i[r++],l=i[r++];else if(n<e.length)s=e[n++],l=e[n++];else return t;!t.length||t[t.length-1]<s?t.push(s,l):t[t.length-1]<l&&(t[t.length-1]=l)}}function dm(i,e,t){var r;let n,s,l;return t?(n=e.changes,s=Ke.empty(e.changes.length),l=i.changes.compose(e.changes)):(n=e.changes.map(i.changes),s=i.changes.mapDesc(e.changes,!0),l=i.changes.compose(n)),{changes:l,selection:e.selection?e.selection.map(s):(r=i.selection)===null||r===void 0?void 0:r.map(n),effects:pe.mapEffects(i.effects,n).concat(pe.mapEffects(e.effects,s)),annotations:i.annotations.length?i.annotations.concat(e.annotations):e.annotations,scrollIntoView:i.scrollIntoView||e.scrollIntoView}}function ua(i,e,t){let r=e.selection,n=Rr(e.annotations);return e.userEvent&&(n=n.concat(We.userEvent.of(e.userEvent))),{changes:e.changes instanceof Ke?e.changes:Ke.of(e.changes||[],t,i.facet(am)),selection:r&&(r instanceof G?r:G.single(r.anchor,r.head)),effects:Rr(e.effects),annotations:n,scrollIntoView:!!e.scrollIntoView}}function pm(i,e,t){let r=ua(i,e.length?e[0]:{},i.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let s=1;s<e.length;s++){e[s].filter===!1&&(t=!1);let l=!!e[s].sequential;r=dm(r,ua(i,e[s],l?r.changes.newLength:i.doc.length),l)}let n=We.create(i,r.changes,r.selection,r.effects,r.annotations,r.scrollIntoView);return OC(t?BC(n):n)}function BC(i){let e=i.startState,t=!0;for(let n of e.facet(cm)){let s=n(i);if(s===!1){t=!1;break}Array.isArray(s)&&(t=t===!0?s:PC(t,s))}if(t!==!0){let n,s;if(t===!1)s=i.changes.invertedDesc,n=Ke.empty(e.doc.length);else{let l=i.changes.filter(t);n=l.changes,s=l.filtered.mapDesc(l.changes).invertedDesc}i=We.create(e,n,i.selection&&i.selection.map(s),pe.mapEffects(i.effects,s),i.annotations,i.scrollIntoView)}let r=e.facet(hm);for(let n=r.length-1;n>=0;n--){let s=r[n](i);s instanceof We?i=s:Array.isArray(s)&&s.length==1&&s[0]instanceof We?i=s[0]:i=pm(e,Rr(s),!1)}return i}function OC(i){let e=i.startState,t=e.facet(um),r=i;for(let n=t.length-1;n>=0;n--){let s=t[n](i);s&&Object.keys(s).length&&(r=dm(r,ua(e,s,i.changes.newLength),!0))}return r==i?i:We.create(e,i.changes,i.selection,r.effects,r.annotations,r.scrollIntoView)}const IC=[];function Rr(i){return i==null?IC:Array.isArray(i)?i:[i]}var Fe=(function(i){return i[i.Word=0]="Word",i[i.Space=1]="Space",i[i.Other=2]="Other",i})(Fe||(Fe={}));const NC=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let fa;try{fa=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function FC(i){if(fa)return fa.test(i);for(let e=0;e<i.length;e++){let t=i[e];if(/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||NC.test(t)))return!0}return!1}function HC(i){return e=>{if(!/\S/.test(e))return Fe.Space;if(FC(e))return Fe.Word;for(let t=0;t<i.length;t++)if(e.indexOf(i[t])>-1)return Fe.Word;return Fe.Other}}class ke{constructor(e,t,r,n,s,l){this.config=e,this.doc=t,this.selection=r,this.values=n,this.status=e.statusTemplate.slice(),this.computeSlot=s,l&&(l._state=this);for(let o=0;o<this.config.dynamicSlots.length;o++)xn(this,o<<1);this.computeSlot=null}field(e,t=!0){let r=this.config.address[e.id];if(r==null){if(t)throw new RangeError("Field is not present in this state");return}return xn(this,r),Ys(this,r)}update(...e){return pm(this,e,!0)}applyTransaction(e){let t=this.config,{base:r,compartments:n}=t;for(let o of e.effects)o.is(Do.reconfigure)?(t&&(n=new Map,t.compartments.forEach((a,c)=>n.set(c,a)),t=null),n.set(o.value.compartment,o.value.extension)):o.is(pe.reconfigure)?(t=null,r=o.value):o.is(pe.appendConfig)&&(t=null,r=Rr(r).concat(o.value));let s;t?s=e.startState.values.slice():(t=Js.resolve(r,n,this),s=new ke(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(a,c)=>c.reconfigure(a,this),null).values);let l=e.startState.facet(ha)?e.newSelection:e.newSelection.asSingle();new ke(t,e.newDoc,l,s,(o,a)=>a.update(o,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:G.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,r=e(t.ranges[0]),n=this.changes(r.changes),s=[r.range],l=Rr(r.effects);for(let o=1;o<t.ranges.length;o++){let a=e(t.ranges[o]),c=this.changes(a.changes),h=c.map(n);for(let f=0;f<o;f++)s[f]=s[f].map(h);let u=n.mapDesc(c,!0);s.push(a.range.map(u)),n=n.compose(h),l=pe.mapEffects(l,h).concat(pe.mapEffects(Rr(a.effects),u))}return{changes:n,selection:G.create(s,t.mainIndex),effects:l}}changes(e=[]){return e instanceof Ke?e:Ke.of(e,this.doc.length,this.facet(ke.lineSeparator))}toText(e){return Ee.of(e.split(this.facet(ke.lineSeparator)||sa))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(xn(this,t),Ys(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let r in e){let n=e[r];n instanceof tt&&this.config.address[n.id]!=null&&(t[r]=n.spec.toJSON(this.field(e[r]),this))}return t}static fromJSON(e,t={},r){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(r){for(let s in r)if(Object.prototype.hasOwnProperty.call(e,s)){let l=r[s],o=e[s];n.push(l.init(a=>l.spec.fromJSON(o,a)))}}return ke.create({doc:e.doc,selection:G.fromJSON(e.selection),extensions:t.extensions?n.concat([t.extensions]):n})}static create(e={}){let t=Js.resolve(e.extensions||[],new Map),r=e.doc instanceof Ee?e.doc:Ee.of((e.doc||"").split(t.staticFacet(ke.lineSeparator)||sa)),n=e.selection?e.selection instanceof G?e.selection:G.single(e.selection.anchor,e.selection.head):G.single(0);return sm(n,r.length),t.staticFacet(ha)||(n=n.asSingle()),new ke(t,r,n,t.dynamicSlots.map(()=>null),(s,l)=>l.create(s),null)}get tabSize(){return this.facet(ke.tabSize)}get lineBreak(){return this.facet(ke.lineSeparator)||`
`}get readOnly(){return this.facet(fm)}phrase(e,...t){for(let r of this.facet(ke.phrases))if(Object.prototype.hasOwnProperty.call(r,e)){e=r[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,(r,n)=>{if(n=="$")return"$";let s=+(n||1);return!s||s>t.length?r:t[s-1]})),e}languageDataAt(e,t,r=-1){let n=[];for(let s of this.facet(lm))for(let l of s(this,t,r))Object.prototype.hasOwnProperty.call(l,e)&&n.push(l[e]);return n}charCategorizer(e){let t=this.languageDataAt("wordChars",e);return HC(t.length?t[0]:"")}wordAt(e){let{text:t,from:r,length:n}=this.doc.lineAt(e),s=this.charCategorizer(e),l=e-r,o=e-r;for(;l>0;){let a=Ge(t,l,!1);if(s(t.slice(a,l))!=Fe.Word)break;l=a}for(;o<n;){let a=Ge(t,o);if(s(t.slice(o,a))!=Fe.Word)break;o=a}return l==o?null:G.range(l+r,o+r)}}ke.allowMultipleSelections=ha;ke.tabSize=oe.define({combine:i=>i.length?i[0]:4});ke.lineSeparator=am;ke.readOnly=fm;ke.phrases=oe.define({compare(i,e){let t=Object.keys(i),r=Object.keys(e);return t.length==r.length&&t.every(n=>i[n]==e[n])}});ke.languageData=lm;ke.changeFilter=cm;ke.transactionFilter=hm;ke.transactionExtender=um;Do.reconfigure=pe.define();function qi(i,e,t={}){let r={};for(let n of i)for(let s of Object.keys(n)){let l=n[s],o=r[s];if(o===void 0)r[s]=l;else if(!(o===l||l===void 0))if(Object.hasOwnProperty.call(t,s))r[s]=t[s](o,l);else throw new Error("Config merge conflict for field "+s)}for(let n in e)r[n]===void 0&&(r[n]=e[n]);return r}class Fi{eq(e){return this==e}range(e,t=e){return da.create(e,t,this)}}Fi.prototype.startSide=Fi.prototype.endSide=0;Fi.prototype.point=!1;Fi.prototype.mapMode=Ze.TrackDel;function Ec(i,e){return i==e||i.constructor==e.constructor&&i.eq(e)}let da=class mm{constructor(e,t,r){this.from=e,this.to=t,this.value=r}static create(e,t,r){return new mm(e,t,r)}};function pa(i,e){return i.from-e.from||i.value.startSide-e.value.startSide}class Ac{constructor(e,t,r,n){this.from=e,this.to=t,this.value=r,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(e,t,r,n=0){let s=r?this.to:this.from;for(let l=n,o=s.length;;){if(l==o)return l;let a=l+o>>1,c=s[a]-e||(r?this.value[a].endSide:this.value[a].startSide)-t;if(a==l)return c>=0?l:o;c>=0?o=a:l=a+1}}between(e,t,r,n){for(let s=this.findIndex(t,-1e9,!0),l=this.findIndex(r,1e9,!1,s);s<l;s++)if(n(this.from[s]+e,this.to[s]+e,this.value[s])===!1)return!1}map(e,t){let r=[],n=[],s=[],l=-1,o=-1;for(let a=0;a<this.value.length;a++){let c=this.value[a],h=this.from[a]+e,u=this.to[a]+e,f,d;if(h==u){let y=t.mapPos(h,c.startSide,c.mapMode);if(y==null||(f=d=y,c.startSide!=c.endSide&&(d=t.mapPos(h,c.endSide),d<f)))continue}else if(f=t.mapPos(h,c.startSide),d=t.mapPos(u,c.endSide),f>d||f==d&&c.startSide>0&&c.endSide<=0)continue;(d-f||c.endSide-c.startSide)<0||(l<0&&(l=f),c.point&&(o=Math.max(o,d-f)),r.push(c),n.push(f-l),s.push(d-l))}return{mapped:r.length?new Ac(n,s,r,o):null,pos:l}}}class ye{constructor(e,t,r,n){this.chunkPos=e,this.chunk=t,this.nextLayer=r,this.maxPoint=n}static create(e,t,r,n){return new ye(e,t,r,n)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:r=!1,filterFrom:n=0,filterTo:s=this.length}=e,l=e.filter;if(t.length==0&&!l)return this;if(r&&(t=t.slice().sort(pa)),this.isEmpty)return t.length?ye.of(t):this;let o=new gm(this,null,-1).goto(0),a=0,c=[],h=new Hi;for(;o.value||a<t.length;)if(a<t.length&&(o.from-t[a].from||o.startSide-t[a].value.startSide)>=0){let u=t[a++];h.addInner(u.from,u.to,u.value)||c.push(u)}else o.rangeIndex==1&&o.chunkIndex<this.chunk.length&&(a==t.length||this.chunkEnd(o.chunkIndex)<t[a].from)&&(!l||n>this.chunkEnd(o.chunkIndex)||s<this.chunkPos[o.chunkIndex])&&h.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!l||n>o.to||s<o.from||l(o.from,o.to,o.value))&&(h.addInner(o.from,o.to,o.value)||c.push(da.create(o.from,o.to,o.value))),o.next());return h.finishInner(this.nextLayer.isEmpty&&!c.length?ye.empty:this.nextLayer.update({add:c,filter:l,filterFrom:n,filterTo:s}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],r=[],n=-1;for(let l=0;l<this.chunk.length;l++){let o=this.chunkPos[l],a=this.chunk[l],c=e.touchesRange(o,o+a.length);if(c===!1)n=Math.max(n,a.maxPoint),t.push(a),r.push(e.mapPos(o));else if(c===!0){let{mapped:h,pos:u}=a.map(o,e);h&&(n=Math.max(n,h.maxPoint),t.push(h),r.push(u))}}let s=this.nextLayer.map(e);return t.length==0?s:new ye(r,t,s||ye.empty,n)}between(e,t,r){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let s=this.chunkPos[n],l=this.chunk[n];if(t>=s&&e<=s+l.length&&l.between(s,e-s,t-s,r)===!1)return}this.nextLayer.between(e,t,r)}}iter(e=0){return Mn.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return Mn.from(e).goto(t)}static compare(e,t,r,n,s=-1){let l=e.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=s),o=t.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=s),a=Iu(l,o,r),c=new cn(l,a,s),h=new cn(o,a,s);r.iterGaps((u,f,d)=>Nu(c,u,h,f,d,n)),r.empty&&r.length==0&&Nu(c,0,h,0,0,n)}static eq(e,t,r=0,n){n==null&&(n=999999999);let s=e.filter(h=>!h.isEmpty&&t.indexOf(h)<0),l=t.filter(h=>!h.isEmpty&&e.indexOf(h)<0);if(s.length!=l.length)return!1;if(!s.length)return!0;let o=Iu(s,l),a=new cn(s,o,0).goto(r),c=new cn(l,o,0).goto(r);for(;;){if(a.to!=c.to||!ma(a.active,c.active)||a.point&&(!c.point||!Ec(a.point,c.point)))return!1;if(a.to>n)return!0;a.next(),c.next()}}static spans(e,t,r,n,s=-1){let l=new cn(e,null,s).goto(t),o=t,a=l.openStart;for(;;){let c=Math.min(l.to,r);if(l.point){let h=l.activeForPoint(l.to),u=l.pointFrom<t?h.length+1:l.point.startSide<0?h.length:Math.min(h.length,a);n.point(o,c,l.point,h,u,l.pointRank),a=Math.min(l.openEnd(c),h.length)}else c>o&&(n.span(o,c,l.active,a),a=l.openEnd(c));if(l.to>r)return a+(l.point&&l.to>r?1:0);o=l.to,l.next()}}static of(e,t=!1){let r=new Hi;for(let n of e instanceof da?[e]:t?jC(e):e)r.add(n.from,n.to,n.value);return r.finish()}static join(e){if(!e.length)return ye.empty;let t=e[e.length-1];for(let r=e.length-2;r>=0;r--)for(let n=e[r];n!=ye.empty;n=n.nextLayer)t=new ye(n.chunkPos,n.chunk,t,Math.max(n.maxPoint,t.maxPoint));return t}}ye.empty=new ye([],[],null,-1);function jC(i){if(i.length>1)for(let e=i[0],t=1;t<i.length;t++){let r=i[t];if(pa(e,r)>0)return i.slice().sort(pa);e=r}return i}ye.empty.nextLayer=ye.empty;class Hi{finishChunk(e){this.chunks.push(new Ac(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,t,r){this.addInner(e,t,r)||(this.nextLayer||(this.nextLayer=new Hi)).add(e,t,r)}addInner(e,t,r){let n=e-this.lastTo||r.startSide-this.last.endSide;if(n<=0&&(e-this.lastFrom||r.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return n<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=r,this.lastFrom=e,this.lastTo=t,this.value.push(r),r.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let r=t.value.length-1;return this.last=t.value[r],this.lastFrom=t.from[r]+e,this.lastTo=t.to[r]+e,!0}finish(){return this.finishInner(ye.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=ye.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function Iu(i,e,t){let r=new Map;for(let s of i)for(let l=0;l<s.chunk.length;l++)s.chunk[l].maxPoint<=0&&r.set(s.chunk[l],s.chunkPos[l]);let n=new Set;for(let s of e)for(let l=0;l<s.chunk.length;l++){let o=r.get(s.chunk[l]);o!=null&&(t?t.mapPos(o):o)==s.chunkPos[l]&&!(t!=null&&t.touchesRange(o,o+s.chunk[l].length))&&n.add(s.chunk[l])}return n}class gm{constructor(e,t,r,n=0){this.layer=e,this.skip=t,this.minPoint=r,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,r){for(;this.chunkIndex<this.layer.chunk.length;){let n=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(n)||this.layer.chunkEnd(this.chunkIndex)<e||n.maxPoint<this.minPoint))break;this.chunkIndex++,r=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!r||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],r=e+t.from[this.rangeIndex];if(this.from=r,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class Mn{constructor(e){this.heap=e}static from(e,t=null,r=-1){let n=[];for(let s=0;s<e.length;s++)for(let l=e[s];!l.isEmpty;l=l.nextLayer)l.maxPoint>=r&&n.push(new gm(l,t,r,s));return n.length==1?n[0]:new Mn(n)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let r of this.heap)r.goto(e,t);for(let r=this.heap.length>>1;r>=0;r--)ml(this.heap,r);return this.next(),this}forward(e,t){for(let r of this.heap)r.forward(e,t);for(let r=this.heap.length>>1;r>=0;r--)ml(this.heap,r);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),ml(this.heap,0)}}}function ml(i,e){for(let t=i[e];;){let r=(e<<1)+1;if(r>=i.length)break;let n=i[r];if(r+1<i.length&&n.compare(i[r+1])>=0&&(n=i[r+1],r++),t.compare(n)<0)break;i[r]=t,i[e]=n,e=r}}class cn{constructor(e,t,r){this.minPoint=r,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Mn.from(e,t,r)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){ds(this.active,e),ds(this.activeTo,e),ds(this.activeRank,e),this.minActive=Fu(this.active,this.activeTo)}addActive(e){let t=0,{value:r,to:n,rank:s}=this.cursor;for(;t<this.activeRank.length&&(s-this.activeRank[t]||n-this.activeTo[t])>0;)t++;ps(this.active,t,r),ps(this.activeTo,t,n),ps(this.activeRank,t,s),e&&ps(e,t,this.cursor.from),this.minActive=Fu(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let r=this.openStart<0?[]:null;for(;;){let n=this.minActive;if(n>-1&&(this.activeTo[n]-this.cursor.from||this.active[n].endSide-this.cursor.startSide)<0){if(this.activeTo[n]>e){this.to=this.activeTo[n],this.endSide=this.active[n].endSide;break}this.removeActive(n),r&&ds(r,n)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let s=this.cursor.value;if(!s.point)this.addActive(r),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=s,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=s.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(r){this.openStart=0;for(let n=r.length-1;n>=0&&r[n]<e;n--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let r=this.active.length-1;r>=0&&!(this.activeRank[r]<this.pointRank);r--)(this.activeTo[r]>e||this.activeTo[r]==e&&this.active[r].endSide>=this.point.endSide)&&t.push(this.active[r]);return t.reverse()}openEnd(e){let t=0;for(let r=this.activeTo.length-1;r>=0&&this.activeTo[r]>e;r--)t++;return t}}function Nu(i,e,t,r,n,s){i.goto(e),t.goto(r);let l=r+n,o=r,a=r-e,c=!!s.boundChange;for(let h=!1;;){let u=i.to+a-t.to,f=u||i.endSide-t.endSide,d=f<0?i.to+a:t.to,y=Math.min(d,l);if(i.point||t.point?(i.point&&t.point&&Ec(i.point,t.point)&&ma(i.activeForPoint(i.to),t.activeForPoint(t.to))||s.comparePoint(o,y,i.point,t.point),h=!1):(h&&s.boundChange(o),y>o&&!ma(i.active,t.active)&&s.compareRange(o,y,i.active,t.active),c&&y<l&&(u||i.openEnd(d)!=t.openEnd(d))&&(h=!0)),d>l)break;o=d,f<=0&&i.next(),f>=0&&t.next()}}function ma(i,e){if(i.length!=e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!=e[t]&&!Ec(i[t],e[t]))return!1;return!0}function ds(i,e){for(let t=e,r=i.length-1;t<r;t++)i[t]=i[t+1];i.pop()}function ps(i,e,t){for(let r=i.length-1;r>=e;r--)i[r+1]=i[r];i[e]=t}function Fu(i,e){let t=-1,r=1e9;for(let n=0;n<e.length;n++)(e[n]-r||i[n].endSide-i[t].endSide)<0&&(t=n,r=e[n]);return t}function Lo(i,e,t=i.length){let r=0;for(let n=0;n<t&&n<i.length;)i.charCodeAt(n)==9?(r+=e-r%e,n++):(r++,n=Ge(i,n));return r}function zC(i,e,t,r){for(let n=0,s=0;;){if(s>=e)return n;if(n==i.length)break;s+=i.charCodeAt(n)==9?t-s%t:1,n=Ge(i,n)}return i.length}const ga="ͼ",Hu=typeof Symbol>"u"?"__"+ga:Symbol.for(ga),va=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),ju=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class ji{constructor(e,t){this.rules=[];let{finish:r}=t||{};function n(l){return/^@/.test(l)?[l]:l.split(/,\s*/)}function s(l,o,a,c){let h=[],u=/^@(\w+)\b/.exec(l[0]),f=u&&u[1]=="keyframes";if(u&&o==null)return a.push(l[0]+";");for(let d in o){let y=o[d];if(/&/.test(d))s(d.split(/,\s*/).map(_=>l.map(m=>_.replace(/&/,m))).reduce((_,m)=>_.concat(m)),y,a);else if(y&&typeof y=="object"){if(!u)throw new RangeError("The value of a property ("+d+") should be a primitive value.");s(n(d),y,h,f)}else y!=null&&h.push(d.replace(/_.*/,"").replace(/[A-Z]/g,_=>"-"+_.toLowerCase())+": "+y+";")}(h.length||f)&&a.push((r&&!u&&!c?l.map(r):l).join(", ")+" {"+h.join(" ")+"}")}for(let l in e)s(n(l),e[l],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=ju[Hu]||1;return ju[Hu]=e+1,ga+e.toString(36)}static mount(e,t,r){let n=e[va],s=r&&r.nonce;n?s&&n.setNonce(s):n=new WC(e,s),n.mount(Array.isArray(t)?t:[t],e)}}let zu=new Map;class WC{constructor(e,t){let r=e.ownerDocument||e,n=r.defaultView;if(!e.head&&e.adoptedStyleSheets&&n.CSSStyleSheet){let s=zu.get(r);if(s)return e[va]=s;this.sheet=new n.CSSStyleSheet,zu.set(r,this)}else this.styleTag=r.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);this.modules=[],e[va]=this}mount(e,t){let r=this.sheet,n=0,s=0;for(let l=0;l<e.length;l++){let o=e[l],a=this.modules.indexOf(o);if(a<s&&a>-1&&(this.modules.splice(a,1),s--,a=-1),a==-1){if(this.modules.splice(s++,0,o),r)for(let c=0;c<o.rules.length;c++)r.insertRule(o.rules[c],n++)}else{for(;s<a;)n+=this.modules[s++].rules.length;n+=o.rules.length,s++}}if(r)t.adoptedStyleSheets.indexOf(this.sheet)<0&&(t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets]);else{let l="";for(let a=0;a<this.modules.length;a++)l+=this.modules[a].getRules()+`
`;this.styleTag.textContent=l;let o=t.head||t;this.styleTag.parentNode!=o&&o.insertBefore(this.styleTag,o.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}var zi={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Tn={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},$C=typeof navigator<"u"&&/Mac/.test(navigator.platform),VC=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Qe=0;Qe<10;Qe++)zi[48+Qe]=zi[96+Qe]=String(Qe);for(var Qe=1;Qe<=24;Qe++)zi[Qe+111]="F"+Qe;for(var Qe=65;Qe<=90;Qe++)zi[Qe]=String.fromCharCode(Qe+32),Tn[Qe]=String.fromCharCode(Qe);for(var gl in zi)Tn.hasOwnProperty(gl)||(Tn[gl]=zi[gl]);function UC(i){var e=$C&&i.metaKey&&i.shiftKey&&!i.ctrlKey&&!i.altKey||VC&&i.shiftKey&&i.key&&i.key.length==1||i.key=="Unidentified",t=!e&&i.key||(i.shiftKey?Tn:zi)[i.keyCode]||i.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}function Me(){var i=arguments[0];typeof i=="string"&&(i=document.createElement(i));var e=1,t=arguments[1];if(t&&typeof t=="object"&&t.nodeType==null&&!Array.isArray(t)){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=t[r];typeof n=="string"?i.setAttribute(r,n):n!=null&&(i[r]=n)}e++}for(;e<arguments.length;e++)vm(i,arguments[e]);return i}function vm(i,e){if(typeof e=="string")i.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)i.appendChild(e);else if(Array.isArray(e))for(var t=0;t<e.length;t++)vm(i,e[t]);else throw new RangeError("Unsupported child node: "+e)}let dt=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},_a=typeof document<"u"?document:{documentElement:{style:{}}};const ya=/Edge\/(\d+)/.exec(dt.userAgent),_m=/MSIE \d/.test(dt.userAgent),ba=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(dt.userAgent),Mo=!!(_m||ba||ya),Wu=!Mo&&/gecko\/(\d+)/i.test(dt.userAgent),vl=!Mo&&/Chrome\/(\d+)/.exec(dt.userAgent),qC="webkitFontSmoothing"in _a.documentElement.style,xa=!Mo&&/Apple Computer/.test(dt.vendor),$u=xa&&(/Mobile\/\w+/.test(dt.userAgent)||dt.maxTouchPoints>2);var ne={mac:$u||/Mac/.test(dt.platform),windows:/Win/.test(dt.platform),linux:/Linux|X11/.test(dt.platform),ie:Mo,ie_version:_m?_a.documentMode||6:ba?+ba[1]:ya?+ya[1]:0,gecko:Wu,gecko_version:Wu?+(/Firefox\/(\d+)/.exec(dt.userAgent)||[0,0])[1]:0,chrome:!!vl,chrome_version:vl?+vl[1]:0,ios:$u,android:/Android\b/.test(dt.userAgent),webkit_version:qC?+(/\bAppleWebKit\/(\d+)/.exec(dt.userAgent)||[0,0])[1]:0,safari:xa,safari_version:xa?+(/\bVersion\/(\d+(\.\d+)?)/.exec(dt.userAgent)||[0,0])[1]:0,tabSize:_a.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};function Dc(i,e){for(let t in i)t=="class"&&e.class?e.class+=" "+i.class:t=="style"&&e.style?e.style+=";"+i.style:e[t]=i[t];return e}const Qs=Object.create(null);function Lc(i,e,t){if(i==e)return!0;i||(i=Qs),e||(e=Qs);let r=Object.keys(i),n=Object.keys(e);if(r.length-0!=n.length-0)return!1;for(let s of r)if(s!=t&&(n.indexOf(s)==-1||i[s]!==e[s]))return!1;return!0}function KC(i,e){for(let t=i.attributes.length-1;t>=0;t--){let r=i.attributes[t].name;e[r]==null&&i.removeAttribute(r)}for(let t in e){let r=e[t];t=="style"?i.style.cssText=r:i.getAttribute(t)!=r&&i.setAttribute(t,r)}}function Vu(i,e,t){let r=!1;if(e)for(let n in e)t&&n in t||(r=!0,n=="style"?i.style.cssText="":i.removeAttribute(n));if(t)for(let n in t)e&&e[n]==t[n]||(r=!0,n=="style"?i.style.cssText=t[n]:i.setAttribute(n,t[n]));return r}function GC(i){let e=Object.create(null);for(let t=0;t<i.attributes.length;t++){let r=i.attributes[t];e[r.name]=r.value}return e}class Ki{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,r){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var Ct=(function(i){return i[i.Text=0]="Text",i[i.WidgetBefore=1]="WidgetBefore",i[i.WidgetAfter=2]="WidgetAfter",i[i.WidgetRange=3]="WidgetRange",i})(Ct||(Ct={}));class he extends Fi{constructor(e,t,r,n){super(),this.startSide=e,this.endSide=t,this.widget=r,this.spec=n}get heightRelevant(){return!1}static mark(e){return new Yn(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),r=!!e.block;return t+=r&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new fr(e,t,t,r,e.widget||null,!1)}static replace(e){let t=!!e.block,r,n;if(e.isBlockGap)r=-5e8,n=4e8;else{let{start:s,end:l}=ym(e,t);r=(s?t?-3e8:-1:5e8)-1,n=(l?t?2e8:1:-6e8)+1}return new fr(e,r,n,t,e.widget||null,!0)}static line(e){return new Qn(e)}static set(e,t=!1){return ye.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}he.none=ye.empty;class Yn extends he{constructor(e){let{start:t,end:r}=ym(e);super(t?-1:5e8,r?1:-6e8,null,e),this.tagName=e.tagName||"span",this.attrs=e.class&&e.attributes?Dc(e.attributes,{class:e.class}):e.class?{class:e.class}:e.attributes||Qs}eq(e){return this==e||e instanceof Yn&&this.tagName==e.tagName&&Lc(this.attrs,e.attrs)}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}Yn.prototype.point=!1;class Qn extends he{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof Qn&&this.spec.class==e.spec.class&&Lc(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}Qn.prototype.mapMode=Ze.TrackBefore;Qn.prototype.point=!0;class fr extends he{constructor(e,t,r,n,s,l){super(t,r,s,e),this.block=n,this.isReplace=l,this.mapMode=n?t<=0?Ze.TrackBefore:Ze.TrackAfter:Ze.TrackDel}get type(){return this.startSide!=this.endSide?Ct.WidgetRange:this.startSide<=0?Ct.WidgetBefore:Ct.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof fr&&XC(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}fr.prototype.point=!0;function ym(i,e=!1){let{inclusiveStart:t,inclusiveEnd:r}=i;return t==null&&(t=i.inclusive),r==null&&(r=i.inclusive),{start:t??e,end:r??e}}function XC(i,e){return i==e||!!(i&&e&&i.compare(e))}function Pr(i,e,t,r=0){let n=t.length-1;n>=0&&t[n]+r>=i?t[n]=Math.max(t[n],e):t.push(i,e)}class Rn extends Fi{constructor(e,t){super(),this.tagName=e,this.attributes=t}eq(e){return e==this||e instanceof Rn&&this.tagName==e.tagName&&Lc(this.attributes,e.attributes)}static create(e){return new Rn(e.tagName,e.attributes||Qs)}static set(e,t=!1){return ye.of(e,t)}}Rn.prototype.startSide=Rn.prototype.endSide=-1;function Wr(i){let e;return i.nodeType==11?e=i.getSelection?i:i.ownerDocument:e=i,e.getSelection()}function Sa(i,e){return e?i==e||i.contains(e.nodeType!=1?e.parentNode:e):!1}function Sn(i,e){if(!e.anchorNode)return!1;try{return Sa(i,e.anchorNode)}catch{return!1}}function zs(i){return i.nodeType==3?Pn(i,0,i.nodeValue.length).getClientRects():i.nodeType==1?i.getClientRects():[]}function wn(i,e,t,r){return t?Uu(i,e,t,r,-1)||Uu(i,e,t,r,1):!1}function Wi(i){for(var e=0;;e++)if(i=i.previousSibling,!i)return e}function Zs(i){return i.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(i.nodeName)}function Uu(i,e,t,r,n){for(;;){if(i==t&&e==r)return!0;if(e==(n<0?0:xi(i))){if(i.nodeName=="DIV")return!1;let s=i.parentNode;if(!s||s.nodeType!=1)return!1;e=Wi(i)+(n<0?0:1),i=s}else if(i.nodeType==1){if(i=i.childNodes[e+(n<0?-1:0)],i.nodeType==1&&i.contentEditable=="false")return!1;e=n<0?xi(i):0}else return!1}}function xi(i){return i.nodeType==3?i.nodeValue.length:i.childNodes.length}function eo(i,e){let t=e?i.left:i.right;return{left:t,right:t,top:i.top,bottom:i.bottom}}function JC(i){let e=i.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:i.innerWidth,top:0,bottom:i.innerHeight}}function bm(i,e){let t=e.width/i.offsetWidth,r=e.height/i.offsetHeight;return(t>.995&&t<1.005||!isFinite(t)||Math.abs(e.width-i.offsetWidth)<1)&&(t=1),(r>.995&&r<1.005||!isFinite(r)||Math.abs(e.height-i.offsetHeight)<1)&&(r=1),{scaleX:t,scaleY:r}}function YC(i,e,t,r,n,s,l,o){let a=i.ownerDocument,c=a.defaultView||window;for(let h=i,u=!1;h&&!u;)if(h.nodeType==1){let f,d=h==a.body,y=1,_=1;if(d)f=JC(c);else{if(/^(fixed|sticky)$/.test(getComputedStyle(h).position)&&(u=!0),h.scrollHeight<=h.clientHeight&&h.scrollWidth<=h.clientWidth){h=h.assignedSlot||h.parentNode;continue}let g=h.getBoundingClientRect();({scaleX:y,scaleY:_}=bm(h,g)),f={left:g.left,right:g.left+h.clientWidth*y,top:g.top,bottom:g.top+h.clientHeight*_}}let m=0,p=0;if(n=="nearest")e.top<f.top?(p=e.top-(f.top+l),t>0&&e.bottom>f.bottom+p&&(p=e.bottom-f.bottom+l)):e.bottom>f.bottom&&(p=e.bottom-f.bottom+l,t<0&&e.top-p<f.top&&(p=e.top-(f.top+l)));else{let g=e.bottom-e.top,v=f.bottom-f.top;p=(n=="center"&&g<=v?e.top+g/2-v/2:n=="start"||n=="center"&&t<0?e.top-l:e.bottom-v+l)-f.top}if(r=="nearest"?e.left<f.left?(m=e.left-(f.left+s),t>0&&e.right>f.right+m&&(m=e.right-f.right+s)):e.right>f.right&&(m=e.right-f.right+s,t<0&&e.left<f.left+m&&(m=e.left-(f.left+s))):m=(r=="center"?e.left+(e.right-e.left)/2-(f.right-f.left)/2:r=="start"==o?e.left-s:e.right-(f.right-f.left)+s)-f.left,m||p)if(d)c.scrollBy(m,p);else{let g=0,v=0;if(p){let b=h.scrollTop;h.scrollTop+=p/_,v=(h.scrollTop-b)*_}if(m){let b=h.scrollLeft;h.scrollLeft+=m/y,g=(h.scrollLeft-b)*y}e={left:e.left-g,top:e.top-v,right:e.right-g,bottom:e.bottom-v},g&&Math.abs(g-m)<1&&(r="nearest"),v&&Math.abs(v-p)<1&&(n="nearest")}if(d)break;(e.top<f.top||e.bottom>f.bottom||e.left<f.left||e.right>f.right)&&(e={left:Math.max(e.left,f.left),right:Math.min(e.right,f.right),top:Math.max(e.top,f.top),bottom:Math.min(e.bottom,f.bottom)}),h=h.assignedSlot||h.parentNode}else if(h.nodeType==11)h=h.host;else break}function QC(i){let e=i.ownerDocument,t,r;for(let n=i.parentNode;n&&!(n==e.body||t&&r);)if(n.nodeType==1)!r&&n.scrollHeight>n.clientHeight&&(r=n),!t&&n.scrollWidth>n.clientWidth&&(t=n),n=n.assignedSlot||n.parentNode;else if(n.nodeType==11)n=n.host;else break;return{x:t,y:r}}class ZC{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:r}=e;this.set(t,Math.min(e.anchorOffset,t?xi(t):0),r,Math.min(e.focusOffset,r?xi(r):0))}set(e,t,r,n){this.anchorNode=e,this.anchorOffset=t,this.focusNode=r,this.focusOffset=n}}let tr=null;ne.safari&&ne.safari_version>=26&&(tr=!1);function xm(i){if(i.setActive)return i.setActive();if(tr)return i.focus(tr);let e=[];for(let t=i;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(i.focus(tr==null?{get preventScroll(){return tr={preventScroll:!0},!0}}:void 0),!tr){tr=!1;for(let t=0;t<e.length;){let r=e[t++],n=e[t++],s=e[t++];r.scrollTop!=n&&(r.scrollTop=n),r.scrollLeft!=s&&(r.scrollLeft=s)}}}let qu;function Pn(i,e,t=e){let r=qu||(qu=document.createRange());return r.setEnd(i,t),r.setStart(i,e),r}function Br(i,e,t,r){let n={key:e,code:e,keyCode:t,which:t,cancelable:!0};r&&({altKey:n.altKey,ctrlKey:n.ctrlKey,shiftKey:n.shiftKey,metaKey:n.metaKey}=r);let s=new KeyboardEvent("keydown",n);s.synthetic=!0,i.dispatchEvent(s);let l=new KeyboardEvent("keyup",n);return l.synthetic=!0,i.dispatchEvent(l),s.defaultPrevented||l.defaultPrevented}function ek(i){for(;i;){if(i&&(i.nodeType==9||i.nodeType==11&&i.host))return i;i=i.assignedSlot||i.parentNode}return null}function tk(i,e){let t=e.focusNode,r=e.focusOffset;if(!t||e.anchorNode!=t||e.anchorOffset!=r)return!1;for(r=Math.min(r,xi(t));;)if(r){if(t.nodeType!=1)return!1;let n=t.childNodes[r-1];n.contentEditable=="false"?r--:(t=n,r=xi(t))}else{if(t==i)return!0;r=Wi(t),t=t.parentNode}}function Sm(i){return i.scrollTop>Math.max(1,i.scrollHeight-i.clientHeight-4)}function wm(i,e){for(let t=i,r=e;;){if(t.nodeType==3&&r>0)return{node:t,offset:r};if(t.nodeType==1&&r>0){if(t.contentEditable=="false")return null;t=t.childNodes[r-1],r=xi(t)}else if(t.parentNode&&!Zs(t))r=Wi(t),t=t.parentNode;else return null}}function Cm(i,e){for(let t=i,r=e;;){if(t.nodeType==3&&r<t.nodeValue.length)return{node:t,offset:r};if(t.nodeType==1&&r<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[r],r=0}else if(t.parentNode&&!Zs(t))r=Wi(t)+1,t=t.parentNode;else return null}}class Kt{constructor(e,t,r=!0){this.node=e,this.offset=t,this.precise=r}static before(e,t){return new Kt(e.parentNode,Wi(e),t)}static after(e,t){return new Kt(e.parentNode,Wi(e)+1,t)}}var He=(function(i){return i[i.LTR=0]="LTR",i[i.RTL=1]="RTL",i})(He||(He={}));const dr=He.LTR,Mc=He.RTL;function km(i){let e=[];for(let t=0;t<i.length;t++)e.push(1<<+i[t]);return e}const ik=km("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),rk=km("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),wa=Object.create(null),ti=[];for(let i of["()","[]","{}"]){let e=i.charCodeAt(0),t=i.charCodeAt(1);wa[e]=t,wa[t]=-e}function Em(i){return i<=247?ik[i]:1424<=i&&i<=1524?2:1536<=i&&i<=1785?rk[i-1536]:1774<=i&&i<=2220?4:8192<=i&&i<=8204?256:64336<=i&&i<=65023?4:1}const nk=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class _i{get dir(){return this.level%2?Mc:dr}constructor(e,t,r){this.from=e,this.to=t,this.level=r}side(e,t){return this.dir==t==e?this.to:this.from}forward(e,t){return e==(this.dir==t)}static find(e,t,r,n){let s=-1;for(let l=0;l<e.length;l++){let o=e[l];if(o.from<=t&&o.to>=t){if(o.level==r)return l;(s<0||(n!=0?n<0?o.from<t:o.to>t:e[s].level>o.level))&&(s=l)}}if(s<0)throw new RangeError("Index out of range");return s}}function Am(i,e){if(i.length!=e.length)return!1;for(let t=0;t<i.length;t++){let r=i[t],n=e[t];if(r.from!=n.from||r.to!=n.to||r.direction!=n.direction||!Am(r.inner,n.inner))return!1}return!0}const Te=[];function sk(i,e,t,r,n){for(let s=0;s<=r.length;s++){let l=s?r[s-1].to:e,o=s<r.length?r[s].from:t,a=s?256:n;for(let c=l,h=a,u=a;c<o;c++){let f=Em(i.charCodeAt(c));f==512?f=h:f==8&&u==4&&(f=16),Te[c]=f==4?2:f,f&7&&(u=f),h=f}for(let c=l,h=a,u=a;c<o;c++){let f=Te[c];if(f==128)c<o-1&&h==Te[c+1]&&h&24?f=Te[c]=h:Te[c]=256;else if(f==64){let d=c+1;for(;d<o&&Te[d]==64;)d++;let y=c&&h==8||d<t&&Te[d]==8?u==1?1:8:256;for(let _=c;_<d;_++)Te[_]=y;c=d-1}else f==8&&u==1&&(Te[c]=1);h=f,f&7&&(u=f)}}}function ok(i,e,t,r,n){let s=n==1?2:1;for(let l=0,o=0,a=0;l<=r.length;l++){let c=l?r[l-1].to:e,h=l<r.length?r[l].from:t;for(let u=c,f,d,y;u<h;u++)if(d=wa[f=i.charCodeAt(u)])if(d<0){for(let _=o-3;_>=0;_-=3)if(ti[_+1]==-d){let m=ti[_+2],p=m&2?n:m&4?m&1?s:n:0;p&&(Te[u]=Te[ti[_]]=p),o=_;break}}else{if(ti.length==189)break;ti[o++]=u,ti[o++]=f,ti[o++]=a}else if((y=Te[u])==2||y==1){let _=y==n;a=_?0:1;for(let m=o-3;m>=0;m-=3){let p=ti[m+2];if(p&2)break;if(_)ti[m+2]|=2;else{if(p&4)break;ti[m+2]|=4}}}}}function lk(i,e,t,r){for(let n=0,s=r;n<=t.length;n++){let l=n?t[n-1].to:i,o=n<t.length?t[n].from:e;for(let a=l;a<o;){let c=Te[a];if(c==256){let h=a+1;for(;;)if(h==o){if(n==t.length)break;h=t[n++].to,o=n<t.length?t[n].from:e}else if(Te[h]==256)h++;else break;let u=s==1,f=(h<e?Te[h]:r)==1,d=u==f?u?1:2:r;for(let y=h,_=n,m=_?t[_-1].to:i;y>a;)y==m&&(y=t[--_].from,m=_?t[_-1].to:i),Te[--y]=d;a=h}else s=c,a++}}}function Ca(i,e,t,r,n,s,l){let o=r%2?2:1;if(r%2==n%2)for(let a=e,c=0;a<t;){let h=!0,u=!1;if(c==s.length||a<s[c].from){let _=Te[a];_!=o&&(h=!1,u=_==16)}let f=!h&&o==1?[]:null,d=h?r:r+1,y=a;e:for(;;)if(c<s.length&&y==s[c].from){if(u)break e;let _=s[c];if(!h)for(let m=_.to,p=c+1;;){if(m==t)break e;if(p<s.length&&s[p].from==m)m=s[p++].to;else{if(Te[m]==o)break e;break}}if(c++,f)f.push(_);else{_.from>a&&l.push(new _i(a,_.from,d));let m=_.direction==dr!=!(d%2);ka(i,m?r+1:r,n,_.inner,_.from,_.to,l),a=_.to}y=_.to}else{if(y==t||(h?Te[y]!=o:Te[y]==o))break;y++}f?Ca(i,a,y,r+1,n,f,l):a<y&&l.push(new _i(a,y,d)),a=y}else for(let a=t,c=s.length;a>e;){let h=!0,u=!1;if(!c||a>s[c-1].to){let _=Te[a-1];_!=o&&(h=!1,u=_==16)}let f=!h&&o==1?[]:null,d=h?r:r+1,y=a;e:for(;;)if(c&&y==s[c-1].to){if(u)break e;let _=s[--c];if(!h)for(let m=_.from,p=c;;){if(m==e)break e;if(p&&s[p-1].to==m)m=s[--p].from;else{if(Te[m-1]==o)break e;break}}if(f)f.push(_);else{_.to<a&&l.push(new _i(_.to,a,d));let m=_.direction==dr!=!(d%2);ka(i,m?r+1:r,n,_.inner,_.from,_.to,l),a=_.from}y=_.from}else{if(y==e||(h?Te[y-1]!=o:Te[y-1]==o))break;y--}f?Ca(i,y,a,r+1,n,f,l):y<a&&l.push(new _i(y,a,d)),a=y}}function ka(i,e,t,r,n,s,l){let o=e%2?2:1;sk(i,n,s,r,o),ok(i,n,s,r,o),lk(n,s,r,o),Ca(i,n,s,e,t,r,l)}function ak(i,e,t){if(!i)return[new _i(0,0,e==Mc?1:0)];if(e==dr&&!t.length&&!nk.test(i))return Dm(i.length);if(t.length)for(;i.length>Te.length;)Te[Te.length]=256;let r=[],n=e==dr?0:1;return ka(i,n,n,t,0,i.length,r),r}function Dm(i){return[new _i(0,i,0)]}let Lm="";function ck(i,e,t,r,n){var s;let l=r.head-i.from,o=_i.find(e,l,(s=r.bidiLevel)!==null&&s!==void 0?s:-1,r.assoc),a=e[o],c=a.side(n,t);if(l==c){let f=o+=n?1:-1;if(f<0||f>=e.length)return null;a=e[o=f],l=a.side(!n,t),c=a.side(n,t)}let h=Ge(i.text,l,a.forward(n,t));(h<a.from||h>a.to)&&(h=c),Lm=i.text.slice(Math.min(l,h),Math.max(l,h));let u=o==(n?e.length-1:0)?null:e[o+(n?1:-1)];return u&&h==c&&u.level+(n?0:1)<a.level?G.cursor(u.side(!n,t)+i.from,u.forward(n,t)?1:-1,u.level):G.cursor(h+i.from,a.forward(n,t)?-1:1,a.level)}function hk(i,e,t){for(let r=e;r<t;r++){let n=Em(i.charCodeAt(r));if(n==1)return dr;if(n==2||n==4)return Mc}return dr}const Mm=oe.define(),Tm=oe.define(),Rm=oe.define(),Pm=oe.define(),Ea=oe.define(),Bm=oe.define(),Om=oe.define(),Tc=oe.define(),Rc=oe.define(),Im=oe.define({combine:i=>i.some(e=>e)}),uk=oe.define({combine:i=>i.some(e=>e)}),Nm=oe.define();class Or{constructor(e,t="nearest",r="nearest",n=5,s=5,l=!1){this.range=e,this.y=t,this.x=r,this.yMargin=n,this.xMargin=s,this.isSnapshot=l}map(e){return e.empty?this:new Or(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new Or(G.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const ms=pe.define({map:(i,e)=>i.map(e)}),Fm=pe.define();function St(i,e,t){let r=i.facet(Pm);r.length?r[0](e):window.onerror&&window.onerror(String(e),t,void 0,void 0,e)||(t?console.error(t+":",e):console.error(e))}const vi=oe.define({combine:i=>i.length?i[0]:!0});let fk=0;const Er=oe.define({combine(i){return i.filter((e,t)=>{for(let r=0;r<t;r++)if(i[r].plugin==e.plugin)return!1;return!0})}});class ot{constructor(e,t,r,n,s){this.id=e,this.create=t,this.domEventHandlers=r,this.domEventObservers=n,this.baseExtensions=s(this),this.extension=this.baseExtensions.concat(Er.of({plugin:this,arg:void 0}))}of(e){return this.baseExtensions.concat(Er.of({plugin:this,arg:e}))}static define(e,t){const{eventHandlers:r,eventObservers:n,provide:s,decorations:l}=t||{};return new ot(fk++,e,r,n,o=>{let a=[];return l&&a.push(To.of(c=>{let h=c.plugin(o);return h?l(h):he.none})),s&&a.push(s(o)),a})}static fromClass(e,t){return ot.define((r,n)=>new e(r,n),t)}}class _l{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}get plugin(){return this.spec&&this.spec.plugin}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(r){if(St(t.state,r,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.plugin.create(e,this.spec.arg)}catch(t){St(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(r){St(e.state,r,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Hm=oe.define(),Pc=oe.define(),To=oe.define(),jm=oe.define(),Bc=oe.define(),Zn=oe.define(),zm=oe.define();function Ku(i,e){let t=i.state.facet(zm);if(!t.length)return t;let r=t.map(s=>s instanceof Function?s(i):s),n=[];return ye.spans(r,e.from,e.to,{point(){},span(s,l,o,a){let c=s-e.from,h=l-e.from,u=n;for(let f=o.length-1;f>=0;f--,a--){let d=o[f].spec.bidiIsolate,y;if(d==null&&(d=hk(e.text,c,h)),a>0&&u.length&&(y=u[u.length-1]).to==c&&y.direction==d)y.to=h,u=y.inner;else{let _={from:c,to:h,direction:d,inner:[]};u.push(_),u=_.inner}}}}),n}const Wm=oe.define();function Oc(i){let e=0,t=0,r=0,n=0;for(let s of i.state.facet(Wm)){let l=s(i);l&&(l.left!=null&&(e=Math.max(e,l.left)),l.right!=null&&(t=Math.max(t,l.right)),l.top!=null&&(r=Math.max(r,l.top)),l.bottom!=null&&(n=Math.max(n,l.bottom)))}return{left:e,right:t,top:r,bottom:n}}const dn=oe.define();class Ft{constructor(e,t,r,n){this.fromA=e,this.toA=t,this.fromB=r,this.toB=n}join(e){return new Ft(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,r=this;for(;t>0;t--){let n=e[t-1];if(!(n.fromA>r.toA)){if(n.toA<r.fromA)break;r=r.join(n),e.splice(t-1,1)}}return e.splice(t,0,r),e}static extendWithRanges(e,t){if(t.length==0)return e;let r=[];for(let n=0,s=0,l=0;;){let o=n<e.length?e[n].fromB:1e9,a=s<t.length?t[s]:1e9,c=Math.min(o,a);if(c==1e9)break;let h=c+l,u=c,f=h;for(;;)if(s<t.length&&t[s]<=u){let d=t[s+1];s+=2,u=Math.max(u,d);for(let y=n;y<e.length&&e[y].fromB<=u;y++)l=e[y].toA-e[y].toB;f=Math.max(f,d+l)}else if(n<e.length&&e[n].fromB<=u){let d=e[n++];u=Math.max(u,d.toB),f=Math.max(f,d.toA),l=d.toA-d.toB}else break;r.push(new Ft(h,f,c,u))}return r}}class to{constructor(e,t,r){this.view=e,this.state=t,this.transactions=r,this.flags=0,this.startState=e.state,this.changes=Ke.empty(this.startState.doc.length);for(let s of r)this.changes=this.changes.compose(s.changes);let n=[];this.changes.iterChangedRanges((s,l,o,a)=>n.push(new Ft(s,l,o,a))),this.changedRanges=n}static create(e,t,r){return new to(e,t,r)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}const dk=[];class Ve{constructor(e,t,r=0){this.dom=e,this.length=t,this.flags=r,this.parent=null,e.cmTile=this}get breakAfter(){return this.flags&1}get children(){return dk}isWidget(){return!1}get isHidden(){return!1}isComposite(){return!1}isLine(){return!1}isText(){return!1}isBlock(){return!1}get domAttrs(){return null}sync(e){if(this.flags|=2,this.flags&4){this.flags&=-5;let t=this.domAttrs;t&&KC(this.dom,t)}}toString(){return this.constructor.name+(this.children.length?`(${this.children})`:"")+(this.breakAfter?"#":"")}destroy(){this.parent=null}setDOM(e){this.dom=e,e.cmTile=this}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e,t=this.posAtStart){let r=t;for(let n of this.children){if(n==e)return r;r+=n.length+n.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}covers(e){return!0}coordsIn(e,t){return null}domPosFor(e,t){let r=Wi(this.dom),n=this.length?e>0:t>0;return new Kt(this.parent.dom,r+(n?1:0),e==0||e==this.length)}markDirty(e){this.flags&=-3,e&&(this.flags|=4),this.parent&&this.parent.flags&2&&this.parent.markDirty(!1)}get overrideDOMText(){return null}get root(){for(let e=this;e;e=e.parent)if(e instanceof Po)return e;return null}static get(e){return e.cmTile}}class Ro extends Ve{constructor(e){super(e,0),this._children=[]}isComposite(){return!0}get children(){return this._children}get lastChild(){return this.children.length?this.children[this.children.length-1]:null}append(e){this.children.push(e),e.parent=this}sync(e){if(this.flags&2)return;super.sync(e);let t=this.dom,r=null,n,s=(e==null?void 0:e.node)==t?e:null,l=0;for(let o of this.children){if(o.sync(e),l+=o.length+o.breakAfter,n=r?r.nextSibling:t.firstChild,s&&n!=o.dom&&(s.written=!0),o.dom.parentNode==t)for(;n&&n!=o.dom;)n=Gu(n);else t.insertBefore(o.dom,n);r=o.dom}for(n=r?r.nextSibling:t.firstChild,s&&n&&(s.written=!0);n;)n=Gu(n);this.length=l}}function Gu(i){let e=i.nextSibling;return i.parentNode.removeChild(i),e}class Po extends Ro{constructor(e,t){super(t),this.view=e}owns(e){for(;e;e=e.parent)if(e==this)return!0;return!1}isBlock(){return!0}nearest(e){for(;;){if(!e)return null;let t=Ve.get(e);if(t&&this.owns(t))return t;e=e.parentNode}}blockTiles(e){for(let t=[],r=this,n=0,s=0;;)if(n==r.children.length){if(!t.length)return;r=r.parent,r.breakAfter&&s++,n=t.pop()}else{let l=r.children[n++];if(l instanceof Oi)t.push(n),r=l,n=0;else{let o=s+l.length,a=e(l,s);if(a!==void 0)return a;s=o+l.breakAfter}}}resolveBlock(e,t){let r,n=-1,s,l=-1;if(this.blockTiles((o,a)=>{let c=a+o.length;if(e>=a&&e<=c){if(o.isWidget()&&t>=-1&&t<=1){if(o.flags&32)return!0;o.flags&16&&(r=void 0)}(a<e||e==c&&(t<-1?o.length:o.covers(1)))&&(!r||!o.isWidget()&&r.isWidget())&&(r=o,n=e-a),(c>e||e==a&&(t>1?o.length:o.covers(-1)))&&(!s||!o.isWidget()&&s.isWidget())&&(s=o,l=e-a)}}),!r&&!s)throw new Error("No tile at position "+e);return r&&t<0||!s?{tile:r,offset:n}:{tile:s,offset:l}}}class Oi extends Ro{constructor(e,t){super(e),this.wrapper=t}isBlock(){return!0}covers(e){return this.children.length?e<0?this.children[0].covers(-1):this.lastChild.covers(1):!1}get domAttrs(){return this.wrapper.attributes}static of(e,t){let r=new Oi(t||document.createElement(e.tagName),e);return t||(r.flags|=4),r}}class $r extends Ro{constructor(e,t){super(e),this.attrs=t}isLine(){return!0}static start(e,t,r){let n=new $r(t||document.createElement("div"),e);return(!t||!r)&&(n.flags|=4),n}get domAttrs(){return this.attrs}resolveInline(e,t,r){let n=null,s=-1,l=null,o=-1;function a(h,u){for(let f=0,d=0;f<h.children.length&&d<=u;f++){let y=h.children[f],_=d+y.length;_>=u&&(y.isComposite()?a(y,u-d):(!l||l.isHidden&&(t>0||r&&mk(l,y)))&&(_>u||y.flags&32)?(l=y,o=u-d):(d<u||y.flags&16&&!y.isHidden)&&(n=y,s=u-d)),d=_}}a(this,e);let c=(t<0?n:l)||n||l;return c?{tile:c,offset:c==n?s:o}:null}coordsIn(e,t){let r=this.resolveInline(e,t,!0);return r?r.tile.coordsIn(Math.max(0,r.offset),t):pk(this)}domIn(e,t){let r=this.resolveInline(e,t);if(r){let{tile:n,offset:s}=r;if(this.dom.contains(n.dom))return n.isText()?new Kt(n.dom,Math.min(n.dom.nodeValue.length,s)):n.domPosFor(s,n.flags&16?1:n.flags&32?-1:t);let l=r.tile.parent,o=!1;for(let a of l.children){if(o)return new Kt(a.dom,0);a==r.tile&&(o=!0)}}return new Kt(this.dom,0)}}function pk(i){let e=i.dom.lastChild;if(!e)return i.dom.getBoundingClientRect();let t=zs(e);return t[t.length-1]||null}function mk(i,e){let t=i.coordsIn(0,1),r=e.coordsIn(0,1);return t&&r&&r.top<t.bottom}class xt extends Ro{constructor(e,t){super(e),this.mark=t}get domAttrs(){return this.mark.attrs}static of(e,t){let r=new xt(t||document.createElement(e.tagName),e);return t||(r.flags|=4),r}}class sr extends Ve{constructor(e,t){super(e,t.length),this.text=t}sync(e){this.flags&2||(super.sync(e),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text))}isText(){return!0}toString(){return JSON.stringify(this.text)}coordsIn(e,t){let r=this.dom.nodeValue.length;e>r&&(e=r);let n=e,s=e,l=0;e==0&&t<0||e==r&&t>=0?ne.chrome||ne.gecko||(e?(n--,l=1):s<r&&(s++,l=-1)):t<0?n--:s<r&&s++;let o=Pn(this.dom,n,s).getClientRects();if(!o.length)return null;let a=o[(l?l<0:t>=0)?0:o.length-1];return ne.safari&&!l&&a.width==0&&(a=Array.prototype.find.call(o,c=>c.width)||a),l?eo(a,l<0):a||null}static of(e,t){let r=new sr(t||document.createTextNode(e),e);return t||(r.flags|=2),r}}class pr extends Ve{constructor(e,t,r,n){super(e,t,n),this.widget=r}isWidget(){return!0}get isHidden(){return this.widget.isHidden}covers(e){return this.flags&48?!1:(this.flags&(e<0?64:128))>0}coordsIn(e,t){return this.coordsInWidget(e,t,!1)}coordsInWidget(e,t,r){let n=this.widget.coordsAt(this.dom,e,t);if(n)return n;if(r)return eo(this.dom.getBoundingClientRect(),this.length?e==0:t<=0);{let s=this.dom.getClientRects(),l=null;if(!s.length)return null;let o=this.flags&16?!0:this.flags&32?!1:e>0;for(let a=o?s.length-1:0;l=s[a],!(e>0?a==0:a==s.length-1||l.top<l.bottom);a+=o?-1:1);return eo(l,!o)}}get overrideDOMText(){if(!this.length)return Ee.empty;let{root:e}=this;if(!e)return Ee.empty;let t=this.posAtStart;return e.view.state.doc.slice(t,t+this.length)}destroy(){super.destroy(),this.widget.destroy(this.dom)}static of(e,t,r,n,s){return s||(s=e.toDOM(t),e.editable||(s.contentEditable="false")),new pr(s,r,e,n)}}class io extends Ve{constructor(e){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),super(t,0,e)}get isHidden(){return!0}get overrideDOMText(){return Ee.empty}coordsIn(e){return this.dom.getBoundingClientRect()}}class gk{constructor(e){this.index=0,this.beforeBreak=!1,this.parents=[],this.tile=e}advance(e,t,r){let{tile:n,index:s,beforeBreak:l,parents:o}=this;for(;e||t>0;)if(n.isComposite())if(l){if(!e)break;r&&r.break(),e--,l=!1}else if(s==n.children.length){if(!e&&!o.length)break;r&&r.leave(n),l=!!n.breakAfter,{tile:n,index:s}=o.pop(),s++}else{let a=n.children[s],c=a.breakAfter;(t>0?a.length<=e:a.length<e)&&(!r||r.skip(a,0,a.length)!==!1||!a.isComposite)?(l=!!c,s++,e-=a.length):(o.push({tile:n,index:s}),n=a,s=0,r&&a.isComposite()&&r.enter(a))}else if(s==n.length)l=!!n.breakAfter,{tile:n,index:s}=o.pop(),s++;else if(e){let a=Math.min(e,n.length-s);r&&r.skip(n,s,s+a),e-=a,s+=a}else break;return this.tile=n,this.index=s,this.beforeBreak=l,this}get root(){return this.parents.length?this.parents[0].tile:this.tile}}class vk{constructor(e,t,r,n){this.from=e,this.to=t,this.wrapper=r,this.rank=n}}class _k{constructor(e,t,r){this.cache=e,this.root=t,this.blockWrappers=r,this.curLine=null,this.lastBlock=null,this.afterWidget=null,this.pos=0,this.wrappers=[],this.wrapperPos=0}addText(e,t,r,n){var s;this.flushBuffer();let l=this.ensureMarks(t,r),o=l.lastChild;if(o&&o.isText()&&!(o.flags&8)&&o.length+e.length<512){this.cache.reused.set(o,2);let a=l.children[l.children.length-1]=new sr(o.dom,o.text+e);a.parent=l}else l.append(n||sr.of(e,(s=this.cache.find(sr))===null||s===void 0?void 0:s.dom));this.pos+=e.length,this.afterWidget=null}addComposition(e,t){let r=this.curLine;r.dom!=t.line.dom&&(r.setDOM(this.cache.reused.has(t.line)?yl(t.line.dom):t.line.dom),this.cache.reused.set(t.line,2));let n=r;for(let o=t.marks.length-1;o>=0;o--){let a=t.marks[o],c=n.lastChild;if(c instanceof xt&&c.mark.eq(a.mark))c.dom!=a.dom&&c.setDOM(yl(a.dom)),n=c;else{if(this.cache.reused.get(a)){let u=Ve.get(a.dom);u&&u.setDOM(yl(a.dom))}let h=xt.of(a.mark,a.dom);n.append(h),n=h}this.cache.reused.set(a,2)}let s=Ve.get(e.text);s&&this.cache.reused.set(s,2);let l=new sr(e.text,e.text.nodeValue);l.flags|=8,n.append(l)}addInlineWidget(e,t,r){let n=this.afterWidget&&e.flags&48&&(this.afterWidget.flags&48)==(e.flags&48);n||this.flushBuffer();let s=this.ensureMarks(t,r);!n&&!(e.flags&16)&&s.append(this.getBuffer(1)),s.append(e),this.pos+=e.length,this.afterWidget=e}addMark(e,t,r){this.flushBuffer(),this.ensureMarks(t,r).append(e),this.pos+=e.length,this.afterWidget=null}addBlockWidget(e){this.getBlockPos().append(e),this.pos+=e.length,this.lastBlock=e,this.endLine()}continueWidget(e){let t=this.afterWidget||this.lastBlock;t.length+=e,this.pos+=e}addLineStart(e,t){var r;e||(e=$m);let n=$r.start(e,t||((r=this.cache.find($r))===null||r===void 0?void 0:r.dom),!!t);this.getBlockPos().append(this.lastBlock=this.curLine=n)}addLine(e){this.getBlockPos().append(e),this.pos+=e.length,this.lastBlock=e,this.endLine()}addBreak(){this.lastBlock.flags|=1,this.endLine(),this.pos++}addLineStartIfNotCovered(e){this.blockPosCovered()||this.addLineStart(e)}ensureLine(e){this.curLine||this.addLineStart(e)}ensureMarks(e,t){var r;let n=this.curLine;for(let s=e.length-1;s>=0;s--){let l=e[s],o;if(t>0&&(o=n.lastChild)&&o instanceof xt&&o.mark.eq(l))n=o,t--;else{let a=xt.of(l,(r=this.cache.find(xt,c=>c.mark.eq(l)))===null||r===void 0?void 0:r.dom);n.append(a),n=a,t=0}}return n}endLine(){if(this.curLine){this.flushBuffer();let e=this.curLine.lastChild;(!e||!Xu(this.curLine,!1)||e.dom.nodeName!="BR"&&e.isWidget()&&!(ne.ios&&Xu(this.curLine,!0)))&&this.curLine.append(this.cache.findWidget(bl,0,32)||new pr(bl.toDOM(),0,bl,32)),this.curLine=this.afterWidget=null}}updateBlockWrappers(){this.wrapperPos>this.pos+1e4&&(this.blockWrappers.goto(this.pos),this.wrappers.length=0);for(let e=this.wrappers.length-1;e>=0;e--)this.wrappers[e].to<this.pos&&this.wrappers.splice(e,1);for(let e=this.blockWrappers;e.value&&e.from<=this.pos;e.next())if(e.to>=this.pos){let t=new vk(e.from,e.to,e.value,e.rank),r=this.wrappers.length;for(;r>0&&(this.wrappers[r-1].rank-t.rank||this.wrappers[r-1].to-t.to)<0;)r--;this.wrappers.splice(r,0,t)}this.wrapperPos=this.pos}getBlockPos(){var e;this.updateBlockWrappers();let t=this.root;for(let r of this.wrappers){let n=t.lastChild;if(r.from<this.pos&&n instanceof Oi&&n.wrapper.eq(r.wrapper))t=n;else{let s=Oi.of(r.wrapper,(e=this.cache.find(Oi,l=>l.wrapper.eq(r.wrapper)))===null||e===void 0?void 0:e.dom);t.append(s),t=s}}return t}blockPosCovered(){let e=this.lastBlock;return e!=null&&!e.breakAfter&&(!e.isWidget()||(e.flags&160)>0)}getBuffer(e){let t=2|(e<0?16:32),r=this.cache.find(io,void 0,1);return r&&(r.flags=t),r||new io(t)}flushBuffer(){this.afterWidget&&!(this.afterWidget.flags&32)&&(this.afterWidget.parent.append(this.getBuffer(-1)),this.afterWidget=null)}}class yk{constructor(e){this.skipCount=0,this.text="",this.textOff=0,this.cursor=e.iter()}skip(e){this.textOff+e<=this.text.length?this.textOff+=e:(this.skipCount+=e-(this.text.length-this.textOff),this.text="",this.textOff=0)}next(e){if(this.textOff==this.text.length){let{value:n,lineBreak:s,done:l}=this.cursor.next(this.skipCount);if(this.skipCount=0,l)throw new Error("Ran out of text content when drawing inline views");this.text=n;let o=this.textOff=Math.min(e,n.length);return s?null:n.slice(0,o)}let t=Math.min(this.text.length,this.textOff+e),r=this.text.slice(this.textOff,t);return this.textOff=t,r}}const ro=[pr,$r,sr,xt,io,Oi,Po];for(let i=0;i<ro.length;i++)ro[i].bucket=i;class bk{constructor(e){this.view=e,this.buckets=ro.map(()=>[]),this.index=ro.map(()=>0),this.reused=new Map}add(e){let t=e.constructor.bucket,r=this.buckets[t];r.length<6?r.push(e):r[this.index[t]=(this.index[t]+1)%6]=e}find(e,t,r=2){let n=e.bucket,s=this.buckets[n],l=this.index[n];for(let o=s.length-1;o>=0;o--){let a=(o+l)%s.length,c=s[a];if((!t||t(c))&&!this.reused.has(c))return s.splice(a,1),a<l&&this.index[n]--,this.reused.set(c,r),c}return null}findWidget(e,t,r){let n=this.buckets[0];if(n.length)for(let s=0,l=0;;s++){if(s==n.length){if(l)return null;l=1,s=0}let o=n[s];if(!this.reused.has(o)&&(l==0?o.widget.compare(e):o.widget.constructor==e.constructor&&e.updateDOM(o.dom,this.view)))return n.splice(s,1),s<this.index[0]&&this.index[0]--,o.widget==e&&o.length==t&&(o.flags&497)==r?(this.reused.set(o,1),o):(this.reused.set(o,2),new pr(o.dom,t,e,o.flags&-498|r))}}reuse(e){return this.reused.set(e,1),e}maybeReuse(e,t=2){if(!this.reused.has(e))return this.reused.set(e,t),e.dom}clear(){for(let e=0;e<this.buckets.length;e++)this.buckets[e].length=this.index[e]=0}}class xk{constructor(e,t,r,n,s){this.view=e,this.decorations=n,this.disallowBlockEffectsFor=s,this.openWidget=!1,this.openMarks=0,this.cache=new bk(e),this.text=new yk(e.state.doc),this.builder=new _k(this.cache,new Po(e,e.contentDOM),ye.iter(r)),this.cache.reused.set(t,2),this.old=new gk(t),this.reuseWalker={skip:(l,o,a)=>{if(this.cache.add(l),l.isComposite())return!1},enter:l=>this.cache.add(l),leave:()=>{},break:()=>{}}}run(e,t){let r=t&&this.getCompositionContext(t.text);for(let n=0,s=0,l=0;;){let o=l<e.length?e[l++]:null,a=o?o.fromA:this.old.root.length;if(a>n){let c=a-n;this.preserve(c,!l,!o),n=a,s+=c}if(!o)break;t&&o.fromA<=t.range.fromA&&o.toA>=t.range.toA?(this.forward(o.fromA,t.range.fromA,t.range.fromA<t.range.toA?1:-1),this.emit(s,t.range.fromB),this.cache.clear(),this.builder.addComposition(t,r),this.text.skip(t.range.toB-t.range.fromB),this.forward(t.range.fromA,o.toA),this.emit(t.range.toB,o.toB)):(this.forward(o.fromA,o.toA),this.emit(s,o.toB)),s=o.toB,n=o.toA}return this.builder.curLine&&this.builder.endLine(),this.builder.root}preserve(e,t,r){let n=Ck(this.old),s=this.openMarks;this.old.advance(e,r?1:-1,{skip:(l,o,a)=>{if(l.isWidget())if(this.openWidget)this.builder.continueWidget(a-o);else{let c=a>0||o<l.length?pr.of(l.widget,this.view,a-o,l.flags&496,this.cache.maybeReuse(l)):this.cache.reuse(l);c.flags&256?(c.flags&=-2,this.builder.addBlockWidget(c)):(this.builder.ensureLine(null),this.builder.addInlineWidget(c,n,s),s=n.length)}else if(l.isText())this.builder.ensureLine(null),!o&&a==l.length?this.builder.addText(l.text,n,s,this.cache.reuse(l)):(this.cache.add(l),this.builder.addText(l.text.slice(o,a),n,s)),s=n.length;else if(l.isLine())l.flags&=-2,this.cache.reused.set(l,1),this.builder.addLine(l);else if(l instanceof io)this.cache.add(l);else if(l instanceof xt)this.builder.ensureLine(null),this.builder.addMark(l,n,s),this.cache.reused.set(l,1),s=n.length;else return!1;this.openWidget=!1},enter:l=>{l.isLine()?this.builder.addLineStart(l.attrs,this.cache.maybeReuse(l)):(this.cache.add(l),l instanceof xt&&n.unshift(l.mark)),this.openWidget=!1},leave:l=>{l.isLine()?n.length&&(n.length=s=0):l instanceof xt&&(n.shift(),s=Math.min(s,n.length))},break:()=>{this.builder.addBreak(),this.openWidget=!1}}),this.text.skip(e)}emit(e,t){let r=null,n=this.builder,s=0,l=ye.spans(this.decorations,e,t,{point:(o,a,c,h,u,f)=>{if(c instanceof fr){if(this.disallowBlockEffectsFor[f]){if(c.block)throw new RangeError("Block decorations may not be specified via plugins");if(a>this.view.state.doc.lineAt(o).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}if(s=h.length,u>h.length)n.continueWidget(a-o);else{let d=c.widget||(c.block?Vr.block:Vr.inline),y=Sk(c),_=this.cache.findWidget(d,a-o,y)||pr.of(d,this.view,a-o,y);c.block?(c.startSide>0&&n.addLineStartIfNotCovered(r),n.addBlockWidget(_)):(n.ensureLine(r),n.addInlineWidget(_,h,u))}r=null}else r=wk(r,c);a>o&&this.text.skip(a-o)},span:(o,a,c,h)=>{for(let u=o;u<a;){let f=this.text.next(Math.min(512,a-u));f==null?(n.addLineStartIfNotCovered(r),n.addBreak(),u++):(n.ensureLine(r),n.addText(f,c,u==o?h:c.length),u+=f.length),r=null}}});n.addLineStartIfNotCovered(r),this.openWidget=l>s,this.openMarks=l}forward(e,t,r=1){t-e<=10?this.old.advance(t-e,r,this.reuseWalker):(this.old.advance(5,-1,this.reuseWalker),this.old.advance(t-e-10,-1),this.old.advance(5,r,this.reuseWalker))}getCompositionContext(e){let t=[],r=null;for(let n=e.parentNode;;n=n.parentNode){let s=Ve.get(n);if(n==this.view.contentDOM)break;s instanceof xt?t.push(s):s!=null&&s.isLine()?r=s:n.nodeName=="DIV"&&!r&&n!=this.view.contentDOM?r=new $r(n,$m):t.push(xt.of(new Yn({tagName:n.nodeName.toLowerCase(),attributes:GC(n)}),n))}return{line:r,marks:t}}}function Xu(i,e){let t=r=>{for(let n of r.children)if((e?n.isText():n.length)||t(n))return!0;return!1};return t(i)}function Sk(i){let e=i.isReplace?(i.startSide<0?64:0)|(i.endSide>0?128:0):i.startSide>0?32:16;return i.block&&(e|=256),e}const $m={class:"cm-line"};function wk(i,e){let t=e.spec.attributes,r=e.spec.class;return!t&&!r||(i||(i={class:"cm-line"}),t&&Dc(t,i),r&&(i.class+=" "+r)),i}function Ck(i){let e=[];for(let t=i.parents.length;t>1;t--){let r=t==i.parents.length?i.tile:i.parents[t].tile;r instanceof xt&&e.push(r.mark)}return e}function yl(i){let e=Ve.get(i);return e&&e.setDOM(i.cloneNode()),i}class Vr extends Ki{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}Vr.inline=new Vr("span");Vr.block=new Vr("div");const bl=new class extends Ki{toDOM(){return document.createElement("br")}get isHidden(){return!0}get editable(){return!0}};class Ju{constructor(e){this.view=e,this.decorations=[],this.blockWrappers=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.editContextFormatting=he.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.updateDeco(),this.tile=new Po(e,e.contentDOM),this.updateInner([new Ft(0,0,0,e.state.doc.length)],null)}update(e){var t;let r=e.changedRanges;this.minWidth>0&&r.length&&(r.every(({fromA:h,toA:u})=>u<this.minWidthFrom||h>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let n=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((t=this.domChanged)===null||t===void 0)&&t.newSel?n=this.domChanged.newSel.head:!Pk(e.changes,this.hasComposition)&&!e.selectionSet&&(n=e.state.selection.main.head));let s=n>-1?Ek(this.view,e.changes,n):null;if(this.domChanged=null,this.hasComposition){let{from:h,to:u}=this.hasComposition;r=new Ft(h,u,e.changes.mapPos(h,-1),e.changes.mapPos(u,1)).addToSet(r.slice())}this.hasComposition=s?{from:s.range.fromB,to:s.range.toB}:null,(ne.ie||ne.chrome)&&!s&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let l=this.decorations,o=this.blockWrappers;this.updateDeco();let a=Lk(l,this.decorations,e.changes);a.length&&(r=Ft.extendWithRanges(r,a));let c=Tk(o,this.blockWrappers,e.changes);return c.length&&(r=Ft.extendWithRanges(r,c)),s&&!r.some(h=>h.fromA<=s.range.fromA&&h.toA>=s.range.toA)&&(r=s.range.addToSet(r.slice())),this.tile.flags&2&&r.length==0?!1:(this.updateInner(r,s),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t){this.view.viewState.mustMeasureContent=!0;let{observer:r}=this.view;r.ignore(()=>{if(t||e.length){let l=this.tile,o=new xk(this.view,l,this.blockWrappers,this.decorations,this.dynamicDecorationMap);this.tile=o.run(e,t),Aa(l,o.cache.reused)}this.tile.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.tile.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let s=ne.chrome||ne.ios?{node:r.selectionRange.focusNode,written:!1}:void 0;this.tile.sync(s),s&&(s.written||r.selectionRange.focusNode!=s.node||!this.tile.dom.contains(s.node))&&(this.forceSelection=!0),this.tile.dom.style.height=""});let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let s of this.tile.children)s.isWidget()&&s.widget instanceof xl&&n.push(s.dom);r.updateGaps(n)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let t of e.transactions)for(let r of t.effects)r.is(Fm)&&(this.editContextFormatting=r.value)}updateSelection(e=!1,t=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let{dom:r}=this.tile,n=this.view.root.activeElement,s=n==r,l=!s&&!(this.view.state.facet(vi)||r.tabIndex>-1)&&Sn(r,this.view.observer.selectionRange)&&!(n&&r.contains(n));if(!(s||t||l))return;let o=this.forceSelection;this.forceSelection=!1;let a=this.view.state.selection.main,c,h;if(a.empty?h=c=this.inlineDOMNearPos(a.anchor,a.assoc||1):(h=this.inlineDOMNearPos(a.head,a.head==a.from?1:-1),c=this.inlineDOMNearPos(a.anchor,a.anchor==a.from?1:-1)),ne.gecko&&a.empty&&!this.hasComposition&&kk(c)){let f=document.createTextNode("");this.view.observer.ignore(()=>c.node.insertBefore(f,c.node.childNodes[c.offset]||null)),c=h=new Kt(f,0),o=!0}let u=this.view.observer.selectionRange;(o||!u.focusNode||(!wn(c.node,c.offset,u.anchorNode,u.anchorOffset)||!wn(h.node,h.offset,u.focusNode,u.focusOffset))&&!this.suppressWidgetCursorChange(u,a))&&(this.view.observer.ignore(()=>{ne.android&&ne.chrome&&r.contains(u.focusNode)&&Rk(u.focusNode,r)&&(r.blur(),r.focus({preventScroll:!0}));let f=Wr(this.view.root);if(f)if(a.empty){if(ne.gecko){let d=Ak(c.node,c.offset);if(d&&d!=3){let y=(d==1?wm:Cm)(c.node,c.offset);y&&(c=new Kt(y.node,y.offset))}}f.collapse(c.node,c.offset),a.bidiLevel!=null&&f.caretBidiLevel!==void 0&&(f.caretBidiLevel=a.bidiLevel)}else if(f.extend){f.collapse(c.node,c.offset);try{f.extend(h.node,h.offset)}catch{}}else{let d=document.createRange();a.anchor>a.head&&([c,h]=[h,c]),d.setEnd(h.node,h.offset),d.setStart(c.node,c.offset),f.removeAllRanges(),f.addRange(d)}l&&this.view.root.activeElement==r&&(r.blur(),n&&n.focus())}),this.view.observer.setSelectionRange(c,h)),this.impreciseAnchor=c.precise?null:new Kt(u.anchorNode,u.anchorOffset),this.impreciseHead=h.precise?null:new Kt(u.focusNode,u.focusOffset)}suppressWidgetCursorChange(e,t){return this.hasComposition&&t.empty&&wn(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==t.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,r=Wr(e.root),{anchorNode:n,anchorOffset:s}=e.observer.selectionRange;if(!r||!t.empty||!t.assoc||!r.modify)return;let l=this.lineAt(t.head,t.assoc);if(!l)return;let o=l.posAtStart;if(t.head==o||t.head==o+l.length)return;let a=this.coordsAt(t.head,-1),c=this.coordsAt(t.head,1);if(!a||!c||a.bottom>c.top)return;let h=this.domAtPos(t.head+t.assoc,t.assoc);r.collapse(h.node,h.offset),r.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let u=e.observer.selectionRange;e.docView.posFromDOM(u.anchorNode,u.anchorOffset)!=t.from&&r.collapse(n,s)}posFromDOM(e,t){let r=this.tile.nearest(e);if(!r)return this.tile.dom.compareDocumentPosition(e)&2?0:this.view.state.doc.length;let n=r.posAtStart;if(r.isComposite()){let s;if(e==r.dom)s=r.dom.childNodes[t];else{let l=xi(e)==0?0:t==0?-1:1;for(;;){let o=e.parentNode;if(o==r.dom)break;l==0&&o.firstChild!=o.lastChild&&(e==o.firstChild?l=-1:l=1),e=o}l<0?s=e:s=e.nextSibling}if(s==r.dom.firstChild)return n;for(;s&&!Ve.get(s);)s=s.nextSibling;if(!s)return n+r.length;for(let l=0,o=n;;l++){let a=r.children[l];if(a.dom==s)return o;o+=a.length+a.breakAfter}}else return r.isText()?e==r.dom?n+t:n+(t?r.length:0):n}domAtPos(e,t){let{tile:r,offset:n}=this.tile.resolveBlock(e,t);return r.isWidget()?r.domPosFor(e,t):r.domIn(n,t)}inlineDOMNearPos(e,t){let r,n=-1,s=!1,l,o=-1,a=!1;return this.tile.blockTiles((c,h)=>{if(c.isWidget()){if(c.flags&32&&h>=e)return!0;c.flags&16&&(s=!0)}else{let u=h+c.length;if(h<=e&&(r=c,n=e-h,s=u<e),u>=e&&!l&&(l=c,o=e-h,a=h>e),h>e&&l)return!0}}),!r&&!l?this.domAtPos(e,t):(s&&l?r=null:a&&r&&(l=null),r&&t<0||!l?r.domIn(n,t):l.domIn(o,t))}coordsAt(e,t){let{tile:r,offset:n}=this.tile.resolveBlock(e,t);return r.isWidget()?r.widget instanceof xl?null:r.coordsInWidget(n,t,!0):r.coordsIn(n,t)}lineAt(e,t){let{tile:r}=this.tile.resolveBlock(e,t);return r.isLine()?r:null}coordsForChar(e){let{tile:t,offset:r}=this.tile.resolveBlock(e,1);if(!t.isLine())return null;function n(s,l){if(s.isComposite())for(let o of s.children){if(o.length>=l){let a=n(o,l);if(a)return a}if(l-=o.length,l<0)break}else if(s.isText()&&l<s.length){let o=Ge(s.text,l);if(o==l)return null;let a=Pn(s.dom,l,o).getClientRects();for(let c=0;c<a.length;c++){let h=a[c];if(c==a.length-1||h.top<h.bottom&&h.left<h.right)return h}}return null}return n(t,r)}measureVisibleLineHeights(e){let t=[],{from:r,to:n}=e,s=this.view.contentDOM.clientWidth,l=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1,a=this.view.textDirection==He.LTR,c=0,h=(u,f,d)=>{for(let y=0;y<u.children.length&&!(f>n);y++){let _=u.children[y],m=f+_.length,p=_.dom.getBoundingClientRect(),{height:g}=p;if(d&&!y&&(c+=p.top-d.top),_ instanceof Oi)m>r&&h(_,f,p);else if(f>=r&&(c>0&&t.push(-c),t.push(g+c),c=0,l)){let v=_.dom.lastChild,b=v?zs(v):[];if(b.length){let S=b[b.length-1],x=a?S.right-p.left:p.right-S.left;x>o&&(o=x,this.minWidth=s,this.minWidthFrom=f,this.minWidthTo=m)}}d&&y==u.children.length-1&&(c+=d.bottom-p.bottom),f=m+_.breakAfter}};return h(this.tile,0,null),t}textDirectionAt(e){let{tile:t}=this.tile.resolveBlock(e,1);return getComputedStyle(t.dom).direction=="rtl"?He.RTL:He.LTR}measureTextSize(){let e=this.tile.blockTiles(l=>{if(l.isLine()&&l.children.length&&l.length<=20){let o=0,a;for(let c of l.children){if(!c.isText()||/[^ -~]/.test(c.text))return;let h=zs(c.dom);if(h.length!=1)return;o+=h[0].width,a=h[0].height}if(o)return{lineHeight:l.dom.getBoundingClientRect().height,charWidth:o/l.length,textHeight:a}}});if(e)return e;let t=document.createElement("div"),r,n,s;return t.className="cm-line",t.style.width="99999px",t.style.position="absolute",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.tile.dom.appendChild(t);let l=zs(t.firstChild)[0];r=t.getBoundingClientRect().height,n=l&&l.width?l.width/27:7,s=l&&l.height?l.height:r,t.remove()}),{lineHeight:r,charWidth:n,textHeight:s}}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let r=0,n=0;;n++){let s=n==t.viewports.length?null:t.viewports[n],l=s?s.from-1:this.view.state.doc.length;if(l>r){let o=(t.lineBlockAt(l).bottom-t.lineBlockAt(r).top)/this.view.scaleY;e.push(he.replace({widget:new xl(o),block:!0,inclusive:!0,isBlockGap:!0}).range(r,l))}if(!s)break;r=s.to+1}return he.set(e)}updateDeco(){let e=1,t=this.view.state.facet(To).map(s=>(this.dynamicDecorationMap[e++]=typeof s=="function")?s(this.view):s),r=!1,n=this.view.state.facet(Bc).map((s,l)=>{let o=typeof s=="function";return o&&(r=!0),o?s(this.view):s});for(n.length&&(this.dynamicDecorationMap[e++]=r,t.push(ye.join(n))),this.decorations=[this.editContextFormatting,...t,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;this.blockWrappers=this.view.state.facet(jm).map(s=>typeof s=="function"?s(this.view):s)}scrollIntoView(e){if(e.isSnapshot){let c=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=c.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}for(let c of this.view.state.facet(Nm))try{if(c(this.view,e.range,e))return!0}catch(h){St(this.view.state,h,"scroll handler")}let{range:t}=e,r=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),n;if(!r)return;!t.empty&&(n=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(r={left:Math.min(r.left,n.left),top:Math.min(r.top,n.top),right:Math.max(r.right,n.right),bottom:Math.max(r.bottom,n.bottom)});let s=Oc(this.view),l={left:r.left-s.left,top:r.top-s.top,right:r.right+s.right,bottom:r.bottom+s.bottom},{offsetWidth:o,offsetHeight:a}=this.view.scrollDOM;YC(this.view.scrollDOM,l,t.head<t.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,o),-o),Math.max(Math.min(e.yMargin,a),-a),this.view.textDirection==He.LTR)}lineHasWidget(e){let t=r=>r.isWidget()||r.children.some(t);return t(this.tile.resolveBlock(e,1).tile)}destroy(){Aa(this.tile)}}function Aa(i,e){let t=e==null?void 0:e.get(i);if(t!=1){t==null&&i.destroy();for(let r of i.children)Aa(r,e)}}function kk(i){return i.node.nodeType==1&&i.node.firstChild&&(i.offset==0||i.node.childNodes[i.offset-1].contentEditable=="false")&&(i.offset==i.node.childNodes.length||i.node.childNodes[i.offset].contentEditable=="false")}function Vm(i,e){let t=i.observer.selectionRange;if(!t.focusNode)return null;let r=wm(t.focusNode,t.focusOffset),n=Cm(t.focusNode,t.focusOffset),s=r||n;if(n&&r&&n.node!=r.node){let o=Ve.get(n.node);if(!o||o.isText()&&o.text!=n.node.nodeValue)s=n;else if(i.docView.lastCompositionAfterCursor){let a=Ve.get(r.node);!a||a.isText()&&a.text!=r.node.nodeValue||(s=n)}}if(i.docView.lastCompositionAfterCursor=s!=r,!s)return null;let l=e-s.offset;return{from:l,to:l+s.node.nodeValue.length,node:s.node}}function Ek(i,e,t){let r=Vm(i,t);if(!r)return null;let{node:n,from:s,to:l}=r,o=n.nodeValue;if(/[\n\r]/.test(o)||i.state.doc.sliceString(r.from,r.to)!=o)return null;let a=e.invertedDesc;return{range:new Ft(a.mapPos(s),a.mapPos(l),s,l),text:n}}function Ak(i,e){return i.nodeType!=1?0:(e&&i.childNodes[e-1].contentEditable=="false"?1:0)|(e<i.childNodes.length&&i.childNodes[e].contentEditable=="false"?2:0)}let Dk=class{constructor(){this.changes=[]}compareRange(e,t){Pr(e,t,this.changes)}comparePoint(e,t){Pr(e,t,this.changes)}boundChange(e){Pr(e,e,this.changes)}};function Lk(i,e,t){let r=new Dk;return ye.compare(i,e,t,r),r.changes}class Mk{constructor(){this.changes=[]}compareRange(e,t){Pr(e,t,this.changes)}comparePoint(){}boundChange(e){Pr(e,e,this.changes)}}function Tk(i,e,t){let r=new Mk;return ye.compare(i,e,t,r),r.changes}function Rk(i,e){for(let t=i;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function Pk(i,e){let t=!1;return e&&i.iterChangedRanges((r,n)=>{r<e.to&&n>e.from&&(t=!0)}),t}class xl extends Ki{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}function Bk(i,e,t=1){let r=i.charCategorizer(e),n=i.doc.lineAt(e),s=e-n.from;if(n.length==0)return G.cursor(e);s==0?t=1:s==n.length&&(t=-1);let l=s,o=s;t<0?l=Ge(n.text,s,!1):o=Ge(n.text,s);let a=r(n.text.slice(l,o));for(;l>0;){let c=Ge(n.text,l,!1);if(r(n.text.slice(c,l))!=a)break;l=c}for(;o<n.length;){let c=Ge(n.text,o);if(r(n.text.slice(o,c))!=a)break;o=c}return G.range(l+n.from,o+n.from)}function Ok(i,e,t,r,n){let s=Math.round((r-e.left)*i.defaultCharacterWidth);if(i.lineWrapping&&t.height>i.defaultLineHeight*1.5){let o=i.viewState.heightOracle.textHeight,a=Math.floor((n-t.top-(i.defaultLineHeight-o)*.5)/o);s+=a*i.viewState.heightOracle.lineLength}let l=i.state.sliceDoc(t.from,t.to);return t.from+zC(l,s,i.state.tabSize)}function Ik(i,e,t){let r=i.lineBlockAt(e);if(Array.isArray(r.type)){let n;for(let s of r.type){if(s.from>e)break;if(!(s.to<e)){if(s.from<e&&s.to>e)return s;(!n||s.type==Ct.Text&&(n.type!=s.type||(t<0?s.from<e:s.to>e)))&&(n=s)}}return n||r}return r}function Nk(i,e,t,r){let n=Ik(i,e.head,e.assoc||-1),s=!r||n.type!=Ct.Text||!(i.lineWrapping||n.widgetLineBreaks)?null:i.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head);if(s){let l=i.dom.getBoundingClientRect(),o=i.textDirectionAt(n.from),a=i.posAtCoords({x:t==(o==He.LTR)?l.right-1:l.left+1,y:(s.top+s.bottom)/2});if(a!=null)return G.cursor(a,t?-1:1)}return G.cursor(t?n.to:n.from,t?-1:1)}function Yu(i,e,t,r){let n=i.state.doc.lineAt(e.head),s=i.bidiSpans(n),l=i.textDirectionAt(n.from);for(let o=e,a=null;;){let c=ck(n,s,l,o,t),h=Lm;if(!c){if(n.number==(t?i.state.doc.lines:1))return o;h=`
`,n=i.state.doc.line(n.number+(t?1:-1)),s=i.bidiSpans(n),c=i.visualLineSide(n,!t)}if(a){if(!a(h))return o}else{if(!r)return c;a=r(h)}o=c}}function Fk(i,e,t){let r=i.state.charCategorizer(e),n=r(t);return s=>{let l=r(s);return n==Fe.Space&&(n=l),n==l}}function Hk(i,e,t,r){let n=e.head,s=t?1:-1;if(n==(t?i.state.doc.length:0))return G.cursor(n,e.assoc);let l=e.goalColumn,o,a=i.contentDOM.getBoundingClientRect(),c=i.coordsAtPos(n,e.assoc||-1),h=i.documentTop;if(c)l==null&&(l=c.left-a.left),o=s<0?c.top:c.bottom;else{let y=i.viewState.lineBlockAt(n);l==null&&(l=Math.min(a.right-a.left,i.defaultCharacterWidth*(n-y.from))),o=(s<0?y.top:y.bottom)+h}let u=a.left+l,f=r??i.viewState.heightOracle.textHeight>>1,d=Da(i,{x:u,y:o+f*s},!1,s);return G.cursor(d.pos,d.assoc,void 0,l)}function Cn(i,e,t){for(;;){let r=0;for(let n of i)n.between(e-1,e+1,(s,l,o)=>{if(e>s&&e<l){let a=r||t||(e-s<l-e?-1:1);e=a<0?s:l,r=a}});if(!r)return e}}function Um(i,e){let t=null;for(let r=0;r<e.ranges.length;r++){let n=e.ranges[r],s=null;if(n.empty){let l=Cn(i,n.from,0);l!=n.from&&(s=G.cursor(l,-1))}else{let l=Cn(i,n.from,-1),o=Cn(i,n.to,1);(l!=n.from||o!=n.to)&&(s=G.range(n.from==n.anchor?l:o,n.from==n.head?l:o))}s&&(t||(t=e.ranges.slice()),t[r]=s)}return t?G.create(t,e.mainIndex):e}function Sl(i,e,t){let r=Cn(i.state.facet(Zn).map(n=>n(i)),t.from,e.head>t.from?-1:1);return r==t.from?t:G.cursor(r,r<t.from?1:-1)}class ci{constructor(e,t){this.pos=e,this.assoc=t}}function Da(i,e,t,r){let n=i.contentDOM.getBoundingClientRect(),s=n.top+i.viewState.paddingTop,{x:l,y:o}=e,a=o-s,c;for(;;){if(a<0)return new ci(0,1);if(a>i.viewState.docHeight)return new ci(i.state.doc.length,-1);if(c=i.elementAtHeight(a),r==null)break;if(c.type==Ct.Text){if(r<0?c.to<i.viewport.from:c.from>i.viewport.to)break;let f=i.docView.coordsAt(r<0?c.from:c.to,r);if(f&&(r<0?f.top<=a+s:f.bottom>=a+s))break}let u=i.viewState.heightOracle.textHeight/2;a=r>0?c.bottom+u:c.top-u}if(i.viewport.from>=c.to||i.viewport.to<=c.from){if(t)return null;if(c.type==Ct.Text){let u=Ok(i,n,c,l,o);return new ci(u,u==c.from?1:-1)}}if(c.type!=Ct.Text)return a<(c.top+c.bottom)/2?new ci(c.from,1):new ci(c.to,-1);let h=i.docView.lineAt(c.from,2);return(!h||h.length!=c.length)&&(h=i.docView.lineAt(c.from,-2)),qm(i,h,c.from,l,o)}function qm(i,e,t,r,n){let s=-1,l=null,o=1e9,a=1e9,c=n,h=n,u=(f,d)=>{for(let y=0;y<f.length;y++){let _=f[y];if(_.top==_.bottom)continue;let m=_.left>r?_.left-r:_.right<r?r-_.right:0,p=_.top>n?_.top-n:_.bottom<n?n-_.bottom:0;_.top<=h&&_.bottom>=c&&(c=Math.min(_.top,c),h=Math.max(_.bottom,h),p=0),(s<0||(p-a||m-o)<0)&&(s>=0&&a&&o<m&&l.top<=h-2&&l.bottom>=c+2?a=0:(s=d,o=m,a=p,l=_))}};if(e.isText()){for(let d=0;d<e.length;){let y=Ge(e.text,d);if(u(Pn(e.dom,d,y).getClientRects(),d),!o&&!a)break;d=y}return r>(l.left+l.right)/2==(Qu(i,s+t)==He.LTR)?new ci(t+Ge(e.text,s),-1):new ci(t+s,1)}else{if(!e.length)return new ci(t,1);for(let _=0;_<e.children.length;_++){let m=e.children[_];if(m.flags&48)continue;let p=(m.dom.nodeType==1?m.dom:Pn(m.dom,0,m.length)).getClientRects();if(u(p,_),!o&&!a)break}let f=e.children[s],d=e.posBefore(f,t);return f.isComposite()||f.isText()?qm(i,f,d,Math.max(l.left,Math.min(l.right,r)),n):r>(l.left+l.right)/2==(Qu(i,s+t)==He.LTR)?new ci(d+f.length,-1):new ci(d,1)}}function Qu(i,e){let t=i.state.doc.lineAt(e);return i.bidiSpans(t)[_i.find(i.bidiSpans(t),e-t.from,-1,1)].dir}const pn="￿";class jk{constructor(e,t){this.points=e,this.view=t,this.text="",this.lineSeparator=t.state.facet(ke.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=pn}readRange(e,t){if(!e)return this;let r=e.parentNode;for(let n=e;;){this.findPointBefore(r,n);let s=this.text.length;this.readNode(n);let l=Ve.get(n),o=n.nextSibling;if(o==t){l!=null&&l.breakAfter&&!o&&r!=this.view.contentDOM&&this.lineBreak();break}let a=Ve.get(o);(l&&a?l.breakAfter:(l?l.breakAfter:Zs(n))||Zs(o)&&(n.nodeName!="BR"||l!=null&&l.isWidget())&&this.text.length>s)&&!Wk(o,t)&&this.lineBreak(),n=o}return this.findPointBefore(r,t),this}readTextNode(e){let t=e.nodeValue;for(let r of this.points)r.node==e&&(r.pos=this.text.length+Math.min(r.offset,t.length));for(let r=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let s=-1,l=1,o;if(this.lineSeparator?(s=t.indexOf(this.lineSeparator,r),l=this.lineSeparator.length):(o=n.exec(t))&&(s=o.index,l=o[0].length),this.append(t.slice(r,s<0?t.length:s)),s<0)break;if(this.lineBreak(),l>1)for(let a of this.points)a.node==e&&a.pos>this.text.length&&(a.pos-=l-1);r=s+l}}readNode(e){let t=Ve.get(e),r=t&&t.overrideDOMText;if(r!=null){this.findPointInside(e,r.length);for(let n=r.iter();!n.next().done;)n.lineBreak?this.lineBreak():this.append(n.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let r of this.points)r.node==e&&e.childNodes[r.offset]==t&&(r.pos=this.text.length)}findPointInside(e,t){for(let r of this.points)(e.nodeType==3?r.node==e:e.contains(r.node))&&(r.pos=this.text.length+(zk(e,r.node,r.offset)?t:0))}}function zk(i,e,t){for(;;){if(!e||t<xi(e))return!1;if(e==i)return!0;t=Wi(e)+1,e=e.parentNode}}function Wk(i,e){let t;for(;!(i==e||!i);i=i.nextSibling){let r=Ve.get(i);if(!(r!=null&&r.isWidget()))return!1;r&&(t||(t=[])).push(r)}if(t)for(let r of t){let n=r.overrideDOMText;if(n!=null&&n.length)return!1}return!0}class Zu{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class $k{constructor(e,t,r,n){this.typeOver=n,this.bounds=null,this.text="",this.domChanged=t>-1;let{impreciseHead:s,impreciseAnchor:l}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=Km(e.docView.tile,t,r,0))){let o=s||l?[]:Uk(e),a=new jk(o,e);a.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=a.text,this.newSel=qk(o,this.bounds.from)}else{let o=e.observer.selectionRange,a=s&&s.node==o.focusNode&&s.offset==o.focusOffset||!Sa(e.contentDOM,o.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(o.focusNode,o.focusOffset),c=l&&l.node==o.anchorNode&&l.offset==o.anchorOffset||!Sa(e.contentDOM,o.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(o.anchorNode,o.anchorOffset),h=e.viewport;if((ne.ios||ne.chrome)&&e.state.selection.main.empty&&a!=c&&(h.from>0||h.to<e.state.doc.length)){let u=Math.min(a,c),f=Math.max(a,c),d=h.from-u,y=h.to-f;(d==0||d==1||u==0)&&(y==0||y==-1||f==e.state.doc.length)&&(a=0,c=e.state.doc.length)}e.inputState.composing>-1&&e.state.selection.ranges.length>1?this.newSel=e.state.selection.replaceRange(G.range(c,a)):this.newSel=G.single(c,a)}}}function Km(i,e,t,r){if(i.isComposite()){let n=-1,s=-1,l=-1,o=-1;for(let a=0,c=r,h=r;a<i.children.length;a++){let u=i.children[a],f=c+u.length;if(c<e&&f>t)return Km(u,e,t,c);if(f>=e&&n==-1&&(n=a,s=c),c>t&&u.dom.parentNode==i.dom){l=a,o=h;break}h=f,c=f+u.breakAfter}return{from:s,to:o<0?r+i.length:o,startDOM:(n?i.children[n-1].dom.nextSibling:null)||i.dom.firstChild,endDOM:l<i.children.length&&l>=0?i.children[l].dom:null}}else return i.isText()?{from:r,to:r+i.length,startDOM:i.dom,endDOM:i.dom.nextSibling}:null}function Gm(i,e){let t,{newSel:r}=e,n=i.state.selection.main,s=i.inputState.lastKeyTime>Date.now()-100?i.inputState.lastKeyCode:-1;if(e.bounds){let{from:l,to:o}=e.bounds,a=n.from,c=null;(s===8||ne.android&&e.text.length<o-l)&&(a=n.to,c="end");let h=Xm(i.state.doc.sliceString(l,o,pn),e.text,a-l,c);h&&(ne.chrome&&s==13&&h.toB==h.from+2&&e.text.slice(h.from,h.toB)==pn+pn&&h.toB--,t={from:l+h.from,to:l+h.toA,insert:Ee.of(e.text.slice(h.from,h.toB).split(pn))})}else r&&(!i.hasFocus&&i.state.facet(vi)||no(r,n))&&(r=null);if(!t&&!r)return!1;if(!t&&e.typeOver&&!n.empty&&r&&r.main.empty?t={from:n.from,to:n.to,insert:i.state.doc.slice(n.from,n.to)}:(ne.mac||ne.android)&&t&&t.from==t.to&&t.from==n.head-1&&/^\. ?$/.test(t.insert.toString())&&i.contentDOM.getAttribute("autocorrect")=="off"?(r&&t.insert.length==2&&(r=G.single(r.main.anchor-1,r.main.head-1)),t={from:t.from,to:t.to,insert:Ee.of([t.insert.toString().replace("."," ")])}):t&&t.from>=n.from&&t.to<=n.to&&(t.from!=n.from||t.to!=n.to)&&n.to-n.from-(t.to-t.from)<=4?t={from:n.from,to:n.to,insert:i.state.doc.slice(n.from,t.from).append(t.insert).append(i.state.doc.slice(t.to,n.to))}:i.state.doc.lineAt(n.from).to<n.to&&i.docView.lineHasWidget(n.to)&&i.inputState.insertingTextAt>Date.now()-50?t={from:n.from,to:n.to,insert:i.state.toText(i.inputState.insertingText)}:ne.chrome&&t&&t.from==t.to&&t.from==n.head&&t.insert.toString()==`
 `&&i.lineWrapping&&(r&&(r=G.single(r.main.anchor-1,r.main.head-1)),t={from:n.from,to:n.to,insert:Ee.of([" "])}),t)return Ic(i,t,r,s);if(r&&!no(r,n)){let l=!1,o="select";return i.inputState.lastSelectionTime>Date.now()-50&&(i.inputState.lastSelectionOrigin=="select"&&(l=!0),o=i.inputState.lastSelectionOrigin,o=="select.pointer"&&(r=Um(i.state.facet(Zn).map(a=>a(i)),r))),i.dispatch({selection:r,scrollIntoView:l,userEvent:o}),!0}else return!1}function Ic(i,e,t,r=-1){if(ne.ios&&i.inputState.flushIOSKey(e))return!0;let n=i.state.selection.main;if(ne.android&&(e.to==n.to&&(e.from==n.from||e.from==n.from-1&&i.state.sliceDoc(e.from,n.from)==" ")&&e.insert.length==1&&e.insert.lines==2&&Br(i.contentDOM,"Enter",13)||(e.from==n.from-1&&e.to==n.to&&e.insert.length==0||r==8&&e.insert.length<e.to-e.from&&e.to>n.head)&&Br(i.contentDOM,"Backspace",8)||e.from==n.from&&e.to==n.to+1&&e.insert.length==0&&Br(i.contentDOM,"Delete",46)))return!0;let s=e.insert.toString();i.inputState.composing>=0&&i.inputState.composing++;let l,o=()=>l||(l=Vk(i,e,t));return i.state.facet(Bm).some(a=>a(i,e.from,e.to,s,o))||i.dispatch(o()),!0}function Vk(i,e,t){let r,n=i.state,s=n.selection.main,l=-1;if(e.from==e.to&&e.from<s.from||e.from>s.to){let a=e.from<s.from?-1:1,c=a<0?s.from:s.to,h=Cn(n.facet(Zn).map(u=>u(i)),c,a);e.from==h&&(l=h)}if(l>-1)r={changes:e,selection:G.cursor(e.from+e.insert.length,-1)};else if(e.from>=s.from&&e.to<=s.to&&e.to-e.from>=(s.to-s.from)/3&&(!t||t.main.empty&&t.main.from==e.from+e.insert.length)&&i.inputState.composing<0){let a=s.from<e.from?n.sliceDoc(s.from,e.from):"",c=s.to>e.to?n.sliceDoc(e.to,s.to):"";r=n.replaceSelection(i.state.toText(a+e.insert.sliceString(0,void 0,i.state.lineBreak)+c))}else{let a=n.changes(e),c=t&&t.main.to<=a.newLength?t.main:void 0;if(n.selection.ranges.length>1&&(i.inputState.composing>=0||i.inputState.compositionPendingChange)&&e.to<=s.to+10&&e.to>=s.to-10){let h=i.state.sliceDoc(e.from,e.to),u,f=t&&Vm(i,t.main.head);if(f){let y=e.insert.length-(e.to-e.from);u={from:f.from,to:f.to-y}}else u=i.state.doc.lineAt(s.head);let d=s.to-e.to;r=n.changeByRange(y=>{if(y.from==s.from&&y.to==s.to)return{changes:a,range:c||y.map(a)};let _=y.to-d,m=_-h.length;if(i.state.sliceDoc(m,_)!=h||_>=u.from&&m<=u.to)return{range:y};let p=n.changes({from:m,to:_,insert:e.insert}),g=y.to-s.to;return{changes:p,range:c?G.range(Math.max(0,c.anchor+g),Math.max(0,c.head+g)):y.map(p)}})}else r={changes:a,selection:c&&n.selection.replaceRange(c)}}let o="input.type";return(i.composing||i.inputState.compositionPendingChange&&i.inputState.compositionEndedAt>Date.now()-50)&&(i.inputState.compositionPendingChange=!1,o+=".compose",i.inputState.compositionFirstChange&&(o+=".start",i.inputState.compositionFirstChange=!1)),n.update(r,{userEvent:o,scrollIntoView:!0})}function Xm(i,e,t,r){let n=Math.min(i.length,e.length),s=0;for(;s<n&&i.charCodeAt(s)==e.charCodeAt(s);)s++;if(s==n&&i.length==e.length)return null;let l=i.length,o=e.length;for(;l>0&&o>0&&i.charCodeAt(l-1)==e.charCodeAt(o-1);)l--,o--;if(r=="end"){let a=Math.max(0,s-Math.min(l,o));t-=l+a-s}if(l<s&&i.length<e.length){let a=t<=s&&t>=l?s-t:0;s-=a,o=s+(o-l),l=s}else if(o<s){let a=t<=s&&t>=o?s-t:0;s-=a,l=s+(l-o),o=s}return{from:s,toA:l,toB:o}}function Uk(i){let e=[];if(i.root.activeElement!=i.contentDOM)return e;let{anchorNode:t,anchorOffset:r,focusNode:n,focusOffset:s}=i.observer.selectionRange;return t&&(e.push(new Zu(t,r)),(n!=t||s!=r)&&e.push(new Zu(n,s))),e}function qk(i,e){if(i.length==0)return null;let t=i[0].pos,r=i.length==2?i[1].pos:t;return t>-1&&r>-1?G.single(t+e,r+e):null}function no(i,e){return e.head==i.main.head&&e.anchor==i.main.anchor}class Kk{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.insertingText="",this.insertingTextAt=0,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,ne.safari&&e.contentDOM.addEventListener("input",()=>null),ne.gecko&&a2(e.contentDOM.ownerDocument)}handleEvent(e){!t2(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||(this.view.updateState!=0?Promise.resolve().then(()=>this.runHandlers(e.type,e)):this.runHandlers(e.type,e))}runHandlers(e,t){let r=this.handlers[e];if(r){for(let n of r.observers)n(this.view,t);for(let n of r.handlers){if(t.defaultPrevented)break;if(n(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=Gk(e),r=this.handlers,n=this.view.contentDOM;for(let s in t)if(s!="scroll"){let l=!t[s].handlers.length,o=r[s];o&&l!=!o.handlers.length&&(n.removeEventListener(s,this.handleEvent),o=null),o||n.addEventListener(s,this.handleEvent,{passive:l})}for(let s in r)s!="scroll"&&!t[s]&&n.removeEventListener(s,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&e.keyCode!=27&&Ym.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),ne.android&&ne.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return ne.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((t=Jm.find(r=>r.keyCode==e.keyCode))&&!e.ctrlKey||Xk.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=t||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(e){let t=this.pendingIOSKey;return!t||t.key=="Enter"&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString())?!1:(this.pendingIOSKey=void 0,Br(this.view.contentDOM,t.key,t.keyCode,t instanceof KeyboardEvent?t:void 0))}ignoreDuringComposition(e){return!/^key/.test(e.type)||e.synthetic?!1:this.composing>0?!0:ne.safari&&!ne.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function ef(i,e){return(t,r)=>{try{return e.call(i,r,t)}catch(n){St(t.state,n)}}}function Gk(i){let e=Object.create(null);function t(r){return e[r]||(e[r]={observers:[],handlers:[]})}for(let r of i){let n=r.spec,s=n&&n.plugin.domEventHandlers,l=n&&n.plugin.domEventObservers;if(s)for(let o in s){let a=s[o];a&&t(o).handlers.push(ef(r.value,a))}if(l)for(let o in l){let a=l[o];a&&t(o).observers.push(ef(r.value,a))}}for(let r in Jt)t(r).handlers.push(Jt[r]);for(let r in Wt)t(r).observers.push(Wt[r]);return e}const Jm=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Xk="dthko",Ym=[16,17,18,20,91,92,224,225],gs=6;function vs(i){return Math.max(0,i)*.7+8}function Jk(i,e){return Math.max(Math.abs(i.clientX-e.clientX),Math.abs(i.clientY-e.clientY))}class Yk{constructor(e,t,r,n){this.view=e,this.startEvent=t,this.style=r,this.mustSelect=n,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParents=QC(e.contentDOM),this.atoms=e.state.facet(Zn).map(l=>l(e));let s=e.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(ke.allowMultipleSelections)&&Qk(e,t),this.dragging=e2(e,t)&&eg(t)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&Jk(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let t=0,r=0,n=0,s=0,l=this.view.win.innerWidth,o=this.view.win.innerHeight;this.scrollParents.x&&({left:n,right:l}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:s,bottom:o}=this.scrollParents.y.getBoundingClientRect());let a=Oc(this.view);e.clientX-a.left<=n+gs?t=-vs(n-e.clientX):e.clientX+a.right>=l-gs&&(t=vs(e.clientX-l)),e.clientY-a.top<=s+gs?r=-vs(s-e.clientY):e.clientY+a.bottom>=o-gs&&(r=vs(e.clientY-o)),this.setScrollSpeed(t,r)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:t}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),t&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=t,t=0),(e||t)&&this.view.win.scrollBy(e,t),this.dragging===!1&&this.select(this.lastEvent)}select(e){let{view:t}=this,r=Um(this.atoms,this.style.get(e,this.extend,this.multiple));(this.mustSelect||!r.eq(t.state.selection,this.dragging===!1))&&this.view.dispatch({selection:r,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(t=>t.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function Qk(i,e){let t=i.state.facet(Mm);return t.length?t[0](e):ne.mac?e.metaKey:e.ctrlKey}function Zk(i,e){let t=i.state.facet(Tm);return t.length?t[0](e):ne.mac?!e.altKey:!e.ctrlKey}function e2(i,e){let{main:t}=i.state.selection;if(t.empty)return!1;let r=Wr(i.root);if(!r||r.rangeCount==0)return!0;let n=r.getRangeAt(0).getClientRects();for(let s=0;s<n.length;s++){let l=n[s];if(l.left<=e.clientX&&l.right>=e.clientX&&l.top<=e.clientY&&l.bottom>=e.clientY)return!0}return!1}function t2(i,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,r;t!=i.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(r=Ve.get(t))&&r.isWidget()&&!r.isHidden&&r.widget.ignoreEvent(e))return!1;return!0}const Jt=Object.create(null),Wt=Object.create(null),Qm=ne.ie&&ne.ie_version<15||ne.ios&&ne.webkit_version<604;function i2(i){let e=i.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{i.focus(),t.remove(),Zm(i,t.value)},50)}function Bo(i,e,t){for(let r of i.facet(e))t=r(t,i);return t}function Zm(i,e){e=Bo(i.state,Tc,e);let{state:t}=i,r,n=1,s=t.toText(e),l=s.lines==t.selection.ranges.length;if(La!=null&&t.selection.ranges.every(a=>a.empty)&&La==s.toString()){let a=-1;r=t.changeByRange(c=>{let h=t.doc.lineAt(c.from);if(h.from==a)return{range:c};a=h.from;let u=t.toText((l?s.line(n++).text:e)+t.lineBreak);return{changes:{from:h.from,insert:u},range:G.cursor(c.from+u.length)}})}else l?r=t.changeByRange(a=>{let c=s.line(n++);return{changes:{from:a.from,to:a.to,insert:c.text},range:G.cursor(a.from+c.length)}}):r=t.replaceSelection(s);i.dispatch(r,{userEvent:"input.paste",scrollIntoView:!0})}Wt.scroll=i=>{i.inputState.lastScrollTop=i.scrollDOM.scrollTop,i.inputState.lastScrollLeft=i.scrollDOM.scrollLeft};Jt.keydown=(i,e)=>(i.inputState.setSelectionOrigin("select"),e.keyCode==27&&i.inputState.tabFocusMode!=0&&(i.inputState.tabFocusMode=Date.now()+2e3),!1);Wt.touchstart=(i,e)=>{i.inputState.lastTouchTime=Date.now(),i.inputState.setSelectionOrigin("select.pointer")};Wt.touchmove=i=>{i.inputState.setSelectionOrigin("select.pointer")};Jt.mousedown=(i,e)=>{if(i.observer.flush(),i.inputState.lastTouchTime>Date.now()-2e3)return!1;let t=null;for(let r of i.state.facet(Rm))if(t=r(i,e),t)break;if(!t&&e.button==0&&(t=n2(i,e)),t){let r=!i.hasFocus;i.inputState.startMouseSelection(new Yk(i,e,t,r)),r&&i.observer.ignore(()=>{xm(i.contentDOM);let s=i.root.activeElement;s&&!s.contains(i.contentDOM)&&s.blur()});let n=i.inputState.mouseSelection;if(n)return n.start(e),n.dragging===!1}else i.inputState.setSelectionOrigin("select.pointer");return!1};function tf(i,e,t,r){if(r==1)return G.cursor(e,t);if(r==2)return Bk(i.state,e,t);{let n=i.docView.lineAt(e,t),s=i.state.doc.lineAt(n?n.posAtEnd:e),l=n?n.posAtStart:s.from,o=n?n.posAtEnd:s.to;return o<i.state.doc.length&&o==s.to&&o++,G.range(l,o)}}const r2=ne.ie&&ne.ie_version<=11;let rf=null,nf=0,sf=0;function eg(i){if(!r2)return i.detail;let e=rf,t=sf;return rf=i,sf=Date.now(),nf=!e||t>Date.now()-400&&Math.abs(e.clientX-i.clientX)<2&&Math.abs(e.clientY-i.clientY)<2?(nf+1)%3:1}function n2(i,e){let t=i.posAndSideAtCoords({x:e.clientX,y:e.clientY},!1),r=eg(e),n=i.state.selection;return{update(s){s.docChanged&&(t.pos=s.changes.mapPos(t.pos),n=n.map(s.changes))},get(s,l,o){let a=i.posAndSideAtCoords({x:s.clientX,y:s.clientY},!1),c,h=tf(i,a.pos,a.assoc,r);if(t.pos!=a.pos&&!l){let u=tf(i,t.pos,t.assoc,r),f=Math.min(u.from,h.from),d=Math.max(u.to,h.to);h=f<h.from?G.range(f,d):G.range(d,f)}return l?n.replaceRange(n.main.extend(h.from,h.to)):o&&r==1&&n.ranges.length>1&&(c=s2(n,a.pos))?c:o?n.addRange(h):G.create([h])}}}function s2(i,e){for(let t=0;t<i.ranges.length;t++){let{from:r,to:n}=i.ranges[t];if(r<=e&&n>=e)return G.create(i.ranges.slice(0,t).concat(i.ranges.slice(t+1)),i.mainIndex==t?0:i.mainIndex-(i.mainIndex>t?1:0))}return null}Jt.dragstart=(i,e)=>{let{selection:{main:t}}=i.state;if(e.target.draggable){let n=i.docView.tile.nearest(e.target);if(n&&n.isWidget()){let s=n.posAtStart,l=s+n.length;(s>=t.to||l<=t.from)&&(t=G.range(s,l))}}let{inputState:r}=i;return r.mouseSelection&&(r.mouseSelection.dragging=!0),r.draggedContent=t,e.dataTransfer&&(e.dataTransfer.setData("Text",Bo(i.state,Rc,i.state.sliceDoc(t.from,t.to))),e.dataTransfer.effectAllowed="copyMove"),!1};Jt.dragend=i=>(i.inputState.draggedContent=null,!1);function of(i,e,t,r){if(t=Bo(i.state,Tc,t),!t)return;let n=i.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:s}=i.inputState,l=r&&s&&Zk(i,e)?{from:s.from,to:s.to}:null,o={from:n,insert:t},a=i.state.changes(l?[l,o]:o);i.focus(),i.dispatch({changes:a,selection:{anchor:a.mapPos(n,-1),head:a.mapPos(n,1)},userEvent:l?"move.drop":"input.drop"}),i.inputState.draggedContent=null}Jt.drop=(i,e)=>{if(!e.dataTransfer)return!1;if(i.state.readOnly)return!0;let t=e.dataTransfer.files;if(t&&t.length){let r=Array(t.length),n=0,s=()=>{++n==t.length&&of(i,e,r.filter(l=>l!=null).join(i.state.lineBreak),!1)};for(let l=0;l<t.length;l++){let o=new FileReader;o.onerror=s,o.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(o.result)||(r[l]=o.result),s()},o.readAsText(t[l])}return!0}else{let r=e.dataTransfer.getData("Text");if(r)return of(i,e,r,!0),!0}return!1};Jt.paste=(i,e)=>{if(i.state.readOnly)return!0;i.observer.flush();let t=Qm?null:e.clipboardData;return t?(Zm(i,t.getData("text/plain")||t.getData("text/uri-list")),!0):(i2(i),!1)};function o2(i,e){let t=i.dom.parentNode;if(!t)return;let r=t.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px",r.value=e,r.focus(),r.selectionEnd=e.length,r.selectionStart=0,setTimeout(()=>{r.remove(),i.focus()},50)}function l2(i){let e=[],t=[],r=!1;for(let n of i.selection.ranges)n.empty||(e.push(i.sliceDoc(n.from,n.to)),t.push(n));if(!e.length){let n=-1;for(let{from:s}of i.selection.ranges){let l=i.doc.lineAt(s);l.number>n&&(e.push(l.text),t.push({from:l.from,to:Math.min(i.doc.length,l.to+1)})),n=l.number}r=!0}return{text:Bo(i,Rc,e.join(i.lineBreak)),ranges:t,linewise:r}}let La=null;Jt.copy=Jt.cut=(i,e)=>{let t=Wr(i.root);if(t&&!Sn(i.contentDOM,t))return!1;let{text:r,ranges:n,linewise:s}=l2(i.state);if(!r&&!s)return!1;La=s?r:null,e.type=="cut"&&!i.state.readOnly&&i.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"});let l=Qm?null:e.clipboardData;return l?(l.clearData(),l.setData("text/plain",r),!0):(o2(i,r),!1)};const tg=Ci.define();function ig(i,e){let t=[];for(let r of i.facet(Om)){let n=r(i,e);n&&t.push(n)}return t.length?i.update({effects:t,annotations:tg.of(!0)}):null}function rg(i){setTimeout(()=>{let e=i.hasFocus;if(e!=i.inputState.notifiedFocused){let t=ig(i.state,e);t?i.dispatch(t):i.update([])}},10)}Wt.focus=i=>{i.inputState.lastFocusTime=Date.now(),!i.scrollDOM.scrollTop&&(i.inputState.lastScrollTop||i.inputState.lastScrollLeft)&&(i.scrollDOM.scrollTop=i.inputState.lastScrollTop,i.scrollDOM.scrollLeft=i.inputState.lastScrollLeft),rg(i)};Wt.blur=i=>{i.observer.clearSelectionRange(),rg(i)};Wt.compositionstart=Wt.compositionupdate=i=>{i.observer.editContext||(i.inputState.compositionFirstChange==null&&(i.inputState.compositionFirstChange=!0),i.inputState.composing<0&&(i.inputState.composing=0))};Wt.compositionend=i=>{i.observer.editContext||(i.inputState.composing=-1,i.inputState.compositionEndedAt=Date.now(),i.inputState.compositionPendingKey=!0,i.inputState.compositionPendingChange=i.observer.pendingRecords().length>0,i.inputState.compositionFirstChange=null,ne.chrome&&ne.android?i.observer.flushSoon():i.inputState.compositionPendingChange?Promise.resolve().then(()=>i.observer.flush()):setTimeout(()=>{i.inputState.composing<0&&i.docView.hasComposition&&i.update([])},50))};Wt.contextmenu=i=>{i.inputState.lastContextMenu=Date.now()};Jt.beforeinput=(i,e)=>{var t,r;if((e.inputType=="insertText"||e.inputType=="insertCompositionText")&&(i.inputState.insertingText=e.data,i.inputState.insertingTextAt=Date.now()),e.inputType=="insertReplacementText"&&i.observer.editContext){let s=(t=e.dataTransfer)===null||t===void 0?void 0:t.getData("text/plain"),l=e.getTargetRanges();if(s&&l.length){let o=l[0],a=i.posAtDOM(o.startContainer,o.startOffset),c=i.posAtDOM(o.endContainer,o.endOffset);return Ic(i,{from:a,to:c,insert:i.state.toText(s)},null),!0}}let n;if(ne.chrome&&ne.android&&(n=Jm.find(s=>s.inputType==e.inputType))&&(i.observer.delayAndroidKey(n.key,n.keyCode),n.key=="Backspace"||n.key=="Delete")){let s=((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0;setTimeout(()=>{var l;(((l=window.visualViewport)===null||l===void 0?void 0:l.height)||0)>s+10&&i.hasFocus&&(i.contentDOM.blur(),i.focus())},100)}return ne.ios&&e.inputType=="deleteContentForward"&&i.observer.flushSoon(),ne.safari&&e.inputType=="insertText"&&i.inputState.composing>=0&&setTimeout(()=>Wt.compositionend(i,e),20),!1};const lf=new Set;function a2(i){lf.has(i)||(lf.add(i),i.addEventListener("copy",()=>{}),i.addEventListener("cut",()=>{}))}const af=["pre-wrap","normal","pre-line","break-spaces"];let Ur=!1;function cf(){Ur=!1}class c2{constructor(e){this.lineWrapping=e,this.doc=Ee.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,t){let r=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(r+=Math.max(0,Math.ceil((t-e-r*this.lineLength*.5)/this.lineLength))),this.lineHeight*r}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/Math.max(1,this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return af.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let r=0;r<e.length;r++){let n=e[r];n<0?r++:this.heightSamples[Math.floor(n*10)]||(t=!0,this.heightSamples[Math.floor(n*10)]=!0)}return t}refresh(e,t,r,n,s,l){let o=af.indexOf(e)>-1,a=Math.abs(t-this.lineHeight)>.3||this.lineWrapping!=o||Math.abs(r-this.charWidth)>.1;if(this.lineWrapping=o,this.lineHeight=t,this.charWidth=r,this.textHeight=n,this.lineLength=s,a){this.heightSamples={};for(let c=0;c<l.length;c++){let h=l[c];h<0?c++:this.heightSamples[Math.floor(h*10)]=!0}}return a}}class h2{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class Ut{constructor(e,t,r,n,s){this.from=e,this.length=t,this.top=r,this.height=n,this._content=s}get type(){return typeof this._content=="number"?Ct.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof fr?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new Ut(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var Ne=(function(i){return i[i.ByPos=0]="ByPos",i[i.ByHeight=1]="ByHeight",i[i.ByPosNoHeight=2]="ByPosNoHeight",i})(Ne||(Ne={}));const Ws=.001;class vt{constructor(e,t,r=2){this.length=e,this.height=t,this.flags=r}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>Ws&&(Ur=!0),this.height=e)}replace(e,t,r){return vt.of(r)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,r,n){let s=this,l=r.doc;for(let o=n.length-1;o>=0;o--){let{fromA:a,toA:c,fromB:h,toB:u}=n[o],f=s.lineAt(a,Ne.ByPosNoHeight,r.setDoc(t),0,0),d=f.to>=c?f:s.lineAt(c,Ne.ByPosNoHeight,r,0,0);for(u+=d.to-c,c=d.to;o>0&&f.from<=n[o-1].toA;)a=n[o-1].fromA,h=n[o-1].fromB,o--,a<f.from&&(f=s.lineAt(a,Ne.ByPosNoHeight,r,0,0));h+=f.from-a,a=f.from;let y=Nc.build(r.setDoc(l),e,h,u);s=so(s,s.replace(a,c,y))}return s.updateHeight(r,0)}static empty(){return new Mt(0,0,0)}static of(e){if(e.length==1)return e[0];let t=0,r=e.length,n=0,s=0;for(;;)if(t==r)if(n>s*2){let o=e[t-1];o.break?e.splice(--t,1,o.left,null,o.right):e.splice(--t,1,o.left,o.right),r+=1+o.break,n-=o.size}else if(s>n*2){let o=e[r];o.break?e.splice(r,1,o.left,null,o.right):e.splice(r,1,o.left,o.right),r+=2+o.break,s-=o.size}else break;else if(n<s){let o=e[t++];o&&(n+=o.size)}else{let o=e[--r];o&&(s+=o.size)}let l=0;return e[t-1]==null?(l=1,t--):e[t]==null&&(l=1,r++),new f2(vt.of(e.slice(0,t)),l,vt.of(e.slice(r)))}}function so(i,e){return i==e?i:(i.constructor!=e.constructor&&(Ur=!0),e)}vt.prototype.size=1;const u2=he.replace({});class ng extends vt{constructor(e,t,r){super(e,t),this.deco=r,this.spaceAbove=0}mainBlock(e,t){return new Ut(t,this.length,e+this.spaceAbove,this.height-this.spaceAbove,this.deco||0)}blockAt(e,t,r,n){return this.spaceAbove&&e<r+this.spaceAbove?new Ut(n,0,r,this.spaceAbove,u2):this.mainBlock(r,n)}lineAt(e,t,r,n,s){let l=this.mainBlock(n,s);return this.spaceAbove?this.blockAt(0,r,n,s).join(l):l}forEachLine(e,t,r,n,s,l){e<=s+this.length&&t>=s&&l(this.lineAt(0,Ne.ByPos,r,n,s))}setMeasuredHeight(e){let t=e.heights[e.index++];t<0?(this.spaceAbove=-t,t=e.heights[e.index++]):this.spaceAbove=0,this.setHeight(t)}updateHeight(e,t=0,r=!1,n){return n&&n.from<=t&&n.more&&this.setMeasuredHeight(n),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Mt extends ng{constructor(e,t,r){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0,this.spaceAbove=r}mainBlock(e,t){return new Ut(t,this.length,e+this.spaceAbove,this.height-this.spaceAbove,this.breaks)}replace(e,t,r){let n=r[0];return r.length==1&&(n instanceof Mt||n instanceof Ye&&n.flags&4)&&Math.abs(this.length-n.length)<10?(n instanceof Ye?n=new Mt(n.length,this.height,this.spaceAbove):n.height=this.height,this.outdated||(n.outdated=!1),n):vt.of(r)}updateHeight(e,t=0,r=!1,n){return n&&n.from<=t&&n.more?this.setMeasuredHeight(n):(r||this.outdated)&&(this.spaceAbove=0,this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight)),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class Ye extends vt{constructor(e){super(e,0)}heightMetrics(e,t){let r=e.doc.lineAt(t).number,n=e.doc.lineAt(t+this.length).number,s=n-r+1,l,o=0;if(e.lineWrapping){let a=Math.min(this.height,e.lineHeight*s);l=a/s,this.length>s+1&&(o=(this.height-a)/(this.length-s-1))}else l=this.height/s;return{firstLine:r,lastLine:n,perLine:l,perChar:o}}blockAt(e,t,r,n){let{firstLine:s,lastLine:l,perLine:o,perChar:a}=this.heightMetrics(t,n);if(t.lineWrapping){let c=n+(e<t.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-r)/this.height))*this.length)),h=t.doc.lineAt(c),u=o+h.length*a,f=Math.max(r,e-u/2);return new Ut(h.from,h.length,f,u,0)}else{let c=Math.max(0,Math.min(l-s,Math.floor((e-r)/o))),{from:h,length:u}=t.doc.line(s+c);return new Ut(h,u,r+o*c,o,0)}}lineAt(e,t,r,n,s){if(t==Ne.ByHeight)return this.blockAt(e,r,n,s);if(t==Ne.ByPosNoHeight){let{from:d,to:y}=r.doc.lineAt(e);return new Ut(d,y-d,0,0,0)}let{firstLine:l,perLine:o,perChar:a}=this.heightMetrics(r,s),c=r.doc.lineAt(e),h=o+c.length*a,u=c.number-l,f=n+o*u+a*(c.from-s-u);return new Ut(c.from,c.length,Math.max(n,Math.min(f,n+this.height-h)),h,0)}forEachLine(e,t,r,n,s,l){e=Math.max(e,s),t=Math.min(t,s+this.length);let{firstLine:o,perLine:a,perChar:c}=this.heightMetrics(r,s);for(let h=e,u=n;h<=t;){let f=r.doc.lineAt(h);if(h==e){let y=f.number-o;u+=a*y+c*(e-s-y)}let d=a+c*f.length;l(new Ut(f.from,f.length,u,d,0)),u+=d,h=f.to+1}}replace(e,t,r){let n=this.length-t;if(n>0){let s=r[r.length-1];s instanceof Ye?r[r.length-1]=new Ye(s.length+n):r.push(null,new Ye(n-1))}if(e>0){let s=r[0];s instanceof Ye?r[0]=new Ye(e+s.length):r.unshift(new Ye(e-1),null)}return vt.of(r)}decomposeLeft(e,t){t.push(new Ye(e-1),null)}decomposeRight(e,t){t.push(null,new Ye(this.length-e-1))}updateHeight(e,t=0,r=!1,n){let s=t+this.length;if(n&&n.from<=t+this.length&&n.more){let l=[],o=Math.max(t,n.from),a=-1;for(n.from>t&&l.push(new Ye(n.from-t-1).updateHeight(e,t));o<=s&&n.more;){let h=e.doc.lineAt(o).length;l.length&&l.push(null);let u=n.heights[n.index++],f=0;u<0&&(f=-u,u=n.heights[n.index++]),a==-1?a=u:Math.abs(u-a)>=Ws&&(a=-2);let d=new Mt(h,u,f);d.outdated=!1,l.push(d),o+=h+1}o<=s&&l.push(null,new Ye(s-o).updateHeight(e,o));let c=vt.of(l);return(a<0||Math.abs(c.height-this.height)>=Ws||Math.abs(a-this.heightMetrics(e,t).perLine)>=Ws)&&(Ur=!0),so(this,c)}else(r||this.outdated)&&(this.setHeight(e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class f2 extends vt{constructor(e,t,r){super(e.length+t+r.length,e.height+r.height,t|(e.outdated||r.outdated?2:0)),this.left=e,this.right=r,this.size=e.size+r.size}get break(){return this.flags&1}blockAt(e,t,r,n){let s=r+this.left.height;return e<s?this.left.blockAt(e,t,r,n):this.right.blockAt(e,t,s,n+this.left.length+this.break)}lineAt(e,t,r,n,s){let l=n+this.left.height,o=s+this.left.length+this.break,a=t==Ne.ByHeight?e<l:e<o,c=a?this.left.lineAt(e,t,r,n,s):this.right.lineAt(e,t,r,l,o);if(this.break||(a?c.to<o:c.from>o))return c;let h=t==Ne.ByPosNoHeight?Ne.ByPosNoHeight:Ne.ByPos;return a?c.join(this.right.lineAt(o,h,r,l,o)):this.left.lineAt(o,h,r,n,s).join(c)}forEachLine(e,t,r,n,s,l){let o=n+this.left.height,a=s+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,r,n,s,l),t>=a&&this.right.forEachLine(e,t,r,o,a,l);else{let c=this.lineAt(a,Ne.ByPos,r,n,s);e<c.from&&this.left.forEachLine(e,c.from-1,r,n,s,l),c.to>=e&&c.from<=t&&l(c),t>c.to&&this.right.forEachLine(c.to+1,t,r,o,a,l)}}replace(e,t,r){let n=this.left.length+this.break;if(t<n)return this.balanced(this.left.replace(e,t,r),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-n,t-n,r));let s=[];e>0&&this.decomposeLeft(e,s);let l=s.length;for(let o of r)s.push(o);if(e>0&&hf(s,l-1),t<this.length){let o=s.length;this.decomposeRight(t,s),hf(s,o)}return vt.of(s)}decomposeLeft(e,t){let r=this.left.length;if(e<=r)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(r++,e>=r&&t.push(null)),e>r&&this.right.decomposeLeft(e-r,t)}decomposeRight(e,t){let r=this.left.length,n=r+this.break;if(e>=n)return this.right.decomposeRight(e-n,t);e<r&&this.left.decomposeRight(e,t),this.break&&e<n&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?vt.of(this.break?[e,null,t]:[e,t]):(this.left=so(this.left,e),this.right=so(this.right,t),this.setHeight(e.height+t.height),this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,r=!1,n){let{left:s,right:l}=this,o=t+s.length+this.break,a=null;return n&&n.from<=t+s.length&&n.more?a=s=s.updateHeight(e,t,r,n):s.updateHeight(e,t,r),n&&n.from<=o+l.length&&n.more?a=l=l.updateHeight(e,o,r,n):l.updateHeight(e,o,r),a?this.balanced(s,l):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function hf(i,e){let t,r;i[e]==null&&(t=i[e-1])instanceof Ye&&(r=i[e+1])instanceof Ye&&i.splice(e-1,3,new Ye(t.length+1+r.length))}const d2=5;class Nc{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let r=Math.min(t,this.lineEnd),n=this.nodes[this.nodes.length-1];n instanceof Mt?n.length+=r-this.pos:(r>this.pos||!this.isCovered)&&this.nodes.push(new Mt(r-this.pos,-1,0)),this.writtenTo=r,t>r&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,r){if(e<t||r.heightRelevant){let n=r.widget?r.widget.estimatedHeight:0,s=r.widget?r.widget.lineBreaks:0;n<0&&(n=this.oracle.lineHeight);let l=t-e;r.block?this.addBlock(new ng(l,n,r)):(l||s||n>=d2)&&this.addLineDeco(n,s,l)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new Mt(this.pos-e,-1,0)),this.writtenTo=this.pos}blankContent(e,t){let r=new Ye(t-e);return this.oracle.doc.lineAt(e).to==t&&(r.flags|=4),r}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof Mt)return e;let t=new Mt(0,-1,0);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,r){let n=this.ensureLine();n.length+=r,n.collapsed+=r,n.widgetHeight=Math.max(n.widgetHeight,e),n.breaks+=t,this.writtenTo=this.pos=this.pos+r}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof Mt)&&!this.isCovered?this.nodes.push(new Mt(0,-1,0)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let r=e;for(let n of this.nodes)n instanceof Mt&&n.updateHeight(this.oracle,r),r+=n?n.length:1;return this.nodes}static build(e,t,r,n){let s=new Nc(r,e);return ye.spans(t,r,n,s,0),s.finish(r)}}function p2(i,e,t){let r=new m2;return ye.compare(i,e,t,r,0),r.changes}class m2{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,r,n){(e<t||r&&r.heightRelevant||n&&n.heightRelevant)&&Pr(e,t,this.changes,5)}}function g2(i,e){let t=i.getBoundingClientRect(),r=i.ownerDocument,n=r.defaultView||window,s=Math.max(0,t.left),l=Math.min(n.innerWidth,t.right),o=Math.max(0,t.top),a=Math.min(n.innerHeight,t.bottom);for(let c=i.parentNode;c&&c!=r.body;)if(c.nodeType==1){let h=c,u=window.getComputedStyle(h);if((h.scrollHeight>h.clientHeight||h.scrollWidth>h.clientWidth)&&u.overflow!="visible"){let f=h.getBoundingClientRect();s=Math.max(s,f.left),l=Math.min(l,f.right),o=Math.max(o,f.top),a=Math.min(c==i.parentNode?n.innerHeight:a,f.bottom)}c=u.position=="absolute"||u.position=="fixed"?h.offsetParent:h.parentNode}else if(c.nodeType==11)c=c.host;else break;return{left:s-t.left,right:Math.max(s,l)-t.left,top:o-(t.top+e),bottom:Math.max(o,a)-(t.top+e)}}function v2(i){let e=i.getBoundingClientRect(),t=i.ownerDocument.defaultView||window;return e.left<t.innerWidth&&e.right>0&&e.top<t.innerHeight&&e.bottom>0}function _2(i,e){let t=i.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class wl{constructor(e,t,r,n){this.from=e,this.to=t,this.size=r,this.displaySize=n}static same(e,t){if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++){let n=e[r],s=t[r];if(n.from!=s.from||n.to!=s.to||n.size!=s.size)return!1}return!0}draw(e,t){return he.replace({widget:new y2(this.displaySize*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}}class y2 extends Ki{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class uf{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=ff,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=He.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(Pc).some(r=>typeof r!="function"&&r.class=="cm-lineWrapping");this.heightOracle=new c2(t),this.stateDeco=df(e),this.heightMap=vt.empty().applyChanges(this.stateDeco,Ee.empty,this.heightOracle.setDoc(e.doc),[new Ft(0,0,0,e.doc.length)]);for(let r=0;r<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());r++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=he.set(this.lineGaps.map(r=>r.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let r=0;r<=1;r++){let n=r?t.head:t.anchor;if(!e.some(({from:s,to:l})=>n>=s&&n<=l)){let{from:s,to:l}=this.lineBlockAt(n);e.push(new _s(s,l))}}return this.viewports=e.sort((r,n)=>r.from-n.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?ff:new Fc(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(mn(e,this.scaler))})}update(e,t=null){this.state=e.state;let r=this.stateDeco;this.stateDeco=df(this.state);let n=e.changedRanges,s=Ft.extendWithRanges(n,p2(r,this.stateDeco,e?e.changes:Ke.empty(this.state.doc.length))),l=this.heightMap.height,o=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);cf(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),s),(this.heightMap.height!=l||Ur)&&(e.flags|=2),o?(this.scrollAnchorPos=e.changes.mapPos(o.from,-1),this.scrollAnchorHeight=o.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=l);let a=s.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<a.from||t.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,t));let c=a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,e.flags|=this.updateForViewport(),(c||!e.changes.empty||e.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&(e.selectionSet||e.focusChanged)&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(uk)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,r=window.getComputedStyle(t),n=this.heightOracle,s=r.whiteSpace;this.defaultTextDirection=r.direction=="rtl"?He.RTL:He.LTR;let l=this.heightOracle.mustRefreshForWrapping(s)||this.mustMeasureContent,o=t.getBoundingClientRect(),a=l||this.mustMeasureContent||this.contentDOMHeight!=o.height;this.contentDOMHeight=o.height,this.mustMeasureContent=!1;let c=0,h=0;if(o.width&&o.height){let{scaleX:b,scaleY:S}=bm(t,o);(b>.005&&Math.abs(this.scaleX-b)>.005||S>.005&&Math.abs(this.scaleY-S)>.005)&&(this.scaleX=b,this.scaleY=S,c|=16,l=a=!0)}let u=(parseInt(r.paddingTop)||0)*this.scaleY,f=(parseInt(r.paddingBottom)||0)*this.scaleY;(this.paddingTop!=u||this.paddingBottom!=f)&&(this.paddingTop=u,this.paddingBottom=f,c|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(n.lineWrapping&&(a=!0),this.editorWidth=e.scrollDOM.clientWidth,c|=16);let d=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=d&&(this.scrollAnchorHeight=-1,this.scrollTop=d),this.scrolledToBottom=Sm(e.scrollDOM);let y=(this.printing?_2:g2)(t,this.paddingTop),_=y.top-this.pixelViewport.top,m=y.bottom-this.pixelViewport.bottom;this.pixelViewport=y;let p=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(p!=this.inView&&(this.inView=p,p&&(a=!0)),!this.inView&&!this.scrollTarget&&!v2(e.dom))return 0;let g=o.width;if((this.contentDOMWidth!=g||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=o.width,this.editorHeight=e.scrollDOM.clientHeight,c|=16),a){let b=e.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(b)&&(l=!0),l||n.lineWrapping&&Math.abs(g-this.contentDOMWidth)>n.charWidth){let{lineHeight:S,charWidth:x,textHeight:C}=e.docView.measureTextSize();l=S>0&&n.refresh(s,S,x,C,Math.max(5,g/x),b),l&&(e.docView.minWidth=0,c|=16)}_>0&&m>0?h=Math.max(_,m):_<0&&m<0&&(h=Math.min(_,m)),cf();for(let S of this.viewports){let x=S.from==this.viewport.from?b:e.docView.measureVisibleLineHeights(S);this.heightMap=(l?vt.empty().applyChanges(this.stateDeco,Ee.empty,this.heightOracle,[new Ft(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(n,0,l,new h2(S.from,x))}Ur&&(c|=2)}let v=!this.viewportIsAppropriate(this.viewport,h)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return v&&(c&2&&(c|=this.updateScaler()),this.viewport=this.getViewport(h,this.scrollTarget),c|=this.updateForViewport()),(c&2||v)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(l?[]:this.lineGaps,e)),c|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),c}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let r=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),n=this.heightMap,s=this.heightOracle,{visibleTop:l,visibleBottom:o}=this,a=new _s(n.lineAt(l-r*1e3,Ne.ByHeight,s,0,0).from,n.lineAt(o+(1-r)*1e3,Ne.ByHeight,s,0,0).to);if(t){let{head:c}=t.range;if(c<a.from||c>a.to){let h=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),u=n.lineAt(c,Ne.ByPos,s,0,0),f;t.y=="center"?f=(u.top+u.bottom)/2-h/2:t.y=="start"||t.y=="nearest"&&c<a.from?f=u.top:f=u.bottom-h,a=new _s(n.lineAt(f-1e3/2,Ne.ByHeight,s,0,0).from,n.lineAt(f+h+1e3/2,Ne.ByHeight,s,0,0).to)}}return a}mapViewport(e,t){let r=t.mapPos(e.from,-1),n=t.mapPos(e.to,1);return new _s(this.heightMap.lineAt(r,Ne.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(n,Ne.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},r=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(e,Ne.ByPos,this.heightOracle,0,0),{bottom:s}=this.heightMap.lineAt(t,Ne.ByPos,this.heightOracle,0,0),{visibleTop:l,visibleBottom:o}=this;return(e==0||n<=l-Math.max(10,Math.min(-r,250)))&&(t==this.state.doc.length||s>=o+Math.max(10,Math.min(r,250)))&&n>l-2*1e3&&s<o+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let r=[];for(let n of e)t.touchesRange(n.from,n.to)||r.push(new wl(t.mapPos(n.from),t.mapPos(n.to),n.size,n.displaySize));return r}ensureLineGaps(e,t){let r=this.heightOracle.lineWrapping,n=r?1e4:2e3,s=n>>1,l=n<<1;if(this.defaultTextDirection!=He.LTR&&!r)return[];let o=[],a=(h,u,f,d)=>{if(u-h<s)return;let y=this.state.selection.main,_=[y.from];y.empty||_.push(y.to);for(let p of _)if(p>h&&p<u){a(h,p-10,f,d),a(p+10,u,f,d);return}let m=x2(e,p=>p.from>=f.from&&p.to<=f.to&&Math.abs(p.from-h)<s&&Math.abs(p.to-u)<s&&!_.some(g=>p.from<g&&p.to>g));if(!m){if(u<f.to&&t&&r&&t.visibleRanges.some(v=>v.from<=u&&v.to>=u)){let v=t.moveToLineBoundary(G.cursor(u),!1,!0).head;v>h&&(u=v)}let p=this.gapSize(f,h,u,d),g=r||p<2e6?p:2e6;m=new wl(h,u,p,g)}o.push(m)},c=h=>{if(h.length<l||h.type!=Ct.Text)return;let u=b2(h.from,h.to,this.stateDeco);if(u.total<l)return;let f=this.scrollTarget?this.scrollTarget.range.head:null,d,y;if(r){let _=n/this.heightOracle.lineLength*this.heightOracle.lineHeight,m,p;if(f!=null){let g=bs(u,f),v=((this.visibleBottom-this.visibleTop)/2+_)/h.height;m=g-v,p=g+v}else m=(this.visibleTop-h.top-_)/h.height,p=(this.visibleBottom-h.top+_)/h.height;d=ys(u,m),y=ys(u,p)}else{let _=u.total*this.heightOracle.charWidth,m=n*this.heightOracle.charWidth,p=0;if(_>2e6)for(let x of e)x.from>=h.from&&x.from<h.to&&x.size!=x.displaySize&&x.from*this.heightOracle.charWidth+p<this.pixelViewport.left&&(p=x.size-x.displaySize);let g=this.pixelViewport.left+p,v=this.pixelViewport.right+p,b,S;if(f!=null){let x=bs(u,f),C=((v-g)/2+m)/_;b=x-C,S=x+C}else b=(g-m)/_,S=(v+m)/_;d=ys(u,b),y=ys(u,S)}d>h.from&&a(h.from,d,h,u),y<h.to&&a(y,h.to,h,u)};for(let h of this.viewportLines)Array.isArray(h.type)?h.type.forEach(c):c(h);return o}gapSize(e,t,r,n){let s=bs(n,r)-bs(n,t);return this.heightOracle.lineWrapping?e.height*s:n.total*this.heightOracle.charWidth*s}updateLineGaps(e){wl.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=he.set(e.map(t=>t.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(e){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let r=[];ye.spans(t,this.viewport.from,this.viewport.to,{span(s,l){r.push({from:s,to:l})},point(){}},20);let n=0;if(r.length!=this.visibleRanges.length)n=12;else for(let s=0;s<r.length&&!(n&8);s++){let l=this.visibleRanges[s],o=r[s];(l.from!=o.from||l.to!=o.to)&&(n|=4,e&&e.mapPos(l.from,-1)==o.from&&e.mapPos(l.to,1)==o.to||(n|=8))}return this.visibleRanges=r,n}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||mn(this.heightMap.lineAt(e,Ne.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(t=>t.top<=e&&t.bottom>=e)||mn(this.heightMap.lineAt(this.scaler.fromDOM(e),Ne.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return mn(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class _s{constructor(e,t){this.from=e,this.to=t}}function b2(i,e,t){let r=[],n=i,s=0;return ye.spans(t,i,e,{span(){},point(l,o){l>n&&(r.push({from:n,to:l}),s+=l-n),n=o}},20),n<e&&(r.push({from:n,to:e}),s+=e-n),{total:s,ranges:r}}function ys({total:i,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let r=Math.floor(i*t);for(let n=0;;n++){let{from:s,to:l}=e[n],o=l-s;if(r<=o)return s+r;r-=o}}function bs(i,e){let t=0;for(let{from:r,to:n}of i.ranges){if(e<=n){t+=e-r;break}t+=n-r}return t/i.total}function x2(i,e){for(let t of i)if(e(t))return t}const ff={toDOM(i){return i},fromDOM(i){return i},scale:1,eq(i){return i==this}};function df(i){let e=i.facet(To).filter(r=>typeof r!="function"),t=i.facet(Bc).filter(r=>typeof r!="function");return t.length&&e.push(ye.join(t)),e}class Fc{constructor(e,t,r){let n=0,s=0,l=0;this.viewports=r.map(({from:o,to:a})=>{let c=t.lineAt(o,Ne.ByPos,e,0,0).top,h=t.lineAt(a,Ne.ByPos,e,0,0).bottom;return n+=h-c,{from:o,to:a,top:c,bottom:h,domTop:0,domBottom:0}}),this.scale=(7e6-n)/(t.height-n);for(let o of this.viewports)o.domTop=l+(o.top-s)*this.scale,l=o.domBottom=o.domTop+(o.bottom-o.top),s=o.bottom}toDOM(e){for(let t=0,r=0,n=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.top)return n+(e-r)*this.scale;if(e<=s.bottom)return s.domTop+(e-s.top);r=s.bottom,n=s.domBottom}}fromDOM(e){for(let t=0,r=0,n=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.domTop)return r+(e-n)/this.scale;if(e<=s.domBottom)return s.top+(e-s.domTop);r=s.bottom,n=s.domBottom}}eq(e){return e instanceof Fc?this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every((t,r)=>t.from==e.viewports[r].from&&t.to==e.viewports[r].to):!1}}function mn(i,e){if(e.scale==1)return i;let t=e.toDOM(i.top),r=e.toDOM(i.bottom);return new Ut(i.from,i.length,t,r-t,Array.isArray(i._content)?i._content.map(n=>mn(n,e)):i._content)}const xs=oe.define({combine:i=>i.join(" ")}),Ma=oe.define({combine:i=>i.indexOf(!0)>-1}),Ta=ji.newName(),sg=ji.newName(),og=ji.newName(),lg={"&light":"."+sg,"&dark":"."+og};function Ra(i,e,t){return new ji(e,{finish(r){return/&/.test(r)?r.replace(/&\w*/,n=>{if(n=="&")return i;if(!t||!t[n])throw new RangeError(`Unsupported selector: ${n}`);return t[n]}):i+" "+r}})}const S2=Ra("."+Ta,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",zIndex:200},".cm-gutters-before":{insetInlineStart:0},".cm-gutters-after":{insetInlineEnd:0},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",border:"0px solid #ddd","&.cm-gutters-before":{borderRightWidth:"1px"},"&.cm-gutters-after":{borderLeftWidth:"1px"}},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-dialog":{padding:"2px 19px 4px 6px",position:"relative","& label":{fontSize:"80%"}},".cm-dialog-close":{position:"absolute",top:"3px",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",fontSize:"14px",padding:"0"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lg),w2={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Cl=ne.ie&&ne.ie_version<=11;class C2{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new ZC,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let r of t)this.queue.push(r);(ne.ie&&ne.ie_version<=11||ne.ios&&e.composing)&&t.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&ne.android&&e.constructor.EDIT_CONTEXT!==!1&&!(ne.chrome&&ne.chrome_version<126)&&(this.editContext=new E2(e),e.state.facet(vi)&&(e.contentDOM.editContext=this.editContext.editContext)),Cl&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var t;((t=this.view.docView)===null||t===void 0?void 0:t.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){(e.type=="change"||!e.type)&&!e.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,r)=>t!=e[r]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:r}=this,n=this.selectionRange;if(r.state.facet(vi)?r.root.activeElement!=this.dom:!Sn(this.dom,n))return;let s=n.anchorNode&&r.docView.tile.nearest(n.anchorNode);if(s&&s.isWidget()&&s.widget.ignoreEvent(e)){t||(this.selectionChanged=!1);return}(ne.ie&&ne.ie_version<=11||ne.android&&ne.chrome)&&!r.state.selection.main.empty&&n.focusNode&&wn(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=Wr(e.root);if(!t)return!1;let r=ne.safari&&e.root.nodeType==11&&e.root.activeElement==this.dom&&k2(this.view,t)||t;if(!r||this.selectionRange.eq(r))return!1;let n=Sn(this.dom,r);return n&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&tk(this.dom,r)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(r),n&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let r=this.dom;r;)if(r.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==r?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(r),r=r.assignedSlot||r.parentNode;else if(r.nodeType==11)r=r.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);for(let r of this.scrollTargets=t)r.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,w2),Cl&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Cl&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var r;if(!this.delayedAndroidKey){let n=()=>{let s=this.delayedAndroidKey;s&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=s.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&s.force&&Br(this.dom,s.key,s.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(n)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(!((r=this.delayedAndroidKey)===null||r===void 0)&&r.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,r=-1,n=!1;for(let s of e){let l=this.readMutation(s);l&&(l.typeOver&&(n=!0),t==-1?{from:t,to:r}=l:(t=Math.min(l.from,t),r=Math.max(l.to,r)))}return{from:t,to:r,typeOver:n}}readChange(){let{from:e,to:t,typeOver:r}=this.processRecords(),n=this.selectionChanged&&Sn(this.dom,this.selectionRange);if(e<0&&!n)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let s=new $k(this.view,e,t,r);return this.view.docView.domChanged={newSel:s.newSel?s.newSel.main:null},s}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return this.view.requestMeasure(),!1;let r=this.view.state,n=Gm(this.view,t);return this.view.state==r&&(t.domChanged||t.newSel&&!no(this.view.state.selection,t.newSel.main))&&this.view.update([]),n}readMutation(e){let t=this.view.docView.tile.nearest(e.target);if(!t||t.isWidget())return null;if(t.markDirty(e.type=="attributes"),e.type=="childList"){let r=pf(t,e.previousSibling||e.target.previousSibling,-1),n=pf(t,e.nextSibling||e.target.nextSibling,1);return{from:r?t.posAfter(r):t.posAtStart,to:n?t.posBefore(n):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(vi)!=e.state.facet(vi)&&(e.view.contentDOM.editContext=e.state.facet(vi)?this.editContext.editContext:null))}destroy(){var e,t,r;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(r=this.resizeScroll)===null||r===void 0||r.disconnect();for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function pf(i,e,t){for(;e;){let r=Ve.get(e);if(r&&r.parent==i)return r;let n=e.parentNode;e=n!=i.dom?n:t>0?e.nextSibling:e.previousSibling}return null}function mf(i,e){let t=e.startContainer,r=e.startOffset,n=e.endContainer,s=e.endOffset,l=i.docView.domAtPos(i.state.selection.main.anchor,1);return wn(l.node,l.offset,n,s)&&([t,r,n,s]=[n,s,t,r]),{anchorNode:t,anchorOffset:r,focusNode:n,focusOffset:s}}function k2(i,e){if(e.getComposedRanges){let n=e.getComposedRanges(i.root)[0];if(n)return mf(i,n)}let t=null;function r(n){n.preventDefault(),n.stopImmediatePropagation(),t=n.getTargetRanges()[0]}return i.contentDOM.addEventListener("beforeinput",r,!0),i.dom.ownerDocument.execCommand("indent"),i.contentDOM.removeEventListener("beforeinput",r,!0),t?mf(i,t):null}class E2{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let t=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=r=>{let n=e.state.selection.main,{anchor:s,head:l}=n,o=this.toEditorPos(r.updateRangeStart),a=this.toEditorPos(r.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:r.updateRangeStart,editorBase:o,drifted:!1});let c=a-o>r.text.length;o==this.from&&s<this.from?o=s:a==this.to&&s>this.to&&(a=s);let h=Xm(e.state.sliceDoc(o,a),r.text,(c?n.from:n.to)-o,c?"end":null);if(!h){let f=G.single(this.toEditorPos(r.selectionStart),this.toEditorPos(r.selectionEnd));no(f,n)||e.dispatch({selection:f,userEvent:"select"});return}let u={from:h.from+o,to:h.toA+o,insert:Ee.of(r.text.slice(h.from,h.toB).split(`
`))};if((ne.mac||ne.android)&&u.from==l-1&&/^\. ?$/.test(r.text)&&e.contentDOM.getAttribute("autocorrect")=="off"&&(u={from:o,to:a,insert:Ee.of([r.text.replace("."," ")])}),this.pendingContextChange=u,!e.state.readOnly){let f=this.to-this.from+(u.to-u.from+u.insert.length);Ic(e,u,G.single(this.toEditorPos(r.selectionStart,f),this.toEditorPos(r.selectionEnd,f)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state)),u.from<u.to&&!u.insert.length&&e.inputState.composing>=0&&!/[\\p{Alphabetic}\\p{Number}_]/.test(t.text.slice(Math.max(0,r.updateRangeStart-1),Math.min(t.text.length,r.updateRangeStart+1)))&&this.handlers.compositionend(r)},this.handlers.characterboundsupdate=r=>{let n=[],s=null;for(let l=this.toEditorPos(r.rangeStart),o=this.toEditorPos(r.rangeEnd);l<o;l++){let a=e.coordsForChar(l);s=a&&new DOMRect(a.left,a.top,a.right-a.left,a.bottom-a.top)||s||new DOMRect,n.push(s)}t.updateCharacterBounds(r.rangeStart,n)},this.handlers.textformatupdate=r=>{let n=[];for(let s of r.getTextFormats()){let l=s.underlineStyle,o=s.underlineThickness;if(!/none/i.test(l)&&!/none/i.test(o)){let a=this.toEditorPos(s.rangeStart),c=this.toEditorPos(s.rangeEnd);if(a<c){let h=`text-decoration: underline ${/^[a-z]/.test(l)?l+" ":l=="Dashed"?"dashed ":l=="Squiggle"?"wavy ":""}${/thin/i.test(o)?1:2}px`;n.push(he.mark({attributes:{style:h}}).range(a,c))}}}e.dispatch({effects:Fm.of(he.set(n))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:r}=this.composing;this.composing=null,r&&this.reset(e.state)}};for(let r in this.handlers)t.addEventListener(r,this.handlers[r]);this.measureReq={read:r=>{this.editContext.updateControlBounds(r.contentDOM.getBoundingClientRect());let n=Wr(r.root);n&&n.rangeCount&&this.editContext.updateSelectionBounds(n.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let t=0,r=!1,n=this.pendingContextChange;return e.changes.iterChanges((s,l,o,a,c)=>{if(r)return;let h=c.length-(l-s);if(n&&l>=n.to)if(n.from==s&&n.to==l&&n.insert.eq(c)){n=this.pendingContextChange=null,t+=h,this.to+=h;return}else n=null,this.revertPending(e.state);if(s+=t,l+=t,l<=this.from)this.from+=h,this.to+=h;else if(s<this.to){if(s<this.from||l>this.to||this.to-this.from+c.length>3e4){r=!0;return}this.editContext.updateText(this.toContextPos(s),this.toContextPos(l),c.toString()),this.to+=h}t+=h}),n&&!r&&this.revertPending(e.state),!r}update(e){let t=this.pendingContextChange,r=e.startState.selection.main;this.composing&&(this.composing.drifted||!e.changes.touchesRange(r.from,r.to)&&e.transactions.some(n=>!n.isUserEvent("input.type")&&n.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):!this.applyEdits(e)||!this.rangeIsValid(e.state)?(this.pendingContextChange=null,this.reset(e.state)):(e.docChanged||e.selectionSet||t)&&this.setSelection(e.state),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:t}=e.selection.main;this.from=Math.max(0,t-1e4),this.to=Math.min(e.doc.length,t+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let t=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(t.from),this.toContextPos(t.from+t.insert.length),e.doc.sliceString(t.from,t.to))}setSelection(e){let{main:t}=e.selection,r=this.toContextPos(Math.max(this.from,Math.min(this.to,t.anchor))),n=this.toContextPos(t.head);(this.editContext.selectionStart!=r||this.editContext.selectionEnd!=n)&&this.editContext.updateSelection(r,n)}rangeIsValid(e){let{head:t}=e.selection.main;return!(this.from>0&&t-this.from<500||this.to<e.doc.length&&this.to-t<500||this.to-this.from>1e4*3)}toEditorPos(e,t=this.to-this.from){e=Math.min(e,t);let r=this.composing;return r&&r.drifted?r.editorBase+(e-r.contextBase):e+this.from}toContextPos(e){let t=this.composing;return t&&t.drifted?t.contextBase+(e-t.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}class se{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return!!this.inputState&&this.inputState.composing>0}get compositionStarted(){return!!this.inputState&&this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var t;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:r}=e;this.dispatchTransactions=e.dispatchTransactions||r&&(n=>n.forEach(s=>r(s,this)))||(n=>this.update(n)),this.dispatch=this.dispatch.bind(this),this._root=e.root||ek(e.parent)||document,this.viewState=new uf(e.state||ke.create(e)),e.scrollTo&&e.scrollTo.is(ms)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(Er).map(n=>new _l(n));for(let n of this.plugins)n.update(this);this.observer=new C2(this),this.inputState=new Kk(this),this.inputState.ensureHandlers(this.plugins),this.docView=new Ju(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((t=document.fonts)===null||t===void 0)&&t.ready&&document.fonts.ready.then(()=>{this.viewState.mustMeasureContent=!0,this.requestMeasure()})}dispatch(...e){let t=e.length==1&&e[0]instanceof We?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,r=!1,n,s=this.state;for(let f of e){if(f.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=f.state}if(this.destroyed){this.viewState.state=s;return}let l=this.hasFocus,o=0,a=null;e.some(f=>f.annotation(tg))?(this.inputState.notifiedFocused=l,o=1):l!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=l,a=ig(s,l),a||(o=1));let c=this.observer.delayedAndroidKey,h=null;if(c?(this.observer.clearDelayedAndroidKey(),h=this.observer.readChange(),(h&&!this.state.doc.eq(s.doc)||!this.state.selection.eq(s.selection))&&(h=null)):this.observer.clear(),s.facet(ke.phrases)!=this.state.facet(ke.phrases))return this.setState(s);n=to.create(this,s,e),n.flags|=o;let u=this.viewState.scrollTarget;try{this.updateState=2;for(let f of e){if(u&&(u=u.map(f.changes)),f.scrollIntoView){let{main:d}=f.state.selection;u=new Or(d.empty?d:G.cursor(d.head,d.head>d.anchor?-1:1))}for(let d of f.effects)d.is(ms)&&(u=d.value.clip(this.state))}this.viewState.update(n,u),this.bidiCache=oo.update(this.bidiCache,n.changes),n.empty||(this.updatePlugins(n),this.inputState.update(n)),t=this.docView.update(n),this.state.facet(dn)!=this.styleModules&&this.mountStyles(),r=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(f=>f.isUserEvent("select.pointer")))}finally{this.updateState=0}if(n.startState.facet(xs)!=n.state.facet(xs)&&(this.viewState.mustMeasureContent=!0),(t||r||u||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),t&&this.docViewUpdate(),!n.empty)for(let f of this.state.facet(Ea))try{f(n)}catch(d){St(this.state,d,"update listener")}(a||h)&&Promise.resolve().then(()=>{a&&this.state==a.startState&&this.dispatch(a),h&&!Gm(this,h)&&c.force&&Br(this.contentDOM,c.key,c.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let r of this.plugins)r.destroy(this);this.viewState=new uf(e),this.plugins=e.facet(Er).map(r=>new _l(r)),this.pluginMap.clear();for(let r of this.plugins)r.update(this);this.docView.destroy(),this.docView=new Ju(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(Er),r=e.state.facet(Er);if(t!=r){let n=[];for(let s of r){let l=t.indexOf(s);if(l<0)n.push(new _l(s));else{let o=this.plugins[l];o.mustUpdate=e,n.push(o)}}for(let s of this.plugins)s.mustUpdate!=e&&s.destroy(this);this.plugins=n,this.pluginMap.clear()}else for(let n of this.plugins)n.mustUpdate=e;for(let n=0;n<this.plugins.length;n++)this.plugins[n].update(this);t!=r&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let t=e.value;if(t&&t.docViewUpdate)try{t.docViewUpdate(this)}catch(r){St(this.state,r,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,r=this.scrollDOM,n=r.scrollTop*this.scaleY,{scrollAnchorPos:s,scrollAnchorHeight:l}=this.viewState;Math.abs(n-this.viewState.scrollTop)>1&&(l=-1),this.viewState.scrollAnchorHeight=-1;try{for(let o=0;;o++){if(l<0)if(Sm(r))s=-1,l=this.viewState.heightMap.height;else{let d=this.viewState.scrollAnchorAt(n);s=d.from,l=d.top}this.updateState=1;let a=this.viewState.measure(this);if(!a&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(o>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let c=[];a&4||([this.measureRequests,c]=[c,this.measureRequests]);let h=c.map(d=>{try{return d.read(this)}catch(y){return St(this.state,y),gf}}),u=to.create(this,this.state,[]),f=!1;u.flags|=a,t?t.flags|=a:t=u,this.updateState=2,u.empty||(this.updatePlugins(u),this.inputState.update(u),this.updateAttrs(),f=this.docView.update(u),f&&this.docViewUpdate());for(let d=0;d<c.length;d++)if(h[d]!=gf)try{let y=c[d];y.write&&y.write(h[d],this)}catch(y){St(this.state,y)}if(f&&this.docView.updateSelection(!0),!u.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=-1;continue}else{let y=(s<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(s).top)-l;if(y>1||y<-1){n=n+y,r.scrollTop=n/this.scaleY,l=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let o of this.state.facet(Ea))o(t)}get themeClasses(){return Ta+" "+(this.state.facet(Ma)?og:sg)+" "+this.state.facet(xs)}updateAttrs(){let e=vf(this,Hm,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(vi)?"true":"false",class:"cm-content",style:`${ne.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),vf(this,Pc,t);let r=this.observer.ignore(()=>{let n=Vu(this.contentDOM,this.contentAttrs,t),s=Vu(this.dom,this.editorAttrs,e);return n||s});return this.editorAttrs=e,this.contentAttrs=t,r}showAnnouncements(e){let t=!0;for(let r of e)for(let n of r.effects)if(n.is(se.announce)){t&&(this.announceDOM.textContent=""),t=!1;let s=this.announceDOM.appendChild(document.createElement("div"));s.textContent=n.value}}mountStyles(){this.styleModules=this.state.facet(dn);let e=this.state.facet(se.cspNonce);ji.mount(this.root,this.styleModules.concat(S2).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.plugin!=e)&&this.pluginMap.set(e,t=this.plugins.find(r=>r.plugin==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,r){return Sl(this,e,Yu(this,e,t,r))}moveByGroup(e,t){return Sl(this,e,Yu(this,e,t,r=>Fk(this,e.head,r)))}visualLineSide(e,t){let r=this.bidiSpans(e),n=this.textDirectionAt(e.from),s=r[t?r.length-1:0];return G.cursor(s.side(t,n)+e.from,s.forward(!t,n)?1:-1)}moveToLineBoundary(e,t,r=!0){return Nk(this,e,t,r)}moveVertically(e,t,r){return Sl(this,e,Hk(this,e,t,r))}domAtPos(e,t=1){return this.docView.domAtPos(e,t)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){this.readMeasured();let r=Da(this,e,t);return r&&r.pos}posAndSideAtCoords(e,t=!0){return this.readMeasured(),Da(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let r=this.docView.coordsAt(e,t);if(!r||r.left==r.right)return r;let n=this.state.doc.lineAt(e),s=this.bidiSpans(n),l=s[_i.find(s,e-n.from,-1,t)];return eo(r,l.dir==He.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(Im)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>A2)return Dm(e.length);let t=this.textDirectionAt(e.from),r;for(let s of this.bidiCache)if(s.from==e.from&&s.dir==t&&(s.fresh||Am(s.isolates,r=Ku(this,e))))return s.order;r||(r=Ku(this,e));let n=ak(e.text,t,r);return this.bidiCache.push(new oo(e.from,e.to,t,r,!0,n)),n}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||ne.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{xm(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return ms.of(new Or(typeof e=="number"?G.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:t}=this.scrollDOM,r=this.viewState.scrollAnchorAt(e);return ms.of(new Or(G.cursor(r.from),"start","start",r.top-e,t,!0))}setTabFocusMode(e){e==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof e=="boolean"?this.inputState.tabFocusMode=e?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return ot.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return ot.define(()=>({}),{eventObservers:e})}static theme(e,t){let r=ji.newName(),n=[xs.of(r),dn.of(Ra(`.${r}`,e))];return t&&t.dark&&n.push(Ma.of(!0)),n}static baseTheme(e){return vr.lowest(dn.of(Ra("."+Ta,e,lg)))}static findFromDOM(e){var t;let r=e.querySelector(".cm-content"),n=r&&Ve.get(r)||Ve.get(e);return((t=n==null?void 0:n.root)===null||t===void 0?void 0:t.view)||null}}se.styleModule=dn;se.inputHandler=Bm;se.clipboardInputFilter=Tc;se.clipboardOutputFilter=Rc;se.scrollHandler=Nm;se.focusChangeEffect=Om;se.perLineTextDirection=Im;se.exceptionSink=Pm;se.updateListener=Ea;se.editable=vi;se.mouseSelectionStyle=Rm;se.dragMovesSelection=Tm;se.clickAddsSelectionRange=Mm;se.decorations=To;se.blockWrappers=jm;se.outerDecorations=Bc;se.atomicRanges=Zn;se.bidiIsolatedRanges=zm;se.scrollMargins=Wm;se.darkTheme=Ma;se.cspNonce=oe.define({combine:i=>i.length?i[0]:""});se.contentAttributes=Pc;se.editorAttributes=Hm;se.lineWrapping=se.contentAttributes.of({class:"cm-lineWrapping"});se.announce=pe.define();const A2=4096,gf={};class oo{constructor(e,t,r,n,s,l){this.from=e,this.to=t,this.dir=r,this.isolates=n,this.fresh=s,this.order=l}static update(e,t){if(t.empty&&!e.some(s=>s.fresh))return e;let r=[],n=e.length?e[e.length-1].dir:He.LTR;for(let s=Math.max(0,e.length-10);s<e.length;s++){let l=e[s];l.dir==n&&!t.touchesRange(l.from,l.to)&&r.push(new oo(t.mapPos(l.from,1),t.mapPos(l.to,-1),l.dir,l.isolates,!1,l.order))}return r}}function vf(i,e,t){for(let r=i.state.facet(e),n=r.length-1;n>=0;n--){let s=r[n],l=typeof s=="function"?s(i):s;l&&Dc(l,t)}return t}const D2=ne.mac?"mac":ne.windows?"win":ne.linux?"linux":"key";function L2(i,e){const t=i.split(/-(?!$)/);let r=t[t.length-1];r=="Space"&&(r=" ");let n,s,l,o;for(let a=0;a<t.length-1;++a){const c=t[a];if(/^(cmd|meta|m)$/i.test(c))o=!0;else if(/^a(lt)?$/i.test(c))n=!0;else if(/^(c|ctrl|control)$/i.test(c))s=!0;else if(/^s(hift)?$/i.test(c))l=!0;else if(/^mod$/i.test(c))e=="mac"?o=!0:s=!0;else throw new Error("Unrecognized modifier name: "+c)}return n&&(r="Alt-"+r),s&&(r="Ctrl-"+r),o&&(r="Meta-"+r),l&&(r="Shift-"+r),r}function Ss(i,e,t){return e.altKey&&(i="Alt-"+i),e.ctrlKey&&(i="Ctrl-"+i),e.metaKey&&(i="Meta-"+i),t!==!1&&e.shiftKey&&(i="Shift-"+i),i}const M2=vr.default(se.domEventHandlers({keydown(i,e){return cg(ag(e.state),i,e,"editor")}})),Oo=oe.define({enables:M2}),_f=new WeakMap;function ag(i){let e=i.facet(Oo),t=_f.get(e);return t||_f.set(e,t=P2(e.reduce((r,n)=>r.concat(n),[]))),t}function T2(i,e,t){return cg(ag(i.state),e,i,t)}let Ri=null;const R2=4e3;function P2(i,e=D2){let t=Object.create(null),r=Object.create(null),n=(l,o)=>{let a=r[l];if(a==null)r[l]=o;else if(a!=o)throw new Error("Key binding "+l+" is used both as a regular binding and as a multi-stroke prefix")},s=(l,o,a,c,h)=>{var u,f;let d=t[l]||(t[l]=Object.create(null)),y=o.split(/ (?!$)/).map(p=>L2(p,e));for(let p=1;p<y.length;p++){let g=y.slice(0,p).join(" ");n(g,!0),d[g]||(d[g]={preventDefault:!0,stopPropagation:!1,run:[v=>{let b=Ri={view:v,prefix:g,scope:l};return setTimeout(()=>{Ri==b&&(Ri=null)},R2),!0}]})}let _=y.join(" ");n(_,!1);let m=d[_]||(d[_]={preventDefault:!1,stopPropagation:!1,run:((f=(u=d._any)===null||u===void 0?void 0:u.run)===null||f===void 0?void 0:f.slice())||[]});a&&m.run.push(a),c&&(m.preventDefault=!0),h&&(m.stopPropagation=!0)};for(let l of i){let o=l.scope?l.scope.split(" "):["editor"];if(l.any)for(let c of o){let h=t[c]||(t[c]=Object.create(null));h._any||(h._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:u}=l;for(let f in h)h[f].run.push(d=>u(d,Pa))}let a=l[e]||l.key;if(a)for(let c of o)s(c,a,l.run,l.preventDefault,l.stopPropagation),l.shift&&s(c,"Shift-"+a,l.shift,l.preventDefault,l.stopPropagation)}return t}let Pa=null;function cg(i,e,t,r){Pa=e;let n=UC(e),s=Tt(n,0),l=ai(s)==n.length&&n!=" ",o="",a=!1,c=!1,h=!1;Ri&&Ri.view==t&&Ri.scope==r&&(o=Ri.prefix+" ",Ym.indexOf(e.keyCode)<0&&(c=!0,Ri=null));let u=new Set,f=m=>{if(m){for(let p of m.run)if(!u.has(p)&&(u.add(p),p(t)))return m.stopPropagation&&(h=!0),!0;m.preventDefault&&(m.stopPropagation&&(h=!0),c=!0)}return!1},d=i[r],y,_;return d&&(f(d[o+Ss(n,e,!l)])?a=!0:l&&(e.altKey||e.metaKey||e.ctrlKey)&&!(ne.windows&&e.ctrlKey&&e.altKey)&&!(ne.mac&&e.altKey&&!(e.ctrlKey||e.metaKey))&&(y=zi[e.keyCode])&&y!=n?(f(d[o+Ss(y,e,!0)])||e.shiftKey&&(_=Tn[e.keyCode])!=n&&_!=y&&f(d[o+Ss(_,e,!1)]))&&(a=!0):l&&e.shiftKey&&f(d[o+Ss(n,e,!0)])&&(a=!0),!a&&f(d._any)&&(a=!0)),c&&(a=!0),a&&h&&e.stopPropagation(),Pa=null,a}function B2(){return I2}const O2=he.line({class:"cm-activeLine"}),I2=ot.fromClass(class{constructor(i){this.decorations=this.getDeco(i)}update(i){(i.docChanged||i.selectionSet)&&(this.decorations=this.getDeco(i.view))}getDeco(i){let e=-1,t=[];for(let r of i.state.selection.ranges){let n=i.lineBlockAt(r.head);n.from>e&&(t.push(O2.range(n.from)),e=n.from)}return he.set(t)}},{decorations:i=>i.decorations}),ws="-10000px";class hg{constructor(e,t,r,n){this.facet=t,this.createTooltipView=r,this.removeTooltipView=n,this.input=e.state.facet(t),this.tooltips=this.input.filter(l=>l);let s=null;this.tooltipViews=this.tooltips.map(l=>s=r(l,s))}update(e,t){var r;let n=e.state.facet(this.facet),s=n.filter(a=>a);if(n===this.input){for(let a of this.tooltipViews)a.update&&a.update(e);return!1}let l=[],o=t?[]:null;for(let a=0;a<s.length;a++){let c=s[a],h=-1;if(c){for(let u=0;u<this.tooltips.length;u++){let f=this.tooltips[u];f&&f.create==c.create&&(h=u)}if(h<0)l[a]=this.createTooltipView(c,a?l[a-1]:null),o&&(o[a]=!!c.above);else{let u=l[a]=this.tooltipViews[h];o&&(o[a]=t[h]),u.update&&u.update(e)}}}for(let a of this.tooltipViews)l.indexOf(a)<0&&(this.removeTooltipView(a),(r=a.destroy)===null||r===void 0||r.call(a));return t&&(o.forEach((a,c)=>t[c]=a),t.length=o.length),this.input=n,this.tooltips=s,this.tooltipViews=l,!0}}function N2(i){let e=i.dom.ownerDocument.documentElement;return{top:0,left:0,bottom:e.clientHeight,right:e.clientWidth}}const kl=oe.define({combine:i=>{var e,t,r;return{position:ne.ios?"absolute":((e=i.find(n=>n.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((t=i.find(n=>n.parent))===null||t===void 0?void 0:t.parent)||null,tooltipSpace:((r=i.find(n=>n.tooltipSpace))===null||r===void 0?void 0:r.tooltipSpace)||N2}}}),yf=new WeakMap,Hc=ot.fromClass(class{constructor(i){this.view=i,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let e=i.state.facet(kl);this.position=e.position,this.parent=e.parent,this.classes=i.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver=typeof ResizeObserver=="function"?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new hg(i,jc,(t,r)=>this.createTooltip(t,r),t=>{this.resizeObserver&&this.resizeObserver.unobserve(t.dom),t.dom.remove()}),this.above=this.manager.tooltips.map(t=>!!t.above),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(t=>{Date.now()>this.lastTransaction-50&&t.length>0&&t[t.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),i.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let i of this.manager.tooltipViews)this.intersectionObserver.observe(i.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(i){i.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(i,this.above);e&&this.observeIntersection();let t=e||i.geometryChanged,r=i.state.facet(kl);if(r.position!=this.position&&!this.madeAbsolute){this.position=r.position;for(let n of this.manager.tooltipViews)n.dom.style.position=this.position;t=!0}if(r.parent!=this.parent){this.parent&&this.container.remove(),this.parent=r.parent,this.createContainer();for(let n of this.manager.tooltipViews)this.container.appendChild(n.dom);t=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);t&&this.maybeMeasure()}createTooltip(i,e){let t=i.create(this.view),r=e?e.dom:null;if(t.dom.classList.add("cm-tooltip"),i.arrow&&!t.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let n=document.createElement("div");n.className="cm-tooltip-arrow",t.dom.appendChild(n)}return t.dom.style.position=this.position,t.dom.style.top=ws,t.dom.style.left="0px",this.container.insertBefore(t.dom,r),t.mount&&t.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(t.dom),t}destroy(){var i,e,t;this.view.win.removeEventListener("resize",this.measureSoon);for(let r of this.manager.tooltipViews)r.dom.remove(),(i=r.destroy)===null||i===void 0||i.call(r);this.parent&&this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect(),(t=this.intersectionObserver)===null||t===void 0||t.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let i=1,e=1,t=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:s}=this.manager.tooltipViews[0];if(ne.safari){let l=s.getBoundingClientRect();t=Math.abs(l.top+1e4)>1||Math.abs(l.left)>1}else t=!!s.offsetParent&&s.offsetParent!=this.container.ownerDocument.body}if(t||this.position=="absolute")if(this.parent){let s=this.parent.getBoundingClientRect();s.width&&s.height&&(i=s.width/this.parent.offsetWidth,e=s.height/this.parent.offsetHeight)}else({scaleX:i,scaleY:e}=this.view.viewState);let r=this.view.scrollDOM.getBoundingClientRect(),n=Oc(this.view);return{visible:{left:r.left+n.left,top:r.top+n.top,right:r.right-n.right,bottom:r.bottom-n.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map((s,l)=>{let o=this.manager.tooltipViews[l];return o.getCoords?o.getCoords(s.pos):this.view.coordsAtPos(s.pos)}),size:this.manager.tooltipViews.map(({dom:s})=>s.getBoundingClientRect()),space:this.view.state.facet(kl).tooltipSpace(this.view),scaleX:i,scaleY:e,makeAbsolute:t}}writeMeasure(i){var e;if(i.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let o of this.manager.tooltipViews)o.dom.style.position="absolute"}let{visible:t,space:r,scaleX:n,scaleY:s}=i,l=[];for(let o=0;o<this.manager.tooltips.length;o++){let a=this.manager.tooltips[o],c=this.manager.tooltipViews[o],{dom:h}=c,u=i.pos[o],f=i.size[o];if(!u||a.clip!==!1&&(u.bottom<=Math.max(t.top,r.top)||u.top>=Math.min(t.bottom,r.bottom)||u.right<Math.max(t.left,r.left)-.1||u.left>Math.min(t.right,r.right)+.1)){h.style.top=ws;continue}let d=a.arrow?c.dom.querySelector(".cm-tooltip-arrow"):null,y=d?7:0,_=f.right-f.left,m=(e=yf.get(c))!==null&&e!==void 0?e:f.bottom-f.top,p=c.offset||H2,g=this.view.textDirection==He.LTR,v=f.width>r.right-r.left?g?r.left:r.right-f.width:g?Math.max(r.left,Math.min(u.left-(d?14:0)+p.x,r.right-_)):Math.min(Math.max(r.left,u.left-_+(d?14:0)-p.x),r.right-_),b=this.above[o];!a.strictSide&&(b?u.top-m-y-p.y<r.top:u.bottom+m+y+p.y>r.bottom)&&b==r.bottom-u.bottom>u.top-r.top&&(b=this.above[o]=!b);let S=(b?u.top-r.top:r.bottom-u.bottom)-y;if(S<m&&c.resize!==!1){if(S<this.view.defaultLineHeight){h.style.top=ws;continue}yf.set(c,m),h.style.height=(m=S)/s+"px"}else h.style.height&&(h.style.height="");let x=b?u.top-m-y-p.y:u.bottom+y+p.y,C=v+_;if(c.overlap!==!0)for(let w of l)w.left<C&&w.right>v&&w.top<x+m&&w.bottom>x&&(x=b?w.top-m-2-y:w.bottom+y+2);if(this.position=="absolute"?(h.style.top=(x-i.parent.top)/s+"px",bf(h,(v-i.parent.left)/n)):(h.style.top=x/s+"px",bf(h,v/n)),d){let w=u.left+(g?p.x:-p.x)-(v+14-7);d.style.left=w/n+"px"}c.overlap!==!0&&l.push({left:v,top:x,right:C,bottom:x+m}),h.classList.toggle("cm-tooltip-above",b),h.classList.toggle("cm-tooltip-below",!b),c.positioned&&c.positioned(i.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let i of this.manager.tooltipViews)i.dom.style.top=ws}},{eventObservers:{scroll(){this.maybeMeasure()}}});function bf(i,e){let t=parseInt(i.style.left,10);(isNaN(t)||Math.abs(e-t)>1)&&(i.style.left=e+"px")}const F2=se.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),H2={x:0,y:0},jc=oe.define({enables:[Hc,F2]}),lo=oe.define({combine:i=>i.reduce((e,t)=>e.concat(t),[])});class Io{static create(e){return new Io(e)}constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new hg(e,lo,(t,r)=>this.createHostedView(t,r),t=>t.dom.remove())}createHostedView(e,t){let r=e.create(this.view);return r.dom.classList.add("cm-tooltip-section"),this.dom.insertBefore(r.dom,t?t.dom.nextSibling:this.dom.firstChild),this.mounted&&r.mount&&r.mount(this.view),r}mount(e){for(let t of this.manager.tooltipViews)t.mount&&t.mount(e);this.mounted=!0}positioned(e){for(let t of this.manager.tooltipViews)t.positioned&&t.positioned(e)}update(e){this.manager.update(e)}destroy(){var e;for(let t of this.manager.tooltipViews)(e=t.destroy)===null||e===void 0||e.call(t)}passProp(e){let t;for(let r of this.manager.tooltipViews){let n=r[e];if(n!==void 0){if(t===void 0)t=n;else if(t!==n)return}}return t}get offset(){return this.passProp("offset")}get getCoords(){return this.passProp("getCoords")}get overlap(){return this.passProp("overlap")}get resize(){return this.passProp("resize")}}const j2=jc.compute([lo],i=>{let e=i.facet(lo);return e.length===0?null:{pos:Math.min(...e.map(t=>t.pos)),end:Math.max(...e.map(t=>{var r;return(r=t.end)!==null&&r!==void 0?r:t.pos})),create:Io.create,above:e[0].above,arrow:e.some(t=>t.arrow)}});class z2{constructor(e,t,r,n,s){this.view=e,this.source=t,this.field=r,this.setHover=n,this.hoverTime=s,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active.length)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{view:e,lastMove:t}=this,r=e.docView.tile.nearest(t.target);if(!r)return;let n,s=1;if(r.isWidget())n=r.posAtStart;else{if(n=e.posAtCoords(t),n==null)return;let o=e.coordsAtPos(n);if(!o||t.y<o.top||t.y>o.bottom||t.x<o.left-e.defaultCharacterWidth||t.x>o.right+e.defaultCharacterWidth)return;let a=e.bidiSpans(e.state.doc.lineAt(n)).find(h=>h.from<=n&&h.to>=n),c=a&&a.dir==He.RTL?-1:1;s=t.x<o.left?-c:c}let l=this.source(e,n,s);if(l!=null&&l.then){let o=this.pending={pos:n};l.then(a=>{this.pending==o&&(this.pending=null,a&&!(Array.isArray(a)&&!a.length)&&e.dispatch({effects:this.setHover.of(Array.isArray(a)?a:[a])}))},a=>St(e.state,a,"hover tooltip"))}else l&&!(Array.isArray(l)&&!l.length)&&e.dispatch({effects:this.setHover.of(Array.isArray(l)?l:[l])})}get tooltip(){let e=this.view.plugin(Hc),t=e?e.manager.tooltips.findIndex(r=>r.create==Io.create):-1;return t>-1?e.manager.tooltipViews[t]:null}mousemove(e){var t,r;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let{active:n,tooltip:s}=this;if(n.length&&s&&!W2(s.dom,e)||this.pending){let{pos:l}=n[0]||this.pending,o=(r=(t=n[0])===null||t===void 0?void 0:t.end)!==null&&r!==void 0?r:l;(l==o?this.view.posAtCoords(this.lastMove)!=l:!$2(this.view,l,o,e.clientX,e.clientY))&&(this.view.dispatch({effects:this.setHover.of([])}),this.pending=null)}}mouseleave(e){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1;let{active:t}=this;if(t.length){let{tooltip:r}=this;r&&r.dom.contains(e.relatedTarget)?this.watchTooltipLeave(r.dom):this.view.dispatch({effects:this.setHover.of([])})}}watchTooltipLeave(e){let t=r=>{e.removeEventListener("mouseleave",t),this.active.length&&!this.view.dom.contains(r.relatedTarget)&&this.view.dispatch({effects:this.setHover.of([])})};e.addEventListener("mouseleave",t)}destroy(){clearTimeout(this.hoverTimeout),clearTimeout(this.restartTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}const Cs=4;function W2(i,e){let{left:t,right:r,top:n,bottom:s}=i.getBoundingClientRect(),l;if(l=i.querySelector(".cm-tooltip-arrow")){let o=l.getBoundingClientRect();n=Math.min(o.top,n),s=Math.max(o.bottom,s)}return e.clientX>=t-Cs&&e.clientX<=r+Cs&&e.clientY>=n-Cs&&e.clientY<=s+Cs}function $2(i,e,t,r,n,s){let l=i.scrollDOM.getBoundingClientRect(),o=i.documentTop+i.documentPadding.top+i.contentHeight;if(l.left>r||l.right<r||l.top>n||Math.min(l.bottom,o)<n)return!1;let a=i.posAtCoords({x:r,y:n},!1);return a>=e&&a<=t}function V2(i,e={}){let t=pe.define(),r=tt.define({create(){return[]},update(n,s){if(n.length&&(e.hideOnChange&&(s.docChanged||s.selection)?n=[]:e.hideOn&&(n=n.filter(l=>!e.hideOn(s,l))),s.docChanged)){let l=[];for(let o of n){let a=s.changes.mapPos(o.pos,-1,Ze.TrackDel);if(a!=null){let c=Object.assign(Object.create(null),o);c.pos=a,c.end!=null&&(c.end=s.changes.mapPos(c.end)),l.push(c)}}n=l}for(let l of s.effects)l.is(t)&&(n=l.value),l.is(U2)&&(n=[]);return n},provide:n=>lo.from(n)});return{active:r,extension:[r,ot.define(n=>new z2(n,i,r,t,e.hoverTime||300)),j2]}}function ug(i,e){let t=i.plugin(Hc);if(!t)return null;let r=t.manager.tooltips.indexOf(e);return r<0?null:t.manager.tooltipViews[r]}const U2=pe.define(),xf=oe.define({combine(i){let e,t;for(let r of i)e=e||r.topContainer,t=t||r.bottomContainer;return{topContainer:e,bottomContainer:t}}});function zc(i,e){let t=i.plugin(fg),r=t?t.specs.indexOf(e):-1;return r>-1?t.panels[r]:null}const fg=ot.fromClass(class{constructor(i){this.input=i.state.facet(Bn),this.specs=this.input.filter(t=>t),this.panels=this.specs.map(t=>t(i));let e=i.state.facet(xf);this.top=new ks(i,!0,e.topContainer),this.bottom=new ks(i,!1,e.bottomContainer),this.top.sync(this.panels.filter(t=>t.top)),this.bottom.sync(this.panels.filter(t=>!t.top));for(let t of this.panels)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}update(i){let e=i.state.facet(xf);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new ks(i.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new ks(i.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let t=i.state.facet(Bn);if(t!=this.input){let r=t.filter(a=>a),n=[],s=[],l=[],o=[];for(let a of r){let c=this.specs.indexOf(a),h;c<0?(h=a(i.view),o.push(h)):(h=this.panels[c],h.update&&h.update(i)),n.push(h),(h.top?s:l).push(h)}this.specs=r,this.panels=n,this.top.sync(s),this.bottom.sync(l);for(let a of o)a.dom.classList.add("cm-panel"),a.mount&&a.mount()}else for(let r of this.panels)r.update&&r.update(i)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:i=>se.scrollMargins.of(e=>{let t=e.plugin(i);return t&&{top:t.top.scrollMargin(),bottom:t.bottom.scrollMargin()}})});class ks{constructor(e,t,r){this.view=e,this.top=t,this.container=r,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=Sf(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=Sf(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function Sf(i){let e=i.nextSibling;return i.remove(),e}const Bn=oe.define({enables:fg});function q2(i,e){let t,r=new Promise(l=>t=l),n=l=>K2(l,e,t);i.state.field(El,!1)?i.dispatch({effects:dg.of(n)}):i.dispatch({effects:pe.appendConfig.of(El.init(()=>[n]))});let s=pg.of(n);return{close:s,result:r.then(l=>((i.win.queueMicrotask||(a=>i.win.setTimeout(a,10)))(()=>{i.state.field(El).indexOf(n)>-1&&i.dispatch({effects:s})}),l))}}const El=tt.define({create(){return[]},update(i,e){for(let t of e.effects)t.is(dg)?i=[t.value].concat(i):t.is(pg)&&(i=i.filter(r=>r!=t.value));return i},provide:i=>Bn.computeN([i],e=>e.field(i))}),dg=pe.define(),pg=pe.define();function K2(i,e,t){let r=e.content?e.content(i,()=>l(null)):null;if(!r){if(r=Me("form"),e.input){let o=Me("input",e.input);/^(text|password|number|email|tel|url)$/.test(o.type)&&o.classList.add("cm-textfield"),o.name||(o.name="input"),r.appendChild(Me("label",(e.label||"")+": ",o))}else r.appendChild(document.createTextNode(e.label||""));r.appendChild(document.createTextNode(" ")),r.appendChild(Me("button",{class:"cm-button",type:"submit"},e.submitLabel||"OK"))}let n=r.nodeName=="FORM"?[r]:r.querySelectorAll("form");for(let o=0;o<n.length;o++){let a=n[o];a.addEventListener("keydown",c=>{c.keyCode==27?(c.preventDefault(),l(null)):c.keyCode==13&&(c.preventDefault(),l(a))}),a.addEventListener("submit",c=>{c.preventDefault(),l(a)})}let s=Me("div",r,Me("button",{onclick:()=>l(null),"aria-label":i.state.phrase("close"),class:"cm-dialog-close",type:"button"},["×"]));e.class&&(s.className=e.class),s.classList.add("cm-dialog");function l(o){s.contains(s.ownerDocument.activeElement)&&i.focus(),t(o)}return{dom:s,top:e.top,mount:()=>{if(e.focus){let o;typeof e.focus=="string"?o=r.querySelector(e.focus):o=r.querySelector("input")||r.querySelector("button"),o&&"select"in o?o.select():o&&"focus"in o&&o.focus()}}}}class Si extends Fi{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}Si.prototype.elementClass="";Si.prototype.toDOM=void 0;Si.prototype.mapMode=Ze.TrackBefore;Si.prototype.startSide=Si.prototype.endSide=-1;Si.prototype.point=!0;const $s=oe.define(),G2=oe.define(),X2={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>ye.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{},side:"before"},kn=oe.define();function J2(i){return[mg(),kn.of({...X2,...i})]}const wf=oe.define({combine:i=>i.some(e=>e)});function mg(i){return[Y2]}const Y2=ot.fromClass(class{constructor(i){this.view=i,this.domAfter=null,this.prevViewport=i.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters cm-gutters-before",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=i.state.facet(kn).map(e=>new kf(i,e)),this.fixed=!i.state.facet(wf);for(let e of this.gutters)e.config.side=="after"?this.getDOMAfter().appendChild(e.dom):this.dom.appendChild(e.dom);this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),i.scrollDOM.insertBefore(this.dom,i.contentDOM)}getDOMAfter(){return this.domAfter||(this.domAfter=document.createElement("div"),this.domAfter.className="cm-gutters cm-gutters-after",this.domAfter.setAttribute("aria-hidden","true"),this.domAfter.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.domAfter.style.position=this.fixed?"sticky":"",this.view.scrollDOM.appendChild(this.domAfter)),this.domAfter}update(i){if(this.updateGutters(i)){let e=this.prevViewport,t=i.view.viewport,r=Math.min(e.to,t.to)-Math.max(e.from,t.from);this.syncGutters(r<(t.to-t.from)*.8)}if(i.geometryChanged){let e=this.view.contentHeight/this.view.scaleY+"px";this.dom.style.minHeight=e,this.domAfter&&(this.domAfter.style.minHeight=e)}this.view.state.facet(wf)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":"",this.domAfter&&(this.domAfter.style.position=this.fixed?"sticky":"")),this.prevViewport=i.view.viewport}syncGutters(i){let e=this.dom.nextSibling;i&&(this.dom.remove(),this.domAfter&&this.domAfter.remove());let t=ye.iter(this.view.state.facet($s),this.view.viewport.from),r=[],n=this.gutters.map(s=>new Q2(s,this.view.viewport,-this.view.documentPadding.top));for(let s of this.view.viewportLineBlocks)if(r.length&&(r=[]),Array.isArray(s.type)){let l=!0;for(let o of s.type)if(o.type==Ct.Text&&l){Ba(t,r,o.from);for(let a of n)a.line(this.view,o,r);l=!1}else if(o.widget)for(let a of n)a.widget(this.view,o)}else if(s.type==Ct.Text){Ba(t,r,s.from);for(let l of n)l.line(this.view,s,r)}else if(s.widget)for(let l of n)l.widget(this.view,s);for(let s of n)s.finish();i&&(this.view.scrollDOM.insertBefore(this.dom,e),this.domAfter&&this.view.scrollDOM.appendChild(this.domAfter))}updateGutters(i){let e=i.startState.facet(kn),t=i.state.facet(kn),r=i.docChanged||i.heightChanged||i.viewportChanged||!ye.eq(i.startState.facet($s),i.state.facet($s),i.view.viewport.from,i.view.viewport.to);if(e==t)for(let n of this.gutters)n.update(i)&&(r=!0);else{r=!0;let n=[];for(let s of t){let l=e.indexOf(s);l<0?n.push(new kf(this.view,s)):(this.gutters[l].update(i),n.push(this.gutters[l]))}for(let s of this.gutters)s.dom.remove(),n.indexOf(s)<0&&s.destroy();for(let s of n)s.config.side=="after"?this.getDOMAfter().appendChild(s.dom):this.dom.appendChild(s.dom);this.gutters=n}return r}destroy(){for(let i of this.gutters)i.destroy();this.dom.remove(),this.domAfter&&this.domAfter.remove()}},{provide:i=>se.scrollMargins.of(e=>{let t=e.plugin(i);if(!t||t.gutters.length==0||!t.fixed)return null;let r=t.dom.offsetWidth*e.scaleX,n=t.domAfter?t.domAfter.offsetWidth*e.scaleX:0;return e.textDirection==He.LTR?{left:r,right:n}:{right:r,left:n}})});function Cf(i){return Array.isArray(i)?i:[i]}function Ba(i,e,t){for(;i.value&&i.from<=t;)i.from==t&&e.push(i.value),i.next()}class Q2{constructor(e,t,r){this.gutter=e,this.height=r,this.i=0,this.cursor=ye.iter(e.markers,t.from)}addElement(e,t,r){let{gutter:n}=this,s=(t.top-this.height)/e.scaleY,l=t.height/e.scaleY;if(this.i==n.elements.length){let o=new gg(e,l,s,r);n.elements.push(o),n.dom.appendChild(o.dom)}else n.elements[this.i].update(e,l,s,r);this.height=t.bottom,this.i++}line(e,t,r){let n=[];Ba(this.cursor,n,t.from),r.length&&(n=n.concat(r));let s=this.gutter.config.lineMarker(e,t,n);s&&n.unshift(s);let l=this.gutter;n.length==0&&!l.config.renderEmptyElements||this.addElement(e,t,n)}widget(e,t){let r=this.gutter.config.widgetMarker(e,t.widget,t),n=r?[r]:null;for(let s of e.state.facet(G2)){let l=s(e,t.widget,t);l&&(n||(n=[])).push(l)}n&&this.addElement(e,t,n)}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class kf{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let r in t.domEventHandlers)this.dom.addEventListener(r,n=>{let s=n.target,l;if(s!=this.dom&&this.dom.contains(s)){for(;s.parentNode!=this.dom;)s=s.parentNode;let a=s.getBoundingClientRect();l=(a.top+a.bottom)/2}else l=n.clientY;let o=e.lineBlockAtHeight(l-e.documentTop);t.domEventHandlers[r](e,o,n)&&n.preventDefault()});this.markers=Cf(t.markers(e)),t.initialSpacer&&(this.spacer=new gg(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=Cf(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let n=this.config.updateSpacer(this.spacer.markers[0],e);n!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[n])}let r=e.view.viewport;return!ye.eq(this.markers,t,r.from,r.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class gg{constructor(e,t,r,n){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,r,n)}update(e,t,r,n){this.height!=t&&(this.height=t,this.dom.style.height=t+"px"),this.above!=r&&(this.dom.style.marginTop=(this.above=r)?r+"px":""),Z2(this.markers,n)||this.setMarkers(e,n)}setMarkers(e,t){let r="cm-gutterElement",n=this.dom.firstChild;for(let s=0,l=0;;){let o=l,a=s<t.length?t[s++]:null,c=!1;if(a){let h=a.elementClass;h&&(r+=" "+h);for(let u=l;u<this.markers.length;u++)if(this.markers[u].compare(a)){o=u,c=!0;break}}else o=this.markers.length;for(;l<o;){let h=this.markers[l++];if(h.toDOM){h.destroy(n);let u=n.nextSibling;n.remove(),n=u}}if(!a)break;a.toDOM&&(c?n=n.nextSibling:this.dom.insertBefore(a.toDOM(e),n)),c&&l++}this.dom.className=r,this.markers=t}destroy(){this.setMarkers(null,[])}}function Z2(i,e){if(i.length!=e.length)return!1;for(let t=0;t<i.length;t++)if(!i[t].compare(e[t]))return!1;return!0}const eE=oe.define(),tE=oe.define(),Ar=oe.define({combine(i){return qi(i,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let r=Object.assign({},e);for(let n in t){let s=r[n],l=t[n];r[n]=s?(o,a,c)=>s(o,a,c)||l(o,a,c):l}return r}})}});class Al extends Si{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function Dl(i,e){return i.state.facet(Ar).formatNumber(e,i.state)}const iE=kn.compute([Ar],i=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(eE)},lineMarker(e,t,r){return r.some(n=>n.toDOM)?null:new Al(Dl(e,e.state.doc.lineAt(t.from).number))},widgetMarker:(e,t,r)=>{for(let n of e.state.facet(tE)){let s=n(e,t,r);if(s)return s}return null},lineMarkerChange:e=>e.startState.facet(Ar)!=e.state.facet(Ar),initialSpacer(e){return new Al(Dl(e,Ef(e.state.doc.lines)))},updateSpacer(e,t){let r=Dl(t.view,Ef(t.view.state.doc.lines));return r==e.number?e:new Al(r)},domEventHandlers:i.facet(Ar).domEventHandlers,side:"before"}));function rE(i={}){return[Ar.of(i),mg(),iE]}function Ef(i){let e=9;for(;e<i;)e=e*10+9;return e}const nE=new class extends Si{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},sE=$s.compute(["selection"],i=>{let e=[],t=-1;for(let r of i.selection.ranges){let n=i.doc.lineAt(r.head).from;n>t&&(t=n,e.push(nE.range(n)))}return ye.of(e)});function oE(){return sE}const lE=1024;let aE=0;class Ht{constructor(e,t){this.from=e,this.to=t}}class xe{constructor(e={}){this.id=aE++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")}),this.combine=e.combine||null}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=kt.match(e)),t=>{let r=e(t);return r===void 0?null:[this,r]}}}xe.closedBy=new xe({deserialize:i=>i.split(" ")});xe.openedBy=new xe({deserialize:i=>i.split(" ")});xe.group=new xe({deserialize:i=>i.split(" ")});xe.isolate=new xe({deserialize:i=>{if(i&&i!="rtl"&&i!="ltr"&&i!="auto")throw new RangeError("Invalid value for isolate: "+i);return i||"auto"}});xe.contextHash=new xe({perNode:!0});xe.lookAhead=new xe({perNode:!0});xe.mounted=new xe({perNode:!0});class Ir{constructor(e,t,r,n=!1){this.tree=e,this.overlay=t,this.parser=r,this.bracketed=n}static get(e){return e&&e.props&&e.props[xe.mounted.id]}}const cE=Object.create(null);class kt{constructor(e,t,r,n=0){this.name=e,this.props=t,this.id=r,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):cE,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),n=new kt(e.name||"",t,e.id,r);if(e.props){for(let s of e.props)if(Array.isArray(s)||(s=s(n)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[s[0].id]=s[1]}}return n}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(xe.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let r in e)for(let n of r.split(" "))t[n]=e[r];return r=>{for(let n=r.prop(xe.group),s=-1;s<(n?n.length:0);s++){let l=t[s<0?r.name:n[s]];if(l)return l}}}}kt.none=new kt("",Object.create(null),0,8);class vg{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let r of this.types){let n=null;for(let s of e){let l=s(r);if(l){n||(n=Object.assign({},r.props));let o=l[1],a=l[0];a.combine&&a.id in n&&(o=a.combine(n[a.id],o)),n[a.id]=o}}t.push(n?new kt(r.name,n,r.id,r.flags):r)}return new vg(t)}}const Es=new WeakMap,Af=new WeakMap;var Re;(function(i){i[i.ExcludeBuffers=1]="ExcludeBuffers",i[i.IncludeAnonymous=2]="IncludeAnonymous",i[i.IgnoreMounts=4]="IgnoreMounts",i[i.IgnoreOverlays=8]="IgnoreOverlays",i[i.EnterBracketed=16]="EnterBracketed"})(Re||(Re={}));class $e{constructor(e,t,r,n,s){if(this.type=e,this.children=t,this.positions=r,this.length=n,this.props=null,s&&s.length){this.props=Object.create(null);for(let[l,o]of s)this.props[typeof l=="number"?l:l.id]=o}}toString(){let e=Ir.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let r of this.children){let n=r.toString();n&&(t&&(t+=","),t+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new ao(this.topNode,e)}cursorAt(e,t=0,r=0){let n=Es.get(this)||this.topNode,s=new ao(n);return s.moveTo(e,t),Es.set(this,s._tree),s}get topNode(){return new st(this,0,0,null)}resolve(e,t=0){let r=On(Es.get(this)||this.topNode,e,t,!1);return Es.set(this,r),r}resolveInner(e,t=0){let r=On(Af.get(this)||this.topNode,e,t,!0);return Af.set(this,r),r}resolveStack(e,t=0){return fE(this,e,t)}iterate(e){let{enter:t,leave:r,from:n=0,to:s=this.length}=e,l=e.mode||0,o=(l&Re.IncludeAnonymous)>0;for(let a=this.cursor(l|Re.IncludeAnonymous);;){let c=!1;if(a.from<=s&&a.to>=n&&(!o&&a.type.isAnonymous||t(a)!==!1)){if(a.firstChild())continue;c=!0}for(;c&&r&&(o||!a.type.isAnonymous)&&r(a),!a.nextSibling();){if(!a.parent())return;c=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:Vc(kt.none,this.children,this.positions,0,this.children.length,0,this.length,(t,r,n)=>new $e(this.type,t,r,n,this.propValues),e.makeTree||((t,r,n)=>new $e(kt.none,t,r,n)))}static build(e){return dE(e)}}$e.empty=new $e(kt.none,[],[],0);class Wc{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Wc(this.buffer,this.index)}}class $i{constructor(e,t,r){this.buffer=e,this.length=t,this.set=r}get type(){return kt.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],r=this.buffer[e+3],n=this.set.types[t],s=n.name;if(/\W/.test(s)&&!n.isError&&(s=JSON.stringify(s)),e+=4,r==e)return s;let l=[];for(;e<r;)l.push(this.childString(e)),e=this.buffer[e+3];return s+"("+l.join(",")+")"}findChild(e,t,r,n,s){let{buffer:l}=this,o=-1;for(let a=e;a!=t&&!(_g(s,n,l[a+1],l[a+2])&&(o=a,r>0));a=l[a+3]);return o}slice(e,t,r){let n=this.buffer,s=new Uint16Array(t-e),l=0;for(let o=e,a=0;o<t;){s[a++]=n[o++],s[a++]=n[o++]-r;let c=s[a++]=n[o++]-r;s[a++]=n[o++]-e,l=Math.max(l,c)}return new $i(s,l,this.set)}}function _g(i,e,t,r){switch(i){case-2:return t<e;case-1:return r>=e&&t<e;case 0:return t<e&&r>e;case 1:return t<=e&&r>e;case 2:return r>e;case 4:return!0}}function On(i,e,t,r){for(var n;i.from==i.to||(t<1?i.from>=e:i.from>e)||(t>-1?i.to<=e:i.to<e);){let l=!r&&i instanceof st&&i.index<0?null:i.parent;if(!l)return i;i=l}let s=r?0:Re.IgnoreOverlays;if(r)for(let l=i,o=l.parent;o;l=o,o=l.parent)l instanceof st&&l.index<0&&((n=o.enter(e,t,s))===null||n===void 0?void 0:n.from)!=l.from&&(i=o);for(;;){let l=i.enter(e,t,s);if(!l)return i;i=l}}class yg{cursor(e=0){return new ao(this,e)}getChild(e,t=null,r=null){let n=Df(this,e,t,r);return n.length?n[0]:null}getChildren(e,t=null,r=null){return Df(this,e,t,r)}resolve(e,t=0){return On(this,e,t,!1)}resolveInner(e,t=0){return On(this,e,t,!0)}matchContext(e){return Oa(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),r=this;for(;t;){let n=t.lastChild;if(!n||n.to!=t.to)break;n.type.isError&&n.from==n.to?(r=t,t=n.prevSibling):t=n}return r}get node(){return this}get next(){return this.parent}}class st extends yg{constructor(e,t,r,n){super(),this._tree=e,this.from=t,this.index=r,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,r,n,s=0){for(let l=this;;){for(let{children:o,positions:a}=l._tree,c=t>0?o.length:-1;e!=c;e+=t){let h=o[e],u=a[e]+l.from,f;if(!(!(s&Re.EnterBracketed&&h instanceof $e&&(f=Ir.get(h))&&!f.overlay&&f.bracketed&&r>=u&&r<=u+h.length)&&!_g(n,r,u,u+h.length))){if(h instanceof $i){if(s&Re.ExcludeBuffers)continue;let d=h.findChild(0,h.buffer.length,t,r-u,n);if(d>-1)return new hi(new hE(l,h,e,u),null,d)}else if(s&Re.IncludeAnonymous||!h.type.isAnonymous||$c(h)){let d;if(!(s&Re.IgnoreMounts)&&(d=Ir.get(h))&&!d.overlay)return new st(d.tree,u,e,l);let y=new st(h,u,e,l);return s&Re.IncludeAnonymous||!y.type.isAnonymous?y:y.nextChild(t<0?h.children.length-1:0,t,r,n,s)}}}if(s&Re.IncludeAnonymous||!l.type.isAnonymous||(l.index>=0?e=l.index+t:e=t<0?-1:l._parent._tree.children.length,l=l._parent,!l))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}prop(e){return this._tree.prop(e)}enter(e,t,r=0){let n;if(!(r&Re.IgnoreOverlays)&&(n=Ir.get(this._tree))&&n.overlay){let s=e-this.from,l=r&Re.EnterBracketed&&n.bracketed;for(let{from:o,to:a}of n.overlay)if((t>0||l?o<=s:o<s)&&(t<0||l?a>=s:a>s))return new st(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function Df(i,e,t,r){let n=i.cursor(),s=[];if(!n.firstChild())return s;if(t!=null){for(let l=!1;!l;)if(l=n.type.is(t),!n.nextSibling())return s}for(;;){if(r!=null&&n.type.is(r))return s;if(n.type.is(e)&&s.push(n.node),!n.nextSibling())return r==null?s:[]}}function Oa(i,e,t=e.length-1){for(let r=i;t>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[t]&&e[t]!=r.name)return!1;t--}}return!0}class hE{constructor(e,t,r,n){this.parent=e,this.buffer=t,this.index=r,this.start=n}}class hi extends yg{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,r){super(),this.context=e,this._parent=t,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,t,r){let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,r);return s<0?null:new hi(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}prop(e){return this.type.prop(e)}enter(e,t,r=0){if(r&Re.ExcludeBuffers)return null;let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return s<0?null:new hi(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new hi(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new hi(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:r}=this.context,n=this.index+4,s=r.buffer[this.index+3];if(s>n){let l=r.buffer[this.index+1];e.push(r.slice(n,s,l)),t.push(0)}return new $e(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function bg(i){if(!i.length)return null;let e=0,t=i[0];for(let s=1;s<i.length;s++){let l=i[s];(l.from>t.from||l.to<t.to)&&(t=l,e=s)}let r=t instanceof st&&t.index<0?null:t.parent,n=i.slice();return r?n[e]=r:n.splice(e,1),new uE(n,t)}class uE{constructor(e,t){this.heads=e,this.node=t}get next(){return bg(this.heads)}}function fE(i,e,t){let r=i.resolveInner(e,t),n=null;for(let s=r instanceof st?r:r.context.parent;s;s=s.parent)if(s.index<0){let l=s.parent;(n||(n=[r])).push(l.resolve(e,t)),s=l}else{let l=Ir.get(s.tree);if(l&&l.overlay&&l.overlay[0].from<=e&&l.overlay[l.overlay.length-1].to>=e){let o=new st(l.tree,l.overlay[0].from+s.from,-1,s);(n||(n=[r])).push(On(o,e,t,!1))}}return n?bg(n):r}class ao{get name(){return this.type.name}constructor(e,t=0){if(this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,this.mode=t&~Re.EnterBracketed,e instanceof st)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:r,buffer:n}=this.buffer;return this.type=t||n.set.types[n.buffer[e]],this.from=r+n.buffer[e+1],this.to=r+n.buffer[e+2],!0}yield(e){return e?e instanceof st?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,r,this.mode));let{buffer:n}=this.buffer,s=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,r);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,r=this.mode){return this.buffer?r&Re.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&Re.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&Re.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,r=this.stack.length-1;if(e<0){let n=r<0?0:this.stack[r]+4;if(this.index!=n)return this.yieldBuf(t.findChild(n,this.index,-1,0,4))}else{let n=t.buffer[this.index+3];if(n<(r<0?t.buffer.length:t.buffer[this.stack[r]+3]))return this.yieldBuf(n)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,r,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(n.buffer.buffer[s+3]<this.index)return!1;({index:t,parent:r}=n)}else({index:t,_parent:r}=this._tree);for(;r;{index:t,_parent:r}=r)if(t>-1)for(let s=t+e,l=e<0?-1:r._tree.children.length;s!=l;s+=e){let o=r._tree.children[s];if(this.mode&Re.IncludeAnonymous||o instanceof $i||!o.type.isAnonymous||$c(o))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,r=0;if(e&&e.context==this.buffer)e:for(let n=this.index,s=this.stack.length;s>=0;){for(let l=e;l;l=l._parent)if(l.index==n){if(n==this.index)return l;t=l,r=s+1;break e}n=this.stack[--s]}for(let n=r;n<this.stack.length;n++)t=new hi(this.buffer,t,this.stack[n]);return this.bufferNode=new hi(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let r=0;;){let n=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){r++;continue}this.type.isAnonymous||(n=!0)}for(;;){if(n&&t&&t(this),n=this.type.isAnonymous,!r)return;if(this.nextSibling())break;this.parent(),r--,n=!0}}}matchContext(e){if(!this.buffer)return Oa(this.node.parent,e);let{buffer:t}=this.buffer,{types:r}=t.set;for(let n=e.length-1,s=this.stack.length-1;n>=0;s--){if(s<0)return Oa(this._tree,e,n);let l=r[t.buffer[this.stack[s]]];if(!l.isAnonymous){if(e[n]&&e[n]!=l.name)return!1;n--}}return!0}}function $c(i){return i.children.some(e=>e instanceof $i||!e.type.isAnonymous||$c(e))}function dE(i){var e;let{buffer:t,nodeSet:r,maxBufferLength:n=lE,reused:s=[],minRepeatType:l=r.types.length}=i,o=Array.isArray(t)?new Wc(t,t.length):t,a=r.types,c=0,h=0;function u(S,x,C,w,E,A){let{id:M,start:T,end:B,size:F}=o,j=h,z=c;if(F<0)if(o.next(),F==-1){let I=s[M];C.push(I),w.push(T-S);return}else if(F==-3){c=M;return}else if(F==-4){h=M;return}else throw new RangeError(`Unrecognized record size: ${F}`);let $=a[M],V,L,k=T-S;if(B-T<=n&&(L=m(o.pos-x,E))){let I=new Uint16Array(L.size-L.skip),H=o.pos-L.size,P=I.length;for(;o.pos>H;)P=p(L.start,I,P);V=new $i(I,B-L.start,r),k=L.start-S}else{let I=o.pos-F;o.next();let H=[],P=[],X=M>=l?M:-1,ee=0,re=B;for(;o.pos>I;)X>=0&&o.id==X&&o.size>=0?(o.end<=re-n&&(y(H,P,T,ee,o.end,re,X,j,z),ee=H.length,re=o.end),o.next()):A>2500?f(T,I,H,P):u(T,I,H,P,X,A+1);if(X>=0&&ee>0&&ee<H.length&&y(H,P,T,ee,T,re,X,j,z),H.reverse(),P.reverse(),X>-1&&ee>0){let O=d($,z);V=Vc($,H,P,0,H.length,0,B-T,O,O)}else V=_($,H,P,B-T,j-B,z)}C.push(V),w.push(k)}function f(S,x,C,w){let E=[],A=0,M=-1;for(;o.pos>x;){let{id:T,start:B,end:F,size:j}=o;if(j>4)o.next();else{if(M>-1&&B<M)break;M<0&&(M=F-n),E.push(T,B,F),A++,o.next()}}if(A){let T=new Uint16Array(A*4),B=E[E.length-2];for(let F=E.length-3,j=0;F>=0;F-=3)T[j++]=E[F],T[j++]=E[F+1]-B,T[j++]=E[F+2]-B,T[j++]=j;C.push(new $i(T,E[2]-B,r)),w.push(B-S)}}function d(S,x){return(C,w,E)=>{let A=0,M=C.length-1,T,B;if(M>=0&&(T=C[M])instanceof $e){if(!M&&T.type==S&&T.length==E)return T;(B=T.prop(xe.lookAhead))&&(A=w[M]+T.length+B)}return _(S,C,w,E,A,x)}}function y(S,x,C,w,E,A,M,T,B){let F=[],j=[];for(;S.length>w;)F.push(S.pop()),j.push(x.pop()+C-E);S.push(_(r.types[M],F,j,A-E,T-A,B)),x.push(E-C)}function _(S,x,C,w,E,A,M){if(A){let T=[xe.contextHash,A];M=M?[T].concat(M):[T]}if(E>25){let T=[xe.lookAhead,E];M=M?[T].concat(M):[T]}return new $e(S,x,C,w,M)}function m(S,x){let C=o.fork(),w=0,E=0,A=0,M=C.end-n,T={size:0,start:0,skip:0};e:for(let B=C.pos-S;C.pos>B;){let F=C.size;if(C.id==x&&F>=0){T.size=w,T.start=E,T.skip=A,A+=4,w+=4,C.next();continue}let j=C.pos-F;if(F<0||j<B||C.start<M)break;let z=C.id>=l?4:0,$=C.start;for(C.next();C.pos>j;){if(C.size<0)if(C.size==-3||C.size==-4)z+=4;else break e;else C.id>=l&&(z+=4);C.next()}E=$,w+=F,A+=z}return(x<0||w==S)&&(T.size=w,T.start=E,T.skip=A),T.size>4?T:void 0}function p(S,x,C){let{id:w,start:E,end:A,size:M}=o;if(o.next(),M>=0&&w<l){let T=C;if(M>4){let B=o.pos-(M-4);for(;o.pos>B;)C=p(S,x,C)}x[--C]=T,x[--C]=A-S,x[--C]=E-S,x[--C]=w}else M==-3?c=w:M==-4&&(h=w);return C}let g=[],v=[];for(;o.pos>0;)u(i.start||0,i.bufferStart||0,g,v,-1,0);let b=(e=i.length)!==null&&e!==void 0?e:g.length?v[0]+g[0].length:0;return new $e(a[i.topID],g.reverse(),v.reverse(),b)}const Lf=new WeakMap;function Vs(i,e){if(!i.isAnonymous||e instanceof $i||e.type!=i)return 1;let t=Lf.get(e);if(t==null){t=1;for(let r of e.children){if(r.type!=i||!(r instanceof $e)){t=1;break}t+=Vs(i,r)}Lf.set(e,t)}return t}function Vc(i,e,t,r,n,s,l,o,a){let c=0;for(let y=r;y<n;y++)c+=Vs(i,e[y]);let h=Math.ceil(c*1.5/8),u=[],f=[];function d(y,_,m,p,g){for(let v=m;v<p;){let b=v,S=_[v],x=Vs(i,y[v]);for(v++;v<p;v++){let C=Vs(i,y[v]);if(x+C>=h)break;x+=C}if(v==b+1){if(x>h){let C=y[b];d(C.children,C.positions,0,C.children.length,_[b]+g);continue}u.push(y[b])}else{let C=_[v-1]+y[v-1].length-S;u.push(Vc(i,y,_,b,v,S,C,null,a))}f.push(S+g-s)}}return d(e,t,r,n,0),(o||a)(u,f,l)}class XM{constructor(){this.map=new WeakMap}setBuffer(e,t,r){let n=this.map.get(e);n||this.map.set(e,n=new Map),n.set(t,r)}getBuffer(e,t){let r=this.map.get(e);return r&&r.get(t)}set(e,t){e instanceof hi?this.setBuffer(e.context.buffer,e.index,t):e instanceof st&&this.map.set(e.tree,t)}get(e){return e instanceof hi?this.getBuffer(e.context.buffer,e.index):e instanceof st?this.map.get(e.tree):void 0}cursorSet(e,t){e.buffer?this.setBuffer(e.buffer.buffer,e.index,t):this.map.set(e.tree,t)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}}class bi{constructor(e,t,r,n,s=!1,l=!1){this.from=e,this.to=t,this.tree=r,this.offset=n,this.open=(s?1:0)|(l?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],r=!1){let n=[new bi(0,e.length,e,0,!1,r)];for(let s of t)s.to>e.length&&n.push(s);return n}static applyChanges(e,t,r=128){if(!t.length)return e;let n=[],s=1,l=e.length?e[0]:null;for(let o=0,a=0,c=0;;o++){let h=o<t.length?t[o]:null,u=h?h.fromA:1e9;if(u-a>=r)for(;l&&l.from<u;){let f=l;if(a>=f.from||u<=f.to||c){let d=Math.max(f.from,a)-c,y=Math.min(f.to,u)-c;f=d>=y?null:new bi(d,y,f.tree,f.offset+c,o>0,!!h)}if(f&&n.push(f),l.to>u)break;l=s<e.length?e[s++]:null}if(!h)break;a=h.toA,c=h.toA-h.toB}return n}}class pE{startParse(e,t,r){return typeof e=="string"&&(e=new mE(e)),r=r?r.length?r.map(n=>new Ht(n.from,n.to)):[new Ht(0,0)]:[new Ht(0,e.length)],this.createParse(e,t||[],r)}parse(e,t,r){let n=this.startParse(e,t,r);for(;;){let s=n.advance();if(s)return s}}}class mE{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}function JM(i){return(e,t,r,n)=>new vE(e,i,t,r,n)}class Mf{constructor(e,t,r,n,s,l){this.parser=e,this.parse=t,this.overlay=r,this.bracketed=n,this.target=s,this.from=l}}function Tf(i){if(!i.length||i.some(e=>e.from>=e.to))throw new RangeError("Invalid inner parse ranges given: "+JSON.stringify(i))}class gE{constructor(e,t,r,n,s,l,o,a){this.parser=e,this.predicate=t,this.mounts=r,this.index=n,this.start=s,this.bracketed=l,this.target=o,this.prev=a,this.depth=0,this.ranges=[]}}const Ia=new xe({perNode:!0});class vE{constructor(e,t,r,n,s){this.nest=t,this.input=r,this.fragments=n,this.ranges=s,this.inner=[],this.innerDone=0,this.baseTree=null,this.stoppedAt=null,this.baseParse=e}advance(){if(this.baseParse){let r=this.baseParse.advance();if(!r)return null;if(this.baseParse=null,this.baseTree=r,this.startInner(),this.stoppedAt!=null)for(let n of this.inner)n.parse.stopAt(this.stoppedAt)}if(this.innerDone==this.inner.length){let r=this.baseTree;return this.stoppedAt!=null&&(r=new $e(r.type,r.children,r.positions,r.length,r.propValues.concat([[Ia,this.stoppedAt]]))),r}let e=this.inner[this.innerDone],t=e.parse.advance();if(t){this.innerDone++;let r=Object.assign(Object.create(null),e.target.props);r[xe.mounted.id]=new Ir(t,e.overlay,e.parser,e.bracketed),e.target.props=r}return null}get parsedPos(){if(this.baseParse)return 0;let e=this.input.length;for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].from<e&&(e=Math.min(e,this.inner[t].parse.parsedPos));return e}stopAt(e){if(this.stoppedAt=e,this.baseParse)this.baseParse.stopAt(e);else for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].parse.stopAt(e)}startInner(){let e=new bE(this.fragments),t=null,r=null,n=new ao(new st(this.baseTree,this.ranges[0].from,0,null),Re.IncludeAnonymous|Re.IgnoreMounts);e:for(let s,l;;){let o=!0,a;if(this.stoppedAt!=null&&n.from>=this.stoppedAt)o=!1;else if(e.hasNode(n)){if(t){let c=t.mounts.find(h=>h.frag.from<=n.from&&h.frag.to>=n.to&&h.mount.overlay);if(c)for(let h of c.mount.overlay){let u=h.from+c.pos,f=h.to+c.pos;u>=n.from&&f<=n.to&&!t.ranges.some(d=>d.from<f&&d.to>u)&&t.ranges.push({from:u,to:f})}}o=!1}else if(r&&(l=_E(r.ranges,n.from,n.to)))o=l!=2;else if(!n.type.isAnonymous&&(s=this.nest(n,this.input))&&(n.from<n.to||!s.overlay)){n.tree||(yE(n),t&&t.depth++,r&&r.depth++);let c=e.findMounts(n.from,s.parser);if(typeof s.overlay=="function")t=new gE(s.parser,s.overlay,c,this.inner.length,n.from,!!s.bracketed,n.tree,t);else{let h=Bf(this.ranges,s.overlay||(n.from<n.to?[new Ht(n.from,n.to)]:[]));h.length&&Tf(h),(h.length||!s.overlay)&&this.inner.push(new Mf(s.parser,h.length?s.parser.startParse(this.input,Of(c,h),h):s.parser.startParse(""),s.overlay?s.overlay.map(u=>new Ht(u.from-n.from,u.to-n.from)):null,!!s.bracketed,n.tree,h.length?h[0].from:n.from)),s.overlay?h.length&&(r={ranges:h,depth:0,prev:r}):o=!1}}else if(t&&(a=t.predicate(n))&&(a===!0&&(a=new Ht(n.from,n.to)),a.from<a.to)){let c=t.ranges.length-1;c>=0&&t.ranges[c].to==a.from?t.ranges[c]={from:t.ranges[c].from,to:a.to}:t.ranges.push(a)}if(o&&n.firstChild())t&&t.depth++,r&&r.depth++;else for(;!n.nextSibling();){if(!n.parent())break e;if(t&&!--t.depth){let c=Bf(this.ranges,t.ranges);c.length&&(Tf(c),this.inner.splice(t.index,0,new Mf(t.parser,t.parser.startParse(this.input,Of(t.mounts,c),c),t.ranges.map(h=>new Ht(h.from-t.start,h.to-t.start)),t.bracketed,t.target,c[0].from))),t=t.prev}r&&!--r.depth&&(r=r.prev)}}}}function _E(i,e,t){for(let r of i){if(r.from>=t)break;if(r.to>e)return r.from<=e&&r.to>=t?2:1}return 0}function Rf(i,e,t,r,n,s){if(e<t){let l=i.buffer[e+1];r.push(i.slice(e,t,l)),n.push(l-s)}}function yE(i){let{node:e}=i,t=[],r=e.context.buffer;do t.push(i.index),i.parent();while(!i.tree);let n=i.tree,s=n.children.indexOf(r),l=n.children[s],o=l.buffer,a=[s];function c(h,u,f,d,y,_){let m=t[_],p=[],g=[];Rf(l,h,m,p,g,d);let v=o[m+1],b=o[m+2];a.push(p.length);let S=_?c(m+4,o[m+3],l.set.types[o[m]],v,b-v,_-1):e.toTree();return p.push(S),g.push(v-d),Rf(l,o[m+3],u,p,g,d),new $e(f,p,g,y)}n.children[s]=c(0,o.length,kt.none,0,l.length,t.length-1);for(let h of a){let u=i.tree.children[h],f=i.tree.positions[h];i.yield(new st(u,f+i.from,h,i._tree))}}class Pf{constructor(e,t){this.offset=t,this.done=!1,this.cursor=e.cursor(Re.IncludeAnonymous|Re.IgnoreMounts)}moveTo(e){let{cursor:t}=this,r=e-this.offset;for(;!this.done&&t.from<r;)t.to>=e&&t.enter(r,1,Re.IgnoreOverlays|Re.ExcludeBuffers)||t.next(!1)||(this.done=!0)}hasNode(e){if(this.moveTo(e.from),!this.done&&this.cursor.from+this.offset==e.from&&this.cursor.tree)for(let t=this.cursor.tree;;){if(t==e.tree)return!0;if(t.children.length&&t.positions[0]==0&&t.children[0]instanceof $e)t=t.children[0];else break}return!1}}class bE{constructor(e){var t;if(this.fragments=e,this.curTo=0,this.fragI=0,e.length){let r=this.curFrag=e[0];this.curTo=(t=r.tree.prop(Ia))!==null&&t!==void 0?t:r.to,this.inner=new Pf(r.tree,-r.offset)}else this.curFrag=this.inner=null}hasNode(e){for(;this.curFrag&&e.from>=this.curTo;)this.nextFrag();return this.curFrag&&this.curFrag.from<=e.from&&this.curTo>=e.to&&this.inner.hasNode(e)}nextFrag(){var e;if(this.fragI++,this.fragI==this.fragments.length)this.curFrag=this.inner=null;else{let t=this.curFrag=this.fragments[this.fragI];this.curTo=(e=t.tree.prop(Ia))!==null&&e!==void 0?e:t.to,this.inner=new Pf(t.tree,-t.offset)}}findMounts(e,t){var r;let n=[];if(this.inner){this.inner.cursor.moveTo(e,1);for(let s=this.inner.cursor.node;s;s=s.parent){let l=(r=s.tree)===null||r===void 0?void 0:r.prop(xe.mounted);if(l&&l.parser==t)for(let o=this.fragI;o<this.fragments.length;o++){let a=this.fragments[o];if(a.from>=s.to)break;a.tree==this.curFrag.tree&&n.push({frag:a,pos:s.from-a.offset,mount:l})}}}return n}}function Bf(i,e){let t=null,r=e;for(let n=1,s=0;n<i.length;n++){let l=i[n-1].to,o=i[n].from;for(;s<r.length;s++){let a=r[s];if(a.from>=o)break;a.to<=l||(t||(r=t=e.slice()),a.from<l?(t[s]=new Ht(a.from,l),a.to>o&&t.splice(s+1,0,new Ht(o,a.to))):a.to>o?t[s--]=new Ht(o,a.to):t.splice(s--,1))}}return r}function xE(i,e,t,r){let n=0,s=0,l=!1,o=!1,a=-1e9,c=[];for(;;){let h=n==i.length?1e9:l?i[n].to:i[n].from,u=s==e.length?1e9:o?e[s].to:e[s].from;if(l!=o){let f=Math.max(a,t),d=Math.min(h,u,r);f<d&&c.push(new Ht(f,d))}if(a=Math.min(h,u),a==1e9)break;h==a&&(l?(l=!1,n++):l=!0),u==a&&(o?(o=!1,s++):o=!0)}return c}function Of(i,e){let t=[];for(let{pos:r,mount:n,frag:s}of i){let l=r+(n.overlay?n.overlay[0].from:0),o=l+n.tree.length,a=Math.max(s.from,l),c=Math.min(s.to,o);if(n.overlay){let h=n.overlay.map(f=>new Ht(f.from+r,f.to+r)),u=xE(e,h,a,c);for(let f=0,d=a;;f++){let y=f==u.length,_=y?c:u[f].from;if(_>d&&t.push(new bi(d,_,n.tree,-l,s.from>=d||s.openStart,s.to<=_||s.openEnd)),y)break;d=u[f].to}}else t.push(new bi(a,c,n.tree,-l,s.from>=l||s.openStart,s.to<=o||s.openEnd))}return t}let SE=0;class Nt{constructor(e,t,r,n){this.name=e,this.set=t,this.base=r,this.modified=n,this.id=SE++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let r=typeof e=="string"?e:"?";if(e instanceof Nt&&(t=e),t!=null&&t.base)throw new Error("Can not derive from a modified tag");let n=new Nt(r,[],null,[]);if(n.set.push(n),t)for(let s of t.set)n.set.push(s);return n}static defineModifier(e){let t=new co(e);return r=>r.modified.indexOf(t)>-1?r:co.get(r.base||r,r.modified.concat(t).sort((n,s)=>n.id-s.id))}}let wE=0;class co{constructor(e){this.name=e,this.instances=[],this.id=wE++}static get(e,t){if(!t.length)return e;let r=t[0].instances.find(o=>o.base==e&&CE(t,o.modified));if(r)return r;let n=[],s=new Nt(e.name,n,e,t);for(let o of t)o.instances.push(s);let l=kE(t);for(let o of e.set)if(!o.modified.length)for(let a of l)n.push(co.get(o,a));return s}}function CE(i,e){return i.length==e.length&&i.every((t,r)=>t==e[r])}function kE(i){let e=[[]];for(let t=0;t<i.length;t++)for(let r=0,n=e.length;r<n;r++)e.push(e[r].concat(i[t]));return e.sort((t,r)=>r.length-t.length)}function EE(i){let e=Object.create(null);for(let t in i){let r=i[t];Array.isArray(r)||(r=[r]);for(let n of t.split(" "))if(n){let s=[],l=2,o=n;for(let u=0;;){if(o=="..."&&u>0&&u+3==n.length){l=1;break}let f=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(o);if(!f)throw new RangeError("Invalid path: "+n);if(s.push(f[0]=="*"?"":f[0][0]=='"'?JSON.parse(f[0]):f[0]),u+=f[0].length,u==n.length)break;let d=n[u++];if(u==n.length&&d=="!"){l=0;break}if(d!="/")throw new RangeError("Invalid path: "+n);o=n.slice(u)}let a=s.length-1,c=s[a];if(!c)throw new RangeError("Invalid path: "+n);let h=new In(r,l,a>0?s.slice(0,a):null);e[c]=h.sort(e[c])}}return xg.add(e)}const xg=new xe({combine(i,e){let t,r,n;for(;i||e;){if(!i||e&&i.depth>=e.depth?(n=e,e=e.next):(n=i,i=i.next),t&&t.mode==n.mode&&!n.context&&!t.context)continue;let s=new In(n.tags,n.mode,n.context);t?t.next=s:r=s,t=s}return r}});class In{constructor(e,t,r,n){this.tags=e,this.mode=t,this.context=r,this.next=n}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}In.empty=new In([],2,null);function Sg(i,e){let t=Object.create(null);for(let s of i)if(!Array.isArray(s.tag))t[s.tag.id]=s.class;else for(let l of s.tag)t[l.id]=s.class;let{scope:r,all:n=null}=e||{};return{style:s=>{let l=n;for(let o of s)for(let a of o.set){let c=t[a.id];if(c){l=l?l+" "+c:c;break}}return l},scope:r}}function AE(i,e){let t=null;for(let r of i){let n=r.style(e);n&&(t=t?t+" "+n:n)}return t}function DE(i,e,t,r=0,n=i.length){let s=new LE(r,Array.isArray(e)?e:[e],t);s.highlightRange(i.cursor(),r,n,"",s.highlighters),s.flush(n)}class LE{constructor(e,t,r){this.at=e,this.highlighters=t,this.span=r,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,r,n,s){let{type:l,from:o,to:a}=e;if(o>=r||a<=t)return;l.isTop&&(s=this.highlighters.filter(d=>!d.scope||d.scope(l)));let c=n,h=ME(e)||In.empty,u=AE(s,h.tags);if(u&&(c&&(c+=" "),c+=u,h.mode==1&&(n+=(n?" ":"")+u)),this.startSpan(Math.max(t,o),c),h.opaque)return;let f=e.tree&&e.tree.prop(xe.mounted);if(f&&f.overlay){let d=e.node.enter(f.overlay[0].from+o,1),y=this.highlighters.filter(m=>!m.scope||m.scope(f.tree.type)),_=e.firstChild();for(let m=0,p=o;;m++){let g=m<f.overlay.length?f.overlay[m]:null,v=g?g.from+o:a,b=Math.max(t,p),S=Math.min(r,v);if(b<S&&_)for(;e.from<S&&(this.highlightRange(e,b,S,n,s),this.startSpan(Math.min(S,e.to),c),!(e.to>=v||!e.nextSibling())););if(!g||v>r)break;p=g.to+o,p>t&&(this.highlightRange(d.cursor(),Math.max(t,g.from+o),Math.min(r,p),"",y),this.startSpan(Math.min(r,p),c))}_&&e.parent()}else if(e.firstChild()){f&&(n="");do if(!(e.to<=t)){if(e.from>=r)break;this.highlightRange(e,t,r,n,s),this.startSpan(Math.min(r,e.to),c)}while(e.nextSibling());e.parent()}}}function ME(i){let e=i.type.prop(xg);for(;e&&e.context&&!i.matchContext(e.context);)e=e.next;return e||null}const ie=Nt.define,As=ie(),Mi=ie(),If=ie(Mi),Nf=ie(Mi),Ti=ie(),Ds=ie(Ti),Ll=ie(Ti),ni=ie(),er=ie(ni),ii=ie(),ri=ie(),Na=ie(),hn=ie(Na),Ls=ie(),q={comment:As,lineComment:ie(As),blockComment:ie(As),docComment:ie(As),name:Mi,variableName:ie(Mi),typeName:If,tagName:ie(If),propertyName:Nf,attributeName:ie(Nf),className:ie(Mi),labelName:ie(Mi),namespace:ie(Mi),macroName:ie(Mi),literal:Ti,string:Ds,docString:ie(Ds),character:ie(Ds),attributeValue:ie(Ds),number:Ll,integer:ie(Ll),float:ie(Ll),bool:ie(Ti),regexp:ie(Ti),escape:ie(Ti),color:ie(Ti),url:ie(Ti),keyword:ii,self:ie(ii),null:ie(ii),atom:ie(ii),unit:ie(ii),modifier:ie(ii),operatorKeyword:ie(ii),controlKeyword:ie(ii),definitionKeyword:ie(ii),moduleKeyword:ie(ii),operator:ri,derefOperator:ie(ri),arithmeticOperator:ie(ri),logicOperator:ie(ri),bitwiseOperator:ie(ri),compareOperator:ie(ri),updateOperator:ie(ri),definitionOperator:ie(ri),typeOperator:ie(ri),controlOperator:ie(ri),punctuation:Na,separator:ie(Na),bracket:hn,angleBracket:ie(hn),squareBracket:ie(hn),paren:ie(hn),brace:ie(hn),content:ni,heading:er,heading1:ie(er),heading2:ie(er),heading3:ie(er),heading4:ie(er),heading5:ie(er),heading6:ie(er),contentSeparator:ie(ni),list:ie(ni),quote:ie(ni),emphasis:ie(ni),strong:ie(ni),link:ie(ni),monospace:ie(ni),strikethrough:ie(ni),inserted:ie(),deleted:ie(),changed:ie(),invalid:ie(),meta:Ls,documentMeta:ie(Ls),annotation:ie(Ls),processingInstruction:ie(Ls),definition:Nt.defineModifier("definition"),constant:Nt.defineModifier("constant"),function:Nt.defineModifier("function"),standard:Nt.defineModifier("standard"),local:Nt.defineModifier("local"),special:Nt.defineModifier("special")};for(let i in q){let e=q[i];e instanceof Nt&&(e.name=i)}Sg([{tag:q.link,class:"tok-link"},{tag:q.heading,class:"tok-heading"},{tag:q.emphasis,class:"tok-emphasis"},{tag:q.strong,class:"tok-strong"},{tag:q.keyword,class:"tok-keyword"},{tag:q.atom,class:"tok-atom"},{tag:q.bool,class:"tok-bool"},{tag:q.url,class:"tok-url"},{tag:q.labelName,class:"tok-labelName"},{tag:q.inserted,class:"tok-inserted"},{tag:q.deleted,class:"tok-deleted"},{tag:q.literal,class:"tok-literal"},{tag:q.string,class:"tok-string"},{tag:q.number,class:"tok-number"},{tag:[q.regexp,q.escape,q.special(q.string)],class:"tok-string2"},{tag:q.variableName,class:"tok-variableName"},{tag:q.local(q.variableName),class:"tok-variableName tok-local"},{tag:q.definition(q.variableName),class:"tok-variableName tok-definition"},{tag:q.special(q.variableName),class:"tok-variableName2"},{tag:q.definition(q.propertyName),class:"tok-propertyName tok-definition"},{tag:q.typeName,class:"tok-typeName"},{tag:q.namespace,class:"tok-namespace"},{tag:q.className,class:"tok-className"},{tag:q.macroName,class:"tok-macroName"},{tag:q.propertyName,class:"tok-propertyName"},{tag:q.operator,class:"tok-operator"},{tag:q.comment,class:"tok-comment"},{tag:q.meta,class:"tok-meta"},{tag:q.invalid,class:"tok-invalid"},{tag:q.punctuation,class:"tok-punctuation"}]);var Ml;const Dr=new xe;function TE(i){return oe.define({combine:i?e=>e.concat(i):void 0})}const RE=new xe;class Gt{constructor(e,t,r=[],n=""){this.data=e,this.name=n,ke.prototype.hasOwnProperty("tree")||Object.defineProperty(ke.prototype,"tree",{get(){return et(this)}}),this.parser=t,this.extension=[Vi.of(this),ke.languageData.of((s,l,o)=>{let a=Ff(s,l,o),c=a.type.prop(Dr);if(!c)return[];let h=s.facet(c),u=a.type.prop(RE);if(u){let f=a.resolve(l-a.from,o);for(let d of u)if(d.test(f,s)){let y=s.facet(d.facet);return d.type=="replace"?y:y.concat(h)}}return h})].concat(r)}isActiveAt(e,t,r=-1){return Ff(e,t,r).type.prop(Dr)==this.data}findRegions(e){let t=e.facet(Vi);if((t==null?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let r=[],n=(s,l)=>{if(s.prop(Dr)==this.data){r.push({from:l,to:l+s.length});return}let o=s.prop(xe.mounted);if(o){if(o.tree.prop(Dr)==this.data){if(o.overlay)for(let a of o.overlay)r.push({from:a.from+l,to:a.to+l});else r.push({from:l,to:l+s.length});return}else if(o.overlay){let a=r.length;if(n(o.tree,o.overlay[0].from+l),r.length>a)return}}for(let a=0;a<s.children.length;a++){let c=s.children[a];c instanceof $e&&n(c,s.positions[a]+l)}};return n(et(e),0),r}get allowsNesting(){return!0}}Gt.setState=pe.define();function Ff(i,e,t){let r=i.facet(Vi),n=et(i).topNode;if(!r||r.allowsNesting)for(let s=n;s;s=s.enter(e,t,Re.ExcludeBuffers|Re.EnterBracketed))s.type.isTop&&(n=s);return n}class Fa extends Gt{constructor(e,t,r){super(e,t,[],r),this.parser=t}static define(e){let t=TE(e.languageData);return new Fa(t,e.parser.configure({props:[Dr.add(r=>r.isTop?t:void 0)]}),e.name)}configure(e,t){return new Fa(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function et(i){let e=i.field(Gt.state,!1);return e?e.tree:$e.empty}class PE{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let r=this.cursorPos-this.string.length;return e<r||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-r,t-r)}}let un=null;class ho{constructor(e,t,r=[],n,s,l,o,a){this.parser=e,this.state=t,this.fragments=r,this.tree=n,this.treeLen=s,this.viewport=l,this.skipped=o,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(e,t,r){return new ho(e,t,[],$e.empty,0,r,[],null)}startParse(){return this.parser.startParse(new PE(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=$e.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var r;if(typeof e=="number"){let n=Date.now()+e;e=()=>Date.now()>n}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let n=this.parse.advance();if(n)if(this.fragments=this.withoutTempSkipped(bi.addTree(n,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(r=this.parse.stoppedAt)!==null&&r!==void 0?r:this.state.doc.length,this.tree=n,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(bi.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=un;un=this;try{return e()}finally{un=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=Hf(e,t.from,t.to);return e}changes(e,t){let{fragments:r,tree:n,treeLen:s,viewport:l,skipped:o}=this;if(this.takeTree(),!e.empty){let a=[];if(e.iterChangedRanges((c,h,u,f)=>a.push({fromA:c,toA:h,fromB:u,toB:f})),r=bi.applyChanges(r,a),n=$e.empty,s=0,l={from:e.mapPos(l.from,-1),to:e.mapPos(l.to,1)},this.skipped.length){o=[];for(let c of this.skipped){let h=e.mapPos(c.from,1),u=e.mapPos(c.to,-1);h<u&&o.push({from:h,to:u})}}}return new ho(this.parser,t,r,n,s,l,o,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let r=0;r<this.skipped.length;r++){let{from:n,to:s}=this.skipped[r];n<e.to&&s>e.from&&(this.fragments=Hf(this.fragments,n,s),this.skipped.splice(r--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends pE{createParse(t,r,n){let s=n[0].from,l=n[n.length-1].to;return{parsedPos:s,advance(){let a=un;if(a){for(let c of n)a.tempSkipped.push(c);e&&(a.scheduleOn=a.scheduleOn?Promise.all([a.scheduleOn,e]):e)}return this.parsedPos=l,new $e(kt.none,[],[],l-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return un}}function Hf(i,e,t){return bi.applyChanges(i,[{fromA:e,toA:t,fromB:e,toB:t}])}class qr{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,r)||t.takeTree(),new qr(t)}static init(e){let t=Math.min(3e3,e.doc.length),r=ho.create(e.facet(Vi).parser,e,{from:0,to:t});return r.work(20,t)||r.takeTree(),new qr(r)}}Gt.state=tt.define({create:qr.init,update(i,e){for(let t of e.effects)if(t.is(Gt.setState))return t.value;return e.startState.facet(Vi)!=e.state.facet(Vi)?qr.init(e.state):i.apply(e)}});let wg=i=>{let e=setTimeout(()=>i(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(wg=i=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(i,{timeout:400})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const Tl=typeof navigator<"u"&&(!((Ml=navigator.scheduling)===null||Ml===void 0)&&Ml.isInputPending)?()=>navigator.scheduling.isInputPending():null,BE=ot.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(Gt.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(Gt.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=wg(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:n}}=this.view,s=r.field(Gt.state);if(s.tree==s.context.tree&&s.context.isDone(n+1e5))return;let l=Date.now()+Math.min(this.chunkBudget,100,e&&!Tl?Math.max(25,e.timeRemaining()-5):1e9),o=s.context.treeLen<n&&r.doc.length>n+1e3,a=s.context.work(()=>Tl&&Tl()||Date.now()>l,n+(o?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:Gt.setState.of(new qr(s.context))})),this.chunkBudget>0&&!(a&&!o)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>St(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Vi=oe.define({combine(i){return i.length?i[0]:null},enables:i=>[Gt.state,BE,se.contentAttributes.compute([i],e=>{let t=e.facet(i);return t&&t.name?{"data-language":t.name}:{}})]});class QM{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}class Cg{constructor(e,t,r,n,s,l=void 0){this.name=e,this.alias=t,this.extensions=r,this.filename=n,this.loadFunc=s,this.support=l,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then(e=>this.support=e,e=>{throw this.loading=null,e}))}static of(e){let{load:t,support:r}=e;if(!t){if(!r)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");t=()=>Promise.resolve(r)}return new Cg(e.name,(e.alias||[]).concat(e.name).map(n=>n.toLowerCase()),e.extensions||[],e.filename,t,r)}static matchFilename(e,t){for(let n of e)if(n.filename&&n.filename.test(t))return n;let r=/\.([^.]+)$/.exec(t);if(r){for(let n of e)if(n.extensions.indexOf(r[1])>-1)return n}return null}static matchLanguageName(e,t,r=!0){t=t.toLowerCase();for(let n of e)if(n.alias.some(s=>s==t))return n;if(r)for(let n of e)for(let s of n.alias){let l=t.indexOf(s);if(l>-1&&(s.length>2||!/\w/.test(t[l-1])&&!/\w/.test(t[l+s.length])))return n}return null}}const OE=oe.define(),No=oe.define({combine:i=>{if(!i.length)return"  ";let e=i[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(i[0]));return e}});function uo(i){let e=i.facet(No);return e.charCodeAt(0)==9?i.tabSize*e.length:e.length}function Nn(i,e){let t="",r=i.tabSize,n=i.facet(No)[0];if(n=="	"){for(;e>=r;)t+="	",e-=r;n=" "}for(let s=0;s<e;s++)t+=n;return t}function Uc(i,e){i instanceof ke&&(i=new Fo(i));for(let r of i.state.facet(OE)){let n=r(i,e);if(n!==void 0)return n}let t=et(i.state);return t.length>=e?NE(i,t,e):null}class Fo{constructor(e,t={}){this.state=e,this.options=t,this.unit=uo(e)}lineAt(e,t=1){let r=this.state.doc.lineAt(e),{simulateBreak:n,simulateDoubleBreak:s}=this.options;return n!=null&&n>=r.from&&n<=r.to?s&&n==e?{text:"",from:e}:(t<0?n<e:n<=e)?{text:r.text.slice(n-r.from),from:n}:{text:r.text.slice(0,n-r.from),from:r.from}:r}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:n}=this.lineAt(e,t);return r.slice(e-n,Math.min(r.length,e+100-n))}column(e,t=1){let{text:r,from:n}=this.lineAt(e,t),s=this.countColumn(r,e-n),l=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return l>-1&&(s+=l-this.countColumn(r,r.search(/\S|$/))),s}countColumn(e,t=e.length){return Lo(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:r,from:n}=this.lineAt(e,t),s=this.options.overrideIndentation;if(s){let l=s(n);if(l>-1)return l}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const IE=new xe;function NE(i,e,t){let r=e.resolveStack(t),n=e.resolveInner(t,-1).resolve(t,0).enterUnfinishedNodesBefore(t);if(n!=r.node){let s=[];for(let l=n;l&&!(l.from<r.node.from||l.to>r.node.to||l.from==r.node.from&&l.type==r.node.type);l=l.parent)s.push(l);for(let l=s.length-1;l>=0;l--)r={node:s[l],next:r}}return kg(r,i,t)}function kg(i,e,t){for(let r=i;r;r=r.next){let n=HE(r.node);if(n)return n(qc.create(e,t,r))}return 0}function FE(i){return i.pos==i.options.simulateBreak&&i.options.simulateDoubleBreak}function HE(i){let e=i.type.prop(IE);if(e)return e;let t=i.firstChild,r;if(t&&(r=t.type.prop(xe.closedBy))){let n=i.lastChild,s=n&&r.indexOf(n.name)>-1;return l=>Eg(l,!0,1,void 0,s&&!FE(l)?n.from:void 0)}return i.parent==null?jE:null}function jE(){return 0}class qc extends Fo{constructor(e,t,r){super(e.state,e.options),this.base=e,this.pos=t,this.context=r}get node(){return this.context.node}static create(e,t,r){return new qc(e,t,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let r=e.resolve(t.from);for(;r.parent&&r.parent.from==r.from;)r=r.parent;if(zE(r,e))break;t=this.state.doc.lineAt(r.from)}return this.lineIndent(t.from)}continue(){return kg(this.context.next,this.base,this.pos)}}function zE(i,e){for(let t=e;t;t=t.parent)if(i==t)return!0;return!1}function WE(i){let e=i.node,t=e.childAfter(e.from),r=e.lastChild;if(!t)return null;let n=i.options.simulateBreak,s=i.state.doc.lineAt(t.from),l=n==null||n<=s.from?s.to:Math.min(s.to,n);for(let o=t.to;;){let a=e.childAfter(o);if(!a||a==r)return null;if(!a.type.isSkipped){if(a.from>=l)return null;let c=/^ */.exec(s.text.slice(t.to-s.from))[0].length;return{from:t.from,to:t.to+c}}o=a.to}}function ZM({closing:i,align:e=!0,units:t=1}){return r=>Eg(r,e,t,i)}function Eg(i,e,t,r,n){let s=i.textAfter,l=s.match(/^\s*/)[0].length,o=r&&s.slice(l,l+r.length)==r||n==i.pos+l,a=e?WE(i):null;return a?o?i.column(a.from):i.column(a.to):i.baseIndent+(o?0:i.unit*t)}const eT=i=>i.baseIndent;function tT({except:i,units:e=1}={}){return t=>{let r=i&&i.test(t.textAfter);return t.baseIndent+(r?0:e*t.unit)}}const $E=200;function VE(){return ke.transactionFilter.of(i=>{if(!i.docChanged||!i.isUserEvent("input.type")&&!i.isUserEvent("input.complete"))return i;let e=i.startState.languageDataAt("indentOnInput",i.startState.selection.main.head);if(!e.length)return i;let t=i.newDoc,{head:r}=i.newSelection.main,n=t.lineAt(r);if(r>n.from+$E)return i;let s=t.sliceString(n.from,r);if(!e.some(c=>c.test(s)))return i;let{state:l}=i,o=-1,a=[];for(let{head:c}of l.selection.ranges){let h=l.doc.lineAt(c);if(h.from==o)continue;o=h.from;let u=Uc(l,h.from);if(u==null)continue;let f=/^\s*/.exec(h.text)[0],d=Nn(l,u);f!=d&&a.push({from:h.from,to:h.from+f.length,insert:d})}return a.length?[i,{changes:a,sequential:!0}]:i})}const UE=oe.define(),qE=new xe;function iT(i){let e=i.firstChild,t=i.lastChild;return e&&e.to<t.from?{from:e.to,to:t.type.isError?i.to:t.from}:null}function KE(i,e,t){let r=et(i);if(r.length<t)return null;let n=r.resolveStack(t,1),s=null;for(let l=n;l;l=l.next){let o=l.node;if(o.to<=t||o.from>t)continue;if(s&&o.from<e)break;let a=o.type.prop(qE);if(a&&(o.to<r.length-50||r.length==i.doc.length||!GE(o))){let c=a(o,i);c&&c.from<=t&&c.from>=e&&c.to>t&&(s=c)}}return s}function GE(i){let e=i.lastChild;return e&&e.to==i.to&&e.type.isError}function jf(i,e,t){for(let r of i.facet(UE)){let n=r(i,e,t);if(n)return n}return KE(i,e,t)}function Ag(i,e){let t=e.mapPos(i.from,1),r=e.mapPos(i.to,-1);return t>=r?void 0:{from:t,to:r}}const Dg=pe.define({map:Ag}),Kc=pe.define({map:Ag}),fo=tt.define({create(){return he.none},update(i,e){e.isUserEvent("delete")&&e.changes.iterChangedRanges((t,r)=>i=zf(i,t,r)),i=i.map(e.changes);for(let t of e.effects)if(t.is(Dg)&&!XE(i,t.value.from,t.value.to)){let{preparePlaceholder:r}=e.state.facet(Lg),n=r?he.replace({widget:new QE(r(e.state,t.value))}):Wf;i=i.update({add:[n.range(t.value.from,t.value.to)]})}else t.is(Kc)&&(i=i.update({filter:(r,n)=>t.value.from!=r||t.value.to!=n,filterFrom:t.value.from,filterTo:t.value.to}));return e.selection&&(i=zf(i,e.selection.main.head)),i},provide:i=>se.decorations.from(i),toJSON(i,e){let t=[];return i.between(0,e.doc.length,(r,n)=>{t.push(r,n)}),t},fromJSON(i){if(!Array.isArray(i)||i.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let t=0;t<i.length;){let r=i[t++],n=i[t++];if(typeof r!="number"||typeof n!="number")throw new RangeError("Invalid JSON for fold state");e.push(Wf.range(r,n))}return he.set(e,!0)}});function zf(i,e,t=e){let r=!1;return i.between(e,t,(n,s)=>{n<t&&s>e&&(r=!0)}),r?i.update({filterFrom:e,filterTo:t,filter:(n,s)=>n>=t||s<=e}):i}function Ha(i,e,t){var r;let n=null;return(r=i.field(fo,!1))===null||r===void 0||r.between(e,t,(s,l)=>{(!n||n.from>s)&&(n={from:s,to:l})}),n}function XE(i,e,t){let r=!1;return i.between(e,e,(n,s)=>{n==e&&s==t&&(r=!0)}),r}const JE={placeholderDOM:null,preparePlaceholder:null,placeholderText:"…"},Lg=oe.define({combine(i){return qi(i,JE)}});function YE(i){return[fo,tA]}function Mg(i,e){let{state:t}=i,r=t.facet(Lg),n=l=>{let o=i.lineBlockAt(i.posAtDOM(l.target)),a=Ha(i.state,o.from,o.to);a&&i.dispatch({effects:Kc.of(a)}),l.preventDefault()};if(r.placeholderDOM)return r.placeholderDOM(i,n,e);let s=document.createElement("span");return s.textContent=r.placeholderText,s.setAttribute("aria-label",t.phrase("folded code")),s.title=t.phrase("unfold"),s.className="cm-foldPlaceholder",s.onclick=n,s}const Wf=he.replace({widget:new class extends Ki{toDOM(i){return Mg(i,null)}}});class QE extends Ki{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return Mg(e,this.value)}}const ZE={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class Rl extends Si{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function eA(i={}){let e={...ZE,...i},t=new Rl(e,!0),r=new Rl(e,!1),n=ot.fromClass(class{constructor(l){this.from=l.viewport.from,this.markers=this.buildMarkers(l)}update(l){(l.docChanged||l.viewportChanged||l.startState.facet(Vi)!=l.state.facet(Vi)||l.startState.field(fo,!1)!=l.state.field(fo,!1)||et(l.startState)!=et(l.state)||e.foldingChanged(l))&&(this.markers=this.buildMarkers(l.view))}buildMarkers(l){let o=new Hi;for(let a of l.viewportLineBlocks){let c=Ha(l.state,a.from,a.to)?r:jf(l.state,a.from,a.to)?t:null;c&&o.add(a.from,a.from,c)}return o.finish()}}),{domEventHandlers:s}=e;return[n,J2({class:"cm-foldGutter",markers(l){var o;return((o=l.plugin(n))===null||o===void 0?void 0:o.markers)||ye.empty},initialSpacer(){return new Rl(e,!1)},domEventHandlers:{...s,click:(l,o,a)=>{if(s.click&&s.click(l,o,a))return!0;let c=Ha(l.state,o.from,o.to);if(c)return l.dispatch({effects:Kc.of(c)}),!0;let h=jf(l.state,o.from,o.to);return h?(l.dispatch({effects:Dg.of(h)}),!0):!1}}}),YE()]}const tA=se.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class es{constructor(e,t){this.specs=e;let r;function n(o){let a=ji.newName();return(r||(r=Object.create(null)))["."+a]=o,a}const s=typeof t.all=="string"?t.all:t.all?n(t.all):void 0,l=t.scope;this.scope=l instanceof Gt?o=>o.prop(Dr)==l.data:l?o=>o==l:void 0,this.style=Sg(e.map(o=>({tag:o.tag,class:o.class||n(Object.assign({},o,{tag:null}))})),{all:s}).style,this.module=r?new ji(r):null,this.themeType=t.themeType}static define(e,t){return new es(e,t||{})}}const ja=oe.define(),Tg=oe.define({combine(i){return i.length?[i[0]]:null}});function Pl(i){let e=i.facet(ja);return e.length?e:i.facet(Tg)}function Rg(i,e){let t=[rA],r;return i instanceof es&&(i.module&&t.push(se.styleModule.of(i.module)),r=i.themeType),e!=null&&e.fallback?t.push(Tg.of(i)):r?t.push(ja.computeN([se.darkTheme],n=>n.facet(se.darkTheme)==(r=="dark")?[i]:[])):t.push(ja.of(i)),t}class iA{constructor(e){this.markCache=Object.create(null),this.tree=et(e.state),this.decorations=this.buildDeco(e,Pl(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=et(e.state),r=Pl(e.state),n=r!=Pl(e.startState),{viewport:s}=e.view,l=e.changes.mapPos(this.decoratedTo,1);t.length<s.to&&!n&&t.type==this.tree.type&&l>=s.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=l):(t!=this.tree||e.viewportChanged||n)&&(this.tree=t,this.decorations=this.buildDeco(e.view,r),this.decoratedTo=s.to)}buildDeco(e,t){if(!t||!this.tree.length)return he.none;let r=new Hi;for(let{from:n,to:s}of e.visibleRanges)DE(this.tree,t,(l,o,a)=>{r.add(l,o,this.markCache[a]||(this.markCache[a]=he.mark({class:a})))},n,s);return r.finish()}}const rA=vr.high(ot.fromClass(iA,{decorations:i=>i.decorations})),nA=es.define([{tag:q.meta,color:"#404740"},{tag:q.link,textDecoration:"underline"},{tag:q.heading,textDecoration:"underline",fontWeight:"bold"},{tag:q.emphasis,fontStyle:"italic"},{tag:q.strong,fontWeight:"bold"},{tag:q.strikethrough,textDecoration:"line-through"},{tag:q.keyword,color:"#708"},{tag:[q.atom,q.bool,q.url,q.contentSeparator,q.labelName],color:"#219"},{tag:[q.literal,q.inserted],color:"#164"},{tag:[q.string,q.deleted],color:"#a11"},{tag:[q.regexp,q.escape,q.special(q.string)],color:"#e40"},{tag:q.definition(q.variableName),color:"#00f"},{tag:q.local(q.variableName),color:"#30a"},{tag:[q.typeName,q.namespace],color:"#085"},{tag:q.className,color:"#167"},{tag:[q.special(q.variableName),q.macroName],color:"#256"},{tag:q.definition(q.propertyName),color:"#00c"},{tag:q.comment,color:"#940"},{tag:q.invalid,color:"#f00"}]),sA=se.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),Pg=1e4,Bg="()[]{}",Og=oe.define({combine(i){return qi(i,{afterCursor:!0,brackets:Bg,maxScanDistance:Pg,renderMatch:aA})}}),oA=he.mark({class:"cm-matchingBracket"}),lA=he.mark({class:"cm-nonmatchingBracket"});function aA(i){let e=[],t=i.matched?oA:lA;return e.push(t.range(i.start.from,i.start.to)),i.end&&e.push(t.range(i.end.from,i.end.to)),e}const cA=tt.define({create(){return he.none},update(i,e){if(!e.docChanged&&!e.selection)return i;let t=[],r=e.state.facet(Og);for(let n of e.state.selection.ranges){if(!n.empty)continue;let s=ui(e.state,n.head,-1,r)||n.head>0&&ui(e.state,n.head-1,1,r)||r.afterCursor&&(ui(e.state,n.head,1,r)||n.head<e.state.doc.length&&ui(e.state,n.head+1,-1,r));s&&(t=t.concat(r.renderMatch(s,e.state)))}return he.set(t,!0)},provide:i=>se.decorations.from(i)}),hA=[cA,sA];function uA(i={}){return[Og.of(i),hA]}const fA=new xe;function za(i,e,t){let r=i.prop(e<0?xe.openedBy:xe.closedBy);if(r)return r;if(i.name.length==1){let n=t.indexOf(i.name);if(n>-1&&n%2==(e<0?1:0))return[t[n+e]]}return null}function Wa(i){let e=i.type.prop(fA);return e?e(i.node):i}function ui(i,e,t,r={}){let n=r.maxScanDistance||Pg,s=r.brackets||Bg,l=et(i),o=l.resolveInner(e,t);for(let a=o;a;a=a.parent){let c=za(a.type,t,s);if(c&&a.from<a.to){let h=Wa(a);if(h&&(t>0?e>=h.from&&e<h.to:e>h.from&&e<=h.to))return dA(i,e,t,a,h,c,s)}}return pA(i,e,t,l,o.type,n,s)}function dA(i,e,t,r,n,s,l){let o=r.parent,a={from:n.from,to:n.to},c=0,h=o==null?void 0:o.cursor();if(h&&(t<0?h.childBefore(r.from):h.childAfter(r.to)))do if(t<0?h.to<=r.from:h.from>=r.to){if(c==0&&s.indexOf(h.type.name)>-1&&h.from<h.to){let u=Wa(h);return{start:a,end:u?{from:u.from,to:u.to}:void 0,matched:!0}}else if(za(h.type,t,l))c++;else if(za(h.type,-t,l)){if(c==0){let u=Wa(h);return{start:a,end:u&&u.from<u.to?{from:u.from,to:u.to}:void 0,matched:!1}}c--}}while(t<0?h.prevSibling():h.nextSibling());return{start:a,matched:!1}}function pA(i,e,t,r,n,s,l){let o=t<0?i.sliceDoc(e-1,e):i.sliceDoc(e,e+1),a=l.indexOf(o);if(a<0||a%2==0!=t>0)return null;let c={from:t<0?e-1:e,to:t>0?e+1:e},h=i.doc.iterRange(e,t>0?i.doc.length:0),u=0;for(let f=0;!h.next().done&&f<=s;){let d=h.value;t<0&&(f+=d.length);let y=e+f*t;for(let _=t>0?0:d.length-1,m=t>0?d.length:-1;_!=m;_+=t){let p=l.indexOf(d[_]);if(!(p<0||r.resolveInner(y+_,1).type!=n))if(p%2==0==t>0)u++;else{if(u==1)return{start:c,end:{from:y+_,to:y+_+1},matched:p>>1==a>>1};u--}}t>0&&(f+=d.length)}return h.done?{start:c,matched:!1}:null}const mA=Object.create(null),$f=[kt.none],Vf=[],Uf=Object.create(null),gA=Object.create(null);for(let[i,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])gA[i]=vA(mA,e);function Bl(i,e){Vf.indexOf(i)>-1||(Vf.push(i),console.warn(e))}function vA(i,e){let t=[];for(let o of e.split(" ")){let a=[];for(let c of o.split(".")){let h=i[c]||q[c];h?typeof h=="function"?a.length?a=a.map(h):Bl(c,`Modifier ${c} used at start of tag`):a.length?Bl(c,`Tag ${c} used as modifier`):a=Array.isArray(h)?h:[h]:Bl(c,`Unknown highlighting tag ${c}`)}for(let c of a)t.push(c)}if(!t.length)return 0;let r=e.replace(/ /g,"_"),n=r+" "+t.map(o=>o.id),s=Uf[n];if(s)return s.id;let l=Uf[n]=kt.define({id:$f.length,name:r,props:[EE({[r]:t})]});return $f.push(l),l.id}He.RTL,He.LTR;const _A=i=>{let{state:e}=i,t=e.doc.lineAt(e.selection.main.from),r=Xc(i.state,t.from);return r.line?yA(i):r.block?xA(i):!1};function Gc(i,e){return({state:t,dispatch:r})=>{if(t.readOnly)return!1;let n=i(e,t);return n?(r(t.update(n)),!0):!1}}const yA=Gc(CA,0),bA=Gc(Ig,0),xA=Gc((i,e)=>Ig(i,e,wA(e)),0);function Xc(i,e){let t=i.languageDataAt("commentTokens",e,1);return t.length?t[0]:{}}const fn=50;function SA(i,{open:e,close:t},r,n){let s=i.sliceDoc(r-fn,r),l=i.sliceDoc(n,n+fn),o=/\s*$/.exec(s)[0].length,a=/^\s*/.exec(l)[0].length,c=s.length-o;if(s.slice(c-e.length,c)==e&&l.slice(a,a+t.length)==t)return{open:{pos:r-o,margin:o&&1},close:{pos:n+a,margin:a&&1}};let h,u;n-r<=2*fn?h=u=i.sliceDoc(r,n):(h=i.sliceDoc(r,r+fn),u=i.sliceDoc(n-fn,n));let f=/^\s*/.exec(h)[0].length,d=/\s*$/.exec(u)[0].length,y=u.length-d-t.length;return h.slice(f,f+e.length)==e&&u.slice(y,y+t.length)==t?{open:{pos:r+f+e.length,margin:/\s/.test(h.charAt(f+e.length))?1:0},close:{pos:n-d-t.length,margin:/\s/.test(u.charAt(y-1))?1:0}}:null}function wA(i){let e=[];for(let t of i.selection.ranges){let r=i.doc.lineAt(t.from),n=t.to<=r.to?r:i.doc.lineAt(t.to);n.from>r.from&&n.from==t.to&&(n=t.to==r.to+1?r:i.doc.lineAt(t.to-1));let s=e.length-1;s>=0&&e[s].to>r.from?e[s].to=n.to:e.push({from:r.from+/^\s*/.exec(r.text)[0].length,to:n.to})}return e}function Ig(i,e,t=e.selection.ranges){let r=t.map(s=>Xc(e,s.from).block);if(!r.every(s=>s))return null;let n=t.map((s,l)=>SA(e,r[l],s.from,s.to));if(i!=2&&!n.every(s=>s))return{changes:e.changes(t.map((s,l)=>n[l]?[]:[{from:s.from,insert:r[l].open+" "},{from:s.to,insert:" "+r[l].close}]))};if(i!=1&&n.some(s=>s)){let s=[];for(let l=0,o;l<n.length;l++)if(o=n[l]){let a=r[l],{open:c,close:h}=o;s.push({from:c.pos-a.open.length,to:c.pos+c.margin},{from:h.pos-h.margin,to:h.pos+a.close.length})}return{changes:s}}return null}function CA(i,e,t=e.selection.ranges){let r=[],n=-1;for(let{from:s,to:l}of t){let o=r.length,a=1e9,c=Xc(e,s).line;if(c){for(let h=s;h<=l;){let u=e.doc.lineAt(h);if(u.from>n&&(s==l||l>u.from)){n=u.from;let f=/^\s*/.exec(u.text)[0].length,d=f==u.length,y=u.text.slice(f,f+c.length)==c?f:-1;f<u.text.length&&f<a&&(a=f),r.push({line:u,comment:y,token:c,indent:f,empty:d,single:!1})}h=u.to+1}if(a<1e9)for(let h=o;h<r.length;h++)r[h].indent<r[h].line.text.length&&(r[h].indent=a);r.length==o+1&&(r[o].single=!0)}}if(i!=2&&r.some(s=>s.comment<0&&(!s.empty||s.single))){let s=[];for(let{line:o,token:a,indent:c,empty:h,single:u}of r)(u||!h)&&s.push({from:o.from+c,insert:a+" "});let l=e.changes(s);return{changes:l,selection:e.selection.map(l,1)}}else if(i!=1&&r.some(s=>s.comment>=0)){let s=[];for(let{line:l,comment:o,token:a}of r)if(o>=0){let c=l.from+o,h=c+a.length;l.text[h-l.from]==" "&&h++,s.push({from:c,to:h})}return{changes:s}}return null}const $a=Ci.define(),kA=Ci.define(),EA=oe.define(),Ng=oe.define({combine(i){return qi(i,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(r,n)=>e(r,n)||t(r,n)})}}),Fg=tt.define({create(){return fi.empty},update(i,e){let t=e.state.facet(Ng),r=e.annotation($a);if(r){let a=wt.fromTransaction(e,r.selection),c=r.side,h=c==0?i.undone:i.done;return a?h=po(h,h.length,t.minDepth,a):h=zg(h,e.startState.selection),new fi(c==0?r.rest:h,c==0?h:r.rest)}let n=e.annotation(kA);if((n=="full"||n=="before")&&(i=i.isolate()),e.annotation(We.addToHistory)===!1)return e.changes.empty?i:i.addMapping(e.changes.desc);let s=wt.fromTransaction(e),l=e.annotation(We.time),o=e.annotation(We.userEvent);return s?i=i.addChanges(s,l,o,t,e):e.selection&&(i=i.addSelection(e.startState.selection,l,o,t.newGroupDelay)),(n=="full"||n=="after")&&(i=i.isolate()),i},toJSON(i){return{done:i.done.map(e=>e.toJSON()),undone:i.undone.map(e=>e.toJSON())}},fromJSON(i){return new fi(i.done.map(wt.fromJSON),i.undone.map(wt.fromJSON))}});function AA(i={}){return[Fg,Ng.of(i),se.domEventHandlers({beforeinput(e,t){let r=e.inputType=="historyUndo"?Hg:e.inputType=="historyRedo"?Va:null;return r?(e.preventDefault(),r(t)):!1}})]}function Ho(i,e){return function({state:t,dispatch:r}){if(!e&&t.readOnly)return!1;let n=t.field(Fg,!1);if(!n)return!1;let s=n.pop(i,t,e);return s?(r(s),!0):!1}}const Hg=Ho(0,!1),Va=Ho(1,!1),DA=Ho(0,!0),LA=Ho(1,!0);class wt{constructor(e,t,r,n,s){this.changes=e,this.effects=t,this.mapped=r,this.startSelection=n,this.selectionsAfter=s}setSelAfter(e){return new wt(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,r;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(r=this.startSelection)===null||r===void 0?void 0:r.toJSON(),selectionsAfter:this.selectionsAfter.map(n=>n.toJSON())}}static fromJSON(e){return new wt(e.changes&&Ke.fromJSON(e.changes),[],e.mapped&&di.fromJSON(e.mapped),e.startSelection&&G.fromJSON(e.startSelection),e.selectionsAfter.map(G.fromJSON))}static fromTransaction(e,t){let r=jt;for(let n of e.startState.facet(EA)){let s=n(e);s.length&&(r=r.concat(s))}return!r.length&&e.changes.empty?null:new wt(e.changes.invert(e.startState.doc),r,void 0,t||e.startState.selection,jt)}static selection(e){return new wt(void 0,jt,void 0,void 0,e)}}function po(i,e,t,r){let n=e+1>t+20?e-t-1:0,s=i.slice(n,e);return s.push(r),s}function MA(i,e){let t=[],r=!1;return i.iterChangedRanges((n,s)=>t.push(n,s)),e.iterChangedRanges((n,s,l,o)=>{for(let a=0;a<t.length;){let c=t[a++],h=t[a++];o>=c&&l<=h&&(r=!0)}}),r}function TA(i,e){return i.ranges.length==e.ranges.length&&i.ranges.filter((t,r)=>t.empty!=e.ranges[r].empty).length===0}function jg(i,e){return i.length?e.length?i.concat(e):i:e}const jt=[],RA=200;function zg(i,e){if(i.length){let t=i[i.length-1],r=t.selectionsAfter.slice(Math.max(0,t.selectionsAfter.length-RA));return r.length&&r[r.length-1].eq(e)?i:(r.push(e),po(i,i.length-1,1e9,t.setSelAfter(r)))}else return[wt.selection([e])]}function PA(i){let e=i[i.length-1],t=i.slice();return t[i.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),t}function Ol(i,e){if(!i.length)return i;let t=i.length,r=jt;for(;t;){let n=BA(i[t-1],e,r);if(n.changes&&!n.changes.empty||n.effects.length){let s=i.slice(0,t);return s[t-1]=n,s}else e=n.mapped,t--,r=n.selectionsAfter}return r.length?[wt.selection(r)]:jt}function BA(i,e,t){let r=jg(i.selectionsAfter.length?i.selectionsAfter.map(o=>o.map(e)):jt,t);if(!i.changes)return wt.selection(r);let n=i.changes.map(e),s=e.mapDesc(i.changes,!0),l=i.mapped?i.mapped.composeDesc(s):s;return new wt(n,pe.mapEffects(i.effects,e),l,i.startSelection.map(s),r)}const OA=/^(input\.type|delete)($|\.)/;class fi{constructor(e,t,r=0,n=void 0){this.done=e,this.undone=t,this.prevTime=r,this.prevUserEvent=n}isolate(){return this.prevTime?new fi(this.done,this.undone):this}addChanges(e,t,r,n,s){let l=this.done,o=l[l.length-1];return o&&o.changes&&!o.changes.empty&&e.changes&&(!r||OA.test(r))&&(!o.selectionsAfter.length&&t-this.prevTime<n.newGroupDelay&&n.joinToEvent(s,MA(o.changes,e.changes))||r=="input.type.compose")?l=po(l,l.length-1,n.minDepth,new wt(e.changes.compose(o.changes),jg(pe.mapEffects(e.effects,o.changes),o.effects),o.mapped,o.startSelection,jt)):l=po(l,l.length,n.minDepth,e),new fi(l,jt,t,r)}addSelection(e,t,r,n){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:jt;return s.length>0&&t-this.prevTime<n&&r==this.prevUserEvent&&r&&/^select($|\.)/.test(r)&&TA(s[s.length-1],e)?this:new fi(zg(this.done,e),this.undone,t,r)}addMapping(e){return new fi(Ol(this.done,e),Ol(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,r){let n=e==0?this.done:this.undone;if(n.length==0)return null;let s=n[n.length-1],l=s.selectionsAfter[0]||t.selection;if(r&&s.selectionsAfter.length)return t.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:$a.of({side:e,rest:PA(n),selection:l}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let o=n.length==1?jt:n.slice(0,n.length-1);return s.mapped&&(o=Ol(o,s.mapped)),t.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:$a.of({side:e,rest:o,selection:l}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}fi.empty=new fi(jt,jt);const IA=[{key:"Mod-z",run:Hg,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Va,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Va,preventDefault:!0},{key:"Mod-u",run:DA,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:LA,preventDefault:!0}];function Qr(i,e){return G.create(i.ranges.map(e),i.mainIndex)}function Yt(i,e){return i.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function Qt({state:i,dispatch:e},t){let r=Qr(i.selection,t);return r.eq(i.selection,!0)?!1:(e(Yt(i,r)),!0)}function jo(i,e){return G.cursor(e?i.to:i.from)}function Wg(i,e){return Qt(i,t=>t.empty?i.moveByChar(t,e):jo(t,e))}function at(i){return i.textDirectionAt(i.state.selection.main.head)==He.LTR}const $g=i=>Wg(i,!at(i)),Vg=i=>Wg(i,at(i));function Ug(i,e){return Qt(i,t=>t.empty?i.moveByGroup(t,e):jo(t,e))}const NA=i=>Ug(i,!at(i)),FA=i=>Ug(i,at(i));function HA(i,e,t){if(e.type.prop(t))return!0;let r=e.to-e.from;return r&&(r>2||/[^\s,.;:]/.test(i.sliceDoc(e.from,e.to)))||e.firstChild}function zo(i,e,t){let r=et(i).resolveInner(e.head),n=t?xe.closedBy:xe.openedBy;for(let a=e.head;;){let c=t?r.childAfter(a):r.childBefore(a);if(!c)break;HA(i,c,n)?r=c:a=t?c.to:c.from}let s=r.type.prop(n),l,o;return s&&(l=t?ui(i,r.from,1):ui(i,r.to,-1))&&l.matched?o=t?l.end.to:l.end.from:o=t?r.to:r.from,G.cursor(o,t?-1:1)}const jA=i=>Qt(i,e=>zo(i.state,e,!at(i))),zA=i=>Qt(i,e=>zo(i.state,e,at(i)));function qg(i,e){return Qt(i,t=>{if(!t.empty)return jo(t,e);let r=i.moveVertically(t,e);return r.head!=t.head?r:i.moveToLineBoundary(t,e)})}const Kg=i=>qg(i,!1),Gg=i=>qg(i,!0);function Xg(i){let e=i.scrollDOM.clientHeight<i.scrollDOM.scrollHeight-2,t=0,r=0,n;if(e){for(let s of i.state.facet(se.scrollMargins)){let l=s(i);l!=null&&l.top&&(t=Math.max(l==null?void 0:l.top,t)),l!=null&&l.bottom&&(r=Math.max(l==null?void 0:l.bottom,r))}n=i.scrollDOM.clientHeight-t-r}else n=(i.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:t,marginBottom:r,selfScroll:e,height:Math.max(i.defaultLineHeight,n-5)}}function Jg(i,e){let t=Xg(i),{state:r}=i,n=Qr(r.selection,l=>l.empty?i.moveVertically(l,e,t.height):jo(l,e));if(n.eq(r.selection))return!1;let s;if(t.selfScroll){let l=i.coordsAtPos(r.selection.main.head),o=i.scrollDOM.getBoundingClientRect(),a=o.top+t.marginTop,c=o.bottom-t.marginBottom;l&&l.top>a&&l.bottom<c&&(s=se.scrollIntoView(n.main.head,{y:"start",yMargin:l.top-a}))}return i.dispatch(Yt(r,n),{effects:s}),!0}const qf=i=>Jg(i,!1),Ua=i=>Jg(i,!0);function Gi(i,e,t){let r=i.lineBlockAt(e.head),n=i.moveToLineBoundary(e,t);if(n.head==e.head&&n.head!=(t?r.to:r.from)&&(n=i.moveToLineBoundary(e,t,!1)),!t&&n.head==r.from&&r.length){let s=/^\s*/.exec(i.state.sliceDoc(r.from,Math.min(r.from+100,r.to)))[0].length;s&&e.head!=r.from+s&&(n=G.cursor(r.from+s))}return n}const WA=i=>Qt(i,e=>Gi(i,e,!0)),$A=i=>Qt(i,e=>Gi(i,e,!1)),VA=i=>Qt(i,e=>Gi(i,e,!at(i))),UA=i=>Qt(i,e=>Gi(i,e,at(i))),qA=i=>Qt(i,e=>G.cursor(i.lineBlockAt(e.head).from,1)),KA=i=>Qt(i,e=>G.cursor(i.lineBlockAt(e.head).to,-1));function GA(i,e,t){let r=!1,n=Qr(i.selection,s=>{let l=ui(i,s.head,-1)||ui(i,s.head,1)||s.head>0&&ui(i,s.head-1,1)||s.head<i.doc.length&&ui(i,s.head+1,-1);if(!l||!l.end)return s;r=!0;let o=l.start.from==s.head?l.end.to:l.end.from;return G.cursor(o)});return r?(e(Yt(i,n)),!0):!1}const XA=({state:i,dispatch:e})=>GA(i,e);function $t(i,e){let t=Qr(i.state.selection,r=>{let n=e(r);return G.range(r.anchor,n.head,n.goalColumn,n.bidiLevel||void 0)});return t.eq(i.state.selection)?!1:(i.dispatch(Yt(i.state,t)),!0)}function Yg(i,e){return $t(i,t=>i.moveByChar(t,e))}const Qg=i=>Yg(i,!at(i)),Zg=i=>Yg(i,at(i));function e0(i,e){return $t(i,t=>i.moveByGroup(t,e))}const JA=i=>e0(i,!at(i)),YA=i=>e0(i,at(i)),QA=i=>$t(i,e=>zo(i.state,e,!at(i))),ZA=i=>$t(i,e=>zo(i.state,e,at(i)));function t0(i,e){return $t(i,t=>i.moveVertically(t,e))}const i0=i=>t0(i,!1),r0=i=>t0(i,!0);function n0(i,e){return $t(i,t=>i.moveVertically(t,e,Xg(i).height))}const Kf=i=>n0(i,!1),Gf=i=>n0(i,!0),eD=i=>$t(i,e=>Gi(i,e,!0)),tD=i=>$t(i,e=>Gi(i,e,!1)),iD=i=>$t(i,e=>Gi(i,e,!at(i))),rD=i=>$t(i,e=>Gi(i,e,at(i))),nD=i=>$t(i,e=>G.cursor(i.lineBlockAt(e.head).from)),sD=i=>$t(i,e=>G.cursor(i.lineBlockAt(e.head).to)),Xf=({state:i,dispatch:e})=>(e(Yt(i,{anchor:0})),!0),Jf=({state:i,dispatch:e})=>(e(Yt(i,{anchor:i.doc.length})),!0),Yf=({state:i,dispatch:e})=>(e(Yt(i,{anchor:i.selection.main.anchor,head:0})),!0),Qf=({state:i,dispatch:e})=>(e(Yt(i,{anchor:i.selection.main.anchor,head:i.doc.length})),!0),oD=({state:i,dispatch:e})=>(e(i.update({selection:{anchor:0,head:i.doc.length},userEvent:"select"})),!0),lD=({state:i,dispatch:e})=>{let t=Wo(i).map(({from:r,to:n})=>G.range(r,Math.min(n+1,i.doc.length)));return e(i.update({selection:G.create(t),userEvent:"select"})),!0},aD=({state:i,dispatch:e})=>{let t=Qr(i.selection,r=>{let n=et(i),s=n.resolveStack(r.from,1);if(r.empty){let l=n.resolveStack(r.from,-1);l.node.from>=s.node.from&&l.node.to<=s.node.to&&(s=l)}for(let l=s;l;l=l.next){let{node:o}=l;if((o.from<r.from&&o.to>=r.to||o.to>r.to&&o.from<=r.from)&&l.next)return G.range(o.to,o.from)}return r});return t.eq(i.selection)?!1:(e(Yt(i,t)),!0)};function s0(i,e){let{state:t}=i,r=t.selection,n=t.selection.ranges.slice();for(let s of t.selection.ranges){let l=t.doc.lineAt(s.head);if(e?l.to<i.state.doc.length:l.from>0)for(let o=s;;){let a=i.moveVertically(o,e);if(a.head<l.from||a.head>l.to){n.some(c=>c.head==a.head)||n.push(a);break}else{if(a.head==o.head)break;o=a}}}return n.length==r.ranges.length?!1:(i.dispatch(Yt(t,G.create(n,n.length-1))),!0)}const cD=i=>s0(i,!1),hD=i=>s0(i,!0),uD=({state:i,dispatch:e})=>{let t=i.selection,r=null;return t.ranges.length>1?r=G.create([t.main]):t.main.empty||(r=G.create([G.cursor(t.main.head)])),r?(e(Yt(i,r)),!0):!1};function ts(i,e){if(i.state.readOnly)return!1;let t="delete.selection",{state:r}=i,n=r.changeByRange(s=>{let{from:l,to:o}=s;if(l==o){let a=e(s);a<l?(t="delete.backward",a=Ms(i,a,!1)):a>l&&(t="delete.forward",a=Ms(i,a,!0)),l=Math.min(l,a),o=Math.max(o,a)}else l=Ms(i,l,!1),o=Ms(i,o,!0);return l==o?{range:s}:{changes:{from:l,to:o},range:G.cursor(l,l<s.head?-1:1)}});return n.changes.empty?!1:(i.dispatch(r.update(n,{scrollIntoView:!0,userEvent:t,effects:t=="delete.selection"?se.announce.of(r.phrase("Selection deleted")):void 0})),!0)}function Ms(i,e,t){if(i instanceof se)for(let r of i.state.facet(se.atomicRanges).map(n=>n(i)))r.between(e,e,(n,s)=>{n<e&&s>e&&(e=t?s:n)});return e}const o0=(i,e,t)=>ts(i,r=>{let n=r.from,{state:s}=i,l=s.doc.lineAt(n),o,a;if(t&&!e&&n>l.from&&n<l.from+200&&!/[^ \t]/.test(o=l.text.slice(0,n-l.from))){if(o[o.length-1]=="	")return n-1;let c=Lo(o,s.tabSize),h=c%uo(s)||uo(s);for(let u=0;u<h&&o[o.length-1-u]==" ";u++)n--;a=n}else a=Ge(l.text,n-l.from,e,e)+l.from,a==n&&l.number!=(e?s.doc.lines:1)?a+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(l.text.slice(a-l.from,n-l.from))&&(a=Ge(l.text,a-l.from,!1,!1)+l.from);return a}),qa=i=>o0(i,!1,!0),l0=i=>o0(i,!0,!1),a0=(i,e)=>ts(i,t=>{let r=t.head,{state:n}=i,s=n.doc.lineAt(r),l=n.charCategorizer(r);for(let o=null;;){if(r==(e?s.to:s.from)){r==t.head&&s.number!=(e?n.doc.lines:1)&&(r+=e?1:-1);break}let a=Ge(s.text,r-s.from,e)+s.from,c=s.text.slice(Math.min(r,a)-s.from,Math.max(r,a)-s.from),h=l(c);if(o!=null&&h!=o)break;(c!=" "||r!=t.head)&&(o=h),r=a}return r}),c0=i=>a0(i,!1),fD=i=>a0(i,!0),dD=i=>ts(i,e=>{let t=i.lineBlockAt(e.head).to;return e.head<t?t:Math.min(i.state.doc.length,e.head+1)}),pD=i=>ts(i,e=>{let t=i.moveToLineBoundary(e,!1).head;return e.head>t?t:Math.max(0,e.head-1)}),mD=i=>ts(i,e=>{let t=i.moveToLineBoundary(e,!0).head;return e.head<t?t:Math.min(i.state.doc.length,e.head+1)}),gD=({state:i,dispatch:e})=>{if(i.readOnly)return!1;let t=i.changeByRange(r=>({changes:{from:r.from,to:r.to,insert:Ee.of(["",""])},range:G.cursor(r.from)}));return e(i.update(t,{scrollIntoView:!0,userEvent:"input"})),!0},vD=({state:i,dispatch:e})=>{if(i.readOnly)return!1;let t=i.changeByRange(r=>{if(!r.empty||r.from==0||r.from==i.doc.length)return{range:r};let n=r.from,s=i.doc.lineAt(n),l=n==s.from?n-1:Ge(s.text,n-s.from,!1)+s.from,o=n==s.to?n+1:Ge(s.text,n-s.from,!0)+s.from;return{changes:{from:l,to:o,insert:i.doc.slice(n,o).append(i.doc.slice(l,n))},range:G.cursor(o)}});return t.changes.empty?!1:(e(i.update(t,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Wo(i){let e=[],t=-1;for(let r of i.selection.ranges){let n=i.doc.lineAt(r.from),s=i.doc.lineAt(r.to);if(!r.empty&&r.to==s.from&&(s=i.doc.lineAt(r.to-1)),t>=n.number){let l=e[e.length-1];l.to=s.to,l.ranges.push(r)}else e.push({from:n.from,to:s.to,ranges:[r]});t=s.number+1}return e}function h0(i,e,t){if(i.readOnly)return!1;let r=[],n=[];for(let s of Wo(i)){if(t?s.to==i.doc.length:s.from==0)continue;let l=i.doc.lineAt(t?s.to+1:s.from-1),o=l.length+1;if(t){r.push({from:s.to,to:l.to},{from:s.from,insert:l.text+i.lineBreak});for(let a of s.ranges)n.push(G.range(Math.min(i.doc.length,a.anchor+o),Math.min(i.doc.length,a.head+o)))}else{r.push({from:l.from,to:s.from},{from:s.to,insert:i.lineBreak+l.text});for(let a of s.ranges)n.push(G.range(a.anchor-o,a.head-o))}}return r.length?(e(i.update({changes:r,scrollIntoView:!0,selection:G.create(n,i.selection.mainIndex),userEvent:"move.line"})),!0):!1}const _D=({state:i,dispatch:e})=>h0(i,e,!1),yD=({state:i,dispatch:e})=>h0(i,e,!0);function u0(i,e,t){if(i.readOnly)return!1;let r=[];for(let s of Wo(i))t?r.push({from:s.from,insert:i.doc.slice(s.from,s.to)+i.lineBreak}):r.push({from:s.to,insert:i.lineBreak+i.doc.slice(s.from,s.to)});let n=i.changes(r);return e(i.update({changes:n,selection:i.selection.map(n,t?1:-1),scrollIntoView:!0,userEvent:"input.copyline"})),!0}const bD=({state:i,dispatch:e})=>u0(i,e,!1),xD=({state:i,dispatch:e})=>u0(i,e,!0),SD=i=>{if(i.state.readOnly)return!1;let{state:e}=i,t=e.changes(Wo(e).map(({from:n,to:s})=>(n>0?n--:s<e.doc.length&&s++,{from:n,to:s}))),r=Qr(e.selection,n=>{let s;if(i.lineWrapping){let l=i.lineBlockAt(n.head),o=i.coordsAtPos(n.head,n.assoc||1);o&&(s=l.bottom+i.documentTop-o.bottom+i.defaultLineHeight/2)}return i.moveVertically(n,!0,s)}).map(t);return i.dispatch({changes:t,selection:r,scrollIntoView:!0,userEvent:"delete.line"}),!0};function wD(i,e){if(/\(\)|\[\]|\{\}/.test(i.sliceDoc(e-1,e+1)))return{from:e,to:e};let t=et(i).resolveInner(e),r=t.childBefore(e),n=t.childAfter(e),s;return r&&n&&r.to<=e&&n.from>=e&&(s=r.type.prop(xe.closedBy))&&s.indexOf(n.name)>-1&&i.doc.lineAt(r.to).from==i.doc.lineAt(n.from).from&&!/\S/.test(i.sliceDoc(r.to,n.from))?{from:r.to,to:n.from}:null}const Zf=f0(!1),CD=f0(!0);function f0(i){return({state:e,dispatch:t})=>{if(e.readOnly)return!1;let r=e.changeByRange(n=>{let{from:s,to:l}=n,o=e.doc.lineAt(s),a=!i&&s==l&&wD(e,s);i&&(s=l=(l<=o.to?o:e.doc.lineAt(l)).to);let c=new Fo(e,{simulateBreak:s,simulateDoubleBreak:!!a}),h=Uc(c,s);for(h==null&&(h=Lo(/^\s*/.exec(e.doc.lineAt(s).text)[0],e.tabSize));l<o.to&&/\s/.test(o.text[l-o.from]);)l++;a?{from:s,to:l}=a:s>o.from&&s<o.from+100&&!/\S/.test(o.text.slice(0,s))&&(s=o.from);let u=["",Nn(e,h)];return a&&u.push(Nn(e,c.lineIndent(o.from,-1))),{changes:{from:s,to:l,insert:Ee.of(u)},range:G.cursor(s+1+u[1].length)}});return t(e.update(r,{scrollIntoView:!0,userEvent:"input"})),!0}}function Jc(i,e){let t=-1;return i.changeByRange(r=>{let n=[];for(let l=r.from;l<=r.to;){let o=i.doc.lineAt(l);o.number>t&&(r.empty||r.to>o.from)&&(e(o,n,r),t=o.number),l=o.to+1}let s=i.changes(n);return{changes:n,range:G.range(s.mapPos(r.anchor,1),s.mapPos(r.head,1))}})}const kD=({state:i,dispatch:e})=>{if(i.readOnly)return!1;let t=Object.create(null),r=new Fo(i,{overrideIndentation:s=>{let l=t[s];return l??-1}}),n=Jc(i,(s,l,o)=>{let a=Uc(r,s.from);if(a==null)return;/\S/.test(s.text)||(a=0);let c=/^\s*/.exec(s.text)[0],h=Nn(i,a);(c!=h||o.from<s.from+c.length)&&(t[s.from]=a,l.push({from:s.from,to:s.from+c.length,insert:h}))});return n.changes.empty||e(i.update(n,{userEvent:"indent"})),!0},d0=({state:i,dispatch:e})=>i.readOnly?!1:(e(i.update(Jc(i,(t,r)=>{r.push({from:t.from,insert:i.facet(No)})}),{userEvent:"input.indent"})),!0),p0=({state:i,dispatch:e})=>i.readOnly?!1:(e(i.update(Jc(i,(t,r)=>{let n=/^\s*/.exec(t.text)[0];if(!n)return;let s=Lo(n,i.tabSize),l=0,o=Nn(i,Math.max(0,s-uo(i)));for(;l<n.length&&l<o.length&&n.charCodeAt(l)==o.charCodeAt(l);)l++;r.push({from:t.from+l,to:t.from+n.length,insert:o.slice(l)})}),{userEvent:"delete.dedent"})),!0),ED=i=>(i.setTabFocusMode(),!0),AD=[{key:"Ctrl-b",run:$g,shift:Qg,preventDefault:!0},{key:"Ctrl-f",run:Vg,shift:Zg},{key:"Ctrl-p",run:Kg,shift:i0},{key:"Ctrl-n",run:Gg,shift:r0},{key:"Ctrl-a",run:qA,shift:nD},{key:"Ctrl-e",run:KA,shift:sD},{key:"Ctrl-d",run:l0},{key:"Ctrl-h",run:qa},{key:"Ctrl-k",run:dD},{key:"Ctrl-Alt-h",run:c0},{key:"Ctrl-o",run:gD},{key:"Ctrl-t",run:vD},{key:"Ctrl-v",run:Ua}],DD=[{key:"ArrowLeft",run:$g,shift:Qg,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:NA,shift:JA,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:VA,shift:iD,preventDefault:!0},{key:"ArrowRight",run:Vg,shift:Zg,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:FA,shift:YA,preventDefault:!0},{mac:"Cmd-ArrowRight",run:UA,shift:rD,preventDefault:!0},{key:"ArrowUp",run:Kg,shift:i0,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Xf,shift:Yf},{mac:"Ctrl-ArrowUp",run:qf,shift:Kf},{key:"ArrowDown",run:Gg,shift:r0,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Jf,shift:Qf},{mac:"Ctrl-ArrowDown",run:Ua,shift:Gf},{key:"PageUp",run:qf,shift:Kf},{key:"PageDown",run:Ua,shift:Gf},{key:"Home",run:$A,shift:tD,preventDefault:!0},{key:"Mod-Home",run:Xf,shift:Yf},{key:"End",run:WA,shift:eD,preventDefault:!0},{key:"Mod-End",run:Jf,shift:Qf},{key:"Enter",run:Zf,shift:Zf},{key:"Mod-a",run:oD},{key:"Backspace",run:qa,shift:qa,preventDefault:!0},{key:"Delete",run:l0,preventDefault:!0},{key:"Mod-Backspace",mac:"Alt-Backspace",run:c0,preventDefault:!0},{key:"Mod-Delete",mac:"Alt-Delete",run:fD,preventDefault:!0},{mac:"Mod-Backspace",run:pD,preventDefault:!0},{mac:"Mod-Delete",run:mD,preventDefault:!0}].concat(AD.map(i=>({mac:i.key,run:i.run,shift:i.shift}))),LD=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:jA,shift:QA},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:zA,shift:ZA},{key:"Alt-ArrowUp",run:_D},{key:"Shift-Alt-ArrowUp",run:bD},{key:"Alt-ArrowDown",run:yD},{key:"Shift-Alt-ArrowDown",run:xD},{key:"Mod-Alt-ArrowUp",run:cD},{key:"Mod-Alt-ArrowDown",run:hD},{key:"Escape",run:uD},{key:"Mod-Enter",run:CD},{key:"Alt-l",mac:"Ctrl-l",run:lD},{key:"Mod-i",run:aD,preventDefault:!0},{key:"Mod-[",run:p0},{key:"Mod-]",run:d0},{key:"Mod-Alt-\\",run:kD},{key:"Shift-Mod-k",run:SD},{key:"Shift-Mod-\\",run:XA},{key:"Mod-/",run:_A},{key:"Alt-A",run:bA},{key:"Ctrl-m",mac:"Shift-Alt-m",run:ED}].concat(DD),MD={key:"Tab",run:d0,shift:p0};class m0{constructor(e,t,r,n){this.state=e,this.pos=t,this.explicit=r,this.view=n,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(e){let t=et(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),r=Math.max(t.from,this.pos-250),n=t.text.slice(r-t.from,this.pos-t.from),s=n.search(g0(e,!1));return s<0?null:{from:r+s,to:this.pos,text:n.slice(s)}}get aborted(){return this.abortListeners==null}addEventListener(e,t,r){e=="abort"&&this.abortListeners&&(this.abortListeners.push(t),r&&r.onDocChange&&(this.abortOnDocChange=!0))}}function ed(i){let e=Object.keys(i).join(""),t=/\w/.test(e);return t&&(e=e.replace(/\w/g,"")),`[${t?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function TD(i){let e=Object.create(null),t=Object.create(null);for(let{label:n}of i){e[n[0]]=!0;for(let s=1;s<n.length;s++)t[n[s]]=!0}let r=ed(e)+ed(t)+"*$";return[new RegExp("^"+r),new RegExp(r)]}function RD(i){let e=i.map(n=>typeof n=="string"?{label:n}:n),[t,r]=e.every(n=>/^\w+$/.test(n.label))?[/\w*$/,/\w+$/]:TD(e);return n=>{let s=n.matchBefore(r);return s||n.explicit?{from:s?s.from:n.pos,options:e,validFor:t}:null}}function rT(i,e){return t=>{for(let r=et(t.state).resolveInner(t.pos,-1);r;r=r.parent){if(i.indexOf(r.name)>-1)return null;if(r.type.isTop)break}return e(t)}}class td{constructor(e,t,r,n){this.completion=e,this.source=t,this.match=r,this.score=n}}function lr(i){return i.selection.main.from}function g0(i,e){var t;let{source:r}=i,n=e&&r[0]!="^",s=r[r.length-1]!="$";return!n&&!s?i:new RegExp(`${n?"^":""}(?:${r})${s?"$":""}`,(t=i.flags)!==null&&t!==void 0?t:i.ignoreCase?"i":"")}const Yc=Ci.define();function PD(i,e,t,r){let{main:n}=i.selection,s=t-n.from,l=r-n.from;return{...i.changeByRange(o=>{if(o!=n&&t!=r&&i.sliceDoc(o.from+s,o.from+l)!=i.sliceDoc(t,r))return{range:o};let a=i.toText(e);return{changes:{from:o.from+s,to:r==n.from?o.to:o.from+l,insert:a},range:G.cursor(o.from+s+a.length)}}),scrollIntoView:!0,userEvent:"input.complete"}}const id=new WeakMap;function BD(i){if(!Array.isArray(i))return i;let e=id.get(i);return e||id.set(i,e=RD(i)),e}const mo=pe.define(),Fn=pe.define();class OD{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let t=0;t<e.length;){let r=Tt(e,t),n=ai(r);this.chars.push(r);let s=e.slice(t,t+n),l=s.toUpperCase();this.folded.push(Tt(l==s?s.toLowerCase():l,0)),t+=n}this.astral=e.length!=this.chars.length}ret(e,t){return this.score=e,this.matched=t,this}match(e){if(this.pattern.length==0)return this.ret(-100,[]);if(e.length<this.pattern.length)return null;let{chars:t,folded:r,any:n,precise:s,byWord:l}=this;if(t.length==1){let g=Tt(e,0),v=ai(g),b=v==e.length?0:-100;if(g!=t[0])if(g==r[0])b+=-200;else return null;return this.ret(b,[0,v])}let o=e.indexOf(this.pattern);if(o==0)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let a=t.length,c=0;if(o<0){for(let g=0,v=Math.min(e.length,200);g<v&&c<a;){let b=Tt(e,g);(b==t[c]||b==r[c])&&(n[c++]=g),g+=ai(b)}if(c<a)return null}let h=0,u=0,f=!1,d=0,y=-1,_=-1,m=/[a-z]/.test(e),p=!0;for(let g=0,v=Math.min(e.length,200),b=0;g<v&&u<a;){let S=Tt(e,g);o<0&&(h<a&&S==t[h]&&(s[h++]=g),d<a&&(S==t[d]||S==r[d]?(d==0&&(y=g),_=g+1,d++):d=0));let x,C=S<255?S>=48&&S<=57||S>=97&&S<=122?2:S>=65&&S<=90?1:0:(x=wc(S))!=x.toLowerCase()?1:x!=x.toUpperCase()?2:0;(!g||C==1&&m||b==0&&C!=0)&&(t[u]==S||r[u]==S&&(f=!0)?l[u++]=g:l.length&&(p=!1)),b=C,g+=ai(S)}return u==a&&l[0]==0&&p?this.result(-100+(f?-200:0),l,e):d==a&&y==0?this.ret(-200-e.length+(_==e.length?0:-100),[0,_]):o>-1?this.ret(-700-e.length,[o,o+this.pattern.length]):d==a?this.ret(-900-e.length,[y,_]):u==a?this.result(-100+(f?-200:0)+-700+(p?0:-1100),l,e):t.length==2?null:this.result((n[0]?-700:0)+-200+-1100,n,e)}result(e,t,r){let n=[],s=0;for(let l of t){let o=l+(this.astral?ai(Tt(r,l)):1);s&&n[s-1]==l?n[s-1]=o:(n[s++]=l,n[s++]=o)}return this.ret(e-r.length,n)}}class ID{constructor(e){this.pattern=e,this.matched=[],this.score=0,this.folded=e.toLowerCase()}match(e){if(e.length<this.pattern.length)return null;let t=e.slice(0,this.pattern.length),r=t==this.pattern?0:t.toLowerCase()==this.folded?-200:null;return r==null?null:(this.matched=[0,t.length],this.score=r+(e.length==this.pattern.length?0:-100),this)}}const Xe=oe.define({combine(i){return qi(i,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:ND,filterStrict:!1,compareCompletions:(e,t)=>(e.sortText||e.label).localeCompare(t.sortText||t.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,tooltipClass:(e,t)=>r=>rd(e(r),t(r)),optionClass:(e,t)=>r=>rd(e(r),t(r)),addToOptions:(e,t)=>e.concat(t),filterStrict:(e,t)=>e||t})}});function rd(i,e){return i?e?i+" "+e:i:e}function ND(i,e,t,r,n,s){let l=i.textDirection==He.RTL,o=l,a=!1,c="top",h,u,f=e.left-n.left,d=n.right-e.right,y=r.right-r.left,_=r.bottom-r.top;if(o&&f<Math.min(y,d)?o=!1:!o&&d<Math.min(y,f)&&(o=!0),y<=(o?f:d))h=Math.max(n.top,Math.min(t.top,n.bottom-_))-e.top,u=Math.min(400,o?f:d);else{a=!0,u=Math.min(400,(l?e.right:n.right-e.left)-30);let g=n.bottom-e.bottom;g>=_||g>e.top?h=t.bottom-e.top:(c="bottom",h=e.bottom-t.top)}let m=(e.bottom-e.top)/s.offsetHeight,p=(e.right-e.left)/s.offsetWidth;return{style:`${c}: ${h/m}px; max-width: ${u/p}px`,class:"cm-completionInfo-"+(a?l?"left-narrow":"right-narrow":o?"left":"right")}}function FD(i){let e=i.addToOptions.slice();return i.icons&&e.push({render(t){let r=document.createElement("div");return r.classList.add("cm-completionIcon"),t.type&&r.classList.add(...t.type.split(/\s+/g).map(n=>"cm-completionIcon-"+n)),r.setAttribute("aria-hidden","true"),r},position:20}),e.push({render(t,r,n,s){let l=document.createElement("span");l.className="cm-completionLabel";let o=t.displayLabel||t.label,a=0;for(let c=0;c<s.length;){let h=s[c++],u=s[c++];h>a&&l.appendChild(document.createTextNode(o.slice(a,h)));let f=l.appendChild(document.createElement("span"));f.appendChild(document.createTextNode(o.slice(h,u))),f.className="cm-completionMatchedText",a=u}return a<o.length&&l.appendChild(document.createTextNode(o.slice(a))),l},position:50},{render(t){if(!t.detail)return null;let r=document.createElement("span");return r.className="cm-completionDetail",r.textContent=t.detail,r},position:80}),e.sort((t,r)=>t.position-r.position).map(t=>t.render)}function Il(i,e,t){if(i<=t)return{from:0,to:i};if(e<0&&(e=0),e<=i>>1){let n=Math.floor(e/t);return{from:n*t,to:(n+1)*t}}let r=Math.floor((i-e)/t);return{from:i-(r+1)*t,to:i-r*t}}class HD{constructor(e,t,r){this.view=e,this.stateField=t,this.applyCompletion=r,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:a=>this.placeInfo(a),key:this},this.space=null,this.currentClass="";let n=e.state.field(t),{options:s,selected:l}=n.open,o=e.state.facet(Xe);this.optionContent=FD(o),this.optionClass=o.optionClass,this.tooltipClass=o.tooltipClass,this.range=Il(s.length,l,o.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",a=>{let{options:c}=e.state.field(t).open;for(let h=a.target,u;h&&h!=this.dom;h=h.parentNode)if(h.nodeName=="LI"&&(u=/-(\d+)$/.exec(h.id))&&+u[1]<c.length){this.applyCompletion(e,c[+u[1]]),a.preventDefault();return}}),this.dom.addEventListener("focusout",a=>{let c=e.state.field(this.stateField,!1);c&&c.tooltip&&e.state.facet(Xe).closeOnBlur&&a.relatedTarget!=e.contentDOM&&e.dispatch({effects:Fn.of(null)})}),this.showOptions(s,n.id)}mount(){this.updateSel()}showOptions(e,t){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,t,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(e){var t;let r=e.state.field(this.stateField),n=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),r!=n){let{options:s,selected:l,disabled:o}=r.open;(!n.open||n.open.options!=s)&&(this.range=Il(s.length,l,e.state.facet(Xe).maxRenderedOptions),this.showOptions(s,r.id)),this.updateSel(),o!=((t=n.open)===null||t===void 0?void 0:t.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!o)}}updateTooltipClass(e){let t=this.tooltipClass(e);if(t!=this.currentClass){for(let r of this.currentClass.split(" "))r&&this.dom.classList.remove(r);for(let r of t.split(" "))r&&this.dom.classList.add(r);this.currentClass=t}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;(t.selected>-1&&t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=Il(t.options.length,t.selected,this.view.state.facet(Xe).maxRenderedOptions),this.showOptions(t.options,e.id));let r=this.updateSelectedOption(t.selected);if(r){this.destroyInfo();let{completion:n}=t.options[t.selected],{info:s}=n;if(!s)return;let l=typeof s=="string"?document.createTextNode(s):s(n);if(!l)return;"then"in l?l.then(o=>{o&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(o,n)}).catch(o=>St(this.view.state,o,"completion info")):(this.addInfoPane(l,n),r.setAttribute("aria-describedby",this.info.id))}}addInfoPane(e,t){this.destroyInfo();let r=this.info=document.createElement("div");if(r.className="cm-tooltip cm-completionInfo",r.id="cm-completionInfo-"+Math.floor(Math.random()*65535).toString(16),e.nodeType!=null)r.appendChild(e),this.infoDestroy=null;else{let{dom:n,destroy:s}=e;r.appendChild(n),this.infoDestroy=s||null}this.dom.appendChild(r),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let t=null;for(let r=this.list.firstChild,n=this.range.from;r;r=r.nextSibling,n++)r.nodeName!="LI"||!r.id?n--:n==e?r.hasAttribute("aria-selected")||(r.setAttribute("aria-selected","true"),t=r):r.hasAttribute("aria-selected")&&(r.removeAttribute("aria-selected"),r.removeAttribute("aria-describedby"));return t&&zD(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),r=this.info.getBoundingClientRect(),n=e.getBoundingClientRect(),s=this.space;if(!s){let l=this.dom.ownerDocument.documentElement;s={left:0,top:0,right:l.clientWidth,bottom:l.clientHeight}}return n.top>Math.min(s.bottom,t.bottom)-10||n.bottom<Math.max(s.top,t.top)+10?null:this.view.state.facet(Xe).positionInfo(this.view,t,n,r,s,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,t,r){const n=document.createElement("ul");n.id=t,n.setAttribute("role","listbox"),n.setAttribute("aria-expanded","true"),n.setAttribute("aria-label",this.view.state.phrase("Completions")),n.addEventListener("mousedown",l=>{l.target==n&&l.preventDefault()});let s=null;for(let l=r.from;l<r.to;l++){let{completion:o,match:a}=e[l],{section:c}=o;if(c){let f=typeof c=="string"?c:c.name;if(f!=s&&(l>r.from||r.from==0))if(s=f,typeof c!="string"&&c.header)n.appendChild(c.header(c));else{let d=n.appendChild(document.createElement("completion-section"));d.textContent=f}}const h=n.appendChild(document.createElement("li"));h.id=t+"-"+l,h.setAttribute("role","option");let u=this.optionClass(o);u&&(h.className=u);for(let f of this.optionContent){let d=f(o,this.view.state,this.view,a);d&&h.appendChild(d)}}return r.from&&n.classList.add("cm-completionListIncompleteTop"),r.to<e.length&&n.classList.add("cm-completionListIncompleteBottom"),n}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function jD(i,e){return t=>new HD(t,i,e)}function zD(i,e){let t=i.getBoundingClientRect(),r=e.getBoundingClientRect(),n=t.height/i.offsetHeight;r.top<t.top?i.scrollTop-=(t.top-r.top)/n:r.bottom>t.bottom&&(i.scrollTop+=(r.bottom-t.bottom)/n)}function nd(i){return(i.boost||0)*100+(i.apply?10:0)+(i.info?5:0)+(i.type?1:0)}function WD(i,e){let t=[],r=null,n=null,s=h=>{t.push(h);let{section:u}=h.completion;if(u){r||(r=[]);let f=typeof u=="string"?u:u.name;r.some(d=>d.name==f)||r.push(typeof u=="string"?{name:f}:u)}},l=e.facet(Xe);for(let h of i)if(h.hasResult()){let u=h.result.getMatch;if(h.result.filter===!1)for(let f of h.result.options)s(new td(f,h.source,u?u(f):[],1e9-t.length));else{let f=e.sliceDoc(h.from,h.to),d,y=l.filterStrict?new ID(f):new OD(f);for(let _ of h.result.options)if(d=y.match(_.label)){let m=_.displayLabel?u?u(_,d.matched):[]:d.matched,p=d.score+(_.boost||0);if(s(new td(_,h.source,m,p)),typeof _.section=="object"&&_.section.rank==="dynamic"){let{name:g}=_.section;n||(n=Object.create(null)),n[g]=Math.max(p,n[g]||-1e9)}}}}if(r){let h=Object.create(null),u=0,f=(d,y)=>(d.rank==="dynamic"&&y.rank==="dynamic"?n[y.name]-n[d.name]:0)||(typeof d.rank=="number"?d.rank:1e9)-(typeof y.rank=="number"?y.rank:1e9)||(d.name<y.name?-1:1);for(let d of r.sort(f))u-=1e5,h[d.name]=u;for(let d of t){let{section:y}=d.completion;y&&(d.score+=h[typeof y=="string"?y:y.name])}}let o=[],a=null,c=l.compareCompletions;for(let h of t.sort((u,f)=>f.score-u.score||c(u.completion,f.completion))){let u=h.completion;!a||a.label!=u.label||a.detail!=u.detail||a.type!=null&&u.type!=null&&a.type!=u.type||a.apply!=u.apply||a.boost!=u.boost?o.push(h):nd(h.completion)>nd(a)&&(o[o.length-1]=h),a=h.completion}return o}class Lr{constructor(e,t,r,n,s,l){this.options=e,this.attrs=t,this.tooltip=r,this.timestamp=n,this.selected=s,this.disabled=l}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new Lr(this.options,sd(t,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,t,r,n,s,l){if(n&&!l&&e.some(c=>c.isPending))return n.setDisabled();let o=WD(e,t);if(!o.length)return n&&e.some(c=>c.isPending)?n.setDisabled():null;let a=t.facet(Xe).selectOnOpen?0:-1;if(n&&n.selected!=a&&n.selected!=-1){let c=n.options[n.selected].completion;for(let h=0;h<o.length;h++)if(o[h].completion==c){a=h;break}}return new Lr(o,sd(r,a),{pos:e.reduce((c,h)=>h.hasResult()?Math.min(c,h.from):c,1e8),create:GD,above:s.aboveCursor},n?n.timestamp:Date.now(),a,!1)}map(e){return new Lr(this.options,this.attrs,{...this.tooltip,pos:e.mapPos(this.tooltip.pos)},this.timestamp,this.selected,this.disabled)}setDisabled(){return new Lr(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class go{constructor(e,t,r){this.active=e,this.id=t,this.open=r}static start(){return new go(qD,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:t}=e,r=t.facet(Xe),s=(r.override||t.languageDataAt("autocomplete",lr(t)).map(BD)).map(a=>(this.active.find(h=>h.source==a)||new zt(a,this.active.some(h=>h.state!=0)?1:0)).update(e,r));s.length==this.active.length&&s.every((a,c)=>a==this.active[c])&&(s=this.active);let l=this.open,o=e.effects.some(a=>a.is(Qc));l&&e.docChanged&&(l=l.map(e.changes)),e.selection||s.some(a=>a.hasResult()&&e.changes.touchesRange(a.from,a.to))||!$D(s,this.active)||o?l=Lr.build(s,t,this.id,l,r,o):l&&l.disabled&&!s.some(a=>a.isPending)&&(l=null),!l&&s.every(a=>!a.isPending)&&s.some(a=>a.hasResult())&&(s=s.map(a=>a.hasResult()?new zt(a.source,0):a));for(let a of e.effects)a.is(_0)&&(l=l&&l.setSelected(a.value,this.id));return s==this.active&&l==this.open?this:new go(s,this.id,l)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?VD:UD}}function $D(i,e){if(i==e)return!0;for(let t=0,r=0;;){for(;t<i.length&&!i[t].hasResult();)t++;for(;r<e.length&&!e[r].hasResult();)r++;let n=t==i.length,s=r==e.length;if(n||s)return n==s;if(i[t++].result!=e[r++].result)return!1}}const VD={"aria-autocomplete":"list"},UD={};function sd(i,e){let t={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":i};return e>-1&&(t["aria-activedescendant"]=i+"-"+e),t}const qD=[];function v0(i,e){if(i.isUserEvent("input.complete")){let r=i.annotation(Yc);if(r&&e.activateOnCompletion(r))return 12}let t=i.isUserEvent("input.type");return t&&e.activateOnTyping?5:t?1:i.isUserEvent("delete.backward")?2:i.selection?8:i.docChanged?16:0}class zt{constructor(e,t,r=!1){this.source=e,this.state=t,this.explicit=r}hasResult(){return!1}get isPending(){return this.state==1}update(e,t){let r=v0(e,t),n=this;(r&8||r&16&&this.touches(e))&&(n=new zt(n.source,0)),r&4&&n.state==0&&(n=new zt(this.source,1)),n=n.updateFor(e,r);for(let s of e.effects)if(s.is(mo))n=new zt(n.source,1,s.value);else if(s.is(Fn))n=new zt(n.source,0);else if(s.is(Qc))for(let l of s.value)l.source==n.source&&(n=l);return n}updateFor(e,t){return this.map(e.changes)}map(e){return this}touches(e){return e.changes.touchesRange(lr(e.state))}}class Nr extends zt{constructor(e,t,r,n,s,l){super(e,3,t),this.limit=r,this.result=n,this.from=s,this.to=l}hasResult(){return!0}updateFor(e,t){var r;if(!(t&3))return this.map(e.changes);let n=this.result;n.map&&!e.changes.empty&&(n=n.map(n,e.changes));let s=e.changes.mapPos(this.from),l=e.changes.mapPos(this.to,1),o=lr(e.state);if(o>l||!n||t&2&&(lr(e.startState)==this.from||o<this.limit))return new zt(this.source,t&4?1:0);let a=e.changes.mapPos(this.limit);return KD(n.validFor,e.state,s,l)?new Nr(this.source,this.explicit,a,n,s,l):n.update&&(n=n.update(n,s,l,new m0(e.state,o,!1)))?new Nr(this.source,this.explicit,a,n,n.from,(r=n.to)!==null&&r!==void 0?r:lr(e.state)):new zt(this.source,1,this.explicit)}map(e){return e.empty?this:(this.result.map?this.result.map(this.result,e):this.result)?new Nr(this.source,this.explicit,e.mapPos(this.limit),this.result,e.mapPos(this.from),e.mapPos(this.to,1)):new zt(this.source,0)}touches(e){return e.changes.touchesRange(this.from,this.to)}}function KD(i,e,t,r){if(!i)return!1;let n=e.sliceDoc(t,r);return typeof i=="function"?i(n,t,r,e):g0(i,!0).test(n)}const Qc=pe.define({map(i,e){return i.map(t=>t.map(e))}}),_0=pe.define(),bt=tt.define({create(){return go.start()},update(i,e){return i.update(e)},provide:i=>[jc.from(i,e=>e.tooltip),se.contentAttributes.from(i,e=>e.attrs)]});function Zc(i,e){const t=e.completion.apply||e.completion.label;let r=i.state.field(bt).active.find(n=>n.source==e.source);return r instanceof Nr?(typeof t=="string"?i.dispatch({...PD(i.state,t,r.from,r.to),annotations:Yc.of(e.completion)}):t(i,e.completion,r.from,r.to),!0):!1}const GD=jD(bt,Zc);function Ts(i,e="option"){return t=>{let r=t.state.field(bt,!1);if(!r||!r.open||r.open.disabled||Date.now()-r.open.timestamp<t.state.facet(Xe).interactionDelay)return!1;let n=1,s;e=="page"&&(s=ug(t,r.open.tooltip))&&(n=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let{length:l}=r.open.options,o=r.open.selected>-1?r.open.selected+n*(i?1:-1):i?0:l-1;return o<0?o=e=="page"?0:l-1:o>=l&&(o=e=="page"?l-1:0),t.dispatch({effects:_0.of(o)}),!0}}const XD=i=>{let e=i.state.field(bt,!1);return i.state.readOnly||!e||!e.open||e.open.selected<0||e.open.disabled||Date.now()-e.open.timestamp<i.state.facet(Xe).interactionDelay?!1:Zc(i,e.open.options[e.open.selected])},Nl=i=>i.state.field(bt,!1)?(i.dispatch({effects:mo.of(!0)}),!0):!1,JD=i=>{let e=i.state.field(bt,!1);return!e||!e.active.some(t=>t.state!=0)?!1:(i.dispatch({effects:Fn.of(null)}),!0)};class YD{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const QD=50,ZD=1e3,eL=ot.fromClass(class{constructor(i){this.view=i,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let e of i.state.field(bt).active)e.isPending&&this.startQuery(e)}update(i){let e=i.state.field(bt),t=i.state.facet(Xe);if(!i.selectionSet&&!i.docChanged&&i.startState.field(bt)==e)return;let r=i.transactions.some(s=>{let l=v0(s,t);return l&8||(s.selection||s.docChanged)&&!(l&3)});for(let s=0;s<this.running.length;s++){let l=this.running[s];if(r||l.context.abortOnDocChange&&i.docChanged||l.updates.length+i.transactions.length>QD&&Date.now()-l.time>ZD){for(let o of l.context.abortListeners)try{o()}catch(a){St(this.view.state,a)}l.context.abortListeners=null,this.running.splice(s--,1)}else l.updates.push(...i.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),i.transactions.some(s=>s.effects.some(l=>l.is(mo)))&&(this.pendingStart=!0);let n=this.pendingStart?50:t.activateOnTypingDelay;if(this.debounceUpdate=e.active.some(s=>s.isPending&&!this.running.some(l=>l.active.source==s.source))?setTimeout(()=>this.startUpdate(),n):-1,this.composing!=0)for(let s of i.transactions)s.isUserEvent("input.type")?this.composing=2:this.composing==2&&s.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:i}=this.view,e=i.field(bt);for(let t of e.active)t.isPending&&!this.running.some(r=>r.active.source==t.source)&&this.startQuery(t);this.running.length&&e.open&&e.open.disabled&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(Xe).updateSyncTime))}startQuery(i){let{state:e}=this.view,t=lr(e),r=new m0(e,t,i.explicit,this.view),n=new YD(i,r);this.running.push(n),Promise.resolve(i.source(r)).then(s=>{n.context.aborted||(n.done=s||null,this.scheduleAccept())},s=>{this.view.dispatch({effects:Fn.of(null)}),St(this.view.state,s)})}scheduleAccept(){this.running.every(i=>i.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(Xe).updateSyncTime))}accept(){var i;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],t=this.view.state.facet(Xe),r=this.view.state.field(bt);for(let n=0;n<this.running.length;n++){let s=this.running[n];if(s.done===void 0)continue;if(this.running.splice(n--,1),s.done){let o=lr(s.updates.length?s.updates[0].startState:this.view.state),a=Math.min(o,s.done.from+(s.active.explicit?0:1)),c=new Nr(s.active.source,s.active.explicit,a,s.done,s.done.from,(i=s.done.to)!==null&&i!==void 0?i:o);for(let h of s.updates)c=c.update(h,t);if(c.hasResult()){e.push(c);continue}}let l=r.active.find(o=>o.source==s.active.source);if(l&&l.isPending)if(s.done==null){let o=new zt(s.active.source,0);for(let a of s.updates)o=o.update(a,t);o.isPending||e.push(o)}else this.startQuery(l)}(e.length||r.open&&r.open.disabled)&&this.view.dispatch({effects:Qc.of(e)})}},{eventHandlers:{blur(i){let e=this.view.state.field(bt,!1);if(e&&e.tooltip&&this.view.state.facet(Xe).closeOnBlur){let t=e.open&&ug(this.view,e.open.tooltip);(!t||!t.dom.contains(i.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:Fn.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:mo.of(!1)}),20),this.composing=0}}}),tL=typeof navigator=="object"&&/Win/.test(navigator.platform),iL=vr.highest(se.domEventHandlers({keydown(i,e){let t=e.state.field(bt,!1);if(!t||!t.open||t.open.disabled||t.open.selected<0||i.key.length>1||i.ctrlKey&&!(tL&&i.altKey)||i.metaKey)return!1;let r=t.open.options[t.open.selected],n=t.active.find(l=>l.source==r.source),s=r.completion.commitCharacters||n.result.commitCharacters;return s&&s.indexOf(i.key)>-1&&Zc(e,r),!1}})),y0=se.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class rL{constructor(e,t,r,n){this.field=e,this.line=t,this.from=r,this.to=n}}class eh{constructor(e,t,r){this.field=e,this.from=t,this.to=r}map(e){let t=e.mapPos(this.from,-1,Ze.TrackDel),r=e.mapPos(this.to,1,Ze.TrackDel);return t==null||r==null?null:new eh(this.field,t,r)}}class th{constructor(e,t){this.lines=e,this.fieldPositions=t}instantiate(e,t){let r=[],n=[t],s=e.doc.lineAt(t),l=/^\s*/.exec(s.text)[0];for(let a of this.lines){if(r.length){let c=l,h=/^\t*/.exec(a)[0].length;for(let u=0;u<h;u++)c+=e.facet(No);n.push(t+c.length-h),a=c+a.slice(h)}r.push(a),t+=a.length+1}let o=this.fieldPositions.map(a=>new eh(a.field,n[a.line]+a.from,n[a.line]+a.to));return{text:r,ranges:o}}static parse(e){let t=[],r=[],n=[],s;for(let l of e.split(/\r\n?|\n/)){for(;s=/[#$]\{(?:(\d+)(?::([^{}]*))?|((?:\\[{}]|[^{}])*))\}/.exec(l);){let o=s[1]?+s[1]:null,a=s[2]||s[3]||"",c=-1,h=a.replace(/\\[{}]/g,u=>u[1]);for(let u=0;u<t.length;u++)(o!=null?t[u].seq==o:h&&t[u].name==h)&&(c=u);if(c<0){let u=0;for(;u<t.length&&(o==null||t[u].seq!=null&&t[u].seq<o);)u++;t.splice(u,0,{seq:o,name:h}),c=u;for(let f of n)f.field>=c&&f.field++}for(let u of n)if(u.line==r.length&&u.from>s.index){let f=s[2]?3+(s[1]||"").length:2;u.from-=f,u.to-=f}n.push(new rL(c,r.length,s.index,s.index+h.length)),l=l.slice(0,s.index)+a+l.slice(s.index+s[0].length)}l=l.replace(/\\([{}])/g,(o,a,c)=>{for(let h of n)h.line==r.length&&h.from>c&&(h.from--,h.to--);return a}),r.push(l)}return new th(r,n)}}let nL=he.widget({widget:new class extends Ki{toDOM(){let i=document.createElement("span");return i.className="cm-snippetFieldPosition",i}ignoreEvent(){return!1}}}),sL=he.mark({class:"cm-snippetField"});class Zr{constructor(e,t){this.ranges=e,this.active=t,this.deco=he.set(e.map(r=>(r.from==r.to?nL:sL).range(r.from,r.to)),!0)}map(e){let t=[];for(let r of this.ranges){let n=r.map(e);if(!n)return null;t.push(n)}return new Zr(t,this.active)}selectionInsideField(e){return e.ranges.every(t=>this.ranges.some(r=>r.field==this.active&&r.from<=t.from&&r.to>=t.to))}}const is=pe.define({map(i,e){return i&&i.map(e)}}),oL=pe.define(),Hn=tt.define({create(){return null},update(i,e){for(let t of e.effects){if(t.is(is))return t.value;if(t.is(oL)&&i)return new Zr(i.ranges,t.value)}return i&&e.docChanged&&(i=i.map(e.changes)),i&&e.selection&&!i.selectionInsideField(e.selection)&&(i=null),i},provide:i=>se.decorations.from(i,e=>e?e.deco:he.none)});function ih(i,e){return G.create(i.filter(t=>t.field==e).map(t=>G.range(t.from,t.to)))}function lL(i){let e=th.parse(i);return(t,r,n,s)=>{let{text:l,ranges:o}=e.instantiate(t.state,n),{main:a}=t.state.selection,c={changes:{from:n,to:s==a.from?a.to:s,insert:Ee.of(l)},scrollIntoView:!0,annotations:r?[Yc.of(r),We.userEvent.of("input.complete")]:void 0};if(o.length&&(c.selection=ih(o,0)),o.some(h=>h.field>0)){let h=new Zr(o,0),u=c.effects=[is.of(h)];t.state.field(Hn,!1)===void 0&&u.push(pe.appendConfig.of([Hn,fL,dL,y0]))}t.dispatch(t.state.update(c))}}function b0(i){return({state:e,dispatch:t})=>{let r=e.field(Hn,!1);if(!r||i<0&&r.active==0)return!1;let n=r.active+i,s=i>0&&!r.ranges.some(l=>l.field==n+i);return t(e.update({selection:ih(r.ranges,n),effects:is.of(s?null:new Zr(r.ranges,n)),scrollIntoView:!0})),!0}}const aL=({state:i,dispatch:e})=>i.field(Hn,!1)?(e(i.update({effects:is.of(null)})),!0):!1,cL=b0(1),hL=b0(-1),uL=[{key:"Tab",run:cL,shift:hL},{key:"Escape",run:aL}],od=oe.define({combine(i){return i.length?i[0]:uL}}),fL=vr.highest(Oo.compute([od],i=>i.facet(od)));function nT(i,e){return{...e,apply:lL(i)}}const dL=se.domEventHandlers({mousedown(i,e){let t=e.state.field(Hn,!1),r;if(!t||(r=e.posAtCoords({x:i.clientX,y:i.clientY}))==null)return!1;let n=t.ranges.find(s=>s.from<=r&&s.to>=r);return!n||n.field==t.active?!1:(e.dispatch({selection:ih(t.ranges,n.field),effects:is.of(t.ranges.some(s=>s.field>n.field)?new Zr(t.ranges,n.field):null),scrollIntoView:!0}),!0)}}),jn={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},or=pe.define({map(i,e){let t=e.mapPos(i,-1,Ze.TrackAfter);return t??void 0}}),rh=new class extends Fi{};rh.startSide=1;rh.endSide=-1;const x0=tt.define({create(){return ye.empty},update(i,e){if(i=i.map(e.changes),e.selection){let t=e.state.doc.lineAt(e.selection.main.head);i=i.update({filter:r=>r>=t.from&&r<=t.to})}for(let t of e.effects)t.is(or)&&(i=i.update({add:[rh.range(t.value,t.value+1)]}));return i}});function pL(){return[gL,x0]}const Fl="()[]{}<>«»»«［］｛｝";function S0(i){for(let e=0;e<Fl.length;e+=2)if(Fl.charCodeAt(e)==i)return Fl.charAt(e+1);return wc(i<128?i:i+1)}function w0(i,e){return i.languageDataAt("closeBrackets",e)[0]||jn}const mL=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),gL=se.inputHandler.of((i,e,t,r)=>{if((mL?i.composing:i.compositionStarted)||i.state.readOnly)return!1;let n=i.state.selection.main;if(r.length>2||r.length==2&&ai(Tt(r,0))==1||e!=n.from||t!=n.to)return!1;let s=yL(i.state,r);return s?(i.dispatch(s),!0):!1}),vL=({state:i,dispatch:e})=>{if(i.readOnly)return!1;let r=w0(i,i.selection.main.head).brackets||jn.brackets,n=null,s=i.changeByRange(l=>{if(l.empty){let o=bL(i.doc,l.head);for(let a of r)if(a==o&&$o(i.doc,l.head)==S0(Tt(a,0)))return{changes:{from:l.head-a.length,to:l.head+a.length},range:G.cursor(l.head-a.length)}}return{range:n=l}});return n||e(i.update(s,{scrollIntoView:!0,userEvent:"delete.backward"})),!n},_L=[{key:"Backspace",run:vL}];function yL(i,e){let t=w0(i,i.selection.main.head),r=t.brackets||jn.brackets;for(let n of r){let s=S0(Tt(n,0));if(e==n)return s==n?wL(i,n,r.indexOf(n+n+n)>-1,t):xL(i,n,s,t.before||jn.before);if(e==s&&C0(i,i.selection.main.from))return SL(i,n,s)}return null}function C0(i,e){let t=!1;return i.field(x0).between(0,i.doc.length,r=>{r==e&&(t=!0)}),t}function $o(i,e){let t=i.sliceString(e,e+2);return t.slice(0,ai(Tt(t,0)))}function bL(i,e){let t=i.sliceString(e-2,e);return ai(Tt(t,0))==t.length?t:t.slice(1)}function xL(i,e,t,r){let n=null,s=i.changeByRange(l=>{if(!l.empty)return{changes:[{insert:e,from:l.from},{insert:t,from:l.to}],effects:or.of(l.to+e.length),range:G.range(l.anchor+e.length,l.head+e.length)};let o=$o(i.doc,l.head);return!o||/\s/.test(o)||r.indexOf(o)>-1?{changes:{insert:e+t,from:l.head},effects:or.of(l.head+e.length),range:G.cursor(l.head+e.length)}:{range:n=l}});return n?null:i.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function SL(i,e,t){let r=null,n=i.changeByRange(s=>s.empty&&$o(i.doc,s.head)==t?{changes:{from:s.head,to:s.head+t.length,insert:t},range:G.cursor(s.head+t.length)}:r={range:s});return r?null:i.update(n,{scrollIntoView:!0,userEvent:"input.type"})}function wL(i,e,t,r){let n=r.stringPrefixes||jn.stringPrefixes,s=null,l=i.changeByRange(o=>{if(!o.empty)return{changes:[{insert:e,from:o.from},{insert:e,from:o.to}],effects:or.of(o.to+e.length),range:G.range(o.anchor+e.length,o.head+e.length)};let a=o.head,c=$o(i.doc,a),h;if(c==e){if(ld(i,a))return{changes:{insert:e+e,from:a},effects:or.of(a+e.length),range:G.cursor(a+e.length)};if(C0(i,a)){let f=t&&i.sliceDoc(a,a+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:a,to:a+f.length,insert:f},range:G.cursor(a+f.length)}}}else{if(t&&i.sliceDoc(a-2*e.length,a)==e+e&&(h=ad(i,a-2*e.length,n))>-1&&ld(i,h))return{changes:{insert:e+e+e+e,from:a},effects:or.of(a+e.length),range:G.cursor(a+e.length)};if(i.charCategorizer(a)(c)!=Fe.Word&&ad(i,a,n)>-1&&!CL(i,a,e,n))return{changes:{insert:e+e,from:a},effects:or.of(a+e.length),range:G.cursor(a+e.length)}}return{range:s=o}});return s?null:i.update(l,{scrollIntoView:!0,userEvent:"input.type"})}function ld(i,e){let t=et(i).resolveInner(e+1);return t.parent&&t.from==e}function CL(i,e,t,r){let n=et(i).resolveInner(e,-1),s=r.reduce((l,o)=>Math.max(l,o.length),0);for(let l=0;l<5;l++){let o=i.sliceDoc(n.from,Math.min(n.to,n.from+t.length+s)),a=o.indexOf(t);if(!a||a>-1&&r.indexOf(o.slice(0,a))>-1){let h=n.firstChild;for(;h&&h.from==n.from&&h.to-h.from>t.length+a;){if(i.sliceDoc(h.to-t.length,h.to)==t)return!1;h=h.firstChild}return!0}let c=n.to==e&&n.parent;if(!c)break;n=c}return!1}function ad(i,e,t){let r=i.charCategorizer(e);if(r(i.sliceDoc(e-1,e))!=Fe.Word)return e;for(let n of t){let s=e-n.length;if(i.sliceDoc(s,e)==n&&r(i.sliceDoc(s-1,s))!=Fe.Word)return s}return-1}function kL(i={}){return[iL,bt,Xe.of(i),eL,AL,y0]}const EL=[{key:"Ctrl-Space",run:Nl},{mac:"Alt-`",run:Nl},{mac:"Alt-i",run:Nl},{key:"Escape",run:JD},{key:"ArrowDown",run:Ts(!0)},{key:"ArrowUp",run:Ts(!1)},{key:"PageDown",run:Ts(!0,"page")},{key:"PageUp",run:Ts(!1,"page")},{key:"Enter",run:XD}],AL=vr.highest(Oo.computeN([Xe],i=>i.facet(Xe).defaultKeymap?[EL]:[])),cd=typeof String.prototype.normalize=="function"?i=>i.normalize("NFKD"):i=>i;class Kr{constructor(e,t,r=0,n=e.length,s,l){this.test=l,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(r,n),this.bufferStart=r,this.normalize=s?o=>s(cd(o)):cd,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return Tt(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=wc(e),r=this.bufferStart+this.bufferPos;this.bufferPos+=ai(e);let n=this.normalize(t);if(n.length)for(let s=0,l=r;;s++){let o=n.charCodeAt(s),a=this.match(o,l,this.bufferPos+this.bufferStart);if(s==n.length-1){if(a)return this.value=a,this;break}l==r&&s<t.length&&t.charCodeAt(s)==o&&l++}}}match(e,t,r){let n=null;for(let s=0;s<this.matches.length;s+=2){let l=this.matches[s],o=!1;this.query.charCodeAt(l)==e&&(l==this.query.length-1?n={from:this.matches[s+1],to:r}:(this.matches[s]++,o=!0)),o||(this.matches.splice(s,2),s-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?n={from:t,to:r}:this.matches.push(1,t)),n&&this.test&&!this.test(n.from,n.to,this.buffer,this.bufferStart)&&(n=null),n}}typeof Symbol<"u"&&(Kr.prototype[Symbol.iterator]=function(){return this});const k0={from:-1,to:-1,match:/.*/.exec("")},nh="gm"+(/x/.unicode==null?"":"u");class E0{constructor(e,t,r,n=0,s=e.length){if(this.text=e,this.to=s,this.curLine="",this.done=!1,this.value=k0,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new A0(e,t,r,n,s);this.re=new RegExp(t,nh+(r!=null&&r.ignoreCase?"i":"")),this.test=r==null?void 0:r.test,this.iter=e.iter();let l=e.lineAt(n);this.curLineStart=l.from,this.matchPos=vo(e,n),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let r=this.curLineStart+t.index,n=r+t[0].length;if(this.matchPos=vo(this.text,n+(r==n?1:0)),r==this.curLineStart+this.curLine.length&&this.nextLine(),(r<n||r>this.value.to)&&(!this.test||this.test(r,n,t)))return this.value={from:r,to:n,match:t},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const Hl=new WeakMap;class Fr{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,r){let n=Hl.get(e);if(!n||n.from>=r||n.to<=t){let o=new Fr(t,e.sliceString(t,r));return Hl.set(e,o),o}if(n.from==t&&n.to==r)return n;let{text:s,from:l}=n;return l>t&&(s=e.sliceString(t,l)+s,l=t),n.to<r&&(s+=e.sliceString(n.to,r)),Hl.set(e,new Fr(l,s)),new Fr(t,s.slice(t-l,r-l))}}class A0{constructor(e,t,r,n,s){this.text=e,this.to=s,this.done=!1,this.value=k0,this.matchPos=vo(e,n),this.re=new RegExp(t,nh+(r!=null&&r.ignoreCase?"i":"")),this.test=r==null?void 0:r.test,this.flat=Fr.get(e,n,this.chunkEnd(n+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t){let r=this.flat.from+t.index,n=r+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(r,n,t)))return this.value={from:r,to:n,match:t},this.matchPos=vo(this.text,n+(r==n?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=Fr.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(E0.prototype[Symbol.iterator]=A0.prototype[Symbol.iterator]=function(){return this});function DL(i){try{return new RegExp(i,nh),!0}catch{return!1}}function vo(i,e){if(e>=i.length)return e;let t=i.lineAt(e),r;for(;e<t.to&&(r=t.text.charCodeAt(e-t.from))>=56320&&r<57344;)e++;return e}const LL=i=>{let{state:e}=i,t=String(e.doc.lineAt(i.state.selection.main.head).number),{close:r,result:n}=q2(i,{label:e.phrase("Go to line"),input:{type:"text",name:"line",value:t},focus:!0,submitLabel:e.phrase("go")});return n.then(s=>{let l=s&&/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(s.elements.line.value);if(!l){i.dispatch({effects:r});return}let o=e.doc.lineAt(e.selection.main.head),[,a,c,h,u]=l,f=h?+h.slice(1):0,d=c?+c:o.number;if(c&&u){let m=d/100;a&&(m=m*(a=="-"?-1:1)+o.number/e.doc.lines),d=Math.round(e.doc.lines*m)}else c&&a&&(d=d*(a=="-"?-1:1)+o.number);let y=e.doc.line(Math.max(1,Math.min(e.doc.lines,d))),_=G.cursor(y.from+Math.max(0,Math.min(f,y.length)));i.dispatch({effects:[r,se.scrollIntoView(_.from,{y:"center"})],selection:_})}),!0},ML={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},TL=oe.define({combine(i){return qi(i,ML,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})}});function RL(i){return[NL,IL]}const PL=he.mark({class:"cm-selectionMatch"}),BL=he.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function hd(i,e,t,r){return(t==0||i(e.sliceDoc(t-1,t))!=Fe.Word)&&(r==e.doc.length||i(e.sliceDoc(r,r+1))!=Fe.Word)}function OL(i,e,t,r){return i(e.sliceDoc(t,t+1))==Fe.Word&&i(e.sliceDoc(r-1,r))==Fe.Word}const IL=ot.fromClass(class{constructor(i){this.decorations=this.getDeco(i)}update(i){(i.selectionSet||i.docChanged||i.viewportChanged)&&(this.decorations=this.getDeco(i.view))}getDeco(i){let e=i.state.facet(TL),{state:t}=i,r=t.selection;if(r.ranges.length>1)return he.none;let n=r.main,s,l=null;if(n.empty){if(!e.highlightWordAroundCursor)return he.none;let a=t.wordAt(n.head);if(!a)return he.none;l=t.charCategorizer(n.head),s=t.sliceDoc(a.from,a.to)}else{let a=n.to-n.from;if(a<e.minSelectionLength||a>200)return he.none;if(e.wholeWords){if(s=t.sliceDoc(n.from,n.to),l=t.charCategorizer(n.head),!(hd(l,t,n.from,n.to)&&OL(l,t,n.from,n.to)))return he.none}else if(s=t.sliceDoc(n.from,n.to),!s)return he.none}let o=[];for(let a of i.visibleRanges){let c=new Kr(t.doc,s,a.from,a.to);for(;!c.next().done;){let{from:h,to:u}=c.value;if((!l||hd(l,t,h,u))&&(n.empty&&h<=n.from&&u>=n.to?o.push(BL.range(h,u)):(h>=n.to||u<=n.from)&&o.push(PL.range(h,u)),o.length>e.maxMatches))return he.none}}return he.set(o)}},{decorations:i=>i.decorations}),NL=se.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),FL=({state:i,dispatch:e})=>{let{selection:t}=i,r=G.create(t.ranges.map(n=>i.wordAt(n.head)||G.cursor(n.head)),t.mainIndex);return r.eq(t)?!1:(e(i.update({selection:r})),!0)};function HL(i,e){let{main:t,ranges:r}=i.selection,n=i.wordAt(t.head),s=n&&n.from==t.from&&n.to==t.to;for(let l=!1,o=new Kr(i.doc,e,r[r.length-1].to);;)if(o.next(),o.done){if(l)return null;o=new Kr(i.doc,e,0,Math.max(0,r[r.length-1].from-1)),l=!0}else{if(l&&r.some(a=>a.from==o.value.from))continue;if(s){let a=i.wordAt(o.value.from);if(!a||a.from!=o.value.from||a.to!=o.value.to)continue}return o.value}}const jL=({state:i,dispatch:e})=>{let{ranges:t}=i.selection;if(t.some(s=>s.from===s.to))return FL({state:i,dispatch:e});let r=i.sliceDoc(t[0].from,t[0].to);if(i.selection.ranges.some(s=>i.sliceDoc(s.from,s.to)!=r))return!1;let n=HL(i,r);return n?(e(i.update({selection:i.selection.addRange(G.range(n.from,n.to),!1),effects:se.scrollIntoView(n.to)})),!0):!1},en=oe.define({combine(i){return qi(i,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new eM(e),scrollToMatch:e=>se.scrollIntoView(e)})}});class D0{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||DL(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord,this.test=e.test}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(t,r)=>r=="n"?`
`:r=="r"?"\r":r=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord&&this.test==e.test}create(){return this.regexp?new qL(this):new $L(this)}getCursor(e,t=0,r){let n=e.doc?e:ke.create({doc:e});return r==null&&(r=n.doc.length),this.regexp?Cr(this,n,t,r):wr(this,n,t,r)}}class L0{constructor(e){this.spec=e}}function zL(i,e,t){return(r,n,s,l)=>{if(t&&!t(r,n,s,l))return!1;let o=r>=l&&n<=l+s.length?s.slice(r-l,n-l):e.doc.sliceString(r,n);return i(o,e,r,n)}}function wr(i,e,t,r){let n;return i.wholeWord&&(n=WL(e.doc,e.charCategorizer(e.selection.main.head))),i.test&&(n=zL(i.test,e,n)),new Kr(e.doc,i.unquoted,t,r,i.caseSensitive?void 0:s=>s.toLowerCase(),n)}function WL(i,e){return(t,r,n,s)=>((s>t||s+n.length<r)&&(s=Math.max(0,t-2),n=i.sliceString(s,Math.min(i.length,r+2))),(e(_o(n,t-s))!=Fe.Word||e(yo(n,t-s))!=Fe.Word)&&(e(yo(n,r-s))!=Fe.Word||e(_o(n,r-s))!=Fe.Word))}class $L extends L0{constructor(e){super(e)}nextMatch(e,t,r){let n=wr(this.spec,e,r,e.doc.length).nextOverlapping();if(n.done){let s=Math.min(e.doc.length,t+this.spec.unquoted.length);n=wr(this.spec,e,0,s).nextOverlapping()}return n.done||n.value.from==t&&n.value.to==r?null:n.value}prevMatchInRange(e,t,r){for(let n=r;;){let s=Math.max(t,n-1e4-this.spec.unquoted.length),l=wr(this.spec,e,s,n),o=null;for(;!l.nextOverlapping().done;)o=l.value;if(o)return o;if(s==t)return null;n-=1e4}}prevMatch(e,t,r){let n=this.prevMatchInRange(e,0,t);return n||(n=this.prevMatchInRange(e,Math.max(0,r-this.spec.unquoted.length),e.doc.length)),n&&(n.from!=t||n.to!=r)?n:null}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,t){let r=wr(this.spec,e,0,e.doc.length),n=[];for(;!r.next().done;){if(n.length>=t)return null;n.push(r.value)}return n}highlight(e,t,r,n){let s=wr(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(r+this.spec.unquoted.length,e.doc.length));for(;!s.next().done;)n(s.value.from,s.value.to)}}function VL(i,e,t){return(r,n,s)=>(!t||t(r,n,s))&&i(s[0],e,r,n)}function Cr(i,e,t,r){let n;return i.wholeWord&&(n=UL(e.charCategorizer(e.selection.main.head))),i.test&&(n=VL(i.test,e,n)),new E0(e.doc,i.search,{ignoreCase:!i.caseSensitive,test:n},t,r)}function _o(i,e){return i.slice(Ge(i,e,!1),e)}function yo(i,e){return i.slice(e,Ge(i,e))}function UL(i){return(e,t,r)=>!r[0].length||(i(_o(r.input,r.index))!=Fe.Word||i(yo(r.input,r.index))!=Fe.Word)&&(i(yo(r.input,r.index+r[0].length))!=Fe.Word||i(_o(r.input,r.index+r[0].length))!=Fe.Word)}class qL extends L0{nextMatch(e,t,r){let n=Cr(this.spec,e,r,e.doc.length).next();return n.done&&(n=Cr(this.spec,e,0,t).next()),n.done?null:n.value}prevMatchInRange(e,t,r){for(let n=1;;n++){let s=Math.max(t,r-n*1e4),l=Cr(this.spec,e,s,r),o=null;for(;!l.next().done;)o=l.value;if(o&&(s==t||o.from>s+10))return o;if(s==t)return null}}prevMatch(e,t,r){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,r,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&]|\d+)/g,(t,r)=>{if(r=="&")return e.match[0];if(r=="$")return"$";for(let n=r.length;n>0;n--){let s=+r.slice(0,n);if(s>0&&s<e.match.length)return e.match[s]+r.slice(n)}return t})}matchAll(e,t){let r=Cr(this.spec,e,0,e.doc.length),n=[];for(;!r.next().done;){if(n.length>=t)return null;n.push(r.value)}return n}highlight(e,t,r,n){let s=Cr(this.spec,e,Math.max(0,t-250),Math.min(r+250,e.doc.length));for(;!s.next().done;)n(s.value.from,s.value.to)}}const zn=pe.define(),sh=pe.define(),Ii=tt.define({create(i){return new jl(Ka(i).create(),null)},update(i,e){for(let t of e.effects)t.is(zn)?i=new jl(t.value.create(),i.panel):t.is(sh)&&(i=new jl(i.query,t.value?oh:null));return i},provide:i=>Bn.from(i,e=>e.panel)});class jl{constructor(e,t){this.query=e,this.panel=t}}const KL=he.mark({class:"cm-searchMatch"}),GL=he.mark({class:"cm-searchMatch cm-searchMatch-selected"}),XL=ot.fromClass(class{constructor(i){this.view=i,this.decorations=this.highlight(i.state.field(Ii))}update(i){let e=i.state.field(Ii);(e!=i.startState.field(Ii)||i.docChanged||i.selectionSet||i.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:i,panel:e}){if(!e||!i.spec.valid)return he.none;let{view:t}=this,r=new Hi;for(let n=0,s=t.visibleRanges,l=s.length;n<l;n++){let{from:o,to:a}=s[n];for(;n<l-1&&a>s[n+1].from-500;)a=s[++n].to;i.highlight(t.state,o,a,(c,h)=>{let u=t.state.selection.ranges.some(f=>f.from==c&&f.to==h);r.add(c,h,u?GL:KL)})}return r.finish()}},{decorations:i=>i.decorations});function rs(i){return e=>{let t=e.state.field(Ii,!1);return t&&t.query.spec.valid?i(e,t):R0(e)}}const bo=rs((i,{query:e})=>{let{to:t}=i.state.selection.main,r=e.nextMatch(i.state,t,t);if(!r)return!1;let n=G.single(r.from,r.to),s=i.state.facet(en);return i.dispatch({selection:n,effects:[lh(i,r),s.scrollToMatch(n.main,i)],userEvent:"select.search"}),T0(i),!0}),xo=rs((i,{query:e})=>{let{state:t}=i,{from:r}=t.selection.main,n=e.prevMatch(t,r,r);if(!n)return!1;let s=G.single(n.from,n.to),l=i.state.facet(en);return i.dispatch({selection:s,effects:[lh(i,n),l.scrollToMatch(s.main,i)],userEvent:"select.search"}),T0(i),!0}),JL=rs((i,{query:e})=>{let t=e.matchAll(i.state,1e3);return!t||!t.length?!1:(i.dispatch({selection:G.create(t.map(r=>G.range(r.from,r.to))),userEvent:"select.search.matches"}),!0)}),YL=({state:i,dispatch:e})=>{let t=i.selection;if(t.ranges.length>1||t.main.empty)return!1;let{from:r,to:n}=t.main,s=[],l=0;for(let o=new Kr(i.doc,i.sliceDoc(r,n));!o.next().done;){if(s.length>1e3)return!1;o.value.from==r&&(l=s.length),s.push(G.range(o.value.from,o.value.to))}return e(i.update({selection:G.create(s,l),userEvent:"select.search.matches"})),!0},ud=rs((i,{query:e})=>{let{state:t}=i,{from:r,to:n}=t.selection.main;if(t.readOnly)return!1;let s=e.nextMatch(t,r,r);if(!s)return!1;let l=s,o=[],a,c,h=[];l.from==r&&l.to==n&&(c=t.toText(e.getReplacement(l)),o.push({from:l.from,to:l.to,insert:c}),l=e.nextMatch(t,l.from,l.to),h.push(se.announce.of(t.phrase("replaced match on line $",t.doc.lineAt(r).number)+".")));let u=i.state.changes(o);return l&&(a=G.single(l.from,l.to).map(u),h.push(lh(i,l)),h.push(t.facet(en).scrollToMatch(a.main,i))),i.dispatch({changes:u,selection:a,effects:h,userEvent:"input.replace"}),!0}),QL=rs((i,{query:e})=>{if(i.state.readOnly)return!1;let t=e.matchAll(i.state,1e9).map(n=>{let{from:s,to:l}=n;return{from:s,to:l,insert:e.getReplacement(n)}});if(!t.length)return!1;let r=i.state.phrase("replaced $ matches",t.length)+".";return i.dispatch({changes:t,effects:se.announce.of(r),userEvent:"input.replace.all"}),!0});function oh(i){return i.state.facet(en).createPanel(i)}function Ka(i,e){var t,r,n,s,l;let o=i.selection.main,a=o.empty||o.to>o.from+100?"":i.sliceDoc(o.from,o.to);if(e&&!a)return e;let c=i.facet(en);return new D0({search:((t=e==null?void 0:e.literal)!==null&&t!==void 0?t:c.literal)?a:a.replace(/\n/g,"\\n"),caseSensitive:(r=e==null?void 0:e.caseSensitive)!==null&&r!==void 0?r:c.caseSensitive,literal:(n=e==null?void 0:e.literal)!==null&&n!==void 0?n:c.literal,regexp:(s=e==null?void 0:e.regexp)!==null&&s!==void 0?s:c.regexp,wholeWord:(l=e==null?void 0:e.wholeWord)!==null&&l!==void 0?l:c.wholeWord})}function M0(i){let e=zc(i,oh);return e&&e.dom.querySelector("[main-field]")}function T0(i){let e=M0(i);e&&e==i.root.activeElement&&e.select()}const R0=i=>{let e=i.state.field(Ii,!1);if(e&&e.panel){let t=M0(i);if(t&&t!=i.root.activeElement){let r=Ka(i.state,e.query.spec);r.valid&&i.dispatch({effects:zn.of(r)}),t.focus(),t.select()}}else i.dispatch({effects:[sh.of(!0),e?zn.of(Ka(i.state,e.query.spec)):pe.appendConfig.of(iM)]});return!0},P0=i=>{let e=i.state.field(Ii,!1);if(!e||!e.panel)return!1;let t=zc(i,oh);return t&&t.dom.contains(i.root.activeElement)&&i.focus(),i.dispatch({effects:sh.of(!1)}),!0},ZL=[{key:"Mod-f",run:R0,scope:"editor search-panel"},{key:"F3",run:bo,shift:xo,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:bo,shift:xo,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:P0,scope:"editor search-panel"},{key:"Mod-Shift-l",run:YL},{key:"Mod-Alt-g",run:LL},{key:"Mod-d",run:jL,preventDefault:!0}];class eM{constructor(e){this.view=e;let t=this.query=e.state.field(Ii).query.spec;this.commit=this.commit.bind(this),this.searchField=Me("input",{value:t.search,placeholder:At(e,"Find"),"aria-label":At(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=Me("input",{value:t.replace,placeholder:At(e,"Replace"),"aria-label":At(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=Me("input",{type:"checkbox",name:"case",form:"",checked:t.caseSensitive,onchange:this.commit}),this.reField=Me("input",{type:"checkbox",name:"re",form:"",checked:t.regexp,onchange:this.commit}),this.wordField=Me("input",{type:"checkbox",name:"word",form:"",checked:t.wholeWord,onchange:this.commit});function r(n,s,l){return Me("button",{class:"cm-button",name:n,onclick:s,type:"button"},l)}this.dom=Me("div",{onkeydown:n=>this.keydown(n),class:"cm-search"},[this.searchField,r("next",()=>bo(e),[At(e,"next")]),r("prev",()=>xo(e),[At(e,"previous")]),r("select",()=>JL(e),[At(e,"all")]),Me("label",null,[this.caseField,At(e,"match case")]),Me("label",null,[this.reField,At(e,"regexp")]),Me("label",null,[this.wordField,At(e,"by word")]),...e.state.readOnly?[]:[Me("br"),this.replaceField,r("replace",()=>ud(e),[At(e,"replace")]),r("replaceAll",()=>QL(e),[At(e,"replace all")])],Me("button",{name:"close",onclick:()=>P0(e),"aria-label":At(e,"close"),type:"button"},["×"])])}commit(){let e=new D0({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:zn.of(e)}))}keydown(e){T2(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?xo:bo)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),ud(this.view))}update(e){for(let t of e.transactions)for(let r of t.effects)r.is(zn)&&!r.value.eq(this.query)&&this.setQuery(r.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(en).top}}function At(i,e){return i.state.phrase(e)}const Rs=30,Ps=/[\s\.,:;?!]/;function lh(i,{from:e,to:t}){let r=i.state.doc.lineAt(e),n=i.state.doc.lineAt(t).to,s=Math.max(r.from,e-Rs),l=Math.min(n,t+Rs),o=i.state.sliceDoc(s,l);if(s!=r.from){for(let a=0;a<Rs;a++)if(!Ps.test(o[a+1])&&Ps.test(o[a])){o=o.slice(a);break}}if(l!=n){for(let a=o.length-1;a>o.length-Rs;a--)if(!Ps.test(o[a-1])&&Ps.test(o[a])){o=o.slice(0,a);break}}return se.announce.of(`${i.state.phrase("current match")}. ${o} ${i.state.phrase("on line")} ${r.number}.`)}const tM=se.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),iM=[Ii,vr.low(XL),tM];class fd{constructor(e,t,r){this.from=e,this.to=t,this.diagnostic=r}}class rr{constructor(e,t,r){this.diagnostics=e,this.panel=t,this.selected=r}static init(e,t,r){let n=r.facet(Wn).markerFilter;n&&(e=n(e,r));let s=e.slice().sort((d,y)=>d.from-y.from||d.to-y.to),l=new Hi,o=[],a=0,c=r.doc.iter(),h=0,u=r.doc.length;for(let d=0;;){let y=d==s.length?null:s[d];if(!y&&!o.length)break;let _,m;if(o.length)_=a,m=o.reduce((v,b)=>Math.min(v,b.to),y&&y.from>_?y.from:1e8);else{if(_=y.from,_>u)break;m=y.to,o.push(y),d++}for(;d<s.length;){let v=s[d];if(v.from==_&&(v.to>v.from||v.to==_))o.push(v),d++,m=Math.min(v.to,m);else{m=Math.min(v.from,m);break}}m=Math.min(m,u);let p=!1;if(o.some(v=>v.from==_&&(v.to==m||m==u))&&(p=_==m,!p&&m-_<10)){let v=_-(h+c.value.length);v>0&&(c.next(v),h=_);for(let b=_;;){if(b>=m){p=!0;break}if(!c.lineBreak&&h+c.value.length>b)break;b=h+c.value.length,h+=c.value.length,c.next()}}let g=mM(o);if(p)l.add(_,_,he.widget({widget:new uM(g),diagnostics:o.slice()}));else{let v=o.reduce((b,S)=>S.markClass?b+" "+S.markClass:b,"");l.add(_,m,he.mark({class:"cm-lintRange cm-lintRange-"+g+v,diagnostics:o.slice(),inclusiveEnd:o.some(b=>b.to>m)}))}if(a=m,a==u)break;for(let v=0;v<o.length;v++)o[v].to<=a&&o.splice(v--,1)}let f=l.finish();return new rr(f,t,Gr(f))}}function Gr(i,e=null,t=0){let r=null;return i.between(t,1e9,(n,s,{spec:l})=>{if(!(e&&l.diagnostics.indexOf(e)<0))if(!r)r=new fd(n,s,e||l.diagnostics[0]);else{if(l.diagnostics.indexOf(r.diagnostic)<0)return!1;r=new fd(r.from,s,r.diagnostic)}}),r}function rM(i,e){let t=e.pos,r=e.end||t,n=i.state.facet(Wn).hideOn(i,t,r);if(n!=null)return n;let s=i.startState.doc.lineAt(e.pos);return!!(i.effects.some(l=>l.is(B0))||i.changes.touchesRange(s.from,Math.max(s.to,r)))}function nM(i,e){return i.field(Rt,!1)?e:e.concat(pe.appendConfig.of(gM))}const B0=pe.define(),ah=pe.define(),O0=pe.define(),Rt=tt.define({create(){return new rr(he.none,null,null)},update(i,e){if(e.docChanged&&i.diagnostics.size){let t=i.diagnostics.map(e.changes),r=null,n=i.panel;if(i.selected){let s=e.changes.mapPos(i.selected.from,1);r=Gr(t,i.selected.diagnostic,s)||Gr(t,null,s)}!t.size&&n&&e.state.facet(Wn).autoPanel&&(n=null),i=new rr(t,n,r)}for(let t of e.effects)if(t.is(B0)){let r=e.state.facet(Wn).autoPanel?t.value.length?$n.open:null:i.panel;i=rr.init(t.value,r,e.state)}else t.is(ah)?i=new rr(i.diagnostics,t.value?$n.open:null,i.selected):t.is(O0)&&(i=new rr(i.diagnostics,i.panel,t.value));return i},provide:i=>[Bn.from(i,e=>e.panel),se.decorations.from(i,e=>e.diagnostics)]}),sM=he.mark({class:"cm-lintRange cm-lintRange-active"});function oM(i,e,t){let{diagnostics:r}=i.state.field(Rt),n,s=-1,l=-1;r.between(e-(t<0?1:0),e+(t>0?1:0),(a,c,{spec:h})=>{if(e>=a&&e<=c&&(a==c||(e>a||t>0)&&(e<c||t<0)))return n=h.diagnostics,s=a,l=c,!1});let o=i.state.facet(Wn).tooltipFilter;return n&&o&&(n=o(n,i.state)),n?{pos:s,end:l,above:i.state.doc.lineAt(s).to<l,create(){return{dom:lM(i,n)}}}:null}function lM(i,e){return Me("ul",{class:"cm-tooltip-lint"},e.map(t=>N0(i,t,!1)))}const aM=i=>{let e=i.state.field(Rt,!1);(!e||!e.panel)&&i.dispatch({effects:nM(i.state,[ah.of(!0)])});let t=zc(i,$n.open);return t&&t.dom.querySelector(".cm-panel-lint ul").focus(),!0},dd=i=>{let e=i.state.field(Rt,!1);return!e||!e.panel?!1:(i.dispatch({effects:ah.of(!1)}),!0)},cM=i=>{let e=i.state.field(Rt,!1);if(!e)return!1;let t=i.state.selection.main,r=e.diagnostics.iter(t.to+1);return!r.value&&(r=e.diagnostics.iter(0),!r.value||r.from==t.from&&r.to==t.to)?!1:(i.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0}),!0)},hM=[{key:"Mod-Shift-m",run:aM,preventDefault:!0},{key:"F8",run:cM}],Wn=oe.define({combine(i){return{sources:i.map(e=>e.source).filter(e=>e!=null),...qi(i.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{delay:Math.max,markerFilter:pd,tooltipFilter:pd,needsRefresh:(e,t)=>e?t?r=>e(r)||t(r):e:t,hideOn:(e,t)=>e?t?(r,n,s)=>e(r,n,s)||t(r,n,s):e:t,autoPanel:(e,t)=>e||t})}}});function pd(i,e){return i?e?(t,r)=>e(i(t,r),r):i:e}function I0(i){let e=[];if(i)e:for(let{name:t}of i){for(let r=0;r<t.length;r++){let n=t[r];if(/[a-zA-Z]/.test(n)&&!e.some(s=>s.toLowerCase()==n.toLowerCase())){e.push(n);continue e}}e.push("")}return e}function N0(i,e,t){var r;let n=t?I0(e.actions):[];return Me("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},Me("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage(i):e.message),(r=e.actions)===null||r===void 0?void 0:r.map((s,l)=>{let o=!1,a=d=>{if(d.preventDefault(),o)return;o=!0;let y=Gr(i.state.field(Rt).diagnostics,e);y&&s.apply(i,y.from,y.to)},{name:c}=s,h=n[l]?c.indexOf(n[l]):-1,u=h<0?c:[c.slice(0,h),Me("u",c.slice(h,h+1)),c.slice(h+1)],f=s.markClass?" "+s.markClass:"";return Me("button",{type:"button",class:"cm-diagnosticAction"+f,onclick:a,onmousedown:a,"aria-label":` Action: ${c}${h<0?"":` (access key "${n[l]})"`}.`},u)}),e.source&&Me("div",{class:"cm-diagnosticSource"},e.source))}class uM extends Ki{constructor(e){super(),this.sev=e}eq(e){return e.sev==this.sev}toDOM(){return Me("span",{class:"cm-lintPoint cm-lintPoint-"+this.sev})}}class md{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=N0(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class $n{constructor(e){this.view=e,this.items=[];let t=n=>{if(!(n.ctrlKey||n.altKey||n.metaKey)){if(n.keyCode==27)dd(this.view),this.view.focus();else if(n.keyCode==38||n.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(n.keyCode==40||n.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(n.keyCode==36)this.moveSelection(0);else if(n.keyCode==35)this.moveSelection(this.items.length-1);else if(n.keyCode==13)this.view.focus();else if(n.keyCode>=65&&n.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:s}=this.items[this.selectedIndex],l=I0(s.actions);for(let o=0;o<l.length;o++)if(l[o].toUpperCase().charCodeAt(0)==n.keyCode){let a=Gr(this.view.state.field(Rt).diagnostics,s);a&&s.actions[o].apply(e,a.from,a.to)}}else return;n.preventDefault()}},r=n=>{for(let s=0;s<this.items.length;s++)this.items[s].dom.contains(n.target)&&this.moveSelection(s)};this.list=Me("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t,onclick:r}),this.dom=Me("div",{class:"cm-panel-lint"},this.list,Me("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>dd(this.view)},"×")),this.update()}get selectedIndex(){let e=this.view.state.field(Rt).selected;if(!e)return-1;for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:e,selected:t}=this.view.state.field(Rt),r=0,n=!1,s=null,l=new Set;for(e.between(0,this.view.state.doc.length,(o,a,{spec:c})=>{for(let h of c.diagnostics){if(l.has(h))continue;l.add(h);let u=-1,f;for(let d=r;d<this.items.length;d++)if(this.items[d].diagnostic==h){u=d;break}u<0?(f=new md(this.view,h),this.items.splice(r,0,f),n=!0):(f=this.items[u],u>r&&(this.items.splice(r,u-r),n=!0)),t&&f.diagnostic==t.diagnostic?f.dom.hasAttribute("aria-selected")||(f.dom.setAttribute("aria-selected","true"),s=f):f.dom.hasAttribute("aria-selected")&&f.dom.removeAttribute("aria-selected"),r++}});r<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)n=!0,this.items.pop();this.items.length==0&&(this.items.push(new md(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),n=!0),s?(this.list.setAttribute("aria-activedescendant",s.id),this.view.requestMeasure({key:this,read:()=>({sel:s.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:o,panel:a})=>{let c=a.height/this.list.offsetHeight;o.top<a.top?this.list.scrollTop-=(a.top-o.top)/c:o.bottom>a.bottom&&(this.list.scrollTop+=(o.bottom-a.bottom)/c)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),n&&this.sync()}sync(){let e=this.list.firstChild;function t(){let r=e;e=r.nextSibling,r.remove()}for(let r of this.items)if(r.dom.parentNode==this.list){for(;e!=r.dom;)t();e=r.dom.nextSibling}else this.list.insertBefore(r.dom,e);for(;e;)t()}moveSelection(e){if(this.selectedIndex<0)return;let t=this.view.state.field(Rt),r=Gr(t.diagnostics,this.items[e].diagnostic);r&&this.view.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0,effects:O0.of(r)})}static open(e){return new $n(e)}}function fM(i,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(i)}</svg>')`}function Bs(i){return fM(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${i}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const dM=se.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:Bs("#d11")},".cm-lintRange-warning":{backgroundImage:Bs("orange")},".cm-lintRange-info":{backgroundImage:Bs("#999")},".cm-lintRange-hint":{backgroundImage:Bs("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});function pM(i){return i=="error"?4:i=="warning"?3:i=="info"?2:1}function mM(i){let e="hint",t=1;for(let r of i){let n=pM(r.severity);n>t&&(t=n,e=r.severity)}return e}const gM=[Rt,se.decorations.compute([Rt],i=>{let{selected:e,panel:t}=i.field(Rt);return!e||!t||e.from==e.to?he.none:he.set([sM.range(e.from,e.to)])}),V2(oM,{hideOn:rM}),dM],vM="#e5c07b",gd="#e06c75",_M="#56b6c2",yM="#ffffff",Us="#abb2bf",Ga="#7d8799",bM="#61afef",xM="#98c379",vd="#d19a66",SM="#c678dd",wM="#21252b",_d="#2c313a",yd="#282c34",zl="#353a42",CM="#3E4451",bd="#528bff",kM=se.theme({"&":{color:Us,backgroundColor:yd},".cm-content":{caretColor:bd},".cm-cursor, .cm-dropCursor":{borderLeftColor:bd},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:CM},".cm-panels":{backgroundColor:wM,color:Us},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:yd,color:Ga,border:"none"},".cm-activeLineGutter":{backgroundColor:_d},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:zl},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:zl,borderBottomColor:zl},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:_d,color:Us}}},{dark:!0}),EM=es.define([{tag:q.keyword,color:SM},{tag:[q.name,q.deleted,q.character,q.propertyName,q.macroName],color:gd},{tag:[q.function(q.variableName),q.labelName],color:bM},{tag:[q.color,q.constant(q.name),q.standard(q.name)],color:vd},{tag:[q.definition(q.name),q.separator],color:Us},{tag:[q.typeName,q.className,q.number,q.changed,q.annotation,q.modifier,q.self,q.namespace],color:vM},{tag:[q.operator,q.operatorKeyword,q.url,q.escape,q.regexp,q.link,q.special(q.string)],color:_M},{tag:[q.meta,q.comment],color:Ga},{tag:q.strong,fontWeight:"bold"},{tag:q.emphasis,fontStyle:"italic"},{tag:q.strikethrough,textDecoration:"line-through"},{tag:q.link,color:Ga,textDecoration:"underline"},{tag:q.heading,fontWeight:"bold",color:gd},{tag:[q.atom,q.bool,q.special(q.variableName)],color:vd},{tag:[q.processingInstruction,q.string,q.inserted],color:xM},{tag:q.invalid,color:yM}]),AM=[kM,Rg(EM)];async function DM(i){switch(i){case"python":{const{python:e}=await Di(async()=>{const{python:t}=await import("./index-Zm9NbnRR.js");return{python:t}},__vite__mapDeps([0,1,2,3,4,5]));return e()}case"javascript":case"typescript":{const{javascript:e}=await Di(async()=>{const{javascript:t}=await import("./index-DgVWXTC4.js");return{javascript:t}},__vite__mapDeps([6,1,2,3,4,5]));return e({jsx:!0,typescript:i==="typescript"})}case"sql":{const{sql:e}=await Di(async()=>{const{sql:t}=await import("./index-BeoPZG9s.js");return{sql:t}},__vite__mapDeps([7,1,2,3,4,5]));return e()}case"json":{const{json:e}=await Di(async()=>{const{json:t}=await import("./index-_z-BZI0l.js");return{json:t}},__vite__mapDeps([8,1,2,3,4,5]));return e()}case"yaml":{const{yaml:e}=await Di(async()=>{const{yaml:t}=await import("./index-8oghqiEM.js");return{yaml:t}},__vite__mapDeps([9,1,2,3,4,5]));return e()}case"markdown":{const{markdown:e}=await Di(async()=>{const{markdown:t}=await import("./index-Bwy8i-v7.js");return{markdown:t}},__vite__mapDeps([10,11,1,12,2,3,4,5,6]));return e()}case"html":{const{html:e}=await Di(async()=>{const{html:t}=await import("./index-ZopEsRrs.js");return{html:t}},__vite__mapDeps([11,1,12,2,3,4,5,6]));return e()}case"css":{const{css:e}=await Di(async()=>{const{css:t}=await import("./index-CrNZRIoI.js");return{css:t}},__vite__mapDeps([12,1,2,3,4,5]));return e()}default:return[]}}const LM=N.memo(function({value:e,onChange:t,filePath:r,language:n,readOnly:s=!1,className:l=""}){const o=N.useRef(null),a=N.useRef(null),c=N.useRef(!1),h=n||(r?rv(qn(r)):"text");return N.useEffect(()=>{if(!o.current)return;let u=!0;return(async()=>{const f=[rE(),B2(),oE(),AA(),eA(),VE(),uA(),pL(),kL(),RL(),Rg(nA,{fallback:!0}),AM,Oo.of([...LD,...IA,..._L,...ZL,...hM,MD]),se.updateListener.of(p=>{p.docChanged&&!c.current&&t&&t(p.state.doc.toString())}),ke.readOnly.of(s),se.theme({"&":{height:"100%",fontSize:"13px"},".cm-scroller":{fontFamily:"JetBrains Mono, Menlo, Monaco, Consolas, monospace",overflow:"auto"},".cm-gutters":{backgroundColor:"var(--color-bg-secondary)",borderRight:"1px solid var(--color-border)"}})],d=await DM(h),y=[...f,d];if(!u)return;const _=ke.create({doc:e,extensions:y}),m=new se({state:_,parent:o.current});a.current=m})(),()=>{u=!1,a.current&&(a.current.destroy(),a.current=null)}},[]),N.useEffect(()=>{const u=a.current;if(!u)return;const f=u.state.doc.toString();f!==e&&(c.current=!0,u.dispatch({changes:{from:0,to:f.length,insert:e}}),c.current=!1)},[e]),D.jsx("div",{ref:o,className:`h-full w-full overflow-hidden ${l}`})},(i,e)=>i.value===e.value&&i.filePath===e.filePath&&i.readOnly===e.readOnly);function MM(i,e,t){if(e)return t?D.jsx(Ad,{className:"h-4 w-4 text-yellow-500"}):D.jsx(Cd,{className:"h-4 w-4 text-yellow-500"});switch(qn(i)){case"py":return D.jsx(Mr,{className:"h-4 w-4 text-blue-400"});case"js":case"jsx":case"ts":case"tsx":return D.jsx(Mr,{className:"h-4 w-4 text-yellow-400"});case"json":return D.jsx(Ed,{className:"h-4 w-4 text-orange-400"});case"yaml":case"yml":return D.jsx(ar,{className:"h-4 w-4 text-purple-400"});case"sql":return D.jsx(Mr,{className:"h-4 w-4 text-green-400"});case"md":return D.jsx(ar,{className:"h-4 w-4 text-gray-400"});default:return D.jsx(Un,{className:"h-4 w-4 text-gray-400"})}}const TM=N.memo(function i({node:e,depth:t,selectedPath:r,expandedPaths:n,onToggleExpand:s,onFileSelect:l,onFileDelete:o}){const a=e.type==="directory",c=n.has(e.path),h=r===e.path,[u,f]=N.useState(!1),d=N.useCallback(()=>{a?s(e.path):l(e.path)},[a,e.path,s,l]),y=N.useCallback(_=>{_.stopPropagation(),o&&confirm(`Delete ${e.name}?`)&&o(e.path)},[e.name,e.path,o]);return D.jsxs(D.Fragment,{children:[D.jsxs("div",{className:ue("flex items-center gap-1 px-2 py-1 cursor-pointer hover:bg-[var(--color-bg-secondary)] transition-colors",h&&"bg-[var(--color-accent-primary)]/20 hover:bg-[var(--color-accent-primary)]/30"),style:{paddingLeft:`${t*12+8}px`},onClick:d,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:[a?D.jsx("span",{className:"w-4 h-4 flex items-center justify-center text-[var(--color-text-muted)]",children:c?D.jsx(Kn,{className:"h-3 w-3"}):D.jsx(So,{className:"h-3 w-3"})}):D.jsx("span",{className:"w-4 h-4"}),MM(e.name,a,c),D.jsx("span",{className:"flex-1 text-xs text-[var(--color-text-primary)] truncate",children:e.name}),u&&o&&!a&&D.jsx("button",{onClick:y,className:"p-0.5 rounded hover:bg-red-500/20 text-[var(--color-text-muted)] hover:text-red-400 transition-colors",title:"Delete file",children:D.jsx(nv,{className:"h-3 w-3"})})]}),a&&c&&e.children&&D.jsx(D.Fragment,{children:e.children.map(_=>D.jsx(i,{node:_,depth:t+1,selectedPath:r,expandedPaths:n,onToggleExpand:s,onFileSelect:l,onFileDelete:o},_.path))})]})});function RM({files:i,selectedPath:e,onFileSelect:t,onFileCreate:r,onFileDelete:n,onRefresh:s,isLoading:l=!1,className:o=""}){const[a,c]=N.useState(new Set),h=N.useCallback(u=>{c(f=>{const d=new Set(f);return d.has(u)?d.delete(u):d.add(u),d})},[]);return D.jsxs("div",{className:ue("flex flex-col h-full",o),children:[D.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-[var(--color-border)]",children:[D.jsx("span",{className:"text-xs font-medium text-[var(--color-text-muted)] uppercase tracking-wider",children:"Files"}),D.jsxs("div",{className:"flex items-center gap-1",children:[r&&D.jsx("button",{onClick:()=>{const u=prompt("Enter file name:");u&&r(u)},className:"p-1 rounded hover:bg-[var(--color-bg-secondary)] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors",title:"New file",children:D.jsx($l,{className:"h-4 w-4"})}),s&&D.jsx("button",{onClick:s,disabled:l,className:"p-1 rounded hover:bg-[var(--color-bg-secondary)] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors disabled:opacity-50",title:"Refresh",children:D.jsx(Xr,{className:ue("h-4 w-4",l&&"animate-spin")})})]})]}),D.jsx("div",{className:"flex-1 overflow-y-auto py-1",children:i.length===0?D.jsx("div",{className:"px-3 py-4 text-xs text-[var(--color-text-muted)] text-center",children:l?"Loading files...":"No files yet"}):i.map(u=>D.jsx(TM,{node:u,depth:0,selectedPath:e,expandedPaths:a,onToggleExpand:h,onFileSelect:t,onFileDelete:n},u.path))})]})}function PM(i){switch(qn(i)){case"py":return D.jsx(Mr,{className:"h-3.5 w-3.5 text-blue-400"});case"js":case"jsx":case"ts":case"tsx":return D.jsx(Mr,{className:"h-3.5 w-3.5 text-yellow-400"});case"json":return D.jsx(Ed,{className:"h-3.5 w-3.5 text-orange-400"});case"yaml":case"yml":return D.jsx(ar,{className:"h-3.5 w-3.5 text-purple-400"});case"sql":return D.jsx(Mr,{className:"h-3.5 w-3.5 text-green-400"});case"md":return D.jsx(ar,{className:"h-3.5 w-3.5 text-gray-400"});default:return D.jsx(Un,{className:"h-3.5 w-3.5 text-gray-400"})}}const BM=N.memo(function({tabs:e,activeTab:t,onTabSelect:r,onTabClose:n,className:s=""}){const l=N.useCallback((o,a)=>{o.stopPropagation(),n(a)},[n]);return e.length===0?null:D.jsx("div",{className:ue("flex items-center border-b border-[var(--color-border)] bg-[var(--color-bg-secondary)]/50 overflow-x-auto",s),children:e.map(o=>{const a=t===o.path;return D.jsxs("button",{onClick:()=>r(o.path),className:ue("flex items-center gap-1.5 px-3 py-2 text-xs border-r border-[var(--color-border)] min-w-0 max-w-[150px] group transition-colors",a?"bg-[var(--color-background)] text-[var(--color-text-primary)]":"text-[var(--color-text-muted)] hover:bg-[var(--color-background)]/50 hover:text-[var(--color-text-primary)]"),children:[PM(o.name),D.jsxs("span",{className:"truncate",children:[o.name,o.isDirty&&D.jsx("span",{className:"text-[var(--color-accent-primary)]",children:"*"})]}),D.jsx("span",{onClick:c=>l(c,o.path),className:ue("ml-auto p-0.5 rounded hover:bg-[var(--color-bg-secondary)] transition-colors",a?"opacity-100":"opacity-0 group-hover:opacity-100"),title:"Close",children:D.jsx(Vn,{className:"h-3 w-3"})})]},o.path)})})});function OM({projectId:i,className:e=""}){const[t,r]=N.useState(""),[n,s]=N.useState(""),[l,o]=N.useState(0),[a,c]=N.useState("deployed"),[h,u]=N.useState(!1),[f,d]=N.useState(null);N.useEffect(()=>{(async()=>{try{const b=await Is(i);b.app_url&&a==="deployed"&&(r(b.app_url),s(b.app_url))}catch{}})()},[i,a]),N.useEffect(()=>{const v=async()=>{try{const C=await(await fetch(`/api/projects/${i}/preview/status`)).json();if(C.status==="running"){if(u(!0),d(C.port),a==="local"){const w=`/api/projects/${i}/preview/`;r(w),s(w)}}else u(!1),d(null)}catch{u(!1),d(null)}};v();const b=setInterval(v,15e3),S=()=>{if(document.hidden)clearInterval(b);else{v();const x=setInterval(v,15e3);return()=>clearInterval(x)}};return document.addEventListener("visibilitychange",S),()=>{clearInterval(b),document.removeEventListener("visibilitychange",S)}},[i,a]);const y=N.useCallback(v=>{v.preventDefault(),n.trim()&&r(n.trim())},[n]),_=N.useCallback(()=>{o(v=>v+1)},[]),m=N.useCallback(()=>{t&&window.open(t,"_blank","noopener,noreferrer")},[t]),p=N.useCallback(async()=>{try{const b=await(await fetch(`/api/projects/${i}/preview/start`,{method:"POST"})).json();if(b.status==="started"||b.status==="already_running"){u(!0),d(b.port),c("local");const S=`/api/projects/${i}/preview/`;r(S),s(S),o(x=>x+1),Lt.success(`Preview server started on port ${b.port}`)}}catch(v){console.error("Failed to start preview server:",v),Lt.error("Failed to start preview server")}},[i]),g=N.useCallback(async()=>{try{await fetch(`/api/projects/${i}/preview/stop`,{method:"POST"}),u(!1),d(null),r(""),s(""),Lt.success("Preview server stopped")}catch(v){console.error("Failed to stop preview server:",v),Lt.error("Failed to stop preview server")}},[i]);return D.jsxs("div",{className:ue("flex flex-col h-full",e),children:[D.jsxs("div",{className:"flex items-center gap-2 h-8 px-2 bg-[var(--color-bg-secondary)]/50 border-b border-[var(--color-border)] flex-shrink-0",children:[D.jsxs("div",{className:"flex items-center gap-1 border border-[var(--color-border)] rounded overflow-hidden",children:[D.jsx("button",{onClick:()=>c("local"),className:ue("px-2 py-0.5 text-xs transition-colors",a==="local"?"bg-[var(--color-accent-primary)] text-white":"text-[var(--color-text-muted)] hover:bg-[var(--color-bg-secondary)]"),children:"Local"}),D.jsx("button",{onClick:()=>c("deployed"),className:ue("px-2 py-0.5 text-xs transition-colors",a==="deployed"?"bg-[var(--color-accent-primary)] text-white":"text-[var(--color-text-muted)] hover:bg-[var(--color-bg-secondary)]"),children:"Deployed"})]}),a==="local"&&D.jsx(D.Fragment,{children:h?D.jsxs(D.Fragment,{children:[D.jsxs("button",{onClick:g,className:"flex items-center gap-1 px-2 py-0.5 text-xs bg-red-500/20 text-red-400 rounded hover:bg-red-500/30 transition-colors",children:[D.jsx(Yv,{className:"h-3 w-3"}),"Stop"]}),D.jsxs("span",{className:"text-xs text-[var(--color-text-muted)]",children:["Port ",f]})]}):D.jsxs("button",{onClick:p,className:"flex items-center gap-1 px-2 py-0.5 text-xs bg-green-500/20 text-green-400 rounded hover:bg-green-500/30 transition-colors",children:[D.jsx(Md,{className:"h-3 w-3"}),"Start Server"]})}),D.jsx("button",{onClick:_,className:"p-1 rounded hover:bg-[var(--color-bg-secondary)] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors ml-auto",title:"Refresh",children:D.jsx(Xr,{className:"h-3 w-3"})}),D.jsx("button",{onClick:m,disabled:!t,className:"p-1 rounded hover:bg-[var(--color-bg-secondary)] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors disabled:opacity-30",title:"Open in new tab",children:D.jsx(kd,{className:"h-3 w-3"})})]}),t&&D.jsxs("div",{className:"flex items-center gap-1.5 h-6 px-2 bg-[var(--color-background)]/50 border-b border-[var(--color-border)] flex-shrink-0",children:[D.jsx(xh,{className:"h-3 w-3 text-[var(--color-text-muted)]"}),D.jsx("form",{onSubmit:y,className:"flex-1 flex",children:D.jsx("input",{type:"text",value:n,onChange:v=>s(v.target.value),placeholder:"Enter URL...",className:"flex-1 h-4 px-2 text-xs bg-transparent border-none text-[var(--color-text-primary)] placeholder:text-[var(--color-text-muted)] focus:outline-none"})})]}),t?D.jsx("iframe",{src:t,className:"flex-1 w-full border-none bg-white",sandbox:"allow-scripts allow-same-origin allow-forms allow-popups",title:"App preview"},l):D.jsx("div",{className:"flex-1 flex items-center justify-center bg-[var(--color-background)]",children:D.jsxs("div",{className:"text-center",children:[D.jsx(xh,{className:"h-8 w-8 mx-auto text-[var(--color-text-muted)] opacity-50"}),D.jsx("p",{className:"mt-2 text-xs text-[var(--color-text-muted)]",children:"No app running. Deploy your app first or enter a URL above."})]})})]})}function IM({projectId:i,className:e=""}){const[t,r]=N.useState({status:"idle"}),[n,s]=N.useState([]),[l,o]=N.useState(!1);N.useEffect(()=>{(async()=>{try{const d=await Is(i);r(d)}catch(d){console.error("Failed to fetch deploy status:",d)}})()},[i]),N.useEffect(()=>{if(t.status!=="deploying")return;const f=new AbortController;return(async()=>{try{await U0(i,_=>{s(m=>[...m,_])},f.signal);const y=await Is(i);r(y)}catch(y){y instanceof Error&&y.name!=="AbortError"&&console.error("Failed to stream deploy logs:",y)}})(),()=>{f.abort()}},[i,t.status]);const a=N.useCallback(async()=>{try{s([]),o(!0),await V0(i),r({status:"deploying"})}catch(f){console.error("Failed to deploy:",f),r({status:"error",error:f instanceof Error?f.message:"Unknown error"})}},[i]),c=N.useCallback(async()=>{try{const f=await Is(i);r(f)}catch(f){console.error("Failed to fetch deploy status:",f)}},[i]),h=()=>{switch(t.status){case"deploying":return"text-yellow-500";case"success":return"text-green-500";case"error":return"text-red-500";default:return"text-[var(--color-text-muted)]"}},u=()=>{switch(t.status){case"deploying":return D.jsx(Ni,{className:"h-4 w-4 animate-spin"});case"success":return D.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"});case"error":return D.jsx(_v,{className:"h-4 w-4"});default:return D.jsx("span",{className:"w-2 h-2 rounded-full bg-gray-500"})}};return D.jsxs("div",{className:ue("border-t border-[var(--color-border)]",e),children:[D.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-[var(--color-bg-secondary)]/50",children:[D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx(sv,{onClick:a,disabled:t.status==="deploying",className:"h-7 px-2 text-xs",children:t.status==="deploying"?D.jsxs(D.Fragment,{children:[D.jsx(Ni,{className:"h-3 w-3 mr-1 animate-spin"}),"Deploying..."]}):D.jsxs(D.Fragment,{children:[D.jsx(Md,{className:"h-3 w-3 mr-1"}),"Deploy"]})}),D.jsxs("div",{className:ue("flex items-center gap-1.5 text-xs",h()),children:[u(),D.jsx("span",{className:"capitalize",children:t.status})]}),t.app_url&&D.jsxs("a",{href:t.app_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-xs text-[var(--color-accent-primary)] hover:underline",children:[D.jsx(kd,{className:"h-3 w-3"}),"Open App"]})]}),D.jsxs("div",{className:"flex items-center gap-1",children:[D.jsx("button",{onClick:c,className:"p-1 rounded hover:bg-[var(--color-bg-secondary)] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors",title:"Refresh status",children:D.jsx(Xr,{className:"h-3.5 w-3.5"})}),D.jsx("button",{onClick:()=>o(!l),className:"px-2 py-0.5 text-xs text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors",children:l?"Hide Logs":"Show Logs"})]})]}),l&&D.jsx("div",{className:"h-32 overflow-y-auto bg-[var(--color-background)] p-2 font-mono text-xs",children:n.length===0?D.jsx("div",{className:"text-[var(--color-text-muted)]",children:t.status==="deploying"?"Waiting for logs...":"No deployment logs"}):n.map((f,d)=>D.jsxs("div",{className:ue("py-0.5",f.level==="error"&&"text-red-400",f.level==="warning"&&"text-yellow-400",f.level==="info"&&"text-[var(--color-text-primary)]"),children:[D.jsxs("span",{className:"text-[var(--color-text-muted)]",children:["[",new Date(f.timestamp).toLocaleTimeString(),"]"]})," ",f.message]},d))}),t.error&&D.jsxs("div",{className:"px-3 py-2 bg-red-500/10 text-red-400 text-xs",children:["Error: ",t.error]})]})}const NM=N.memo(function({paneId:e,tabs:t,activeTabPath:r,onTabSelect:n,onTabClose:s,onContentChange:l,isFocused:o=!1,onFocus:a,className:c=""}){const h=t.find(_=>_.path===r),u=N.useCallback(_=>{n(e,_)},[e,n]),f=N.useCallback(_=>{s(e,_)},[e,s]),d=N.useCallback(_=>{r&&l(e,r,_)},[e,r,l]),y=N.useCallback(()=>{a==null||a(e)},[e,a]);return D.jsxs("div",{className:`flex flex-col h-full min-w-0 ${c}`,onClick:y,children:[D.jsx(BM,{tabs:t.map(_=>({path:_.path,name:_.name,isDirty:_.isDirty})),activeTab:r,onTabSelect:u,onTabClose:f,className:o?"border-b-2 border-b-[var(--color-accent-primary)]":""}),D.jsx("div",{className:"flex-1 overflow-hidden",children:h?D.jsx(LM,{value:h.content,onChange:d,filePath:h.path}):D.jsx("div",{className:"h-full flex items-center justify-center text-[var(--color-text-muted)] text-sm",children:t.length===0?"No files open":"Select a file to edit"})})]})},(i,e)=>i.paneId===e.paneId&&i.activeTabPath===e.activeTabPath&&i.tabs===e.tabs&&i.isFocused===e.isFocused);function FM({direction:i,first:e,second:t,splitRatio:r,onSplitRatioChange:n,renderPane:s}){const l=N.useRef(null),o=N.useRef(null);N.useEffect(()=>{const c=o.current,h=l.current;if(!c||!h)return;let u=!1;const f=()=>{u=!0,document.body.style.cursor=i==="horizontal"?"col-resize":"row-resize",document.body.style.userSelect="none"},d=_=>{if(!u)return;const m=h.getBoundingClientRect();let p;i==="horizontal"?p=(_.clientX-m.left)/m.width*100:p=(_.clientY-m.top)/m.height*100,n(Math.min(Math.max(p,20),80))},y=()=>{u=!1,document.body.style.cursor="",document.body.style.userSelect=""};return c.addEventListener("mousedown",f),document.addEventListener("mousemove",d),document.addEventListener("mouseup",y),()=>{c.removeEventListener("mousedown",f),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",y)}},[i,n]);const a=i==="horizontal";return D.jsxs("div",{ref:l,className:ue("flex h-full",a?"flex-row":"flex-col"),children:[D.jsx("div",{style:{[a?"width":"height"]:`${r}%`},className:"overflow-hidden",children:s(e)}),D.jsx("div",{ref:o,className:ue("flex items-center justify-center bg-[var(--color-border)] hover:bg-[var(--color-accent-primary)]/50 transition-colors",a?"w-1 cursor-col-resize":"h-1 cursor-row-resize"),children:a?D.jsx(Ld,{className:"h-4 w-4 text-[var(--color-text-muted)]"}):D.jsx(Dd,{className:"h-4 w-4 text-[var(--color-text-muted)]"})}),D.jsx("div",{style:{[a?"width":"height"]:`${100-r}%`},className:"overflow-hidden",children:s(t)})]})}function HM({layout:i,panes:e,focusedPaneId:t,onLayoutChange:r,onFocusPane:n,onTabSelect:s,onTabClose:l,onContentChange:o,className:a=""}){const c=N.useCallback((u,f)=>{const d=(y,_)=>{if(_.length===0)return{...y,splitRatio:f};const[m,...p]=_;if(y.type==="split"){if(m==="first"&&y.first)return{...y,first:d(y.first,p)};if(m==="second"&&y.second)return{...y,second:d(y.second,p)}}return y};r(d(i,u))},[i,r]),h=N.useCallback((u,f=[])=>{if(u.type==="leaf"&&u.paneId){const d=e[u.paneId]||{tabs:[]};return D.jsx(NM,{paneId:u.paneId,tabs:d.tabs,activeTabPath:d.activeTabPath,onTabSelect:s,onTabClose:l,onContentChange:o,isFocused:t===u.paneId,onFocus:n})}return u.type==="split"&&u.first&&u.second&&u.direction?D.jsx(FM,{direction:u.direction,first:u.first,second:u.second,splitRatio:u.splitRatio||50,onSplitRatioChange:d=>c(f,d),renderPane:d=>h(d,[...f,d===u.first?"first":"second"])}):null},[e,t,s,l,o,n,c]);return D.jsx("div",{className:ue("h-full overflow-hidden",a),children:h(i)})}function jM(i="main"){return{type:"leaf",paneId:i}}function Xa(i,e,t,r){return i.type==="leaf"&&i.paneId===e?{type:"split",direction:t,first:{type:"leaf",paneId:e},second:{type:"leaf",paneId:r},splitRatio:50}:i.type==="split"&&i.first&&i.second?{...i,first:Xa(i.first,e,t,r),second:Xa(i.second,e,t,r)}:i}function zM(i){const e=N.useCallback(t=>{const r=t.target,n=r.tagName==="INPUT"||r.tagName==="TEXTAREA"||r.isContentEditable;for(const s of i){if(n&&s.disableInInput!==!1&&!(s.key.toLowerCase()==="s"||s.key.toLowerCase()==="p"))continue;const l=t.key.toLowerCase()===s.key.toLowerCase(),o=!!s.ctrl===t.ctrlKey,a=!!s.meta===t.metaKey,c=!!s.shift===t.shiftKey,h=!!s.alt===t.altKey,f=navigator.platform.toUpperCase().indexOf("MAC")>=0?(s.meta||s.ctrl)===t.metaKey:(s.ctrl||s.meta)===t.ctrlKey;if(l&&c&&h){if(s.meta||s.ctrl){if(f){t.preventDefault(),s.action();return}}else if(o&&a){t.preventDefault(),s.action();return}}}},[i]);N.useEffect(()=>(window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)),[e])}function xd(i,e){return{key:i,meta:!0,ctrl:!0,action:e}}function Os(i,e){return{key:i,meta:!0,ctrl:!0,shift:!0,action:e}}function Ja(i){return i.replace(/[^a-zA-Z0-9]/g,"_").toLowerCase()}function WM(i,e){if(!i)return"";const t=i.split("@")[0],r=Ja(t);if(!e)return r;const n=Ja(e);return`${r}_${n}`}function $M(){const{projectId:i}=q0(),e=K0(),{user:t,branding:r}=G0(),[n,s]=N.useState(null),[l,o]=N.useState(!0),[,a]=N.useState([]),[c,h]=N.useState(),[,u]=N.useState([]),[f,d]=N.useState(),[y]=N.useState("ai_dev_kit"),[_,m]=N.useState(""),[p,g]=N.useState(""),[v,b]=N.useState(!1),[S,x]=N.useState([]),[C,w]=N.useState(!1),[E,A]=N.useState(new Map),[M,T]=N.useState("explorer"),[B,F]=N.useState(200),[j,z]=N.useState(450),[$,V]=N.useState(!0),[L,k]=N.useState(300),[I,H]=N.useState(!1),[P,X]=N.useState("terminal"),[ee]=N.useState([]),[re,O]=N.useState(!1),[R,K]=N.useState(jM("main")),[W,Q]=N.useState({main:{tabs:[],activeTabPath:void 0}}),[Y,ge]=N.useState("main"),[Be,Le]=N.useState(!1),[Ue,ce]=N.useState(!1),Vt=N.useMemo(()=>WM(t,(n==null?void 0:n.name)??null),[t,n==null?void 0:n.name]),ki=W[Y]||{activeTabPath:void 0},Ei=N.useMemo(()=>[{id:"file.save",label:"Save File",shortcut:"Cmd+S",category:gi.FILE,action:()=>Je()},{id:"file.quickOpen",label:"Go to File",shortcut:"Cmd+P",category:gi.FILE,action:()=>ce(!0)},{id:"view.toggleClaude",label:"Toggle Claude Terminal",shortcut:"Cmd+Shift+C",category:gi.VIEW,action:()=>V(te=>!te)},{id:"view.toggleTerminal",label:"Toggle Terminal",shortcut:"Cmd+`",category:gi.TERMINAL,action:()=>{H(te=>!te),I||X("terminal")}},{id:"view.toggleExplorer",label:"Toggle Explorer",shortcut:"Cmd+Shift+E",category:gi.VIEW,action:()=>T(te=>te==="explorer"?null:"explorer")},{id:"search.global",label:"Search in Files",shortcut:"Cmd+Shift+F",category:gi.SEARCH,action:()=>T("search")},{id:"editor.splitRight",label:"Split Editor Right",category:gi.VIEW,action:()=>de("horizontal")},{id:"editor.splitDown",label:"Split Editor Down",category:gi.VIEW,action:()=>de("vertical")},{id:"view.skills",label:"View System Prompt & Skills",category:gi.VIEW,action:()=>b(!0)}],[I]);zM([xd("s",()=>Je()),xd("p",()=>ce(!0)),Os("p",()=>Le(!0)),Os("f",()=>T("search")),Os("e",()=>T(te=>te==="explorer"?null:"explorer")),Os("c",()=>V(te=>!te)),{key:"`",meta:!0,action:()=>{H(te=>!te),I||X("terminal")}}]),N.useEffect(()=>{if(!i)return;(async()=>{try{o(!0);const[fe,ve,Se,ht]=await Promise.all([Z0(i),ev().catch(()=>[]),tv().catch(()=>[]),ns(i).catch(()=>[])]);s(fe),a(ve),u(Se),x(ht),ve.length>0&&h(ve[0].cluster_id),Se.length>0&&d(Se[0].warehouse_id)}catch(fe){console.error("Failed to load project:",fe),Lt.error("Failed to load project"),e("/")}finally{o(!1)}})()},[i,e]),N.useEffect(()=>{Vt&&!_&&m(Vt)},[Vt,_]),N.useEffect(()=>{if(t&&(n!=null&&n.name)&&!p){const te=Ja(n.name);g(`/Workspace/Users/${t}/ai_dev_kit/${te}`)}},[t,n==null?void 0:n.name,p]),N.useEffect(()=>{document.title=n!=null&&n.name?`${n.name} - ${r.app_title}`:r.app_title},[n==null?void 0:n.name,r.app_title]);const Bt=N.useCallback(async(te,fe)=>{const ve=fe||Y,Se=W[ve]||{tabs:[],activeTabPath:void 0};if(Se.tabs.find(Oe=>Oe.path===te)){Q(Oe=>({...Oe,[ve]:{...Se,activeTabPath:te}}));return}if(i)try{let Oe;const ut=E.get(te),Zt=ut?Date.now()-ut.timestamp:1/0;ut&&Zt<6e4?Oe=ut.content:(Oe=(await X0(i,te)).content,A(H0=>{const tn=new Map(H0);if(tn.size>=50){let Uo=null,hh=1/0;for(const[j0,uh]of tn)uh.timestamp<hh&&(hh=uh.timestamp,Uo=j0);Uo&&tn.delete(Uo)}return tn.set(te,{content:Oe,timestamp:Date.now()}),tn}));const Vo=te.split("/").pop()||te,F0={path:te,name:Vo,content:Oe,originalContent:Oe,isDirty:!1};Q(ch=>({...ch,[ve]:{tabs:[...Se.tabs,F0],activeTabPath:te}}))}catch(Oe){console.error("Failed to load file:",Oe),Lt.error("Failed to load file")}},[i,Y,W,E]),Ai=N.useCallback((te,fe,ve)=>{Q(Se=>{const ht=Se[te];return ht?{...Se,[te]:{...ht,tabs:ht.tabs.map(Oe=>Oe.path===fe?{...Oe,content:ve,isDirty:ve!==Oe.originalContent}:Oe)}}:Se})},[]),Je=N.useCallback(async()=>{const te=W[Y];if(!(te!=null&&te.activeTabPath)||!i)return;const fe=te.tabs.find(ve=>ve.path===te.activeTabPath);if(fe)try{await J0(i,fe.path,fe.content),A(ve=>{const Se=new Map(ve);return Se.delete(fe.path),Se}),Q(ve=>({...ve,[Y]:{...te,tabs:te.tabs.map(Se=>Se.path===fe.path?{...Se,originalContent:Se.content,isDirty:!1}:Se)}})),Lt.success("File saved")}catch(ve){console.error("Failed to save file:",ve),Lt.error("Failed to save file")}},[i,Y,W]),mi=N.useCallback((te,fe)=>{Q(ve=>{const Se=ve[te];return Se?{...ve,[te]:{...Se,activeTabPath:fe}}:ve}),ge(te)},[]),_t=N.useCallback((te,fe)=>{Q(ve=>{const Se=ve[te];if(!Se)return ve;const ht=Se.tabs.filter(ut=>ut.path!==fe);let Oe=Se.activeTabPath;return Se.activeTabPath===fe&&(Oe=ht.length>0?ht[ht.length-1].path:void 0),{...ve,[te]:{tabs:ht,activeTabPath:Oe}}})},[]),U=N.useCallback(async te=>{if(i)try{await Y0(i,te);const fe=await ns(i);x(fe),Bt(te),Lt.success("File created")}catch(fe){console.error("Failed to create file:",fe),Lt.error("Failed to create file")}},[i,Bt]),Z=N.useCallback(async te=>{if(i)try{await Q0(i,te);const fe=await ns(i);x(fe),Q(ve=>{const Se={...ve};for(const ht of Object.keys(Se)){const Oe=Se[ht];if(Oe.tabs.some(ut=>ut.path===te)){const ut=Oe.tabs.filter(Vo=>Vo.path!==te);let Zt=Oe.activeTabPath;Oe.activeTabPath===te&&(Zt=ut.length>0?ut[ut.length-1].path:void 0),Se[ht]={tabs:ut,activeTabPath:Zt}}}return Se}),Lt.success("File deleted")}catch(fe){console.error("Failed to delete file:",fe),Lt.error("Failed to delete file")}},[i]),le=N.useCallback(async()=>{if(i){w(!0);try{const te=await ns(i);x(te)}catch(te){console.error("Failed to refresh files:",te),Lt.error("Failed to refresh files")}finally{w(!1)}}},[i]),de=N.useCallback(te=>{const fe=`pane-${Date.now()}`;K(ve=>Xa(ve,Y,te,fe)),Q(ve=>({...ve,[fe]:{tabs:[],activeTabPath:void 0}})),ge(fe)},[Y]),_e=N.useCallback((te,fe)=>{Bt(te)},[Bt]),qe=N.useCallback((te,fe)=>{const ve=`diff://${te}`,Se=W[Y]||{tabs:[],activeTabPath:void 0};if(Se.tabs.find(Zt=>Zt.path===ve)){Q(Zt=>({...Zt,[Y]:{...Se,activeTabPath:ve}}));return}const Oe=`${te.split("/").pop()||te} (diff)`,ut={path:ve,name:Oe,content:fe,originalContent:fe,isDirty:!1};Q(Zt=>({...Zt,[Y]:{tabs:[...Se.tabs,ut],activeTabPath:ve}}))},[Y,W]);if(l)return D.jsx(_h,{projectName:n==null?void 0:n.name,children:D.jsx("div",{className:"flex h-full items-center justify-center",children:D.jsx(Ni,{className:"h-8 w-8 animate-spin text-[var(--color-text-muted)]"})})});const Ce=M==="explorer"?D.jsx(RM,{files:S,selectedPath:ki.activeTabPath,onFileSelect:Bt,onFileCreate:U,onFileDelete:Z,onRefresh:le,isLoading:C}):M==="search"&&i?D.jsx(uC,{projectId:i,onResultSelect:_e}):M==="git"&&i?D.jsx(fC,{projectId:i,onOpenDiff:qe}):null,ct=n!=null&&n.template?ov(n.template):void 0,Xi=ct==null?void 0:ct.suggestedPrompts,Ji=P==="terminal"&&i?D.jsx(dC,{projectId:i}):P==="output"?D.jsx(xC,{lines:ee}):P==="deploy"&&i?D.jsx("div",{className:"h-full overflow-hidden",children:D.jsx(IM,{projectId:i})}):P==="preview"&&i?D.jsx(OM,{projectId:i}):null,it=i?D.jsx(bC,{projectId:i,isMaximized:re,onToggleMaximize:()=>O(te=>!te),suggestedPrompts:Xi,onFilesChanged:le}):null;return D.jsxs(_h,{projectName:n==null?void 0:n.name,children:[D.jsx(P_,{activeActivity:M,onActivityChange:te=>{T(te),te==="chat"&&(V(!0),T(null))},leftSidebar:Ce,leftSidebarWidth:B,onLeftSidebarWidthChange:F,rightSidebar:it,rightSidebarWidth:j,onRightSidebarWidthChange:z,isRightSidebarOpen:$,isClaudeMaximized:re,maximizedContent:it,bottomPanel:Ji,bottomPanelHeight:L,onBottomPanelHeightChange:k,isBottomPanelOpen:I,onBottomPanelToggle:()=>H(te=>!te),bottomPanelTab:P,onBottomPanelTabChange:X,children:D.jsx(HM,{layout:R,panes:W,focusedPaneId:Y,onLayoutChange:K,onPaneStateChange:(te,fe)=>Q(ve=>({...ve,[te]:{...ve[te],...fe}})),onFocusPane:ge,onTabSelect:mi,onTabClose:_t,onContentChange:Ai})}),D.jsx(oC,{isOpen:Be,onClose:()=>Le(!1),commands:Ei}),D.jsx(aC,{isOpen:Ue,onClose:()=>ce(!1),files:S,onFileSelect:Bt}),v&&i&&D.jsx(nC,{projectId:i,systemPromptParams:{clusterId:c,warehouseId:f,defaultCatalog:y,defaultSchema:_,workspaceFolder:p},onClose:()=>b(!1)})]})}const sT=Object.freeze(Object.defineProperty({__proto__:null,default:$M},Symbol.toStringTag,{value:"Module"}));export{se as A,Cg as B,m0 as C,ho as D,G as E,fA as F,eT as G,RE as H,Re as I,lE as J,sT as K,QM as L,XM as N,pE as P,Nt as T,Fa as a,IE as b,iT as c,ZM as d,et as e,qE as f,RD as g,nT as h,rT as i,tT as j,kt as k,xe as l,vg as m,$e as n,UE as o,JM as p,vr as q,Oo as r,EE as s,q as t,Gt as u,TE as v,Lo as w,No as x,ke as y,Dr as z};
